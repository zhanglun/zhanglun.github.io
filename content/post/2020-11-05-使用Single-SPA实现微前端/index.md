---
title: "使用Single SPA实现微前端"
date: 2020-11-05T11:16:48+08:00
draft: true
---

随着组织架构调整，目前来车服租车团队已经有一段时间了。虽然主要业务工作还是B端系统的开发，但是租车业务因其业务特点以及一些历史原因，我面对的是两个“巨无霸”型后台系统-Car系统和Car-mis系统。这两个系统历史悠久，经手多个团队，所有租车相关的业务模块诸如交易，商品，履约，车险，商户，车辆库存和权限等，都集成在这两个系统中。

![业务架构图](./images/1.png)

随着业务迭代，两个系统日渐臃肿，高达90+的模块数使得无论是本地开发还是上线，很多时间都浪费在编译打包阶段；随着应用框架和技术方案等升级和迁移，多框架多版本共存的问题无法避免；两个系统的基本业务逻辑一致，UI上存在一些差异，各自独立开发和维护，无法充分复用相同业务逻辑的代码。微前端可能是目前解决这类问题的最佳方案。

微前端将微服务的理念应用于浏览器端，将 Web 应用由单一的单体应用转变为多个小型前端应用聚合为一的应用。各个前端应用还可以独立运行、独立开发、独立部署。由此也能看出，微前端不是单纯的框架或者工具，是一套完整的体系。对于其价值，目前业界比较认可的观点有以下几个：

1. 无技术栈限制
2. 应用单独开发，解耦
3. 多应用整合，复用

而这三个特点，似乎能够解决当前租车B端系统的问题。结合现有工程的项目，我们对我们的需求进行分析，并确定了预期的收益

1. 拆分应用：按照业务拆分成不同的仓库进行维护，独立开发，独立维护
2. 加速体验：开发模块提速；上线部署提速
3. 侵入性低：改动尽可能小，允许渐进迁移
4. 学习成本低：保持现有开发模式，没有学习成本
5. 统一技术栈：约定统一使用React技术栈，渐进迁移到16.8以后的版本

针对微前端方案，社区已经有了总结和对比，我们决定采用“基座模式”来实现我们租车业务线的微前端方案。基座模式是由一个主应用和一系列业务子应用构成的系统，并由这个主应用来管理其他子应用，包括从子应用的生命周期管理到应用间的通信机制。作为系统的统一入口，负责将对应的请求指向对应的服务。子应用，则是负责各个子模块的业务实现。更多微前端相关的介绍可以去看看这些文章：

1. [What are Micro Frontends](https://micro-frontends.org/)
2. [Thinking in Microfrontend (微前端的那些事儿)](https://microfrontends.cn/)

按照预期，使用微前端方案之后，B端系统的架构也会发生响应的变化

![架构变化](./images/2.png)


基座模式的代表[single-spa](https://github.com/single-spa/single-spa), [qiankun](https://qiankun.umijs.org/zh/guide)亦是站在前者的肩膀之上诞生的国产的微前端实现库。

TODO:
1. single-spa的原理和使用
2. 如何接入项目
3. 不足之处，如何改进


参考

1. [Thinking in Microfrontend (微前端的那些事儿)](https://github.com/phodal/microfrontends#%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91%E5%BC%8F%E5%BE%AE%E5%89%8D%E7%AB%AF)








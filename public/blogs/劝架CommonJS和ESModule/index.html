<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="true"/><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC&amp;display=swap" rel="stylesheet"/><meta data-react-helmet="true" name="twitter:description" content="æ¬¢è¿æ¥åˆ°å¼ å°ä¼¦çš„ç½‘ç»œæ—¥å¿— 
		ä¸€ä¸ªè®°å½•ç”Ÿæ´»ï¼Œåˆ†äº«å¿ƒå¾—çš„åšå®¢"/><meta data-react-helmet="true" name="twitter:title" content="åŠæ¶CommonJSå’ŒESModule"/><meta data-react-helmet="true" name="twitter:creator" content="zhanglun1410"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:description" content="æ¬¢è¿æ¥åˆ°å¼ å°ä¼¦çš„ç½‘ç»œæ—¥å¿— 
		ä¸€ä¸ªè®°å½•ç”Ÿæ´»ï¼Œåˆ†äº«å¿ƒå¾—çš„åšå®¢"/><meta data-react-helmet="true" property="og:title" content="åŠæ¶CommonJSå’ŒESModule"/><meta data-react-helmet="true" name="description" content="æ¬¢è¿æ¥åˆ°å¼ å°ä¼¦çš„ç½‘ç»œæ—¥å¿— 
		ä¸€ä¸ªè®°å½•ç”Ÿæ´»ï¼Œåˆ†äº«å¿ƒå¾—çš„åšå®¢"/><meta name="generator" content="Gatsby 4.13.1"/><style data-href="/styles.7aa89aa35ece76996c80.css" data-identity="gatsby-global-css">.theme-1{--background-color:#fef6e4;--background-color-1:#f3d2c1;--background-color-2:#fffffe;--background-color-3:#f582ae;--button-color:#f582ae;--button-text-color:#001858;--card-backgroud-color:#f3d2c1;--card-background-color:#fef6e4;--card-background-color-1:#001858;--card-heading-color:#001858;--card-headline-color:#fffffe;--card-headline-color-1:#001858;--card-highlight-color:#f582ae;--card-paragraph-color:#172c66;--card-tag-background-color:#fef6e4;--card-tag-text-color:#001858;--form-button-color:#f582ae;--form-button-text-color:#001858;--form-input-color:#f3d2c1;--headline-color:#001858;--highlight-color:#fef6e4;--label-placeholder-color:#001858;--link-color:#f582ae;--links-color:#fef6e4;--main-color:#f3d2c1;--paragraph-color:#172c66;--secondary-color:#8bd3dd;--stroke-color:#001858;--sub-headline-color:#172c66;--tertiary-color:#f582ae}.theme-2{--background-color:#55423d;--background-color-1:#271c19;--background-color-2:#ffc0ad;--background-color-3:#9656a1;--button-color:#ffc0ad;--button-text-color:#271c19;--card-backgroud-color:#fffffe;--card-background-color:#55423d;--card-background-color-1:#ffc0ad;--card-heading-color:#fffffe;--card-headline-color:#271c19;--card-highlight-color:#9656a1;--card-paragraph-color:#fff3ec;--card-paragraph-color-1:#271c19;--card-tag-background-color:#fffffe;--card-tag-text-color:#271c19;--form-button-color:#9656a1;--form-button-text-color:#fffffe;--form-input-color:#fffffe;--headline-color:#fffffe;--headline-color-1:#271c19;--highlight-color:#e78fb3;--label-placeholder-color:#271c19;--link-color:#9656a1;--links-color:#e78fb3;--main-color:#fff3ec;--paragraph-color:#fff3ec;--paragraph-color-1:#271c19;--secondary-color:#ffc0ad;--stroke-color:#140d0b;--sub-headline-color:#fff3ec;--tertiary-color:#9656a1}.theme-3{--background-color:#faeee7;--background-color-1:#fffffe;--background-color-2:#fffffe;--background-color-3:#33272a;--button-color:#ff8ba7;--button-text-color:#33272a;--card-backgroud-color:#faeee7;--card-background-color:#faeee7;--card-background-color-1:#fffffe;--card-heading-color:#33272a;--card-headline-color:#33272a;--card-highlight-color:#33272a;--card-paragraph-color:#594a4e;--card-tag-background-color:#ffc6c7;--card-tag-text-color:#33272a;--form-button-color:#ff8ba7;--form-button-text-color:#33272a;--form-input-color:#faeee7;--headline-color:#33272a;--highlight-color:#ff8ba7;--label-placeholder-color:#33272a;--link-color:#ff8ba7;--links-color:#ff8ba7;--main-color:#fffffe;--paragraph-color:#594a4e;--secondary-color:#ffc6c7;--stroke-color:#33272a;--sub-headline-color:#594a4e;--tertiary-color:#c3f0ca}.theme-4{--background-color:#fffffe;--background-color-1:#e3f6f5;--background-color-2:#e3f6f5;--background-color-3:#bae8e8;--button-color:#ffd803;--button-text-color:#272343;--card-backgroud-color:#fffffe;--card-background-color:#fffffe;--card-background-color-1:#272343;--card-heading-color:#272343;--card-headline-color:#fffffe;--card-headline-color-1:#272343;--card-highlight-color:#bae8e8;--card-paragraph-color:#2d334a;--card-tag-background-color:#bae8e8;--card-tag-text-color:#272343;--form-button-color:#272343;--form-button-text-color:#fffffe;--form-input-color:#fffffe;--headline-color:#272343;--highlight-color:#ffd803;--label--placeholder-color:#272343;--link-color:#272343;--links-color:#ffd803;--main-color:#fffffe;--paragraph-color:#2d334a;--secondary-color:#e3f6f5;--stroke-color:#272343;--sub-headline-color:#2d334a;--tertiary-color:#bae8e8}:root{--inline-code-font:monospace!important;--mono-font:"JetBrains Mono",monospace!important;--content-font-size:16px;--maxWidth-none:"none";--maxWidth-xs:999px;--maxWidth-sm:24rem;--maxWidth-md:28rem;--maxWidth-lg:32rem;--maxWidth-xl:36rem;--maxWidth-2xl:42rem;--maxWidth-3xl:48rem;--maxWidth-4xl:56rem;--maxWidth-5xl:64rem;--maxWidth-full:"100%";--maxWidth-wrapper:var(--maxWidth-2xl);--main-max-width:750px;--spacing-px:"1px";--spacing-0:0;--spacing-1:0.25rem;--spacing-2:0.5rem;--spacing-3:0.75rem;--spacing-4:1rem;--spacing-5:1.25rem;--spacing-6:1.5rem;--spacing-8:2rem;--spacing-10:2.5rem;--spacing-12:3rem;--spacing-16:4rem;--spacing-20:5rem;--spacing-24:6rem;--spacing-32:8rem;--main-spacing:100px;--font-family-sans:"Noto San SC",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-body:var(--font-family-sans);--font-heading:var(--font-family-sans);--fontWeight-normal:400;--fontWeight-medium:500;--fontWeight-semibold:600;--fontWeight-bold:700;--fontWeight-extrabold:800;--fontWeight-black:900;--fontSize-root:10px;--lineHeight-none:1;--lineHeight-tight:1.1;--lineHeight-normal:1.5;--lineHeight-relaxed:1.9;--fontSize-0:0.833rem;--fontSize-1:1rem;--fontSize-2:1.2rem;--fontSize-3:1.44rem;--fontSize-4:1.728rem;--fontSize-5:2.074rem;--fontSize-6:2.488rem;--fontSize-7:2.986rem;--color-primary:#4b5cc4;--color-text:#312520;--color-text-light:#4f5969;--color-heading:#312520;--color-heading-black:#161823;--color-accent:#d1dce5;--header-height:60px;--img-border-color:#313b44;--img-border-radius:8px;--background-color:#fafafa;--background-color-1:#f3d2c1;--background-color-2:#fffffe;--background-color-3:#f582ae;--button-color:#636363;--button-text-color:#fff;--card-backgroud-color:#f3d2c1;--card-background-color:#fef6e4;--card-background-color-1:#001858;--card-heading-color:#001858;--card-headline-color:#fffffe;--card-headline-color-1:#001858;--card-highlight-color:#f582ae;--card-paragraph-color:#172c66;--card-tag-background-color:#636363;--card-tag-text-color:#fff;--form-button-color:#f582ae;--form-button-text-color:#001858;--form-input-color:#f3d2c1;--headline-color:#001858;--highlight-color:#fef6e4;--label--placeholder-color:#001858;--link-color:#f582ae;--links-color:#fef6e4;--main-color:#f3d2c1;--paragraph-color:#172c66;--secondary-color:#8bd3dd;--stroke-color:#001858;--sub-headline-color:#172c66;--tertiary-color:#f582ae}*,:after,:before{box-sizing:border-box}html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-size:var(--fontSize-root);line-height:var(--lineHeight-normal)}body{color:var(--color-text);font-family:var(--font-body);font-size:var(--fontSize-1);margin:0}hr{background:var(--color-accent);border:0;height:1px}h1,h2,h3,h4,h5,h6{font-family:var(--font-heading);letter-spacing:-.025em;line-height:var(--lineHeight-normal);margin-bottom:var(--spacing-6);margin-top:var(--spacing-12)}h2,h3,h4,h5,h6{color:var(--color-heading);font-weight:var(--fontWeight-bold)}h1{color:var(--color-heading-black);font-size:var(--fontSize-6);font-weight:var(--fontWeight-black)}h2{font-size:var(--fontSize-5)}h3{font-size:var(--fontSize-4)}h4{font-size:var(--fontSize-3)}h5{font-size:var(--fontSize-2)}h6{font-size:var(--fontSize-1)}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}pre[class*=language-]{border-radius:0;white-space:pre-wrap}code[class*=language-]{font-family:Menlo,Monaco,Consolas,Courier New,monospace;font-size:14px;white-space:pre-wrap}p{--baseline-multiplier:0.179;--x-height-multiplier:0.35;font-size:1.6rem;line-height:var(--lineHeight-relaxed);margin:var(--spacing-0) var(--spacing-0) var(--spacing-8) var(--spacing-0);padding:var(--spacing-0)}ol,ul{margin-bottom:0;margin-top:0}ol li,ul li{padding-left:var(--spacing-0)}ol,ul{margin-bottom:1.5em}li>p{margin-bottom:calc(var(--spacing-8)/2)}li>ul{margin-left:var(--spacing-8);margin-top:calc(var(--spacing-8)/2)}blockquote{border-left:var(--spacing-1) solid var(--color-primary);color:var(--color-text-light);font-size:var(--fontSize-1);font-style:italic;margin-bottom:var(--spacing-8);padding:var(--spacing-5)}.quote{background:#f9f9f9;border-left:2px solid #636363;color:#636363;font-style:italic;margin:0 0 var(--spacing-16) 0;margin-bottom:1.5em;padding:1.5em;transition:.3s}blockquote>:last-child{margin-bottom:var(--spacing-0)}blockquote p{margin-bottom:var(--spacing-3)}blockquote li{margin:0}blockquote>ol,blockquote>ul{list-style-position:inside;padding-left:var(--spacing-4)}table{border:1px solid #e9e9e7;border-collapse:collapse;border-spacing:.25rem;font-size:14px;margin-bottom:var(--spacing-8);width:100%}table td,table th{border-bottom:1px solid #e9e9e7;padding:8px 10px}table thead tr th{background-color:#f7f6f3;text-align:left}p img{border:.5px solid var(--img-border-color);border-radius:var(--img-border-radius);max-width:100%}a{color:var(--color-primary)}a,a:focus,a:hover{text-decoration:none}.global-header{margin-bottom:var(--spacing-12)}.main{background-color:var(--background-color-2);margin:0 auto;max-width:var(--main-max-width);padding:30px var(--main-spacing) 30px;position:relative;width:90%;z-index:1}.main-heading{font-size:var(--fontSize-7);margin:0}.header-link-home{font-family:var(--font-heading);font-size:var(--fontSize-2);font-weight:var(--fontWeight-bold);text-decoration:none}.article-section{margin:0 auto;max-width:var(--main-max-width);position:relative;z-index:1}.article-cover{border:1px solid #f0f0f0;border-radius:var(--img-border-radius);height:380px;margin-bottom:60px;-o-object-fit:cover;object-fit:cover;width:100%}@media screen and (max-width:999px){.article-section,.pagination{max-width:100%;padding:0 20px}}.blog-post{border-bottom:1px solid #1d2b36;line-height:1.9;margin-bottom:10px;padding-bottom:60px;position:relative}.blog-post:before{left:0}.blog-post:after,.blog-post:before{background:#1d2b36;bottom:-2px;content:"";height:3px;position:absolute;width:3px}.blog-post:after{right:0}.blog-post header{border-top:1px solid #1d2b36;margin-top:50px;position:relative}.blog-post header:before{left:0}.blog-post header:after,.blog-post header:before{background:#1d2b36;content:"";height:3px;position:absolute;top:-2px;width:3px}.blog-post header:after{right:0}.blog-post header h1{font-size:36px;font-weight:var(--fontWeight-semibold);line-height:1.4;margin:60px 0}.blog-post header p{font-family:var(--font-heading);font-size:var(--fontSize-2)}.gatsby-highlight{margin-bottom:var(--spacing-8)}@media(max-width:42rem){blockquote{margin-left:var(--spacing-0);padding:var(--spacing-3)}ol,ul{padding-left:14px}}.pagination{margin:0 auto;max-width:var(--main-max-width);padding:50px 0}.link-underline,.pagination .next:hover,.pagination .prev:hover{text-decoration:underline}.link-underline{box-shadow:inset 0 0 0 0 var(--color-primary);margin:0 .25rem;padding:0 .25rem;transition:color .3s ease-in-out,box-shadow .3s ease-in-out}.link-underline:hover{box-shadow:inset 0 -40px 0 0 var(--color-primary);color:#fff}.hover-underline{position:relative}.hover-underline:after{background-color:var(--color-text);bottom:4px;content:"";height:2px;left:0;position:absolute;-webkit-transform:scaleX(0);transform:scaleX(0);-webkit-transform-origin:bottom right;transform-origin:bottom right;transition:-webkit-transform .25s ease-out;transition:transform .25s ease-out;transition:transform .25s ease-out,-webkit-transform .25s ease-out;width:100%}.hover-underline:hover:after{-webkit-transform:scaleX(1);transform:scaleX(1);-webkit-transform-origin:bottom left;transform-origin:bottom left}.page-title{color:var(--color-heading);font-size:var(--fontSize-6);margin-bottom:var(--spacing-5);padding-top:50px;text-align:center}:root{--bg-color:#d3dadf;--action-color:#000911}.archive-page{background-color:var(--bg-color);width:100%}.archive-page__container{margin:0 auto;padding-bottom:1px;padding-left:6.4rem;padding-right:6.4rem}.archive-page__post-title{display:flex;font-size:2.4rem;line-height:3.2rem;margin:0}.archive-page__post-excerpt{margin-bottom:3.2rem;position:relative}.archive-page__post-date{color:var(--text-color);font-size:1.4rem}.archive-section{margin-bottom:24vw;margin-top:10vw;position:relative}.archive-section__year{color:#c3cad0;color:var(--text-light-color,#c3cad0);font-size:36vw;font-weight:700;letter-spacing:-.07em;line-height:.2;margin-top:0;min-width:100%;pointer-events:none;position:absolute;text-align:center;-webkit-user-select:none;-ms-user-select:none;user-select:none}.archive-posts{grid-gap:3.2rem;display:grid;font-size:1.6rem;grid-template-columns:repeat(auto-fill,minmax(25.6rem,1fr));list-style-type:none;margin:0;padding:0;position:relative}.archive-posts a{color:var(--action-color);text-decoration:none}.archive-posts a:hover{text-decoration:underline}.archive-date{margin-right:20px}.category-page,.root{min-height:100vh}.category-page{background-color:#a4c9d8}.category-list{grid-gap:10rem;display:grid;font-size:1.8rem;grid-template-columns:repeat(4,1fr);justify-items:center}.category-img{background-color:rgba(0,0,0,.2);border-radius:100%;height:150px;margin-bottom:20px;padding:10px;transition:all .3s ease-in-out;width:150px}.category-img img{width:100%}.category-item{text-align:center;text-decoration:none}.category-item:hover{color:var(--color-text)}.category-item:hover .category-img{background-color:rgba(0,0,0,.35)}.category-page-header{display:grid;justify-items:center;padding:50px 0}.ham{-webkit-tap-highlight-color:transparent;color:#fff;cursor:pointer;transition:-webkit-transform .4s;transition:transform .4s;transition:transform .4s,-webkit-transform .4s;-webkit-user-select:none;-ms-user-select:none;user-select:none;width:54px}.hamRotate.active{-webkit-transform:rotate(45deg);transform:rotate(45deg)}.hamRotate180.active{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.line{fill:none;stroke:#333;stroke-width:3;stroke-linecap:round;transition:stroke-dasharray .4s,stroke-dashoffset .4s}.ham.active .line{stroke:#fff}.ham1 .top{stroke-dasharray:40 139}.ham1 .bottom{stroke-dasharray:40 180}.ham1.active .top{stroke-dashoffset:-98px}.ham1.active .bottom{stroke-dashoffset:-138px}.ham2 .bottom,.ham2 .top{stroke-dasharray:40 121}.ham2.active .bottom,.ham2.active .top{stroke-dashoffset:-102px}.ham3 .top{stroke-dasharray:40 130}.ham3 .middle{stroke-dasharray:40 140}.ham3 .bottom{stroke-dasharray:40 205}.ham3.active .top{stroke-dasharray:75 130;stroke-dashoffset:-63px}.ham3.active .middle{stroke-dashoffset:-102px}.ham3.active .bottom{stroke-dasharray:110 205;stroke-dashoffset:-86px}.ham4 .bottom,.ham4 .top{stroke-dasharray:40 121}.ham4.active .bottom,.ham4.active .top{stroke-dashoffset:-68px}.ham5 .bottom,.ham5 .top{stroke-dasharray:40 82}.ham5.active .bottom,.ham5.active .top{stroke-dasharray:14 82;stroke-dashoffset:-72px}.ham6 .top{stroke-dasharray:40 172}.ham6 .middle{stroke-dasharray:40 111}.ham6 .bottom{stroke-dasharray:40 172}.ham6.active .top{stroke-dashoffset:-132px}.ham6.active .middle{stroke-dashoffset:-71px}.ham6.active .bottom{stroke-dashoffset:-132px}.ham7 .top{stroke-dasharray:40 82}.ham7 .middle{stroke-dasharray:40 111}.ham7 .bottom{stroke-dasharray:40 161}.ham7.active .top{stroke-dasharray:17 82;stroke-dashoffset:-62px}.ham7.active .middle{stroke-dashoffset:23px}.ham7.active .bottom{stroke-dashoffset:-83px}.ham8 .top{stroke-dasharray:40 160}.ham8 .middle{stroke-dasharray:40 142;transition:-webkit-transform .4s;transition:transform .4s;transition:transform .4s,-webkit-transform .4s}.ham8 .bottom,.ham8 .middle{-webkit-transform-origin:50%;transform-origin:50%}.ham8 .bottom{stroke-dasharray:40 85;transition:stroke-dashoffset .4s,-webkit-transform .4s;transition:transform .4s,stroke-dashoffset .4s;transition:transform .4s,stroke-dashoffset .4s,-webkit-transform .4s}.ham8.active .top{stroke-dashoffset:-64px}.ham8.active .middle{stroke-dashoffset:-20px;-webkit-transform:rotate(90deg);transform:rotate(90deg)}.ham8.active .bottom{stroke-dashoffset:-64px}.index-module--menu--aNCkU{position:fixed;right:0;top:0;z-index:100}.index-module--menu-button--Iv9-4{position:fixed;right:0;top:0;z-index:102}.index-module--menu-main--dqZT6{background-color:#000;bottom:0;padding:100px;position:fixed;right:0;top:0;-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0);transition:all .4s;width:520px;z-index:101}.index-module--menu-main--dqZT6.index-module--open--LEqU-{-webkit-transform:translateZ(0);transform:translateZ(0)}.index-module--menu-title--n-nNm{color:#fff;font-weight:var(--fontWeight-semibold);margin-top:30px}.index-module--title-link--T5U9M{color:#fff;font-size:var(--fontSize-7)}.index-module--nav--nqC-X{align-items:flex-start;display:flex;flex-direction:column;margin-top:40px}.index-module--nav-item--8jKuC{color:#fff;font-size:22px;font-weight:500;height:var(--header-height);letter-spacing:1px;line-height:var(--header-height);margin:0;text-decoration:none;transition:all .3s}.index-module--nav-item--8jKuC:hover{-webkit-filter:invert(.5);filter:invert(.5);text-decoration:line-through}.index-module--nav-item--8jKuC.index-module--theme-1--jQ2fg:hover,.index-module--nav-item--8jKuC.index-module--theme-2--7nodg:hover,.index-module--nav-item--8jKuC.index-module--theme-3--pka-p:hover,.index-module--nav-item--8jKuC.index-module--theme-4--L3lP0:hover,.index-module--nav-item--8jKuC.index-module--theme-5--zFBiY:hover,.index-module--nav-item--8jKuC.index-module--theme-6--t9Ipa:hover{text-decoration:underline}.index-module--sidemenu-nav-item--3tmSg:hover{-webkit-transform:translate3d(14px,0,0);transform:translate3d(14px,0,0)}@media (max-width:1024px){.index-module--fullscreen-bubble-in-menu--fe12F .index-module--main-menu--owoSn{box-sizing:border-box;right:-100vw;transition:none!important;width:100%}.index-module--fullscreen-bubble-in-menu--fe12F .index-module--main-menu--owoSn:before{background:#edbb1c;border-radius:50%;content:"";height:0;position:fixed;right:0;top:0;transition:all .7s;width:0}.index-module--fullscreen-bubble-in-menu--fe12F .index-module--main-menu--owoSn.index-module--visible-menu--i0GXs:before{height:300vh;right:-150vh;top:-150vh;transition:all .7s;width:300vh}.index-module--fullscreen-bubble-in-menu--fe12F .index-module--ba-hamburger-menu--ykJDi .index-module--main-menu--owoSn{background-color:transparent!important}.index-module--fullscreen-bubble-in-menu--fe12F .index-module--ba-hamburger-menu--ykJDi .index-module--main-menu--owoSn>*{opacity:0;transition:.3s}.index-module--fullscreen-bubble-in-menu--fe12F .index-module--ba-hamburger-menu--ykJDi .index-module--main-menu--owoSn.index-module--visible-menu--i0GXs>*{opacity:1;transition:.3s .5s}}.index-module--container--MsrZ9{align-items:center;display:grid;justify-content:center;padding:3.75rem;text-align:center}.index-module--inner--Qy-hx{align-items:center;display:grid;gap:.75rem;justify-content:center;padding-bottom:5rem;padding-top:11.25rem;position:relative;width:100%}.index-module--title--k4zZ7{font-size:9.5rem;font-weight:600;margin:0}.index-module--subTitle--Sf0CJ{font-size:2rem;font-weight:600;margin:3.75rem 0 0}.index-module--main--husmE{align-items:center;display:grid;height:100vh;justify-content:center;margin:0 auto}.index-module--profile--01Kcu{grid-gap:40px;display:grid;grid-template-rows:1fr 1fr}.index-module--headline--7zfcQ{grid-gap:32px;align-items:center;display:grid;grid-template-columns:120px 1fr}.index-module--title--YQ4NF{color:var(--color-heading-black);font-size:7rem;margin:0;padding:0;text-align:center}.index-module--subTitle--aYKXU{font-size:2rem}.index-module--avatar--y2x3q{border-radius:50%;height:120px;width:120px}.index-module--menu--x9lUY{display:grid;font-size:1.8rem;grid-auto-flow:column;justify-items:center}.index-module--menuItem--3eiAT div{margin-left:.6rem;opacity:0}.index-module--menuItem--3eiAT:hover div{opacity:1}.article-list{list-style-type:none;margin:0;padding:0}.article-list-item{border-bottom:1px solid #e2e2e2}.article-list-item p{font-size:var(--content-font-size);margin-bottom:var(--spacing-0);text-align:center}.article-item-title{color:var(--color-heading-black);display:block;font-size:1.8rem;font-weight:var(--fontWeight-semibold);padding:1.4rem 0}.article-item-category{align-items:center;display:flex;font-size:1.4rem;font-weight:var(--fontWeight-normal);margin-bottom:.5vh}.article-item-category:before{background-color:currentColor;border-radius:1rem;content:"";display:block;height:.5rem;margin-right:.25rem;-webkit-transform:translateY(-1px);transform:translateY(-1px);width:.5rem}.article-list-item section{margin:50px 0 20px}.article-list-item footer{padding:40px 0;text-align:center}.article-list-item .read-more{background-color:var(--button-color);background-color:transparent;border:2px solid #636363;cursor:pointer;display:inline-block;font-size:13px;font-weight:var(--fontWeight-bold);height:50px;line-height:44px;outline:none;position:relative;text-decoration:none;transition:.25s ease-in-out;-ms-user-select:none;user-select:none;-webkit-user-select:none;width:190px}.article-list-item .read-more,.article-list-item .read-more:link{color:var(--button-text-color)}.article-list{margin:0 auto;max-width:var(--main-max-width);width:100%}.article-list-item .read-more:after{background-color:var(--button-color);content:"";height:100%;left:7px;position:absolute;top:7px;transition:.2s;width:100%;z-index:-1}.article-list-item .read-more:hover:after{left:0;top:0}.article-aside{-ms-overflow-style:none;height:100%;left:0;line-height:1.2;margin:60px 0;overflow-y:auto;padding:0 10px 0 20px;position:fixed;scrollbar-width:none;top:0;width:320px}.article-item-header{display:flex;justify-content:space-between}.article-list-item:hover .article-item__text{text-decoration:underline}.article-list-item:hover .article-item-header__arrow{opacity:1;-webkit-transform:scale(.8);transform:scale(.8)}.article-item-header__arrow{background-color:var(--color-heading-black);border-radius:50%;color:#fff;display:block;font-size:0;opacity:0;padding:4px;-webkit-transform:scale(.6);transform:scale(.6);transition:all .15s ease-in-out}.article-item-header__arrow svg{-webkit-transform:rotate(-135deg);transform:rotate(-135deg)}@media screen and (max-width:999px){.article-aside{position:static}}.article-aside__item{margin-bottom:var(--spacing-10)}.aside-toc{box-orient:vertical;box-direction:normal;display:flex;flex-direction:column;gap:6px;list-style-type:none;margin:6px 0 0;padding:0}.aside-toc li{margin:0;padding:2px 0}.aside-toc a{-webkit-margin-after:8px;color:grey;color:var(--theme-text-header);display:block;font-family:var(--font-mono);font-size:14px;font-size:1.4rem;font-weight:700;line-height:1.2;margin-block-end:8px}.aside-toc a:hover{text-decoration:underline}.aside-toc a.visible{color:#000}.aside-toc a:hover{color:#1d2b36}.aside-item__title{-webkit-margin-after:var(--spacing-6);color:#312520;font-size:1.4rem;line-height:1.6;margin-block-end:var(--spacing-6)}.aside-item__content .category-item,.aside-item__content time{font-size:14px;font-weight:var(--fontWeight-semibold);line-height:1.7}.aside-item__content .category-item{color:#000;display:block;text-align:left}.aside-item__content .tag-item{font-size:14px;font-weight:var(--fontWeight-semibold);line-height:1.7}.aside-item__content .tag-item:before{content:"#"}.anchor.before{margin-top:-24px;top:50%}blockquote{color:#999;font-weight:400}.title{font-size:calc(var(--content-font-size)*2.5)}.desc{font-size:calc(var(--content-font-size)*1.2)}.content{font-size:1.4rem}.content h2{border-top:1px solid #f0f0f0;font-size:25px;margin:80px 0 0;padding:40px 0 50px;position:relative}.content h2:before{left:0}.content h2:after,.content h2:before{background:#93a1b0;content:"";height:3px;position:absolute;top:-2px;width:3px}.content h2:after{right:0}.article-main{padding-top:var(--header-height)}.article-list li{height:100%;margin:0}.article-card{border-radius:.8rem;height:100%;margin:0 2vmin;overflow:hidden;padding-right:calc(54.54546vh - 9.20455rem - 7.90909vmin);position:relative;width:0}.article-card:hover .article-card__cover{-webkit-transform:scale(1.1);transform:scale(1.1)}.article-card__cover{overflow:hidden;-webkit-transform:scale(1);transform:scale(1);transition:-webkit-transform .4s cubic-bezier(.23,1,.32,1);transition:transform .4s cubic-bezier(.23,1,.32,1);transition:transform .4s cubic-bezier(.23,1,.32,1),-webkit-transform .4s cubic-bezier(.23,1,.32,1);will-change:transform}.article-card__cover,.article-card__cover:after{height:100%;left:0;position:absolute;top:0;width:100%}.article-card__cover:after{background-image:linear-gradient(180deg,transparent,rgba(0,0,0,.3) 67%);content:""}.article-card__cover img{height:100%;-o-object-fit:cover;object-fit:cover;width:100%}.article-card__body{color:#fff;display:flex;flex-direction:column;height:100%;justify-content:flex-end;left:0;padding:2.5vmin;position:absolute;top:0;width:100%}.article-card__title{color:#fff;font-size:3.4vmin;line-height:1.4;margin:3vmin 0}.article-card__title.hover-underline:after{background-color:#fff}.article-card__categories{margin-bottom:1vmin}.article-card__category{color:#fff;font-size:14px}.article-card__tag{display:block;font-size:14px;font-weight:var(--fontWeight-semibold);line-height:1.7}.article-card__tag:before{content:"#"}@media screen and (max-width:768px){.article-card{padding-right:calc(100vw - 4rem)}.article-card__cover img{max-height:none;max-width:100%}.article-card__title{font-size:8vmin;margin:4vmin 0}.article-card__body time,.article-card__category,.article-card__tag{font-size:4vmin}}.index-module--circle--E91Mj{border-color:var(--color-heading-black);border-radius:50%;border-style:solid;border-width:1px;display:inline-block;font-size:0;padding:4px;transition:all .15s ease-in-out}.index-module--dark--aAIf4{background-color:var(--color-heading-black);color:#fff}.index-module--light--x7OKG{background-color:#fff;color:var(--color-heading-black)}.index-module--light--x7OKG:hover{background-color:var(--color-heading-black);color:#fff}.index-module--pagination--iWu7S{align-items:center;display:flex;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;justify-content:space-between}.index-module--paginationItem--ZgXus{align-items:center;color:var(--color-heading-black);display:flex;justify-content:space-between}.index-module--paginationItem--ZgXus:hover{text-decoration:underline}.index-module--paginationItem--ZgXus:hover .index-module--paginationItemPrev--WtmXw:after{-webkit-transform:scaleX(1);transform:scaleX(1);-webkit-transform-origin:right;transform-origin:right}.index-module--paginationItem--ZgXus:hover .index-module--paginationItemNext--nbZSQ:after{-webkit-transform:scaleX(1);transform:scaleX(1);-webkit-transform-origin:left;transform-origin:left}.index-module--paginationItemNext--nbZSQ:after,.index-module--paginationItemPrev--WtmXw:after{background-color:currentColor;bottom:-2px;content:"";display:block;height:1px;left:0;position:absolute;-webkit-transform:scaleX(0);transform:scaleX(0);-webkit-transform-origin:right;transform-origin:right;transition:-webkit-transform .3s;transition:transform .3s;transition:transform .3s,-webkit-transform .3s;width:100%}.index-module--paginationItemPrev--WtmXw{font-size:1.4rem;line-height:1.031;margin-left:1rem;position:relative}.index-module--paginationItemNext--nbZSQ{font-size:1.4rem;line-height:1.031;margin-right:1rem;position:relative}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" title="å¼ å°ä¼¦çš„ç½‘ç»œæ—¥å¿—" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=25643e3cbe7be23b6c1bdad497608e85" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=25643e3cbe7be23b6c1bdad497608e85"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=25643e3cbe7be23b6c1bdad497608e85"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=25643e3cbe7be23b6c1bdad497608e85"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=25643e3cbe7be23b6c1bdad497608e85"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=25643e3cbe7be23b6c1bdad497608e85"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=25643e3cbe7be23b6c1bdad497608e85"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=25643e3cbe7be23b6c1bdad497608e85"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=25643e3cbe7be23b6c1bdad497608e85"/><title data-react-helmet="true">åŠæ¶CommonJSå’ŒESModule | å¼ å°ä¼¦çš„ç½‘ç»œæ—¥å¿—</title><link as="script" rel="preload" href="/webpack-runtime-adf1335a44885cfac931.js"/><link as="script" rel="preload" href="/framework-4b7b24ae718e4140a055.js"/><link as="script" rel="preload" href="/app-a99b6c2ab16d3879fc0c.js"/><link as="script" rel="preload" href="/commons-904b92826443395b7905.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-tsx-0fc1c644d51a3ff081f8.js"/><link as="fetch" rel="preload" href="/page-data/blogs/åŠæ¶CommonJSå’ŒESModule/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="global-wrapper" data-is-root-path="false"><div class="index-module--menu--aNCkU"><div class="index-module--menu-button--Iv9-4" role="button" aria-hidden="true"><svg class="ham hamRotate ham4 " viewBox="0 0 100 100" width="80"><path class="line top" d="m 70,33 h -40 c 0,0 -8.5,-0.149796 -8.5,8.5 0,8.649796 8.5,8.5 8.5,8.5 h 20 v -20"></path><path class="line middle" d="m 70,50 h -40"></path><path class="line bottom" d="m 30,67 h 40 c 0,0 8.5,0.149796 8.5,-8.5 0,-8.649796 -8.5,-8.5 -8.5,-8.5 h -20 v 20"></path></svg></div><div class="index-module--menu-main--dqZT6 "><div class="index-module--menu-title--n-nNm"><a class="index-module--title-link--T5U9M" href="/">å¼ å°ä¼¦çš„ç½‘ç»œæ—¥å¿—</a></div><nav class="index-module--nav--nqC-X"><a class="index-module--nav-item--8jKuC theme-1" href="/">é¦–é¡µ</a><a class="index-module--nav-item--8jKuC theme-2" href="/blogs">åšæ–‡</a><a class="index-module--nav-item--8jKuC theme-3" href="/categories">åˆ†ç±»</a><a class="index-module--nav-item--8jKuC theme-4" href="/archives">å½’æ¡£</a><a class="index-module--nav-item--8jKuC theme-5" href="/labs">å®éªŒå®¤</a><a class="index-module--nav-item--8jKuC theme-6" href="/about">å…³äºæˆ‘</a></nav></div></div><section><section class="article-section"><aside class="article-aside"><div class="article-aside__item"><div class="aside-item__title">Published</div><div class="aside-item__content"><time>2021-02-10</time></div></div><div class="article-aside__item"><div class="aside-item__title">Category</div><div class="aside-item__content"><a class="category-item" href="/categories/æŠ€æœ¯ç ”ç©¶">æŠ€æœ¯ç ”ç©¶</a></div></div><div class="article-aside__item"><div class="aside-item__title">Tags</div><div class="aside-item__content"><div class="tag-item">JavaScrtipt</div><div class="tag-item">Node.js</div></div></div><div class="article-aside__item"><div class="aside-item__title">Content</div><div class="aside-item__content"><div class="aside-toc"><a href="#CommonJS">CommonJS</a><a href="#ESModule">ESModule</a><a href="#ç®€å•è°ˆè°ˆäºŒè€…çš„å·®å¼‚">ç®€å•è°ˆè°ˆäºŒè€…çš„å·®å¼‚</a><a href="#åŠ ä¸Šä¸€æ¬¡ç¼–è¯‘">åŠ ä¸Šä¸€æ¬¡ç¼–è¯‘</a><a href="#CommonJSçš„æ‰§è¡Œè¿‡ç¨‹">CommonJSçš„æ‰§è¡Œè¿‡ç¨‹</a></div></div></div></aside><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">åŠæ¶CommonJSå’ŒESModule</h1></header><section itemProp="articleBody" class="content"><p class="para">ä»Šå¤©åœ¨å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°ä¸€ä¸ªæŠ¥é”™</p>
<deckgo-highlight-code language="bash" theme="one-dark" line-numbers="true"  >
          <code slot="code">Error [ERR_REQUIRE_ESM]: Must use import to load ES Module: /root/projects/build-tool/node_modules/ora/index.js
require() of ES modules is not supported.
require() of /root/projects/build-tool/node_modules/ora/index.js from /root/projects/build-tool/init.js is an ES module file as it is a .js file whose nearest parent package.json contains &quot;type&quot;: &quot;module&quot; which defines all .js files in that package scope as ES modules.
Instead rename index.js to end in .cjs, change the requiring code to use import(), or remove &quot;type&quot;: &quot;module&quot; from /root/projects/build-tool/node_modules/ora/package.json.</code>
        </deckgo-highlight-code>
<p class="para">ç³Ÿç³•ï¼Œé‡åˆ°CommonJSå’ŒESModuleä¸¤å…„å¼Ÿæ‰“æ¶äº†ğŸ˜¢</p>
<p class="para">é”™è¯¯ä¿¡æ¯ç®€å•ç¿»è¯‘ä¸€ä¸‹å°±æ˜¯: æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨<code>require()</code>åŠ è½½äº†ä¸€ä¸ªES Moduleï¼Œåè€…ä¸æ”¯æŒ<code>require()</code>ã€‚è¦ä¹ˆæˆ‘æŠŠè‡ªå·±çš„ JavaScript æ–‡ä»¶åç¼€æ”¹æˆ <code>.cjs</code> ï¼Œç„¶åç”¨ <code>import()</code> æ–¹æ³•åŠ è½½<code>Ora</code>ã€‚è¦ä¹ˆæˆ‘æŠŠOraçš„package.json ä¸­çš„ <code>type: module</code> å»æ‰</p>
<p class="para">æŒ‰ç…§ç¬¬ä¸€ç§æ–¹å¼ä¿®æ”¹ä¹‹åï¼Œä»£ç ç«‹é©¬å°±èƒ½è·‘èµ·æ¥ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•è¿˜æ˜¯æœ‰äº›é—®é¢˜ï¼š</p>
<ul>
<li>
<p class="para">é¡¹ç›®ä¸­å…¶ä»–æ–‡ä»¶ä¹Ÿæœ‰å¯èƒ½ä¼šå¼•å…¥åˆ°ESModuleæ¨¡å¼çš„ä¾èµ–ï¼Œæˆ‘éœ€è¦æ”¹æ›´å¤šæ–‡ä»¶çš„åç¼€</p>
</li>
<li>
<p class="para">æ–‡ä»¶åç¼€ä¿®æ”¹ä¹‹åï¼Œåœ¨å…¶è¢«å¯¼å…¥çš„åœ°æ–¹éœ€è¦åŒæ­¥ä¿®æ”¹</p>
</li>
<li>
<p class="para">ç›®å½•ä¸­<code>.js</code>å’Œ<code>.cjs</code>çš„æ–‡ä»¶æ··åœ¨ä¸€èµ·ï¼Œéƒ½æ˜¯JavaScriptå´æ€»æ˜¯ç»™å¼€å‘è€…ä¸€ç§æ··ä¹±çš„æ„Ÿè§‰</p>
</li>
<li>
<p class="para">åœ¨æ–‡ä»¶å†…éƒ¨ <code>require()</code> å’Œ <code>import()</code> å¹¶å­˜ï¼Œä¹Ÿå¸¦æ¥äº†æ··ä¹±</p>
</li>
</ul>
<p class="para">é‚£ä¹ˆæœ‰æ²¡æœ‰æ›´åŠ ä¼˜é›…çš„â€œåŠæ¶â€æ–¹æ³•å‘¢ï¼Ÿåœ¨å›ç­”è¿™ä¸ªé—®é¢˜å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è®¤è¯†è®¤è¯†è¿™ä¸¤å…„å¼Ÿã€‚</p>
<h3 class="heading" id="CommonJS" style="position:relative;"><a href="#CommonJS" aria-label="CommonJS permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CommonJS</h3>
<p class="para">åœ¨ESModuleè¯ç”Ÿä¹‹å‰ï¼ŒCommonJSä½œä¸ºNodeJSçš„æ¨¡å—ç³»ç»Ÿæ ‡å‡†ã€‚CommonJSæ˜¯NodeJSç¤¾åŒºå­µåŒ–å‡ºçš„æ¨¡å—æ ‡å‡†ï¼Œå®ç°äº†JavaScriptåœ¨æœåŠ¡ç«¯çš„æ¨¡å—åŒ–ã€‚åœ¨CommonJSä¸­ï¼Œæ¯ä¸€ä¸ªJavaScriptæ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨<code>module.exports</code> æˆ–è€… <code>exports</code>å¯¼å‡ºå˜é‡ï¼Œå‡½æ•°å’Œå¯¹è±¡ã€‚ä½¿ç”¨<code>require()</code>åŠ è½½æ¨¡å—ã€‚é»˜è®¤ä½¿ç”¨åŒæ­¥çš„æ–¹å¼åŠ è½½æ¨¡å—ã€‚</p>
<deckgo-highlight-code language="javascript" theme="one-dark" line-numbers="true"  >
          <code slot="code">// foo.js
module.exports = function() { 
  return &#39;Hello foo!&#39;;
}

// index.js
var foo = require(&#39;./foo&#39;);
console.log(foo()); // Hello foo!</code>
        </deckgo-highlight-code>
<p class="para">å…·ä½“çš„æ ‡å‡†å¯ä»¥å‚è€ƒ <a href="%5Bhttps://nodejs.org/dist/latest-v16.x/docs/api/modules.html%5D(https://nodejs.org/dist/latest-v16.x/docs/api/modules.html)" class="link-underline">NodeJS Modules</a></p>
<p class="para">CommonJSæ˜¯é¢å‘æœåŠ¡ç«¯çš„æ¨¡å—ç³»ç»Ÿï¼Œæµè§ˆå™¨ç«¯æ— æ³•ä½¿ç”¨ã€‚æ—©æœŸä½¿ç”¨AMDæ¨¡å—è§„èŒƒåœ¨æµè§ˆå™¨ç«¯å®ç°JavaScriptçš„æ¨¡å—åŒ–å¼€å‘å’ŒåŠ è½½ã€‚Webpackç­‰æ„å»ºå·¥å…·ï¼ŒæŒ‰ç…§NodeJSä¸­çš„CommonJSæ ‡å‡†ï¼Œå®ç°äº†ä¸€å¥—è§£æé€»è¾‘ï¼Œåœ¨æ‰“åŒ…é˜¶æ®µæ³¨å…¥å¯¹CommonJSæ¨¡å—çš„è§£æé€»è¾‘ï¼Œä½¿å¾—èƒ½å¤ŸåƒNodeJSä¸€æ ·åŠ è½½å’Œå¯¼å‡ºCommonJSã€‚è¿™ä½¿å¾—åœ¨å‰ç«¯å¼€å‘é˜¶æ®µå°±èƒ½ç”¨ä¸Šç›¸å¯¹æ¯”è¾ƒâ€œæ ‡å‡†åŒ–â€çš„æ¨¡å—åŒ–å¼€å‘ã€‚</p>
<h3 class="heading" id="ESModule" style="position:relative;"><a href="#ESModule" aria-label="ESModule permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ESModule</h3>
<p class="para">åœ¨ ES6 æå‡ºäº† ESModule ä½œä¸ºè¯­è¨€æ ‡å‡†ä»¥åï¼ŒJavaScriptè¿™é—¨è¯­è¨€ç»ˆäºæœ‰äº†è‡ªå·±çš„æ¨¡å—åŒ–æ–¹æ¡ˆäº†ï¼Œå…·ä½“çš„æ ‡å‡†å¯å‚è€ƒ<a href="%5Bhttps://tc39.es/ecma262/#sec-modules%5D(https://tc39.es/ecma262/#sec-modules)" class="link-underline">ECMAScript Modules</a>ã€‚</p>
<p class="para">è‡ª Node v8.5ä»¥æ¥ï¼Œå¼€å‘äººå‘˜å·²ç»èƒ½å¤Ÿä½¿ç”¨å‚æ•°<code>--experimental-modules</code> å¼€å¯å¯¹ESæ¨¡å—è§„èŒƒçš„æ”¯æŒã€‚ä»Node v12.4å¼€å§‹ï¼Œæ¨¡å—å¯ä»¥åœ¨.mjsæ–‡ä»¶ï¼ˆæˆ–åœ¨æŸäº›æƒ…å†µä¸‹çš„.jsæ–‡ä»¶ï¼‰ä¸­å®šä¹‰ï¼Œæˆ–è€…åœ¨Package.jsonä¸­å¢åŠ <code>type: modules</code>æ¥è¡¨ç¤ºå¯ç”¨ESModuleã€‚è€Œè‡ªNode v15.3å¼€å§‹ï¼Œå¯ä»¥ä¸ç”¨ experimental flag ä½¿ç”¨ESModuleã€‚</p>
<p class="para">ä¸CommonJSç›¸æ¯”å¯¹æœ€ä¸ºç›´è§‚çš„å·®åˆ«æ˜¯ï¼ŒESModule ä½¿ç”¨ import å¯¼å‡ºæ¨¡å—ï¼Œä½¿ç”¨ import åŠ è½½æ¨¡å—ã€‚æ¯”å¦‚è¯´ï¼š</p>
<deckgo-highlight-code language="javascript" theme="one-dark" line-numbers="true"  >
          <code slot="code">// foo.mjs
export function foo() { 
  return &#39;Hello foo!&#39;; 
}

// index.mjs
import { foo } from &#39;./foo.mjs&#39;;
console.log(foo()); // Hello foo!</code>
        </deckgo-highlight-code>
<p class="para">å½“ç„¶äºŒè€…çš„å·®åˆ«ä¸æ­¢å¦‚æ­¤ã€‚è€ŒäºŒè€…ä¹‹é—´çš„å·®å¼‚ä¹Ÿé—´æ¥å¼•å‘äº†æ–‡ç« å¼€ç¯‡æ‰€æåˆ°çš„é‚£ä¸ªé—®é¢˜ã€‚</p>
<h3 class="heading" id="ç®€å•è°ˆè°ˆäºŒè€…çš„å·®å¼‚" style="position:relative;"><a href="#%E7%AE%80%E5%8D%95%E8%B0%88%E8%B0%88%E4%BA%8C%E8%80%85%E7%9A%84%E5%B7%AE%E5%BC%82" aria-label="ç®€å•è°ˆè°ˆäºŒè€…çš„å·®å¼‚ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ç®€å•è°ˆè°ˆäºŒè€…çš„å·®å¼‚</h3>
<p class="para">åœ¨CommonJSä¸­ï¼Œrequire() æ˜¯åŒæ­¥çš„ã€‚å®ƒä¸ä¼šè¿”å›Promiseï¼Œä¹Ÿæ”¯æŒCallbackã€‚åŠ è½½åˆ°æ¨¡å—ä¹‹åä¼šç«‹åˆ»æ‰§è¡Œï¼Œè¿”å›æ¨¡å—è¿”å›çš„å¯¹è±¡ã€‚</p>
<p class="para">åœ¨ESMä¸­ï¼Œæ¨¡å—çš„æŸ¥æ‰¾æ¨¡å—åŠ è½½å™¨ã€‚æŸ¥æ‰¾é˜¶æ®µï¼Œè§£æJavaScriptæ–‡ä»¶æ‰¾åˆ°importå’Œexportçš„è°ƒç”¨ï¼Œä½†ä¸ä¼šæ‰§è¡Œimportçš„æ–‡ä»¶ã€‚åœ¨è§£æé˜¶æ®µï¼ŒESMåŠ è½½å™¨å¯ä»¥ç«‹å³æ£€æµ‹åˆ°å‘½åå¯¼å…¥ä¸­çš„é”™è¯¯ï¼Œå¹¶æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œè€Œä¸éœ€è¦å®é™…è¿è¡Œä¾èµ–çš„ä»£ç ã€‚è§£æé€šè¿‡ä¹‹åï¼ŒåŠ è½½å™¨å¼€å§‹å¼‚æ­¥ä¸‹è½½å’Œè§£æä½ å¯¼å…¥çš„JavaScriptï¼Œæ„é€ å‡ºä¾èµ–çš„module graphï¼Œæœ€åä»£ç å¼€å§‹æ‰§è¡Œã€‚ESæ¨¡å—åŠ è½½å™¨ä¿è¯äº†ï¼Œåœ¨ES Module æ„å»ºçš„ä¾èµ–å›¾ä¸­ï¼Œæ‰€æœ‰çš„è„šæœ¬éƒ½æ˜¯å¹¶è¡Œä¸‹è½½ï¼Œä½†æ˜¯é¡ºåºæ‰§è¡Œã€‚</p>
<p class="para">å¯ä»¥çœ‹åˆ°ï¼ŒäºŒè€…åœ¨æ¨¡å—åŠ è½½å’Œè§£æçš„è¿‡ç¨‹å·²ç»æœ‰å¾ˆå¤§çš„å·®åˆ«äº†ã€‚è¿™ä¹Ÿä½¿å¾—ä¸¤ç§æ–¹æ¡ˆä¸‹çš„æ¨¡å—æ— æ³•å¾ˆå¥½çš„äº’ç›¸å¯¼å…¥å’Œå¯¼å‡ºã€‚</p>
<p class="para">CommonJSä¸èƒ½ <code>require()</code> ESModuleçš„æœ€ç®€å•çš„åŸå› æ˜¯ï¼Œåè€…å…è®¸é¡¶å±‚çš„await ï¼Œä½†æ˜¯å‰è€…ä¸è¡Œã€‚</p>
<p class="para">åœ¨ESModuleä¸­ï¼Œä½ å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<deckgo-highlight-code language="javascript" theme="one-dark" line-numbers="true"  >
          <code slot="code">export const foo = await fetch(&#39;./data.json&#39;);</code>
        </deckgo-highlight-code>
<p class="para">ä½†æ˜¯åœ¨CommonJSä¸­ä½ å¾—è¿™ä¹ˆå†™ï¼š</p>
<deckgo-highlight-code language="javascript" theme="one-dark" line-numbers="true"  >
          <code slot="code">(async () =&gt; {
	const { foo } = await fetch(&#39;./foo.mjs&#39;);
});</code>
        </deckgo-highlight-code>
<p class="para">CommonJSå¯ä»¥å¯¼å…¥ ESMoudleï¼Œä½†æ˜¯ä¸å¤ªå¥½ç”¨ã€‚å¿…é¡»ä½¿ç”¨å¼‚æ­¥çš„åŠ¨æ€å¯¼å…¥</p>
<deckgo-highlight-code language="javascript" theme="one-dark" line-numbers="true"  >
          <code slot="code">(async () =&gt; {
    const {foo} = await import(&#39;./foo.mjs&#39;);
})();</code>
        </deckgo-highlight-code>
<p class="para">è™½ç„¶èƒ½ç”¨ï¼Œä½†æ˜¯åœ¨å¯¼å‡ºçš„æ—¶å€™ä½ å¾—å¯¼å‡ºPromiseï¼Œè¿™å¯èƒ½ä¼šè®©ä½¿ç”¨çš„äººæ„Ÿåˆ°å›°æƒ‘ã€‚</p>
<p class="para">ESModule ä¸èƒ½åœ¨å¯¼å…¥é˜¶æ®µç›´æ¥å¯¼å…¥CommonJSå…·åå¯¼å‡ºçš„å¯¹è±¡ï¼Œä½ å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<deckgo-highlight-code language="javascript" theme="one-dark" line-numbers="true"  >
          <code slot="code">import _ form &#39;./lodahs.cjs&#39;;</code>
        </deckgo-highlight-code>
<p class="para">ä½†æ˜¯ä¸èƒ½åœ¨å¯¼å…¥çš„åŒæ—¶è¿›è¡Œè§£æ„ï¼Œå› ä¸ºè§£æ„å‡ºæ¥çš„å¯¹è±¡æ˜¯<strong>å…·åå¯¼å‡ºçš„å¯¹è±¡</strong>ï¼Œä¸‹é¢çš„æ“ä½œä¼šæŠ¥é”™</p>
<deckgo-highlight-code language="javascript" theme="one-dark" line-numbers="true"  >
          <code slot="code">import { shuffle } from &#39;./lodash.cjs&#39;
// SyntaxError: The requested module &#39;./lodash.cjs&#39; does not provide an export named &#39;shuffle&#39;</code>
        </deckgo-highlight-code>
<p class="para">å› ä¸ºCommonJSåªæœ‰åœ¨æ‰§è¡Œçš„æ—¶å€™æ‰èƒ½è®¡ç®—å‡º<strong>å…·åå¯¼å‡ºçš„å¯¹è±¡</strong>ï¼Œè€ŒESModuleçš„æ¨¡å—è®¡ç®—å‘ç”Ÿåœ¨è§£æé˜¶æ®µã€‚æ‰€ä»¥ä½ åªèƒ½åœ¨å¯¼å…¥ä¹‹åå†è§£æ„ã€‚</p>
<deckgo-highlight-code language="javascript" theme="one-dark" line-numbers="true"  >
          <code slot="code">import _ from &#39;./lodash.cjs&#39;;
const {shuffle} = _;</code>
        </deckgo-highlight-code>
<p class="para">å¯¹å¯¼å‡ºå¯¹è±¡çš„å¤„ç†ä¸Šä¹Ÿæœ‰å·®å¼‚ï¼Œåœ¨CommonJSä¸­ï¼Œå¯¼å‡ºçš„å¯¹è±¡æ‰€æŒ‡å‘çš„å€¼æ˜¯å¯ä»¥ä¿®æ”¹çš„</p>
<deckgo-highlight-code language="javascript" theme="one-dark" line-numbers="true"  >
          <code slot="code">// b.js
exports.name = &#39;b&#39;;

// a.js
let { name } = require(&#39;b&#39;);
name = 123;</code>
        </deckgo-highlight-code>
<p class="para">è€Œä½¿ç”¨ESModuleè§„èŒƒçš„å¯¼å…¥è¢«å½“æˆå¸¸é‡å¤„ç†ï¼Œä¸å…è®¸ä¿®æ”¹ï¼š</p>
<deckgo-highlight-code language="javascript" theme="one-dark" line-numbers="true"  >
          <code slot="code">// a.js
export let num = 1
export const addNumber = ()=&gt;{
    num++
}

// b.js
import {  num , addNumber } from &#39;./a&#39;
num = 2

// æŠ¥é”™
num = 2
    ^
TypeError: Assignment to constant variable.</code>
        </deckgo-highlight-code>
<p class="para">äºŒè€…æœ‰å¦‚æ­¤å¤šçš„å·®å¼‚ï¼Œæœ€å¥½è¿˜æ˜¯ä¸è¦æ··ç”¨ã€‚ä½†æ˜¯åœ¨ESModuleå‡ºç°ä¹‹å‰ï¼Œæ‰€æœ‰çš„NPMåŒ…éƒ½æ˜¯CommonJSè§„èŒƒæ ‡å‡†ä¸‹å¼€å‘çš„ã€‚åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­éš¾å…ä¼šé‡åˆ°äºŒè€…æ··åˆå‡ºç°çš„åœºæ™¯ï¼Œä¹Ÿå°±æ˜¯æ–‡ç« å¼€å¤´é‡åˆ°çš„é”™è¯¯ã€‚</p>
<p class="para">ä½†æ˜¯å†æƒ³æƒ³ï¼Œåœ¨æ—¥å¸¸çš„å‰ç«¯å¼€å‘ä¸­ï¼Œä¼¼ä¹ç»å¸¸é‡åˆ°ä¸¤ç§å†™æ³•æ··ç”¨çš„æƒ…å†µï¼Œè€Œä¸”è¿˜æ²¡æœ‰é‡åˆ°ä»»ä½•ä¸Šè¿°æåˆ°çš„é—®é¢˜ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p class="para">é‚£æ˜¯å› ä¸ºç°åœ¨å‰ç«¯å¼€å‘åŸºæœ¬ä½¿ç”¨bundlerå·¥å…·æ‰“åŒ…è¿‡ï¼Œå…¶ä¸­ä½¿ç”¨äº†babelï¼Œå°†ES6çš„è¯­æ³•è¿›è¡Œäº†è½¬æ¢ï¼Œbundlerå·¥å…·æœ€åä»¥CommonJSçš„æ¨¡å¼è¾“å‡ºã€‚åœ¨äº§å‡ºç‰©ä¸­å¯ä»¥æ‰¾åˆ°<code>__esModule</code>å±æ€§ï¼Œå°†å¯¼å…¥çš„æ¨¡å—æ ‡è®°ä¸ºESModuleï¼Œæ–¹ä¾¿åç»­çš„å¤„ç†ã€‚</p>
<deckgo-highlight-code language="javascript" theme="one-dark" line-numbers="true"  >
          <code slot="code">// a.js
export default 1;

// main.js
import a from &#39;./a&#39;;

console.log(a);</code>
        </deckgo-highlight-code>
<p class="para">è½¬æ¢ä¹‹å</p>
<deckgo-highlight-code language="javascript" theme="one-dark" line-numbers="true"  >
          <code slot="code">// a.js
Object.defineProperty(exports, &quot;__esModule&quot;, {
  value: true
});
exports.default = 1;

// main.js
&#39;use strict&#39;;

var _a = require(&#39;./a&#39;);

var _a2 = _interopRequireDefault(_a);

function _interopRequireDefault(obj) { return obj &amp;&amp; obj.__esModule ? obj : { default: obj }; }

console.log(_a2.default);</code>
        </deckgo-highlight-code>
<p class="para">æ‰€ä»¥å›åˆ°æœ€åˆçš„é—®é¢˜ï¼Œæœ‰æ²¡æœ‰æ›´ä¼˜é›…ä¸€äº›å½“æ—¶æ¥è§£å†³æˆ‘çš„é—®é¢˜å‘¢ï¼Ÿæœ‰ï¼ŒåŠ ä¸Šbabelé…ç½®è¿›è¡Œä¸€æ¬¡ç¼–è¯‘ã€‚</p>
<h3 class="heading" id="åŠ ä¸Šä¸€æ¬¡ç¼–è¯‘" style="position:relative;"><a href="#%E5%8A%A0%E4%B8%8A%E4%B8%80%E6%AC%A1%E7%BC%96%E8%AF%91" aria-label="åŠ ä¸Šä¸€æ¬¡ç¼–è¯‘ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>åŠ ä¸Šä¸€æ¬¡ç¼–è¯‘</h3>
<p class="para">@babel/preset-env æ˜¯babelçš„ä¸€ä¸ªæ ¸å¿ƒæ’ä»¶ï¼Œç”¨æ¥è½¬æ¢ä»£ç ï¼Œè®©å¼€å‘è€…èƒ½ç”¨ä¸Šæ–°çš„ç‰¹æ€§ã€‚å…¶ä¸­çš„moduleså±æ€§å…è®¸æˆ‘ä»¬å°†ES Module è½¬æ¢æˆå¦ä¸€ä¸ªæ¨¡å—ç±»å‹ã€‚é»˜è®¤æ˜¯autoï¼Œ è®¾ç½®ä¸ºç›®æ ‡æ¨¡å—ç±»å‹ä¸ºCommonJSå³å¯ã€‚</p>
<p class="para">å‚è€ƒï¼š</p>
<ul>
<li><a href="https://redfin.engineering/node-modules-at-war-why-commonjs-and-es-modules-cant-get-along-9617135eeca1" class="link-underline">Node Modules at War: Why CommonJS and ES Modules Canâ€™t Get Along</a></li>
</ul>
<h3 class="heading" id="CommonJSçš„æ‰§è¡Œè¿‡ç¨‹" style="position:relative;"><a href="#CommonJS%E7%9A%84%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B" aria-label="CommonJSçš„æ‰§è¡Œè¿‡ç¨‹ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CommonJSçš„æ‰§è¡Œè¿‡ç¨‹</h3>
<p class="para">åœ¨CommonJSä¸­ï¼Œä½¿ç”¨require()åŠ è½½æ¨¡å—ï¼Œä½¿ç”¨module.exports å¯¼å‡ºæ¨¡å—ã€‚å’±ä»¬å…ˆæ¥çœ‹çœ‹require()ï¼Œè€ƒè™‘ä¸€ä¸‹ä»£ç ï¼š</p>
<deckgo-highlight-code language="javascript" theme="one-dark" line-numbers="true"  >
          <code slot="code">// main.js
const fs = require(&#39;fs&#39;);
const a = require(&#39;./a&#39;;
const b = require(&#39;../b/index.js&#39;);

module.exports = {
	a,
  b
}</code>
        </deckgo-highlight-code>
<p class="para">åœ¨main.js çœŸæ­£æ‰§è¡Œä¹‹å‰ï¼ŒNodeä¼šç”¨ä¸€ä¸ªModule Wrapper å°†ä»£ç åŒ…è£¹</p>
<deckgo-highlight-code language="javascript" theme="one-dark" line-numbers="true"  >
          <code slot="code">(function (exports, require, module, __filename, __dirname) {
	// main.js
	const fs = require(&#39;fs&#39;);
	const a = require(&#39;./a&#39;;
	const b = require(&#39;../b/index.js&#39;);
	
	module.exports = {
		a,
	  b
	}
});</code>
        </deckgo-highlight-code>
<p class="para">é€šè¿‡è¿™ç§æ–¹å¼å®ç°äº†ï¼š</p>
<ul>
<li>
<p class="para">å°†æ¨¡å—é¡¶éƒ¨çš„å˜é‡ä½œç”¨åŸŸï¼ˆæ¯”å¦‚ï¼š var, constæˆ–è€…let)é™åˆ¶åœ¨æ¨¡å—ä¸­ï¼Œè€Œä¸æ˜¯å…¨å±€å¯¹è±¡global</p>
</li>
<li>
<p class="para">æä¾›äº†ä¸€äº›æŒ‡å‘å½“å‰æ¨¡å—çš„ï¼Œçœ‹èµ·æ¥åƒæ˜¯å…¨å±€çš„å˜é‡</p>
<ul>
<li>
<p class="para">module å’Œ exports ï¼Œå¯ä»¥å¯¼å‡ºæ¨¡å—ä¸­çš„å€¼</p>
</li>
<li>
<p class="para">__filenameæ˜¯æ¨¡å—çš„ç»å¯¹è·¯å¾„ï¼Œ__dirnameæ˜¯æ¨¡å—æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹è·¯å¾„</p>
</li>
</ul>
</li>
</ul>
<p class="para">è§£å†³äº†æ¨¡å—ä½œç”¨åŸŸçš„é—®é¢˜ä¹‹åï¼Œå†æ¥çœ‹çœ‹require()çš„äº‹æƒ…ã€‚ä½¿ç”¨requireå¯ä»¥å¯¼å…¥NodeJSæ¨¡å—ï¼ŒJSONå’Œæœ¬åœ°æ–‡ä»¶ã€‚å‡è®¾æˆ‘ä»¬åœ¨ç›®å½•Yä¸­ä½¿ç”¨require(x)å¯¼å…¥Xï¼Œå…·ä½“çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<deckgo-highlight-code language="plaintext" theme="one-dark" line-numbers="true"  >
          <code slot="code">1. å¦‚æœ X æ˜¯æ ¸å¿ƒæ¨¡å—ï¼ˆæ¯”å¦‚ï¼š fs, path, http)
   a. è¿”å›æ ¸å¿ƒæ¨¡å—
   b. åœæ­¢
2. å¦‚æœ X ä»¥ &#39;/&#39; å¼€å¤´
   a. å°† Y è®¾ç½®ä¸ºç³»ç»Ÿæ ¹ç›®å½•
3. å¦‚æœ X ä»¥ &#39;./&#39; or &#39;/&#39; æˆ–è€… &#39;../&#39;å¼€å¤´ï¼ŒæŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤é¡ºåºæ‰§è¡Œ
   a. æ‰§è¡Œ LOAD_AS_FILE(Y + X)
   b. æ‰§è¡Œ LOAD_AS_DIRECTORY(Y + X)
   c. æŠ›é”™ &quot;not found&quot;
4. å¦‚æœ X ä»¥ &#39;#&#39; å¼€å¤´
   a. æ‰§è¡Œ LOAD_PACKAGE_IMPORTS(X, dirname(Y))
5. æ‰§è¡Œ LOAD_PACKAGE_SELF(X, dirname(Y))
6. æ‰§è¡Œ LOAD_NODE_MODULES(X, dirname(Y))
7. æŠ›é”™ &quot;not found&quot;

LOAD_AS_FILE(X)
1. å¦‚æœ X æ˜¯ä¸€ä¸ªæ–‡ä»¶, ä»¥è¯¥æ–‡ä»¶çš„æ ¼å¼åŠ è½½ã€‚åœæ­¢
2. å¦‚æœ X.js æ˜¯ä¸€ä¸ªæ–‡ä»¶, ä»¥ JavaScript æ–‡æœ¬çš„å½¢å¼åŠ è½½è¯¥æ–‡ä»¶ã€‚åœæ­¢
3. å¦‚æœ X.json æ˜¯ä¸€ä¸ªæ–‡ä»¶, å°†å®ƒè§£æä¸ºä¸€ä¸ª JavaScript å¯¹è±¡ã€‚ åœæ­¢
4. å¦‚æœ X.node æ˜¯ä¸€ä¸ªæ–‡ä»¶, ä»¥äºŒè¿›åˆ¶æ’ä»¶çš„å½¢å¼åŠ è½½è¯¥æ–‡ä»¶ã€‚ åœæ­¢

LOAD_INDEX(X)
1. å¦‚æœ X/index.js æ˜¯ä¸€ä¸ªæ–‡ä»¶, ä»¥ JavaScript æ–‡æœ¬çš„å½¢å¼åŠ è½½è¯¥æ–‡ä»¶ã€‚ åœæ­¢
2. å¦‚æœ X/index.json æ˜¯ä¸€ä¸ªæ–‡ä»¶, å°†å®ƒè§£æä¸ºä¸€ä¸ª JavaScript å¯¹è±¡ã€‚åœæ­¢
3. å¦‚æœ X/index.node æ˜¯ä¸€ä¸ªæ–‡ä»¶, ä»¥äºŒè¿›åˆ¶æ’ä»¶çš„å½¢å¼åŠ è½½è¯¥æ–‡ä»¶ã€‚åœæ­¢

LOAD_AS_DIRECTORY(X)
1. å¦‚æœ X/package.json æ˜¯ä¸€ä¸ªæ–‡ä»¶,
   a. è§£æè¿™ä¸ªæ–‡ä»¶ï¼ŒæŸ¥æ‰¾ main å­—æ®µ
   b. å¦‚æœ main æ˜¯å¯ä¸º false çš„å€¼ï¼Œå‰å¾€ç¬¬äºŒæ­¥
   c. å¦åˆ™ åˆ›å»ºä¸€ä¸ªæ–°çš„è·¯å¾„ M = X + (json main field)
   d. LOAD_AS_FILE(M)
   e. LOAD_INDEX(M)
   f. æŠ›é”™ &quot;not found&quot;
2. LOAD_INDEX(X)

LOAD_NODE_MODULES(X, START)
1. ä»å½“å‰ç›®å½•å¼€å§‹ï¼Œå‘ä¸Šéå†æ‰¾åˆ°æ‰€æœ‰çš„â€œnode_modulesâ€ let DIRS = NODE_MODULES_PATHS(START)
2. éå†æ¯ä¸€ä¸ªç›®å½•ï¼Œä¾æ¬¡æ‰§è¡Œä¸‹é¢çš„æ­¥éª¤ï¼Œç›´åˆ°æœ€åæŠ›å‡º &quot;not found&quot;
   a. LOAD_PACKAGE_EXPORTS(X, DIR)
   b. LOAD_AS_FILE(DIR/X)
   c. LOAD_AS_DIRECTORY(DIR/X)

NODE_MODULES_PATHS(START)
1. let PARTS = path split(START)
2. let I = count of PARTS - 1
3. let DIRS = [GLOBAL_FOLDERS]
4. while I &gt;= 0,
   a. if PARTS[I] = &quot;node_modules&quot; CONTINUE
   b. DIR = path join(PARTS[0 .. I] + &quot;node_modules&quot;)
   c. DIRS = DIRS + DIR
   d. let I = I - 1
5. return DIRS

LOAD_PACKAGE_IMPORTS(X, DIR)
1. æ‰¾åˆ°ç¦»DIRæœ€è¿‘çš„ä½œç”¨åŸŸSCOPE
2. å¦‚æœæ²¡æœ‰æ‰¾åˆ°SCOPEï¼Œè¿”å›
3. å¦‚æœ SCOPE/package.json &quot;imports&quot; æ˜¯ null æˆ–è€… undefined, è¿”å›
4. 4. å¦‚æœ SCOPE/package.json çš„ &quot;imports&quot; ä¸ä¸ºç©ºï¼Œåˆ™æ£€æŸ¥ X å’Œ SCOPE å¯¹åº”çš„æ–‡ä»¶çš„è·¯å¾„ let MATCH = PACKAGE_IMPORTS_RESOLVE(X, pathToFileURL(SCOPE), [&quot;node&quot;, &quot;require&quot;]) ã€‚
5. RESOLVE_ESM_MATCH(MATCH).

LOAD_PACKAGE_EXPORTS(X, DIR)
1. Try to interpret X as a combination of NAME and SUBPATH where the name
   may have a @scope/ prefix and the subpath begins with a slash (`/`).
2. å¦‚æœ X does not match this pattern or DIR/NAME/package.json is not a file,
   return.
3. Parse DIR/NAME/package.json, and look for &quot;exports&quot; field.
4. If &quot;exports&quot; is null or undefined, return.
5. let MATCH = PACKAGE_EXPORTS_RESOLVE(pathToFileURL(DIR/NAME), &quot;.&quot; + SUBPATH,
   `package.json` &quot;exports&quot;, [&quot;node&quot;, &quot;require&quot;])defined in the ESM resolver.
6. RESOLVE_ESM_MATCH(MATCH)

LOAD_PACKAGE_SELF(X, DIR)
1. Find the closest package scope SCOPE to DIR.
2. If no scope was found, return.
3. If the SCOPE/package.json &quot;exports&quot; is null or undefined, return.
4. If the SCOPE/package.json &quot;name&quot; is not the first segment of X, return.
5. let MATCH = PACKAGE_EXPORTS_RESOLVE(pathToFileURL(SCOPE),
   &quot;.&quot; + X.slice(&quot;name&quot;.length), `package.json` &quot;exports&quot;, [&quot;node&quot;, &quot;require&quot;])
defined in the ESM resolver.
6. RESOLVE_ESM_MATCH(MATCH)

RESOLVE_ESM_MATCH(MATCH)
1. let { RESOLVED, EXACT } = MATCH
2. let RESOLVED_PATH = fileURLToPath(RESOLVED)
3. If EXACT is true,
   a. If the file at RESOLVED_PATH exists, load RESOLVED_PATH as its extension
      format. åœæ­¢
4. Otherwise, if EXACT is false,
   a. LOAD_AS_FILE(RESOLVED_PATH)
   b. LOAD_AS_DIRECTORY(RESOLVED_PATH)
5. THROW &quot;not found&quot;</code>
        </deckgo-highlight-code>
<blockquote class="quote">
<p class="para"><code>PACKAGE_IMPORTS_RESOLVE</code> çš„å®šä¹‰åœ¨ <a href="https://nodejs.org/docs/latest-v14.x/api/esm.html#esm_resolver_algorithm" class="link-underline">esm_resolver_algorithm</a>ï¼Œé‡Œé¢è¿˜æ‰§è¡Œäº†å…¶ä»–çš„ç®—æ³•é€»è¾‘ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œé˜…è¯»ã€‚åœ¨æ¨¡å—æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ‰¾åˆ°äº†çš„package.jsonä¸­æœ‰importå­—æ®µï¼Œä¾¿ä¼šæ‰§è¡Œ <code>PACKAGE_IMPORTS_RESOLVE</code> ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼š</p>
</blockquote>
<deckgo-highlight-code  theme="one-dark" line-numbers="true"  >
          <code slot="code">```javascript
resolvedMatch {
	resolved: String; // æ¨¡å—å¯¹åº”çš„è·¯å¾„
	exact: Boolean; // ç²¾ç¡®æŸ¥æ‰¾ or æ¨¡ç³ŠæŸ¥æ‰¾
}
```</code>
        </deckgo-highlight-code></section></article><div class="pagination"><div class="index-module--pagination--iWu7S"><a class="index-module--paginationItem--ZgXus" rel="prev" href="/blogs/2021-04-23-ParseInt()çš„è¿·å¹»è¡Œä¸º/"><div class="index-module--circle--E91Mj index-module--light--x7OKG"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" style="transform:rotate(90deg);width:14px;height:14px"><path stroke="currentColor" stroke-width="1.4" d="M12 3v17M19 13l-7 7-7-7"></path></svg></div> <span class="index-module--paginationItemPrev--WtmXw">ParseInt()çš„è¿·å¹»è¡Œä¸º</span></a><span></span><a class="index-module--paginationItem--ZgXus" rel="next" href="/blogs/2020-12-14-éšæœºçš„è”æƒ³/"><span class="index-module--paginationItemNext--nbZSQ">å…³äºJavaScriptçš„éšæœºæ•°</span> <div class="index-module--circle--E91Mj index-module--light--x7OKG"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" style="transform:rotate(-90deg);width:14px;height:14px"><path stroke="currentColor" stroke-width="1.4" d="M12 3v17M19 13l-7 7-7-7"></path></svg></div></a></div></div></section></section></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-50406624-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blogs/åŠæ¶CommonJSå’ŒESModule/";window.___webpackCompilationHash="136b2da2e8b1b23964e3";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-4f3032a41e5c476c8f46.js"],"app":["/app-a99b6c2ab16d3879fc0c.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-adf2066c282d2a1fad9e.js"],"component---src-pages-about-tsx":["/component---src-pages-about-tsx-7b09644532f5bd1dcc54.js"],"component---src-pages-archives-tsx":["/component---src-pages-archives-tsx-ddc2637e6d877197950e.js"],"component---src-pages-categories-tsx":["/component---src-pages-categories-tsx-b5a2e4d86066d30e963f.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-7e0f083acf9cb537d315.js"],"component---src-pages-labs-tsx":["/component---src-pages-labs-tsx-73eba9758ec10d8f2e57.js"],"component---src-templates-blog-list-tsx":["/component---src-templates-blog-list-tsx-7eb438f670f1bdf1603e.js"],"component---src-templates-blog-post-tsx":["/component---src-templates-blog-post-tsx-0fc1c644d51a3ff081f8.js"],"component---src-templates-categories-js":["/component---src-templates-categories-js-7fe7e84267b6c1ad1f7e.js"]};/*]]>*/</script><script src="/polyfill-4f3032a41e5c476c8f46.js" nomodule=""></script><script src="/component---src-templates-blog-post-tsx-0fc1c644d51a3ff081f8.js" async=""></script><script src="/commons-904b92826443395b7905.js" async=""></script><script src="/app-a99b6c2ab16d3879fc0c.js" async=""></script><script src="/framework-4b7b24ae718e4140a055.js" async=""></script><script src="/webpack-runtime-adf1335a44885cfac931.js" async=""></script></body></html>
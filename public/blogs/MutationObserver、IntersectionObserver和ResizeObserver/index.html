<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="true"/><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC&amp;display=swap" rel="stylesheet"/><meta data-react-helmet="true" name="twitter:description" content="欢迎来到张小伦的网络日志 
		一个记录生活，分享心得的博客"/><meta data-react-helmet="true" name="twitter:title" content="IntersectionObserver、MutationObserver和ResizeObserver"/><meta data-react-helmet="true" name="twitter:creator" content="zhanglun1410"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:description" content="欢迎来到张小伦的网络日志 
		一个记录生活，分享心得的博客"/><meta data-react-helmet="true" property="og:title" content="IntersectionObserver、MutationObserver和ResizeObserver"/><meta data-react-helmet="true" name="description" content="欢迎来到张小伦的网络日志 
		一个记录生活，分享心得的博客"/><meta name="generator" content="Gatsby 4.13.1"/><style data-href="/styles.7aa89aa35ece76996c80.css" data-identity="gatsby-global-css">.theme-1{--background-color:#fef6e4;--background-color-1:#f3d2c1;--background-color-2:#fffffe;--background-color-3:#f582ae;--button-color:#f582ae;--button-text-color:#001858;--card-backgroud-color:#f3d2c1;--card-background-color:#fef6e4;--card-background-color-1:#001858;--card-heading-color:#001858;--card-headline-color:#fffffe;--card-headline-color-1:#001858;--card-highlight-color:#f582ae;--card-paragraph-color:#172c66;--card-tag-background-color:#fef6e4;--card-tag-text-color:#001858;--form-button-color:#f582ae;--form-button-text-color:#001858;--form-input-color:#f3d2c1;--headline-color:#001858;--highlight-color:#fef6e4;--label-placeholder-color:#001858;--link-color:#f582ae;--links-color:#fef6e4;--main-color:#f3d2c1;--paragraph-color:#172c66;--secondary-color:#8bd3dd;--stroke-color:#001858;--sub-headline-color:#172c66;--tertiary-color:#f582ae}.theme-2{--background-color:#55423d;--background-color-1:#271c19;--background-color-2:#ffc0ad;--background-color-3:#9656a1;--button-color:#ffc0ad;--button-text-color:#271c19;--card-backgroud-color:#fffffe;--card-background-color:#55423d;--card-background-color-1:#ffc0ad;--card-heading-color:#fffffe;--card-headline-color:#271c19;--card-highlight-color:#9656a1;--card-paragraph-color:#fff3ec;--card-paragraph-color-1:#271c19;--card-tag-background-color:#fffffe;--card-tag-text-color:#271c19;--form-button-color:#9656a1;--form-button-text-color:#fffffe;--form-input-color:#fffffe;--headline-color:#fffffe;--headline-color-1:#271c19;--highlight-color:#e78fb3;--label-placeholder-color:#271c19;--link-color:#9656a1;--links-color:#e78fb3;--main-color:#fff3ec;--paragraph-color:#fff3ec;--paragraph-color-1:#271c19;--secondary-color:#ffc0ad;--stroke-color:#140d0b;--sub-headline-color:#fff3ec;--tertiary-color:#9656a1}.theme-3{--background-color:#faeee7;--background-color-1:#fffffe;--background-color-2:#fffffe;--background-color-3:#33272a;--button-color:#ff8ba7;--button-text-color:#33272a;--card-backgroud-color:#faeee7;--card-background-color:#faeee7;--card-background-color-1:#fffffe;--card-heading-color:#33272a;--card-headline-color:#33272a;--card-highlight-color:#33272a;--card-paragraph-color:#594a4e;--card-tag-background-color:#ffc6c7;--card-tag-text-color:#33272a;--form-button-color:#ff8ba7;--form-button-text-color:#33272a;--form-input-color:#faeee7;--headline-color:#33272a;--highlight-color:#ff8ba7;--label-placeholder-color:#33272a;--link-color:#ff8ba7;--links-color:#ff8ba7;--main-color:#fffffe;--paragraph-color:#594a4e;--secondary-color:#ffc6c7;--stroke-color:#33272a;--sub-headline-color:#594a4e;--tertiary-color:#c3f0ca}.theme-4{--background-color:#fffffe;--background-color-1:#e3f6f5;--background-color-2:#e3f6f5;--background-color-3:#bae8e8;--button-color:#ffd803;--button-text-color:#272343;--card-backgroud-color:#fffffe;--card-background-color:#fffffe;--card-background-color-1:#272343;--card-heading-color:#272343;--card-headline-color:#fffffe;--card-headline-color-1:#272343;--card-highlight-color:#bae8e8;--card-paragraph-color:#2d334a;--card-tag-background-color:#bae8e8;--card-tag-text-color:#272343;--form-button-color:#272343;--form-button-text-color:#fffffe;--form-input-color:#fffffe;--headline-color:#272343;--highlight-color:#ffd803;--label--placeholder-color:#272343;--link-color:#272343;--links-color:#ffd803;--main-color:#fffffe;--paragraph-color:#2d334a;--secondary-color:#e3f6f5;--stroke-color:#272343;--sub-headline-color:#2d334a;--tertiary-color:#bae8e8}:root{--inline-code-font:monospace!important;--mono-font:"JetBrains Mono",monospace!important;--content-font-size:16px;--maxWidth-none:"none";--maxWidth-xs:999px;--maxWidth-sm:24rem;--maxWidth-md:28rem;--maxWidth-lg:32rem;--maxWidth-xl:36rem;--maxWidth-2xl:42rem;--maxWidth-3xl:48rem;--maxWidth-4xl:56rem;--maxWidth-5xl:64rem;--maxWidth-full:"100%";--maxWidth-wrapper:var(--maxWidth-2xl);--main-max-width:750px;--spacing-px:"1px";--spacing-0:0;--spacing-1:0.25rem;--spacing-2:0.5rem;--spacing-3:0.75rem;--spacing-4:1rem;--spacing-5:1.25rem;--spacing-6:1.5rem;--spacing-8:2rem;--spacing-10:2.5rem;--spacing-12:3rem;--spacing-16:4rem;--spacing-20:5rem;--spacing-24:6rem;--spacing-32:8rem;--main-spacing:100px;--font-family-sans:"Noto San SC",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-body:var(--font-family-sans);--font-heading:var(--font-family-sans);--fontWeight-normal:400;--fontWeight-medium:500;--fontWeight-semibold:600;--fontWeight-bold:700;--fontWeight-extrabold:800;--fontWeight-black:900;--fontSize-root:10px;--lineHeight-none:1;--lineHeight-tight:1.1;--lineHeight-normal:1.5;--lineHeight-relaxed:1.9;--fontSize-0:0.833rem;--fontSize-1:1rem;--fontSize-2:1.2rem;--fontSize-3:1.44rem;--fontSize-4:1.728rem;--fontSize-5:2.074rem;--fontSize-6:2.488rem;--fontSize-7:2.986rem;--color-primary:#4b5cc4;--color-text:#312520;--color-text-light:#4f5969;--color-heading:#312520;--color-heading-black:#161823;--color-accent:#d1dce5;--header-height:60px;--img-border-color:#313b44;--img-border-radius:8px;--background-color:#fafafa;--background-color-1:#f3d2c1;--background-color-2:#fffffe;--background-color-3:#f582ae;--button-color:#636363;--button-text-color:#fff;--card-backgroud-color:#f3d2c1;--card-background-color:#fef6e4;--card-background-color-1:#001858;--card-heading-color:#001858;--card-headline-color:#fffffe;--card-headline-color-1:#001858;--card-highlight-color:#f582ae;--card-paragraph-color:#172c66;--card-tag-background-color:#636363;--card-tag-text-color:#fff;--form-button-color:#f582ae;--form-button-text-color:#001858;--form-input-color:#f3d2c1;--headline-color:#001858;--highlight-color:#fef6e4;--label--placeholder-color:#001858;--link-color:#f582ae;--links-color:#fef6e4;--main-color:#f3d2c1;--paragraph-color:#172c66;--secondary-color:#8bd3dd;--stroke-color:#001858;--sub-headline-color:#172c66;--tertiary-color:#f582ae}*,:after,:before{box-sizing:border-box}html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-size:var(--fontSize-root);line-height:var(--lineHeight-normal)}body{color:var(--color-text);font-family:var(--font-body);font-size:var(--fontSize-1);margin:0}hr{background:var(--color-accent);border:0;height:1px}h1,h2,h3,h4,h5,h6{font-family:var(--font-heading);letter-spacing:-.025em;line-height:var(--lineHeight-normal);margin-bottom:var(--spacing-6);margin-top:var(--spacing-12)}h2,h3,h4,h5,h6{color:var(--color-heading);font-weight:var(--fontWeight-bold)}h1{color:var(--color-heading-black);font-size:var(--fontSize-6);font-weight:var(--fontWeight-black)}h2{font-size:var(--fontSize-5)}h3{font-size:var(--fontSize-4)}h4{font-size:var(--fontSize-3)}h5{font-size:var(--fontSize-2)}h6{font-size:var(--fontSize-1)}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}pre[class*=language-]{border-radius:0;white-space:pre-wrap}code[class*=language-]{font-family:Menlo,Monaco,Consolas,Courier New,monospace;font-size:14px;white-space:pre-wrap}p{--baseline-multiplier:0.179;--x-height-multiplier:0.35;font-size:1.6rem;line-height:var(--lineHeight-relaxed);margin:var(--spacing-0) var(--spacing-0) var(--spacing-8) var(--spacing-0);padding:var(--spacing-0)}ol,ul{margin-bottom:0;margin-top:0}ol li,ul li{padding-left:var(--spacing-0)}ol,ul{margin-bottom:1.5em}li>p{margin-bottom:calc(var(--spacing-8)/2)}li>ul{margin-left:var(--spacing-8);margin-top:calc(var(--spacing-8)/2)}blockquote{border-left:var(--spacing-1) solid var(--color-primary);color:var(--color-text-light);font-size:var(--fontSize-1);font-style:italic;margin-bottom:var(--spacing-8);padding:var(--spacing-5)}.quote{background:#f9f9f9;border-left:2px solid #636363;color:#636363;font-style:italic;margin:0 0 var(--spacing-16) 0;margin-bottom:1.5em;padding:1.5em;transition:.3s}blockquote>:last-child{margin-bottom:var(--spacing-0)}blockquote p{margin-bottom:var(--spacing-3)}blockquote li{margin:0}blockquote>ol,blockquote>ul{list-style-position:inside;padding-left:var(--spacing-4)}table{border:1px solid #e9e9e7;border-collapse:collapse;border-spacing:.25rem;font-size:14px;margin-bottom:var(--spacing-8);width:100%}table td,table th{border-bottom:1px solid #e9e9e7;padding:8px 10px}table thead tr th{background-color:#f7f6f3;text-align:left}p img{border:.5px solid var(--img-border-color);border-radius:var(--img-border-radius);max-width:100%}a{color:var(--color-primary)}a,a:focus,a:hover{text-decoration:none}.global-header{margin-bottom:var(--spacing-12)}.main{background-color:var(--background-color-2);margin:0 auto;max-width:var(--main-max-width);padding:30px var(--main-spacing) 30px;position:relative;width:90%;z-index:1}.main-heading{font-size:var(--fontSize-7);margin:0}.header-link-home{font-family:var(--font-heading);font-size:var(--fontSize-2);font-weight:var(--fontWeight-bold);text-decoration:none}.article-section{margin:0 auto;max-width:var(--main-max-width);position:relative;z-index:1}.article-cover{border:1px solid #f0f0f0;border-radius:var(--img-border-radius);height:380px;margin-bottom:60px;-o-object-fit:cover;object-fit:cover;width:100%}@media screen and (max-width:999px){.article-section,.pagination{max-width:100%;padding:0 20px}}.blog-post{border-bottom:1px solid #1d2b36;line-height:1.9;margin-bottom:10px;padding-bottom:60px;position:relative}.blog-post:before{left:0}.blog-post:after,.blog-post:before{background:#1d2b36;bottom:-2px;content:"";height:3px;position:absolute;width:3px}.blog-post:after{right:0}.blog-post header{border-top:1px solid #1d2b36;margin-top:50px;position:relative}.blog-post header:before{left:0}.blog-post header:after,.blog-post header:before{background:#1d2b36;content:"";height:3px;position:absolute;top:-2px;width:3px}.blog-post header:after{right:0}.blog-post header h1{font-size:36px;font-weight:var(--fontWeight-semibold);line-height:1.4;margin:60px 0}.blog-post header p{font-family:var(--font-heading);font-size:var(--fontSize-2)}.gatsby-highlight{margin-bottom:var(--spacing-8)}@media(max-width:42rem){blockquote{margin-left:var(--spacing-0);padding:var(--spacing-3)}ol,ul{padding-left:14px}}.pagination{margin:0 auto;max-width:var(--main-max-width);padding:50px 0}.link-underline,.pagination .next:hover,.pagination .prev:hover{text-decoration:underline}.link-underline{box-shadow:inset 0 0 0 0 var(--color-primary);margin:0 .25rem;padding:0 .25rem;transition:color .3s ease-in-out,box-shadow .3s ease-in-out}.link-underline:hover{box-shadow:inset 0 -40px 0 0 var(--color-primary);color:#fff}.hover-underline{position:relative}.hover-underline:after{background-color:var(--color-text);bottom:4px;content:"";height:2px;left:0;position:absolute;-webkit-transform:scaleX(0);transform:scaleX(0);-webkit-transform-origin:bottom right;transform-origin:bottom right;transition:-webkit-transform .25s ease-out;transition:transform .25s ease-out;transition:transform .25s ease-out,-webkit-transform .25s ease-out;width:100%}.hover-underline:hover:after{-webkit-transform:scaleX(1);transform:scaleX(1);-webkit-transform-origin:bottom left;transform-origin:bottom left}.page-title{color:var(--color-heading);font-size:var(--fontSize-6);margin-bottom:var(--spacing-5);padding-top:50px;text-align:center}:root{--bg-color:#d3dadf;--action-color:#000911}.archive-page{background-color:var(--bg-color);width:100%}.archive-page__container{margin:0 auto;padding-bottom:1px;padding-left:6.4rem;padding-right:6.4rem}.archive-page__post-title{display:flex;font-size:2.4rem;line-height:3.2rem;margin:0}.archive-page__post-excerpt{margin-bottom:3.2rem;position:relative}.archive-page__post-date{color:var(--text-color);font-size:1.4rem}.archive-section{margin-bottom:24vw;margin-top:10vw;position:relative}.archive-section__year{color:#c3cad0;color:var(--text-light-color,#c3cad0);font-size:36vw;font-weight:700;letter-spacing:-.07em;line-height:.2;margin-top:0;min-width:100%;pointer-events:none;position:absolute;text-align:center;-webkit-user-select:none;-ms-user-select:none;user-select:none}.archive-posts{grid-gap:3.2rem;display:grid;font-size:1.6rem;grid-template-columns:repeat(auto-fill,minmax(25.6rem,1fr));list-style-type:none;margin:0;padding:0;position:relative}.archive-posts a{color:var(--action-color);text-decoration:none}.archive-posts a:hover{text-decoration:underline}.archive-date{margin-right:20px}.category-page,.root{min-height:100vh}.category-page{background-color:#a4c9d8}.category-list{grid-gap:10rem;display:grid;font-size:1.8rem;grid-template-columns:repeat(4,1fr);justify-items:center}.category-img{background-color:rgba(0,0,0,.2);border-radius:100%;height:150px;margin-bottom:20px;padding:10px;transition:all .3s ease-in-out;width:150px}.category-img img{width:100%}.category-item{text-align:center;text-decoration:none}.category-item:hover{color:var(--color-text)}.category-item:hover .category-img{background-color:rgba(0,0,0,.35)}.category-page-header{display:grid;justify-items:center;padding:50px 0}.ham{-webkit-tap-highlight-color:transparent;color:#fff;cursor:pointer;transition:-webkit-transform .4s;transition:transform .4s;transition:transform .4s,-webkit-transform .4s;-webkit-user-select:none;-ms-user-select:none;user-select:none;width:54px}.hamRotate.active{-webkit-transform:rotate(45deg);transform:rotate(45deg)}.hamRotate180.active{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.line{fill:none;stroke:#333;stroke-width:3;stroke-linecap:round;transition:stroke-dasharray .4s,stroke-dashoffset .4s}.ham.active .line{stroke:#fff}.ham1 .top{stroke-dasharray:40 139}.ham1 .bottom{stroke-dasharray:40 180}.ham1.active .top{stroke-dashoffset:-98px}.ham1.active .bottom{stroke-dashoffset:-138px}.ham2 .bottom,.ham2 .top{stroke-dasharray:40 121}.ham2.active .bottom,.ham2.active .top{stroke-dashoffset:-102px}.ham3 .top{stroke-dasharray:40 130}.ham3 .middle{stroke-dasharray:40 140}.ham3 .bottom{stroke-dasharray:40 205}.ham3.active .top{stroke-dasharray:75 130;stroke-dashoffset:-63px}.ham3.active .middle{stroke-dashoffset:-102px}.ham3.active .bottom{stroke-dasharray:110 205;stroke-dashoffset:-86px}.ham4 .bottom,.ham4 .top{stroke-dasharray:40 121}.ham4.active .bottom,.ham4.active .top{stroke-dashoffset:-68px}.ham5 .bottom,.ham5 .top{stroke-dasharray:40 82}.ham5.active .bottom,.ham5.active .top{stroke-dasharray:14 82;stroke-dashoffset:-72px}.ham6 .top{stroke-dasharray:40 172}.ham6 .middle{stroke-dasharray:40 111}.ham6 .bottom{stroke-dasharray:40 172}.ham6.active .top{stroke-dashoffset:-132px}.ham6.active .middle{stroke-dashoffset:-71px}.ham6.active .bottom{stroke-dashoffset:-132px}.ham7 .top{stroke-dasharray:40 82}.ham7 .middle{stroke-dasharray:40 111}.ham7 .bottom{stroke-dasharray:40 161}.ham7.active .top{stroke-dasharray:17 82;stroke-dashoffset:-62px}.ham7.active .middle{stroke-dashoffset:23px}.ham7.active .bottom{stroke-dashoffset:-83px}.ham8 .top{stroke-dasharray:40 160}.ham8 .middle{stroke-dasharray:40 142;transition:-webkit-transform .4s;transition:transform .4s;transition:transform .4s,-webkit-transform .4s}.ham8 .bottom,.ham8 .middle{-webkit-transform-origin:50%;transform-origin:50%}.ham8 .bottom{stroke-dasharray:40 85;transition:stroke-dashoffset .4s,-webkit-transform .4s;transition:transform .4s,stroke-dashoffset .4s;transition:transform .4s,stroke-dashoffset .4s,-webkit-transform .4s}.ham8.active .top{stroke-dashoffset:-64px}.ham8.active .middle{stroke-dashoffset:-20px;-webkit-transform:rotate(90deg);transform:rotate(90deg)}.ham8.active .bottom{stroke-dashoffset:-64px}.index-module--menu--aNCkU{position:fixed;right:0;top:0;z-index:100}.index-module--menu-button--Iv9-4{position:fixed;right:0;top:0;z-index:102}.index-module--menu-main--dqZT6{background-color:#000;bottom:0;padding:100px;position:fixed;right:0;top:0;-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0);transition:all .4s;width:520px;z-index:101}.index-module--menu-main--dqZT6.index-module--open--LEqU-{-webkit-transform:translateZ(0);transform:translateZ(0)}.index-module--menu-title--n-nNm{color:#fff;font-weight:var(--fontWeight-semibold);margin-top:30px}.index-module--title-link--T5U9M{color:#fff;font-size:var(--fontSize-7)}.index-module--nav--nqC-X{align-items:flex-start;display:flex;flex-direction:column;margin-top:40px}.index-module--nav-item--8jKuC{color:#fff;font-size:22px;font-weight:500;height:var(--header-height);letter-spacing:1px;line-height:var(--header-height);margin:0;text-decoration:none;transition:all .3s}.index-module--nav-item--8jKuC:hover{-webkit-filter:invert(.5);filter:invert(.5);text-decoration:line-through}.index-module--nav-item--8jKuC.index-module--theme-1--jQ2fg:hover,.index-module--nav-item--8jKuC.index-module--theme-2--7nodg:hover,.index-module--nav-item--8jKuC.index-module--theme-3--pka-p:hover,.index-module--nav-item--8jKuC.index-module--theme-4--L3lP0:hover,.index-module--nav-item--8jKuC.index-module--theme-5--zFBiY:hover,.index-module--nav-item--8jKuC.index-module--theme-6--t9Ipa:hover{text-decoration:underline}.index-module--sidemenu-nav-item--3tmSg:hover{-webkit-transform:translate3d(14px,0,0);transform:translate3d(14px,0,0)}@media (max-width:1024px){.index-module--fullscreen-bubble-in-menu--fe12F .index-module--main-menu--owoSn{box-sizing:border-box;right:-100vw;transition:none!important;width:100%}.index-module--fullscreen-bubble-in-menu--fe12F .index-module--main-menu--owoSn:before{background:#edbb1c;border-radius:50%;content:"";height:0;position:fixed;right:0;top:0;transition:all .7s;width:0}.index-module--fullscreen-bubble-in-menu--fe12F .index-module--main-menu--owoSn.index-module--visible-menu--i0GXs:before{height:300vh;right:-150vh;top:-150vh;transition:all .7s;width:300vh}.index-module--fullscreen-bubble-in-menu--fe12F .index-module--ba-hamburger-menu--ykJDi .index-module--main-menu--owoSn{background-color:transparent!important}.index-module--fullscreen-bubble-in-menu--fe12F .index-module--ba-hamburger-menu--ykJDi .index-module--main-menu--owoSn>*{opacity:0;transition:.3s}.index-module--fullscreen-bubble-in-menu--fe12F .index-module--ba-hamburger-menu--ykJDi .index-module--main-menu--owoSn.index-module--visible-menu--i0GXs>*{opacity:1;transition:.3s .5s}}.index-module--container--MsrZ9{align-items:center;display:grid;justify-content:center;padding:3.75rem;text-align:center}.index-module--inner--Qy-hx{align-items:center;display:grid;gap:.75rem;justify-content:center;padding-bottom:5rem;padding-top:11.25rem;position:relative;width:100%}.index-module--title--k4zZ7{font-size:9.5rem;font-weight:600;margin:0}.index-module--subTitle--Sf0CJ{font-size:2rem;font-weight:600;margin:3.75rem 0 0}.index-module--main--husmE{align-items:center;display:grid;height:100vh;justify-content:center;margin:0 auto}.index-module--profile--01Kcu{grid-gap:40px;display:grid;grid-template-rows:1fr 1fr}.index-module--headline--7zfcQ{grid-gap:32px;align-items:center;display:grid;grid-template-columns:120px 1fr}.index-module--title--YQ4NF{color:var(--color-heading-black);font-size:7rem;margin:0;padding:0;text-align:center}.index-module--subTitle--aYKXU{font-size:2rem}.index-module--avatar--y2x3q{border-radius:50%;height:120px;width:120px}.index-module--menu--x9lUY{display:grid;font-size:1.8rem;grid-auto-flow:column;justify-items:center}.index-module--menuItem--3eiAT div{margin-left:.6rem;opacity:0}.index-module--menuItem--3eiAT:hover div{opacity:1}.article-list{list-style-type:none;margin:0;padding:0}.article-list-item{border-bottom:1px solid #e2e2e2}.article-list-item p{font-size:var(--content-font-size);margin-bottom:var(--spacing-0);text-align:center}.article-item-title{color:var(--color-heading-black);display:block;font-size:1.8rem;font-weight:var(--fontWeight-semibold);padding:1.4rem 0}.article-item-category{align-items:center;display:flex;font-size:1.4rem;font-weight:var(--fontWeight-normal);margin-bottom:.5vh}.article-item-category:before{background-color:currentColor;border-radius:1rem;content:"";display:block;height:.5rem;margin-right:.25rem;-webkit-transform:translateY(-1px);transform:translateY(-1px);width:.5rem}.article-list-item section{margin:50px 0 20px}.article-list-item footer{padding:40px 0;text-align:center}.article-list-item .read-more{background-color:var(--button-color);background-color:transparent;border:2px solid #636363;cursor:pointer;display:inline-block;font-size:13px;font-weight:var(--fontWeight-bold);height:50px;line-height:44px;outline:none;position:relative;text-decoration:none;transition:.25s ease-in-out;-ms-user-select:none;user-select:none;-webkit-user-select:none;width:190px}.article-list-item .read-more,.article-list-item .read-more:link{color:var(--button-text-color)}.article-list{margin:0 auto;max-width:var(--main-max-width);width:100%}.article-list-item .read-more:after{background-color:var(--button-color);content:"";height:100%;left:7px;position:absolute;top:7px;transition:.2s;width:100%;z-index:-1}.article-list-item .read-more:hover:after{left:0;top:0}.article-aside{-ms-overflow-style:none;height:100%;left:0;line-height:1.2;margin:60px 0;overflow-y:auto;padding:0 10px 0 20px;position:fixed;scrollbar-width:none;top:0;width:320px}.article-item-header{display:flex;justify-content:space-between}.article-list-item:hover .article-item__text{text-decoration:underline}.article-list-item:hover .article-item-header__arrow{opacity:1;-webkit-transform:scale(.8);transform:scale(.8)}.article-item-header__arrow{background-color:var(--color-heading-black);border-radius:50%;color:#fff;display:block;font-size:0;opacity:0;padding:4px;-webkit-transform:scale(.6);transform:scale(.6);transition:all .15s ease-in-out}.article-item-header__arrow svg{-webkit-transform:rotate(-135deg);transform:rotate(-135deg)}@media screen and (max-width:999px){.article-aside{position:static}}.article-aside__item{margin-bottom:var(--spacing-10)}.aside-toc{box-orient:vertical;box-direction:normal;display:flex;flex-direction:column;gap:6px;list-style-type:none;margin:6px 0 0;padding:0}.aside-toc li{margin:0;padding:2px 0}.aside-toc a{-webkit-margin-after:8px;color:grey;color:var(--theme-text-header);display:block;font-family:var(--font-mono);font-size:14px;font-size:1.4rem;font-weight:700;line-height:1.2;margin-block-end:8px}.aside-toc a:hover{text-decoration:underline}.aside-toc a.visible{color:#000}.aside-toc a:hover{color:#1d2b36}.aside-item__title{-webkit-margin-after:var(--spacing-6);color:#312520;font-size:1.4rem;line-height:1.6;margin-block-end:var(--spacing-6)}.aside-item__content .category-item,.aside-item__content time{font-size:14px;font-weight:var(--fontWeight-semibold);line-height:1.7}.aside-item__content .category-item{color:#000;display:block;text-align:left}.aside-item__content .tag-item{font-size:14px;font-weight:var(--fontWeight-semibold);line-height:1.7}.aside-item__content .tag-item:before{content:"#"}.anchor.before{margin-top:-24px;top:50%}blockquote{color:#999;font-weight:400}.title{font-size:calc(var(--content-font-size)*2.5)}.desc{font-size:calc(var(--content-font-size)*1.2)}.content{font-size:1.4rem}.content h2{border-top:1px solid #f0f0f0;font-size:25px;margin:80px 0 0;padding:40px 0 50px;position:relative}.content h2:before{left:0}.content h2:after,.content h2:before{background:#93a1b0;content:"";height:3px;position:absolute;top:-2px;width:3px}.content h2:after{right:0}.article-main{padding-top:var(--header-height)}.article-list li{height:100%;margin:0}.article-card{border-radius:.8rem;height:100%;margin:0 2vmin;overflow:hidden;padding-right:calc(54.54546vh - 9.20455rem - 7.90909vmin);position:relative;width:0}.article-card:hover .article-card__cover{-webkit-transform:scale(1.1);transform:scale(1.1)}.article-card__cover{overflow:hidden;-webkit-transform:scale(1);transform:scale(1);transition:-webkit-transform .4s cubic-bezier(.23,1,.32,1);transition:transform .4s cubic-bezier(.23,1,.32,1);transition:transform .4s cubic-bezier(.23,1,.32,1),-webkit-transform .4s cubic-bezier(.23,1,.32,1);will-change:transform}.article-card__cover,.article-card__cover:after{height:100%;left:0;position:absolute;top:0;width:100%}.article-card__cover:after{background-image:linear-gradient(180deg,transparent,rgba(0,0,0,.3) 67%);content:""}.article-card__cover img{height:100%;-o-object-fit:cover;object-fit:cover;width:100%}.article-card__body{color:#fff;display:flex;flex-direction:column;height:100%;justify-content:flex-end;left:0;padding:2.5vmin;position:absolute;top:0;width:100%}.article-card__title{color:#fff;font-size:3.4vmin;line-height:1.4;margin:3vmin 0}.article-card__title.hover-underline:after{background-color:#fff}.article-card__categories{margin-bottom:1vmin}.article-card__category{color:#fff;font-size:14px}.article-card__tag{display:block;font-size:14px;font-weight:var(--fontWeight-semibold);line-height:1.7}.article-card__tag:before{content:"#"}@media screen and (max-width:768px){.article-card{padding-right:calc(100vw - 4rem)}.article-card__cover img{max-height:none;max-width:100%}.article-card__title{font-size:8vmin;margin:4vmin 0}.article-card__body time,.article-card__category,.article-card__tag{font-size:4vmin}}.index-module--circle--E91Mj{border-color:var(--color-heading-black);border-radius:50%;border-style:solid;border-width:1px;display:inline-block;font-size:0;padding:4px;transition:all .15s ease-in-out}.index-module--dark--aAIf4{background-color:var(--color-heading-black);color:#fff}.index-module--light--x7OKG{background-color:#fff;color:var(--color-heading-black)}.index-module--light--x7OKG:hover{background-color:var(--color-heading-black);color:#fff}.index-module--pagination--iWu7S{align-items:center;display:flex;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;justify-content:space-between}.index-module--paginationItem--ZgXus{align-items:center;color:var(--color-heading-black);display:flex;justify-content:space-between}.index-module--paginationItem--ZgXus:hover{text-decoration:underline}.index-module--paginationItem--ZgXus:hover .index-module--paginationItemPrev--WtmXw:after{-webkit-transform:scaleX(1);transform:scaleX(1);-webkit-transform-origin:right;transform-origin:right}.index-module--paginationItem--ZgXus:hover .index-module--paginationItemNext--nbZSQ:after{-webkit-transform:scaleX(1);transform:scaleX(1);-webkit-transform-origin:left;transform-origin:left}.index-module--paginationItemNext--nbZSQ:after,.index-module--paginationItemPrev--WtmXw:after{background-color:currentColor;bottom:-2px;content:"";display:block;height:1px;left:0;position:absolute;-webkit-transform:scaleX(0);transform:scaleX(0);-webkit-transform-origin:right;transform-origin:right;transition:-webkit-transform .3s;transition:transform .3s;transition:transform .3s,-webkit-transform .3s;width:100%}.index-module--paginationItemPrev--WtmXw{font-size:1.4rem;line-height:1.031;margin-left:1rem;position:relative}.index-module--paginationItemNext--nbZSQ{font-size:1.4rem;line-height:1.031;margin-right:1rem;position:relative}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" title="张小伦的网络日志" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=25643e3cbe7be23b6c1bdad497608e85" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=25643e3cbe7be23b6c1bdad497608e85"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=25643e3cbe7be23b6c1bdad497608e85"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=25643e3cbe7be23b6c1bdad497608e85"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=25643e3cbe7be23b6c1bdad497608e85"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=25643e3cbe7be23b6c1bdad497608e85"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=25643e3cbe7be23b6c1bdad497608e85"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=25643e3cbe7be23b6c1bdad497608e85"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=25643e3cbe7be23b6c1bdad497608e85"/><title data-react-helmet="true">IntersectionObserver、MutationObserver和ResizeObserver | 张小伦的网络日志</title><link as="script" rel="preload" href="/webpack-runtime-adf1335a44885cfac931.js"/><link as="script" rel="preload" href="/framework-4b7b24ae718e4140a055.js"/><link as="script" rel="preload" href="/app-a99b6c2ab16d3879fc0c.js"/><link as="script" rel="preload" href="/commons-904b92826443395b7905.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-tsx-0fc1c644d51a3ff081f8.js"/><link as="fetch" rel="preload" href="/page-data/blogs/MutationObserver、IntersectionObserver和ResizeObserver/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="global-wrapper" data-is-root-path="false"><div class="index-module--menu--aNCkU"><div class="index-module--menu-button--Iv9-4" role="button" aria-hidden="true"><svg class="ham hamRotate ham4 " viewBox="0 0 100 100" width="80"><path class="line top" d="m 70,33 h -40 c 0,0 -8.5,-0.149796 -8.5,8.5 0,8.649796 8.5,8.5 8.5,8.5 h 20 v -20"></path><path class="line middle" d="m 70,50 h -40"></path><path class="line bottom" d="m 30,67 h 40 c 0,0 8.5,0.149796 8.5,-8.5 0,-8.649796 -8.5,-8.5 -8.5,-8.5 h -20 v 20"></path></svg></div><div class="index-module--menu-main--dqZT6 "><div class="index-module--menu-title--n-nNm"><a class="index-module--title-link--T5U9M" href="/">张小伦的网络日志</a></div><nav class="index-module--nav--nqC-X"><a class="index-module--nav-item--8jKuC theme-1" href="/">首页</a><a class="index-module--nav-item--8jKuC theme-2" href="/blogs">博文</a><a class="index-module--nav-item--8jKuC theme-3" href="/categories">分类</a><a class="index-module--nav-item--8jKuC theme-4" href="/archives">归档</a><a class="index-module--nav-item--8jKuC theme-5" href="/labs">实验室</a><a class="index-module--nav-item--8jKuC theme-6" href="/about">关于我</a></nav></div></div><section><section class="article-section"><aside class="article-aside"><div class="article-aside__item"><div class="aside-item__title">Published</div><div class="aside-item__content"><time>2019-07-13</time></div></div><div class="article-aside__item"><div class="aside-item__title">Content</div><div class="aside-item__content"><div class="aside-toc"><a href="#IntersectionObserver">IntersectionObserver</a><a href="#创建一个-IntersectionObserver">创建一个 IntersectionObserver</a><a href="#callback">callback</a><a href="#options">options</a><a href="#常用场景">常用场景</a><a href="#元素的可见性监听">元素的可见性监听</a><a href="#数据滚动">数据滚动</a><a href="#延迟加载">延迟加载</a><a href="#MutationObserver">MutationObserver</a><a href="#创建一个-MutationObserver">创建一个 MutationObserver</a><a href="#callback-1">callback</a><a href="#options-1">options</a><a href="#takeRecords">takeRecords()</a><a href="#Resize-Observer">Resize Observer</a><a href="#创建一个-ResizeObserver">创建一个 ResizeObserver</a><a href="#callback-2">callback</a><a href="#observetarget-options">observe(target, options)</a><a href="#常用场景-1">常用场景</a><a href="#iframe的大小变化">iframe的大小变化</a><a href="#聊天窗口自动滚动到底部">聊天窗口自动滚动到底部</a><a href="#三个Observer的对比">三个Observer的对比</a><a href="#参考">参考</a></div></div></div></aside><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">IntersectionObserver、MutationObserver和ResizeObserver</h1></header><section itemProp="articleBody" class="content"><p class="para">在之前的<a href="../%E4%BB%8Egetboundingclientrect%E5%88%B0intersection-observer/index.md" class="link-underline">从getboundingclientrect到intersection-observer</a>中提到了<code>Intersection Observer API</code>，今天趁热打铁，将现有的其他几个Observer API 一并整理，方便查阅</p>
<h2 class="heading subtitle heading" id="IntersectionObserver" style="position:relative;"><a href="#IntersectionObserver" aria-label="IntersectionObserver permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IntersectionObserver</h2>
<p class="para">字面翻译：交叉的观察者。即观察两个元素之间的交叉情况</p>
<p class="para">Web的传统位置计算机制依赖于显式查询DOM的状态。 其中一些会导致样式重新计算和布局(比如前文提到的<code>offsetHeight</code>, <code>offsetWidth</code> 和 <code>getBoundingClientRect()</code>)，并且经常需要JavaScript脚本需要轮询此信息，因此经常会让浏览器触发多余的重新计算和布局。在实际工作中，追踪或者判断DOM是否出现在客户端视图窗口中是一个很常见的操作。比如图片懒加载，滚动时元素进入的动画等等。一般来说可以通过监听滚动事件，使用<code>getBoundingClientRect()</code>来计算元素的位置。但正如前文所言，这存在性能问题。
<code>Intersection Observer API</code> 就是为这而<a href="https://github.com/w3c/IntersectionObserver/blob/master/explainer.md" class="link-underline">设计</a>的，显着降低其CPU，GPU和能源消耗。</p>
<h3 class="heading" id="创建一个-IntersectionObserver" style="position:relative;"><a href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-IntersectionObserver" aria-label="创建一个 IntersectionObserver permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建一个 IntersectionObserver</h3>
<p class="para">IntersectionObserver 的 API 非常简洁</p>
<deckgo-highlight-code language="js" theme="one-dark" line-numbers="true"  >
          <code slot="code">const observer = new IntersectionObserver(changes =&gt; {
  for (const change of changes) {
    console.log(change)
  }
}, {});

// 观察目标元素的可见性变化
observer.observe(target);

// 停止对一个元素的观察
observer.unobserve(target);

// 停止对所有目标元素可见性变化的观察
observer.disconnect();</code>
        </deckgo-highlight-code>
<h3 class="heading" id="callback" style="position:relative;"><a href="#callback" aria-label="callback permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>callback</h3>
<p class="para">回调接收 IntersectionObserverEntry 对象和观察者的列表：</p>
<deckgo-highlight-code language="ts" theme="one-dark" line-numbers="true"  >
          <code slot="code">const callback = function(entries: IntersectionObserverEntry[], observer: IntersectionObserver) { 
  entries.forEach(entry =&gt; {
    // Each entry describes an intersection change for one observed
    // target element:
    //   entry.boundingClientRect
    //   entry.intersectionRatio
    //   entry.intersectionRect
    //   entry.isIntersecting
    //   entry.rootBounds
    //   entry.target
    //   entry.time
  });
};</code>
        </deckgo-highlight-code>
<p class="para"><code>entries</code>是一个数组，和<code>threshold</code>对应。即使<code>threshold</code>输入的是一个数字，<code>entries</code>也会返回数组。下图是<code>IntersectionObserverEntry</code>的结构</p>
<p class="para"><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/2d9e4db5e60c060aa6af53a7319481c0/8b936/intersection-observer-api.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 94.14893617021278%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/UlEQVQ4y5WS607jMBCFef93QkICAYW2QuJWlTaEpElz8yUXO47j8awGCltWXbo7GkX+4eOc+c6cGGOSKIneomAVBOvXIAjykltrYRgQAI3Brtu1Uugc7tUJIva1YSvGoqaXRnLBWMU5t0LQ1ZcXvLjAyQTnc7y+xqcnTBLcbDCOMYpIDBZEVKexsRb/LAB6AgC9p6+15OWzSeyME3GdbwfTg0cP4D+KBF+1f9637R2UG1VLwP8sEo+Dbcq+r02e5tu0ShOuOm+0I5MAqDWh0pqsKkXktMa6RudIrIQWa87WgsfiLcyWi224KtqYoRC4WOBshjc3OJ3i7S3e3xOz6ZTgcf4+8+D4q8g25j2Ij9n87gBwxDZYJ6M6SwatYIfGoz94/QP7J7+duAgbIdxPOf0VmB3rQutm4Fzwindd5/seT0/x4QEfH2m8szMaeDYjBGX5TayEZkteRSII8iwpuu0Wq4oWaz7Huzu8usLzc3prMsHLS3x+/jJCYtMObMnSsGG8UVqptqOQvEfGMMtQSspGCMrpEDDgoajyAY6uyfe1260nC2VVWDf635cAdqj2+8CfARpmrPUjuNGNo3P+39dTN1qmbVt2ZRjzvGirihIqChr4uFhqvmnzjcpjKXndSNFI2QtBnH4WA4CWfS+GTrWMV3YcB2vHcQR/3PsvrBRMEro/rEYAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="intersection-observer-api.png"
        title="intersection-observer-api.png"
        src="/static/2d9e4db5e60c060aa6af53a7319481c0/1d69c/intersection-observer-api.png"
        srcset="/static/2d9e4db5e60c060aa6af53a7319481c0/4dcb9/intersection-observer-api.png 188w,
/static/2d9e4db5e60c060aa6af53a7319481c0/5ff7e/intersection-observer-api.png 375w,
/static/2d9e4db5e60c060aa6af53a7319481c0/1d69c/intersection-observer-api.png 750w,
/static/2d9e4db5e60c060aa6af53a7319481c0/78797/intersection-observer-api.png 1125w,
/static/2d9e4db5e60c060aa6af53a7319481c0/8b936/intersection-observer-api.png 1368w"
        sizes="(max-width: 750px) 100vw, 750px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p class="para">下图可以清晰的看出<code>intersectionRadio</code>的意义</p>
<p class="para"><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/9bc316a320eafbfc56bd4b26454cab96/cc155/intersectratio.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 98.93617021276596%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEr0lEQVQ4y42Ua08TaRiGR7rxi9mP/IT9B6u7RrPxEAJyKqX0RIEoSlRQQDCFCkqhWBtaSEgsXcgWbIusca3Qw5QeKEVoS2em7ZSKa4if/Eb8C2PfezODEk02m53kyv3cM5N7njfPOy9FURS1l07LSrkcxefzjtyrV2CWlgTW4yGsxwMJt/sIjwfMN7WE10uYxcVygabBv3+vFvOogt8vK21tUXsM43hz5w5iDQ1CvLmZxJubEVcqsdHSgg2VCnGFAgm1WvJiLaFUkmh1dTltNuPdp09fAoNBGR+NUnwm42AePwY7PCxwJhNhR0fBPnwIzmRCwWJBZnAQjNGIVG8v4hoNNlpbsaHXk1hTUzljtWL/8FBNOZ1OqrC6KttLJqliNuvY6u5GtLZWEL983EVT03FHMbn8iMbGI5qayPrly+XU+PhRh2JgKZ2WvcvnqRLPP82/eAF2YUHgXC7CuVz4TxYXRQg7P1/mg0GUPnxQSYF/ZzKy4u4uxXOcM+f1gnn6VGCdTsI6nfiOuTkwc3PHKuF0kuzsbLng84E/ONBSNpvtxIDFQtlmZn6JhELrL3t78Uyp/OzRaolHq4Vbq4WoHo0GHp0Oy3o9vK2tki63tWG5o4O4W1qI32xGIBZzUgCkwVjt9l8LmYwz/OAB1m7eFPx375K17m4EenoQ7O8HPTgI3/Xr8HV1IdDXh+ctLfAqFFhWKslSTQ2JmM1IF4sPqbNnz1aIgU/s9tNcOr0QuHcPL/V64fWNG8R37Rp8nZ14dfUqVru68Fd7O/5Uq/FS7Ewuh6euDt7GRrJ46RIJj40hVSw+omQy2U9SoNV6mi8U5nPRKLKrq0LW7ydZvx/HrK2BCQTABIOSsqEQWJoWIUwgQPZ2dpDc3n5EVVRU/PbjqVOnTCbTr3vF4vwblwtRq1WIT0+TuN2O2DfEp6ch3bPZJJX8zAyJWq0kvbKCrVRKCjx3UiarHDIaz+/x/O+vb9+Gu6pK8DY0EG99PUSWGxsl3LW10jKfKxRSvVRVhWc1NeSP8+dJ0GDADsdJgWfEJU/Z7T/nWXYhNjmJ8MCAEBkZIetDQ4gYjYiOjGBjfBzBvj6Ig0pMTMDf3S0OBCtqNfHU15N1kwnbLPuIqqysPCkGTlosZ/h8fsF36xZcFy8K7tpa4r5yBc9EamokdX+tq6ulWqKujrguXCCh4eGjQPESt87k5OTp/bdvHXwyiVw4LOQiEZKLRPA/IBxNk1IqhTc7Ow8og8FwQtPZSU1NTZ3bSiZ9sfl5BJ88+UzbbISemsK/EfrW22wkaLGQhNuNUCQyK/16Xzb3iZ3t7ZXYwAACCsXnkFZLQhoNROjWVoR0OgRFr9OB1usRVKulZ+J7Abm8vDE2hiTD3JUCmUjkh93NTWqf52dZ8fi6f1/IjY4SbngYnNGI3MgICuPj2O3vR7qnB+zQEDbFo0ulQkKrJfGGhnJmYgIHh4cKKXA/mZQdlErU22LRkTIYkFCphGRHB0m2tSHZ3o5NvV5S0YtBok9otUhoNEjodCQul5czZjP2P37USEPhsllZjuMohmEcTDyOLE0L2XCYZMNhscZ3+pX1dTBHkCxNl9nNTewyjPofpgrvWq7q9LwAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="intersectratio.png"
        title="intersectratio.png"
        src="/static/9bc316a320eafbfc56bd4b26454cab96/1d69c/intersectratio.png"
        srcset="/static/9bc316a320eafbfc56bd4b26454cab96/4dcb9/intersectratio.png 188w,
/static/9bc316a320eafbfc56bd4b26454cab96/5ff7e/intersectratio.png 375w,
/static/9bc316a320eafbfc56bd4b26454cab96/1d69c/intersectratio.png 750w,
/static/9bc316a320eafbfc56bd4b26454cab96/cc155/intersectratio.png 886w"
        sizes="(max-width: 750px) 100vw, 750px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p class="para"><code>IntersectionObservers</code> 是异步传递数据，回调函数中的代码将在主线程中运行。 规范中提到<code>IntersectionObserver</code>实现应使用<code>requestIdleCallback（）</code>。 这意味着对回调函数的执行是低优先级的，将在客户端空闲时间进行。 这是有意为之。</p>
<h3 class="heading" id="options" style="position:relative;"><a href="#options" aria-label="options permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>options</h3>
<p class="para">传递到IntersectionObserver()构造函数的 options 对象包含以下字段：</p>
<ul>
<li><strong>root</strong>
<ul>
<li>指定根(root)元素，用于检查目标的可见性。必须是目标元素的父级元素。</li>
<li>如果未指定或者为null，则默认为浏览器视窗。</li>
</ul>
</li>
<li><strong>rootMargin</strong>
<ul>
<li>根元素的外边距。类似于css中的 margin 属性，比如 “10px 20px 30px 40px” (top, right, bottom, left)。</li>
<li>如果有指定root参数，则rootMargin也可以使用百分比来取值。该属性值是用作root元素和target发生交集时候的计算交集的区域范围，使用该属性可以控制root元素每一边的收缩或者扩张。</li>
<li>默认值为0。</li>
</ul>
</li>
<li><strong>threshold</strong>
<ul>
<li>可以是一个数字也可以是一个数字数组。目标元素和根元素相交程度达到该值的时候IntersectionObserver注册的回调函数将会被执行。</li>
<li>如果你只是想要探测当target元素的在root元素中的可见性超过50%的时候，你可以指定该属性值为0.5。</li>
<li>如果你想要target元素在root元素的可见程度每多25%就执行一次回调，那么你可以指定一个数组[0, 0.25, 0.5, 0.75, 1]。</li>
<li>默认值是0(意味着只要有一个target像素出现在root元素中，回调函数将会被执行)。</li>
<li>该值为1.0含义是当target完全出现在root元素中时候 回调才会被执行。</li>
</ul>
</li>
</ul>
<p class="para"><strong>注意：</strong></p>
<ol>
<li>如果使用默认的<code>options</code>，目标元素部分进入视图窗口和完全离开视图窗口时，都会触发一次回调函数</li>
<li>如果你想同时观察多个元素，尽可能地在一个<code>IntersectionObserver</code>的实例上调用多次<code>observer</code>方法</li>
</ol>
<h3 class="heading" id="常用场景" style="position:relative;"><a href="#%E5%B8%B8%E7%94%A8%E5%9C%BA%E6%99%AF" aria-label="常用场景 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>常用场景</h3>
<h4 class="heading" id="元素的可见性监听" style="position:relative;"><a href="#%E5%85%83%E7%B4%A0%E7%9A%84%E5%8F%AF%E8%A7%81%E6%80%A7%E7%9B%91%E5%90%AC" aria-label="元素的可见性监听 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>元素的可见性监听</h4>
<deckgo-highlight-code language="html" theme="one-dark" line-numbers="true"  >
          <code slot="code">&lt;!-- 网页中嵌入的广告 --&gt;
&lt;iframe id=&quot;theAd&quot;&gt;&lt;/iframe&gt;
&lt;!-- 嵌入的脚本 --&gt;
&lt;script src=&quot;//cdn.example.com/ads.js&quot; async&gt;&lt;/script&gt;</code>
        </deckgo-highlight-code>
<deckgo-highlight-code language="js" theme="one-dark" line-numbers="true"  >
          <code slot="code">// ads.js

// 上报信息
function logImpressionToServer() { /* ... */ }

// 判断是否可见
function isVisible(boundingClientRect, intersectionRect) {
  return ((intersectionRect.width * intersectionRect.height) /
          (boundingClientRect.width * boundingClientRect.height) &gt;= 0.5);
}

function visibleTimerCallback(element, observer) {
  delete element.visibleTimeout;

  processChanges(observer.takeRecords());

  if (&#39;isVisible&#39; in element) {
    delete element.isVisible;
    logImpressionToServer();
    observer.unobserve(element);
  }
}

// 交叉时的回调函数
function processChanges(changes) {
  changes.forEach(function(changeRecord) {
    const element = changeRecord.target;
    element.isVisible = isVisible(changeRecord.boundingClientRect, changeRecord.intersectionRect);
    if (&#39;isVisible&#39; in element) {
      // 显示
      element.visibleTimeout = setTimeout(visibleTimerCallback, 1000, element, observer);
    } else {
      // 隐藏
      if (&#39;visibleTimeout&#39; in element) {
        clearTimeout(element.visibleTimeout);
        delete element.visibleTimeout;
      }
    }
  });
}

const observer = new IntersectionObserver(
  processChanges,
  { threshold: [0.5] } 
);

const theAd = document.querySelector(&#39;#theAd&#39;);
observer.observe(theAd);</code>
        </deckgo-highlight-code>
<p class="para">乍看之下好像需要编写更多复杂代码，但是对比传统的方式，这种方式有其优点</p>
<ol>
<li>无需监听scroll事件</li>
<li>没有频繁的同步计算布局，没有插件依赖，只使用了一个定时器来记录状态</li>
</ol>
<h4 class="heading" id="数据滚动" style="position:relative;"><a href="#%E6%95%B0%E6%8D%AE%E6%BB%9A%E5%8A%A8" aria-label="数据滚动 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据滚动</h4>
<p class="para">许多系统使用数据绑定列表来管理其视图内内容，可以通过回收DOM的方式保持内存和布局效。率。通常我们在渲染分页加载的列表数据的时候，为了避免滚动的时候出现卡顿感，会一次加载好几页的数据，但是实际上需要渲染的数据是总数据的子集。并且随着页码的加大，这个列表中的DOM会越来越多。我们可以在列表元素上使用 <code>IntersectionObserver</code>，来通知系统何时加载数据，何时回收DOM</p>
<deckgo-highlight-code language="html" theme="one-dark" line-numbers="true"  >
          <code slot="code">&lt;style&gt;
  .container {
    overflow: auto;
    width: 10em;
    height: 30em;
    position: relative;
  }

  .inner-scroll-surface {
    position: absolute;
    left: 0px;
    top: 0px;
    width: 100%;
    /* proportional to the # of expected items in the list */
    height: 1000px;
  }

  .scroll-item {
    position: absolute;
    height: 2em;
    left: 0px;
    right: 0px;
  }
&lt;/style&gt;

&lt;div class=&quot;container&quot;&gt;
  &lt;div class=&quot;inner-scroll-surface&quot;&gt;
    &lt;div class=&quot;scroll-item&quot; style=&quot;top: 0em;&quot;&gt;item 1&lt;/div&gt;
    &lt;div class=&quot;scroll-item&quot; style=&quot;top: 2em;&quot;&gt;item 2&lt;/div&gt;
    &lt;div class=&quot;scroll-item&quot; style=&quot;top: 4em;&quot;&gt;item 3&lt;/div&gt;
    &lt;!-- ... --&gt;
  &lt;/div&gt;
&lt;/div&gt;</code>
        </deckgo-highlight-code>
<p class="para">As the user moves the container, the children can be observed and as they cross the threshold of the scrollable area, a manager can recycle them and fill them with new data instead of needing to re-create the items from scratch.</p>
<p class="para">当用户滚动列表时，列表元素经过预先设定的阈值时，可以执行对应的处理逻辑</p>
<deckgo-highlight-code language="js" theme="one-dark" line-numbers="true"  >
          <code slot="code">function query(selector) {
  return Array.from(document.querySelectorAll(selector));
}

function init() {
  const opts = { 
    root: document.querySelector(&quot;.container&quot;),
    rootMargin: &quot;500px 0px&quot; 
  };
  const observer = new IntersectionObserver(manageItemPositionChanges, opts);

  query(&quot;.inner-scroll-surface &gt; .scroll-item&quot;)
    .forEach(function(scrollItem) {
      observer.observe(scrollItem);
    });
}

function manageItemPositionChanges(changes) {
  // ...
}</code>
        </deckgo-highlight-code>
<h4 class="heading" id="延迟加载" style="position:relative;"><a href="#%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD" aria-label="延迟加载 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>延迟加载</h4>
<p class="para">使用<code>IntersectionObserver</code>轻松实现懒加载</p>
<deckgo-highlight-code language="html" theme="one-dark" line-numbers="true"  >
          <code slot="code">&lt;div class=&quot;lazy-loaded&quot;&gt;
  &lt;template&gt;
    ...
  &lt;/template&gt;
&lt;/div&gt;</code>
        </deckgo-highlight-code>
<deckgo-highlight-code language="js" theme="one-dark" line-numbers="true"  >
          <code slot="code">function query(selector) {
  return Array.from(document.querySelectorAll(selector));
}

var observer = new IntersectionObserver(
  // 预先加载在视窗可见区域高度两倍以内的元素
  function(changes) {
    changes.forEach(function(change) {
      var container = change.target;
      var content = container.querySelector(&quot;template&quot;).content;
      container.appendChild(content);
      observer.unobserve(container);
    });
  },
  { rootMargin: &quot;200% 0%&quot; }
);

query(&quot;.lazy-loaded&quot;).forEach(function(item) {
  observer.observe(item);
});</code>
        </deckgo-highlight-code>
<h2 class="heading subtitle heading" id="MutationObserver" style="position:relative;"><a href="#MutationObserver" aria-label="MutationObserver permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MutationObserver</h2>
<p class="para">在web应用中，DOM操作是相当频繁的。在过去有一段时间，公认有效的一种方式是使用<code>Mutation Events</code>，不过这个特性在API的设计中有缺陷，为DOM添加 mutation 监听器反而会进一步降低修改DOM文档的性能（慢1.5 - 7倍）。而且 移除监听器不会减少性能的消耗。目前已经被废弃了。具体原因可以查看<a href="https://lists.w3.org/Archives/Public/public-webapps/2011JulSep/0779.html" class="link-underline">DOM Mutation Events Replacement: The Story So Far / Existing Points of Consensus</a>。简单来说以下三点原因：</p>
<ol>
<li>冗余。因为经常触发</li>
<li>慢。因为事件传播所以慢，同时还阻止了一些UA的自我优化</li>
<li>容易crash。</li>
</ol>
<p class="para">W3C提出了<code>MutationObserver</code>来代替<code>Mutation Events</code>。</p>
<h3 class="heading" id="创建一个-MutationObserver" style="position:relative;"><a href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-MutationObserver" aria-label="创建一个 MutationObserver permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建一个 MutationObserver</h3>
<p class="para"><code>MutationObserver</code> 可以监听DOM节点的变化，属性的变化，它最基本的语法如下：</p>
<deckgo-highlight-code language="ts" theme="one-dark" line-numbers="true"  >
          <code slot="code">const targetNode = document.querySelector(&quot;#someElement&quot;)
const observerOptions = {
  childList: true,  // 观察目标子节点的变化，是否有添加或者删除
  attributes: true, // 观察属性变动
  subtree: true     // 观察后代节点，默认为 false
}

const observer = new MutationObserver(callback)

function callback(records: mutationRecord[], observer: MutationObserver) {
  // ...
}
observer.observe(targetNode, observerOptions)

// ...

observer.disconnect() // 停止观察变动。 可以重用观察者。所有已经检测到但是尚未向观察者报告的变动都会被丢弃</code>
        </deckgo-highlight-code>
<p class="para">使用选择器来获取目标节点树。 <code>observerOptions</code> 中设定了观察者的选项，通过设定 childList 和 attributes 为 true 来获取所需信息，表示同时观察目标节点树的childList和attributes的变化。</p>
<h3 class="heading" id="callback-1" style="position:relative;"><a href="#callback-1" aria-label="callback 1 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>callback</h3>
<p class="para">每当被指定的节点或子树以及配置项有 DOM 变动时，callback会被异步调用。这个函数有两个参数：一个是描述所有被触发改动的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MutationRecord" class="link-underline"><code>MutationRecord</code></a> 对象数组，另一个是调用该函数的MutationObserver 对象。比如：</p>
<deckgo-highlight-code language="js" theme="one-dark" line-numbers="true"  >
          <code slot="code">function callback(mutationRecords, observer) {
  mutationRecords.forEach((mutation) =&gt; {
    switch(mutation.type) {
      case &#39;childList&#39;:
        /* 从树上添加或移除一个或更多的子节点；参见 mutation.addedNodes 与
           mutation.removedNodes */
        break;
      case &#39;attributes&#39;:
        /* mutation.target 中某节点的一个属性值被更改；该属性名称在 mutation.attributeName 中，
           该属性之前的值为 mutation.oldValue */
        break;
    }
  });
}</code>
        </deckgo-highlight-code>
<p class="para">:::info
callback 的函数签名和 <code>IntersectionObserver</code> 很相似。其实这些 Observer 的callback 的函数签名都是相似的
:::</p>
<p class="para">之后指定目标节点与记录选项，我们开始观察使用 <code>observe()</code> 指定的 DOM 节点。</p>
<p class="para">从现在开始直到调用 <code>disconnect()</code> ，每次以 targetNode 为根节点的 DOM 树添加或移除元素时，以及这些元素的任意属性改变时，<code>callback()</code> 都会被调用。</p>
<h3 class="heading" id="options-1" style="position:relative;"><a href="#options-1" aria-label="options 1 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>options</h3>
<p class="para"><code>observer(target, options)</code> 中的 <code>options</code> 是一个<code>MutationObserverInit</code>对象，描述了 MutationObserver 的配置。当调用 <code>observe()</code> 方法时，<code>childList</code>，<code>attributes</code> 或者 <code>characterData</code> 三个属性之中，至少有一个必须为 <code>true</code>，否则会抛出 <code>TypeError</code> 异常。</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>描述</th>
<th>是否可选</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>childList</td>
<td>设为 <code>true</code> 时，监视目标节点（如果 subtree 为 true，则包含子孙节点）添加或删除新的子节点。</td>
<td>可选</td>
<td>false</td>
</tr>
<tr>
<td>attributes</td>
<td>设为 <code>true</code> 时，观察受监视元素的属性值变更</td>
<td>可选</td>
<td>false</td>
</tr>
<tr>
<td>characterData</td>
<td>设为 <code>true</code> 时，监视指定目标节点或子节点树中节点所包含的字符数据的变化</td>
<td>可选</td>
<td>-</td>
</tr>
<tr>
<td>attributeFilter</td>
<td>要监视的特定属性名称的数组。如果未包含此属性，则对所有属性的更改都会触发变动通知</td>
<td>可选</td>
<td>-</td>
</tr>
<tr>
<td>attributeOldValue</td>
<td>当监视节点的属性改动时，将此属性设为 true 将记录任何有改动的属性的上一个值</td>
<td>可选</td>
<td>-</td>
</tr>
<tr>
<td>characterDataOldValue</td>
<td>设为 <code>true</code>时， 受监视节点的文本(text)发生更改时记录节点文本的先前值</td>
<td>可选</td>
<td>-</td>
</tr>
<tr>
<td>subtree</td>
<td>设为 <code>true</code> 时将监视范围扩展至目标节点整个节点树中的所有节点。MutationObserverInit 的其他值也会作用于此子树下的所有节点，而不仅仅只作用于目标节点。</td>
<td>可选</td>
<td>false</td>
</tr>
</tbody>
</table>
<h3 class="heading" id="takeRecords" style="position:relative;"><a href="#takeRecords" aria-label="takeRecords permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>takeRecords()</h3>
<p class="para">返回<strong>已检测到但尚未由观察者的回调函数处理的所有匹配DOM更改的列表，使变更队列保持为空</strong>。 最常见的使用场景是：在断开观察者之前立即获取所有未处理的更改记录，以便在停止观察者时可以处理任何未处理的更改。比如：</p>
<deckgo-highlight-code language="diff" theme="one-dark" line-numbers="true"  >
          <code slot="code">var targetNode = document.querySelector(&quot;#someElement&quot;);
var observerOptions = {
  childList: true,
  attributes: true
}

var observer = new MutationObserver(callback);
observer.observe(targetNode, observerOptions);

// 这里做了一些事情
// ...
+// 开始处理尚未结束的变更
+var mutations = observer.takeRecords();

+if (mutations) {
+  callback(mutations);
+}

observer.disconnect();</code>
        </deckgo-highlight-code>
<h2 class="heading subtitle heading" id="Resize-Observer" style="position:relative;"><a href="#Resize-Observer" aria-label="Resize Observer permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Resize Observer</h2>
<p class="para">这个API和其他的Observer类似，他可以用来观察元素大小的变化。onresize事件则只能有window来触发。大部分使用场景可能是在视窗大小发生变化，或者在移动设备上屏幕旋转时，监听页面元素尺寸的变化。在resizeObserver出现之前，只能使用 <code>window.resize</code> 事件来见视窗的大小变化。这种方式稍不留神就容易因为频繁触发resize事件而出现性能问题，从另一个层面来说，<code>resize</code>有点“浪费资源”，因为我们只能通过视窗的变化来计算目标元素的变化。</p>
<p class="para">现如今重Web端的SPA页面中，经常需要动态地添加或者删除DOM，频繁修改父元素的尺寸，这种case只有Resize Observer API能够帮我们。</p>
<p class="para">除了监听元素大小变化之外，还有几个有意思的特性：</p>
<ol>
<li>目标元素被插入或者从DOM中移除时会触发观察</li>
<li>目标元素display修改为<code>none</code>时会触发观察</li>
<li>非替换元素(<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Replaced_element" class="link-underline">link</a>)不会触发观察</li>
<li>tranforms不会触发观察</li>
<li>如果元素被渲染了时尺寸不是0，0，也会触发观察</li>
</ol>
<h3 class="heading" id="创建一个-ResizeObserver" style="position:relative;"><a href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-ResizeObserver" aria-label="创建一个 ResizeObserver permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建一个 ResizeObserver</h3>
<p class="para">与<code>intersectionObserver</code>和<code>MutationObserver</code>不同，ResizeObserver的构造函数只需要一个<code>callback</code>参数。但是监听和取消监听的方法类似</p>
<deckgo-highlight-code language="js" theme="one-dark" line-numbers="true"  >
          <code slot="code">function callbacl(entries) {
  // ...
}

const myObserver = new ResizeObserver(callback);
const someEl = document.querySelector(&#39;.some-element&#39;)
const someOtherEl = document.querySelector(&#39;.some-other-element&#39;)

myObserver.observe(someEl)
myObserver.observe(someOtherEl)</code>
        </deckgo-highlight-code>
<h3 class="heading" id="callback-2" style="position:relative;"><a href="#callback-2" aria-label="callback 2 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>callback</h3>
<p class="para">当观察的目标元素尺寸发生变化时触发回调函数，参数是一个<code>ResizeObserverEntry</code>对象数组。ResizeObserverEntry的接口如下</p>
<deckgo-highlight-code language="ts" theme="one-dark" line-numbers="true"  >
          <code slot="code">interface ResizeObserverEntry {
    readonly attribute Element target;
    readonly attribute DOMRectReadOnly contentRect;
    readonly attribute sequence&lt;ResizeObserverSize&gt; borderBoxSize;
    readonly attribute sequence&lt;ResizeObserverSize&gt; contentBoxSize;
    readonly attribute sequence&lt;ResizeObserverSize&gt; devicePixelContentBoxSize;
};</code>
        </deckgo-highlight-code>
<p class="para"><code>contentRect</code> 是 ResizeObserver API 孵化阶段时的产物，考虑到兼容性问题暂时保留，在未来可能会被废弃。</p>
<p class="para">当观察的目标元素尺寸发生变化时触发回调函数，参数是一个<code>ResizeObserverEntry</code>对象数组。<code>ResizeObserverEntry</code>对象包含两个属性：<code>contentRect</code>，<code>target</code>。<strong>target</strong>是被观察的目标对象。<strong>contentRect</strong>是<code>DOMRectReadOnly</code>的引用，包含 <code>width</code>, <code>height</code>, <code>x</code>, <code>y</code>, <code>top</code>, <code>right</code>, <code>bottom</code> 和 <code>left</code>。和<code>Element.getBoundingClientRect()</code>返回的数据不同，<code>contentRect</code>的<code>width</code>和<code>height</code>不包含<code>padding</code>，<code>contentRect.top</code>是元素的<code>padding-top</code>，<code>contentRect.left</code>是元素的<code>padding-left</code>。</p>
<p class="para">比如在元素调整大小时，其内部文本显示为尺寸大小，代码如下：</p>
<deckgo-highlight-code language="js" theme="one-dark" line-numbers="true"  >
          <code slot="code">const resizeObserver = new ResizeObserver(entries =&gt; {
  for (let entry of entries) {
    const boxEl = entry.target
    const dimensions = entry.contentRect

    boxEl.textContent = `${dimensions.width} x ${dimensions.height}`
  }
})

resizeObserver.observe(document.querySelector(&#39;.box:nth-child(2)&#39;))</code>
        </deckgo-highlight-code>
<h3 class="heading" id="observetarget-options" style="position:relative;"><a href="#observetarget-options" aria-label="observetarget options permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>observe(target, options)</h3>
<p class="para">ResizeObserver实例的observe方法还有第二个参数<code>options</code>。不过暂时处于草案阶段，浏览器还不支持第二个参数。</p>
<deckgo-highlight-code language="ts" theme="one-dark" line-numbers="true"  >
          <code slot="code">enum ResizeObserverBoxOptions {
  &quot;border-box&quot;, 
  &quot;content-box&quot;, 
  &quot;device-pixel-content-box&quot;
};</code>
        </deckgo-highlight-code>
<p class="para">可以控制Observer观察不同的CSS尺寸：</p>
<ul>
<li><strong>border-box</strong> : box-border。返回的尺寸包含padding和border</li>
<li><strong>content-box</strong> : content-boder。返回的尺寸不包含padding和border。默认值</li>
<li><strong>device-pixel-content-box</strong> : 返回的尺寸是未经缩放的，和设备像素相关的大小，一定是一个整数。</li>
</ul>
<h3 class="heading" id="常用场景-1" style="position:relative;"><a href="#%E5%B8%B8%E7%94%A8%E5%9C%BA%E6%99%AF-1" aria-label="常用场景 1 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>常用场景</h3>
<h4 class="heading" id="iframe的大小变化" style="position:relative;"><a href="#iframe%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%8F%98%E5%8C%96" aria-label="iframe的大小变化 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>iframe的大小变化</h4>
<p class="para">iframe 可以检测到大小的变化然后通知给父窗口</p>
<deckgo-highlight-code language="js" theme="one-dark" line-numbers="true"  >
          <code slot="code">let ro = new ResizeObserver(entries =&gt; {
  let idealSize = computeIdealSize();

  window.parent.postMessage({
    name: &quot;iframeResize&quot;,
    width: idealSize.width,
    height: idealSize.height
  }, &#39;*&#39;);
});

ro.observe(document.body);

// window上监听message事件
window.addEventListener(&quot;message&quot;, ev =&gt; {
  if (ev.data &amp;&amp; ev.data.name == &quot;iframeResize&quot;) {
    let iframe = findEventSourceIframe(ev.source);
    if (iframe) {
      iframe.style.width = ev.data.width + &quot;px&quot;;
      iframe.style.height = ev.data.height + &quot;px&quot;;
    }
  }
}, false);</code>
        </deckgo-highlight-code>
<h4 class="heading" id="聊天窗口自动滚动到底部" style="position:relative;"><a href="#%E8%81%8A%E5%A4%A9%E7%AA%97%E5%8F%A3%E8%87%AA%E5%8A%A8%E6%BB%9A%E5%8A%A8%E5%88%B0%E5%BA%95%E9%83%A8" aria-label="聊天窗口自动滚动到底部 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>聊天窗口自动滚动到底部</h4>
<p class="para">在聊天窗口中，最新的消息在底部。为了防止浏览器自动滚动到顶部，当收到新消息时需要将滚动的位置保持在最底部。当窗口自动变化的时候也要保证能够</p>
<deckgo-highlight-code language="css" theme="one-dark" line-numbers="true"  >
          <code slot="code">.chat {
  overflow: scroll;
}</code>
        </deckgo-highlight-code>
<deckgo-highlight-code language="html" theme="one-dark" line-numbers="true"  >
          <code slot="code">&lt;div class=&quot;chat&quot;&gt;  &lt;!-- chat has the scrollbar --&gt;
  &lt;div class=&quot;chat-text&quot;&gt; &lt;!-- chat-text contains chat text --&gt;
    &lt;div&gt;jack: hi &lt;/div&gt;
    &lt;div&gt;jill: hi &lt;/div&gt;
  &lt;/div&gt;
&lt;/div</code>
        </deckgo-highlight-code>
<deckgo-highlight-code language="js" theme="one-dark" line-numbers="true"  >
          <code slot="code">let ro = new ResizeObserver( entries =&gt; {
  for (let e of entries) {
    let chat = e.target.parentNode;
    chat.scrollTop = chat.scrollHeight - chat.clientHeight;
  }
});
ro.observe(document.querySelector(&#39;.chat-text&#39;))</code>
        </deckgo-highlight-code>
<p class="para">ResizeObserver 观察 <code>chat-text</code> 的大小，每次检测到变化时，将 <code>chat</code> 滚动到底部。新消息插入时也会触发到resize的检测。</p>
<p class="para">当用户向上滚动滚动条阅读历史消息时，新消息插入时自动滚动到底部，这会让用户丢掉之前阅读的信息。所以在这里引出一个新问题，如何保留用户的滚动位置？</p>
<p class="para">我们可以监听scroll事件来判断是否滚动，但是没有API可以区分是scroll事件是用户行为触发还是程序触发，这里hack的方式是使用flag来区分。代码如下：</p>
<deckgo-highlight-code language="js" theme="one-dark" line-numbers="true"  >
          <code slot="code">let ro = new ResizeObserver()

function initScrollPositionChat(chat) {
  let chatText = chat.firstElementChild

  chatText.resizeHandler = entry =&gt; {
    let chat = entry.target.parentNode;

    // 判断flag
    if (!chat.saveUserScroll) {
      chat.isResizeScrollEvent = true;
      chat.scrollTop = chat.scrollHeight - chat.clientHeight;
    }
  }

  ro.observe(chatText)

  chat.addEventListener(&#39;scroll&#39;, ev =&gt; {
    // Ignore scrolls generated by ResizeObserver
    if (chat.isResizeScrollEvent) {
      delete chat.isResizeScrollEvent;
      return;
    }

    // 保存用户的位置，除非已经滚动到底部了
    if (chat.scrollTop != chat.scrollHeight - chat.clientHeight) {
      chat.saveUserScroll = true;
    } else {
      chat.saveUserScroll = false;
    }
  });
}</code>
        </deckgo-highlight-code>
<p class="para">Resize Observer API目前还有很多特性处于草稿阶段，有兴趣的朋友可以前往<a href="https://www.w3.org/TR/resize-observer/#intro" class="link-underline">w3.org</a>查阅</p>
<h2 class="heading subtitle heading" id="三个Observer的对比" style="position:relative;"><a href="#%E4%B8%89%E4%B8%AAObserver%E7%9A%84%E5%AF%B9%E6%AF%94" aria-label="三个Observer的对比 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>三个Observer的对比</h2>
<p class="para"><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3fde7b6b445b8eb5a773e0f1e520c79b/8ad1b/observers.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 204.2553191489362%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAApCAYAAAA1bQl+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAE0ElEQVRIx41XaXfiOgzt//9178xWYIDsceJ9i0MLM/cdi6W0UKYfdByIuZaurmTxNE2veGjxBTG+0HM8PV9bSq+Xd3l9+ifg9P4HKe0vpriBGA1CBj/tefoK0BnM2QlSOkjpEbSHHhXqikFyc9n79NGDe2Hl0yc/E4jPZgImYeAGibHjCHb6AHgFdn5OVzalPSaXMIUZaT7QATlMySRYx+Hyu2vAeO1hDs3NsBdLcH6HmD00ESHMMMqDdQLeJeLyNinnsMKMKC04k+C9wNgJjL2AYBJxEHDKIWoPxzVYMxBg/n0Iu3uAOawJk/bHLF6HnT9rBzMocG4wdBx12WPsJWLYYbf7Q/J5xyF5mAFtJPCbpLgEyzUkt2hqhufnDaqiQ1X2WK4bcOHo4FtAExAzL6cEXWfZKk9cikGjrges1zWaeiDZWBPvcPgB8MjL2Y6gOQIrLPHaFB34oLDbHW5l8xHwTZdHC34C5wLa+Pe6/SD+fwJ662CUgDcCZdlACEO6PL+/1m/8Z8gUpsUUsw4DjFJQUiHG3U1ZfslD2hQCUjpgSgfMu7+wSkJwcQN4tgeA+fsJ0TlY48mCNXBqQFl1UOook4+g72qZ6tWcdJiFHicEw6GlhlYGXo8IugcfR3ibk7O/9fBNvLlSIoJkGNgA1g+wokUKBvMOmOc/FLKRAkVRUxu7152ejk3zlXhKMVISjpWSa9vDKYa+52BsxDAICM7JQ2f9RfRnaZGH87wHYwOapoUPFiGcQiEqEoLVsMZRIqqyQlM3aJuWDuG5FKWBVg5aO2oSFw/ntIePCSZn9QI4YwrxmF1tUFUtNpsSv9cFFsvfWK02WK7WKMsaWuljyJcsxVe4ML0BnvXl3en+GLH6XWG1rlBWPbZFh9W6xrbssNm26HrxluVItbq/C+ithVMjjBiwXBV4XqyxLWoILtG1md8RXTdAcHUFGO8DHgnfIQUHLRgWyy2Wqw2+/1jg2/cFlWIGzFQIoamJPAQ8dpyjArTkxNtyucZmUxBvfcfQNh3quqWkvd0pn3l4ucz3VClV3aPtBlRVByk0nAvQ2sJoB2fDFzy8Eq7UHh0TEMqRcWlpzfxfX1R3AacLhy8Q2kIYg1EptIzDhxlzOtwMAu+6zT1AynBM8CGRpJTxYFxhzEK2EfcGhAeAx80uJjApCWjgCtoFcGVQNgxKB/iwewf2AfAobBviaRg6ELgJHvN8oGpyfoJQBsZFcGlg3XTTF2881N7R5OD9DOUtBiUxCgNhHJRWqJse3SjBRk1ePgDM88oMYQ26QaAfBVrdw/hInmQutfeou5GynQ/Makgnvj+dvmhT2lMmc/ijVhDKYhAaDRtRtB1Z2WVPBb3LXSac+Hz6bJTLmaXu4wNJpR04VkWNn6stlpsK67JF2TIyriyUCZ9PsJfGEBLRkBPS9CO2VY+iZrT+92OFb7/W+PG8wWJdQWn/BcDsoYtwccK26fBzUeD78xpVO6JsBqy2Da2bsqPKeZtt7gHG10uljFaiZgN58nO5xaZsUbUDGsapeup+pIMfDu2XxjAdEKYZVcfwa1ng16qgUJ9XJTom0TKBtueX6nkY8tuN+IKqGyjc7OFyXaEfFVn2NIM+TMq9fwDZg9xdpPK0upDIskadT6SEDPg/96M+qYoH5U8AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Observer.png"
        title="Observer.png"
        src="/static/3fde7b6b445b8eb5a773e0f1e520c79b/1d69c/observers.png"
        srcset="/static/3fde7b6b445b8eb5a773e0f1e520c79b/4dcb9/observers.png 188w,
/static/3fde7b6b445b8eb5a773e0f1e520c79b/5ff7e/observers.png 375w,
/static/3fde7b6b445b8eb5a773e0f1e520c79b/1d69c/observers.png 750w,
/static/3fde7b6b445b8eb5a773e0f1e520c79b/78797/observers.png 1125w,
/static/3fde7b6b445b8eb5a773e0f1e520c79b/aa440/observers.png 1500w,
/static/3fde7b6b445b8eb5a773e0f1e520c79b/8ad1b/observers.png 2320w"
        sizes="(max-width: 750px) 100vw, 750px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h2 class="heading subtitle heading" id="参考" style="position:relative;"><a href="#%E5%8F%82%E8%80%83" aria-label="参考 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>参考</h2>
<ol>
<li><a href="https://developers.google.com/web/updates/2016/04/intersectionobserver" class="link-underline">IntersectionObserver’s Coming into View</a></li>
<li><a href="https://github.com/w3c/IntersectionObserver/blob/master/explainer.md" class="link-underline">IntersectionObserver explainer</a></li>
<li><a href="https://web.dev/resize-observer/" class="link-underline">ResizeObserver: it’s like document.onresize for elements</a></li>
</ol></section></article><div class="pagination"><div class="index-module--pagination--iWu7S"><a class="index-module--paginationItem--ZgXus" rel="prev" href="/blogs/再谈EventLoop/"><div class="index-module--circle--E91Mj index-module--light--x7OKG"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" style="transform:rotate(90deg);width:14px;height:14px"><path stroke="currentColor" stroke-width="1.4" d="M12 3v17M19 13l-7 7-7-7"></path></svg></div> <span class="index-module--paginationItemPrev--WtmXw">再谈EventLoop</span></a><span></span><a class="index-module--paginationItem--ZgXus" rel="next" href="/blogs/从getBoundingClientRect到Intersection Observer/"><span class="index-module--paginationItemNext--nbZSQ">从getBoundingClientRect到Intersection Observer</span> <div class="index-module--circle--E91Mj index-module--light--x7OKG"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" style="transform:rotate(-90deg);width:14px;height:14px"><path stroke="currentColor" stroke-width="1.4" d="M12 3v17M19 13l-7 7-7-7"></path></svg></div></a></div></div></section></section></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-50406624-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blogs/MutationObserver、IntersectionObserver和ResizeObserver/";window.___webpackCompilationHash="136b2da2e8b1b23964e3";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-4f3032a41e5c476c8f46.js"],"app":["/app-a99b6c2ab16d3879fc0c.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-adf2066c282d2a1fad9e.js"],"component---src-pages-about-tsx":["/component---src-pages-about-tsx-7b09644532f5bd1dcc54.js"],"component---src-pages-archives-tsx":["/component---src-pages-archives-tsx-ddc2637e6d877197950e.js"],"component---src-pages-categories-tsx":["/component---src-pages-categories-tsx-b5a2e4d86066d30e963f.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-7e0f083acf9cb537d315.js"],"component---src-pages-labs-tsx":["/component---src-pages-labs-tsx-73eba9758ec10d8f2e57.js"],"component---src-templates-blog-list-tsx":["/component---src-templates-blog-list-tsx-7eb438f670f1bdf1603e.js"],"component---src-templates-blog-post-tsx":["/component---src-templates-blog-post-tsx-0fc1c644d51a3ff081f8.js"],"component---src-templates-categories-js":["/component---src-templates-categories-js-7fe7e84267b6c1ad1f7e.js"]};/*]]>*/</script><script src="/polyfill-4f3032a41e5c476c8f46.js" nomodule=""></script><script src="/component---src-templates-blog-post-tsx-0fc1c644d51a3ff081f8.js" async=""></script><script src="/commons-904b92826443395b7905.js" async=""></script><script src="/app-a99b6c2ab16d3879fc0c.js" async=""></script><script src="/framework-4b7b24ae718e4140a055.js" async=""></script><script src="/webpack-runtime-adf1335a44885cfac931.js" async=""></script></body></html>
<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[张小伦的网络日志]]></title><description><![CDATA[欢迎来到张小伦的网络日志 
		一个记录生活，分享心得的博客]]></description><link>https://zhanglun.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Sat, 13 Aug 2022 11:09:44 GMT</lastBuildDate><item><title><![CDATA[「译」衡量Web性能，多快才算快？]]></title><description><![CDATA[原作者:  Medhat Dawoud 原文链接：https://medhatdawoud.net/blog/measuring-web-performance 在生活中，任何难题都必须是有目标性的，以便于定性，或者能够被证明是可定性的。在软件性能方面，我们可以通过一些指标来很…]]></description><link>https://zhanglun.github.io/blogs/「译」衡量Web性能，多快才算快？/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/「译」衡量Web性能，多快才算快？/</guid><pubDate>Sun, 08 May 2022 02:21:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;原作者:  &lt;a href=&quot;https://medhatdawoud.net/&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;Medhat Dawoud&lt;/strong&gt;&lt;/a&gt;&lt;br&gt;
原文链接：&lt;a href=&quot;https://medhatdawoud.net/blog/measuring-web-performance&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;https://medhatdawoud.net/blog/measuring-web-performance&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;在生活中，任何难题都必须是有目标性的，以便于定性，或者能够被证明是可定性的。在软件性能方面，我们可以通过一些指标来很衡量具体的事物，以证明是否存在性能问题，并且确保这个问题以后能被修复。在这篇文章中，我们将继续我们的性能系列，回答一些问题，比如&lt;u&gt;多快才算快？如何衡量web性能？有哪些测量工具？&lt;/u&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;用户可能没有注意到&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%94%A8%E6%88%B7%E5%8F%AF%E8%83%BD%E6%B2%A1%E6%9C%89%E6%B3%A8%E6%84%8F%E5%88%B0&quot; aria-label=&quot;用户可能没有注意到 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;用户可能没有注意到&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;正如我们在第一篇文章中谈到的认真对待性能背后的动机，我们需要使网络对使用低端设备和慢速连接的人来说是快速的，但我们什么时候可以说 “好吧，这已经是足够的性能优化了”？这是一个好问题，要回答这个问题，我们需要问另外一个问题：性能仅仅和快有关系吗？简短的答案：No。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果要展开讲，性能需要视情况而定。我们有多个指标来说明我们的应用是否有足够的性能。想象一下，你正在为一些iPhone用户开发一个应用程序，而JS包的大小是&lt;del&gt;2MB，我们也将假设他们连接到了快速的互联网上，你认为在这种情况下将包的大小优化为&lt;/del&gt;1.5MB值得吗？ iPhone用户会注意到吗？我不这么认为，在我看来，在这种情况下，你是在浪费时间，而用户不会感觉到性能的不同。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;从这里你可以知道，这取决于最终用户的设备和网络连接，也许并不总是需要深入优化的。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;多快才算快&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A4%9A%E5%BF%AB%E6%89%8D%E7%AE%97%E5%BF%AB&quot; aria-label=&quot;多快才算快 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;多快才算快？&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;换句话说，什么时候停决定停止做性能优化，你需要先掌握以下信息：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;你的网站的大多数访问者所使用的常见设备&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;访客的常见连接条件是什么&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;他们所使用的设备尺寸是多少&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/12ef5de1bd4e83cc3d1d0be8bd4f9868/b3ad9/9111f10de18da2d1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 69.14893617021278%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2klEQVQ4y12Th5KDMAxE+f9/THL0amNqsCm62QVzyTGjuOppJTlBWZZSFIVg1FrTlNIyTpP0fc/1MAwyTFbMYGWcV5nel82rdKOTeVllmBzPgqqqCPSOSinJ85wjzrIsY7C6bqQoSknTVLRuxRgjbWtEt0baaw4L4jiWIs+lbdsbGEUR7fF4SBwnBJZlQdjz+WRAmM/snJ/rAD9QUdc10wQwSRKqw8VTXX1ZJRCQZhnvIODPT0jQ6/UiJxjHkRtQYrQiEOlba2VZFtr7/ZZ5nrkHg1Jm0zQEdV1HHwQLsICSMAylVbVopVgv5xxrAtC2bbKuKw0gOCPQvu9sHAJO0yRd10uADSiMwkjMFQnpEqhbwvAdx8E5moH0oRQfMsTd5cqCQN9F3xQCrWWjMAIGNQACcCo8gfD3pYDKU2GeS1VW30Dn6AhFSNUrhBMCeYUEOsc7f8AilzRJv4B2WUQ1im8OcA+EQjQDNcSHHgCOO/AnsGkathxzD0REg7fZ97JtO4HYQ53Mh0JA3H+FTV3zKTC6V2gtU0Z6uIzvq4Y38EwZUJzdNUTKqBeAaJJdrBjTcW8cRkZHmhj9O/1UCPuo4flvQT2gCAdI0a3r/QbhgDm6jTVGr3o/jrvGv2AULrNrY0LvAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;9111f10de18da2d1&quot;
        title=&quot;9111f10de18da2d1&quot;
        src=&quot;/static/12ef5de1bd4e83cc3d1d0be8bd4f9868/1d69c/9111f10de18da2d1.png&quot;
        srcset=&quot;/static/12ef5de1bd4e83cc3d1d0be8bd4f9868/4dcb9/9111f10de18da2d1.png 188w,
/static/12ef5de1bd4e83cc3d1d0be8bd4f9868/5ff7e/9111f10de18da2d1.png 375w,
/static/12ef5de1bd4e83cc3d1d0be8bd4f9868/1d69c/9111f10de18da2d1.png 750w,
/static/12ef5de1bd4e83cc3d1d0be8bd4f9868/b3ad9/9111f10de18da2d1.png 909w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;因为这一切都与用户体验有关，在你了解了上述内容后，你将能够设定你的优化界限，要收集所有这些信息，你有几种方法，使用分析工具，例如上面截图中的谷歌分析，这些信息非常重要，只有在你真正需要的时候才会进行优化，而不是浪费时间去优化一些用户无法注意的东西。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;如何测量性能&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E6%B5%8B%E9%87%8F%E6%80%A7%E8%83%BD&quot; aria-label=&quot;如何测量性能 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何测量性能？&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在你了解你的用户之后，你可以开始测试你的应用程序，模拟你的用户的最坏情况，并继续测量，直到你发现你的用户群体中最少的设备部分和最少的网络连接条件下的良好性能的应用程序。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果你想确保你的优化后的结果是符合标准的，你可以使用一些基于长期用户研究的指标，如Core Web Vitals，这只是谷歌的一个倡议，以提高网络的整体用户体验。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Core-Web-Vitals&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Core-Web-Vitals&quot; aria-label=&quot;Core Web Vitals permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Core Web Vitals&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/36ea2c81042d04eb3f113a81cc3baa1d/5a190/4cdb8937180bccb3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 29.25531914893617%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABPUlEQVQY02WRTUsCURSG56eWEG1tEQVafyEIadE2aJdRy2hRSAYupMhyTHHCjzGnnBm1Gb1z594nxqlp0QOHA+97DpwPgxUKGYWrnKC1XkWKBBWm+Z8XIUUAWmSeEQqN9a4xe5Lqs0ZESbHOGuttxe2jpNVXaKWTrpUvpMbsKzpDyVM3ZiFS3QgDuK5D1YSrh985/rhrwFkV7ltJeRoJsYCaCTcNuKyBu0h1w/JtRuMuvt1mOeoQDgYQxwgtsRcTpvMegdMisC1ixwERIVEMvsYMHQvPbjMbdAl6PRACY/3lgItKgc9yDu9wi6CwB+MPOtGIjWaJ00qRz/Ia/lGe+W4RrDdsPWWzWeKkuo9znsM/zhNu76BfTYxYxXj+lKWI8H0flMrW1Whcz0OIiInr/tyP7ClBGCJjxWw2z7xvm3PAGNPzI/AAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;4cdb8937180bccb3&quot;
        title=&quot;4cdb8937180bccb3&quot;
        src=&quot;/static/36ea2c81042d04eb3f113a81cc3baa1d/1d69c/4cdb8937180bccb3.png&quot;
        srcset=&quot;/static/36ea2c81042d04eb3f113a81cc3baa1d/4dcb9/4cdb8937180bccb3.png 188w,
/static/36ea2c81042d04eb3f113a81cc3baa1d/5ff7e/4cdb8937180bccb3.png 375w,
/static/36ea2c81042d04eb3f113a81cc3baa1d/1d69c/4cdb8937180bccb3.png 750w,
/static/36ea2c81042d04eb3f113a81cc3baa1d/5a190/4cdb8937180bccb3.png 800w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;2020年 Google 发起了这个倡议，开始时只有3个新指标。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;LCP（Largest Contentful Paint）用于衡量首次加载的体验，应该在上图的阈值内，低于2.5s为佳，不超过4s为差，需要采取行动&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;FID（首次输入延迟）用于页面的交互性，它衡量你的网站响应用户输入的时间，可以是点击、滚动、输入…等，你需要把它保持在100ms以下。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;CLS（Cumulative Layout Shift）用于衡量布局的稳定性，如果页面中的某些元素在页面加载后突然出现，并将所有元素向下移动，这就是不稳定的布局，可以用这个指标来衡量，最好是尽可能地接近零。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;如果你能成功地使你的网站通过这些指标，并使他们的网站至少有75%的页面保持在所述的阈值之内，你可以说这是足够快和性能的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这些新指标的酷之处在于，它们是为了用户的利益。如果网站创建者不注意加强它们，他们就会失去SEO排名，这意味着失去在线业务，因为这些指标现在对 SEO 排名有贡献，而这是 Google 强推 Core Web Vitals 的聪明之处（他们的游戏他们的规则）。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;测量工具&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%B5%8B%E9%87%8F%E5%B7%A5%E5%85%B7&quot; aria-label=&quot;测量工具 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;测量工具&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;现在，在我们了解了我们需要测量的东西之后，是时候学习如何测量它了，有2种类型的测量工具。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1-实验室测试又称同情性测试&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%B5%8B%E8%AF%95%E5%8F%88%E7%A7%B0%E5%90%8C%E6%83%85%E6%80%A7%E6%B5%8B%E8%AF%95&quot; aria-label=&quot;1 实验室测试又称同情性测试 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. 实验室测试（又称同情性测试）&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在你非常了解你的用户之后，如前面所解释的，你可以使用一些工具来模拟用户的情况，例如，通过节流CPU来尽可能地接近用户设备的CPU，在开发模式下使用这个方法是非常好的，可以在启动之前为性能状态设定一个基线。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你可以测量LCP和CLS，但不能测量FID，因为它需要真实的用户交互，但你可以依赖另一个指标，它也可以反映用户的输入延迟，这就是TBT（总阻塞时间）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;⚙️&lt;strong&gt;工具&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://developers.google.com/web/tools/lighthouse&quot; class=&quot;link-underline&quot;&gt;Light House&lt;/a&gt; ：最常见的实验室性能测试，因为它是在你的chrome devtools中进行的，非常快，并给你一些审计，以便你可以提高你的页面速度。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 672px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/77b8a967363a3201d1a7fd2cf9639ec3/30d16/b3f52b3668910da4.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 38.297872340425535%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRElEQVQoz32R3WobMRBG/f6P1ZvelFKo22Dsxm0w69Vqo41Wa/1Lp6zi2CSFfvDBjDRzNGI2XFVr5R6X5lteMm+3pZbmj1r7V2/WwjK/kM8naimtMU+/SOLra1G8kPovYDpMCRzMbx70gURm1jP7/Z5lWW7QTQteFKV7Wp+numfq8I1y/kzNgTKfSKdPMB3oo+bHvOO73nEpDjWqBlRK3YEpZ+xicMYQUyK6hUv/k2V8atMWq/ByByW0/FH9oTOiAZxzTNOE9/4OXBMhBGIY0FozG0MvRrqzIKWElCMPuwPOvTbpSeMursXH45HtdkvXde+//D+FmAjeNfhHrWfWWmKMd+DbdprXhViLF2ekmohuJpoeKZ+xzjJ6xSAHpJSUUv7Z8qrNLbkCa87k4AkxUnIiJ4/3gZwTIUdCCM3vBrnC1gn/AulWbi8Sjds/AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;b3f52b3668910da4&quot;
        title=&quot;b3f52b3668910da4&quot;
        src=&quot;/static/77b8a967363a3201d1a7fd2cf9639ec3/30d16/b3f52b3668910da4.png&quot;
        srcset=&quot;/static/77b8a967363a3201d1a7fd2cf9639ec3/4dcb9/b3f52b3668910da4.png 188w,
/static/77b8a967363a3201d1a7fd2cf9639ec3/5ff7e/b3f52b3668910da4.png 375w,
/static/77b8a967363a3201d1a7fd2cf9639ec3/30d16/b3f52b3668910da4.png 672w&quot;
        sizes=&quot;(max-width: 672px) 100vw, 672px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://pagespeed.web.dev/&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;PageSpeed insights&lt;/strong&gt;&lt;/a&gt; ：一个由 Chrome 团队提供的工具，它支持测量桌面和移动端的Core Web Vitals。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://gtmetrix.com/&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;GTmetrix&lt;/strong&gt;&lt;/a&gt; ：另一个令人惊叹的网站，在世界某个地方的随机真实机器上测量Core Web Vitals，并给你提供实验室结果。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;还有一些可以使用的工具，但这些是我经常使用的，而且是免费的。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;注意：所有这些实验室测试工具和其他工具都会给你一些建议，并对perf、SEO、A11y等进行审计，如果你遵循这些建议，你就可以大幅增强你的应用程序。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;2-RUM-测试&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-RUM-%E6%B5%8B%E8%AF%95&quot; aria-label=&quot;2 RUM 测试 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. RUM 测试&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;另一种测量性能的方法，RUM是 Real User Monitoring 的缩写，这意味着你使用的是基于真实用户体验的真实监测数据，当然这更准确，它测量的是真实用户如何体验你的网络应用的延迟、错误、布局转变，没有模拟，也没有假设。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你在这里得到了关于用户体验页面性能的详细信息，包括LCP、CLS和FID。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当你在做优化决定之前需要一些依据时，强烈推荐你使用这个方法，它比实验室测试更好，因为实验室测试有时可能会产生误导。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;⚙️&lt;strong&gt;工具&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://web.dev/chrome-ux-report-data-studio-dashboard/&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;CrUX&lt;/strong&gt;&lt;/a&gt; ：数据工作室的Chrome用户体验报告，它非常好，而且随着时间的推移也会给出很好的报告，包括桌面和手机。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://github.com/GoogleChrome/web-vitals&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;CoreWebVitals lib&lt;/strong&gt;&lt;/a&gt;：由Chrome团队创建的一个库，非常容易使用，只需决定你自己的记录方式，无论是本地还是在线日志服务。顺便说提一句，这个库在 Create React App 中开箱即用。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;import { getCLS, getFID, getLCP } from &amp;quot;web-vitals&amp;quot;
getCLS(console.log)
getFID(console.log)
getLCP(console.log)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://vercel.com/analytics&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;Vercel Analytics&lt;/strong&gt;&lt;/a&gt;：真的是很好的工具，我最近改用 Vercel来 托管这个博客，对业余项目计划启用分析是免费的，但对团队和企业是高级的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/dff35dc59074417c3293c286c40c0b8c/29114/cc7451177b6a7864.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 64.36170212765958%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAADAklEQVQ4y1VSTYtcRRStEcWPX+AiuNAhbsaNv8GAW9eCOxdmYYZAZBAUI0yEgazdmDiECYpjEjQZnca2AyJDUGx0ZJqZdjrdThI7Q/d7/d6rWx+3ql4dqddRSMHh1K1bdbh17xEAngAglFLvGGO+YubL1tp1Y8x6YmZukPb/gf/fN7nPrbVfKqVOOeeEAPBkEpRStogICYoUKilhrW1gjAFbC+cYzjkYy4/lEkspP0o6onxUYanlprYG2XRqj7OJ9+x8qIMnIj8rSm+V9iHUvq6jL5TzpG2TK4rKEimUZXm6EQTwNIBn4PAdAOypB34n78cyGMRQg52DZg/NASrB+iY2rk5nUXOorQtg5pbW+gXxez5cvnh/O3w4um7Xj3/GT+O9uH34S7zLEyCgEfTOIca6gfcOShHqEJo4sffehxCgtT4ndo73L5webOCNw0/r1XtbMZcF/pJjoAbSJWaG8z49amJrGZIIZUWw7KI2Ns7KKihtQEqdScM4D20ADh6+xqh4GPvFAzxUOZzl+XCMgdEaSqkGWmsYYxthIopSqpBipdSymM7kx9t/Fri8U4Zf/6Z4qrcWxZ234spoM6pSxizPY0FV1GzjNMui9z7KuQOiNToqolhVVbDMc8GykufHM437hfc5cf3u3Q28dnARVyY7MCF916EwBOkNXJh/vaqqmOw1b4mLeVUGkwS1WhZEtOqYEbxr+mVI29oHGbyn4DyVZdlAWk3sHGmtdZZlqcqYFjPHSpb+UYVnxDSfnSWlI0lZKVKT37rd1y99dunErZu3Tn5949ri1tbW4nartfjD962Tn6xeeH40Gr2ZjJwqRZy7oJIyCUMbfVZ88P57z964fu3Fb769+dLG1asnkjmHf+yLf4b3xEH/QBwdHYnxeCz27nRFlmViMpm8aq21zKydczqxZSZ2jKIo3habX1wRB/s9cTgYiG63m4wuer3ewnA4XBgMBgv9fr/h3d3dhZRbWVl5qtVqvdzpdF5pt9tLnU5n6Xbn9tKP7fbS2trac/8COjGIFZufKIIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;cc7451177b6a7864&quot;
        title=&quot;cc7451177b6a7864&quot;
        src=&quot;/static/dff35dc59074417c3293c286c40c0b8c/1d69c/cc7451177b6a7864.png&quot;
        srcset=&quot;/static/dff35dc59074417c3293c286c40c0b8c/4dcb9/cc7451177b6a7864.png 188w,
/static/dff35dc59074417c3293c286c40c0b8c/5ff7e/cc7451177b6a7864.png 375w,
/static/dff35dc59074417c3293c286c40c0b8c/1d69c/cc7451177b6a7864.png 750w,
/static/dff35dc59074417c3293c286c40c0b8c/78797/cc7451177b6a7864.png 1125w,
/static/dff35dc59074417c3293c286c40c0b8c/aa440/cc7451177b6a7864.png 1500w,
/static/dff35dc59074417c3293c286c40c0b8c/29114/cc7451177b6a7864.png 1920w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://calibreapp.com/&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;Calibre&lt;/strong&gt;&lt;/a&gt;：这确实是一个很好的工具，有一个很好的用户界面，它是一个高级工具，有免费的试用版，但是他们也有一个免费的实验室测试页面，这里是我的网站的核心网络生命力报告。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://www.akamai.com/products/mpulse-real-user-monitoring&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;mPulse&lt;/strong&gt;&lt;/a&gt;：这是一个来自著名的安全 Akamai Tools 的工具，根据一些朋友的评论，他们非常喜欢它，它也有一些分析，如 Google Analytics 和Core Web Vitals，这使得它更全面，它是高级的，有免费试用。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在这篇文章中，我们已经了解了测量网络性能的方法，应该测量什么，如何测量，以及你应该在多大程度上优化性能，最后还有一些你今天可以采用的工具。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;性能是一个持续的过程，你增加的功能越多，对性能的挑战也就越大，通过不断的测量，你可以看到影响性能的因素，并及早消除它。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Storybook 使用手册——MDX 和 Doc Blocks]]></title><description><![CDATA[MDX MDX是一种标准的文件格式，由Markdown和JSX组合而成，文件后缀是.mdx。也就是说你可以在MDX中使用Markdown的语法编写内容，同时还能嵌入JSX编写的组件。 可以用MDX编写纯粹的文档，把文档和Story一起添加到Storybook中。  Doc Bl…]]></description><link>https://zhanglun.github.io/blogs/Storybook 使用手册——MDX 和 Doc Blocks/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/Storybook 使用手册——MDX 和 Doc Blocks/</guid><pubDate>Sun, 24 Apr 2022 11:00:00 GMT</pubDate><content:encoded>&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;MDX&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#MDX&quot; aria-label=&quot;MDX permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;MDX&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;MDX是一种标准的文件格式，由Markdown和JSX组合而成，文件后缀是&lt;code&gt;.mdx&lt;/code&gt;。也就是说你可以在MDX中使用Markdown的语法编写内容，同时还能嵌入JSX编写的组件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;可以用MDX编写纯粹的文档，把文档和Story一起添加到Storybook中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1e773e85a7fd2bdee1a6581275447531/1cfc2/4a487fd65b9f6a6b.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 29.25531914893617%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB30lEQVQY0x2Qz0uTcRzHP4qW/ZDRYo+zPautqc98DDY2t6XbZJFCJIhULvoLqkMgRARWQt3q1CkovRREdqhDBw91C+tWCLGerZXpkm22nI/p82zPs+/zvOvZ+/K+vd4v3rRWrHhL1V0RqAt6rSaWq7v8/QfzRGRrP8INnnZxkbNd9vAZe2dgwmELiKOpS2QlX/7rkWtMBAwBMKx2AybR2nrpk6qoZmHHlFXdgFbXXt+4cpMiofGjwrHkdlAcQ8B/Cj53DC7H4GMLNhKfbF8tyx9llZlyHbKim/itGG9UA0TShiKB6XiWN9kTyQSgLwJouXr97gnRESvG+Lg54A0pgieIXvfJRwDa3j+f2y/9YcsVxYCiMWaJbNeNdwCIfm3ufFG1BlQG7esWwHRt8dXTBSLinX2epCr6UvC64uC5KLoPh+YT0UnqIGr9udX4LNdNwGhojDHANN42gXKuMJpZzqRzOWm8siKd/7ZSCE+lr1GXLdzh70lMi8LITL8vMd3nHZ7huXCSiG9+uJFZH8tKP6akbHYin/9+oVgqR5aWPhBheJY7Rw4nEe0looPWyu3ZOer3Byk2NOCJDvU4b72k1ouX7Xs62yL0Iv2wpXpvgZC6032c6BAR7SOiA027//kHe2H9QgDnwS0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;4a487fd65b9f6a6b&quot;
        title=&quot;4a487fd65b9f6a6b&quot;
        src=&quot;/static/1e773e85a7fd2bdee1a6581275447531/1d69c/4a487fd65b9f6a6b.png&quot;
        srcset=&quot;/static/1e773e85a7fd2bdee1a6581275447531/4dcb9/4a487fd65b9f6a6b.png 188w,
/static/1e773e85a7fd2bdee1a6581275447531/5ff7e/4a487fd65b9f6a6b.png 375w,
/static/1e773e85a7fd2bdee1a6581275447531/1d69c/4a487fd65b9f6a6b.png 750w,
/static/1e773e85a7fd2bdee1a6581275447531/1cfc2/4a487fd65b9f6a6b.png 900w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Doc-Blocks&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Doc-Blocks&quot; aria-label=&quot;Doc Blocks permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Doc Blocks&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;顾名思义，就是文档中的块。一个Story渲染成的文档就是由若干个Block组成的。在Storybook中有不少Block。常见的可能是ArgsTable，Canvas和Story。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;ArgsTable&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ArgsTable&quot; aria-label=&quot;ArgsTable permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ArgsTable&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;Story自动识别组件的Props，自动生成一个表格。表格中会列出这些参数，同时还提供了可交互的参数控制&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/682c93a076a587cd7d801127bb580a6b/4352a/b231811d70405605.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC50lEQVQ4y42SS28URxSF+zdkkRVZh13ENvkDUUSiSBYSsMiGEDyymYfHzyQymAFjRAKDjY09BMuysImMZJIIEpCyYMEiEhvAQxAryzM2Atvz6q6u6erXF1W3Z2SQIBzpdN1SVZ2+99xrZDPjTE3NUyjcYmpyifzF6+TzC1ydWWZ+7jY3Fu9yY+FPfl28w+/Lf3Nr6S+WFv7g0oVJ+vsGGBoc5NSJk5wbPcPhA19j/Dw2y2ZpldLGOpYQWMKi0ahi2TaOqwgCF+U6KOXgeS6e76FcRdNx8P0Az/dxPQ+NX65cwZidvolZl7zarFOp2cimHx3qr+OGhEFAEISE4Q53xUF0FkQ/0sj/dA5jvrCAlAJhWYS+h6sUxWKRYnGFppTsRlv0Dfp+nER3dxIjmRnlwZMqDx5v888zxfOyw4uNDUprZWq1GlJKTNPE2ynrXYKpZBqjf2iclVXJw6ebFFcVay91+kFcduDjum5E/ehtGepzjb5sD0Zu5BLCFlimReAHkdh6yeT+vRLS9v633BY1spk0xuDAGNWGYK30AmF7hIT8+6TC3ORTqtvNttjuNY7jVTelUqlE8ciJYYzebA7peJhWE9n0aDr+a43QD3S52sOWXzrWq2bgh5imHd2dnriI0dt7OtpoMU3XCxHCptGw8LxY3LZtqtVqJK6UimZSCInjyB2/Y2uuTU/GJevsbelGgsqNH2kBIUR0UXd5a2urbb5GvSZZebTOneVV5ibK3L8dMnN5QmeYawvaOkM3iEbFcZy2b3rfGqG44wH1epWzuWsc+qrAJx9d4Jv9d7mcz2Ok0yfRzTUtB0soZDMeE51la1S06dvblaj0Vpbl9TJ7P97Hhx/sxTD28OXnCYaHhzGy2RHeB9q/3fCVojBzhh/GJug6dJ7Z8d84lRvF+PSzL8j0/EgyNUQq/X3E48kBUnofcZDORIZvjx4nkcjQ2dnNd0eP0ZXoYqC/l2S6j2NHUnQnejjY0cF/wbsfM2811ioAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;b231811d70405605&quot;
        title=&quot;b231811d70405605&quot;
        src=&quot;/static/682c93a076a587cd7d801127bb580a6b/1d69c/b231811d70405605.png&quot;
        srcset=&quot;/static/682c93a076a587cd7d801127bb580a6b/4dcb9/b231811d70405605.png 188w,
/static/682c93a076a587cd7d801127bb580a6b/5ff7e/b231811d70405605.png 375w,
/static/682c93a076a587cd7d801127bb580a6b/1d69c/b231811d70405605.png 750w,
/static/682c93a076a587cd7d801127bb580a6b/78797/b231811d70405605.png 1125w,
/static/682c93a076a587cd7d801127bb580a6b/4352a/b231811d70405605.png 1364w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://storybook.js.org/386bdaed7a08de9d831f68e43e18142c/addon-controls-docs-optimized.mp4&quot; class=&quot;link-underline&quot;&gt;image&lt;/a&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Canvas&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Canvas&quot; aria-label=&quot;Canvas permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Canvas&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;提供包含了一个控制条的可交互的画板，内部包含了Source这个Block，用于展示代码&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 706px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0a5918f9bd14bdebf335f5d8af99b70f/9f21b/e27abe97b638577c.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 29.25531914893617%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7UlEQVQY05VRsUoDQRTc//YHrERtY6orhDSHgicErTUogpUmhWCVw73N7e1pNNx7M7LnagJJ44Nh5r15O/BYQzKQXJCsIwBsQUR6jr6q7tqpSHaqemRIcnxxzrPRKUXBrcJ6pqobY2xqJH9oPj6/eJMd6uXBHsryLRrwdY08z+G97/txUWA+L3v9NJ2hCS1Szm91KXBglquOr1cjvT3Zh3V1v7hwDlmWwVVV3z9MJqjsj36ezhDadWDiLkoRGZiVgC+Pd7y/Lujfl/8+OTGSHhoCbfoQH69VwKvqHwB4EdmpI8d3IQRnrZWmaY6/AWxAyi14CslKAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;e27abe97b638577c&quot;
        title=&quot;e27abe97b638577c&quot;
        src=&quot;/static/0a5918f9bd14bdebf335f5d8af99b70f/9f21b/e27abe97b638577c.png&quot;
        srcset=&quot;/static/0a5918f9bd14bdebf335f5d8af99b70f/4dcb9/e27abe97b638577c.png 188w,
/static/0a5918f9bd14bdebf335f5d8af99b70f/5ff7e/e27abe97b638577c.png 375w,
/static/0a5918f9bd14bdebf335f5d8af99b70f/9f21b/e27abe97b638577c.png 706w&quot;
        sizes=&quot;(max-width: 706px) 100vw, 706px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;更多Block的信息可以参考&lt;a href=&quot;https://storybook.js.org/docs/vue/writing-docs/doc-block-argstable&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;MDX的简单例子&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#MDX%E7%9A%84%E7%AE%80%E5%8D%95%E4%BE%8B%E5%AD%90&quot; aria-label=&quot;MDX的简单例子 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;MDX的简单例子&lt;/h2&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;!-- Checkbox.stories.mdx --&amp;gt;

import { Canvas, Meta, Story } from &amp;#39;@storybook/addon-docs&amp;#39;;

import Checkbox from &amp;#39;./Checkbox.vue&amp;#39;;

&amp;lt;Meta title=&amp;quot;MDX/Checkbox&amp;quot; component={Checkbox} /&amp;gt;

export const Template = (args, { argTypes }) =&amp;gt; ({
  props: Object.keys(argTypes),
  components: { Checkbox },
  template: &amp;#39;&amp;lt;Checkbox v-bind=&amp;quot;$props&amp;quot; /&amp;gt;&amp;#39;,
});

# Checkbox

With `MDX`, we can define a story for `Checkbox` right in the middle of our
Markdown documentation.

&amp;lt;Canvas&amp;gt;
  &amp;lt;Story 
    name=&amp;quot;Unchecked&amp;quot;
    args={{ 
      label: &amp;#39;Unchecked&amp;#39;,
    }}&amp;gt;
    {Template.bind({})}
   &amp;lt;/Story&amp;gt;

  &amp;lt;Story 
    name=&amp;quot;Checked&amp;quot;
    args={{ 
      label: &amp;#39;Unchecked&amp;#39;, 
      checked: true,
    }}&amp;gt;
    {Template.bind({})}
   &amp;lt;/Story&amp;gt;
  
  &amp;lt;Story 
    name=&amp;quot;Secondary&amp;quot;
    args={{
      label: &amp;#39;Secondary&amp;#39;, 
      checked: true, 
      appearance: &amp;#39;secondary&amp;#39;,
    }}&amp;gt;
    {Template.bind({})}
   &amp;lt;/Story&amp;gt;
&amp;lt;/Canvas&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;最终会渲染在Storybook中，可以在页面的&lt;code&gt;Docs&lt;/code&gt;中查看&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7ed0112ef910ee34c3dc0c1ae623c069/71ba4/939bb6ee2afeb401.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.48936170212767%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqElEQVQoz6WQSwuDQAyE/f9/Tc89tDdBsJfC1uwrazJl1weWSot1YCDLhi+TVDImPKPgERRQhZ50hR2dBrZti6ZpUNc1uq5boUe09Beg9wHGRTjnMAwDrLUgzzBhLLUlAhGVOv/T/BaRN1hJOEUVJI5IKa3Rc3P2kXXXhNExrpcb+nu/u+43wDbADFTwqCAfEUOAbNL9cgblrYwxYOYJOA3Sj+P+o3zDFzdfd3Hw/TqNAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;939bb6ee2afeb401&quot;
        title=&quot;939bb6ee2afeb401&quot;
        src=&quot;/static/7ed0112ef910ee34c3dc0c1ae623c069/1d69c/939bb6ee2afeb401.png&quot;
        srcset=&quot;/static/7ed0112ef910ee34c3dc0c1ae623c069/4dcb9/939bb6ee2afeb401.png 188w,
/static/7ed0112ef910ee34c3dc0c1ae623c069/5ff7e/939bb6ee2afeb401.png 375w,
/static/7ed0112ef910ee34c3dc0c1ae623c069/1d69c/939bb6ee2afeb401.png 750w,
/static/7ed0112ef910ee34c3dc0c1ae623c069/78797/939bb6ee2afeb401.png 1125w,
/static/7ed0112ef910ee34c3dc0c1ae623c069/aa440/939bb6ee2afeb401.png 1500w,
/static/7ed0112ef910ee34c3dc0c1ae623c069/71ba4/939bb6ee2afeb401.png 1870w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;可以看到，使用了&lt;code&gt;@storybook/addon-docs&lt;/code&gt; 提供的几个组件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;Meta： 用于描述当前组件文档页面的信息&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;Canvas：绘制Story渲染使用的画板&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;Story：创建一个Story&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;Story中用于配置的各项参数，都可以做为这几个组件各自的Props传入。比如，使用CSF文件时，我们这么写：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Checkbox.stories.js|jsx|ts|tsx

import { Checkbox } from &amp;#39;./Checkbox&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/react/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;Checkbox&amp;#39;,
  component: Checkbox,
};

const Template = (args) =&amp;gt; ({
  //👇 Your template goes here
});


export const Unchecked = Template.bind({});
Unchecked.args = {
  label: &amp;#39;Unchecked&amp;#39;,
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在使用MDX编写时，则是如下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;!-- Checkbox.stories.mdx --&amp;gt;

import { Canvas, Meta, Story } from &amp;#39;@storybook/addon-docs&amp;#39;;

import Checkbox from &amp;#39;./Checkbox.vue&amp;#39;;

&amp;lt;Meta title=&amp;quot;MDX/Checkbox&amp;quot; component={Checkbox} /&amp;gt;

export const Template = (args, { argTypes }) =&amp;gt; ({
  props: Object.keys(argTypes),
  components: { Badge },
  template: &amp;#39;&amp;lt;Badge v-bind=&amp;quot;$props&amp;quot; /&amp;gt;&amp;#39;,
});

&amp;lt;Story
  name=&amp;quot;Unchecked&amp;quot;
  args={{
    label: &amp;#39;Unchecked&amp;#39;,
  }}&amp;gt;
  {Template.bind({})}
&amp;lt;/Story&amp;gt;  &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;单纯的MDX文件&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8D%95%E7%BA%AF%E7%9A%84MDX%E6%96%87%E4%BB%B6&quot; aria-label=&quot;单纯的MDX文件 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;单纯的MDX文件&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;通常，在使用Storybook MDX时，在MDX中定义Story，而文档会自动与这些Story关联。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;也可以编写不包含Story的MDX文档，将其与现有的Story相关联，或者将这个MDX作为文档节点嵌入Storybook的导航中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b21202d494db900379ce0b616fd3fd2e/bfe1f/d32bba18e172331c.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 48.93617021276595%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfklEQVQoz42SzYrUQBRG8xS+gyAo7gRRcetzCLoRfBpduBHEQVEapF248AcGXLkTXOjYM2h6+ifppJLqVFKpunUkSduDCMaCwy2q4NzvUhXl8Yp4sUBXhsY52rZFtwDhL0IYJ/q5KJmdlhzFBVle4wOc6MBxGfZ1VgYK+3/S6ODpZx49/8bDgyM+vZsxN3BtKlyeCFdeCbfeDPXZ905I3/BfK1ovUypV4IwF33KsAzdfCzemg+j6VDj/Qnj89bdwJOE8VShjKawg4jnRcHUKlyZwcQIXXgrnnngefNkJZUQYrzOUNujG471nVQn3Dw13PxjuvK+499Fz+zDwdj4IhZGRO2GSKbbW0zjBtZb1adyzin+Aa4ZXDtI3HCNabgryshqErUdEUEXRo7dbcqXYZDlZnlPX9Q7zR22apq/WWqJlkqO2NdUuYdclTVOMMf2fPMP1dyKhf+kO6ZCz5N0+2pQVuTb7kb1zJEmC1nrfeY8x1I3FuDDQSn9mdnQJfwFhyvZWMAa9AgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;d32bba18e172331c&quot;
        title=&quot;d32bba18e172331c&quot;
        src=&quot;/static/b21202d494db900379ce0b616fd3fd2e/1d69c/d32bba18e172331c.png&quot;
        srcset=&quot;/static/b21202d494db900379ce0b616fd3fd2e/4dcb9/d32bba18e172331c.png 188w,
/static/b21202d494db900379ce0b616fd3fd2e/5ff7e/d32bba18e172331c.png 375w,
/static/b21202d494db900379ce0b616fd3fd2e/1d69c/d32bba18e172331c.png 750w,
/static/b21202d494db900379ce0b616fd3fd2e/78797/d32bba18e172331c.png 1125w,
/static/b21202d494db900379ce0b616fd3fd2e/aa440/d32bba18e172331c.png 1500w,
/static/b21202d494db900379ce0b616fd3fd2e/bfe1f/d32bba18e172331c.png 2177w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;MDX编写的方式和普通markdown大同小异，也是非常简单。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;到目前为止，Storybook编写文档的基本方式已经介绍得差不多了。接下来将从一个组件库出发，演示如何使用Storybook，从零搭建一个文档站点。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[「译」为什么性能很重要]]></title><description><![CDATA[原作者:  Medhat Dawoud 原文链接：https://medhatdawoud.net/blog/why-performance-matters 现如今，性能优化是所有web开发者的基本技能了，不再是可有可无的，也不是可以吹嘘的花哨东西，在这篇文章中，我将解释为什么…]]></description><link>https://zhanglun.github.io/blogs/「译」为什么性能很重要/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/「译」为什么性能很重要/</guid><pubDate>Wed, 20 Apr 2022 06:00:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;原作者:  &lt;a href=&quot;https://medhatdawoud.net/&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;Medhat Dawoud&lt;/strong&gt;&lt;/a&gt;&lt;br&gt;
原文链接：&lt;a href=&quot;https://medhatdawoud.net/blog/why-performance-matters&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;https://medhatdawoud.net/blog/why-performance-matters&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;现如今，性能优化是所有web开发者的基本技能了，不再是可有可无的，也不是可以吹嘘的花哨东西，在这篇文章中，我将解释为什么性能如此重要，为什么有些人仍然回避它。让我们开始吧🚀。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;性能不仅是指速度，一般来说，它在本质上为了用户体验。所以如果用户对你的网站感知足够好，那么你的性能其实并不差。加强性能的优化会有助于使Web更容易被他人使用，但主要因素是用户以及他们对你的Web应用的感受。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;页面大小的中位数在增长&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%A1%B5%E9%9D%A2%E5%A4%A7%E5%B0%8F%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B0%E5%9C%A8%E5%A2%9E%E9%95%BF&quot; aria-label=&quot;页面大小的中位数在增长 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;页面大小的中位数在增长&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/583e14e2fdc4e1d4b7c4db27a40de855/c1b63/07786bdd47144bf7.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACB0lEQVQ4y4WTCXObMBSE/f9/WZs0TuzWVxyckPgCjBEgLl1fR9iOM+60fcyyQsfqvUUaOOfw8PG13XUdQgiiKCI7ZsRRTBzHZFlG27Z/zL/EwL+stUgpKcqSvCh6FJ7zAllVVHXds5/jQ2lLXrbIWtG0ilJ25LKjbvVJ8LKbF/4bzG3fObsL95k6x8Cn78v7WsL/QF/mlf1jnEN7wTzPPz2x9suCW5wX+nFtHY22vUDRWuJcsU5bkkIx8F41TfNpqvUeAb6ndCAsxMoRVpbnpGW5b5iFktFzznRdMQpKHhc5dzNBsK0ZaK0xxrIWiiDpmEUtP7cN43XNOKwYvUlGLyWTRc50Lvg1F0xfCl7eZf+9CAo+tjW7jaQQ3emneNH3XcnrR0YSlWRRgUxrykNFdaypy5amajFKU8oKYwxKdT07a+lUh8WitLoem02052O7ZhtH7JKYTncYazBW9xv6IyWrmmX4TtO2vU3xISUVoh9Lsxyl+mNzMrpTGm0s+zRnuIgZBxnjVcbojMcg43554Ns85keQ8bAS3C1T7pZH7gPB9+WBQjanDH3aoqwoOsM+FTxMVjzOQ4azN4ae5+HpexIwnKwYzUOeZm89X/A0fSVJj2dB53o/fOle3BqNM5pKKfb7HWkSoaqG3WZDdkxx3gqtsOYK49kaBrd38Ta0Mb2Hl7a/Mf+K3xHQ6abJcsGRAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;07786bdd47144bf7&quot;
        title=&quot;07786bdd47144bf7&quot;
        src=&quot;/static/583e14e2fdc4e1d4b7c4db27a40de855/1d69c/07786bdd47144bf7.png&quot;
        srcset=&quot;/static/583e14e2fdc4e1d4b7c4db27a40de855/4dcb9/07786bdd47144bf7.png 188w,
/static/583e14e2fdc4e1d4b7c4db27a40de855/5ff7e/07786bdd47144bf7.png 375w,
/static/583e14e2fdc4e1d4b7c4db27a40de855/1d69c/07786bdd47144bf7.png 750w,
/static/583e14e2fdc4e1d4b7c4db27a40de855/78797/07786bdd47144bf7.png 1125w,
/static/583e14e2fdc4e1d4b7c4db27a40de855/c1b63/07786bdd47144bf7.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在过去十年，页面大小的中位数已经变成了6倍。对于移动网页来说，2012年3月约为300KB，而现在2022年三月约为2000KB了。这是一个巨大的增长，但是对于所有现代化的网站建设方式来说，这是正常的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;另一方面，硬件和设备也得到了增强，以应对新的软件需求，但是价格确实更高了。并非所有人都能负担得起。大多数互联网用户正在使用中端或低端设备，如果忽略了他们，你将忽略很大一部分市场，并且可能会失去潜在客户。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;糟糕的连接3G--2G仍然是个问题&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%B3%9F%E7%B3%95%E7%9A%84%E8%BF%9E%E6%8E%A53G--2G%E4%BB%8D%E7%84%B6%E6%98%AF%E4%B8%AA%E9%97%AE%E9%A2%98&quot; aria-label=&quot;糟糕的连接3G  2G仍然是个问题 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;糟糕的连接(3G | 2G)仍然是个问题&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9db27a113e8dd921adf5a8e186e71a54/c1b63/e3efaee93fa7faa3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 61.702127659574465%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABwklEQVQoz5WSTW/TQBCG82s5Ik583BGXwgWERG+VuCLBkQsCgeKStHGSJoQ0KRBFlCh13Sb+WO/aXj9o13FqKqHCSCOPZ2femXdmGgCnizOcVpdmy2X4dcpgNKHtDugejRgdf6M/POZoOObAHdj3ZqtrY5qfXfYPenza77A88w0UjaIorFEUGqkkaaoI4pB1EBCGIUEQWHvp+VvbaBRFaK1JksTmlhgFDWMkUiKVohKVpaVPSpRSSKmIYmFjpPUr0iyjLgZ8C5hrTZ7n1mEeKLhRTKzRk+Wc5y9f82U8KynHsUAIQZqmG8BK9Y1qCn+cuNx59Iy2Oy4BwzCyc8iybFv1X7Ri5Jz0uf94l05vctWhmcv/AOrNEow0pz3u7rzgsAKMohiRJDXK+ipR10A2fvN1Jn32Xr3FO1/Rng25t1Pr0Gwry/NtQn3gddv+G6o6503nA7cePOH7jwWt2YDbD5/S7mxmaLec5wiRkEiFf3FJ2bVk6Z3jX65QKiWIIns6Kk2Zns5577j4F2vm3oJ3ziE/f3mmfHnY9W4MdbtBsHe3Wq/tSEILGBMLgZLyr6fUuE7xupgC5rhNl5VtCv0x61r+bw35lis6bGozAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;e3efaee93fa7faa3&quot;
        title=&quot;e3efaee93fa7faa3&quot;
        src=&quot;/static/9db27a113e8dd921adf5a8e186e71a54/1d69c/e3efaee93fa7faa3.png&quot;
        srcset=&quot;/static/9db27a113e8dd921adf5a8e186e71a54/4dcb9/e3efaee93fa7faa3.png 188w,
/static/9db27a113e8dd921adf5a8e186e71a54/5ff7e/e3efaee93fa7faa3.png 375w,
/static/9db27a113e8dd921adf5a8e186e71a54/1d69c/e3efaee93fa7faa3.png 750w,
/static/9db27a113e8dd921adf5a8e186e71a54/78797/e3efaee93fa7faa3.png 1125w,
/static/9db27a113e8dd921adf5a8e186e71a54/c1b63/e3efaee93fa7faa3.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这不仅和设备有关，在全世界范围内，网络并非都是最好的。根据2021年的网络年鉴，很大一部分网络用户，大约25%仍然在使用 3G 或低于 3G 的网络，这使得他们的web可用性成为开发者的一个挑战。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这不仅仅和网络糟糕的国家或者地区有关，即使你生活在一个能够提供良好网络 链接的国家，你也可能处于4G或5G不太稳定的地方，比如在室内咖啡馆或者机场。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Web用户是没有耐心的&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Web%E7%94%A8%E6%88%B7%E6%98%AF%E6%B2%A1%E6%9C%89%E8%80%90%E5%BF%83%E7%9A%84&quot; aria-label=&quot;Web用户是没有耐心的 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Web用户是没有耐心的&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7d4ecb793c5aacb8408f5e578f8944e8/1cfc2/65d8c970527d1182.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 48.40425531914893%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzUlEQVQoz12S63KqMBSFff83qkfF61/P9EynY1XkIggEAgkBIYCuDhtr2xNmzd4ksOZjbUbj8Rg7a4ft6xZBEKCqKggpkGUZ8jwfevHohaAqpUTXdbj3131Qv/o62mw2MB0Tb+9v4AmH1vr5UlEUKMuSqlIKucpRVzWqsgIGj+f6Mh2prsCRmzgJC1xxpDwFTzmiKEIYhUTFOUeapXR2yS845Rb26R5ufsYxMyFq+U3Yb0ycKcb2BK48Ax2I8ktt20I3Gk3TDOoa6E6T+l5phfbWfhvKWhLdSVqIZQzGGEIWwvM9+BcfCU/AYoY4Hs7OwsMhO2LHP2BLBx/pHvInoSVtzNw51t4GS2+N5XlFWnlrGO4cr+zf8PD/of3I7VeGWS1gZiaOwkQkI6K7sACu75KihMGPfMRJjCRO4EmfvuiQHuApnzJ0pPs0HpnZCS/WGDPXgOEuYNhzzGzjoTkMZ4GJNUV6zWiyfV7NrSHd7je6/5Wh0gXCIkRQBAhVBCXVMNkkAYsY/UpSSJp80u+JGGflwRI2ZchKRple2+uDUJzwYv8huj7LhbMkSsOaY2YZVBfOClPLwPbyF7rVqNoKRVOgbEqadN3V6G4dGX4CYQjughnkWRoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;65d8c970527d1182&quot;
        title=&quot;65d8c970527d1182&quot;
        src=&quot;/static/7d4ecb793c5aacb8408f5e578f8944e8/1d69c/65d8c970527d1182.png&quot;
        srcset=&quot;/static/7d4ecb793c5aacb8408f5e578f8944e8/4dcb9/65d8c970527d1182.png 188w,
/static/7d4ecb793c5aacb8408f5e578f8944e8/5ff7e/65d8c970527d1182.png 375w,
/static/7d4ecb793c5aacb8408f5e578f8944e8/1d69c/65d8c970527d1182.png 750w,
/static/7d4ecb793c5aacb8408f5e578f8944e8/1cfc2/65d8c970527d1182.png 900w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;另一个原因是Web用户是没有耐心的。Web是非常开放的，任何一种服务都有很多选择，如果你让用户等待你的网站加载太长时间，他可以直接去寻找你的服务的替代品。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;研究表明，如果你让用户等待3秒，跳出（离开登陆页面）的概率就会增加32%，而5秒就会增加到90%，更多的等待时间会导致更多的客户不满，而你将永远失去这些访客。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Core-Web-Vitals-影响-SEO&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Core-Web-Vitals-%E5%BD%B1%E5%93%8D-SEO&quot; aria-label=&quot;Core Web Vitals 影响 SEO permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Core Web Vitals 影响 SEO&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;2021 年，Google 推出了一项名为 Web Vitals 的计划，旨在让网络更加用户友好和易于访问，并强制网络创建者遵循他们添加的新指标来衡量它们并使他们为谷歌 SEO 排名做出贡献。是什么让每个人都开始质疑他们的网站，我网站的用户体验会影响我的 SEO 排名吗？ 很可能是的，这当然是为了Web用户的利益。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3616dd0843a1ed03affebca7c8e948cc/55681/433d04f2403608fd.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 63.829787234042556%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAADiElEQVQ4y22TbWgbdRzHf5e0da0KOqFMBBlsJLm0xbJ2rL6Z0yHSilVh+PRmE6dWcaRj1NxduroZUIQ1ExyKWuaYOgortTBBa2qzPqW9f5I+BFPXOZlt+pDFpDG5XHL3v0t+ctfi3vjiC783/8/v4fv9w/1uCe5zS1DdJT26U5Caaz3ZxlpPrnGnIDVVd0m7HxTy8JAggeAkpngHeVhgSZPAksZtNfEOsre7IQSGADpyVngzC/BO7hK8l8Mat1y41y0X4ISE0JEbgKNZgLeyFq45YuXsBASWfCI4CQpOUhCcpGjWLPFvN2TANahUnBxSoe2rwvefjavo82dK50eypS8mFHy+rzg0MK8DIjIfwjXmzL4Q8Czp5VkTUjK0XY9xNhE4m8jA10FqvUR06LiqfCveVnE0mqRji5vaXJyia1AZQkR46Ru5utO7WnMARsFTT3wmxEk0UyxBniUBc8I6wsCFCdX65bQOx/uVy4ElBX+eT6nD0U06eUvBdweUwTsywke/KJWn3rhZ+fYDQWOtXs4motsmam6bqLttognk7CK494oM+K6rFRcmS3Dsinr1x4Uc/iAmcCj0N/oXZTzer/z0Z6psrtwDI0x3AzHWOnd2fwS9LRHN2zKre1tmTeDpx0LgfXyWgYsz1Ho5XIKTQ+qpwFLx5vBCOjQczYQmbylL3DW1Jy4hjARzFacPz1d07goCZxd7zzRH8POXY1rf6zf0jw/OIWcXAydqp+Ds/ggDCtUtWhkBsfzkP3n1r9urd2LLa8nfNiUljlh+zrjheEyq6nwqWtUBY4Yp5z31ITz3zILma4vqH+wLI2cTA65dwS2XNUotiGWgmnZQKRbE+MpyIL6yPKoUC2GVam0G8GLnHzuuuGLV7YYpdcTHOwi+v2dG69ozo3P2rRsKdcSYnjFAFl3XQaX0ENW0aCaTmU6n09MqpTFK6bMG0N8Xv6ffc6PqFbhuONn7fy7z7HYONU2zUEpBUZQnEDEsSdJ4NpsdQ8Q5RVVaDeD0dys7fp+KV76wNaEJ5FlCecdd4H85lGXZBKqq+nQymVxeX19fXFtbiyUSiVVVpS8awNFFqdLFhmva4Fcjh58KW2G+KyeZ8NSHjGYMSJIEhUIB8vn8I+l0+tVEInFkY2PjSCqVei0vy7sN4NRMytJzaM5yGPzGIwfPkvbu+lBrd0OoVXCSdt5BDnjqiPmX/wVpt2jcNkazFgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;433d04f2403608fd&quot;
        title=&quot;433d04f2403608fd&quot;
        src=&quot;/static/3616dd0843a1ed03affebca7c8e948cc/1d69c/433d04f2403608fd.png&quot;
        srcset=&quot;/static/3616dd0843a1ed03affebca7c8e948cc/4dcb9/433d04f2403608fd.png 188w,
/static/3616dd0843a1ed03affebca7c8e948cc/5ff7e/433d04f2403608fd.png 375w,
/static/3616dd0843a1ed03affebca7c8e948cc/1d69c/433d04f2403608fd.png 750w,
/static/3616dd0843a1ed03affebca7c8e948cc/78797/433d04f2403608fd.png 1125w,
/static/3616dd0843a1ed03affebca7c8e948cc/aa440/433d04f2403608fd.png 1500w,
/static/3616dd0843a1ed03affebca7c8e948cc/55681/433d04f2403608fd.png 2062w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Web Vitals开始时只有3个新指标。LCP（Largest Contentful Paint）、FID（First Input Delay）和CLS（Cumulative Layout Shift），他们把它们称为Core Web Vitals，这个名单还在不断扩大，它们现在对你的网站的搜索排名贡献很大，至少75%的网站页面应该遵循一些阈值，我将在后面的文章中解释。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;那为什么开发者们忽略&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%82%A3%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BC%80%E5%8F%91%E8%80%85%E4%BB%AC%E5%BF%BD%E7%95%A5&quot; aria-label=&quot;那为什么开发者们忽略 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;那为什么开发者们忽略？&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;如果性能如此重要，你可能会想，为什么开发人员不怎么关注它，实际上有一些很好的理由。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;诊断问题可能是非常棘手的，并且需要工具&lt;/strong&gt;：它甚至可能需要几天的时间才能从页面加载时间中节省几毫秒，因为延迟的原因可能有很多，学习诊断问题所需的工具也使它有点乏味，但完全值得。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;很难获得的真正的胜利&lt;/strong&gt;：研究表明，用户不会觉得一个网站更快，除非你最近的竞争对手或你的最新版本有至少20%的提升，让用户注意到它就是所谓的“真正的胜利”。这可能有点打击积极性，但让性能成为一个持续的任务应该会有帮助。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;需要对网络/浏览器的工作原理有深刻的了解&lt;/strong&gt;：可能需要一些网络知识，以确保你所要求的就是你所得到的，同时以最好的方式消耗你的资源，另一方面，你需要了解客户端时如何处理你的网站，了解主线程以及如何不使其繁忙是至关重要的，不了解这些可能会阻止你做出一个好的优化。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;因为也许YAGNI&lt;/strong&gt;：这是一个编程原则的缩写，意思是 “你不会需要它”，在一个应用程序的某些早期阶段，你可能不需要快速的网站，核心的MVP功能可能在项目阶段得到更多的优先权，推迟性能增强是可以的，直到你确定这些功能会在生产中出现。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;YANGI原则&lt;br&gt;
英文全称是：You Ain’t Gonna Need It。直译就是：你不会需要它。意思非常简单：仅在您真正需要它们时才去做，而不是在您认为或预见将来可能需要它们时就提前做了！实际上，这条原则的核心思想就是：不要做过度设计。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;以上所有的原因并不是忽视性能问题的借口，它可能是你性能优化之旅的一个动力和开始方式。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;性能对用户体验和业务都很重要，它不是可有可无的。因为如果你忽视了 Core Web Vitals，你将失去你的排名。学习所需的工具，学习网络和浏览器的工作原理，确保以一种对所有 Web 用户（包括使用低端设备和连接速度较慢的人）都可以访问的方式构建应用程序。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[「译」是什么使网络慢？浏览器的瓶颈]]></title><description><![CDATA[原作者:  Medhat Dawoud 原文链接：https://medhatdawoud.net/blog/what-makes-the-web-slow 在上一篇文章中我解决了性能优化背后的动机。在这篇文章中，我将简要解释 web 是如何工作的，并解释 web 缓慢背后的核…]]></description><link>https://zhanglun.github.io/blogs/「译」是什么使网络慢？浏览器的瓶颈/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/「译」是什么使网络慢？浏览器的瓶颈/</guid><pubDate>Tue, 19 Apr 2022 13:40:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;原作者:  &lt;a href=&quot;https://medhatdawoud.net/&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;Medhat Dawoud&lt;/strong&gt;&lt;/a&gt;&lt;br&gt;
原文链接：&lt;a href=&quot;https://medhatdawoud.net/blog/what-makes-the-web-slow&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;https://medhatdawoud.net/blog/what-makes-the-web-slow&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;在上一篇文章中我解决了性能优化背后的动机。在这篇文章中，我将简要解释 web 是如何工作的，并解释 web 缓慢背后的核心原因，特别是浏览器的主线程。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Web是如何工作的&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Web%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84&quot; aria-label=&quot;Web是如何工作的 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Web是如何工作的&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;首先，我们需要了解从在浏览器中编写域名开始，直到拥有一个完全交互的网页，Web是如何工作的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;网站通常托管在具有 IP 地址 (x:x:x:x) 的服务器上，该 IP 地址附加到名为域的名称，例如&lt;a href=&quot;http://example.com/&quot; class=&quot;link-underline&quot;&gt;example.com&lt;/a&gt;，因此当用户在浏览器中的地址栏，然后按回车键，这是短暂发生的事情：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;浏览器尝试联系 DNS 服务器，搜索附加到您输入的名称的 IP 地址。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;在浏览器收到正确的 IP 地址后，它会发送从服务器加载页面的请求（在进行 TLS 握手之后）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;然后浏览器从服务器接收字节流并根据其 MIME 类型对其进行翻译。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;然后浏览器开始根据其类型处理每个文件以呈现 HTML 并编译 JS 文件并绘制 CSS 文件等等。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;在网站完全加载之前，浏览器正忙于为您完成所有这些工作以使网站完全交互，然后浏览器可以空闲等待第一个用户输入。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;上述所有这些过程通常需要几秒钟，因此您大多数时候都不会真正注意到它。但可能需要更多时间，具体取决于您对过程中各个方面的实施和理解，当然还有客户端的硬件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;从上面的场景中，我们有 3 个主要角色可能在互联网的缓慢中发挥作用：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;我们托管文件的服务器，&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;我们的在线客户用于使用我们网站的客户端（浏览器）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;中间当然是网络&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;网站速度慢的核心原因&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BD%91%E7%AB%99%E9%80%9F%E5%BA%A6%E6%85%A2%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8E%9F%E5%9B%A0&quot; aria-label=&quot;网站速度慢的核心原因 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;网站速度慢的核心原因&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;服务器速度慢&lt;/strong&gt;：它导致你的服务器响应延迟或高延迟，这当然会导致网站速度变慢。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;慢速连接&lt;/strong&gt;：如果网站在第一次加载时就加载了很多文件，这将是一个非常缓慢的FCP和TTFB，例如在3G慢速连接中。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;大型图片/视频&lt;/strong&gt;：肯定有大型图片或视频的加载时间过长，可能会阻断主干道的时间。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;太多的第三方&lt;/strong&gt;：大多数网站都在使用大量的第三方，如分析和同意管理器等等，它们可能会阻碍你的主要内容的加载。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;庞大的包库&lt;/strong&gt;：几乎所有的网站都在漫不经心地使用一些npm包，而不太注意它的包库大小或速度性能，或者对tree shaking 不关心。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;不好的实现&lt;/strong&gt;：使用不好的算法来处理数据的规模可能会造成很大的影响&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;较大的加载DOM大小&lt;/strong&gt;：这将导致每次改变父元素时都会阻塞到主线程，这也会导致渲染的一些缓慢和用户输入响应性的延迟。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;庞大的文件包&lt;/strong&gt;：将所有的网站代码放在一个或几个文件中会使它们变得太大，明智地分割它们，只加载用户需要的东西是一个挑战。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;上述所有原因都是由于浏览器的工作方式以及客户端和服务器的硬件造成的，在这篇文章中，我更多的是解释为什么 Web 浏览器很慢，并且需要一些理解来使浏览器快速，或者至少对Web用户能觉得更快。现在让我解释一下。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;浏览器是单线程的&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%B5%8F%E8%A7%88%E5%99%A8%E6%98%AF%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84&quot; aria-label=&quot;浏览器是单线程的 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;浏览器是单线程的&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;自从 Web 浏览器诞生以来，它们只有一个主线程，这使得浏览器“理论上”一次只能做一件事，要么渲染 HTML，要么基于 CSS 绘制 UI，要么解码和绘制图像，要么编译和运行 JavaScript。 其中的每一项任务都需要从主线程花费一些时间，这是慢速网站的主要问题，有一些长任务会长时间阻塞主线程，而不会让其他等待任务甚至部分执行。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/08c012b134619dcdfd04bab703d9f03c/c1b63/dd40bef27c239667.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 38.297872340425535%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfElEQVQoz42SsWoVQRiFF3wDUQt3d3Zn/5nZu7M7e29uimiuGLidmMRCKy2MAUURUQRBqwQ0gXSx9w0kINjkFVKprfgeUZsv3M0aREUtPg4M/GfOf2aidm6E9QEllkQb0sL+HW1Iev0T0WSyQD2ax9Xhn4ZJzw/T+BdmZ9HFhSmDtiXO5f8S9oOZNhTaoLUh71XNEo4XL+DDCCkrMuOOo5+s9xOdkekujQuD5MKc0jRZgc8K2kxjcyGS2iNlg/UtynjO55ZYC7EuSAohETnW3HTGqnAdqThiU5L0KFMis4Rm4HHeM6g9dRjQhIrSt1T1uMPaIa4a4tpANRpiQo00HusbnA/YquketaoDTizRypUJXz+/4fDgLt/fRnzbO8Wn1/sc7B7y/sEXds58YPvWHlsfX3Dv3W2yrXPYlylpEBJlTmpI+06j8fyQjWc32Xg0ZXPtNJtrZ3l84z4Pr7/izvQ5K/FTli+ts/zkKpfXl1DXFHpVk5aGJP/9Sx0BODL68Nf32kMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;dd40bef27c239667&quot;
        title=&quot;dd40bef27c239667&quot;
        src=&quot;/static/08c012b134619dcdfd04bab703d9f03c/1d69c/dd40bef27c239667.png&quot;
        srcset=&quot;/static/08c012b134619dcdfd04bab703d9f03c/4dcb9/dd40bef27c239667.png 188w,
/static/08c012b134619dcdfd04bab703d9f03c/5ff7e/dd40bef27c239667.png 375w,
/static/08c012b134619dcdfd04bab703d9f03c/1d69c/dd40bef27c239667.png 750w,
/static/08c012b134619dcdfd04bab703d9f03c/78797/dd40bef27c239667.png 1125w,
/static/08c012b134619dcdfd04bab703d9f03c/c1b63/dd40bef27c239667.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了减轻可能有点棘手的主线程上的任务负载，一种解决方案可能是将任务拆分为较小的可执行任务，这将使主线程能够在所有任务之间切换，并使网站感觉流畅和功能齐全 时间&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;您可能想知道，如果它只有一个，为什么我们称它为主线程？ 这是一个好问题，因为您基本上可以使用 Web Worker 将一些繁重的工作从它转移到其他一些并行线程（您创建），并且可以使用一些浏览器 API 或使用一些使生活更轻松的库将它们连接在一起 工人，例如 chrome 团队的 &lt;a href=&quot;https://github.com/GoogleChromeLabs/comlink&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;comlink&lt;/strong&gt;&lt;/a&gt;，我们可以在另一篇文章中详细说明。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;文件类型影响渲染时间吗&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E5%BD%B1%E5%93%8D%E6%B8%B2%E6%9F%93%E6%97%B6%E9%97%B4%E5%90%97&quot; aria-label=&quot;文件类型影响渲染时间吗 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;文件类型影响渲染时间吗？&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;那当然！相同大小的不同文件可以在相同的网络条件下同时下载，但这里的重点是下载后是什么，浏览器如何处理呢？ 所以在下面的例子中，我们有 2 个文件，一个是 170kb 的 JavaScript，另一个是相同大小的图像。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 736px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cad19dd021507e44e20f85ebffc3b3a5/f941f/fc0129e509da4644.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 64.36170212765958%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACX0lEQVQ4y32S23LbRgyG9f6Pkbsm7UXHSTrTTnvtxGkmsZPYMmWL5mlFkRRFLrncE/V1SEVKfNOdwQI7AH4A+2MB0DR74jieJU1ThBBE0RNFUUxu+r6naRpOZ7LvlnfkeU6SxIiN4HA4zL7FdBVlycPDI0EQcHPzhcf1mtXqgTQVc1DXddR1fU6a7Mcp/v6e6+trRCZgPBZbHA4eOAaO3iLbGmuG+V0VKVkazgDbbU4qUuIkYtDqWKjv6FU/29oP+NGz6Dbv2H59QX77C3XwEpf8holeoaNfabMrBpkei+H55+5vLr79ztvgNa/vL/hj9YY3wQV/BX/yPvyXoitZHLxhdIrRDRy8gnGASR80eV6SipyyLKmqikTEhMmaRjUoq1C2pzMdyiisdjjnWTg/IjtF1yv6fkDKnq4fMMYhZct+XyOlRCmFN57RjvzfWXSdZCMSOtmQpTG7aktVFmw2gv1+PwM55+bgQARcrT5wubzk8+Nn1NBzHX7iw/odH5+uKGXBYiIgiQJ22wdysWaTLmnKgCxaUu1qvHeM4zgzLAfJdr8l3IbEm5hdvSMWEaLK2KsabfVxbbSZ2G1o23ZmVA9yZvznc1qZ7wzN4q0/r8t55O/hGGvRWqO1Qameui7YNQWyrbBGnROkannKQ+IiIiljsiqjaAv86H4ATtWNMfN/TaDeGZq6YLVZEsZrmrI9A4o6431wycfwim/ZDbfpV26zLxinf+6QM+AwDOfkvm/RRjGO/tlYTjuMsuheYwbz7FsWp+4mJk8yva212JN+JgZjDdZZnLOznqaafFOH/wHY2eBGwpOZSAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;fc0129e509da4644&quot;
        title=&quot;fc0129e509da4644&quot;
        src=&quot;/static/cad19dd021507e44e20f85ebffc3b3a5/f941f/fc0129e509da4644.png&quot;
        srcset=&quot;/static/cad19dd021507e44e20f85ebffc3b3a5/4dcb9/fc0129e509da4644.png 188w,
/static/cad19dd021507e44e20f85ebffc3b3a5/5ff7e/fc0129e509da4644.png 375w,
/static/cad19dd021507e44e20f85ebffc3b3a5/f941f/fc0129e509da4644.png 736w&quot;
        sizes=&quot;(max-width: 736px) 100vw, 736px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;正如你所看到的图像，下载之后，然后解码并最终绘制，基于慢速 3G 和 Moto G4 移动（中间层）的测试，下载时间大约需要 3.4 秒，解码约 64 毫秒，最后约 28 毫秒 被光栅化绘制。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;另一方面，JavaScript 文件需要同样多的时间来下载 3.4 秒，然后它进入解析/编译过程，需要大约 2 秒，最后是执行，需要大约 1.5 秒，这两个文件之间有多么大的差异 。所以我们发现 JavaScript 是您网站中最重的资产，它不仅与文件大小有关。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;长任务的问题&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%95%BF%E4%BB%BB%E5%8A%A1%E7%9A%84%E9%97%AE%E9%A2%98&quot; aria-label=&quot;长任务的问题 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;长任务的问题&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;不幸的是，一个主线程在一个任务中启动它不能被中断，如果我们阻塞它太久用户会觉得网站有点滞后，大多数屏幕都以 60fps 运行，这意味着浏览器应该每帧绘制一个新的帧~ 16 毫秒。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这就是为什么浏览器将任何超过 50 毫秒的任务视为一个长任务，它会下降大约 3 帧或更多帧，用户可能会注意到渲染速度很慢，这通常会带来糟糕的用户体验和更多等待用户输入响应的时间。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;我们可以做些什么来增强主线程&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%81%9A%E4%BA%9B%E4%BB%80%E4%B9%88%E6%9D%A5%E5%A2%9E%E5%BC%BA%E4%B8%BB%E7%BA%BF%E7%A8%8B&quot; aria-label=&quot;我们可以做些什么来增强主线程 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;我们可以做些什么来增强主线程？&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;由于主线程是（网络）浏览器的瓶颈，我们可以减轻它的负担吗？ 或者至少使它具有某种性能，一个快速的答案是肯定的，我们可以通过以下方式使主线程具有性能：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;制作一般较小的任务（图像、JS 文件、CSS 文件、字体等）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;将繁重的任务转移到 Web/Service worker 上&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;也许在 SSR（服务器端渲染）上运行您的应用程序，它将在服务器上进行渲染并卸载主线程&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;避免多余的重绘，因为任何时候它发生都会导致浏览器回流，这是昂贵的&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;考虑使用慢速设备构建您的应用程序，这也将使其在所有其他设备上更快&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;并且还可以应用更多的优化，一般尽量让主线程尽快空闲。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在本文中，我们讨论了 Web 的工作原理以及网站运行缓慢的原因，重点介绍了浏览器单线程的主要原因，讨论了文件类型的影响以及 JS 文件与图像相比如何花费更长的时间来处理 相同的文件大小，最后一些快速的想法来减轻主线程的压力。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Storybook 使用手册——编写组件文档]]></title><description><![CDATA[其实在使用手册的前两篇中，已经实现了组件文档的编写。开发过程中编写Story的同时，创建了基本的文档。 此外，Storybook还提供了一些工具，可以用内容和布局来拓展这个基本文档，以突出组件和Story。这在创建组件库的使用指南，设计系统网站时非常好用。下面是一个来自官方的案…]]></description><link>https://zhanglun.github.io/blogs/Storybook 使用手册——编写组件文档/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/Storybook 使用手册——编写组件文档/</guid><pubDate>Tue, 12 Apr 2022 11:00:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;其实在使用手册的前两篇中，已经实现了组件文档的编写。开发过程中编写Story的同时，创建了基本的文档。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;此外，Storybook还提供了一些工具，可以用内容和布局来拓展这个基本文档，以突出组件和Story。这在创建组件库的使用指南，设计系统网站时非常好用。下面是一个来自官方的案例&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://storybook.js.org/1087b42ba17e96364b064e75c1d96d5e/addon-docs-optimized.mp4&quot; class=&quot;link-underline&quot;&gt;image&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果是第一次在你的项目中加入Storybook，可以使用DocsPage，这是一个文档模板，列出了一个组件的所有 Story 和相关的元数据。它根据源代码、类型和JSDoc注释来推断元数据值。如果你需要，你可以定制这个页面来创建你自己的自定义模板。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果你已经在使用Storybook并且更新到最新版本，建议安装@storybook/addon-essentials，以便将这个和其他功能纳入项目。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;也可以使用MDX为每个组件创建自由格式的页面，这是一种同时记录组件和编写故事的格式。在这两种情况下，需要使用Doc Blocks 作为构建模块来创建全功能的文档。Docs是自动配置的，可以在大多数使用情况下开箱即用。在某些情况下，可能需要调整配置，具体的使用可以参考 &lt;a href=&quot;https://storybook.js.org/addons/@storybook/addon-docs&quot; class=&quot;link-underline&quot;&gt;addon-docs&lt;/a&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;DocsPage的使用&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#DocsPage%E7%9A%84%E4%BD%BF%E7%94%A8&quot; aria-label=&quot;DocsPage的使用 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;DocsPage的使用&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;DocsPage 是一个零配置的默认文档，所有的Story都是开箱即得。它将Story、文本描述、docgen注释，args和代码实例都聚合到每一个组件的页面上。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;你可以理解成，最后每个组件对应的那个文档页就是所谓的DocsPage&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;文档的最佳实践是，每个组件都有自己的DocPage 和Story。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;组件参数&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%84%E4%BB%B6%E5%8F%82%E6%95%B0&quot; aria-label=&quot;组件参数 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;组件参数&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;Storybook 使用Story文件中默认导出的 &lt;code&gt;component&lt;/code&gt; 来提取组件的描述和属性。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// MyComponent.stories.js|jsx|ts|tsx

import { MyComponent } from &amp;#39;./MyComponent&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/react/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;MyComponent&amp;#39;,
  component: MyComponent,
};

// Your stories&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;子组件参数&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AD%90%E7%BB%84%E4%BB%B6%E5%8F%82%E6%95%B0&quot; aria-label=&quot;子组件参数 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;子组件参数&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;有时候需要展示多个组件组合使用的场景，比如Button和ButtonGroup，Select和SelectOptions。DocsPage提供了 &lt;code&gt;subcomponent&lt;/code&gt; 属性来接受多个子组件。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// ButtonGroup.stories.js|jsx

import { Button, ButtonGroup } from &amp;#39;./ButtonGroup&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/react/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;ButtonGroup&amp;#39;,
  component: ButtonGroup,
  subcomponents: { Button },
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6e02a8175800044b1374d855ca48c383/32ac3/79d08f69ed043ccc.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 36.17021276595745%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAr0lEQVQoz42QawoDIQyEvf/52r+9gY91q66rZsoEpIXaRyCiTPJljNmq4GIFVye4RaAcB7x38N4jpYRaq95DCGitgSEiH9OUJvCHIDCroA/52vArDSAo6Q7IWE7POas7ul0BqMcYn8AxBsK2wTqHlPIbtPeO8zyXMAaBXAuDLNP7wL7vuieKKyB39w+QterQWqvQ1ZfprpSixZ+gs08d8mADp7CJ79ecDlfa1KdGhw9qBSd9Kd2GzwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;79d08f69ed043ccc&quot;
        title=&quot;79d08f69ed043ccc&quot;
        src=&quot;/static/6e02a8175800044b1374d855ca48c383/1d69c/79d08f69ed043ccc.png&quot;
        srcset=&quot;/static/6e02a8175800044b1374d855ca48c383/4dcb9/79d08f69ed043ccc.png 188w,
/static/6e02a8175800044b1374d855ca48c383/5ff7e/79d08f69ed043ccc.png 375w,
/static/6e02a8175800044b1374d855ca48c383/1d69c/79d08f69ed043ccc.png 750w,
/static/6e02a8175800044b1374d855ca48c383/78797/79d08f69ed043ccc.png 1125w,
/static/6e02a8175800044b1374d855ca48c383/32ac3/79d08f69ed043ccc.png 1249w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;子组件的参数表格会以Tab的形式展示在文档中。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;替换-DocsPage-的内容&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9B%BF%E6%8D%A2-DocsPage-%E7%9A%84%E5%86%85%E5%AE%B9&quot; aria-label=&quot;替换 DocsPage 的内容 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;替换 DocsPage 的内容&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;当然你也可以自定义DocsPage的内容。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;使用null去除文档&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8null%E5%8E%BB%E9%99%A4%E6%96%87%E6%A1%A3&quot; aria-label=&quot;使用null去除文档 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用null去除文档&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;将 &lt;a href=&quot;http://docs.page&quot; class=&quot;link-underline&quot;&gt;&lt;code&gt;docs.page&lt;/code&gt;&lt;/a&gt; 设置为 &lt;code&gt;null&lt;/code&gt; 可以去除文档的内容。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Button.stories.js|jsx|ts|tsx

import { Button } from &amp;#39;./Button&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/react/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;Button&amp;#39;,
  component: Button,
  argTypes: {
    backgroundColor: { control: &amp;#39;color&amp;#39; },
  },
  parameters: {
    docs: {
      page: null,
    },
  },
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;使用-MDX-写文档&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8-MDX-%E5%86%99%E6%96%87%E6%A1%A3&quot; aria-label=&quot;使用 MDX 写文档 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用 MDX 写文档&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;用MDX编写你的文档，更新docs.page参数来显示它。引用的id遵循的模式是：group-subgroup-…-name，其中组和子组的定义是根据分组文档的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;首先编写单独的MDX文件&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;markdown&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;!-- Custom-MDX-Documentation.mdx --&amp;gt;

# Replacing DocsPage with custom `MDX` content

This file is a documentation-only `MDX`file to customize Storybook&amp;#39;s [DocsPage](https://storybook.js.org/docs/react/writing-docs/docs-page#replacing-docspage).

It can be further expanded with your own code snippets and include specific information related to your stories.

For example:

import { Story } from &amp;quot;@storybook/addon-docs&amp;quot;;

## Button

Button is the primary component. It has four possible states.

- [Primary](#primary)
- [Secondary](#secondary)
- [Large](#large)
- [Small](#small)

## With the story title defined

If you included the title in the story&amp;#39;s default export, use this approach.

### Primary

&amp;lt;Story id=&amp;quot;example-button--primary&amp;quot; /&amp;gt;

### Secondary

&amp;lt;Story id=&amp;quot;example-button--secondary&amp;quot; /&amp;gt;

### Large

&amp;lt;Story id=&amp;quot;example-button--large&amp;quot; /&amp;gt;

### Small

&amp;lt;Story id=&amp;quot;example-button--small&amp;quot; /&amp;gt;

## Without the story title defined

If you didn&amp;#39;t include the title in the story&amp;#39;s default export, use this approach.

### Primary

&amp;lt;Story id=&amp;quot;your-directory-button--primary&amp;quot;/&amp;gt;

### Secondary

&amp;lt;Story id=&amp;quot;your-directory-button--secondary&amp;quot;/&amp;gt;

### Large

&amp;lt;Story id=&amp;quot;your-directory-button--large&amp;quot;/&amp;gt;

### Small

&amp;lt;Story id=&amp;quot;your-directory-button--small&amp;quot; /&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;然后在Story中引入，&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Button.stories.js|jsx|ts|tsx

import { Button } from &amp;#39;./Button&amp;#39;;

import CustomMDXDocumentation from &amp;#39;./Custom-MDX-Documentation.mdx&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/react/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;Button&amp;#39;,
  component: Button,
  argTypes: {
    backgroundColor: { control: &amp;#39;color&amp;#39; },
  },
  parameters: {
    docs: {
      page: CustomMDXDocumentation,
    },
  },
};

const Template = (args) =&amp;gt; ({
  //👇 Your template goes here
});

export const Primary = Template.bind({});
Primary.args = {
  backgroundColor: &amp;#39;primary&amp;#39;,
};

export const Secondary = Template.bind({});
Secondary.args = {
  backgroundColor: &amp;#39;secondary&amp;#39;,
};

export const Large = Template.bind({});
Large.args = {
  size: &amp;#39;large&amp;#39;,
};

export const Small = Template.bind({});
Small.args = {
  size: &amp;#39;small&amp;#39;,
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;使用自定义的组件&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E7%BB%84%E4%BB%B6&quot; aria-label=&quot;使用自定义的组件 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用自定义的组件&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;Storybook的UI界面使用React开发的。如果你想使用一个自定义组件来展示文档，可能需要一些项目所需的配置和环境。然后用自定义的组件替换 &lt;a href=&quot;http://docs.page&quot; class=&quot;link-underline&quot;&gt;&lt;code&gt;docs.page&lt;/code&gt;&lt;/a&gt; 参数即可。比如下面是自定义的组件，&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// CustomDocumentationComponent.js|jsx

import React from &amp;#39;react&amp;#39;;

export function CustomDocumentationComponent() {
  return (
    &amp;lt;div&amp;gt;
      &amp;lt;h1&amp;gt;Replacing DocsPage with a custom component&amp;lt;/h1&amp;gt;
      &amp;lt;p&amp;gt;
        The Docs page can be customized with your own custom content written as a React Component.
      &amp;lt;/p&amp;gt;
      &amp;lt;p&amp;gt;
       Write your own code here👇
      &amp;lt;/p&amp;gt;
    &amp;lt;/div&amp;gt;
  );
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;然后依样画葫芦替换参数，&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Button.stories.js|jsx|ts|tsx

import { Button } from &amp;#39;./Button&amp;#39;;

import { CustomDocumentationComponent } from &amp;#39;./CustomDocumentationComponent&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/react/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;Button&amp;#39;,
  component: Button,
  argTypes: {
    backgroundColor: { control: &amp;#39;color&amp;#39; },
  },
  parameters: {
    docs: {
      **page: CustomDocumentationComponent,**
    },
  },
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;混合使用-Doc-blocks&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%B7%B7%E5%90%88%E4%BD%BF%E7%94%A8-Doc-blocks&quot; aria-label=&quot;混合使用 Doc blocks permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;混合使用 Doc blocks&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;Doc blocks 是Storybook Docs的基本构建块。 DocsPage 对 Doc Block进行组合，提供一个靠谱的，开箱即用的UI文档体验。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果你想对默认的DocsPage做一些小的定制，但又不想写你的MDX，你可以重新混合DocsPage。这样可以在不失去 Storybook 的自动文档生成功能的情况下，重新排序、添加或省略文档块。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;下面是一个使用 Doc Block 为Button组件重建DocsPage的例子。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Button.stories.js|jsx

import React from &amp;#39;react&amp;#39;;

import {
  Title,
  Subtitle,
  Description,
  Primary,
  ArgsTable,
  Stories,
  PRIMARY_STORY,
} from &amp;#39;@storybook/addon-docs&amp;#39;;

import { Button } from &amp;#39;./Button&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/react/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;Button&amp;#39;,
  component: Button,
  parameters: {
    docs: {
      page: () =&amp;gt; (
        &amp;lt;&amp;gt;
          &amp;lt;Title /&amp;gt;
          &amp;lt;Subtitle /&amp;gt;
          &amp;lt;Description /&amp;gt;
          &amp;lt;Primary /&amp;gt;
          &amp;lt;ArgsTable story={PRIMARY_STORY} /&amp;gt;
          &amp;lt;Stories /&amp;gt;
        &amp;lt;/&amp;gt;
      ),
    },
  },
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;简单介绍了Storybook中DocsPage的概念，以及DocsPage的使用方法。文中也提到了MDX和DocBlock，接下来的内容将详细介绍这两个新鲜事物。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Storybook 使用手册——组件命名和结构层次]]></title><description><![CDATA[上一篇中介绍了什么是Storybook，以及基本的使用方法。本文将介绍在Storybook中组件组织和结构划分的一些技巧，内容来自官方推荐。 在侧边栏展示导出的Story 前面提到过，story 文件可以有默认导出和具名导出两种方式，导出的对象都会在左边的侧边栏展示。具体来说，…]]></description><link>https://zhanglun.github.io/blogs/Storybook 使用手册——组件命名和结构层次/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/Storybook 使用手册——组件命名和结构层次/</guid><pubDate>Sun, 03 Apr 2022 07:00:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;上一篇中介绍了什么是Storybook，以及基本的使用方法。本文将介绍在Storybook中组件组织和结构划分的一些技巧，内容来自官方推荐。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;在侧边栏展示导出的Story&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9C%A8%E4%BE%A7%E8%BE%B9%E6%A0%8F%E5%B1%95%E7%A4%BA%E5%AF%BC%E5%87%BA%E7%9A%84Story&quot; aria-label=&quot;在侧边栏展示导出的Story permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;在侧边栏展示导出的Story&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;前面提到过，story 文件可以有默认导出和具名导出两种方式，导出的对象都会在左边的侧边栏展示。具体来说，默认导出的对象作为父级，其余具名导出的对象作为子级。就拿Storybook中提的例子来展示，下面是Story的内容。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;import { Button } from &amp;#39;./Button&amp;#39;;

// More on default export: https://storybook.js.org/docs/react/writing-stories/introduction#default-export
export default {
  title: &amp;#39;Example/Button&amp;#39;,
  component: Button,
  // More on argTypes: https://storybook.js.org/docs/react/api/argtypes
  argTypes: {
    backgroundColor: { control: &amp;#39;color&amp;#39; },
  },
};

// More on component templates: https://storybook.js.org/docs/react/writing-stories/introduction#using-args
const Template = (args) =&amp;gt; &amp;lt;Button {...args} /&amp;gt;;

export const Primary = Template.bind({});
// More on args: https://storybook.js.org/docs/react/writing-stories/args
Primary.args = {
  primary: true,
  label: &amp;#39;Button&amp;#39;,
};

export const Secondary = Template.bind({});
Secondary.args = {
  label: &amp;#39;Button&amp;#39;,
};

export const Large = Template.bind({});
Large.args = {
  size: &amp;#39;large&amp;#39;,
  label: &amp;#39;Button&amp;#39;,
};

export const Small = Template.bind({});
Small.args = {
  size: &amp;#39;small&amp;#39;,
  label: &amp;#39;Button&amp;#39;,
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在页面中展示的效果如下：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 416px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/98cb105a25e5c53bbe1cf3586d6174de/b0122/53d0b5e275d6166d.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 113.29787234042554%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAADMElEQVQ4y5WUz24bVRTGZ4/aB0A8QNUskcqCFeqOJ0DiAeA92PEQQBdFiKQliasobZ2mEUGK62Lc2HWa4tTxeJI0tusZ2/N/7p0futczxnGcFkb6dM6c+eab82fuMYIwwY8lvkzxI4EfJnhBfCXU8yDj5X4OdW8okWAUEFgDQj8mSdGXMjKzOdQVqo/PCM0Ku36E4QPxZhW+X6e7W2dz5yk7T3/neaXKi9pLnmzvUKnu86xcobi1zcAeTUUVhmOf/mCo7VQwelKH7+5jl15R/GOX1dWCfvnR4y1W1wo8fFSk8GCDX5fv0e0NiJJ0KugMXUzrjIEzZuyFWclupEsOvEiXnJcbCxDpxJdZyYvKzPs7yVA9iCWBZGIz8nzz82HND0HZPK4F84AfxDplBS+INEZuoO//zSLS/tgLpiKXhqIcZ+RhD126fRvTOuXYtDg77+tmq95YJ2952+3Tandomyea0x84lzKeCipHTUllpDDrz8ZyLOKpLLMeKvUkw8We/R/oxNSUXTV6X+D4CSMvwo/ViUm1dUOBG/wXJJrruCEGIqQzlLR7Yw6rZY4PD6iV9zhrNUFEgIA0AfkBpALiEKNoCjaOBQ9aMfcbDisvHe6+GLDcGLP2JqHQEmy2BYr3+D0odiSbb0KM63ck134SfHxXsnQPPluHLx/CrTX4fF1ya1Xwyc+Cj34UTLiLILh2R3L9hxBjaUVwY1nw6W+SLwqC2xspX2/DV1sp3+7CN7twewNuLEuWViRLy2IxViQ3fwkxmrbgyBYcvEuo9GMq5pDSsUPlxOWZOWavZVMxHQ57Ic1BguJfwiDhyJa86gYYIkkgEYzDCCuKsNptKuUyh40Gjdo+9WqV56USlmkiE4HiyzmoWCoEgedjeKHAU+dU/Y+h0Es2TNKp9cLst1BHb4Z7EQl+JLFH3mQ5RJGg50fURy4d65Tyn3+xVypTqx/o3Te/DBZtasVzcsE86GYbRR2p8947fb7nF8BVq18JKr4WDCOBHUScBDFm55S/my2OWm1abUvvxHmBeVwp2FGip+e8brbYrzUuCL5PNBdUm8mYBiJBrCAgkdnGlh/Obl7wH4AVtWm6WurUAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;53d0b5e275d6166d&quot;
        title=&quot;53d0b5e275d6166d&quot;
        src=&quot;/static/98cb105a25e5c53bbe1cf3586d6174de/b0122/53d0b5e275d6166d.png&quot;
        srcset=&quot;/static/98cb105a25e5c53bbe1cf3586d6174de/4dcb9/53d0b5e275d6166d.png 188w,
/static/98cb105a25e5c53bbe1cf3586d6174de/5ff7e/53d0b5e275d6166d.png 375w,
/static/98cb105a25e5c53bbe1cf3586d6174de/b0122/53d0b5e275d6166d.png 416w&quot;
        sizes=&quot;(max-width: 416px) 100vw, 416px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;控制Story展示的层级关系&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%8E%A7%E5%88%B6Story%E5%B1%95%E7%A4%BA%E7%9A%84%E5%B1%82%E7%BA%A7%E5%85%B3%E7%B3%BB&quot; aria-label=&quot;控制Story展示的层级关系 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;控制Story展示的层级关系&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;可以看到 &lt;code&gt;title&lt;/code&gt; 的值是一个字符串，允许使用&lt;code&gt;/&lt;/code&gt;作为分隔符，产生层级效果，可以用以对Story进行分组。比如下面这个例子&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Button.stories.js|jsx|ts|tsx

import { Button } from &amp;#39;./Button&amp;#39;;

export default {
   /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/react/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;Design System/Atoms/Button&amp;#39;,
  component: Button,
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Checkbox.stories.js|jsx|ts|tsx

import { CheckBox } from &amp;#39;./Checkbox&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/react/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;Design System/Atoms/Checkbox&amp;#39;,
  component: CheckBox,
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 417px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b0dd5aa9b33de486363e56503ae4c63d/f27fb/3e25a9e79acfc936.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 107.97872340425532%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAACeElEQVQ4y5VUaW/aQBDl/3+q+hvSVg1tlKiqKlW9oqRtlAsFcIAkJASDjTEYfK5PXjUD6xiHqImlpzl29u3M7HgrQZQiSBcIkgyBiOGvEITJRl1QfJjkIFuC7AobpgtheUgy8EciWSwlIV0Ai5VeJinC8QQqYuIie/0FePsbSrOF7z/3cdFQcNPtoXbRwMlZDdfdHk5Oa+yP0wdSytiaOZhYNutzx0eFMstefQa2DnF+foHt6ke8367i1/4Bqh92sLv3CTu7e9h68w5fv/1AnD0QekEEYzyFNjJZZ0LqoVCnEP0JRJxx2QTKJFzZpFPZpMs+yp4REYEzdANUBJ1Gp2bY2PCiXexfeZ30ZYZ0g0HEN+z6IUt5MjWZZJmUfJsOzwmnM4fJ1IGOwXDEcmrZ7J9Yc+6Rpo/R6w8w0EYY6gbHl285J6RMKIBguwFmtsc6ZSJ9hLntsaR4uUf2b41QbpQBRbvoK6K8nhOSEiULvtFwJdmWvidAMRtLphPaV110b+95gNXhiOXNbQ+6YaI/0HHfH+Kup+Je1Ri0plx21n7FQoYJ5o7LqfuFG6Zeyf7JnjkrnTZSn4ujkxM6bgTHXkA3puje9fmWKSPPD7k0ClzKbM2W+qOxcZwIphFD08ao15toda6htDqw5i5vKs/gU1i7lDBOMAsBJwJsx2ciKk22oPxnlJ+sR4MdBCEUM0XbCHD09whntToODv+gqbRz0ucT5otLp+uLtU00HvQ4bCJ7MkMhQjTMFFeTCI1Gg9+9y/YVjk/POcvOdfdlJYswxtRPYXkxxubyfaN5HGgG1KHO8/hswry0KEFYKLGMl5XMzvRZo/G/DP8BxlCYNLub6PAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;3e25a9e79acfc936&quot;
        title=&quot;3e25a9e79acfc936&quot;
        src=&quot;/static/b0dd5aa9b33de486363e56503ae4c63d/f27fb/3e25a9e79acfc936.png&quot;
        srcset=&quot;/static/b0dd5aa9b33de486363e56503ae4c63d/4dcb9/3e25a9e79acfc936.png 188w,
/static/b0dd5aa9b33de486363e56503ae4c63d/5ff7e/3e25a9e79acfc936.png 375w,
/static/b0dd5aa9b33de486363e56503ae4c63d/f27fb/3e25a9e79acfc936.png 417w&quot;
        sizes=&quot;(max-width: 417px) 100vw, 417px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;不过，还是建议按照文件的目录层级来对组件命名。这样的好处是展示效果和实际目录能够映射起来，方便管理。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;单个Story的提升&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8D%95%E4%B8%AAStory%E7%9A%84%E6%8F%90%E5%8D%87&quot; aria-label=&quot;单个Story的提升 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;单个Story的提升&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;要注意的是，如果一个story文件中只有一个具名导出的story，同时这个story的名字和组件名完全一致，那么这个story将会代替它的父组件，展示在侧边栏中。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Button.stories.js|jsx|ts|tsx

import { Button as ButtonComponent } from &amp;#39;./Button&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/react/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;Design System/Atoms/Button&amp;#39;,
  component: ButtonComponent,
};

// This is the only named export in the file, and it matches the component name
export const Button = (args) =&amp;gt;({
  //👇  Your story implementation goes here
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 417px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/67eb95df0a02f3e9a4d84a2b2bd80167/f27fb/3ecbbf5aea605fd5.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 107.97872340425532%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAACcElEQVQ4y5VUaU/bQBDN//9U9TfQVoUWgVBVqeqFoKgqRxRIIAECJnbsOKe9vs9XzZB1HJOojaXRHDv79s3seGt+lMJPc/hJBj+I4c3FD5OVdkD5YVII+VLIr7EzchBMXSQZ+COV5M+aJM2BfG5XQcoi3AC1YOwge/0ZePsLreYNvv04ROOqhfuugnrjCqfnddx1FZye1TkepwtQYjydCYynNtuW8FAjZtmrT8DWMS4uGtje+Yj32zv4eXiEnQ+72Ns/wO7ePrbevMOXr98RZwtA149gDifQByO2GZB6GKgTBL0xgjjjskmISTj3yaayyZZ9lD0jIBJm6PioBXQanZphZcPLfrl/1XWynxnSDfoR37DjhazlydRk0lVQiq06vACczASDqZoBrT9gPZnaHB9PLe6Rbgyh9DRo+gB9w+T86i0XgMSEEkhsx8fMdtkmJjJGYtkua8qXe2T/lgDlRplQ9suxslTXC0AyoiTnGw3nmn0ZWyOUs7JkOqF920X34YkHWO0PWN8/KDDMEXqagadeH4+KiidVZ6G11nVn6VcsMUxgCYepe6Ubpl7J/smeiblNG6nP5dEpAIUTQdg5DHOC7mOPb5kYuV7IpVHis86WfGm/GBshIozMGLo+ROOyiZvOHVo3HUwthzdVZ3CdLEqO6VJSiDiDm+SwhcdAVJpsQfXPqD5ZLwY7DFMobgDFEjg5+Y3zegNHxydottoF6EaAxUKUwvGCpU00HvQ4rAJbzzBK8eAG6DkeLhtNfveu27f4c3bBLDt33c0ZWvT8lN43mkdNN6H2DZ7H/waUQWIZlkqsykYlr3r31o3Gvxj+BTT1mHpTUGOLAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;3ecbbf5aea605fd5&quot;
        title=&quot;3ecbbf5aea605fd5&quot;
        src=&quot;/static/67eb95df0a02f3e9a4d84a2b2bd80167/f27fb/3ecbbf5aea605fd5.png&quot;
        srcset=&quot;/static/67eb95df0a02f3e9a4d84a2b2bd80167/4dcb9/3ecbbf5aea605fd5.png 188w,
/static/67eb95df0a02f3e9a4d84a2b2bd80167/5ff7e/3ecbbf5aea605fd5.png 375w,
/static/67eb95df0a02f3e9a4d84a2b2bd80167/f27fb/3ecbbf5aea605fd5.png 417w&quot;
        sizes=&quot;(max-width: 417px) 100vw, 417px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;对Story进行排序&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AF%B9Story%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F&quot; aria-label=&quot;对Story进行排序 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;对Story进行排序&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;默认情况下，story按照导入的顺序排序。可以使用storySort参数自定义story的顺序。storySort的值可以是一个对象，包含四个可选值。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// .storybook/preview.js

export const parameters = {
  options: {
    storySort: {
      method: &amp;#39;&amp;#39;, // 可选。排序的方法。默认值是 Storybook configuration。例如：&amp;#39;alphabetical&amp;#39;
      order: [],  // 可选。需要展示的名字。默认值是空数组。例如：[&amp;#39;Intro&amp;#39;, &amp;#39;Components&amp;#39;]
      includeName: true, // 可选。排序计算中是否包含story的name。默认值是 false
      locales: &amp;#39;&amp;#39;, // 可选。展示的语言。默认值是系统语言。例如：&amp;#39;en-US&amp;#39;
    },
  },
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;也可以是一个函数&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// .storybook/preview.js

export const parameters = {
  options: {
    storySort: (a, b) =&amp;gt;
      a[1].kind === b[1].kind ? 0 : a[1].id.localeCompare(b[1].id, undefined, { numeric: true }),
  },
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;可以使用配置Story的标题和名称控制Story的展示层级，不过还是推荐按照组件的文件目录来命名。除此之外，自定义排序的能力也让Story的展示变得更加灵活。下一步，我们将研究如何使用Storybook来构建页面。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;参考&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%82%E8%80%83&quot; aria-label=&quot;参考 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://storybook.js.org/docs/vue/writing-stories/naming-components-and-hierarchy&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;Naming components and hierarchy&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Node.js 将要内置测试模块]]></title><description><![CDATA[前两天上网冲浪时，在Node的Github仓库中，有这么一个Pull Request test: add initial test module #42325 ，顺着这个PR，可以找到一个提案：Proposal: Adding a built-in test runner 。 …]]></description><link>https://zhanglun.github.io/blogs/Node.js 将要内置测试模块/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/Node.js 将要内置测试模块/</guid><pubDate>Wed, 30 Mar 2022 12:10:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;前两天上网冲浪时，在Node的Github仓库中，有这么一个Pull Request &lt;a href=&quot;https://github.com/nodejs/node/pull/42325&quot; class=&quot;link-underline&quot;&gt;test: add initial test module #42325&lt;/a&gt; ，顺着这个PR，可以找到一个&lt;a href=&quot;https://github.com/nodejs/node/issues/40954&quot; class=&quot;link-underline&quot;&gt;提案：Proposal: Adding a built-in test runner&lt;/a&gt; 。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;原来关于Node.js内置测试模块的提案，而网友也提交了相关的实现。Node社区正在向Node核心添加一个内置的测试模块。它将以新的node:test模块的形式出现，暴露了一个用于创建和执行JavaScript测试的API。测试执行的结果将使用标准的 &lt;a href=&quot;https://testanything.org/&quot; class=&quot;link-underline&quot;&gt;TAP 格式&lt;/a&gt; 输出。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;为什么要内置测试模块呢&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%86%85%E7%BD%AE%E6%B5%8B%E8%AF%95%E6%A8%A1%E5%9D%97%E5%91%A2&quot; aria-label=&quot;为什么要内置测试模块呢 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;为什么要内置测试模块呢？&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;测试在软件开发过程中，从来都是最关键的一环。JavaScript作为一门动态语言，在测试阶段更加需要保证所有代码都被覆盖。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;目前，在JavaScript生态中，还没有一个开箱即用的测试工具。正因为如此，想Mocha、Jest等第三方测试框架才有机会流行。但是使用这些三方框架，会让你的项目配置和工作流程变得复杂，也增加了维护成本。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;还有一个JavaScript生态的通病就是，某一类问题的解决方案总是会有多种选择。你要是想弄清楚不同工具的使用，时常会让自己头疼。不同团队的选型会不一样，即使是相同的框架，最后在实践过程中也五花八门。原因在于缺乏强大的社区力量来帮忙解决这些问题。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;所以，如果官方社区能够站出来，提供一个标准化的、通用性强的方案就至关重要。通过添加内置的测试模块，以轻量级的方式实现绝大多数测试框架提供的功能子集。这样以来，用户可以从一开就快速入门，社区也将出现标准化的测试方案。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;它是如何工作的&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%83%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84&quot; aria-label=&quot;它是如何工作的 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;它是如何工作的？&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;按照PR上给到的信息可以看出，将会增加一个叫做 &lt;code&gt;node:test&lt;/code&gt; 的核心模块。目前的版本中还只是支持执行单个测试文件，但最后预期的效果是可以通过 &lt;code&gt;—test&lt;/code&gt; 标志来自动执行配置中定义的所有测试。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const test = require(&amp;#39;node:test&amp;#39;);
const assert = require(&amp;#39;assert&amp;#39;);

test(&amp;#39;synchronous passing test&amp;#39;, (t) =&amp;gt; {
  assert.strictEqual(1, 1);
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;实际使用的方法相当简单，&lt;code&gt;test([name][, options][, fn])&lt;/code&gt;。测试完成后返回一个Pormise。在目前的实现中，有一些突出的设计考虑：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;当使用 —test 标志启动时，Node将执行所有包含测试模块的文件。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;测试文件将在隔离状态下运行&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;一个文件的测试可以是同步的，也可以是异步的&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;同步测试如果没有抛出异常，将被视为通过&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;异步测试将返回一个Promise，如果返回的Promise没有拒绝，将被视为通过&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;测试上下文的test()方法允许创建子测试，每个子测试的执行情况与顶级测试功能完全相同&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;通过想测试传递跳过选项或调用测试上下文的skip()方法可以跳过单个测试。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;比如，你可以跳过测试：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;test(&amp;#39;skip option with message&amp;#39;, { skip: &amp;#39;this is skipped&amp;#39; }, (t) =&amp;gt; {
  // 这里的代码将不会执行
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;你也可以创建子测试：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;test(&amp;#39;top level test&amp;#39;, async (t) =&amp;gt; {
  await t.test(&amp;#39;subtest 1&amp;#39;, (t) =&amp;gt; {
    assert.strictEqual(1, 1);
  });

  await t.test(&amp;#39;subtest 2&amp;#39;, (t) =&amp;gt; {
    assert.strictEqual(2, 2);
  });

});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;对于一个函数来说，测试模块提供的test方法相当简单易懂，下面列出了不同参数的信息：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;name - 输出到报告的名称&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;options - 该测试的配置参数，目前支持三个&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;concurrency { number } - 定义多少个测试并行运行&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;skip { boolean | string } - 如果为真则跳过测试。如果是string类型，跳过之后会在输出报告中打印对应的字符串&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;todo{ boolean | string } - 如果为真，将测试标记为todo。如果是string类型，跳过之后会在输出报告中打印对应的字符串&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;fn - 实际的测试函数本身，它将接受一个 TestContext 对象作为参数。传递给 fn 参数的 TestContext 对象可用于执行一些操作，如跳过测试，添加额外的 TAP 诊断信息，或创建子测试。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;什么时候可以使用&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8&quot; aria-label=&quot;什么时候可以使用 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;什么时候可以使用&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;目前还处于早期开发阶段，未来可能有变化，感兴趣的话可以关注上面提到的PR。如果想抢先体验，可以现在后续的&lt;a href=&quot;https://nodejs.org/download/nightly/v18.0.0-nightly20220324094b2ae9ba/&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;nightly build&lt;/strong&gt;&lt;/a&gt; 版本中使用。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;Node在今年2月份正式添加了Fetch模块。在此之前，&lt;a href=&quot;https://www.npmjs.com/package/request&quot; class=&quot;link-underline&quot;&gt;request module&lt;/a&gt; 是Node中进行HTTP请求的最流行方法。但是，整个JavaScript生态系统迅速发展，新引入的模式使request过时了：一个重要例子是async/await。request API中没有这方面的规定，而且由于这些限制，该项目后来被废弃了。虽然后来有 Axios等优秀新生代出现，但谁知道会不会出现第二个request模块呢？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;社区将 Fetch 纳入内置模块是不是也是一种标准化的体现呢？而现在又开始支持内置的测试模块，进一步将生态推向标准化。Node的未来应该会越来越好吧?&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Storybook 使用手册——基本概念]]></title><description><![CDATA[什么是Storybook Storybook 是一个用于UI开发的开源工具，通过隔离组件，使开发更快、更容易。它提供了一套完整的开发流程，你可以不用配置一个复杂的开发环境、不用和数据库交互，也不需要和你的应用程序关联。 Storybook可以帮你记录组件的文档，以便重复使用，并…]]></description><link>https://zhanglun.github.io/blogs/Storybook 使用手册——基本概念/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/Storybook 使用手册——基本概念/</guid><pubDate>Wed, 16 Mar 2022 05:08:00 GMT</pubDate><content:encoded>&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;什么是Storybook&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%80%E4%B9%88%E6%98%AFStorybook&quot; aria-label=&quot;什么是Storybook permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;什么是Storybook&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;Storybook 是一个用于UI开发的开源工具，通过隔离组件，使开发更快、更容易。它提供了一套完整的开发流程，你可以不用配置一个复杂的开发环境、不用和数据库交互，也不需要和你的应用程序关联。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Storybook可以帮你记录组件的文档，以便重复使用，并自动对你的组件进行视觉测试来防止出现bug。同时Storybook还有一个插件的生态系统来扩展自身的能力，如微调响应式布局或验证可访问性。支持多种前端框架，甚至目前还在进行试验性的支持服务端渲染组件框架。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当你启动执行 &lt;code&gt;yarn storybook&lt;/code&gt; 时，会启动一个dev server，并自动在浏览器中打开一个页面，显示欢迎界面。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9e26acafef8375af74e59b7540484fe9/3b2f8/f7e96e2bf70ae38b.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 84.04255319148936%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVQ4y51SzW5bZRC9y254AhbJM7CgG4pqJ30Zlk28KU/BkyAhUXXRIiHxDyJyk1u4iUGWfVO7sWP7fv+/c6r53EBU4SwY6Wju6H5zdObMVN99/dWHp8Pvj8dtO2j+bI6bV/WgruvBeDwezGazgslkUur5fD6Yzeal5jd1/YrzcdOcH12MRp8/f/Hio+rsp18fXY0nWCwWEJ3EfGOglIYxBtZaGIYx/9T2Xc1vbkNIiaY5f1J98/Np7+83Kv21MHGmcjA+Rmtt9N5H7100xkQOALsQAFgAaNvLx9UXz4a9L//Y4Ok44tvXRG3bUl3XNBqN6OLigs7OTmk6nVIIgay1Jd+G954Rc86YTtuj6mw47BmlgBSBnEhrjfV6jc1mg+vVCutOYrXeFEuWyyWEEAVd10EpBa0198QQAis8qn47edmTJkC7BOMTeedgtN76FSKEJ2gXYe3WQ+c8nNv66L0HEVHO+V+Fv5+87CnjYX2C84lsTOiUghSiEOeUACKUoIxoJaRShZxJmJC95DR5n9CHRDoSBG9RSihW6hx4J9yVU4CVS0ileVQ455BS2k3oQiZvVfHPGFtG4iZWwhFTQidWRR3/4xxjvIPQJ2I13MgPGOnWN+PdmCXzv5zzHSP7RDImCK2Lh7zNG3XFKYpIrkMnJLx3tzyk3QpdzpBaFzL2ic9hq453EuHNuhDy1m+2THQHYaZclsF3xg03CjlCDljJBbpNV7xl8HH/18jEN+h8yj7brI3KWptsrS1wzmXvfc58csW+nFNKBRxEFHIhnD6uToanB8ZF+EgIcXtvBML/ifbyclD98OMvn1wt19fLVXe9XG2WQsjr3RC7cCWE8E1z/ln18f379w4PH+31+wf7/f7B3sNef38XejvwsNff6x8c7j948OkHbwGtOL2K4u5uegAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;f7e96e2bf70ae38b&quot;
        title=&quot;f7e96e2bf70ae38b&quot;
        src=&quot;/static/9e26acafef8375af74e59b7540484fe9/1d69c/f7e96e2bf70ae38b.png&quot;
        srcset=&quot;/static/9e26acafef8375af74e59b7540484fe9/4dcb9/f7e96e2bf70ae38b.png 188w,
/static/9e26acafef8375af74e59b7540484fe9/5ff7e/f7e96e2bf70ae38b.png 375w,
/static/9e26acafef8375af74e59b7540484fe9/1d69c/f7e96e2bf70ae38b.png 750w,
/static/9e26acafef8375af74e59b7540484fe9/78797/f7e96e2bf70ae38b.png 1125w,
/static/9e26acafef8375af74e59b7540484fe9/aa440/f7e96e2bf70ae38b.png 1500w,
/static/9e26acafef8375af74e59b7540484fe9/3b2f8/f7e96e2bf70ae38b.png 2790w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;什么是-story&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%80%E4%B9%88%E6%98%AF-story&quot; aria-label=&quot;什么是 story permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;什么是 story&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在Storybook中，一个story包含了一个组件渲染时的状态。开发者可以给一个组件写多个story。可以简单的将一个story理解成一个包含了组件特定状态的demo。可以在案例中看到，默认会展示Button，Header和Page三个例子。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在代码层面来看，一个.stories.js就是一个story。这个文件包含了渲染时的状态。最终也会在web中以一个单独的案例呈现。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Button.stories.js

import Button from &amp;#39;./Button.vue&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/vue/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;Button&amp;#39;,
  component: Button,
};

export const Primary = () =&amp;gt; ({
  components: { Button },
  template: &amp;#39;&amp;lt;Button primary label=&amp;quot;Button&amp;quot; /&amp;gt;&amp;#39;,
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8710faece836fb92009de1a643488c28/c8252/649ccbc1c9da3c58.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 76.06382978723406%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACe0lEQVQ4y6WSTU8TURSGrzHGr9m4IZHWECQSpMGFxJUr/5F7VxPjXyAxstDACmmBf6BLSRTaYiP0Y9qZEi3S6cydz96Pec2dsUADGBLf5E3uOcl57jnnXvLi1vPr5e3PL/ca1Tdto63XajW9Winr+wd13ep2dcuy9FbL0BvNpm5ZWVyv1/VKpaJXKlW9Wq3qrVbr9c7O7qulpaV7ZGF+8e5hbb9vtA30jvroD1z0+i58z0Pg+/D9AC6lcBwX1PMQhiF834frunBdCsfN8r3eEd5/WCmQqdkZbdD3jIETwHYDxrkUmx2I1QYEcCVzAAnngq6XNgtkfm5Os/vHHY964IzLhPPE9GRy4CSpkJxKFV4gCQDD4dBf+1gskPuzT7Tlb7a5Wrax8oPJYlNdqmrT6qs4OQGulwrk8cwjbe+nZ34/dNC0mey4AlwmkMkpMIPjnC4EPl18pvWO+iZ1KaSQkjN+tmSs00u6zoCMZcCp6Yfab5uaQcwRxkKGMYcQAlxIBCwBEzItlFKm+cwyjZVH642iKANOTk5qDg3MmEmEMZfRUCCKQvhDgV9BgoAn4JyBc37pDoVMQIPIL5VKBZLL57WB648BHceBbdtgwzgdM47j1AqqTCmF53mjWH0Z+GHkF0sbBZLL5TWHjgODIABj7OQh1CdWFyjAaPTRyFLKdOSTR8nlcqpDIwXFnIUxE2EYCSUppVATRVEkwjBM41H+jPnfHdK19dI8yecfaF4QH4sEYALgEml3ZzXq5l9SYxc3thbIxMTEnYOGsWV0uruttvml1Ta3Las7ZtO0MquzZZ2z1e1+bbc7n96+W54mhJBrhJAbhJDb/+mbivUH5afj0V5EUs8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;649ccbc1c9da3c58&quot;
        title=&quot;649ccbc1c9da3c58&quot;
        src=&quot;/static/8710faece836fb92009de1a643488c28/1d69c/649ccbc1c9da3c58.png&quot;
        srcset=&quot;/static/8710faece836fb92009de1a643488c28/4dcb9/649ccbc1c9da3c58.png 188w,
/static/8710faece836fb92009de1a643488c28/5ff7e/649ccbc1c9da3c58.png 375w,
/static/8710faece836fb92009de1a643488c28/1d69c/649ccbc1c9da3c58.png 750w,
/static/8710faece836fb92009de1a643488c28/78797/649ccbc1c9da3c58.png 1125w,
/static/8710faece836fb92009de1a643488c28/aa440/649ccbc1c9da3c58.png 1500w,
/static/8710faece836fb92009de1a643488c28/c8252/649ccbc1c9da3c58.png 2178w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在我们的实际场景中，主要工作就是为每个组件编写story，以展示每个组件的不同能力&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;怎么写-Story&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%80%8E%E4%B9%88%E5%86%99-Story&quot; aria-label=&quot;怎么写 Story permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;怎么写 Story?&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;组件的sotries是独立定义在组件文件之外的story文件。服务于开发环境，不会打包到项目中。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Button.js | ts | jsx | tsx
Button.stories.js | ts | jsx | tsx | mdx&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在storybook中过，定义了一个称为 Component Story Format(CSF)的规范。一个基于ES6 模块的标准，方便书写，并且可以在不同工具间移植。在CSF中，关键部分是用于描述组件的默认导出和描述组件stories的具名导出。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;两种导出方式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%A4%E7%A7%8D%E5%AF%BC%E5%87%BA%E6%96%B9%E5%BC%8F&quot; aria-label=&quot;两种导出方式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;两种导出方式&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;默认导出 Default export&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;默认导出的信息决定Storybook如何排列你的stories和addon使用的信息。例如，下面是一个Button.stories.js 的默认导出&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Button.stories.js

import Button from &amp;#39;./Button.vue&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/vue/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;Button&amp;#39;,
  component: Button,
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;具名导出 Defining Story&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;具名导出一个单独的story。下面是导出一个叫做 Primary 的 story&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Button.stories.js

import Button from &amp;#39;./Button.vue&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/vue/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;Button&amp;#39;,
  component: Button,
};

export const Primary = () =&amp;gt; ({
  components: { Button },
  template: &amp;#39;&amp;lt;Button primary label=&amp;quot;Button&amp;quot; /&amp;gt;&amp;#39;,
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;也可以通过 storyName 对 story 的名字进行修改&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Button.stories.js

import Button from &amp;#39;./Button.vue&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/vue/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;Button&amp;#39;,
  component: Button,
};

export const Primary = () =&amp;gt; ({
  components: { Button },
  template: &amp;#39;&amp;lt;Button primary label=&amp;quot;Button&amp;quot; /&amp;gt;&amp;#39;,
});
Primary.storyName = &amp;#39;I am the primary&amp;#39;;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;通过Args对象定义Story&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%80%9A%E8%BF%87Args%E5%AF%B9%E8%B1%A1%E5%AE%9A%E4%B9%89Story&quot; aria-label=&quot;通过Args对象定义Story permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;通过Args对象定义Story&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;所谓的一个story，是一个带有一组参数的组件，这些参数定义了组件应该如何渲染。在Storybook中，通过Args定义参数。Args是一个JavaScript对象，它可以用来动态地修改props，slot，样式、输入等。允许Storybook和插件实时编辑组件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Args用法很简单，可以通过story实例的&lt;code&gt;args&lt;/code&gt;设置为Story级别的参数，也绑定在默认导出对象上作为Component级别的参数。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;Story 级别的Args只对绑定的story生效&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Button.stories.js

import Button from &amp;#39;./Button.vue&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/vue/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;Button&amp;#39;,
  component: Button,
};

// 👇 We create a “template” of how args map to rendering
const Template = (args, { argTypes }) =&amp;gt; ({
  props: Object.keys(argTypes),
  components: { Button },
});

//👇 Each story then reuses that template
export const Primary = Template.bind({});

Primary.args = {
  primary: true,
  label: &amp;#39;Button&amp;#39;,
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;Component 级别的Args，对组件下所有的Story生效。&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Button.stories.js

import Button from &amp;#39;./Button.vue&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/vue/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;Button&amp;#39;,
  component: Button,
  //👇 Creates specific argTypes
  argTypes: {
    backgroundColor: { control: &amp;#39;color&amp;#39; },
  },
  args: {
    //👇 Now all Button stories will be primary.
    primary: true,
  },
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;使用Parameters控制Story&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8Parameters%E6%8E%A7%E5%88%B6Story&quot; aria-label=&quot;使用Parameters控制Story permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用Parameters控制Story&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;parameters是与story有关的一组静态具名元数据，通常用来控制Storybook的功能和addon的行为。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;和Args的使用方式类似，不过除了 Story 级别的 Parameters 和 Component 级别的 Parameters之外，可以在&lt;code&gt;.storybook/preview.js&lt;/code&gt; 中定义 Global Parameter，作用于所有的story。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;Story 级别的 Parameters&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Button.stories.js|ts|jsx|tsx

import { Button } from &amp;#39;./Button&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/react/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;Button&amp;#39;,
  component: Button,
};

const Template = (args) =&amp;gt; ({
  // 👈 Your template goes here
});

export const Primary = Template.bind({});
Primary.args = {
  primary: true,
  label: &amp;#39;Button&amp;#39;,
};
Primary.parameters = {
  backgrounds: {
    values: [
      { name: &amp;#39;red&amp;#39;, value: &amp;#39;#f00&amp;#39; },
      { name: &amp;#39;green&amp;#39;, value: &amp;#39;#0f0&amp;#39; },
      { name: &amp;#39;blue&amp;#39;, value: &amp;#39;#00f&amp;#39; },
    ],
  },
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;Component 级别的 Parameters&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Button.stories.js

import Button from &amp;#39;./Button.vue&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/vue/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;Button&amp;#39;,
  component: Button,
  //👇 Creates specific parameters for the story
  parameters: {
    backgrounds: {
      values: [
        { name: &amp;#39;red&amp;#39;, value: &amp;#39;#f00&amp;#39; },
        { name: &amp;#39;green&amp;#39;, value: &amp;#39;#0f0&amp;#39; },
        { name: &amp;#39;blue&amp;#39;, value: &amp;#39;#00f&amp;#39; },
      ],
    },
  },
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;Global parameters&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// .storybook/preview.js

export const parameters = {
  backgrounds: {
    values: [
      { name: &amp;#39;red&amp;#39;, value: &amp;#39;#f00&amp;#39; },
      { name: &amp;#39;green&amp;#39;, value: &amp;#39;#0f0&amp;#39; },
    ],
  },
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;三种级别的Parameters优先级顺序依次是 Story Parameters &gt; Component Parameters &gt; Global Parameter。Parameters 只会合并，相同的键值会按照优先级覆盖，不会丢弃。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;添加Decorators-包装-Story&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%B7%BB%E5%8A%A0Decorators-%E5%8C%85%E8%A3%85-Story&quot; aria-label=&quot;添加Decorators 包装 Story permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;添加Decorators 包装 Story&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;所谓Decorators，可以在保持原有的 story 不变的情况下，额外给它添加额外的 DOM 元素、引入上下文环境、添加假数据等等。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;和 Parameters 一样，它也可以定义在全局/组件/story 三个层级，每个 Decorator 按定义顺序依次执行，从全局到 story。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;利用 Decorators，我们可以用额外的DOM包装Story的渲染结果，&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// YourComponent.stories.js

import YourComponent from &amp;#39;./YourComponent.vue&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/vue/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;YourComponent&amp;#39;,
  component: YourComponent,
  decorators: [() =&amp;gt; ({ template: &amp;#39;&amp;lt;div style=&amp;quot;margin: 3em;&amp;quot;&amp;gt;&amp;lt;story/&amp;gt;&amp;lt;/div&amp;gt;&amp;#39; })],
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;也可以提供一个独立的Context，将参数或者数据传给Story。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// .storybook/preview.js

import Vue from &amp;#39;vue&amp;#39;;

import { library } from &amp;#39;@fortawesome/fontawesome-svg-core&amp;#39;;
import { faPlusSquare as fasPlusSquare } from &amp;#39;@fortawesome/free-solid-svg-icons&amp;#39;;
import { FontAwesomeIcon } from &amp;#39;@fortawesome/vue-fontawesome&amp;#39;;

library.add(fasPlusSquare);

//👇 Storybook Vue app being extended and registering the component
Vue.component(&amp;#39;font-awesome-icon&amp;#39;, FontAwesomeIcon);

export const decorators = [
  (story, { args, argTypes, globals, hooks, parameters. viewMode }) =&amp;gt; ({
    components: { story },
    template: &amp;#39;&amp;lt;div style=&amp;quot;margin: 3em;&amp;quot;&amp;gt;&amp;lt;story /&amp;gt;&amp;lt;/div&amp;gt;&amp;#39;,
  }),
];&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;同样的，像 Parameters 一样，Decorator 可以在全局、组件级别和单个故事中定义。当Story渲染时，所有与Story相关的Decorator将按以下顺序运行。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;Global Decorator ，按照它们定义的顺序&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;Component Decorator，按照它们定义的顺序&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;Story Decorator，按照它们定义的顺序&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;调用Play-Function实现交互&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%B0%83%E7%94%A8Play-Function%E5%AE%9E%E7%8E%B0%E4%BA%A4%E4%BA%92&quot; aria-label=&quot;调用Play Function实现交互 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;调用Play Function实现交互&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;Play function 在 Story 渲染完成后执行。可以实现与组件的交互，可用于测试需要交互的场景。它的的使用与前面提到的几个概念稍有不同，它的能力由几个插件组合提供，需要先安装好。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;# With npm
npm install @storybook/addon-interactions @storybook/testing-library --save-dev

# With yarn
yarn add --dev @storybook/addon-interactions @storybook/testing-library&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;然后补充一些配置&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// .storybook/main.js

module.exports = {
  stories:[],
  addons:[
    // Other Storybook addons
    &amp;#39;@storybook/addon-interactions&amp;#39;, //👈 The addon registered here
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;下面是一个简单的例子，首先引入依赖，然后为Story添加Play方法&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// RegistrationForm.stories.js

import { screen, userEvent } from &amp;#39;@storybook/testing-library&amp;#39;;

import RegistrationForm from &amp;#39;./RegistrationForm.vue&amp;#39;;

export default {
  /* 👇 The title prop is optional.
  * See https://storybook.js.org/docs/vue/configure/overview#configure-story-loading
  * to learn how to generate automatic titles
  */
  title: &amp;#39;RegistrationForm&amp;#39;,
  component: RegistrationForm,
};

const Template = (args) =&amp;gt; ({
  components: { RegistrationForm },
  template: &amp;#39;&amp;lt;RegistrationForm /&amp;gt;&amp;#39;,
});

export const FilledForm = Template.bind({});
FilledForm.play = async () =&amp;gt; {
  const emailInput = screen.getByLabelText(&amp;#39;email&amp;#39;, {
      selector: &amp;#39;input&amp;#39;,
    });

    await userEvent.type(emailInput, &amp;#39;example-email@email.com&amp;#39;, {
      delay: 100,
    });
    
    const passwordInput = screen.getByLabelText(&amp;#39;password&amp;#39;, {
      selector: &amp;#39;input&amp;#39;,
    });

    await userEvent.type(passwordInput, &amp;#39;ExamplePassword&amp;#39;, {
      delay: 100,
    });
    
    // See https://storybook.js.org/docs/vue/essentials/actions#automatically-matching-args to learn how to setup logging in the Actions panel
    const Submit = screen.getByRole(&amp;#39;button&amp;#39;);
    await userEvent.click(Submit);
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当 story 渲染完成后，play方法会自动执行。可以在Interactions面板中一步步查看流程。更多细节可以查看&lt;a href=&quot;https://storybook.js.org/docs/vue/writing-stories/play-function&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;官方的详细介绍&lt;/strong&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;以上是Storybook的一些基本概念，按照文档走一遍，搭建出自己的组件库文档是没问题的。接下来会介绍如何更好地命名和组织组件的层级结构。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;参考&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%82%E8%80%83&quot; aria-label=&quot;参考 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://storybook.js.org/tutorials/design-systems-for-developers/react/zh-CN/introduction/&quot; class=&quot;link-underline&quot;&gt;Storybook 设计系统简介&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://storybook.js.org/tutorials/&quot; class=&quot;link-underline&quot;&gt;Storybook 教程系列&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[《架构师修炼之道》摘录13-鼓励团队参与架构设计]]></title><description><![CDATA[本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。 全书整体分为三个部分 第一部分介绍软件架构的基础知识和架构师必备的设计思维 第二部分讲解架构师需要掌握的核心技能和知识 第三部分讨论一系列…]]></description><link>https://zhanglun.github.io/blogs/《架构师修炼之道》摘录13-鼓励团队参与架构设计/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/《架构师修炼之道》摘录13-鼓励团队参与架构设计/</guid><pubDate>Thu, 24 Feb 2022 12:40:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;全书整体分为三个部分&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第一部分介绍软件架构的基础知识和架构师必备的设计思维&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第二部分讲解架构师需要掌握的核心技能和知识&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第三部分讨论一系列使用的架构设计方法&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;前两部分适合从头到尾通读，第三部分用于参考和检索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;开发现代软件系统需要借助团队的力量。科技进步 （容器技术、云设施等）赋予了开发者更大的灵活性和权力。随之而来的新架构模式（微服务、Faas 等）则对开发人员提出了更高的要求。他们必须清楚自己的决策会对包括质量属性在内的系统特性造成什么样的影响。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在现代软件开发中，开发人员与架构师的角色几乎没有差别。这并不是说现代软件开发团队不需要架构师，而是说我们需要的不再是那种传统的、居高临下的技术领导者。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;今天的架构师应该与团队一起设计架构，而不是独自为团队设计架构。架构师应该既是技术专家，也是教练和导师。本书前两部分讲解了架构设计的核心原则和方法。现在，你要学习让团队与你一起成长，共同设计出色的软件架构。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;131-提倡架构师思维&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#131-%E6%8F%90%E5%80%A1%E6%9E%B6%E6%9E%84%E5%B8%88%E6%80%9D%E7%BB%B4&quot; aria-label=&quot;131 提倡架构师思维 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;13.1 提倡架构师思维&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;开发人员普遍具有架构师思维的团队更容易打造出出色的软件。这样的团队将具有更高的探索效率和开发质量，因为大家都有能力对设计角色做出有效评估。编写文档页变得更加容易，简明扼要地描述就能让团队成员看懂。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;让所有团队成员参与设计架构，大家就会产生对系统的责任感——系统会变成“我们的系统”，而不仅仅是“这个系统”。有了这种共同的责任感以及对设计意图的理解，当系统发生变更时，修改过程会变得容易得多。更少的返工、更好的质量、更有效的沟通将带来更快的开发速度。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;责任感的增强将带来更大的满足感，这反过来又会进一步增强团队的参与度。大家共同参与架构设计能产生 1+1&gt;2 的效果，从而开发出更优秀的软件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在鼓励团队参与设计的同时，还要传授设计技能，这样大家才能在实践中磨炼成长。既要给大家试错的机会，也要保证架构设计准确无误，这样才能确保交付有价值的软件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为团队提供恰到好处的指导，既确保大家走在正确的道路上，也免得架构师自己检查每一项设计决策。传授技能、增强互信，不断学习和改进。此外，架构师要比因队成员多看一步、先行一步，带领大家避开陷阱与误区。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;132-传授技能辅助决策&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#132-%E4%BC%A0%E6%8E%88%E6%8A%80%E8%83%BD%E8%BE%85%E5%8A%A9%E5%86%B3%E7%AD%96&quot; aria-label=&quot;132 传授技能辅助决策 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;13.2 传授技能，辅助决策&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;为了让团队对系统形成共同的责任感，架构师必须向团队成员提供充分的支持。他应该向团队成员传授知识与技能，以便他们自己做出设计决策。架构师应该成为教练和导师，而不是制定所有设计决策的权威。如果可能的话，架构师应该尽可能让团队自己做决策，而不是亲自动手。下表对比了二流架构师与优秀架构师的区别。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;二流软件架构师&lt;/th&gt;
&lt;th&gt;优秀软件架构师&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;独自选择架构模式和技术。&lt;/td&gt;
&lt;td&gt;与团队成员一起选择架构模式和技术。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;撰写详细的设计文档，公布后不允许修改。&lt;/td&gt;
&lt;td&gt;设计文档模板给团队使用，与团队一起起草、评审文档。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;所有设计决策都由他制定或批准。&lt;/td&gt;
&lt;td&gt;传授决策方法，指导设计，让大家共同决策，及时评审，提供反馈。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;为团队成员指定工作任务。&lt;/td&gt;
&lt;td&gt;帮助团队自己组织工作、划分任务。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;害怕架构出现变化。&lt;/td&gt;
&lt;td&gt;接受变化，让架构易于调整。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;技术决策由他一人说了算。&lt;/td&gt;
&lt;td&gt;让大家就技术决策达成共识。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;133-为团队创建实践机会&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#133-%E4%B8%BA%E5%9B%A2%E9%98%9F%E5%88%9B%E5%BB%BA%E5%AE%9E%E8%B7%B5%E6%9C%BA%E4%BC%9A&quot; aria-label=&quot;133 为团队创建实践机会 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;13.3 为团队创建实践机会&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;我们希望赋予团队更多的设计权力，但这需要团队先做好准备。只有通过实践，团队成员才能得到锻炼、获得经验。可是交付时间步步逼近，要从紧张的开发工作中抠出时间做培训可不容易。这里有几个方法。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1331-结对设计&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1331-%E7%BB%93%E5%AF%B9%E8%AE%BE%E8%AE%A1&quot; aria-label=&quot;1331 结对设计 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;13.3.1 结对设计&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;结对是最简单、最安全的练习设计的方法，比如你可以邀请一位同事和你一起做设计。如果你想理解某一个模型，也可以邀请一位同事做白板涂鸦。在与利益相关方讨论质量属性时，也可以带上一位同事。在团队评审一份决策文档之前，你最好先找一位团队成员一起看一遍。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1332-搭建支架&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1332-%E6%90%AD%E5%BB%BA%E6%94%AF%E6%9E%B6&quot; aria-label=&quot;1332 搭建支架 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;13.3.2 搭建支架&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在教育理论中，支架式教学 (instructional scaffolding)，是指教师设法为学生提供的支持，帮助学生顺利学习新知识。我们在学校里都体验过支架方法，比如详细批改的试卷和作业、老师制作的辅导讲义、家庭作业模板等。向团队传授架构知识时，我们也可以采用相似的方法。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;为常见的设计任务建立模板。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;在代码评审中给出建设性的意见。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;为新组件搭好代码框架。代码框架应当能提纲挈领地描绘采用的模式，同时仍然需要向其中填充内容。建议你与同事结对搭建代码框架。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;对设计任务设定期望，并举例解释什么是好的设计，什么是糟糕的设计。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;为各种思维模式和设计任务建立检查清单，帮助团队成员建立架构思维。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1333-引入架构导轨&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1333-%E5%BC%95%E5%85%A5%E6%9E%B6%E6%9E%84%E5%AF%BC%E8%BD%A8&quot; aria-label=&quot;1333 引入架构导轨 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;13.3.3 引入架构导轨&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;架构导轨可以约束设计选项，从而确保细节设计不会大幅偏离既定架构。架构导轨既可以用来简化设计（见第 5.1节），也可以为团队创造安全的实践机会。架构导轨降低了破坏架构的可能性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构导轨有很多种形式，作用各不相同。设计方针 （design policy）就是一种简单的架构导轨，它规定了该做哪些事，不该做哪些事。在安排团队做设计时，可以给出临时的设计方针。如果要降低风险、提升质量或克服团队的弱点，则可以设立正式的设计方针。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;另一种常用的架构导轨是要求使用指定库，这种方法能够降低开发难度，同时避免犯一些低级错误。最严格的架构导轨是融入代码的约束（见第8.3节），在这种情况下开发人员是很难再犯错的。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1334-举办交流会&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1334-%E4%B8%BE%E5%8A%9E%E4%BA%A4%E6%B5%81%E4%BC%9A&quot; aria-label=&quot;1334 举办交流会 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;13.3.4 举办交流会&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;如果团队对架构十分着迷，那么不妨举办几场交流会 (information session） 就具体话题展开探讨。交流会时间不必很长，见缝插针地开几次短会跟开长会的效果一样好。为了提高交流效率，应该提前把讨论涉及的知识点传授给大家，避免出现临阵磨枪的现象。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;随着团队成员逐渐成熟，他们会更频繁地发表意见。这是好事，应该鼓励大家这样做。团队成员愿意分享改善架构的建议，说明你的付出有了回报。这时你可以考虑让他们承担更多的设计任务了。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;134-设计下放&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#134-%E8%AE%BE%E8%AE%A1%E4%B8%8B%E6%94%BE&quot; aria-label=&quot;134 设计下放 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;13.4 设计下放&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;随着越来越多的团队成员参与架构设计，必须决定下放(或保留）多少设计权限。我们希望尽可能多地下放设计，当然前提是确保架构与核心质量属性不受影响。在《管理 3.0：培养和提升敏捷领导力》一书中，Jurgen Appelo 提出了 七级权限。我们可以借助这七级权限决定如何下放设计。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第一级：告知。由你做设计决策，告诉团队结果。通常需要展示你的设计。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第二级：贯彻。由你做设计决策，然后向团队说明这样设计的理由。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第三级：咨询。在做设计决策前咨询团队的意见，但最终还是由你做决策。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第四级：商定。与团队合作，就设计決策建立共识。大家有平等的话语权。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第五级：建议。通过观点、见解影响团队，但是由团队其他成员做设计决策。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第六级：审查。由团队做决策，请他们解释为什么这样设计。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第七级：委托。委托另一位成员做决策，由他对结果负全责。你作为辅助成员，帮助团队收集信息。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;下放多少设计权限要视具体情况而定。恰当地下放权限能增强团队信心、活跃开发氛围、提高敏捷性。下放的权限太少可能会破坏因队信任，让团队成员觉得束手束脚；下放的权限太多则可能造成团队焦虑，设计结果也难以令人满意。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在带领缺少经验的团队时，千万不要下放过多的权限。这样做很可能会破坏团队信任、造成严重的返工。更糟糕的是，如果你没能及时发现其中的问题，有可能造成无法挽回的损失。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;下放设计权限不存在标准的做法，你只能通过尝试我到适合自己因队的运作方式。检验下放权限是否合适最简单的方式是多与团队成员交流，了解大家的意见。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1341-何时保留设计权限&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1341-%E4%BD%95%E6%97%B6%E4%BF%9D%E7%95%99%E8%AE%BE%E8%AE%A1%E6%9D%83%E9%99%90&quot; aria-label=&quot;1341 何时保留设计权限 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;13.4.1 何时保留设计权限&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;如果你觉得项目风险高，那么在权限下放上还是保守些比较好。带领经验不足的团队时，建议只采用前三级权限。经检验，这是一种比较可靠的做法。遗憾的是，前三级权限在增强团队信心，活跃开发氛围，提高敏捷性方面作用有限。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在设计架构的同时提高团队能力是架构师面临的最大挑战之一。也许你觉得这样做还不如自己设计架构来得轻松。从短期来看，这样想有道理。但从长远看，这会造成团队成员无法成长。如果团队里只有你一个人能设计架构，那么你的知识、能力、精力将会成为整个因队的瓶颈&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果你仍有疑虑，可以先保留设计权限，等到合适的时机再下放权限。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;ThoughtWorks 首席技术顾问 Patrick Kua 认为：架构师身上的担子很重．他要降低技术风险，要设法应对未来的变化，还要确保提升既定的系统质量属性。仅仅做到这些还不够，他还必须像一位技术主管那样思考和工作。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;优秀的架构师不能只靠自己做決第。技术发展日新月异，架构师不可能热悉所有的工具和技术细节，所以他应该善于利用团队的智慧和经验。作为技术主管的架构师要为团队树立技术愿景，提高团队的开发效率和团队成员的能力。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果用团队的决策质量衡量架构师的工作成果，那么架构师也应当致力于帮助开发人员做出更好的决策。毕竟，每一行代码都代表一种选择，而每一种选择都是一个决策。架构师可以通过指明约束条件或者与团队共同确定架构原则来提高开发人员的决策质量。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;无论是树立技术愿景、指明约束，还是共同确定架构原则，都需要架构师具备一种非技术能力。这种能力常被称为软技能（soft skill）。它往往是最难学到的。成为出色的架构师，你必须掌握一些沟通技巧，比如用非技术性术语解释技术理念、借助图表和模型建立共识、用故事&lt;br&gt;
激励团队成员，等等。此外，还要学会倾听同事的意见和观点。倾听不但能增加你的知识储备，还能提高对方对技术愿景的认同感。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;一类架构师，他们独来独往，只想研究专业技术，不布望别人干涉自己的架构设计——这些人应该回到象牙塔里去，如果你不想成为这样的架构师，就必须提升自己的技术管理能力，加强自己与团队的合作与联系。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1342-何时下放设计权限&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1342-%E4%BD%95%E6%97%B6%E4%B8%8B%E6%94%BE%E8%AE%BE%E8%AE%A1%E6%9D%83%E9%99%90&quot; aria-label=&quot;1342 何时下放设计权限 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;13.4.2 何时下放设计权限&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;如果团队具备了一定的经验，那么可以找机会咨询大家的意见，一起制定决策，或者干脆让团队作决策（你只分享建议）。对那些与团队日常工作息息相关或存在争议的设计决策而言，下放设计权限尤为重要。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;随着团队逐渐加深对架构的理解，你管理团队的信心也会与日俱增。这时就可以开展设计研讨会了。你可以在后四级权限里挑选你认为最合适的方式来开展研讨会。把更多的设计权限下放给团队，你将逐渐从架构的设计者变成架构设计的促进者。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;第三部分介绍的许多方法都可以用来让团队参与设计，这里举几个例子：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;向团队讲述架构故事，鼓励团队成员一起讲述与架构有关的故事 （见第 15.1节和第 16.10节）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;开展研讨会，鼓励团队成员参与架构设计（见第9章、第17.5节、第 17.6节、第17.8节)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;检查团队的参与程度，了解进展（见第17.1节、第17.7节）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;如果有好的案例，可以把制作文档的任务下放给团队。可以委托团队制作与评审的文档包括架构决策记录（见第 16.1 节）、架构主旨（见第16.2节）、启动计划书 （见第 16.5节)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;135-共同设计架构&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#135-%E5%85%B1%E5%90%8C%E8%AE%BE%E8%AE%A1%E6%9E%B6%E6%9E%84&quot; aria-label=&quot;135 共同设计架构 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;13.5 共同设计架构&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;第 1.4 节曾提到出色的软件架构可以提高团队开发能力。请注意，提高团队开发能力的是架构，而不是架构师。架构师的责任是指导团队设计出色的架构，让大家从中获益。第 1.1节曾介绍架构师要做什么，就是告诉大家如何完成这项任务。本书前两部分都在围绕这个主题进行阐述。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;现在，让我们结合新学的知识，重新回顾架构师的主要职责：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;从工程角度定义问题&lt;/strong&gt;。架构师要负责定义关键架构需求，特别是质量属性。我建议采用以人为本的设计方法收集需求，避免与利益相关方的真实需求脱节。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;分解系统，分配职责&lt;/strong&gt;。架构师要引导团队识别有利于提升既定质量属性的模式。我建议只做够用的架构设计，确保实现关键的质量属性，而把其他决策留给后续设计人员。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;关注大局，保证全局设计的一致性&lt;/strong&gt;。架构师要从全局的角度把握架构设计，同时带领团队完成系统开发。我建议建立精确的架构模型（记录架构决策），同时使用简单的文档。架构模型可以用来推演系统、评估决策、识别风险，帮助我们实现业务目标。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;在质量属性之问做出取舍&lt;/strong&gt;。放弃一些东西换取其他东西在软件开发中很常见。架构师要找出备选方案，与各方一起协商如何取舍最合理。我建议借助风险决定设计决策和内容。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;管理技术债务&lt;/strong&gt;。架构师要识别技术债务，制定偿还策路。我建议将技术债务看成软件系统不可避免的副产品，需要在整个系统生命周期中有策略地加以管理。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;提升团队的架构技能&lt;/strong&gt;。架构师要提高团队的架构设计能力（包括理解、探索、展示、评估架构的能力），让大家对系统形成共同的责任感。我建议与团队一起设计架构，而不是为团队设计架构。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;对大多数团队而言，编程是相对容易的任务，最困难的是理解问题并从系统的角度解决问题。团队对架构的理解越深刻，就越容易解决开发中遇到的问题。与团队一起设计架构能够加深这种理解&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;架构师是技术领导者，但不应该自己设计架构的所有细节。架构师应该带领团队一起成长，为大家创造实践机会，提高团队的架构技能，通过与大家合作来影响架构设计。要知道团队成长的重要性并不亚于做出正确的设计决策。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;本书前两部分介绍了软件架构设计的核心原则与方法。掌握这些内容，可以成为一名合格的架构师。但是，如果我希望成为一名出色的架构师，只满足于这些知识是远远不够的。我还需要不断深入学习与这些原则、方法有关的内容。要一直保持探索、学习的好习惯。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;接下来，我是尝试将从本书中学到的知识运用到我的项目中去。帮助自己和团队一起成长。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[《架构师修炼之道》摘录12-架构评估]]></title><description><![CDATA[本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。 全书整体分为三个部分 第一部分介绍软件架构的基础知识和架构师必备的设计思维 第二部分讲解架构师需要掌握的核心技能和知识 第三部分讨论一系列…]]></description><link>https://zhanglun.github.io/blogs/《架构师修炼之道》摘录12-架构评估/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/《架构师修炼之道》摘录12-架构评估/</guid><pubDate>Fri, 18 Feb 2022 14:10:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;全书整体分为三个部分&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第一部分介绍软件架构的基础知识和架构师必备的设计思维&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第二部分讲解架构师需要掌握的核心技能和知识&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第三部分讨论一系列使用的架构设计方法&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;前两部分适合从头到尾通读，第三部分用于参考和检索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;对学生、家长、老师来说，成绩单是重要的反馈渠道。学生不必等到年底才知道自己的课程是“过来”还是“挂了”——通过每个季度的成绩单，就能判断自己是否获得了理想的成绩，以及哪些地方需要改进。架构评估的作用就像是成绩单一样，它让我们尽早发现问题，从而按计划交付系统。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构评估可以提高开发效率，而不是单纯地占用编程时间。顺利的话，架构评估一小时就可以完成，它很容易融入现有开发流程中，而且不需要团队成员掌握什么新知识。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;本章将学习对架构进行评估。评估结果可以用于指导团队、为设计决策提供支持、降低交付风险、提高架构设计水平。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;121-评估得真知&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#121-%E8%AF%84%E4%BC%B0%E5%BE%97%E7%9C%9F%E7%9F%A5&quot; aria-label=&quot;121 评估得真知 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;12.1 评估得真知&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;架构评估让我们了解架构能在多大程度上实现目标。人们通常误以为在架构设计的最后阶段做一次槛车即可。这种想法是绝对错误的。如果架构设计有问题，那么所有工作都是徒劳，甚至连项目都无法实施。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你不必等到一切都完美了，才开始评估。没有哪个架构是完美的，也没有哪个架构是毫无可取之处。就像我们不能从单一视图看整体架构一样，我们也不可能一次完成整个架构的评估。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;贯彻架构评估的一种方式是进行正式的签字验收。在组件必须满足严格标准的情况下，这样的签字显得尤为重要。例如，对于需要大量集成或对硬件有较高要求的系统，签字验收可以避免代价高昂的返工。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;签字验收非常重要，但架构评估的作用远不止于此。如果只是把架构评估看成是开发流程中的阶段性检查，那真是大材小用了。架构评估是论证架构能否满足利益相关方需求的唯一方法。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构评估要回答两个问题：架构有多好？好在哪里？为了回答这两个问题，我们需要用到关键架构需求（ASR）。架构越能满足ASR，就越符合目标要求。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;122-检验设计&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#122-%E6%A3%80%E9%AA%8C%E8%AE%BE%E8%AE%A1&quot; aria-label=&quot;122 检验设计 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;12.2 检验设计&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;尽早检验，频繁检验。这条原则既适用于代码，也适用于架构。即使在架构设计初期，也有值得检验的地方。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构评估需要做三方面的准备： 第一，要有评估对象，即架构的有形呈现；第二，要有评估准则，它反映利益相关方对优劣的看法；第三，制定计划，帮助评估者形成判断，指出架构的可取之处。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1221-准备评估对象&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1221-%E5%87%86%E5%A4%87%E8%AF%84%E4%BC%B0%E5%AF%B9%E8%B1%A1&quot; aria-label=&quot;1221 准备评估对象 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;12.2.1 准备评估对象&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;有了评估对象才能开展评估。人们习惯评估有形的东西，而不是别人脑袋里的想法。首先要将架构展示出来，比如在白板上画草图，或者提供完整的架构描述。呈现架构的方式很多，例如：写代码：在纸上或白板上画模型草图：用绘图软件画模型：用 PPT 展示架构视图：展示实验结果；使用传统的架构描述、架构主旨、架构决策记录。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;用直观的方式呈现架构，可以更好地展示设计思想和设计意图，让大家明白我们准备如何落实关键架构需求 (ASR），或者我们己经采用了哪些做法来落实。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;想得到什么反馈，就应该准备相应的展示对象。例如：如果你希望评估某个质量属性，就应该展示包含该质量属性的架构视图。如果架构还不成熟，又希望做整体评估，那么可以画粗略的草图，表示设计还没有定型。而评估高风险、高成本的设计方案，最好采用正式的、精确的展示形式，以强调问题的严重性。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1222-定义评估准则&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1222-%E5%AE%9A%E4%B9%89%E8%AF%84%E4%BC%B0%E5%87%86%E5%88%99&quot; aria-label=&quot;1222 定义评估准则 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;12.2.2 定义评估准则&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;架构的优劣有时不是那么明显。一个人眼里的杰作，在另一个人看来也许是糟粕。因此要建立评估准则，用各种指标判断架构的适用性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构准则包含两部分：指标是指待评估的架构属性；评分是对指标的打分。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在书中的Lionheart项目案例中，作者使用质量属性场景作为指标。评估者根据表格下方的评分标准打分。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c06492bf8889be7453b59cf548956987/28fe3/cc7df332bbb2741b.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 69.68085106382979%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACa0lEQVQ4yz2T65KiQAyFef/H2NqaGccZRUQE+k5DNyji/XnOVoLuj1S0Sb6cE5rk/nzg9nzgervifr/hdDpimkZcrxPu9ysulwmXywnTNJ93nYe1GsYoNI1FCC3nvu9wPA5IHs87Nz4eNzyfdwxD5BjHAxddr+cZep0wnY8IsUXjLbrgGdZ1M1DKmvsSaqBmrSWcs6ziHW8wqXLO4HCM6IcOwxDQ94GVSiXgrEFZ7ll1QtZiDJBSoG0beO8YTtk3FloJKFVD1CWaxjCQBsTYQinBkLZr0LYO1mkkbyW+cZzfO7JW8QDKztK+NJzTMFZCyorhBHCN4d9aC2hdz0CST2oY7C2sURwheDRuLmaQKF+NgiHGSDR+BkpR8fNkPB0QY8cAymSBLJIK12jOdV0gz1MOpSq0nUOIHtoIOKdgneIhUpZIjmPPBUpW6LrmNa1kaF3vGVYUW9RVgW22xu/Pgs8JVFUF1xJIv0Qk0/nAOxOiQgwefd9iHHscDxGXy4jz5YjTdMB4GvicYuAX4zja1s4qrYQxYlaoZI18myFLV1ivlijLHbLNCsUug6gLlPsc+XaNfJtit01R0fNszep3+YYzwdgyLT5dr/C9+ML34oOtbdIVNukvlotPHpCulvj4+wc/yy8svz+x+PzL5zRQyfK/bRqe0H2K0cN7wxYOh4A+0lfgEALdS81XxhrBtmhXb8X7IuOXJMW8axKTdMEh9h5G19CqYjjthUCt1xgGusQOMTj+37Ya3isYM9cziNZS5ij3WySkjACkZlZQsXTeV54idJZBjROvkLC2hlJks4AQBaoqR1luURQZ/gHqGozW8xnZfwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;cc7df332bbb2741b&quot;
        title=&quot;cc7df332bbb2741b&quot;
        src=&quot;/static/c06492bf8889be7453b59cf548956987/1d69c/cc7df332bbb2741b.png&quot;
        srcset=&quot;/static/c06492bf8889be7453b59cf548956987/4dcb9/cc7df332bbb2741b.png 188w,
/static/c06492bf8889be7453b59cf548956987/5ff7e/cc7df332bbb2741b.png 375w,
/static/c06492bf8889be7453b59cf548956987/1d69c/cc7df332bbb2741b.png 750w,
/static/c06492bf8889be7453b59cf548956987/78797/cc7df332bbb2741b.png 1125w,
/static/c06492bf8889be7453b59cf548956987/aa440/cc7df332bbb2741b.png 1500w,
/static/c06492bf8889be7453b59cf548956987/28fe3/cc7df332bbb2741b.png 3446w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;根据关键架构需求选择指标&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;关键架构需求从利益相关方的角度定义了系统目标。第五章曾学习了列举关键架构需求，用于分析和评估。只要能准确、清晰地给出可度量的关键架构需求，就不难选择评估指标。合格的指标应该满足一下条件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;举足轻重、不可或缺&lt;/strong&gt;。评估指标与关键架构需求有关，它体现了我们认为的好架构应该是什么样子。指标不应该包合锦上添花的东西，也不应该包含一些无关紧要的、对满足系统目标没有帮助的细节。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;互不重叠&lt;/strong&gt;。指标应该相互独立，每项指标都体现架构设计在某一方面的适用。理想情况下，每项指标都应该可以独立进行评估和打分。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;易观察、可衡量&lt;/strong&gt;。评估者必须能够对指标进行评估与打分。为了便于观察，应该采用恰当的形式将架构展示出来。评估过程应该收集数据，用于衡量指标。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;准确不模糊&lt;/strong&gt;。所有评估者都能够正确理解指标。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;质量属性场景完全满足这些条件，可以作为评估指标。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;选择评分标准&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;评估过程中，评估者用统一的评分标准为指标打分。评分标准包含评分等级。评分等级的多少由评估目标决定。下表列举了一些评分标准及使用场景。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;评分等级&lt;/th&gt;
&lt;th&gt;示例&lt;/th&gt;
&lt;th&gt;适用场景&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;两级&lt;/td&gt;
&lt;td&gt;是/否&lt;/td&gt;
&lt;td&gt;针对单一条件、标准、对象，要么接受，要么否定；适用于单个或少数评估者。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;三级&lt;/td&gt;
&lt;td&gt;未通过/通过/极佳&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;从不/有时/总是&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;较低/可接受/较高&lt;/td&gt;
&lt;td&gt;评估条件存在最低门槛，同时也有最高的理想状态；适用于多位评估者。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;四级&lt;/td&gt;
&lt;td&gt;从不/有时/经常/总是&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;未通过/勉强通过/通过/优秀&lt;/td&gt;
&lt;td&gt;希望获得更详细的反馈，体现细微差别。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;五级及以上&lt;/td&gt;
&lt;td&gt;用相应数字表示（如1~5)&lt;/td&gt;
&lt;td&gt;尽量避免使用这种方式。等级过多效果反而不佳。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;上面的例子展示了评分标准的作用，但没有解释评估者是怎么打出分数的。用合适的方法引导评估者打分也很重要。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;现在我们将架构展示出来了，也有了评分标准。最后一步是帮助评估者形成判断，进行评分。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1223-形成判断&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1223-%E5%BD%A2%E6%88%90%E5%88%A4%E6%96%AD&quot; aria-label=&quot;1223 形成判断 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;12.2.3 形成判断&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;评估准则包含要回答的问题，如下图。如果我们能帮评估者形成判断，我们就能找到问题的答案。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/601fe3037e110d59b19b381513d9a4c8/2d912/8fa3497753a07b05.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 35.638297872340424%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABHElEQVQoz3WQC4vcMAyE8///Y4+W7l42iZ2XY8vvr9jLLtwdFQwSntEw8pCiJfqTHA3RH6Rw8apaElF2cjg6gmzUkt98itebbz0Fy+CviexPxtsvnFnxl2JZJu73kWX6g5iF8fbB4/5BsBq93JlnhVIzh/5LdFvnohw0ryE4TbAL53pDzIy3GhGHdYK7NoJb2dSNQ38S3YqzOyIecRa5FMHtmH3qXNMOpRRyipSSyClQcqLW+jy59VrY9xVxF7UWKl8rBI8x53M/56dhKfUbSkcTtFJKsa4bNft+QUvSepSNlCKPx/TeGV7D/9BSei+c5sLsI9Fpps/fOKOxx4haZkSk634YtkTfDV9vKRe8O/BW4S7d/66nDb5rXrp/lUwgNDDdHGYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;8fa3497753a07b05&quot;
        title=&quot;8fa3497753a07b05&quot;
        src=&quot;/static/601fe3037e110d59b19b381513d9a4c8/1d69c/8fa3497753a07b05.png&quot;
        srcset=&quot;/static/601fe3037e110d59b19b381513d9a4c8/4dcb9/8fa3497753a07b05.png 188w,
/static/601fe3037e110d59b19b381513d9a4c8/5ff7e/8fa3497753a07b05.png 375w,
/static/601fe3037e110d59b19b381513d9a4c8/1d69c/8fa3497753a07b05.png 750w,
/static/601fe3037e110d59b19b381513d9a4c8/78797/8fa3497753a07b05.png 1125w,
/static/601fe3037e110d59b19b381513d9a4c8/aa440/8fa3497753a07b05.png 1500w,
/static/601fe3037e110d59b19b381513d9a4c8/2d912/8fa3497753a07b05.png 1772w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;形成判断的方法很多，如问卷调查、定向探索、风险手机、代码分析等。选择哪种方法要由回答问题所需的信息决定。下面的表格提供了一些参考示例。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构评估的大部分时间都花在形成判断上。这种判断通常是在架构评估研讨会上通过协作产生的，因此我们有必要了解如何举办架构评估研讨会。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;123-举办评估研讨会&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#123-%E4%B8%BE%E5%8A%9E%E8%AF%84%E4%BC%B0%E7%A0%94%E8%AE%A8%E4%BC%9A&quot; aria-label=&quot;123 举办评估研讨会 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;12.3 举办评估研讨会&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;架构评估研讨会的目标是收集与分析评估架构所需的数据。研讨会结束时我们应该能够确定架构能在多大程度上满足既定 质量属性和其他关键架构需求。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;虽然评估研讨会的形式多样，但它们都遵循相同的流程：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;准备工作：设法将架构设计呈现出来；制定评估准则：选择收集数据的方法：邀请评估者。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;帮评估者做好淮各：向评估者展示架构设计，说明评估准则：阐述评估目标，回答评估者的问题。在开始评估之前，评估者应当充分理解架构设计、评估准则和评估的目标。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;评估：引导评估者通过一系列活动研究架构设计，形成判断，给指标打分。活动既可以合作开展，也可以是独立进行。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;分析与结论：收集评估者反馈的数据（评分）；汇总结果，给出结论。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;后续行动：根据研讨会的发现，决定下一步的行动。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;下面逐一讲解以上步骤。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1231-准备工作&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1231-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C&quot; aria-label=&quot;1231 准备工作 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;12.3.1 准备工作&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;首先要定义评估目标，然后围绕这一目标设法将架构设计展示出来。下表中列举了常见的评估目标和展示内容。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;除此之外，还要制定评估准则，搜集评分所需的数据。另外，别忘了制定研讨会议程和准备相关资料。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;选择评估者要兼顾利益相关方与非利益相关方。评估者应当关心系统，同时擅长发现细节问题。理想的人选应该精通行业知识和领域知识，或者对采用的技术、模式有专业见解。架构评估至少需要两位评估者。如有必要，最多可以邀请几十位评估者。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;评估目标&lt;/th&gt;
&lt;th&gt;展示内容&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;特定质量属性的实现方式&lt;/td&gt;
&lt;td&gt;有关的质量属性视图、测试结果、用例、质量属性场景。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;技术或模式的选择&lt;/td&gt;
&lt;td&gt;相应的技术和模式、实验方法、试验结果、质量属性场景。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;满足成本要求或进度目标的可能性&lt;/td&gt;
&lt;td&gt;组件及评估的开发成本和时间、技术依赖、团队能力。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;设计的演变路径&lt;/td&gt;
&lt;td&gt;当前架构和目标架构、演变步骤。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;架构描述的完整性或正确性&lt;/td&gt;
&lt;td&gt;架构描述、文档质量检查清单。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;安全性&lt;/td&gt;
&lt;td&gt;滥用案例、误用案例、威胁模型、数据存储、识别铭感点和攻击响亮所需要的视图。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;发布就绪程度&lt;/td&gt;
&lt;td&gt;质量属性场景、相关视图、发布清单、测试结果。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;邀请完评估者后，我们要帮他们做好评估准备。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1232-帮评估者做好准备&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1232-%E5%B8%AE%E8%AF%84%E4%BC%B0%E8%80%85%E5%81%9A%E5%A5%BD%E5%87%86%E5%A4%87&quot; aria-label=&quot;1232 帮评估者做好准备 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;12.3.2 帮评估者做好准备&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;评估者应该掌握必要的信息，以便做出高质量的评估。这些信息包括：项目背景、关键架构需求、待评估的架构设计等。你要回答评估者就项目背景、评估准则、评估目标提出的问题。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;准备好白板。如果时间允许，不妨在研讨会开始时当着大家的面把架构设计思路画出来，同时介绍项目背景。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;帮评估者做好这些准备后，就可以开始正式评估了。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1233-评估&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1233-%E8%AF%84%E4%BC%B0&quot; aria-label=&quot;1233 评估 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;12.3.3 评估&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在这个阶段，应该通过一系列活动引导评估者，帮助他们发现设计缺陷和潜在风险，从而形成判断。有许多方法可以帮助大家形成判断。这里我们先举几个例子，更详细的介绍请参考第 17章。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;场景排查（见第17.8节）是最常用的方法，也是最基本、最可靠的架构评估方法。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;“问题-评论-关注事项”（见第 17.5 节〉是一种可视化的头脑风暴方法，可以帮助评估者迅速了解架构信息，发现疑点。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;风险风暴（见第17.6节）也是一种可视化的头脑风暴方法，常用于发现系统特定视图中存在的风险。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;绘制草图做比较(见第 17.9节）可以用来比较不同方案的优劣 （如比较提升同一质量属性的多种方案）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;代码评审（见第17.2节，不太容易发现架构的问题，但它可以识别代码与架构不一致的地方。代码评审也常常用来检查代码中的静态结构。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;如果已经有了架构决策记录（见第 16.1节），那么可以借助它回顾设计决策并确定这些决策是否仍然有效。架构决策记录也可以用来评估适用性。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;根据评估目标、评估时间，以及利益相关方对架构评估的熟练程度来选择评估方法。经验丰富的小团队（约三四个人）能够在 60 分钟内借助“问题-评论-关注-事项“方法做出有效的判浙。而缺少经验的团队可能要先花时间回顾质量属性场景和设计决策，才能取得较好的效果。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们希望通过评估研讨会判断架构是否满足指标，但这不是研讨会的唯一目标。除了得出架构是否合格的结论，我们还希望了解如何改进架构设计。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1234-分析与结论&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1234-%E5%88%86%E6%9E%90%E4%B8%8E%E7%BB%93%E8%AE%BA&quot; aria-label=&quot;1234 分析与结论 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;12.3.4 分析与结论&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;无论评估使用什么指标，都需要得出清晰、明确的结论。架构评估的结论不应该是简单的”通过“和”没通过“。结论应该清晰表述架构满足指标的程度，同时提出改进架构的建议。除了判断架构是否满足要求，还应该分析架构为什么不满足要求，以及如何改进。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;通过评估发现风险，找出架构设计可能引发的问题。把研讨会收集的数据共享给大家，请大家寻找规律。让大家就存在疑问的地方自由提问。通过开发性的提问环节找出大家对架构理解的差异。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;得出结论后，还要决定接下来做什么。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1235-后续行动&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1235-%E5%90%8E%E7%BB%AD%E8%A1%8C%E5%8A%A8&quot; aria-label=&quot;1235 后续行动 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;12.3.5 后续行动&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;想解决评估过程中提出的所有风险和问题是不现实的，我们也没有足够的时问这么做。给问题排定优先级，把亟待解決的问题和值得研究但不紧急的问题区分开。可以指定一个人决定针对高优先级高的问题接下来应该做什么。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;评估研讨会结束后，应该总结并记录发现的问题及后续行动计划，然后共享给所有人。小型研讨会可以群发邮件，写明后续行动要点：大型研讨会可以撰写一份简要的报告，并附上原始会议记录的链接。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;总结报告向利益相关方展示了会议成果，可以作为架构设计进展的标志。总结报告对未来接手系统的架构师和其他人来说都有很高的借鉴价值。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;黄金法则：架构劝和分析方法（ATAM）&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构权衡分析方法是迄今为止最系统、最全面的评估方法之一。在《ATAM： Method for Architecture Evaluation》和《软件架构实践》两本书对此有详细论述。本章介绍的评估研讨会就是在 ATAM 的基础上简化而来的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;ATAM 要求参与者具有较高的素质和丰富的经验，而且持续时间长达数日甚至数周。它适合用来设计导弹制导和自动驾驶这样复杂的系统。普通的软件系统采用本章介绍的方法就足够了。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;124--尽早评估反复评估持续评估&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#124--%E5%B0%BD%E6%97%A9%E8%AF%84%E4%BC%B0%E5%8F%8D%E5%A4%8D%E8%AF%84%E4%BC%B0%E6%8C%81%E7%BB%AD%E8%AF%84%E4%BC%B0&quot; aria-label=&quot;124  尽早评估反复评估持续评估 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;12.4  尽早评估，反复评估，持续评估&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;开发团队最容易犯的错误足不开展架构评估，或者开展得台湾。越早评估，越容易发现问题并加以改进。把架构评估作为日常开发的常规环节效果会更好。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们每天都有机会确认（或修正），设计决策。比如，给别人讲解架构如何提升质量属性时就是排查架构的绝佳机会；结对编程以及提交代码给同事审核时也是评估架构的好时机。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1241-用评估金字塔平衡成本与价值&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1241-%E7%94%A8%E8%AF%84%E4%BC%B0%E9%87%91%E5%AD%97%E5%A1%94%E5%B9%B3%E8%A1%A1%E6%88%90%E6%9C%AC%E4%B8%8E%E4%BB%B7%E5%80%BC&quot; aria-label=&quot;1241 用评估金字塔平衡成本与价值 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;12.4.1 用评估金字塔平衡成本与价值&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;Mike Cohn 曾提出测试金字塔（test pyramid）的概念。他发现不同类型的测试适合发现不同的bug。有些测试容易创建和维护（主要是单元测试），但这类测试无法捕捉所有 bug，所以还需要补充一些复杂的、运行较慢的集成测试。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;评估金字塔 (evaluation pyramid）有着相似的原理。大部分架构评估都能快速完成。对于快速评估无法发现的问题，可以补充少量深度评估。除了快速评估和深度评估，还可以采用定向评估（见下图）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/99bb754a619d85558673b6a24946c4f4/0a47e/2937bb4af6ba75ab.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 67.5531914893617%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC7ElEQVQ4y02RWVPiWhSF87ut7gcVZNBSRCBKEhvIHBKmAJnIAAgCYWjvj8lj1q1zrO7qh6/2Odl7r7XqhDmdD0jTHdLTHof0E8fTHpfLEafTHudziq+vEz2fTgfaIzP7/ZZyPO6RHnd0/3g8ID3uwex2W7pwuaR0gCz+/jri678zPjYrzOY2Lr9TnM7fvUO6w+HwSQnDAFEUIEki+L6L3X4LZu7MEcYh1psVVh9rrD/W2H5usNluwAvveHx6hj2zsfncIFklSJYJoiSmO3PXwWRqw3EdOK6LOInBjO0JHM9FEC4oZHi5XkOUZRTuSiiWyqjVX+D6PsI4gr8I4AUEH4swpIJzx0GwWMAPAjBEbBGF365RRFNOplOwb220eR5tXgAnvENSVKzXa0qcJIjiCFEUwfM8ShiGiOMYDIlLXIl7vEzg+h5e220q2GJfKUT0tc2h3+9juVpSISJAcF0X5NmCIKAw5B18Ej8KaWyOF1BvNNFkWTzVnikvjSbYtzewLIvhcEiT/BFwHAe2bVNhAjOajGkqIvir28Fj7Rn1lwblpdlEo9VCo9FAs9mktFot2FObinmej9lsRk183/8WVHUdnu9BUVXcFgoolcsoVyqo/EO1WsX9/T0eHh5QLpdRr9fhug5m0ykGgwFM04Q9sTGfz8GYpgXDMFAsFnFzc4NCoUDPpP748RNXV1coFooolUp/IT2Oa8OyLCiKguFwBLEn0qSMNbCo8/X1NW5vb/9Clgh/7v+a3d3d0W+dzi/Y9gSj0RiTyQTj8RhMTxLzrijmkiznkiTlsiznqqrmqqrksizliiLnmqbkmqbmmqbRnq5ruWFoua6ruWX1c8syKaPRIGfIj+j0uuiIPXR7PUiSBI7jwPMcut0OBIGnvAsCRFGEYejo9w0MBibFNA30+zqtlmmA4QQ+43gu4/nv2ul0slqtRmFZNnt6fMyqlWpWKVcyttXKJKmXiWI3UxQp0zSFomtqpmtK1je07H+/a0djrpBz8AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;2937bb4af6ba75ab&quot;
        title=&quot;2937bb4af6ba75ab&quot;
        src=&quot;/static/99bb754a619d85558673b6a24946c4f4/0a47e/2937bb4af6ba75ab.png&quot;
        srcset=&quot;/static/99bb754a619d85558673b6a24946c4f4/4dcb9/2937bb4af6ba75ab.png 188w,
/static/99bb754a619d85558673b6a24946c4f4/5ff7e/2937bb4af6ba75ab.png 375w,
/static/99bb754a619d85558673b6a24946c4f4/0a47e/2937bb4af6ba75ab.png 600w&quot;
        sizes=&quot;(max-width: 600px) 100vw, 600px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;一般的系统大约需要开展一两次深度评估、几十次定向评估、几百次快速评估。深度评估可以视为系统生命周期的重大里程碑。定向评估可以定期开展，平均两到四周举行一次。快速评估则应该作为开发流程的一部分，每天开展一次（或多次）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;仅仅做到持续评估还不够，我们还需要熟悉常见的架构问题类型，确保评估覆盖所有范围。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1242-发现各种类型的问题&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1242-%E5%8F%91%E7%8E%B0%E5%90%84%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E9%97%AE%E9%A2%98&quot; aria-label=&quot;1242 发现各种类型的问题 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;12.4.2 发现各种类型的问题&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;分为七类问题，来看看每一类问题具体是什么。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;风险&lt;/strong&gt; 风险是未来可能发生的糟糕的事情。描述风险需要两个部分：条件和后果。条件是当前的实际情况，后果是由条件引发的、将来可能出现的不良状况。我们要么选择降低风险，要么接受它。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;信息空白&lt;/strong&gt; 有时，我们缺少足够的信息判断架构是否满足关键架构需求。询问系统如何运转以及如何满足特定的架构需求，有助于发现信息空白，进而采取措施。从未发现的信息空白称为盲点。盲点的存在对架构来说是巨大的威胁。信息空白需要做进一步的调查和研究。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;麻烦&lt;/strong&gt; 和风险不同，麻烦是已经出现的问题。你制定了设计决策，但事情并没有按你期待的那样发展，就有麻烦了。有时，因为情况发生了变化，上一刻的明智之举在下一刻变得不合适了，这也是麻烦产生的原因。如果麻烦已经存在于代码里，我们称之为技术债务。我们要么选择解决麻烦，要么接受它。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;认知偏差&lt;/strong&gt; 你说往左，团队却以为要往右，这就是认知偏差。如果有人对架构的理解与当前的设计决策不相符，就出现了认知偏差。认知偏差尤其容易出现在架构频繁演变的系统中。认知偏差可以通过沟通、指导解决。
&lt;strong&gt;架构变异&lt;/strong&gt; 实现系统几乎不会按照我们预想的方式出现。理想中的架构与最终实现的架构之间的差异，称为架构变异，也叫架构偏移 (architectural drif）或架构腐烂（ architectural rot）。如果不保持警惕，架构每天都可能偏离既定设计，等到完成那天，你会发现它和原来的计划大相径庭。定期检查代码和文档，可以解决架构变异的问题。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;情境偏移&lt;/strong&gt; 世界无时无刻不在发生变化。开发过程中，新情况、新条件不断涌现。原来的快策有可能变得不合适了。也许我们刚做完设计决策，业务情境就发生了变化——这就是情境偏移 (contextual drif）。不定期地回顾业务目标、关键架构需求、利益相关方提供的材料可以避免情境偏移。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;经验不足的架构师往往只对某一类问题敏感。如果你想改善架构评估的效果，有一个简单的方法，那就是多问一些之前没有问过的问题。试着提出不同类型问题，你才能知道自己有多么“无知”。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1243-从仪式感弱的评估方法开始&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1243-%E4%BB%8E%E4%BB%AA%E5%BC%8F%E6%84%9F%E5%BC%B1%E7%9A%84%E8%AF%84%E4%BC%B0%E6%96%B9%E6%B3%95%E5%BC%80%E5%A7%8B&quot; aria-label=&quot;1243 从仪式感弱的评估方法开始 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;12.4.3 从仪式感弱的评估方法开始&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;方法的仪式感指的是运用它所包含的正式手续的数量。仪式感强的方法有很多约束，成本高，但其可复用性好，可以保证较好的效果。而仪式感弱的方法不拘小节，规矩少，易于上手，使用成本低，缺点是使用范围窄，难以保证效果。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果团队刚开始做架构评估，采用 ATAM 这种仪式感强的方法可能导致大家产生畏难情绪。因此，刚开始时可以从仪式感弱的方法开始，你甚至没必要告诉团队我们正在做架构评估。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我举一个例子。做完白板涂鸦(见第 15.9节）后，把大家把留下一起做评估。你先起个头：“看起来我们的进展很不错。大家看看还有什么办法可以提升这个质量属性？”，把大家的发言记到白板上。跟大家一起总结新的发现，然后确定下一步的行动。这样不到十分钟时间，就能完成一次临时的架构评估。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;仪式感弱的评估方法可以引发大家对架构的思考，同时树立质疑设计决策的团队文化。等团队适应后，可以逐步引入定向评估，最终进入深度评估。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;我们必须承认强仪式感的确能让人感受到架构会议的专业性，但是一定程度上会增加参会人员的压力。最终的效果可能反而会不尽人意。对于没有类似经验的团队，可以尝试将会议流程简化，调动参会人员的积极性，把交流讨论的氛围活跃起来。类似头脑风暴会议，但又不完全是。前者用于讨论确定初步的架构方案的那个环节，然后在进入本章讨论的架构方案评估环节。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;确定架构评估需要准备的资料，包括评估对象，评估准则。在组织评估会议前，需要提前准备，定义好评估目标，搜集评分所需要的数据，指定研讨会议程和其他相关资料。尽早评估，反复评估，持续评估。将架构评估加入到开发流程的一环中，有助于帮助完善架构。从仪式感弱的评估方式开始，减轻团队压力，引发团队对架构的思考，待团队适应之后，逐步引入仪式感强的评估方式，最终进入深度评估。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构是团队文化的有机组成部分。糟糕的架构会让人痛苦不堪。架构评估能帮助我们理解如何改善架构设计。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[《架构师修炼之道》摘录11-描述架构]]></title><description><![CDATA[本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。 全书整体分为三个部分 第一部分介绍软件架构的基础知识和架构师必备的设计思维 第二部分讲解架构师需要掌握的核心技能和知识 第三部分讨论一系列…]]></description><link>https://zhanglun.github.io/blogs/《架构师修炼之道》摘录11-描述架构/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/《架构师修炼之道》摘录11-描述架构/</guid><pubDate>Tue, 08 Feb 2022 08:10:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;全书整体分为三个部分&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第一部分介绍软件架构的基础知识和架构师必备的设计思维&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第二部分讲解架构师需要掌握的核心技能和知识&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第三部分讨论一系列使用的架构设计方法&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;前两部分适合从头到尾通读，第三部分用于参考和检索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;优秀的架构描述是有用的资产，它能促进沟通与协作，将设计决策和思想有效传递给每个人，提高软件开发的质量。用人性化的、简洁的形式向受众展示确切的信息。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;111-讲述完整的故事&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#111-%E8%AE%B2%E8%BF%B0%E5%AE%8C%E6%95%B4%E7%9A%84%E6%95%85%E4%BA%8B&quot; aria-label=&quot;111 讲述完整的故事 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;11.1 讲述完整的故事&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;架构描述的重要性主要体现在以下几个方面：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;**组织有序。**开发软件既要与人打交道，也要与技术打交道，两者同样重要，架构描述展示了所有东西是如何组织在一起的。为了管理和协调开发工作，每个人都需要知道系统中的组件如何系统运作。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;在开发人员与业务相关方之间建立通用语&lt;/strong&gt;。所有利益相关方都有权理解架构。架构模型建立了设计词汇，架构描述则将这些模型转化为利益相关方可以理解的形式。架构描述最重要的作用之一是向业务相关方展示软件架构是如何实现业务目标和提升质量属性的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;突出质量属性。&lt;/strong&gt; 质量属性通常不是那么清晰可见，容易被忽略。架构描述将质量属性视为一等公民，将质量属性清晰呈现出来，化虚为实，让人们可看、可读、可谈。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;理清思路。如果不试着写架构描述，很容易会以为所有东西都清楚了。笔尖触到纸的那一刻，你会发现脑子里的想法不过是一团糨糊。写架构描述强迫我们搞清楚什么是我们知道的，什么是我们认为我们知道的，还有什么是我们不知道的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;创建可评估的媒介。我们无法推演看不见、摸不着的东西。我们也不能等到设计决策在代码里实现后再来做评估。架构描述提供了一种分析设计决策的媒介，以便及时发现错误。花一个下午解释一个愚蠢的想法，总比花一个月开发要好的多。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;展示架构。软件架构很酷！你倾尽全力设计的系统，应该让所有人都来欣赏！架构描述是展示系统的有效方式，它能让客户和管理层对你的设计产生信心。架构描述中清晰的目标、计划、愿景将彰显你的领导能力。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;112-因地制宜选择描述方法&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#112-%E5%9B%A0%E5%9C%B0%E5%88%B6%E5%AE%9C%E9%80%89%E6%8B%A9%E6%8F%8F%E8%BF%B0%E6%96%B9%E6%B3%95&quot; aria-label=&quot;112 因地制宜选择描述方法 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;11.2 因地制宜，选择描述方法&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;为了决定如何描述和记录架构，架构师应该问自己两个问题。设计决策发生变更的可能性大吗？将来准备在多大程度上分享设计决策？你的回答决定了应该采用下述四种方法中的哪一种。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1034195d57ced750d01bb75574c75719/51800/cefd449e55a6b0fb.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 68.08510638297872%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRElEQVQ4y42UzY6DMAyE+/5vxpWKCycKErS0QAuoLb9efV6ZjVjobiTLIYnHM3bCYZomweZ5XrzNh2GQ9/stfd9L27ayPrs1P9jH2hiv10uu16skSaI2jqOuuyBr2wSE2fP5XACOx6N62NZ1reuuol2GBtA0jQRBoJ4RhqH60+kknucp8C6gScAY1Op+vysT8wZYVZWaK92NVcmPx0MzIhFGt9tNWMOXZamAsO26TtepKWeLotAaE4tBRBmez2cFIpjDcRzL5XKRPM8lyzJhH5kAAEggc+QTA2MjsEgW+aZsg8ywgolbQ8B939embY1fXbbuwTiKIpXLN4B4WLNOQju/e23crlnxkUIQdxBWJLKm/evauBuuUS830OR9vNhbGU0WkrfkfWZoG/MPCySnaardhCWy1wn/fCnrJ2jGD2KPpSv5C9bpQ4JCZw1bAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;cefd449e55a6b0fb&quot;
        title=&quot;cefd449e55a6b0fb&quot;
        src=&quot;/static/1034195d57ced750d01bb75574c75719/1d69c/cefd449e55a6b0fb.png&quot;
        srcset=&quot;/static/1034195d57ced750d01bb75574c75719/4dcb9/cefd449e55a6b0fb.png 188w,
/static/1034195d57ced750d01bb75574c75719/5ff7e/cefd449e55a6b0fb.png 375w,
/static/1034195d57ced750d01bb75574c75719/1d69c/cefd449e55a6b0fb.png 750w,
/static/1034195d57ced750d01bb75574c75719/78797/cefd449e55a6b0fb.png 1125w,
/static/1034195d57ced750d01bb75574c75719/51800/cefd449e55a6b0fb.png 1196w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1121-部落描述口述历史&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1121-%E9%83%A8%E8%90%BD%E6%8F%8F%E8%BF%B0%E5%8F%A3%E8%BF%B0%E5%8E%86%E5%8F%B2&quot; aria-label=&quot;1121 部落描述口述历史 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;11.2.1 部落描述：口述历史&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;部落描述方式严重依赖口头约定。故事、隐喻、草图都属于部落描述方法。我们的工作总是从这里开始。部落描述很容易修改，尤其符合初期架构设计的快速探索要求。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;虽然部落描述很容易生成和修改，但很难共享。当大家聚在一起工作时，系统隐喻可以很好地发挥运作。不过这种口头约定只在有人擅长讲解时才奏效，而且频繁讲解会让人筋疲力尽，哪怕是只有六个人的小团队。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1122-社区描述传播得更远&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1122-%E7%A4%BE%E5%8C%BA%E6%8F%8F%E8%BF%B0%E4%BC%A0%E6%92%AD%E5%BE%97%E6%9B%B4%E8%BF%9C&quot; aria-label=&quot;1122 社区描述传播得更远 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;11.2.2 社区描述：传播得更远&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;根据经验，如果你发现自己不止一次向同时讲解某一处架构设计，那么就应该设法采用更易于分享的方式描述架构。社区描述方法就派上用场了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;社区描述方法的重点是可以在社区内蓉香，而不仅仅靠口口相传。架构主旨、架构显见的编码风格、架构决策记录都是社区描述方法。社区描述也有易于修改的特点，而且比部落描述容易分享。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;随着架构逐渐成熟，大多数团队会自然地从&lt;strong&gt;部落描述&lt;/strong&gt;过渡到&lt;strong&gt;社区描述&lt;/strong&gt;。社区描述方法对于许多团队来说已经够用了。如果项目还需要一些更持久的东西，则可以采用正式描述方式。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1123-正式描述方式必要时才采用&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1123-%E6%AD%A3%E5%BC%8F%E6%8F%8F%E8%BF%B0%E6%96%B9%E5%BC%8F%E5%BF%85%E8%A6%81%E6%97%B6%E6%89%8D%E9%87%87%E7%94%A8&quot; aria-label=&quot;1123 正式描述方式必要时才采用 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;11.2.3 正式描述方式：必要时才采用&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;正式描述由传统的架构藐视文件和正式模式组成。这类文档很长，需要更多精力创建。正式模型（用数学模型定义的那种架构）需要更高的准确度和精度。如果系统风险和架构决策风险较高，或是需要高度协作，可以考虑采用正式描述方法。另外，有些行业可能要求使用正式文档。即便如此，创建正式描述之前，最好还是从部落描述和社区描述开始。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1124-创建传统的软件架构描述&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1124-%E5%88%9B%E5%BB%BA%E4%BC%A0%E7%BB%9F%E7%9A%84%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E6%8F%8F%E8%BF%B0&quot; aria-label=&quot;1124 创建传统的软件架构描述 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;11.2.4 创建传统的软件架构描述&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;每个架构师都应该会写传统的软件架构描述（SAD）文档。虽然写这类文档非常耗时，但它们有重要的价值。我不是说要文档写得很长，只是说传统的SAD在合适的时候也能发挥作用。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;大多数利益相关方，甚至是开发人员，可能从未见过整个架构。而 SAD 可以将所有东西汇总在一起。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;写传统架构描述的第一步是创建或者查找文档模板。网上有许多现成的模板。所有传统架构描述都包含相同的基本部分：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;引言和导读信息。&lt;/strong&gt; 包含标题页、版本说明、签名页、目录、图表目录、许可和法律声明等。目录和图表目录可用于检索。其余部分旨在表明文件中所掌握信息的重要性。有的利益相关方可能认为这些内容很重要。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;文档综述和简介。&lt;/strong&gt; 简要介绍文档的目录以及组织和创建文档的方法。SAD 可能是某些利益相关方第一次读到的架构描述。你可以借此机会适当介绍背景知识，以便读者能够欣赏你的架构设计。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;利益相关方诉求、业务目标和关键架构需求概述。&lt;/strong&gt; 架构中的所有决策都基于利益相关方的诉求，因此在描述设计之前有必要列出这些诉求。如果你已经创建了ASR工作簿，可以在这里说明，并给出链接。架构描述应该做到尽量简洁，避免重复，就像代码一样。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;系统情景图。&lt;/strong&gt; 简要介绍软件系统所处的背景和环境&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;相关视图。&lt;/strong&gt; 围绕受众关心的问题组织视图。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;风险、未解决问题及后续工作。&lt;/strong&gt; 总结已知的风险和未解决问题。这样做的目的是在已知的“雷区”周围点亮红灯，提醒以后的设计人员。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;附录。&lt;/strong&gt; 至少应该给出术语表。我建议将质量属性分类方案作为附录。有些正式文档的附录还包括变更流程和变更请求模板。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;创建 SAD 可能会让人精疲力尽，需要团队协作完成。可以制定一个人负责创建模板并分配编写任务，同时确保文件内容、风格统一。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1125-徒劳描述&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1125-%E5%BE%92%E5%8A%B3%E6%8F%8F%E8%BF%B0&quot; aria-label=&quot;1125 徒劳描述 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;11.2.5 徒劳描述&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;徒劳描述指的是难以更改、难以分享的描述方法。在实际工作中，最好不要采用这种描述方法。让我们来看看徒劳描述的例子。用精美的幻灯片描述架构就属于徒劳描述，这是一种浪费时间的做法。精美的幻灯片不是不好，但制作起来费时。你需要花数小时调整标题、字体等细节。投入这么多精力后，即使内容有变化，也没有人愿意再去修改那些精美的布局。与部落描述方法相比，幻灯片就像是刻在了石头上，很难擦洗。不过，无论采用哪种描述方法，出色的描述都有以下四个特征：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;根据受众的需求定制。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;用多个视图展示架构。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;清晰定义元素及其功能。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;解释设计决策的逻辑依据。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;113-尊重受众&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#113-%E5%B0%8A%E9%87%8D%E5%8F%97%E4%BC%97&quot; aria-label=&quot;113 尊重受众 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;11.3 尊重受众&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;设计思维的四条原则指出：设计的本质是社交。谁会读你的架构描述？他们需要什么？如何才能提供他们需要的信息？之前通过换位思考，我们已经确定了利益相关方的需求。我们设计了架构，用来解决他们的问题，现在要做的就是设法分享这些信息。只有了解受众，才能写好架构描述。你写得越好，人们越愿意阅读，这又会进一步扩大设计决策的影响。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们都见过某些开源项目的代码库，用一个文件夹装数百个源文件。你花了很多精力推测这些系统是如何运行的，仍然免不了犯错。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果换个方式组织代码，理解起来会容易很多，比如将代码按层次组织，这样就可以随时放大查看细节，缩小纵观全局。分层有助于清晰思考。如果你希望别人理解你的代码，就必须自己创建层次，讲清楚系统的故事。同时充分利用架构模式提供的通用名称，如连接器、层等。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;分层需要花时间进行调整，才能做到清晰无误。今天你可能只有三个连接器，放在一个文件夹里没问题，但你需要不断调整，否则等出现几十个连接器，还放在一个文件夹里就麻烦了。小洞不补，大洞吃苦。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;将注意力集中在源代码上是相对容易的，但系统的运行同样值得关注，还有如何将其分配到硬件和容器里。如果你希望清晰地思考，不妨从多个层次讲故事。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;考虑利益相关方及其关心的问题。他们在项目中的角色和职责是什么？他们如何处理信息？他们如何使用你提供的信息？有时，创建受众的移情图（empathy map）是个不错的办法。下图是一位开发人员的移情图。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 618px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d1973715034c78b628368b0f6a24d2a6/6e6fb/3a41e401bdbe26bc.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 87.7659574468085%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADr0lEQVQ4y01UaW/bRhDlL06BHmiB5otRByjqo3Utm7J1UaQpkRTvm+KlgxKpK1abVHHzZ16xEyPoh8Esl7tv5r03JHd6OeHl8wmnl3/w4eNfeH/cY7ffYLuvKfaHBrvDBs1mjVW9QLWaY74oUMxSFLMMs0WB+bLEcjXHspqD+3D6iOe/j9g977He1Ki3DeWqrijqzRppniJJp6jWFWaLGfIyQ5RECOMQfhS8riNkZQ7u078nrJsVbSZpjGZbY1EtkKQJ4jRGXuaIpzGCyIcXuNB0DRNTe332wD/wuL1rQZREZGUG7uXzJ2x2NZIsRpSERI/RmugKFEVGUU6xqErKiirj7u4WQ7GPfDZFmse4ufkD796dQx6JWNcLcIfjEaumxny5RFoUKBcLREkCaTSCJMtwfR9BFFI3j90uLq+v0RcGsD0HpmNBkCQIogRZUeAFAbhmd0BVN4imKdwghBtECOIEtudT+FEMw3KgGSZMx4Vh29AtC5pp4rHXw+09j4duj94btgOu3u6wXNeQ5BE6vT4mpoUky6lAnGbIZ3MCYZEWOZI8RThNYPsefv3tAj/8+BMur3+ne5brgds/P6PZbuF4LkzHhh+GRD+aJrRm7rqBD8uxyUkv8OGFATRdx327jcvrK3T6PViOQ+e598dnVOsV/DAgndhFlieGjrGmwPU9PI1kSPITLMeCOtFgmAbGqgJVUzFSxrQ2bZPGiNseDqi3G+SzgkaFGRBPEwJioKzAt99/hzffvKHLLL4UkCA9SRCGAgRRIFA38MBt9ns02w11yD+0MRgKyGclsiKH67m0L0oSuv3e12FmQWxcG51el4I5r5sGc3mLetNA0ye4b/MYSiLplpcF0jxDOZ8hjEIYlkndWrYJx3NoZg3LwC/n5/j57VsabsaIANdNjSiJiabtOiQ+00rRVJo127WJ0j3Po3XXwmg8QhgF0E0dj50O+DZP7Nh5rqrXBPRFXJX0Y+DdXg93PE+dMcGZbny7jYfOIxnE9hRN+WoYywyDW9VrdHt9XFxdoS8ImGYpdTh81c20TAJVVAUWAzcN0kp8knBz+ydarRYGggBVVekMN1vMIYgiVZgYBnXHnGZmsGD66YaOyURFEPoIQx9+4EEYDnB2doaLywsMBgOMx2OSgivmJbKyQJKlBMS+Y9YhA6Y8TcgwRVXh+T5sx6aOh08S0WfaMXlkWaYx4th4pEVGjjK6TMP/A7IiQRjAcR24rkuATAYWE2NCurFflyRJGIoi/gMTZ1DsLJOVHAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;3a41e401bdbe26bc&quot;
        title=&quot;3a41e401bdbe26bc&quot;
        src=&quot;/static/d1973715034c78b628368b0f6a24d2a6/6e6fb/3a41e401bdbe26bc.png&quot;
        srcset=&quot;/static/d1973715034c78b628368b0f6a24d2a6/4dcb9/3a41e401bdbe26bc.png 188w,
/static/d1973715034c78b628368b0f6a24d2a6/5ff7e/3a41e401bdbe26bc.png 375w,
/static/d1973715034c78b628368b0f6a24d2a6/6e6fb/3a41e401bdbe26bc.png 618w&quot;
        sizes=&quot;(max-width: 618px) 100vw, 618px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;从这张移情图中不难看出，这位开发人员需要一份清晰的、有逻辑依据的文档，因为他喜欢就每个决策展开辩论。他对部署感兴趣，并且关注技术细节。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;明白受众需要的信息和消化信息方式后，我们来看看如何为他们提供易理解的架构描述。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1131-提高可理解性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1131-%E6%8F%90%E9%AB%98%E5%8F%AF%E7%90%86%E8%A7%A3%E6%80%A7&quot; aria-label=&quot;1131 提高可理解性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;11.3.1 提高可理解性&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;写架构描述的目的在于与受众沟通。请使用受众熟悉的领域语言，提高架构描述的可理解性。如果利益相关方总是提到物料主编码（material master number），请尊重他们的习惯，而不要引入新的词汇（比如产品ID）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;描述复杂、抽象的想法时尤其要小心。尽量使用大白话，避免使用生僻的行话。必要时，可以对架构概念做简单的解释，以确保受众掌握必要的背景知识。沿用利益相关方已经使用的设计术语（除非存在误用）。例如，如果对方习惯使用非功能性需求，那么你就不要使用质量属性。首先保证有效沟通。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;符号的使用也会影响可理解性。不是所有人都了解设计符号的用法，尤其是 UML 的用法。UML有几种风格，虽然它可以表现设计构思，但有时并不是那么直观。你可能精通 UML 图表的用法，但并非所有人都对 UML 了如指掌。第10.2节提到过，所有图表都应该附上图例，用图例说明符号的意义和元模型。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;最后，请用标准模板写文档，这样看起来更专业。统一对齐方式，考虑版式在屏幕上显示和打印的效果。漂亮的文档能给读者留下好印象，说明内容是由专业人士创建的，值得信赖。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;114-围绕利益相关方关注点组织视图&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#114-%E5%9B%B4%E7%BB%95%E5%88%A9%E7%9B%8A%E7%9B%B8%E5%85%B3%E6%96%B9%E5%85%B3%E6%B3%A8%E7%82%B9%E7%BB%84%E7%BB%87%E8%A7%86%E5%9B%BE&quot; aria-label=&quot;114 围绕利益相关方关注点组织视图 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;11.4 围绕利益相关方关注点组织视图&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;对你正在开发的软件，不同的人有不同的关注点。开发人员希望了解代码结构、部署方式、组件交互方式。测试人员希望了解接口和通信协议。产品负责人希望了解技术依赖和整体进度。新成员可能会被文档淹没，需要帮助才能起步。另外，架构描述至少还应包含设计决策、决策依据和架构结构。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这些信息的组织方式很重要。设计以人为本，这条原则既适用于设计本身，也适用于对设计细节的分享。两者同样重要。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;从利益相关方的角度出发，组织架构视图和各种设计文档，对方理解架构就会容易得多。我们应该考虑对方想了解什么，然后从这个角度创建架构视图。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1141-建立视点&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1141-%E5%BB%BA%E7%AB%8B%E8%A7%86%E7%82%B9&quot; aria-label=&quot;1141 建立视点 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;11.4.1 建立视点&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;视点（viewpoint）决定了你如何从利益相关方的角度描述架构。视点不仅决定了应该展示哪些视图，也决定了视图的受众，以及视图使用的符号、词汇、规则。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;视点的定义虽然来自传统的架构描述，但其原则适用于我们讨论过的所有架构描述方法。软件行业已经有一些制定好的视点集。我推荐软件工程研究所 (Sofware Engincering Institute, SEI)的超越视图方法、Phillipe Krutchen 的 4+1 视图模型(4+1 View Model) 、Rozanksi 和 Woods 的视点与视角 (Viewpoints and Perspectives)，以及 Simon Brown 的C4 模型。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;视点通常是围绕质量属性组织的。你也可以构建视点来满足特定利益相关方的需求。这里有一些例子：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;可扩缩性视点、安全性视点、可维护性视点可以展示架构如何满足这些质量属性场景。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;监管视点可以为关心监管信息的利益相关方提供所需信息，用于审计。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;指导视点可以让新成员初步熟悉架构和开发方式，让他们在第一天就能提交代码。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;业务视点可以展示架构的不同部分如何贡献业务价值。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;视点在传统架构描述中是必不可少的。我们可以使用部落描述和社区描述将其简化。例如，如果代码库己经有多个 ADR，就可以创建一个视点页面将这些决策的链接汇总起来。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;视图帮助我们组织想法，以便有效地共享架构信息。架构描述不仅仅包含视图和设计决策，还应该说明为什么这样决策。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;115-阐述决策的逻辑依据&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#115-%E9%98%90%E8%BF%B0%E5%86%B3%E7%AD%96%E7%9A%84%E9%80%BB%E8%BE%91%E4%BE%9D%E6%8D%AE&quot; aria-label=&quot;115 阐述决策的逻辑依据 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;11.5 阐述决策的逻辑依据&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;设计的逻辑依据 （design rationale）是你做出设计决策的理由，比如为了提升某个质量属性选择某种架构模式，或者为了节省成本选择某种技术。每个决策都有利有弊，设计的逻辑依据说明了我们是如何权衡利弊，最后做出决策的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;后续设计人员越了解决策依据，就越容易接受你的设计意图。其他人越了解决策意图，就越容易在系统的演变过程中维护架构的完整性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构描达中的逻辑依据有多种形式，比如文字描述或几条要点。有时候，列出所有淘汰的方案比冗长的解释更有说服力。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1151-描述未选择的道路&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1151-%E6%8F%8F%E8%BF%B0%E6%9C%AA%E9%80%89%E6%8B%A9%E7%9A%84%E9%81%93%E8%B7%AF&quot; aria-label=&quot;1151 描述未选择的道路 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;11.5.1 描述未选择的道路&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;开发软件就像一趟旅程。道路蜿蜒曲折，也许有数十条路通往同一目的地。你的每一次决策，都能帮助别人明白为什么要这样设计。有一种描述方式是列出那些被淘汰的方案。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们做决策时不是所有人都在场。列出淘汰方案相当于对决策过程进行回放，以便其他人理解我们是怎么走到这里的。如果省略这些信息，就如同看电影只看到了最后五分钟——错过了所有的剧情，也就难以理解角色最后的行为。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们淘汰的想法远远多于留下的。人们可以在眨眼间闪过几十个念头，有些甚至连自己都没有意识到。经团队讨论做出的任何决定都应该正式记录下来。如果你发现自己有强烈的表达愿望，试着将你的想法记录下来，其他人也将丛中受益。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;架构描述的好坏取决于编写的人，你必须了解受众希望看到哪些内容，从他们的角度组织架构视图。别忘了描述元素及其共呢个，还有选择它们的原因。另外要选择恰当的描述方法，冗长死板的文档并不是解释设计决策的唯一办法。最重要的是有效地向他人解释架构设计。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;描述架构为我们提供了检验系统设计的第一次机会。能够在早期检验架构，这是一件好事情。接下来我们需要开展架构评估，减少后续的麻烦。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[《架构师修炼之道》摘录10-展示设计决策]]></title><description><![CDATA[本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。 全书整体分为三个部分 第一部分介绍软件架构的基础知识和架构师必备的设计思维 第二部分讲解架构师需要掌握的核心技能和知识 第三部分讨论一系列…]]></description><link>https://zhanglun.github.io/blogs/《架构师修炼之道》摘录10-展示设计决策/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/《架构师修炼之道》摘录10-展示设计决策/</guid><pubDate>Sun, 30 Jan 2022 06:00:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;全书整体分为三个部分&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第一部分介绍软件架构的基础知识和架构师必备的设计思维&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第二部分讲解架构师需要掌握的核心技能和知识&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第三部分讨论一系列使用的架构设计方法&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;前两部分适合从头到尾通读，第三部分用于参考和检索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;分享设计想法的最佳方式是把它展示出来。光凭嘴说，别人可能很难理解你的思路。把架构画出来，大家就能按照自己的节奏和方式来琢磨。开发人员都清楚，讨论抽象最好的方式就是找一块白板，画点草图。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构图没有必要画得很精致，只要能够有效表达想法就行。本章学习绘制架构图，以便开发人员沟通。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;101-用不同的视图展现架构&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#101-%E7%94%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E8%A7%86%E5%9B%BE%E5%B1%95%E7%8E%B0%E6%9E%B6%E6%9E%84&quot; aria-label=&quot;101 用不同的视图展现架构 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;10.1 用不同的视图展现架构&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;一张图画出架构的所有细节是不可能的，需要创建多个架构图视图。视图要么代表了利益相关方的视角，要么解决了一组问题。不同的架构视图可以回答不同的问题。开发进展如何？谁负责开发这些组件？如何支持质量属性场景？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;软件系统各不相同，因此没有固定的视图组合。不过有几个视图对大多数软件系统都适用。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1011-元素功能视图&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1011-%E5%85%83%E7%B4%A0%E5%8A%9F%E8%83%BD%E8%A7%86%E5%9B%BE&quot; aria-label=&quot;1011 元素功能视图 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;10.1.1 元素功能视图&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;线条和方框是架构师最常画的东西。虽然线框图可以表现元素之间的复杂关系，但其架构意义却不是那么显而易见。回忆一下这一张图&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这张图还缺少了元素的功能信息。根据要分享的信息，你可以选择用注释、表格、描述性文字来说明元素的功能。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1012-精细视图&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1012-%E7%B2%BE%E7%BB%86%E8%A7%86%E5%9B%BE&quot; aria-label=&quot;1012 精细视图 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;10.1.2 精细视图&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;精细视图增加了模型细节，可以不断放大，显示元素的内部运行情况。精细视图聚焦于局部。在逐步放大的过程中，我们既能看清全局，也能掌握关键的细节。精细视图要画到什么程度，可以参考“推出决策”原则。当需要展示特定的质量属性，或者降低高优先级风险时，才有必要将视图进一步细化。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1013-质量属性视图&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1013-%E8%B4%A8%E9%87%8F%E5%B1%9E%E6%80%A7%E8%A7%86%E5%9B%BE&quot; aria-label=&quot;1013 质量属性视图 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;10.1.3 质量属性视图&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;质量属性视图展示了架构如何提升特定的质量属性。它还可以隐藏某些与当前问题无关的细节。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;比如要保证可以性，业务组件需要多个实例，在图中可以使用多个图形来表示多实例。比如要解决并发请求的性能瓶颈，架构需要负载均衡器。负载均衡器也需要在图中展示。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;如果一张图不足以解释架构如何保证可用性，可以用文字进一步补充细节。就像元素功能视图中提到的一样。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1014-映射视图&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1014-%E6%98%A0%E5%B0%84%E8%A7%86%E5%9B%BE&quot; aria-label=&quot;1014 映射视图 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;10.1.4 映射视图&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;随着视图越来越多，不同视图中元素的关联和关系变得越来越难看清。映射视图可以解决这个问题。它把两个或两个以上的视图组合到一个新的视图里，以便展示元素之间的关系。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1015-粗略视图&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1015-%E7%B2%97%E7%95%A5%E8%A7%86%E5%9B%BE&quot; aria-label=&quot;1015 粗略视图 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;10.1.5 粗略视图&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;前面介绍的视图都比较精确，但是精确的模型需要细节支撑，制作起来非常耗时。有时甚至会妨碍沟通。刚开始接触系统时，使用粗略的模型也许更加有效。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构草图是一种可以快速绘制但不精确的模型。使用简单的符号，省略了精细视图的许多细节。草图适合用来构思设计。等架构稳定后，再创建更精确的模型不迟。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1016-自定义视图&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1016-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%86%E5%9B%BE&quot; aria-label=&quot;1016 自定义视图 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;10.1.6 自定义视图&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;绘制架构图是为了与利益相关方进行有效的沟通。要是能满足这个目标，采用什么样的形式都行。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;视图总是某种“成分“的组合：元素与功能，质量属性与模式，元素与项目进度等。绘制新视图非常简单，只要将新”成分“与架构元素组合在一起就行。如果你想展示系统的性能瓶颈，可以先用组件图画出系统的信息流，然后按执行顺序给组件涂上各种颜色，一张性能视图就画好了。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;102-绘制出色的图表&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#102-%E7%BB%98%E5%88%B6%E5%87%BA%E8%89%B2%E7%9A%84%E5%9B%BE%E8%A1%A8&quot; aria-label=&quot;102 绘制出色的图表 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;10.2 绘制出色的图表&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;出色的图表可以降低大家理解架构的难度。下面是一些技巧：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;建议&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;添加图例，对图中元素进行说明。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;添加描述性文字，说明图中结构类型。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;添加文本注释，便于理解。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;所有图表使用一致的符号。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;突出显示模式。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;避免&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;假定受众了解你用的符号（哪怕是 UML)。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;把所有内容都画在一张图表里。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;使用黑白打印时无法区分的符号。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;使用多余的装饰和不必要的形状和线条。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;省略文字描述。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1021-使用图例&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1021-%E4%BD%BF%E7%94%A8%E5%9B%BE%E4%BE%8B&quot; aria-label=&quot;1021 使用图例 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;10.2.1 使用图例&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;图例对视图采用的元模型进行了说明。添加图例可以让图表保持前后一致，提高其可读性与实用性。无论你采用什么符号，图表都应该有图例。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1022-突出模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1022-%E7%AA%81%E5%87%BA%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;1022 突出模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;10.2.2 突出模式&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;通过移动元模型的位置，重点突出架构模式。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1023-简介与一致&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1023-%E7%AE%80%E4%BB%8B%E4%B8%8E%E4%B8%80%E8%87%B4&quot; aria-label=&quot;1023 简介与一致 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;10.2.3 简介与一致&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;每一笔每一画都要有所指。颜色、形状、方向、字体、位置的选择都要代表某种含义。添加不必要的细节和装置指挥增加他人理解的难度。选择多种颜色和形状应该时为了突出想法，而不是为了画蛇添足。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;注意图表的一致性，如果某个元模型概念出现在两张图中，最好用相同的形状和颜色来表示。如果你不想可以表现什么，就不要随便改变颜色和字体。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;细节太多容易产生混淆。不同形状的箭头应该代表不同的含义，否则混用各种形状的箭头只会叫人犯晕。在清晰表达设计思路的前提下应力争保持简洁。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1024-描述性文字&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1024-%E6%8F%8F%E8%BF%B0%E6%80%A7%E6%96%87%E5%AD%97&quot; aria-label=&quot;1024 描述性文字 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;10.2.4 描述性文字&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;用来描述图片的文字往往是视图中最有趣的部分。这些文字既可以解释视图中的元素时如何组织在一起提升或抑制质量属性的，也可以说明为什么要用这种方式设计系统。有时候，图表反而是视图中最无趣的部分，因为精华都在这些文字里。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;描述性的文字讲述了架构的故事，它的形式多样，可以是一小段文字，或者几条要点。视图上加上借助文字和图表共同来讲述架构故事的：架构从哪里来、它怎么工作、它的目标时什么。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;1025-练习题&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1025-%E7%BB%83%E4%B9%A0%E9%A2%98&quot; aria-label=&quot;1025 练习题 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;10.2.5 练习题&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;找出你最近参与项目的架构视图。试着分析这些图表还能做哪些改进？考虑一下事情：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;图表能帮你推演什么？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;图表中的基本模式时什么？有隐藏的模式吗？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;底层元模型时什么？可以直接从图表中看出来吗？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;图表是否完整？在表达设计思路的前提下，还能再简化吗？&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;本章主要学习了如何用图表来展示架构设计决策。介绍了几种常见的视图及绘制高质量图表的技巧。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[使用SQLite做为Rust项目的数据库]]></title><description><![CDATA[在使用 Rust 开发应用时，需要用到 SQLite 做为应用的本地数据库。在目前Rust的生态中，SQLite相关的 Crate 还是挺多的。我选择了 Diesel 这个ORM库。原因无他，文档全，star多，使用相对简单。本文我将通过一个简单的案例，演示如何使用 Diese…]]></description><link>https://zhanglun.github.io/blogs/使用SQLite做为Rust项目的数据库/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/使用SQLite做为Rust项目的数据库/</guid><pubDate>Fri, 21 Jan 2022 14:28:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;在使用 Rust 开发应用时，需要用到 SQLite 做为应用的本地数据库。在目前Rust的生态中，SQLite相关的 Crate 还是挺多的。我选择了 &lt;a href=&quot;https://github.com/diesel-rs/diesel&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;Diesel&lt;/strong&gt;&lt;/a&gt; 这个ORM库。原因无他，文档全，star多，使用相对简单。本文我将通过一个简单的案例，演示如何使用 Diesel，在 SQLite 中实现对数据的 CRUD。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;安装依赖&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96&quot; aria-label=&quot;安装依赖 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装依赖&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;首先将Diesel添加到项目依赖中，Diesel推荐使用 &lt;code&gt;.env&lt;/code&gt; 文件来管理项目的环境变量，所以还需要再加上 dotenv这个工具。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;[dependencies]
diesel = { version = &amp;quot;1.4.4&amp;quot;, features = [&amp;quot;postgres&amp;quot;] }
dotenv = &amp;quot;0.15.0&amp;quot;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;初次之外，Diesel提供一个独立的命令行工具：diesel-cli，用以帮助管理项目。这是一个独立的包，不会影响项目的结构和代码。只需要安装在系统中即可。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;cargo install diesel-cli&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;diesel 是一个支持MySQL，PostgreSQL和SQLite的ORM工具。这三种数据库都有各自的依赖。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://www.postgresql.org/docs/current/libpq.html&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;libpq&lt;/strong&gt;&lt;/a&gt; PostgreSQL 依赖的客户端二进制&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://dev.mysql.com/doc/c-api/8.0/en/c-api-implementations.html&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;libmysqlclient&lt;/strong&gt;&lt;/a&gt;  MySQL 依赖的客户端二进制&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://www.sqlite.org/index.html&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;libsqlite3&lt;/strong&gt;&lt;/a&gt; SQlite 依赖的客户端二进制&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;默认情况下，diesel-cli 在安装时会检查这些依赖，你可以事先在你的操作系统中安装好对应的依赖，也可以在安装cli时使用&lt;code&gt;-no-default-features&lt;/code&gt; 跳过。你也可以在安装时指定对应的数据库。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;cargo install diesel_cli --no-default-features --features postgres
cargo install diesel_cli --no-default-features --features sqlite&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;在项目中设置Diesel&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E8%AE%BE%E7%BD%AEDiesel&quot; aria-label=&quot;在项目中设置Diesel permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;在项目中设置Diesel&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;Diesel 通过设置的环境变量 &lt;strong&gt;DATABASE_URL&lt;/strong&gt; 找到我们的数据库。在项目中创建 &lt;code&gt;.env&lt;/code&gt; 文件做为项目的环境相关的配置文件，通过dotenv来解析。比如，将SQLite的DB文件放在项目根目录中。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;echo DATABASE_URL=./my.db &amp;gt; .env&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;然后为项目添加依赖。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;json&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;[dependencies]
diesel = { version = &amp;quot;^1.1.0&amp;quot;, features = [&amp;quot;sqlite&amp;quot;] }
dotenv = &amp;quot;0.9.0&amp;quot;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;接下来就可以初始化数据库，创建脚本了。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;diesel setup
diesel migration generate create_posts&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果一切顺利的话，项目中会出现一个 &lt;code&gt;my.db&lt;/code&gt; 文件和一个 &lt;code&gt;migrations&lt;/code&gt; 目录。在 &lt;code&gt;migrations&lt;/code&gt;
目录中有一个&lt;code&gt;up.sql&lt;/code&gt;和一个&lt;code&gt;down.sql&lt;/code&gt;。&lt;code&gt;migrations&lt;/code&gt; 中文件可以帮我们在项目开发过程中，高效演进和完善数据库模型。当你在对数据库进行migration时，实际上是执行了这个版本中的&lt;code&gt;up.sql&lt;/code&gt;。而在回滚时，执行的则是&lt;code&gt;down.sql&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;另外 setup 时还会创建一个&lt;code&gt;diesel.toml&lt;/code&gt; 。这是 diesel-cli 在当前项目中的配置文件，CLI 默认会从Cargo.toml文件所在的目录中查找这个文件。当然你也可以通过环境变 &lt;strong&gt;DIESEL_CONFIG_FILE&lt;/strong&gt;修改。配置文件在创建时会自动填入以下配置，这段配置指定了 diesel 创建的数据库 schema 保存的文件路径。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;sql&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;[print_schema]
file = &amp;quot;src/schema.rs&amp;quot;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;创建数据库模型&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A8%A1%E5%9E%8B&quot; aria-label=&quot;创建数据库模型 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建数据库模型&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;接下来创建第一个版本的数据库模型。分别修改&lt;code&gt;up.sql&lt;/code&gt; 和&lt;code&gt;down.sql&lt;/code&gt;。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;sql&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;CREATE TABLE posts (
  id INTEGER NOT NULL PRIMARY KEY,
  title VARCHAR NOT NULL,
  body TEXT NOT NULL,
  published BOOLEAN NOT NULL DEFAULT &amp;#39;f&amp;#39;
)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;sql&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;DROP TABLE channels&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;SQL语句准备就绪，我们可以试着使用这个版本。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;sql&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;diesel migration run &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;通常来说，如果命令执行成功，会在 src 目录下创建一个 &lt;code&gt;schema.rs&lt;/code&gt;。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;rust&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;table! {
    posts (id) {
        id -&amp;gt; Integer,
        title -&amp;gt; Text,
        body -&amp;gt; Text,
        published -&amp;gt; Bool,
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;前文提到过数据库schema输出的路径可以通过diesel.toml 设置&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;每次执行 diesel migration run 或者 diesel migration redo 时，新的schema都会创建并输出到目录中。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;写点代码试试&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%86%99%E7%82%B9%E4%BB%A3%E7%A0%81%E8%AF%95%E8%AF%95&quot; aria-label=&quot;写点代码试试 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;写点代码试试&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;现在项目准备就绪了，我们写一点Rust代码，实现post数据的展示。首先先实现数据库的连接。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;连接数据库创建-Post-结构体&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%9B%E5%BB%BA-Post-%E7%BB%93%E6%9E%84%E4%BD%93&quot; aria-label=&quot;连接数据库创建 Post 结构体 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;连接数据库，创建 Post 结构体&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在&lt;code&gt;src/lib.rs&lt;/code&gt;中实现连接数据库的逻辑。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;rust&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;pub mod schema;
pub mod models;
#[macro_use]
extern crate diesel;
extern crate dotenv;

use diesel::prelude::*;
use diesel::sqlite::SqliteConnection;
use dotenv::dotenv;
use std::env;

pub fn establish_connection() -&amp;gt; SqliteConnection {
    dotenv().ok();

    let database_url = env::var(&amp;quot;DATABASE_URL&amp;quot;)
        .expect(&amp;quot;DATABASE_URL must be set&amp;quot;);
    SqliteConnection::establish(&amp;amp;database_url)
        .expect(&amp;amp;format!(&amp;quot;Error connecting to {}&amp;quot;, database_url))
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;然后在&lt;code&gt;src/models.rs&lt;/code&gt;中创建刚才声明的两个 Module。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;rust&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;#[derive(Queryable)]
pub struct Post {
    pub id: i32,
    pub title: String,
    pub body: String,
    pub published: bool,
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;#[derive(Queryable)]&lt;/code&gt; 将生成从 SQL 查询加载 Post 结构所需的所有代码。数据库的schema由Diesel自动创建，这一点已经在前文中提及，这里就不再赘述。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;读取-Post-数据&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%AF%BB%E5%8F%96-Post-%E6%95%B0%E6%8D%AE&quot; aria-label=&quot;读取 Post 数据 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;读取 Post 数据&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;接下来实现一个简单的数据读取的过程。新建文件&lt;code&gt;src/bin/show_posts.rs&lt;/code&gt; ，这个文件做的事情是连接数据库、查询数据和输出数据。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;rust&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;extern crate diesel_demo;
extern crate diesel;

use self::diesel_demo::*;
use self::models::*;
use self::diesel::prelude::*;

fn main() {
    use diesel_demo::schema::posts::dsl::*;

    let connection = establish_connection();
    let results = posts.filter(published.eq(true))
        .limit(5)
        .load::&amp;lt;Post&amp;gt;(&amp;amp;connection)
        .expect(&amp;quot;Error loading posts&amp;quot;);

    println!(&amp;quot;Displaying {} posts&amp;quot;, results.len());
    for post in results {
        println!(&amp;quot;{}&amp;quot;, post.title);
        println!(&amp;quot;----------\n&amp;quot;);
        println!(&amp;quot;{}&amp;quot;, post.body);
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;试着执行&lt;code&gt;cargo run --bin show_posts&lt;/code&gt;看看效果，编译通过之后控制台会输出以下内容：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Displaying 0 posts&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;写入-Post-数据&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%86%99%E5%85%A5-Post-%E6%95%B0%E6%8D%AE&quot; aria-label=&quot;写入 Post 数据 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;写入 Post 数据&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;因为现在数据库中还没有数据，我们需要创建Post数据。首先在&lt;code&gt;src/models.rs&lt;/code&gt;中定义结构体&lt;code&gt;NewPost&lt;/code&gt;，然后在&lt;code&gt;src/lib.rs&lt;/code&gt;中实现&lt;code&gt;create_post&lt;/code&gt;。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;rust&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;use super::schema::posts;

#[derive(Insertable)]
#[table_name=&amp;quot;posts&amp;quot;]
pub struct NewPost&amp;lt;&amp;#39;a&amp;gt; {
    pub title: &amp;amp;&amp;#39;a str,
    pub body: &amp;amp;&amp;#39;a str,
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;rust&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;use self::models::{Post, NewPost};

pub fn create_post&amp;lt;&amp;#39;a&amp;gt;(conn: &amp;amp;SqliteConnection, title: &amp;amp;&amp;#39;a str, body: &amp;amp;&amp;#39;a str) -&amp;gt; usize {
    use schema::posts;

    let new_post = NewPost {
        title,
        body,
    };

    diesel::insert_into(posts::table)
        .values(&amp;amp;new_post)
        .execute(conn)
        .expect(&amp;quot;Error saving new post&amp;quot;)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;现在已经万事俱备，接下来新建&lt;code&gt;src/bin/write_post.rs&lt;/code&gt;，实现写入一条Post的逻辑。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;rust&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;extern crate diesel_demo;
extern crate diesel;

use self::diesel_demo::*;
use std::io::{stdin, Read};

fn main() {
    let connection = establish_connection();

    println!(&amp;quot;What would you like your title to be?&amp;quot;);
    let mut title = String::new();
    stdin().read_line(&amp;amp;mut title).unwrap();
    let title = &amp;amp;title[..(title.len() - 1)]; // Drop the newline character
    println!(&amp;quot;\nOk! Let&amp;#39;s write {} (Press {} when finished)\n&amp;quot;, title, EOF);
    let mut body = String::new();
    stdin().read_to_string(&amp;amp;mut body).unwrap();

    let post = create_post(&amp;amp;connection, title, &amp;amp;body);
    println!(&amp;quot;\nSaved draft {} with id {}&amp;quot;, title, post.id);
}

#[cfg(not(windows))]
const EOF: &amp;amp;&amp;#39;static str = &amp;quot;CTRL+D&amp;quot;;

#[cfg(windows)]
const EOF: &amp;amp;&amp;#39;static str = &amp;quot;CTRL+Z&amp;quot;;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;首先创建一个数据库的连接，在打印一句提示语之后，调用Rust内置的stdin，获取IO输入。最后使用两个条件编译，针对不同系统绑定结束的快捷键。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;让我们试着执行写入逻辑的脚本&lt;code&gt;cargo run --bin write_post&lt;/code&gt;。如果编译成功的话，你可以在控制台进行用户交互了。下图是一个演示效果的截图。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9e620b6c035a68990c96c044e3aaab98/ea64c/915a1ec542eba300.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 34.04255319148936%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA4klEQVQoz4VRWY6FMAzrbYBCF/at0Erc/0weOU95QvMx82HFSRPHSo21LfxoEbcG/eJwHAf2fUfOGfd9Y9s2rOsqOd+maUJKSXrICfKu62CthQkhIIwO4+FFMKVLhkspeJ5HRK/rU2Nv27bw3sM5JyIEOesiyKGSC+4rS+QwxeZ5Rt/3GIZBQM6Bpmm+YK415YaNMUbEGCSqCDdzq7ogp5O/wB5DJ3oL3oq53k3jeZ5SX5ZFcn0jtMYemjG8R13XAlr/Hauqkqg3+g+GR+fvcQN/i5EbWaMDvtMdm1WU8c3fgj+C1Nzx9iySyQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;915a1ec542eba300&quot;
        title=&quot;915a1ec542eba300&quot;
        src=&quot;/static/9e620b6c035a68990c96c044e3aaab98/1d69c/915a1ec542eba300.png&quot;
        srcset=&quot;/static/9e620b6c035a68990c96c044e3aaab98/4dcb9/915a1ec542eba300.png 188w,
/static/9e620b6c035a68990c96c044e3aaab98/5ff7e/915a1ec542eba300.png 375w,
/static/9e620b6c035a68990c96c044e3aaab98/1d69c/915a1ec542eba300.png 750w,
/static/9e620b6c035a68990c96c044e3aaab98/ea64c/915a1ec542eba300.png 1116w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;修改记录的数据&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BF%AE%E6%94%B9%E8%AE%B0%E5%BD%95%E7%9A%84%E6%95%B0%E6%8D%AE&quot; aria-label=&quot;修改记录的数据 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;修改记录的数据&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;现在我们已经成功写入了一条数据，但是执行&lt;code&gt;cargo run --bin show_posts&lt;/code&gt; 并不会返回我们预期的数据。因为上一步虽然写入了一条Post数据，但是数据的&lt;code&gt;published&lt;/code&gt;默认是&lt;code&gt;false&lt;/code&gt;。而show_posts中数据查询的逻辑是&lt;code&gt;.filter(published.eq(true))&lt;/code&gt; ，这样无法查找出想要的数据，我们需要提供修改数据的能力。新建&lt;code&gt;src/bin/publish_post.rs&lt;/code&gt;，对数据进行修改。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;rust&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;extern crate diesel_demo;
extern crate diesel;

use self::diesel::prelude::*;
use self::diesel_demo::*;
use self::models::Post;
use std::env::args;

fn main() {
    use diesel_demo::schema::posts::dsl::{posts, published};

    let id = args().nth(1).expect(&amp;quot;publish_post requires a post id&amp;quot;)
        .parse::&amp;lt;i32&amp;gt;().expect(&amp;quot;Invalid ID&amp;quot;);
    let connection = &amp;amp;mut establish_connection();

    let _ = diesel::update(posts.find(id))
        .set(published.eq(true))
        .execute(connection)
        .expect(&amp;amp;format!(&amp;quot;Unable to find post {}&amp;quot;, id));

    let post: models::Post = posts
        .find(id)
        .first(connection)
        .unwrap_or_else(|_| panic!(&amp;quot;Unable to find post {}&amp;quot;, id));
    println!(&amp;quot;Published post {}&amp;quot;, post.title);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;执行 &lt;code&gt;cargo run --bin publish_post 1&lt;/code&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9ef922596a303d90091b3b7b7e882a52/c6ff8/bc893815ef4b882f.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 11.702127659574469%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAaklEQVQI122MSQ7DIADE8pwCIiplCXsQ/P9NrkqvOVjyYTyHeAm0EZgseF+SWiq9d+acrLW2l1K2jzHw3pNSIsaItXYTQuA8T6SUHM45wuUI2eKuzx7f902t/+MfrTVyzhhj0Frv8AmlFF+TgkC+eZZe1gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;bc893815ef4b882f&quot;
        title=&quot;bc893815ef4b882f&quot;
        src=&quot;/static/9ef922596a303d90091b3b7b7e882a52/1d69c/bc893815ef4b882f.png&quot;
        srcset=&quot;/static/9ef922596a303d90091b3b7b7e882a52/4dcb9/bc893815ef4b882f.png 188w,
/static/9ef922596a303d90091b3b7b7e882a52/5ff7e/bc893815ef4b882f.png 375w,
/static/9ef922596a303d90091b3b7b7e882a52/1d69c/bc893815ef4b882f.png 750w,
/static/9ef922596a303d90091b3b7b7e882a52/c6ff8/bc893815ef4b882f.png 1088w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;数据修改成功！再次执行 show_post 命令查看返回的结果。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/50576260d63f0e58101a8173477119fd/ddc6c/02305536c18ed125.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 22.872340425531917%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAmElEQVQY05WPWwrEIBRDXY5Vq/ioTwqlFPe/owzXwRZmvvpxIMHcBJkJAsZLxLghxjjw3sM5h5wzUkoopQw9/cxs23NDhBDAbBVwTWLfd1zXhd47zvPEcRzDU7DWOiBNpdZarOsKrTWMMTfkWWsVMX2PaFEpdYeFEOCc/7Esy3gjSE/Is1lE0DdmcCKlfAUbK+JZ+Q28Lf0Ag1Cb/HCIMa0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;02305536c18ed125&quot;
        title=&quot;02305536c18ed125&quot;
        src=&quot;/static/50576260d63f0e58101a8173477119fd/1d69c/02305536c18ed125.png&quot;
        srcset=&quot;/static/50576260d63f0e58101a8173477119fd/4dcb9/02305536c18ed125.png 188w,
/static/50576260d63f0e58101a8173477119fd/5ff7e/02305536c18ed125.png 375w,
/static/50576260d63f0e58101a8173477119fd/1d69c/02305536c18ed125.png 750w,
/static/50576260d63f0e58101a8173477119fd/78797/02305536c18ed125.png 1125w,
/static/50576260d63f0e58101a8173477119fd/aa440/02305536c18ed125.png 1500w,
/static/50576260d63f0e58101a8173477119fd/ddc6c/02305536c18ed125.png 1534w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;删除-Post-数据&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%A0%E9%99%A4-Post-%E6%95%B0%E6%8D%AE&quot; aria-label=&quot;删除 Post 数据 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;删除 Post 数据&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;到目前为止，CRUD中的”CRU”都已经实现了，现在就差最后的“D”，也就是删除操作了。按照前面的思路，我们依样画葫芦，创建&lt;code&gt;src/bin/delete_post.rs&lt;/code&gt;，在这个文件中实现数据库数据的删除。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;rust&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;use diesel::prelude::*;
use diesel_demo_step_3_sqlite::*;
use std::env::args;

fn main() {
    use diesel_demo_step_3_sqlite::schema::posts::dsl::*;

    let target = args().nth(1).expect(&amp;quot;Expected a target to match against&amp;quot;);
    let pattern = format!(&amp;quot;%{}%&amp;quot;, target);

    let connection = &amp;amp;mut establish_connection();
    let num_deleted = diesel::delete(posts.filter(title.like(pattern)))
        .execute(connection)
        .expect(&amp;quot;Error deleting posts&amp;quot;);

    println!(&amp;quot;Deleted {} posts&amp;quot;, num_deleted);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;执行 &lt;code&gt;cargo run --bin delete_post Good&lt;/code&gt; 将会删除数据。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;Diesel 是一个相当不错的ORM库，社区活跃，文档详细。针对不同类型数据的接入都有详细的代码案例，极大降低了学习和使用的成本。未来将结合具体的案例展示更加详细和深入的使用教程。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[《架构师修炼之道》摘录09-召开架构设计研讨会]]></title><description><![CDATA[本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。 全书整体分为三个部分 第一部分介绍软件架构的基础知识和架构师必备的设计思维 第二部分讲解架构师需要掌握的核心技能和知识 第三部分讨论一系列…]]></description><link>https://zhanglun.github.io/blogs/《架构师修炼之道》摘录09-召开架构设计研讨会/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/《架构师修炼之道》摘录09-召开架构设计研讨会/</guid><pubDate>Thu, 20 Jan 2022 13:00:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;全书整体分为三个部分&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第一部分介绍软件架构的基础知识和架构师必备的设计思维&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第二部分讲解架构师需要掌握的核心技能和知识&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第三部分讨论一系列使用的架构设计方法&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;前两部分适合从头到尾通读，第三部分用于参考和检索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;本章学习筹划和主持架构设计研讨会。良好的主持不仅仅是举止得当，更要让讨论顺利开展。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;十九世纪的法国建筑学教授会推着手推车收集学生的练习项目。就算学生觉得做得还不够好，教授也会将它收走。学生就跟着手推车，继续修改设计，这里补一点零件，那里加一根线。教授就这样带着他们去收下一个学生的项目。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;十九世纪的法国建筑学教授已经明白：花更多时间并不一定能够产生更好的设计。这一理念放在今天仍然适用。用户体验社区将这一理念用到设计研讨会里，并加以推广。这种设计研讨会有严格的时间限制，旨在帮助团队在最短的时间内探索各种想法。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;91-筹划架构设计研讨会&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#91-%E7%AD%B9%E5%88%92%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E7%A0%94%E8%AE%A8%E4%BC%9A&quot; aria-label=&quot;91 筹划架构设计研讨会 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.1 筹划架构设计研讨会&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;架构设计研讨会应该充分运用集体的智慧和经验。为了让大家在短时间内尽可能多地提出想法，你必须对设计研讨会的探索活动设置严格的时间限制，同时指导团队“先发散后聚合”——首先发散探索，然后快速聚合想法。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了提高会议质量，让与会人积极参与并认可设计决策，应该做到设计探索的三个F——快速（fast）、有效（effective）、有趣（fun）。有趣才能提高参与度，而参与度又进一步提高会议的速度和有效性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;会议主持人要负责筹划研讨会，设法激发有价值的、可实现的想法。常见的想法分为三种：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;可实现的想法&lt;/strong&gt;。这是一类很靠谱的想法。接下来应该为它创建模型或原型，进一步充实和丰富设计。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;有待评估的想法&lt;/strong&gt;。有些想法看起来不错，但包含许多假设，或是缺少重要信息。接下来需要做实验和研究进一步评估这类想法。进一步评估后，这类想法有些会被淘汰，有些则会成为候选方案。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;引发新问题的看法&lt;/strong&gt;。有些想法提出了对正在解决的问题的新疑问。这些也是设计研讨会的成果。这些问题提前暴露出来，总比开发几周之后才发现好。我们应该带着这些问题去请教利益相关方，从而加深我们对问题的理解。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;一次设计研讨会可能持续几个小时，也可能需要一整天。在某些情况下，还可以连接几天每天都召开设计研讨会。无论时间长短，设计研讨会的基本流程是相同的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;准备：提前了解要探索的问题。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;启动：向团队介绍研讨会的目标和问题背景。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;创建：制作模型、绘制草图、构建原型，通常有时间限制。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;分享：展示创建的内容，并具体描述设计如何实现目标。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;评判：团队对分享的内容进行评判，就设计能否完成目标发表意见。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;迭代：重复开展第3步到第5步，优化模型，创建新模型。通常每组目标至少要迭代三次。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;跟进：针对发现的想法、风险、问题决定后续处理步骤。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;911-准备阶段&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#911-%E5%87%86%E5%A4%87%E9%98%B6%E6%AE%B5&quot; aria-label=&quot;911 准备阶段 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.1.1 准备阶段&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;正式启动设计研讨会前要确定研讨目标，以及参会人员 。除非你理解要探索的问题，否则不要轻易召集一群人来讨论架构，那只会浪费大家的时间。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;不要低估准备会议的时间，这通常要花不少工夫。你要与利益相关方沟通、做基本调研、设法确定业务目标、提炼质量属性和关键架构需求 （ASR）。召开研讨会前，你应该充分了解问题及其背景，以便有效阐述研讨目标。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;定好一两个研讨目标，清楚地描述参会者在研讨会期间要探索的内容(免得开会时有人在讨论数据库的设计，而有人在讨论死锁问题)。如果开会前你对问题的理解还没有把握，那也没关系，毕竟探索解决方案可以加深对问题的理解。清晰阐述研讨目标有助于提高大家的参与度。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;准备研讨会可能要几天甚至几周时间。开会前，你至少应该了解了大致的业务目标和关键架构需求。清楚项目背景和研讨目标之后，你就可以启动研讨会了。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;912-启动研讨会&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#912-%E5%90%AF%E5%8A%A8%E7%A0%94%E8%AE%A8%E4%BC%9A&quot; aria-label=&quot;912 启动研讨会 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.1.2 启动研讨会&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;启动阶段将为后续研讨和协作打下基础。你应该向大家分享目前你对问题和架构的认识，确保每个人都正确了解问题背景，然后回顾研讨会要探索的内容。具体花多少时间分享背景信息要根据大家所了解的情况来定。如果有不少人是第一次接触业务目标和关键架构需求，那就应该多花一些时间做介绍。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;介绍完背景后，再简要阐述研讨目标。明确的目标有助于大家在整个研讨会期间集中注意力。会议期问，每个人都要针对目标提出备选设计方案。大家还将根据目标评判这些设计方案。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;913-创建分享评判CSC迭代&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#913-%E5%88%9B%E5%BB%BA%E5%88%86%E4%BA%AB%E8%AF%84%E5%88%A4CSC%E8%BF%AD%E4%BB%A3&quot; aria-label=&quot;913 创建分享评判CSC迭代 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.1.3 创建、分享、评判——CSC迭代&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;研讨会的大部分时间都是开展CSC迭代-创建（create）、分享（share）、评判（critique）。每一次迭代都将拓展和加深我们对备选解决方案的理解。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;创建&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA&quot; aria-label=&quot;创建 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;参与者针对研讨目标，独立或以小组的形式提出设计想法（画图或者建模）。用纸和笔把想法画出来是比较合适的做法，不必追求精确。在这个阶段，我们更重视想法，而不求形式上的完美。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这一步应该限制时间，通常是5到7分钟，时间宽裕的话可以相应延长。别忘了，花更多时间并不一定能够产生更好的设计！不过探索架构需要思考，对大多数软件架构问题来说，少于五分钟是肯定不够的，请根据研讨目标调整时间。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;分享&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%86%E4%BA%AB&quot; aria-label=&quot;分享 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;分享&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;创建完成后进行分享。这一步也叫游说（pitch）。每个小组有三分钟分享创建的内容，解释自己的设计如何满足目标。分享应该做到简明扼要，不需要全面展开。大家很快就会发现：创建无法分享的内容是浪费时间的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;分享时，其他人只能听，不允许提问。进入评判阶段后，每个人都有机会提问和给出意见。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;评判&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%AF%84%E5%88%A4&quot; aria-label=&quot;评判 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;评判&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;一个小组分享完后，其他人开始评判。评判应该围绕设计与目标的关系展开。为什么设计达不到目标？为什么设计不满足需求？这样做的目的是为建设性的对话奠定基础。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;评判过程中，每个人都要就事论事，实事求是。下表列举出了评判过程中可以做什么，不可以做什么。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;可以&lt;/th&gt;
&lt;th&gt;不可以&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;注意听分享者要达成的目标。&lt;/td&gt;
&lt;td&gt;对于自己的设计，采取防御姿态。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;就事论事，实事求是。&lt;/td&gt;
&lt;td&gt;代入个人喜好：“我喜欢这个，这是我的最爱”。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;要求澄清问题。&lt;/td&gt;
&lt;td&gt;偏离研讨主题。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;提出设计引入的风险和新问题。&lt;/td&gt;
&lt;td&gt;故意刁难。（别忘了你自己也要发言）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;提出设计的优点。&lt;/td&gt;
&lt;td&gt;只盯着缺点。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;评判应该指出好的方面以及可以改进的地方。糟糕的设计也会有闪光点，好设计也有改进的空间。每个设计都应该得到正面的反馈和建设性的批评。所有小组都分享完后，开始新一轮的迭代。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;哈哈，看到这一段内容的时候。我想起了自己曾今感受过的“研讨会”。在会议上，有的人只关注自己的想法，对他人的设计故意刁难挑刺，美其名曰“帮助完善方案”。在他人分享是，抓住方案的不足和细节不停的追问和质疑，让分享者非常难堪；而轮到自己时，面对疑问总是盛气凌人，同时对自己的方案大吹特吹，但最后方案落地时确实一地鸡毛。以至于我不再愿意参与类似的会议，因为现场和后续的过程实在是让人不舒服。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;914-迭代&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#914-%E8%BF%AD%E4%BB%A3&quot; aria-label=&quot;914 迭代 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.1.4 迭代&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;CSC 迭代可以促进思维的快速发散与聚合。创建阶段构思和绘制设计；分享阶段展示设计方案。评判阶段指出盲点，督促大家改进，或者尝试其他方案。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;迭代能够让大家逐渐达成共识，在此基础上开展下一步的工作。在不影响研讨质量的前提下，迭代速度越快越好。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;每次迭代后可以调整小组结构，这将有利于提高探索效果和参与度。如果有些人是单独一组，可以让他们结对或组成小组。如果大家已经组成小组，可以将这些小组重新混编。做好准备，通常每组研讨目标至少要开展三次CSC迭代。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;915-会议总结确定后续行动&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#915-%E4%BC%9A%E8%AE%AE%E6%80%BB%E7%BB%93%E7%A1%AE%E5%AE%9A%E5%90%8E%E7%BB%AD%E8%A1%8C%E5%8A%A8&quot; aria-label=&quot;915 会议总结确定后续行动 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.1.5 会议总结，确定后续行动&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;研讨会结束前一定要留出时间让大家回顾主要议题，讨论重要的收获。此外，还要确定下一步的行动要点。哪些想法靠谱，值得进一步考虑？是否发现重大风险，需要立即解决？是否需要马上做实验？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;研讨会的所有成果都应当拍照留存。趁着大家记忆犹新，赶紧做好记录。尤其重要的是记录下一步的行动要点及行动负责人，以确保按计划开展后续工作。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;92-挑选设计方法&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#92-%E6%8C%91%E9%80%89%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95&quot; aria-label=&quot;92 挑选设计方法 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.2 挑选设计方法&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;研讨会的主持人有责任挑选一些设计方法，引导大家快速、有效、有趣地开展CSC 迭代。已知的设计方法，但并非所有设计方法都适用于架构设计。应该考虑系统的特点，挑选那些能提高架构设计效率的方法。下表是研讨会议程的示例。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;议程&lt;/th&gt;
&lt;th&gt;时间&lt;/th&gt;
&lt;th&gt;目的&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;介绍背景，阐述目标&lt;/td&gt;
&lt;td&gt;15分钟&lt;/td&gt;
&lt;td&gt;让大家积极参加研讨会，做出贡献。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;轮转设计&lt;/td&gt;
&lt;td&gt;30分钟&lt;/td&gt;
&lt;td&gt;加快发散与聚合，让大家的头脑高速转动起来。轮转设计一般只做一轮，如果时间充裕可以多做几轮。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;集体海报&lt;/td&gt;
&lt;td&gt;30分钟&lt;/td&gt;
&lt;td&gt;将设计结果画到海报上，便于分享。达成共识。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;分享与评判&lt;/td&gt;
&lt;td&gt;15分钟&lt;/td&gt;
&lt;td&gt;每个小组有三分钟分享时间。采用记点投票的方法进行评判。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;回顾与总结&lt;/td&gt;
&lt;td&gt;10分钟&lt;/td&gt;
&lt;td&gt;回顾研讨会进展情况，确定后续行动步骤。约占据10%的研讨会时间。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;93-挑选参与者&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#93-%E6%8C%91%E9%80%89%E5%8F%82%E4%B8%8E%E8%80%85&quot; aria-label=&quot;93 挑选参与者 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.3 挑选参与者&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;参与者决定了研讨会的质量。与会者太多会增加会议成本：不合适的参与者会妨碍建设性的讨论，影响研讨的深度和质量。主持人需要在会议规模和人员多样性之间做出取舍。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/37c80520f2739045f818882956aa9242/ae07a/da42ecc091e6e811.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 44.680851063829785%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABYElEQVQoz4WS6W6kQAyE5/0fbxUlcy8DBGig72MgKPoiekl2Iu3xw221264q272L8Y0QZlbvw4y193yXvabvJGowxDATtrzP3L/ZLmzJ0d9RvaYqO3TTUx1/cno6UhyuOBN5JP4n4HqkMOMakf08vRNsoq0E9a3ldq3omuEL8L8KY1pQYsQPCuMSbSex2lLfSoprQX2rUKPewH6DPoI/kux8mLicT6ixx9uAlhYnJcf9mZfnE4f9mea1I8Y/K3sEXW0X48J0n0luIIQF5ya8n9FSM/YDwUe8i2gTc9z5KRc6l/B+IqXlm+K8FB/WpXisMdSvHXKUeBdQyuPXZSnHy+FKWbZUVYcQiqZuabsRrUMGXe1rKZ/fYm0rpTdSnDHGMfQSrQyDEFwuBb0Ysq3xqqj48bTPBMZGjAlby9uw47eh/5rPynpPC9ZGxtHkolWxd4lejNzKlqYdaNqRTsj89gF4kK9mllHzBgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;da42ecc091e6e811&quot;
        title=&quot;da42ecc091e6e811&quot;
        src=&quot;/static/37c80520f2739045f818882956aa9242/1d69c/da42ecc091e6e811.png&quot;
        srcset=&quot;/static/37c80520f2739045f818882956aa9242/4dcb9/da42ecc091e6e811.png 188w,
/static/37c80520f2739045f818882956aa9242/5ff7e/da42ecc091e6e811.png 375w,
/static/37c80520f2739045f818882956aa9242/1d69c/da42ecc091e6e811.png 750w,
/static/37c80520f2739045f818882956aa9242/78797/da42ecc091e6e811.png 1125w,
/static/37c80520f2739045f818882956aa9242/aa440/da42ecc091e6e811.png 1500w,
/static/37c80520f2739045f818882956aa9242/ae07a/da42ecc091e6e811.png 3134w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;94-会议管理&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#94-%E4%BC%9A%E8%AE%AE%E7%AE%A1%E7%90%86&quot; aria-label=&quot;94 会议管理 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.4 会议管理&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;筹划和主特会议不仅仅是制订议程和把控时间， 还需要投入更多的精力。你介绍设计活动的效果将直接决定参与者的研讨效率。你的互动方式也将影响大家的积极性。主持人有责任确保研讨会达到预期的效果。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;941-为研讨会留足时间&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#941-%E4%B8%BA%E7%A0%94%E8%AE%A8%E4%BC%9A%E7%95%99%E8%B6%B3%E6%97%B6%E9%97%B4&quot; aria-label=&quot;941 为研讨会留足时间 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.4.1 为研讨会留足时间&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;时间不够会造成设计活动过于仓促，降低参与者的信心，影响研讨会效果。如果希望会议出成果，务必留出充足的时间。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果只有一两个小的研讨目标，那么确实有可能在一两个小时内快速完成探索。简短的研讨会只适合探索比较具体的目标，比如让团队对大体方案达成共识，为进一步完善细节打下基础。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;大多数研讨目标至少需要一两天才能完成。如果大家不能很好地理解问题，那就需要在几周内举行多次小型会议。请记住，并非所有问题都适合在研讨会上探索。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;942-设立期望&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#942-%E8%AE%BE%E7%AB%8B%E6%9C%9F%E6%9C%9B&quot; aria-label=&quot;942 设立期望 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.4.2 设立期望&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;研讨会既要带有一点神秘性，也要让参与者了解他们要做的事情及意义。会前介绍研讨目标有助于大家快速进入状态。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;会议开始前，应该宣布会议议程。当然，没必要讲得太细致。有些细节还应该保密，以免参与者产生困惑或做出先入为主的设计。如果会议时间长达几小时，至少应该宣布每个议程的开始结束时间，以便参与者可以选择是否参加某项活动。这样，大家在参加研讨会的同时，还能时不时处理一下手头的工作，不至于影响研讨会正常召开。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;此外，还应该宣布参会的基本规则。下面列举了一些常见的会议规则。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;人人参与&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;时间一到，马上进入下一个环节&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;回答不分对错&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;遇到不明白的地方，请提问&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;注意时间&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;943-解说-展示-再解说&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#943-%E8%A7%A3%E8%AF%B4-%E5%B1%95%E7%A4%BA-%E5%86%8D%E8%A7%A3%E8%AF%B4&quot; aria-label=&quot;943 解说 展示 再解说 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.4.3 解说-展示-再解说&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;介绍新设计方法时，一定要说明大家要做什么，展示一个例子，然后再回顾之前的说明。大多数人接受新事物时都会遗漏重要的细节。展示例子后再回顾之前的说明，让参与者有第二次机会就不明白的地方提问。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;最好能使用以往研讨会的例子。如果没有现成的例子，可以展示类似活动的照片。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;944-分享诀窍&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#944-%E5%88%86%E4%BA%AB%E8%AF%80%E7%AA%8D&quot; aria-label=&quot;944 分享诀窍 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.4.4 分享诀窍&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;许多人也许是第一次参加这种协作研讨会。你宣布开始后，肯定还是有人会发懵。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了帮助新手入门，主持人可以分享参加每项活动的诀窍。简单的提醒和建议可以起到很好的作用。留意那些神情木讷的人，他们可能需要帮助才能进入角色。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;945-设置截止时间&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#945-%E8%AE%BE%E7%BD%AE%E6%88%AA%E6%AD%A2%E6%97%B6%E9%97%B4&quot; aria-label=&quot;945 设置截止时间 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.4.5 设置截止时间&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;研讨会的所有活动都有时间限制。合适的时间限制能让活动开展得更快。参与者应该会感到有些紧张，但差不多总能恰好完成设计活动。理想情况下，每个活动都想“压哨球”，当你宣布“时间到”的那一刹那，小组正好完成草图！&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;946-适时指点参与者&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#946-%E9%80%82%E6%97%B6%E6%8C%87%E7%82%B9%E5%8F%82%E4%B8%8E%E8%80%85&quot; aria-label=&quot;946 适时指点参与者 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.4.6 适时指点参与者&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;除非你之前与研讨会的所有参与者都合作过，否则一定要在研讨会期间留出些时间指点某些成员，教他们一些关键的软件架构知识和设计概念。适时指点的目标是确保参与者等握足够的知识，以便顺利融入设计活动。你需要做的只是快速回顾重要的架构概念，或者简单地介绍质量属性场景。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;大家的参与度对于会议至关重要，否则就不需要开研讨会了。一定要确保参与者掌握必要的知识和信息。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;947-使用停车场&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#947-%E4%BD%BF%E7%94%A8%E5%81%9C%E8%BD%A6%E5%9C%BA&quot; aria-label=&quot;947 使用停车场 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.4.7 使用。停车场”&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;架构设计的道路蜿蜒曲折。研讨会上可能会出现一些有趣的想法，这些想法可能与当前的研讨目标无关，没时间深入探索。你可以把这些想法列成清单，我们称之为“停车场”（“parking lot”)，方便会后查看。把有趣的想法放到“停车场”里，这样不会影响研讨会的正常进行，以后有时间可以随时再做进一步讨论。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;95-与远程团队协作&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#95-%E4%B8%8E%E8%BF%9C%E7%A8%8B%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C&quot; aria-label=&quot;95 与远程团队协作 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;9.5 与远程团队协作&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;参与设计研讨会的人也许很难凑在一起。没关系，研讨会可以用远程会议的形式召开。下面是一些开展远程研讨会的技巧。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;**使用远程协作工具。**这是基本条件。选好远程协作工具，外地小组才能参加研讨。研讨会可能需要一些工具才能开展，比如屏幕共享、协作文档编辑、协作、绘图、群聊、语音通话等。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;**增加议程时间。**远程研讨会需要更多时间完成协作和设计活动。会议中往往还会出现技术问题。你需要提前做好准备，才不会手足无措。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;**备用沟通渠道。**电话里一次只有一个人可以说话。在这种情况下，小组协作会非常困难。应该用群聊软件作为备用沟通手段。如果需要小组协作，给每个小组设好电话会议号码，并且约定截止时间，以便他们能及时回到大组讨论中来。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;**准备共享资料。**参加远程会议的人很难集中注意力。主持人没法在白板上做分享，因为只有房间里的人能看到。你应该提前准备好演示材料，这样外地参与者可以在自己电脑上打开观看。讨论时，大家可以共享一个文档，所有人在共享文档上编辑、修改内容，这样每个人都能参与进来。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;**创造面对面的机会。**没有什么方式比面对面互动更有效。如果可能，最好用视频会议软件，让参与者至少可以时不时看到彼此。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;**离线运转。**研讨会不是探索想法的唯一方式。你可以在持续几天的时间内，以一种更慢的节奏开展很多设计活动。比如，像轮转设计这样的活动就可以通过电子邮件完成，效果也很好。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;作者举一个远程研讨会的例子。主持人 Marie 来得很早，她打开屏幕共享软件，并拔通了电话会议号码。所有参与者都拨通后，Marie 启动了会议，她展示幻灯片，介绍研讨会的议程和目标。Marie 以往会把这些东西写在白板上，这次她用幻灯片也达到了同样的效果。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;大家开始进行轮转设计。Marie引导参与者绘制架构视图，然后用手机拍照进行分享。所有参与者都可以通过 Slack（团队协作工具）分享草图。进入第二轮，每个人使用绘图软件对分配给他的草图进行批注，然后截屏，将原始图片和带批注的图片都共享到 &lt;a href=&quot;http://box.com/&quot; class=&quot;link-underline&quot;&gt;Box.com&lt;/a&gt; （文件共享平台）上。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;针对草图开展一番简短的讨论后，Marie 将参与者分成若千小组。小组用 Google Hangouts(聊天软件）进行沟通，&lt;a href=&quot;http://xn--box-bs1h.com/&quot; class=&quot;link-underline&quot;&gt;用Box.com&lt;/a&gt; 创建文档，展示小组的设计想法。时间截止后，所有人重新进入电话会议，演示各小组的成果。在评判阶段，Marie 和大家在共享文档中一起做记录。这次会议持续了两个多小时，最后按时结束，这与Marie 的预期一致。如果是本地会议，大约只需要 90 分钟。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;在当下新冠时期，远程协作已经深入人心。文中介绍的这些技巧已经变成一种常识。在日常工作中远程协作也已经常态化。文中补充的远程研讨会的例子，也正是当下大部分异地合作的真实写照了，区别也仅仅是使用的工具而已。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;本章的内容是从一个主架构师的角度来主导架构研讨会。提到了在会议前期如何准备会议，包括会议主题、会议资料和参会人员等等，以及在会议举行过程中如何把控会议节奏，活跃会议氛围。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;设计研讨会非常适合用来快速探索创意和想法。比起决策本身，研讨的过程也许更重要。所有人都参与到这个过程中，形成共同的责任感。这种责任感将在今后的工作中发挥重要的作用。
设计研讨会也有局限性。架构设计不能全靠团队协作和贴便利贴。设计研讨会本身不足以产生出色的架构设计，而且研讨会的效果很大程度上取决于筹划和组织的水平。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[《架构师修炼之道》摘录08-建立模型，化繁为简]]></title><description><![CDATA[再成功的软件系统也难免走向复杂。用户数量的增加将给系统的可能性、可伸缩性、性能表现施加前所未有地压力。新功能不断加入，补丁越来越多，让软件越来越笨重。拓展系统地任务可能压得开发团队喘不过气。如果不保持警惕，软件系统最终会成为其自身成功的受害者。 当然，复杂性刚刚露出狰狞面目时，…]]></description><link>https://zhanglun.github.io/blogs/《架构师修炼之道》摘录08-建立模型，化繁为简/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/《架构师修炼之道》摘录08-建立模型，化繁为简/</guid><pubDate>Wed, 19 Jan 2022 14:52:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;再成功的软件系统也难免走向复杂。用户数量的增加将给系统的可能性、可伸缩性、性能表现施加前所未有地压力。新功能不断加入，补丁越来越多，让软件越来越笨重。拓展系统地任务可能压得开发团队喘不过气。如果不保持警惕，软件系统最终会成为其自身成功的受害者。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当然，复杂性刚刚露出狰狞面目时，我们还是有办法控制的，比如通过需求变更和代码裁剪精简系统，将大件拆分成容易分析和管理的小件，还可以从细节中抽身出来，从更抽象的层面重新思考软件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们曾说过，架构是由结构组成的，而结构又是由元素和关系组成地。本章将学习使用这些基本构件创建有意义的模型，帮助我们分析、构思、推演我们的设计。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;81-推演架构&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#81-%E6%8E%A8%E6%BC%94%E6%9E%B6%E6%9E%84&quot; aria-label=&quot;81 推演架构 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;8.1 推演架构&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;无论何时，人的大脑都只能保留有限的信息。多年来，软件开发人员已经掌握了一些技巧突破大脑的局限性。有一个技巧是与他人合作，用大规模并行工作解决问题。还有一个技巧是建立抽象概念来压缩表示大量信息。协作和抽象是我们思考、分析、理解架构的基本方法。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;抽象让我们关注特定的细节。例如，在面向对象程序设计里，类的接口描述了公共方法，但不涉及如何实现这些方法，这些细节可以等具体实现接口时再处理。暂时忽略令人分心的细节，我们才能专心思考接口与外界的交互。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当然，如果不能分享，再完美的抽象也会失去意义。分享的办法就时建立抽象的架构模型。建立架构模型并不仅仅时画线条和方框那么简单，它需要严肃认真的思考。架构模型与草图不同，模型是对架构的精确描述，能让他人更容易理解和推演架构。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;优秀的架构模型有诸多优点：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;构建设计词汇&lt;/strong&gt;。字词传神，至关重要。怡当的元素名称可以更好地表达意义和目的。我们建立的每个模型都拓展了软件系统的词汇。这些词汇将在日常讨论中使用，它们会融入我们编写的代码，影响我们看世界的方式。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;引导我们关注重要的细节&lt;/strong&gt;。在软件开发中，细节决定一切。虽然细节都很重要，但是我们并不希望(也没有能力〉同时考虑所有细节。模型隐藏了部分细节，让我们可以在特定的时刻专心思考特定问题。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;帮助推演质量属性和其他系统特性&lt;/strong&gt;。模型可以帮助大家思考和描述系统行为。良好的架构模型还可以用来在动手开发之前检验系统设计。当然，为了建立精确的模型，我们还需要做实验和创建原型，但磨刀不误砍柴工，这样做总比开发完系统才发现有问题划算。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;展示架构师的构思&lt;/strong&gt;。所有开发人员都应该理解为什么选择当前的设计。良好的模型能展示结构背后的构思。理解架构师构思的人越多，就越有可能在系统开发过程中维持设计的完整性和一致性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;模型来自我们对世界的认知以及我们为表达设计意图所做的努力。所有模型都有概念和规则，规则描述了概念的使用方式。正确运用这些规则，才能让模型与我们的认知保持一致。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;如果我不建立模型直接写代码会怎么样&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E6%9E%9C%E6%88%91%E4%B8%8D%E5%BB%BA%E7%AB%8B%E6%A8%A1%E5%9E%8B%E7%9B%B4%E6%8E%A5%E5%86%99%E4%BB%A3%E7%A0%81%E4%BC%9A%E6%80%8E%E4%B9%88%E6%A0%B7&quot; aria-label=&quot;如果我不建立模型直接写代码会怎么样 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如果我不建立模型，直接写代码会怎么样？&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;多花一个小时设计架构，可以节省一个月的编程时间。我们知道，在设计阶段修改架构缺陷要比开发、测试、验收、发布后再修改容易得多。在白板上发现、修复问题比在数千行代码里做快得多。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当然，写代码也是了解系统及设计的绝佳方式，应该尽早开始写代码。除此之外，在探索架构时还要做实验和创建原型。借助模型思考不能代替动手实践，不能只用图表和框图来分析预测系统的行为。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你做架构设计也好，不做架构设计（让它在编写代码的过程中浮现)也好，最终总会得到一个架构。在你决定跳过架构建模，直接编写代码之前，一定考虑清楚：你打算何时设计，以及你能承受多少返工量。记住：&lt;strong&gt;多花一个小时设计架构，可以节省一个月的编程时间&lt;/strong&gt;。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;82-设计元模型&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#82-%E8%AE%BE%E8%AE%A1%E5%85%83%E6%A8%A1%E5%9E%8B&quot; aria-label=&quot;82 设计元模型 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;8.2 设计元模型&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;架构的元模型定义了模型中使用的概念和使用规则。元模型好比是设计的语法，它规范思考方式，并且设定了讨论架构的词汇。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0a3d21e9b6c70605711131e975fdb87d/df438/a0e2aa6e7c78ee18.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.23404255319149%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABEElEQVQoz4VQ2WrDMBD0/39em8NJKDRp6hgsR5J1rQ57yioYkj60C8Os0OzMSs08z1jR9z2stUgp1T7njOf7ZVn+ZEbDh7WEGBFCqILb7VYFXM8D/6FxzkFKiWEY8HW5YA0YhYAQAl3XQSn1Ysp91f1iRsMb8cB4l9juWhgXEFPB5/kKPVl47xFjRCmlmq0cUwbFV+RS0KzPdTRDTgRpHhikhbYJ89OXrOUpQZoIGwqUIUw+Q7sEZQkNp6WUMagAKsD52uNtewBlYJwI312Htm2x2Wyw3+9xOh5xOH3gPhF8XPC+O0JIAxNmjDo8DBmcxKZCE8Yp1gFOJSJorSuMMdBawfkAZVPVMPNL7ryxT/gBnMcewtYTNM8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;a0e2aa6e7c78ee18&quot;
        title=&quot;a0e2aa6e7c78ee18&quot;
        src=&quot;/static/0a3d21e9b6c70605711131e975fdb87d/1d69c/a0e2aa6e7c78ee18.png&quot;
        srcset=&quot;/static/0a3d21e9b6c70605711131e975fdb87d/4dcb9/a0e2aa6e7c78ee18.png 188w,
/static/0a3d21e9b6c70605711131e975fdb87d/5ff7e/a0e2aa6e7c78ee18.png 375w,
/static/0a3d21e9b6c70605711131e975fdb87d/1d69c/a0e2aa6e7c78ee18.png 750w,
/static/0a3d21e9b6c70605711131e975fdb87d/78797/a0e2aa6e7c78ee18.png 1125w,
/static/0a3d21e9b6c70605711131e975fdb87d/aa440/a0e2aa6e7c78ee18.png 1500w,
/static/0a3d21e9b6c70605711131e975fdb87d/df438/a0e2aa6e7c78ee18.png 1556w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;定义元模型可以更容易地向大家描述架构、设定期望，并推演我们创建的模型。创建元模型，首先要定义概念，也就是架构中的元素和关系。定义概念后，再建立这些概念的使用规则。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;821-分离新概念&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#821-%E5%88%86%E7%A6%BB%E6%96%B0%E6%A6%82%E5%BF%B5&quot; aria-label=&quot;821 分离新概念 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;8.2.1 分离新概念&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;概念分离(concept individuation）是我们学习新概念的认知过程。每当从架构中分离出新概念，我们就加深了对模型及其反映的世界的理解。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们从小就能自然而然地分离概念。当你蹒跚学步时，你第一次见到门。观察大人开门后，你猜测转动把手可以把门打开。这时你就将门与墙的概念分离开了。有一天你试着转动把手开门，结果门却纹丝不动。于是你又将上锁的门与没上锁的门的概念分离开了。你的思维模型就是这样逐步建立起来的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;分离概念的过程称为好奇心循环（见下图），它适合用于建立任何模型，无论是现实世界的模型，还是软件的系统架构。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c600198758aa876f4a5a2a2139baf9fe/8454b/45d47b64d9d3c0b7.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.808510638297875%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHklEQVQoz6WR2WqDYBBGff/nyo2QyyjBLESNS9yi0UAWzVfOFGkuWmipMP7bzDdnZhxJul6vyrJMZVmqaRrlea7b7caTXq/Xn8wh6Hw+a7vdKkkSE97v95bkXfC34s40TfrpezweGsfRjP174HfJ0DJCyCAMw9AIj8ejTqeTPM9THMf27rqulsul0jS1luAfRZH543O/379KJvg/32q10vP5tL1T17XW67V831cQBOK82WyMCgKoWTlDzgohw+u6zt4hRJRZOH3fW2kM4nA42GVVVSqKwowECC0WC+12OzsjxtCGYbAWAIJg27afJeM4I9NYejEPgt6QlLZAdLlcbJ0NX8TwsZL5kZFMBM1klIVxPxulUeJstAJ6/AFiyh+gYK7OMgIykwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;45d47b64d9d3c0b7&quot;
        title=&quot;45d47b64d9d3c0b7&quot;
        src=&quot;/static/c600198758aa876f4a5a2a2139baf9fe/1d69c/45d47b64d9d3c0b7.png&quot;
        srcset=&quot;/static/c600198758aa876f4a5a2a2139baf9fe/4dcb9/45d47b64d9d3c0b7.png 188w,
/static/c600198758aa876f4a5a2a2139baf9fe/5ff7e/45d47b64d9d3c0b7.png 375w,
/static/c600198758aa876f4a5a2a2139baf9fe/1d69c/45d47b64d9d3c0b7.png 750w,
/static/c600198758aa876f4a5a2a2139baf9fe/78797/45d47b64d9d3c0b7.png 1125w,
/static/c600198758aa876f4a5a2a2139baf9fe/aa440/45d47b64d9d3c0b7.png 1500w,
/static/c600198758aa876f4a5a2a2139baf9fe/8454b/45d47b64d9d3c0b7.png 1798w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这个循环总是从提问开始。提问是检验的手段。检验的结构要么是在模型中找到答案，腰门是发现认知还存在偏差。如果找到了答案，就强化了现有的模型。如果有偏差，就要修正模型（分离概念）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;假设利益相关方很看重可用性，而我们需要控制成本，在这种情况下，我们可能户itiwen：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;提问：哪些组件不可用造成的损失最大？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;检验：当前的模型无法回答这个问题。我们知道有哪些组件，但不清楚组件不可用造成的损失。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;分离新概念：引入损失的概念。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;建立新模型：在元模型中用颜色表示损失：白色代表没有损失，黑色代表损失严重。颜色越深，损失越大。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;检验：解决了！现在清楚了，Foo组件不可用造成的损失最大。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;修改元模型，增加损失的概念后，我们创建了一个新模型，从而可以推演成本与其他质量属性之间的关系。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;从提问到解决会花一些时间，而且这里也有风险，比如我们的知识和经验不足以分离新概念，也就无法正确地设计系统。为了降低这种风险，我们可以选用现成的元模型（如架构模式）。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;822-选择架构模式作为基础&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#822-%E9%80%89%E6%8B%A9%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F%E4%BD%9C%E4%B8%BA%E5%9F%BA%E7%A1%80&quot; aria-label=&quot;822 选择架构模式作为基础 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;8.2.2 选择架构模式作为基础&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;所有的设计都是在已有设计基础上的重新设计和调整创新。使用现成的架构模式是对这条原则的最佳应用。架构模式包含了针对特定问题的元模型。选择了合适的架构模式，你就有了现成的元模式。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;大多数系统设计都至少运用了一种架构模式，有些还用了两种。即使有了这些架构模式，仍然有许多细节要补充和完善。而当我们向元模型添加新概念时，我们有可能会破坏已有的架构模式。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;823-保持一致性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#823-%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%E6%80%A7&quot; aria-label=&quot;823 保持一致性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;8.2.3 保持一致性&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;同时使用多个元模型 （例如将多个架构模式合并）可能会出现不一致的情况。例如，两个元模型都定义了 worker 元素，但这两个 worker 的职责和使用规则完全不同。这种不一致性会破坏系统架构。为了保持一致性，应该对相似的概念进行合并，对同名不同义的概念进行更名，对使用规则做出相应调整。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;向元模型添加新概念时务必附上使用规则。规则描述了元素和关系在系统中的交互方式。它们必须反映实际情况。例如，许多编程语言都有严格的类型系统。如果使用强类型语言实现管道过滤器系统 ，那么元模型应包含相关类型的规则。如果选择的语言不强调类型，那么就需要定义消息描述和协议
头。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;规则还描述了我们在架构上引入的概念约束 (conceptual constraint）。概念约束能够提升某种质量属性。例如，在分层模式 （见第 72 节）中，层中元素只允许调用同一层或下一层的元素。这条规则可以提升可维护性。违反这条规则，系统将变成一锅粥。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;建立规则的方式与建立其他概念的方式相同。先提问，然后检验模型，再通过修改或添加规则更新模型。如此循环，直到模型能解决问题。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;824-取好名称&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#824-%E5%8F%96%E5%A5%BD%E5%90%8D%E7%A7%B0&quot; aria-label=&quot;824 取好名称 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;8.2.4 取好名称&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;给元素命名很重要，但绝非易事。命名也是一种设计，值得严肃对待。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Arlo Belshee 曾在一篇文章中将命名过程分成七个阶段。他认为命名反映了我们对设计的理解程度。随着理解的加深，命名也将逐步完善。Belshee 提出的七个阶段如下：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;阶段1：空白&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;没有名称。我们对系统及其背景情况还不了解，无法为元素提炼名称。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;阶段2：凑合&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;名称不能准确反映元素的含义。我们只是刚刚有了一些大致的想法。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;阶段3：沾边&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;名称至少反映了元素某一方面的功能&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;阶段 4：反映功能&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;名称直接描述了元素的所有功能。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;阶段5：反映角色&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;名称充分地反映了元素在架构中的角色。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;阶段 6：反映意图&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;名称不仅能反映元素的功能，还能反映其目的。这说明我们既了解元素要做什么，也理解元素为什么存在。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;阶段7：领域抽象&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;名称超越了单个元素本身，成为一个新的抽象概念。元模型里的新概念就是这样诞生的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;名称反映了你对架构概念的理解程度。如果名称只能凑合用，那说明你还没有完全理解这个概念。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;83-让模型融入代码&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#83-%E8%AE%A9%E6%A8%A1%E5%9E%8B%E8%9E%8D%E5%85%A5%E4%BB%A3%E7%A0%81&quot; aria-label=&quot;83 让模型融入代码 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;8.3 让模型融入代码&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;模型反映架构，它可以用来推演架构。但模型也有缺陷，它很容易与代码脱节。稍不小心，包含在模型中的想法就无法在代码中体现出来。那样的话，有关质量属性的思考和推演就会付诸东流，多么可惜呀！&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;别担心！大部分架构模型是可以直接融入代码的，稍后会讲解这方面的技巧。这样做有很多好处，当架构在代码中不言而喻时，我们就能很容易地维护设计的完整性，同时提升既定的质量属性。将模型融于代码还能降低架构漂移的可能性（因为模型和代码几乎是联动的）。这样做还减少了对文档的依赖，因为设计己经融入系统之中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;不幸的是，George Fairbanks 在《恰如其分的软件架构》一书中指出，我们不可能在代码中直接实现架构元模型中的所有概念。尽管如此，我们还是可以设法减小模型与代码之间的偏差 (model-code gap)。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了缩小模型与代码之间的偏差，Fairbanks 提出了“架构显见的编码风格”（Carchitecturally evident coding style）。通过这种方法，我们将模型及其使用规则，还有设计背后的逻辑等都融入到代码之中。这样做可以尽可能地减小偏差，让代码充分体现架构模型。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;831-统一使用架构词汇&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#831-%E7%BB%9F%E4%B8%80%E4%BD%BF%E7%94%A8%E6%9E%B6%E6%9E%84%E8%AF%8D%E6%B1%87&quot; aria-label=&quot;831 统一使用架构词汇 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;8.3.1 统一使用架构词汇&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在抽象的架构变成具体代码的过程中，术语失配（trminology mismatch）是造成混滑的常见原因。架构讨论的是层、服务、过滤器，而代码实现的是包、类、方法。要将模型融入代码，最简单的方法就是统一使用架构词汇。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果使用的是分层模式，那么就应该称代码包为层。如果采用了管道过滤器模式，那公就应该用管道和过滤器给类命名。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;将领域模型（domain model）融入到代码中是减小模型与代码之间偏差的另种方法。按照领域概念进行建模和编码，是面向对象编程的常见做法。许多框架都假设（或鼓励》把领域模型作为整体实现的一部分。以这种方式进行领域建模是领域驱动设计 （domain-driven design）的核心原则。同样，事件驱动架构模式（event-based pttern）和响应式架构模式 （reactive pattern）在很大程度上也依赖对领域工作流的事件模型的理解。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;832-组织代码突显架构&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#832-%E7%BB%84%E7%BB%87%E4%BB%A3%E7%A0%81%E7%AA%81%E6%98%BE%E6%9E%B6%E6%9E%84&quot; aria-label=&quot;832 组织代码突显架构 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;8.3.2 组织代码，突显架构&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;除了命名，代码的组织形式也会极大地影响系统架构。下图展示了一个合理地分层组织代码包的例子。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d4b323bbbe31360060ed076557e1f97d/03914/6ab58038f8b9a368.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 64.8936170212766%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACk0lEQVQ4y0WT547jNhSF/f4PEGAzi3G3rC6qUqSKrWJ7NHWTB/oCcnaRHwQhUjr3NK1qmdLoAq1yGl3S6oI8DRCxS6Mz+k4yjy3vy8T7MvK2jLy/ztxvPfPU8fnx4Otz4dfXYvdVVQqUzFB1TtuUNDonFz5p4tHpnKGXTIPm7eXK28tgQT/eZoaLssNvU89t/h98pWqBUqkFklWCLGO0FPQqpcp8RHhkukgeo+bX+8S/nzMvt5ZpUPRNgZYpdSUYh4Z/vizDGK0z6logpWErUFVCYWRHZyL/aAc0dcpjbriNir4rmcYGJVNrz6Wv+fp8fDMUSUAqAhxnh+seKPIYWQmqMiEVPu55T6Nyrpfa+nrtpfXPPH+/EzBcNcvLyNvrzCrPQoLAYbN+Yr1+wveOBP7BfrzdPPHz6S9C/2itaJsCVaf8URUGJ5LIRamcaex43AdWRR4R+EcO+2eOh2dS4WF8rcqIMDgSeEcra7jUTKMmEz61TBhHTVnEZKlvwzGhPO5XVlkakgkPEZ8p84DOVKXJ7Z4JF++85dIWDF1BpwTLraVVqT2LwxOyiFjuHa/3Cx/LyCoTgWUVeHs8Z0uRepRZQBI5bNc/2Kx/EAVHdBUzXWuGi2S81nRNQZlHNri6NHeK5d5/M0xi13pmQIxfeepbaSLxMB6bOl37innU9F1F15RolREHDp6zs5JNV+ehYRVHLmdnz+m0wfcPxNHZgv7xrioiWxmzDCsTjKmYCScXAXF4tgMMw9toAEMH97TltH/GP+8QkWN9qfIQLROaOqHXmQWURWzvzGpVRuDucQ5rGpVx7WsLujLFNYCH3U/2m7/Z/fYsS9zvJTyK1KcuIxua8bKthf0tTfmN7KpIrOy+rfgPXHotWT6G8a8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;6ab58038f8b9a368&quot;
        title=&quot;6ab58038f8b9a368&quot;
        src=&quot;/static/d4b323bbbe31360060ed076557e1f97d/1d69c/6ab58038f8b9a368.png&quot;
        srcset=&quot;/static/d4b323bbbe31360060ed076557e1f97d/4dcb9/6ab58038f8b9a368.png 188w,
/static/d4b323bbbe31360060ed076557e1f97d/5ff7e/6ab58038f8b9a368.png 375w,
/static/d4b323bbbe31360060ed076557e1f97d/1d69c/6ab58038f8b9a368.png 750w,
/static/d4b323bbbe31360060ed076557e1f97d/78797/6ab58038f8b9a368.png 1125w,
/static/d4b323bbbe31360060ed076557e1f97d/03914/6ab58038f8b9a368.png 1173w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;组织代码的方式不止一种，比如还可以按照功能模块来组织代码。这种方式要求完成一项功能所需的所有类都包含在单个包里。功能包外部的类将无法访问业务逻辑或数据访问类。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;组织代码，使之与设计的模块结构相匹配应该成为标准做法。毕竞提升质量属性靠的是代码，而不是面在白板上的模式。如果开发的系统体现不出模式，模式实际上就不存在。如果模式没有落地，就无法提升既定的质量属性。Simon Brown 在 《Sofiware Architecture for Developers》一书中列举了不少这方面的例子。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们至少应该做到将代码组织到包里，使之与架构元素对应。如果想做得更好，还要确保关系也能贯彻落实，从而杜绝代码与架构不一致的情况。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;833-贯彻落实元素关系&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#833-%E8%B4%AF%E5%BD%BB%E8%90%BD%E5%AE%9E%E5%85%83%E7%B4%A0%E5%85%B3%E7%B3%BB&quot; aria-label=&quot;833 贯彻落实元素关系 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;8.3.3 贯彻落实元素关系&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;大多数开发团队的问题在于他们只靠纪律和警惕性维护架构的完整性，仅仅这样做是不够的。为了在代码中落实架构，还应该使用其他方法。一旦设计决策在代码中得到了贯彻落实，想要违反或改变就不太可能了（至少是极其困难的)。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们能够贯彻落实架构的程度与使用的结构类型、编程语言、操作环境等因素有关。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;模块结构&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;模块结构在代码中最容易看到，但通常最难贯彻落实。在大多数现代编程语言里，可以通过限制对特定模块的访问贯彻落实 “允许使用”关系。如果这么做不奏效，还可以将模块作为库进行分发。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;假如无法确保关系被贯彻落实，至少还可以监控它们，比如使用静态分析工具识别违反使用、允许使用等关系地方。在有些编程语言里，可以创造性地使用类型来呈现可见且易于监控的元素之间的关系。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;组件连接器结构&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;贯彻落实组件连接器模型的一种方法是将系统设计为在违反架构约定时就终止运行。《Object-Oriented Software Construction》一书定义了这种“契约式设计“（design by contract）方法。该方法在代码中设置各种前置条件、后置条件和不变量，并在运行时进行检查。如果开发人员违反契约，应用就会抛出错误，终止运行。契约可以在多种抽象粒度上工作，包括对象、服务、跨线程的进程。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;贯彻落实组件连接器模型的另一种方法是防止不应连接的组件之间的连接。比如，要求组件之问进行身份验证，这是数据访问层连接数据源时的常见做法。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;微服务架构的迅速普及多少是因为它使领域模型在运行时可见且可落实。在模块结构中贯彻落实 “允许使用”关系可能有难度。如果将这些模块转换为组件，我们就可以在运行时贯彻落实交互规则。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;分配结构&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在代码中表达分配模型背后的意图曾经是一个难题。由于平台即服务（platform as a service， Paas）、容器技术（如 docker）、基础设施即代码（infastructure as code, TaC）和分布式版本控制系统等技术的出现，现在有可能在代码中描述和贯彻落实分配模型了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;将代码视为基础设施，为静态分析创造了机会。利用云平台的自动化构建和部署管道，我们可以将自动架构检查引入部署过程。大多数平合即服务（Paas）产品都可以测试硬件分配限制。我们还可以使用配置和自动化来贯彻落实硬件伸缩和平台配置。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;与物理硬件和传统虚拟机相比，容器是轻量级的、可丢弃的。使用容器，可以采用简单且易于贯彻落实的分配模式，例如每个容器安装一个进程。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;分布式版本控制与基于 Web 的工具（如 Github）相结合，可以轻松地将特定的架构组件分配给某个团队开发，同时保持开放的协作氛围。Fork 和 Pull 上游仓库虽然会受限制，但不会阻止协作。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;834-添加代码注释&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#834-%E6%B7%BB%E5%8A%A0%E4%BB%A3%E7%A0%81%E6%B3%A8%E9%87%8A&quot; aria-label=&quot;834 添加代码注释 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;8.3.4 添加代码注释&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在代码中贯彻落实模型，能做的就只有以上这些了。我们可以贯彻落实设计决策，但代码的结构不会告诉我们为什么要这么做决策。我们可以通过良好的命名和对已知模式的恰当使用，为代码注入更多的逻辑性，但如果还想更进一步，就得靠代码注释了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;代码注释可以有多种形式，比如描述逻辑和理由，或者给出已有设计文档的的链接。即使异常消息也可以包含注释。最好能简要介绍错误背后的设计原理，避免采用一般性的错误描述。例如，写”未知错误“就不如写”ASSUMPTION_VIOLATED： 须提供文档 ID 进行验证“有效。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;835-用代码生成模型&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#835-%E7%94%A8%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E6%A8%A1%E5%9E%8B&quot; aria-label=&quot;835 用代码生成模型 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;8.3.5 用代码生成模型&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;我们还可以用代码自动生成系统模型。如果选择了合适的编程语言、技术、模式，就可以使用模型来自动验证落实情況并监控设计演变。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;所有现代面向对象编程语言都可以生成 UML 类图和包图。大多数编程语言都有依赖分析工具。使用这些工具生成的模型可以分析模块结构。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;组件连接器结构较难自动生成。要生成组件连接器结构必须添加分析工具以便观察运行时模型。然后就可以用记录的数据生成模型并分析架构的贯彻落实情况。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;本章依旧是硬核方法论。介绍了什么是模型，以及如何描述模型。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[《架构师修炼之道》摘录07-架构模式]]></title><description><![CDATA[本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。 全书整体分为三个部分 第一部分介绍软件架构的基础知识和架构师必备的设计思维 第二部分讲解架构师需要掌握的核心技能和知识 第三部分讨论一系列…]]></description><link>https://zhanglun.github.io/blogs/《架构师修炼之道》摘录07-架构模式/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/《架构师修炼之道》摘录07-架构模式/</guid><pubDate>Sat, 15 Jan 2022 05:34:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;全书整体分为三个部分&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第一部分介绍软件架构的基础知识和架构师必备的设计思维&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第二部分讲解架构师需要掌握的核心技能和知识&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第三部分讨论一系列使用的架构设计方法&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;前两部分适合从头到尾通读，第三部分用于参考和检索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;第七章的标题是“架构模式”，本章介绍最常见的架构模式，讲解如何让这些通用模式适应具体需求。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;71-什么是架构模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#71-%E4%BB%80%E4%B9%88%E6%98%AF%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;71 什么是架构模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;7.1 什么是架构模式&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;架构模式是针对特定问题的可复用解决方案，它通过特定的结构组合提升某方面的质量属性。选择合适的架构模式解决问题就不用从零开始设计架构，从而避开诸多麻烦的陷阱。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;模式还有一个好处。由于许多模式广为人知，人们的沟通也变得容易。人常说一图抵千言，其实一个模式可以抵千图。此外，各种技术框架和技术平台都采用了流行的模式，用起来非常方便。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;接下来介绍常见的架构模式，至于不常见的模式，读者可以自行搜索。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;设计模式与架构模式有什么区别吗？&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;设计模式是所有设计是必须掌握的。除了编程、软件架构设计、企业架构设计之外，用户体验、测试、数据库，甚至开发流程都有现成的设计模式。设计模式在现在软件开发中有着重要的地位。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;软件的设计模式可以提高面向对象程序的可复用性和可维护性。架构模式与设计模式有所不同，架构模式定义了各种质量属性场景的解决方案，通常设计软件系统的多个组件。架构模式关注的质量属性与抽象力度都更宽泛。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;72-分层模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#72-%E5%88%86%E5%B1%82%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;72 分层模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;7.2 分层模式&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类别&lt;/th&gt;
&lt;th&gt;模块&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;元素&lt;/td&gt;
&lt;td&gt;层：一组功能内聚的模块。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;关系&lt;/td&gt;
&lt;td&gt;允许使用：那些层可以使用其他层的模块。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;使用规则&lt;/td&gt;
&lt;td&gt;所有模块必须划分到某一层里。上层允许使用下层，这种关系是单向的。“允许使用”关系可以进行限制，让当前层只能使用直接处在其下方的层。禁止循环依赖。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;优势&lt;/td&gt;
&lt;td&gt;提升可运维性、可移植性、可复用性、可测试性、设计阶段的可修改性。概念上比较容易实施。分层可以直观地反映在代码上。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;劣势&lt;/td&gt;
&lt;td&gt;从最上层到最下层，每一层都引入了额外的抽象，增加了复杂度，可能会影响性能。层数繁多和抽象泄露可能会导致开发过程非常痛苦。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;下图是分层模式的示例，左侧显示了允许使用的关系，右侧表示元素之剑的关系&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a0b530f1457e3c5d8bc30d4b6773ba99/41870/d2742a2cbe01d4be.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 47.87234042553191%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABd0lEQVQoz1VSiW6FMAzj/z9x0jRtvG0cpQctPQFPzgZ6Q7JCmmLsJJ2PBVtqCKki5YbzPP/hOI4bIQQYYwTOOcmJbdskttbQrbFh1h4+7ZhtlGKMUZBSEiIS853IOUvtmYQopUje2VCh7AYbCqzPqLWiEa3KhYvw+gEJn+P18J61Fl1tO9RikHJF2/e7uO8HjHVobcdx/Cqk1Wma0Pe9RKrk+aVUa41ucQn9t8JkAnysIp1ng/L4+FLQa5Ye55ykxt6N4wjvvaimqmEYpCaEk/Z4678xLk4sW36weAzK4uX1HdpFxLLfA1FKCSEV8uzZshBystp6hFiRS5MiY8wNi1ll8scJsUZFJJrn+c5JdA1lXVd0tKO0w5YKUmn3EIATmyg44f2KaRzvHpJwWRbJaZnKmJO0+5os3t4/odcI4/O9VxdIPiuFj88R459N89c3ktP+4/EQQva1cyHD+QQbMvxW7r0iroV2bhUXVEY1JCNIRFxT5x7+ANf/AstJWnSGAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;d2742a2cbe01d4be&quot;
        title=&quot;d2742a2cbe01d4be&quot;
        src=&quot;/static/a0b530f1457e3c5d8bc30d4b6773ba99/1d69c/d2742a2cbe01d4be.png&quot;
        srcset=&quot;/static/a0b530f1457e3c5d8bc30d4b6773ba99/4dcb9/d2742a2cbe01d4be.png 188w,
/static/a0b530f1457e3c5d8bc30d4b6773ba99/5ff7e/d2742a2cbe01d4be.png 375w,
/static/a0b530f1457e3c5d8bc30d4b6773ba99/1d69c/d2742a2cbe01d4be.png 750w,
/static/a0b530f1457e3c5d8bc30d4b6773ba99/78797/d2742a2cbe01d4be.png 1125w,
/static/a0b530f1457e3c5d8bc30d4b6773ba99/aa440/d2742a2cbe01d4be.png 1500w,
/static/a0b530f1457e3c5d8bc30d4b6773ba99/41870/d2742a2cbe01d4be.png 1788w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;分层模式有许多变种，但是无论分成多少层，它的元素、关系、使用规则是不变的。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;73-端口适配器模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#73-%E7%AB%AF%E5%8F%A3%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;73 端口适配器模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;7.3 端口适配器模式&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;端口适配器模式隔离了核心业务逻辑，确保它可以在多种环境下使用，以及在隔离其他（负责提供数据和事件的）组件的状态下进行测试。在运行时，可以将输入源的可拔插适配器注入核心业务逻辑中，以提供对事件和数据的访问。构建和运行时，可以通过切换适配器生成各种系统配置。要求之初多个输入设备，或者输入设备有可能发生变化的系统适合使用这种模式。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类别&lt;/th&gt;
&lt;th&gt;模块或组件连接器&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;元素&lt;/td&gt;
&lt;td&gt;层：包含业务逻辑，但它不清楚使用的数据和事件的来源。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;端口：层与适配器之间的接口。借助端口，层可以与具体的适配器分离&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;适配器：与外部数据源、设备成其他组件进行交互的代码，使得层能够访问&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;数据和事件。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;关系|暴露：指明层可用的端口。
实现：指明约束适配器的端口。
注入：指明层可用的适配器。
使用规则|层通常会暴露端口，但不是必须这么做。没有端口的层有时称为内层。不暴露端口的层有时称为内部层。
适配器可以满足一个或多个端口的约束。
如果要将适配器注入端口，则适配器必须实现该端口所需的接口。
该模式适用于设计时和运行时的交互。无论是展示模块还是组件连接器，务必在模型中保持一致。
优势|提升可测试性、可维护性、可修改性。团队可以分工完成不同的层和适配器
劣势|必须建立机制选择运行时使用的适配器。适配器決定了运行时质量（安全性、
可靠性等)。应谨慎选择第三方适配器&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;下图是端口适配器模式的示例。在这个例子中，雷达模拟器可以在不改变核心业务逻辑的情况下从适配器切换到真实的雷达系统。此外，日志和通信总线也可以在必要情况下进行切换。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d64a506967f3189640ec2e1a807de14d/51ed8/5a5dcd3e11d659aa.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.06382978723405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACIElEQVQozy2S2W7cRhBF+eWGHw05MQxJs3O4NLfu4dZskt1cJNkGgtiB808nGCoPB/V2UVX3eEJE9EPHy8u88fvfn7x9WzCmxk09ZVnQtDe+fV/48WNlXUemyeCc/p+WrlO0TU5dJnhxHGF6wzxPrOvMz19/4aYBpTK0rhAipFAZTVsShhfatqTIBXkW0TSSPAtJxJUsDaiUwEuSGKUUxhh+/fM3bhpZVoe1BlmkKJkikoBGV+z2TxQyoyxzlErQWqJkTCquFHlE1+R4h8OB0+lMLAT7/R7fv7C+rqxvC/1oUKXkVkkaXXOrb1RNSWcatC7faRVNLTkfdzw/fsG7hwVhRJLliDTlGobY2eHWiUo3iCwhSmIymVHrGqkK0jQmSSLO5yNR5BMGFw67J07HZ7w8z2lbTWsM69srZV1iZ8vyMjG4nt7eMbh5ROsadcu5+iekTPn69TNhcKSUAiUFqfDx/CCmbDqMdfTW0tuRYbIb9zBjDW3fonu9nR+EPv7lTJGnfPz4gS9//sHDwyd2z4/sd494IsvohoFxnnHrgltm5peF5XVhXh3TMmKnflNotN2mUFlJpMy2woo8RsQ+wfWIf9nj3f+mjWGwFjtP74Gvy7ad7hr6vqWqFbey2Jy8n3yfVSW3tm+3hDwLEPGZKDzixSLZlOmHAessg7OMs6OqK4rirkdBEPgcDjv2++etiCyL38NUgpQhSXIhjk5b4H83EFZygu7eaAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;5a5dcd3e11d659aa&quot;
        title=&quot;5a5dcd3e11d659aa&quot;
        src=&quot;/static/d64a506967f3189640ec2e1a807de14d/1d69c/5a5dcd3e11d659aa.png&quot;
        srcset=&quot;/static/d64a506967f3189640ec2e1a807de14d/4dcb9/5a5dcd3e11d659aa.png 188w,
/static/d64a506967f3189640ec2e1a807de14d/5ff7e/5a5dcd3e11d659aa.png 375w,
/static/d64a506967f3189640ec2e1a807de14d/1d69c/5a5dcd3e11d659aa.png 750w,
/static/d64a506967f3189640ec2e1a807de14d/51ed8/5a5dcd3e11d659aa.png 1021w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;74-管道过滤器模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#74-%E7%AE%A1%E9%81%93%E8%BF%87%E6%BB%A4%E5%99%A8%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;74 管道过滤器模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;7.4 管道过滤器模式&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;管道过滤器模式里的组件称为&lt;strong&gt;过滤器&lt;/strong&gt;，负责单一的数据转换或数据操作。数据快速从一个过滤器流转到下一个过滤器。这种数据操作是并发进行的。松耦合的过滤器可以通过各种方式组合和复用，从而创建出新的管道。该模式多运用在数据分析和数据转换领域。Uinx的终端命令可以连接在一起，它运用的就是管道过滤器模式。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类别&lt;/th&gt;
&lt;th&gt;模块或组件连接器&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;元素&lt;/td&gt;
&lt;td&gt;过滤器：读取、转换、记录数据的组件。过滤器可在读取数据的第一时&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;间开始处理。过滤器必须定义预期输入并输出结果。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;管道：连接器，用于将数据从一个过滤器传输到下一个过滤器。管道具&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;有单一输入和输出，不会改变传输的数据&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;该模式的一些变种还包括元素源（source）和槽 (sink）。前者仅产生数&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;据，后者仅接收数据。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;关系&lt;/td&gt;
&lt;td&gt;接驳：通过管道，连接一个过滤器的输出与另一个过滤器的输入。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;使用规则&lt;/td&gt;
&lt;td&gt;管道只能连接与其输入输出兼容的过滤器。过滤器完全相互独立。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;优势&lt;/td&gt;
&lt;td&gt;提升性能、可复用性、可修改性。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;劣势&lt;/td&gt;
&lt;td&gt;管道过滤器系统不是交互式的，在不修改模式的情况下也不包含用户界面。模式不会明显提升可靠性，但可以通过引入过滤器来处理错误。简单的实现可能会影响性能，因为并发运行多个过滤器是有代价的。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/571c92801647792ded1262883b504f1d/7eab7/95f9020ca4867359.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 31.382978723404253%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABTUlEQVQY0z2Q3W7UMBBG8/4PU0QlWLW9KGovQFwgIdR2twUkSDcbOz+2k3ES20kO2gj4pKNvdK5mJpMx4WSiVI4Xtefj9/fcPrzhJf/F8WT59uOR++dLPjxdUBhFawKla7g7XHJ/eMv+eKA4WVTj6Hwk82PC9BOmm1DWUPcK7UraTugkoIyl6ku0O2HFI0PC+gFtCypXoE1LcaporOe8XGaMoa5rUorEEElxZo4LMUZCmLZe0gorxLSQ5jMr/3KetFJMIbKuK1lZtRSq4TXPGccRkR5rLVprUkrM87w5GSacj+i2p3Me8/iA3T9R/vzNa1nRmJ7ztdnn/TWf8jvM7or8Zkde1QwiDMOwMU4T3gu9D7R9oKgcRrXo3TvamyuOX75SSUTVf384jIITS980iDGI94jIf7z3hBBIaWYMiRAXpriwwEYCYpw3H9PMH8OQxgm+oH1mAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;95f9020ca4867359&quot;
        title=&quot;95f9020ca4867359&quot;
        src=&quot;/static/571c92801647792ded1262883b504f1d/1d69c/95f9020ca4867359.png&quot;
        srcset=&quot;/static/571c92801647792ded1262883b504f1d/4dcb9/95f9020ca4867359.png 188w,
/static/571c92801647792ded1262883b504f1d/5ff7e/95f9020ca4867359.png 375w,
/static/571c92801647792ded1262883b504f1d/1d69c/95f9020ca4867359.png 750w,
/static/571c92801647792ded1262883b504f1d/78797/95f9020ca4867359.png 1125w,
/static/571c92801647792ded1262883b504f1d/aa440/95f9020ca4867359.png 1500w,
/static/571c92801647792ded1262883b504f1d/7eab7/95f9020ca4867359.png 2360w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;批处理模式和管道过滤器模式很像，但有一点不同。批处理系统是各阶段逐个、依次操作，而不像管道过滤器系统那样并发操作。批处理系统通常将所有数据写入磁盘，以供下一阶段读取，而不是将数据从一个阶段传输到下一个阶段。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;75-面向服务架构模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#75-%E9%9D%A2%E5%90%91%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;75 面向服务架构模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;7.5 面向服务架构模式&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;面向服务架构（SOA）用独立的组件提供特定功能的服务。各种服务在运行时整合在一起，决定了系统的行为。这要求服务的使用者必须能够在不清楚服务实现细节的情况下寻找和调用服务。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;SOA有很多种实现方式。传统的SOA非常倚重消息总线和SOAP通信。现代SOA则鼓励使用细粒度的微服务，用轻量级的消息协议（如 HTTP)进行连接。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;复杂的组织通常使用SOA来设计大型软件系统，由不同的部门管理不同的系统部分。SOA允许各个部门在其专业领域内独立工作（隐藏重要业务信息），同时这些子系统又能供外部访问。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类别&lt;/th&gt;
&lt;th&gt;组件连接器&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;元素&lt;/td&gt;
&lt;td&gt;服务：可独立部署的单元，通过定义好的接口提供服务功能。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;服务注册表：列出所有可用的服务，以便服务可查找其他可用服务。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;消息系统：取决于具体的系统设计，如 SOAP、REST、gRPC、异步消息。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;关系&lt;/td&gt;
&lt;td&gt;根据 SOA 系统的约束而变化。如果使用 Netfl ix 的“智能端点和哑管道”方法，则关系是“调用”。如果使用异步消息，则关系是“发布”和“订阅”&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;使用规则&lt;/td&gt;
&lt;td&gt;服务不必知道所使用的其他服务的实现细节。服务必须通过外部组件发现其他服务，要么是服务注册表，要么是异步消息传递的消息总线。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;优势&lt;/td&gt;
&lt;td&gt;提升互用性、可复用性、可伸縮性。模式成熟，有许多子模式。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;劣势&lt;/td&gt;
&lt;td&gt;SOA 系统是分布式系统，带有分布式计算的所有复杂性。SOA 系统组成部分多，集成复杂。其他模式可以在设计时轻松处理的属性，在 SOA 系统&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;运行时很可能出问题。例如，如果不知道快照(snapshot）中正在运行的服务，就没法知道 SOA 系统的版本。该模式也抑制了可用性、可靠性、性能。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;下图是SOA模式的示例，它显示了SOA的单一视图。SOA很复杂，涉及许多架构组件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e50bcf7a615e391f98a5d9fcbe84739f/e1250/a2be935851861b06.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.72340425531915%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABqklEQVQoz3VTXW+cMBDk//+mSH3Lc9q3KIly7d2Bwd8GYzDGE+2S5qO6WlrZht1hZ2Zp9n3HrSilfLsvy4KUEtZ1xTzPyDmj1opad6B+5jW3AQv2cgQVEEgIgYGMMfDewzmHuu+Ia0ZIGXk7cm8DVqBU8F4B7maaJsQYYa3l3TsHoQxeB4vWR/RhZlbNJ7VjL9uKHBVKHLBNgs9EjUC01hzjOGLLK2zKeLoIPF8ELiYg5YIGABcQIHWzJYcs7qFf7uBPPxCv99BKMsVxDNBa8VkpBesDLnaEiBlqWg4NiQIJXraNdUiTQxQP8NcHhO4nonxEmiN3ZY1F1wlY61iCUjakNWNM64eJTdu26PsetA/DwNSUcbDvHZEZVEzJ1+6Ep9dfMFYTMX5GRtSvLpNjUkp2jr5CS84FaloRvGdXiQW9U+E33PICN0p2629X5YuhjXMeQvRQUjIYJRqvoe3w4SyPSK2wXsEEgTmNfP93Vhlw0icE3eHP+coAtJTp0A1naG14mEm/A4CmgAor/vdDNLo/Q7RnFps0JPcIiILoSqm4y2MS9m8jdgvwDT+uU5OXo9pQAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;a2be935851861b06&quot;
        title=&quot;a2be935851861b06&quot;
        src=&quot;/static/e50bcf7a615e391f98a5d9fcbe84739f/1d69c/a2be935851861b06.png&quot;
        srcset=&quot;/static/e50bcf7a615e391f98a5d9fcbe84739f/4dcb9/a2be935851861b06.png 188w,
/static/e50bcf7a615e391f98a5d9fcbe84739f/5ff7e/a2be935851861b06.png 375w,
/static/e50bcf7a615e391f98a5d9fcbe84739f/1d69c/a2be935851861b06.png 750w,
/static/e50bcf7a615e391f98a5d9fcbe84739f/78797/a2be935851861b06.png 1125w,
/static/e50bcf7a615e391f98a5d9fcbe84739f/aa440/a2be935851861b06.png 1500w,
/static/e50bcf7a615e391f98a5d9fcbe84739f/e1250/a2be935851861b06.png 1786w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;76-发布订阅模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#76-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;76 发布订阅模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;7.6 发布订阅模式&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在发布订阅模式中，生产者（producer）和消费者（consumer）在彼此不知情的情况下独立存在。大量的消费者订阅各种生产者发布的时间。生产者和消费者通过事件总线间接通信，事件总线负责将发布的时间与感兴趣的订阅者（subscriber）连接起来。事件总线技术的选择极大地影响系统属性。如果有多个独立组件要访问相同信息，就可以选用发布订阅模式。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类别&lt;/th&gt;
&lt;th&gt;组件连接器&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;元素&lt;/td&gt;
&lt;td&gt;发布者：发布时间的组件。发布的具体时间应在设计文档中描述。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;订阅者：订阅事件的组件&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;事件总线：负责登记组件订阅和传递发布的事件。事件总线提升的属性由具体技术及其配置决定。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;关系&lt;/td&gt;
&lt;td&gt;发布：组件将事件发不到事件总线。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;订阅：组件登记订阅事件。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;使用规则&lt;/td&gt;
&lt;td&gt;所有通信都通过事件总线进行。因此，所有组件必须连接到总线。某个组件可能既是发布者又是订阅者。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;优势&lt;/td&gt;
&lt;td&gt;提升可拓展性、可复用性、可测试性。根据事件总线的选择及其配置方式，还可以提升可用性、可靠性、可伸缩性。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;劣势&lt;/td&gt;
&lt;td&gt;考虑到组件通信的独立性和异步性，发布订阅系统的性能很难判断。事件总线的选择决定了发布订阅系统的成败。选择事件总线前应做好功课。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/232c4fb24778569702261d4442a80d80/95e27/ba098cd22f4f299f.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.23404255319148%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACeElEQVQozz2QyY7cNhRF9f9LLwJkYTiTh8CVLnXXpJmiKGouzaUau/0pJ5DSzuKCxLsPh5fXeL0NzHp7nHi7jzyuPfdrz+M2cLt0XKaa27nl7T7wuHZMQ8XUF1zGir5JKXSAEhYq2PHHxw8Yt3PHrBlynRr6tqDMY26Xnr4rSbQgzxSnsWaaWromZ+zLZfc8VNSFIpEu0tvw+dMvGI9Lx/3SLcl+3EeGNqdIJXWlqUtNmUXkSbjMskSgpEsceejIRUsHzzKJxYFMuXz5/dd34Lnhdm748ThxLBSu9Uzo74mE9b9C3yLw9gssjX1S5SO8PZ71jJY2ReKz+vpp/nKzpJt7mnWdWtpjxthVXM8dr/eJ86mlzNRSxfXc83o/LbvzLJYeVRaRSAfz+58Y16le0kx9yZx26iuaKmHsSrqmZBwa2nruVXEsE/q2ZBrrxS/SaEmaxQHOzuT7198w5oIj4dA1Gc0xoW9yTsMRJT0C3ybREVmqGLqKstAUebxAf4KbY0quBYGzwVx9xjhWKWWRUh9zpPA4VjmnsSFNImTokWhJUxeLHwYuMvSXnTn10Ne0zeyl5InA3j1hFLkmViFKCkTgo5QkTWN0HBH4Lp5nk2cJOpaIwMO2DsuZpXPadNmdH51/ZO/WGLGOiWJFGEmElMtdvStONLOv4hidJCRZRlYUpHmGTjSRioiiEBkGSz27zRPGDHGEwBUC2w9wAkEgIyzXw9xs2DsO65fNoqfnF563OyzPxw8lvhBIKQiF9w5cY9i+z8vB4Wlrsd7amDuHl4PLemuxMrestwdW5oa//zH569uKbyuTvfsf0PF9HNfFcWwce89uu+ZfBGkZaw5/gxwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ba098cd22f4f299f&quot;
        title=&quot;ba098cd22f4f299f&quot;
        src=&quot;/static/232c4fb24778569702261d4442a80d80/1d69c/ba098cd22f4f299f.png&quot;
        srcset=&quot;/static/232c4fb24778569702261d4442a80d80/4dcb9/ba098cd22f4f299f.png 188w,
/static/232c4fb24778569702261d4442a80d80/5ff7e/ba098cd22f4f299f.png 375w,
/static/232c4fb24778569702261d4442a80d80/1d69c/ba098cd22f4f299f.png 750w,
/static/232c4fb24778569702261d4442a80d80/78797/ba098cd22f4f299f.png 1125w,
/static/232c4fb24778569702261d4442a80d80/95e27/ba098cd22f4f299f.png 1199w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;77-共享数据模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#77-%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;77 共享数据模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;7.7 共享数据模式&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在共享数据模式中，多个组件通过共用的数据库访问数据。没有哪个组件单独对数据或数据存储负责。该模式特别适合有大量数据、多组件的系统。在共享数据系统里，数据和数据源是交互的主要媒介。该模式与基于时间的系统有所不同，后者的组件通过过程调用或消息调用进行通信。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类别&lt;/th&gt;
&lt;th&gt;组件连接器&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;元素&lt;/td&gt;
&lt;td&gt;数据库：保存访问器(accessor）共享的数据。数据存储的选择及其约束决定了能实现的质量属性。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;数据访问器组件：以某种方式使用数据的组件。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;关系&lt;/td&gt;
&lt;td&gt;读取：数据访问器组件可以从共享数据库中读取数据。某些读取关系可能需要特定协议或对可读取的数据量、类型进行限制。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;写入：数据访问器组件将数据与入共享数据库。写入关系可以采用事务形式进行限流和保护，或者用其他方式进行约束。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;使用规则&lt;/td&gt;
&lt;td&gt;只有数据访问器可以与共享的数据库进行交互。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;优势&lt;/td&gt;
&lt;td&gt;通过数据一致性、安全和隐私提升可靠性。如果数据库充分优化、数据访&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;问器划分良好，也可以提升可伸缩性和可用性。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;劣势&lt;/td&gt;
&lt;td&gt;共享数据库可能导致单点故障，从而影响可用性和性能。如果数据库发生变更，可维护性也会受影响，因为所有数据访问器也需要做相应变更。这种模式易于实施，也容易被滥用。共享数据可以解决许多问题，但在具体情况下，其他架构模式可能更适合。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7a84d0965e9d84d445887af068cdb9ba/f4fb1/36d83d3a22d73ecf.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 52.659574468085104%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlUlEQVQoz1WTbXObMBCE9f9/Xt18yUzNJAaDAAEybwbbbOe5hJQys9bpdFrtnmT3er30H55Pw/Mb27ZpGAbVda0QguF2u9nauq6a51nLslhMzvED0T5um7TpG8TbZgQxRl0uFyPuuk7TNFmOeZZlqqpKbdvKsWFXt66Lphg0xqChqzXEYHk2o/KoEEV93xu895YjdhSyyMeJ9/Apfz6pTH6rL86a58nWcFAUhcZxNNWMZVmaQshQjXVHEsksNAFlQTGUurWVetD3dlCe52YLUqyR360zp4a5oxDStu2+Nje1uuAVm0pd89UvirEFqMU2eYhQzhyn1Dmk3+93szWOg5Y2U/PxpvJ8Uu8Tu0U+esmBzLHMCGnTNEYEKTwOq4/Hw/xDHutcwV9VFZkan1n+3wvYfkDf9x5er1eLIXc8hTRNrT8xdsp9rSw5qUzflfvKGg4gOb5N1JDHKq1ArfUQubDv1vphVPL+S8F/ypeVbaBwJzz+CSDlUhips1tGJrJRSFzkuf6cE13S7OdmKT6+1x27/WP8F5IVTOIPp565AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;36d83d3a22d73ecf&quot;
        title=&quot;36d83d3a22d73ecf&quot;
        src=&quot;/static/7a84d0965e9d84d445887af068cdb9ba/1d69c/36d83d3a22d73ecf.png&quot;
        srcset=&quot;/static/7a84d0965e9d84d445887af068cdb9ba/4dcb9/36d83d3a22d73ecf.png 188w,
/static/7a84d0965e9d84d445887af068cdb9ba/5ff7e/36d83d3a22d73ecf.png 375w,
/static/7a84d0965e9d84d445887af068cdb9ba/1d69c/36d83d3a22d73ecf.png 750w,
/static/7a84d0965e9d84d445887af068cdb9ba/78797/36d83d3a22d73ecf.png 1125w,
/static/7a84d0965e9d84d445887af068cdb9ba/aa440/36d83d3a22d73ecf.png 1500w,
/static/7a84d0965e9d84d445887af068cdb9ba/f4fb1/36d83d3a22d73ecf.png 1766w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;共享数据模式可以与其他模式完美融合。许多大型信息系统的架构都用到了该模式。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;78-多层模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#78-%E5%A4%9A%E5%B1%82%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;78 多层模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;7.8 多层模式&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在多层模式中，系统运行时的结构被组织成逻辑组。这些逻辑组可以被分配到特定的物理组件，如服务器、云平台。多层模式（multi-tier pattern）在概念上与分层模式（layers pattern）相似。layer 是模块结构，处理设计时元素（design time element）；而 tier 是组件连接器结构或分配结构，处理运行时元素（runtime element）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果系统的组件将在不同的平台或硬件上运行，那么就可以考虑使用不同的层（tier）。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类别&lt;/th&gt;
&lt;th&gt;组件连接器或分配&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;元素&lt;/td&gt;
&lt;td&gt;层(tier)：运行时组件的逻辑组。有许多方式进行分层，如功能职责、计算平台、团队职责、沟通机制、安全需求、数据访问。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;关系&lt;/td&gt;
&lt;td&gt;属于：将组件归到某一层。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;通信：层或其内部组件与其他层的交互。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;该关系可以通过设计定义协议和通信约束。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;允许通信．表明哪些层可以与其他层中的组件通信。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;分配到：将层映射到物理计算平台。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;使用规则&lt;/td&gt;
&lt;td&gt;一个组件可能只属于某一层。层内的组件仅允许与同层的其他组件通信。增加层通信的约束条件，可以让情况更清楚，并提升可维护性。常见的方法是仅允许相邻层之间的通信。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;优势&lt;/td&gt;
&lt;td&gt;提升安全性、性能、可用性、可维护性、可修改性。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;有利于分析成本和部署。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;劣势&lt;/td&gt;
&lt;td&gt;作为运行时构造，在大型系统中实施可能会有难度。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;太多的层可能会抑制系统性能和可维护性。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;下图是多层模式的示例。在这个例子中，应用层的组件分配到客户的服务器。中间层的组件分配到通用平台，但具有不同的功能职责。数据层的组件托管在不同的云平台上，可能只包含数据库。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ea2ad43f4a2401ff2b1123c86fd66f18/e8950/a20a5ca1f2872c98.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 59.57446808510638%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABpElEQVQoz3VSi46bMBDk/78wSktaaBIoxvj9wIbMafcalZwullZjJ8t4ZrzNvu/4rrZtQ1wDfLKwQSNkj1wSaq0opWBdV8av3zXvCEstMElBmAlt/wOznWCThrUWWmsMw4BlWUCLLn+KeEv42VCx7RUhBsa6VTweDy5ahNR3/O0N4QOlrjBRYXES/fgbkxlZ8TiMOJ1OaNsWXdfhfD6j73vexxjRkMyj5P+kG1KJCNlhkiN8dpxhSgnee4QQuCgCOlMxIf6to3Tar2VlMu0Vbn+vjGH1L3aP+yc2FPA8z/xqdANhThlKLXDZQugJv64XRjofp+C7uJpJTJjlDCEEjDFsSSnF5GVbkUvEoiXWmrmYbN9eiI/kjVoUjDIY7gPnkHOGlBLWWcTicRd3tN1PjHKAy4Yvm6aJR4acEdKZZpItCynwR3S4DzfMYuagqZGU1q3AJ4dR3HnA6VG+KqMisqfKhuzc5BXKKM6ObFOui5IwUTPhpbvAJVIc4KxjVdTnnONoXjJk5rrzY5AqQvoj5chzqMPCdomcXpliITJCGhlydCT8AJ0Foq5duumxAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;a20a5ca1f2872c98&quot;
        title=&quot;a20a5ca1f2872c98&quot;
        src=&quot;/static/ea2ad43f4a2401ff2b1123c86fd66f18/1d69c/a20a5ca1f2872c98.png&quot;
        srcset=&quot;/static/ea2ad43f4a2401ff2b1123c86fd66f18/4dcb9/a20a5ca1f2872c98.png 188w,
/static/ea2ad43f4a2401ff2b1123c86fd66f18/5ff7e/a20a5ca1f2872c98.png 375w,
/static/ea2ad43f4a2401ff2b1123c86fd66f18/1d69c/a20a5ca1f2872c98.png 750w,
/static/ea2ad43f4a2401ff2b1123c86fd66f18/78797/a20a5ca1f2872c98.png 1125w,
/static/ea2ad43f4a2401ff2b1123c86fd66f18/aa440/a20a5ca1f2872c98.png 1500w,
/static/ea2ad43f4a2401ff2b1123c86fd66f18/e8950/a20a5ca1f2872c98.png 2000w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;79-能力中心模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#79-%E8%83%BD%E5%8A%9B%E4%B8%AD%E5%BF%83%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;79 能力中心模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;7.9 能力中心模式&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在能力中心模式中，有一个专家团队负责定义模式、建立最佳范例、开发支持工具，并为子架构提供培训。能力中心（COC)本身不会构建和交付系统模块，而是帮助其他团队在日常开发工作中取得进步。CoC 团队可以围绕技术、用例、模式、高风险领域进行组织。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;组建 CoC 将使开发团队更容易在架构中实施我们想要的模式和技术。CoC 是一个支持组，其首要目标是加快开发速度并提高系统的整体质量。下面的表格展示了能力中心模式的主要特点。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类别&lt;/th&gt;
&lt;th&gt;分配&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;元素&lt;/td&gt;
&lt;td&gt;CoC团队：开发人员和架构师小组。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;责任区域：架构的子集，可以使模式、技术、用例。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;关系&lt;/td&gt;
&lt;td&gt;负责：联系CoC团队及其责任区域。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;使用规则&lt;/td&gt;
&lt;td&gt;通过一位CoC成员只负责一种技术或用例。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;优势&lt;/td&gt;
&lt;td&gt;提升专家的可复用性和可伸缩性，从而提升多方面的质量属性，如安全性、可伸缩性、性能、可靠性、可维护性等。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;劣势&lt;/td&gt;
&lt;td&gt;CoC让一些专家形成了知识上的”孤岛“，且容易因人员流动而出现知识流失。能力不足的CoC成员会引发问题，影响开发速度。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;下表则是能力中心模式的示例，它展示了有数百位开发人员的公司如何组织CoC团队。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;CoC团队&lt;/th&gt;
&lt;th&gt;责任区域&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;任务调度比例&lt;/td&gt;
&lt;td&gt;开发任务调度用例的框架，创建工具以便团队能够在集群里实例化该框架。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;性能&lt;/td&gt;
&lt;td&gt;就负载与性能测试与团队进行磋商，提供测试和搜集数据的工具，搜集和组织数据集及其他测试资产&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;数据库技术&lt;/td&gt;
&lt;td&gt;与团队磋商选择适于用例的数据库，维护数据库配置工具，创建并分发培训材料。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;核心平台&lt;/td&gt;
&lt;td&gt;维护通用容器管理系统，提供Docker镜像，为日常任务（如日志收集和状况检查）创建工具。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;710-开源贡献模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#710-%E5%BC%80%E6%BA%90%E8%B4%A1%E7%8C%AE%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;710 开源贡献模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;7.10 开源贡献模式&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在开源贡献模式中，开发团队虽然负责开发架构组件，但同时也允许其他人为开发做贡献。团队负责从质量和概念完整性的角度审核其他人提交的组件和更新。该模式只允许在架构上有少量的集中控制。当有来自多个开发团队的专家参与项目，或对某些组件存在共同依赖时，可以使用该模式。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;要想成功运用这种模式，团队必须清楚要对哪些组件负责，并且明白这些组件要达到什么样的要求和标准。只给负责团队（所有者）提供写权限，可以进一步强化因队对组件的责任。其他贡献者则可以随时提交变更以供审核。事先编写风格指南，注重可测试性，限制技术和开发平台的选择，可以让开发人员更容易做出贡献。下表展示了开源贡献模式的主要特点。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类别&lt;/th&gt;
&lt;th&gt;分配&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;元素&lt;/td&gt;
&lt;td&gt;团队：提交或审核组件变更的小组。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;库：包含软件组件的版本控制存储库。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;关系&lt;/td&gt;
&lt;td&gt;拥有：团队负责审查变更并维护库的完整性。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;所有者有时称为库的仁慈独裁者。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;可能贡献：表示可能向库提交变更的团队。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;使用规则&lt;/td&gt;
&lt;td&gt;库同城只有一个所有者，但这不是严格的规则。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;团队可以对多个库做贡献。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;优势&lt;/td&gt;
&lt;td&gt;提升可复用性、可维护性、开发速度。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;劣势&lt;/td&gt;
&lt;td&gt;此模式与组件划分策略密切相关。在多数情况下，共享的学习曲线极其陡峭，这种模式就不太现实。也许需要与其他开放式管理方式配合才能取得成功。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;开源共享模式可以与提升可复用性的其他模式配合使用。开源的做法可以创造出许多意想不到的复用机会。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;711-大泥球模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#711-%E5%A4%A7%E6%B3%A5%E7%90%83%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;711 大泥球模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;7.11 大泥球模式&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;与其说大泥球是一种模式，不如说它是一种开发现象。大泥球模式没有明确的元素或关系，它也不能提升任何质量属性（其主要特点是杂乱无章）。大泥球模式会降低系统的可维护性和可拓展性。模块结构和组件连接器结构都可能变成”大泥球“。甚至有些微服务系统也能变成分布式的”大泥球“。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;大泥球模式唯一的优势是在短期内提高开发速度（以牺牲设计的完整性为代价）。毫无章法的开发和缺乏架构知识是导致“大泥球”出现的主要原因。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;有时为了尽快交付系统，我们不得不采用大泥球模式。这样做会留下技术债务，如果不能尽快淘汰系统或及时偿还技术债务，这种方法就有风险。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;712-发现新架构模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#712-%E5%8F%91%E7%8E%B0%E6%96%B0%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;712 发现新架构模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;7.12 发现新架构模式&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;模式源于经验。有些模式广泛适用于各种系统和团队，有些却只适用于个别场合。虽然发明全新的架构模式并不容易，但新模式一直在涌现。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构师发现新模式的途径与昆虫学家发现新物种的途径大致相同。多花时间，留心观祭。如果你发现了新模式，可以试着把它记下来，根据现有模式对它归类。如果你发现的模式已经存在，你可以发博客或论文，对现有知识进行补充，为集体智慧做贡献。如果你发现子新模式，请把它添加到团队的模式目录里。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;发现模式主要有两种方法：以问题为中心，或以解决方案为中心。以问题为中心的方法是从常见的问题入手。如果你反复看到同样的问题出现，你可以试着开发一个通用的解决方案。研究现有的解决方案，找出其中的相同之处与不同之处。根据你的分析，尝试描述新解决方案的模式。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;以解决方案为中心的方法则是从反复使用的解决方案入手。也许其他开发人员还没有意识到这一点。描述你观察到的解决方案模式，分析它能解决哪些常见的问题，试着把它定义清楚。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;模式定义完成后，把它分享出去。你可以去找那些熟悉类似问题或类似解决方案的人，请他们提意见。模式的最终检验还要看实际实施情况，然后根据实践中的反馈意见进行改进。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;本章主要介绍了将近十种常见的架构模式，内容比较多，需要好好消化。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[使用CSS追踪用户信息-CSS Fingerpoint]]></title><description><![CDATA[今天网上冲浪时看到这个网站 https://csstracking.dev/ ，提到一种使用CSS技术实现用户信息追踪的方案，挺有意思的。作者 OliverBrotchie，项目地址 https://github.com/OliverBrotchie/CSS-Fingerpri…]]></description><link>https://zhanglun.github.io/blogs/使用CSS追踪用户信息-CSS Fingerpoint/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/使用CSS追踪用户信息-CSS Fingerpoint/</guid><pubDate>Tue, 11 Jan 2022 03:00:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;今天网上冲浪时看到这个网站 &lt;a href=&quot;https://csstracking.dev/&quot; class=&quot;link-underline&quot;&gt;https://csstracking.dev/&lt;/a&gt; ，提到一种使用CSS技术实现用户信息追踪的方案，挺有意思的。作者 &lt;a href=&quot;https://github.com/OliverBrotchie&quot; class=&quot;link-underline&quot;&gt;OliverBrotchie&lt;/a&gt;，项目地址 &lt;a href=&quot;https://github.com/OliverBrotchie/CSS-Fingerprint&quot; class=&quot;link-underline&quot;&gt;https://github.com/OliverBrotchie/CSS-Fingerprint&lt;/a&gt;，这是一个基于 CSS 的指纹识别和纯 CSS ‘supercookie’ 的实验项目。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;项目介绍了几种追踪方式和这么做的原因。简单总结就是利用浏览器加载CSS的机制，将数据信息通过接口发送给服务端，从而达到绕过现有常见的反追踪策略。具体的细节可以往下看。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;使用-Media-Query-追踪设备特征&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8-Media-Query-%E8%BF%BD%E8%B8%AA%E8%AE%BE%E5%A4%87%E7%89%B9%E5%BE%81&quot; aria-label=&quot;使用 Media Query 追踪设备特征 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用 Media Query 追踪设备特征&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;利用CSS的媒体查询，针对一些特定的浏览器特性，为网站设置不同的样式。当用户访问站点时，浏览器将选择一组适用于自身的样式。可以利用这个机制，使用background-image属性将浏览器的信息发送给服务端。然后服务器将响应 HTTP 状态 410 (Gone) 以避免在后续重新加载时对这些特征的发起请求。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;是不是有点意思？举一个简单的例子，检测用户设备是否有定点装置（如鼠标），以及如果有，精度如何。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// 默认没有定点装置
.pointer {
  background-image: url(&amp;#39;/some/url/pointer=none&amp;#39;); 
}

// 至少有一个输入途径包含一个精度有限的定点装置，比如触摸屏
@media (any-pointer: coarse) {
  .pointer {
    background-image: url(&amp;#39;/some/url/pointer=coarse&amp;#39;);
  }
}

// fine 至少有一个输入途径包含一个精确的定点装置。比如鼠标。
@media (any-pointer: fine) {
  .pointer {
    background-image: url(&amp;#39;/some/url/pointer=fine&amp;#39;);
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;使用font-face检测字体安装&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8font-face%E6%A3%80%E6%B5%8B%E5%AD%97%E4%BD%93%E5%AE%89%E8%A3%85&quot; aria-label=&quot;使用font face检测字体安装 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用font-face检测字体安装&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;通过类似的方式，在用户访问站点时，还能检测到安装的Web字体。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;@font-face {
  font-family: &amp;#39;some-font&amp;#39;;
  src: local(some font), url(&amp;#39;some/url/some-font&amp;#39;);
}

.some-font {
  font-family:&amp;#39;some-font&amp;#39;;
  view raw;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果用户的设备上没有安装对应的字体，浏览器会向CSS样式中设置的url地址发起字体下载的请求。如此一来便能知晓用户安装的字体。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://github.com/OliverBrotchie/CSS-Fingerprint/issues/2&quot; class=&quot;link-underline&quot;&gt;https://github.com/OliverBrotchie/CSS-Fingerprint/issues/2&lt;/a&gt; 网友 &lt;a href=&quot;https://github.com/Leland&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;Leland&lt;/strong&gt;&lt;/a&gt; 提出这种方式在Webkit中无效。他在 Chrome 96 中测试过，&lt;code&gt;local()&lt;/code&gt; 只对本地的系统字体有效。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;利用重定向创造-CSS-Cookies&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%A9%E7%94%A8%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%9B%E9%80%A0-CSS-Cookies&quot; aria-label=&quot;利用重定向创造 CSS Cookies permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;利用重定向创造 CSS Cookies&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;假设用户的CSS中有类似前文中提到的使用url的属性。当用户访问站点时，浏览器会向对应的地址发起HTTP请求。此时，服务端响应状态码返回308永久重定向到一个唯一的地址。之后浏览器任何时候访问这个资源时，请求都会重定向到这个唯一的地址。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f0e2af9f3e1ec6eaaed1c2ede02ee315/fbf08/b258335ee2f153e4.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 85.1063829787234%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACvUlEQVQ4y3WUzYtcRRTF+x9TV2ayiiiCE4JLJwq6d+nCjSYbXQkiSIIkATMRgowR1DjOkJAJQaLDiIKok/54n/Vd9aa7Z35a9bpfvzBxcXhVr26de+rWuTUQ1iONR9qAMB6hA7bxPHrkuHmjxd6ewzQeYdqYGCu7fe3/NLeeQVo0LWJwpQIzPJ98bDn3vOOlFxwffWg5OmnXUtKIJaldJlkS9jLGhVp73FHg/j3Hlc8Mn3+q2N1xSbXQbYzsKRILLMkH0q7YuyAT8NNAc2xRjSDMm6dU9Eu02rMgXGXoHce0pFll+HtYdrVbHbevdIGF6oEwzyLzKNcwzCp+/+sJlXY9RcsLCU+p6xR2gcvgxXdSKQppqI0nqySl0KcSL+eVsglx3Cp0DXVUVEomQjMqJeNSLhI4SjtlogLKuFMniTHTY5ie0FMoLfkoZ3g4ocprykIgXczukHMo/viZ/LeHqDndbfbx1Z273PrmbktYC83BG++y/8oGB+tv88va6wzvbKOOQZiGcu822eWzZJfWKO7dpDINlTLkQuOncza3fuDM+kXOvLaRiAfjnYc8fvEC+6++xf7LG+yff4dylCN9g3BHFPdvMbm0lgjznesUylMIzaSUuGbGl19/x9nzb7K2fpHNre8ZVIWgGhcc/nlI9s+IuhSppl2N5pAdPGDy624aL4+sXZO+w7zmi80tbtz+llo7BnGzbmaMhaZyDcofda2V/KYcuZ4xkdM0Vq692ajwSV4nJ8xOSGiNHT1nA+NCUEqTbCPMyl9hFjvG4GeKMI9mV0lVVuvuUk7ZJpp4FAmVTeStvwKmiT3tuX7VJmz/aCik7Iz/LAt1nRJvLWYelyKRDzOBcILL72vOPefSy/PBe5ZmHqh1v2vC/3SKDemliYWNqJRDe8fujuXaFcO1q4afti06nFbVvYv/9fK/T1LpGH8vLAEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;b258335ee2f153e4&quot;
        title=&quot;b258335ee2f153e4&quot;
        src=&quot;/static/f0e2af9f3e1ec6eaaed1c2ede02ee315/1d69c/b258335ee2f153e4.png&quot;
        srcset=&quot;/static/f0e2af9f3e1ec6eaaed1c2ede02ee315/4dcb9/b258335ee2f153e4.png 188w,
/static/f0e2af9f3e1ec6eaaed1c2ede02ee315/5ff7e/b258335ee2f153e4.png 375w,
/static/f0e2af9f3e1ec6eaaed1c2ede02ee315/1d69c/b258335ee2f153e4.png 750w,
/static/f0e2af9f3e1ec6eaaed1c2ede02ee315/fbf08/b258335ee2f153e4.png 962w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;整个过程最关键的是站点的CSS属性，而最后呈现的效果就像Cookie一样，所以成之为”&lt;strong&gt;CSS Cookies&lt;/strong&gt;”。只有彻底清除浏览器缓存才能干掉这个“Cookie”。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;为什么要用CSS来追踪用户&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8CSS%E6%9D%A5%E8%BF%BD%E8%B8%AA%E7%94%A8%E6%88%B7&quot; aria-label=&quot;为什么要用CSS来追踪用户 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;为什么要用CSS来追踪用户？&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;通常网站使用Cookies来实现用户追踪。但是很容易就被拦截，比如停用JavaScript或者使用浏览器插件阻止。CSS的方案可以巧妙的绕过这些阻碍。因为整个过程中都没有用到JavaScript或者Cookie。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;目前这种方案的拓展性还是不够强，因为开发者需要定制大量的样式，浏览器需要下载更多CSS，发送更多请求。不过在 CSS 4 的草案中，CSS 的属性值支持变量计算。利用变量计算动态创建url的值，可以大幅降低请求的数量。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;sass&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.body {
  --unique-identifier: &amp;#39;foo&amp;#39; // unique generated ID
  --pointer: &amp;#39;none&amp;#39;
  --theme-preference: &amp;#39;none&amp;#39;
  
  // Only make one request
  background-image: url(&amp;quot;/some/url/?&amp;quot; + var(--unique-identifier) + &amp;quot;&amp;amp;&amp;quot; + var(--pointer) + &amp;quot;&amp;amp;&amp;quot; + var(--theme-preference))
}

// Detect pointer type and theme
@media (any-pointer: coarse){
  body {
    --pointer: &amp;#39;coarse&amp;#39;
  }
}

@media (prefers-color-scheme: dark) {
  body {
    --theme-preference: &amp;#39;dark&amp;#39;
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;利用草案提到的能力，不但可以提高这种方法的可扩展性，而且还将提高其精度。 目前很难将每个请求关联到某一个特定的访问用户，因为确定其来源的唯一可行方法是按照来源IP 地址对请求进行分组。 使用新草案，通过生成随机字符串并将其插入到每个访问者的 URL 标记中，可以准确地识别来自该访问者的所有请求。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;不得不说这种思路很巧妙。不过也许有人质疑这种方式是否道德，正如&lt;a href=&quot;https://github.com/OliverBrotchie/CSS-Fingerprint/issues/3&quot; class=&quot;link-underline&quot;&gt;A fundamental question #3&lt;/a&gt;，虽然目前各大浏览器厂商都没有限制这种方式。除了道理问题之外，还有安全问题。如果站点引用的包含恶意代码的第三方CSS文件，恶意代码可以通过这种方式收集信息，甚至发起XSS攻击。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;项目作者说自己创建这个项目主要是用于研究，同时希望能够让这个问题被更多人关注。截至到目前为止（2022年1月26日），作者称曾将这个问题反馈给 Firefox 和 Chromium，但是目前没有任何举措来解决这个问题。而W3C那边的答复是用户无法选择是否运行CSS，CSS 本质上是不安全的，不应该执行不受信任的CSS样式。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;延伸如何确保资源是受信任的&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%BB%B6%E4%BC%B8%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E8%B5%84%E6%BA%90%E6%98%AF%E5%8F%97%E4%BF%A1%E4%BB%BB%E7%9A%84&quot; aria-label=&quot;延伸如何确保资源是受信任的 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;延伸：如何确保资源是受信任的？&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;如果用户无法决定是否运行CSS，那应该如何保证加载的CSS是受信任的呢？可以使用 **内容安全策略（Content Security Policy）**来限制站点加载的资源。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;CSP 是一个额外的安全层，用于检测并削弱某些特定类型的攻击，包括跨站脚本和数据注入攻击等。无论是数据盗取、网站内容污染还是散发恶意软件，这些攻击都是主要的手段。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;CSP 通过告诉浏览器一系列规则，严格规定页面中哪些资源允许有哪些来源， 不在指定范围内的统统拒绝。作为一种终极防护形式，CSP甚至可以在禁止JavaScript执行。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;实施有两种途径：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;服务器添加 &lt;code&gt;Content-Security-Policy&lt;/code&gt; 响应头来指定规则&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;HTML 中添加 标签来指定 &lt;code&gt;Content-Security-Policy&lt;/code&gt; 规则&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;常见案例&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B&quot; aria-label=&quot;常见案例 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;常见案例&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;想要所有内容均来自站点的同一个源 (不包括其子域名)&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;plaintext&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Content-Security-Policy: default-src &amp;#39;self&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;允许内容来自信任的域名及其子域名 (域名不必须与CSP设置所在的域名相同)&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;plaintext&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Content-Security-Policy: default-src &amp;#39;self&amp;#39; *.trusted.com&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;允许网页应用的用户在他们自己的内容中包含来自任何源的图片, 但是限制音频或视频需从信任的资源提供者(获得)，所有脚本必须从特定主机服务器获取可信的代码.&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;plaintext&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Content-Security-Policy: default-src &amp;#39;self&amp;#39;; img-src *; media-src media1.com media2.com; script-src userscripts.example.com&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;延伸supercookies&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%BB%B6%E4%BC%B8supercookies&quot; aria-label=&quot;延伸supercookies permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;延伸：supercookies&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;从这个项目中顺藤摸瓜发现了&lt;a href=&quot;https://github.com/jonasstrehle/supercookie&quot; class=&quot;link-underline&quot;&gt;https://github.com/jonasstrehle/supercookie&lt;/a&gt;，利用favicon 为用户分配一个唯一的身份信息。这个项目同样也是用于教学和研究（可能国外对用户信息比较敏感的关系？）。具体细节可以参阅：&lt;a href=&quot;https://supercookie.me/workwise&quot; class=&quot;link-underline&quot;&gt;https://supercookie.me/workwise&lt;/a&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;使用CSS来追踪用户的确是一个有创意的想法，但是随之而来会带来道德问题和安全问题。这种追踪方案的整个过程都是全自动的。每当对应的CSS执行，数据就会上报到服务端。如果利用JavaScript 增加一个用户确认的步骤，选择性加载CSS，那么在用户禁用 JavaScript 的情况下将无法上报数据。对应延伸出的安全问题，其实是由来已久的问题，可以通过CSP的手段来加固我们的站点。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;参考&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%82%E8%80%83&quot; aria-label=&quot;参考 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://github.com/OliverBrotchie/CSS-Fingerprint&quot; class=&quot;link-underline&quot;&gt;CSS-Fingerprint&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://csstracking.dev/&quot; class=&quot;link-underline&quot;&gt;CSSTracking.dev&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP&quot; class=&quot;link-underline&quot;&gt;MDN-内容安全策略( CSP )&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[《架构师修炼之道》摘录06-主动选择架构]]></title><description><![CDATA[本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。 全书整体分为三个部分 第一部分介绍软件架构的基础知识和架构师必备的设计思维 第二部分讲解架构师需要掌握的核心技能和知识 第三部分讨论一系列…]]></description><link>https://zhanglun.github.io/blogs/《架构师修炼之道》摘录06-主动选择架构/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/《架构师修炼之道》摘录06-主动选择架构/</guid><pubDate>Fri, 07 Jan 2022 05:34:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;全书整体分为三个部分&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第一部分介绍软件架构的基础知识和架构师必备的设计思维&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第二部分讲解架构师需要掌握的核心技能和知识&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第三部分讨论一系列使用的架构设计方法&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;前两部分适合从头到尾通读，第三部分用于参考和检索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;第六章的标题是“主动选择架构”，本章学习运用关键架构需求制定决策，选择架构的结构。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;61-发散探索聚合决策&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#61-%E5%8F%91%E6%95%A3%E6%8E%A2%E7%B4%A2%E8%81%9A%E5%90%88%E5%86%B3%E7%AD%96&quot; aria-label=&quot;61 发散探索聚合决策 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;6.1 发散探索，聚合决策&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;做决策意味着我们需要多个备选方案。如果没得选，那就不需要决策了。要获得备选方案，就需要进行设计探索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;设计探索时反复地发散和聚合的过程。确定问题后，就需要发散思维，探索解决问题的各种方案。找到备选方案后，又需要聚合思维，取得共识，排除不合适的方案。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/56ac66e1bccc15e047146952751a2a8d/eba85/775b8f6bb66c582e.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA60lEQVQY01WRUW/CMAyE+f8/bU88jG10DEG3tkA6CiWhTWLnm0gFaH6wpbN9Pp1nACklYpRcp5hqECVq4g6L3vvTTEqKqiKqj93ZLcUQWH+tWBYrxiAMAtYn9r2nNI7a9JjOcRmFzgX6URGgbvYsi0+qcntTlWVkwiEITXfl9zLStCdeF+/s9od88XvXUZZbPtYVJ+szVtUNb8tVJjfngaLp8zGehEprAy4kTGd5mS8oa4OXxE9rORwth84xeMELFJuK+aLg5DzOK5t2wN4Jn75NHkV9umgunqMNXMdIjIrzQj/Ex3z85+n0iz+F6YMbg3XrRwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;775b8f6bb66c582e&quot;
        title=&quot;775b8f6bb66c582e&quot;
        src=&quot;/static/56ac66e1bccc15e047146952751a2a8d/1d69c/775b8f6bb66c582e.png&quot;
        srcset=&quot;/static/56ac66e1bccc15e047146952751a2a8d/4dcb9/775b8f6bb66c582e.png 188w,
/static/56ac66e1bccc15e047146952751a2a8d/5ff7e/775b8f6bb66c582e.png 375w,
/static/56ac66e1bccc15e047146952751a2a8d/1d69c/775b8f6bb66c582e.png 750w,
/static/56ac66e1bccc15e047146952751a2a8d/eba85/775b8f6bb66c582e.png 1054w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;备选方案越多，我们决策的信心就越大。我们没有时间探索系统设计的所有方面和所有方案。架构师只能重点关注质量属性、架构结构，以及会对这两者产生影响的设计决策。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;611-探索架构关键点&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#611-%E6%8E%A2%E7%B4%A2%E6%9E%B6%E6%9E%84%E5%85%B3%E9%94%AE%E7%82%B9&quot; aria-label=&quot;611 探索架构关键点 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;6.1.1 探索架构关键点&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;以下是架构设计通常要探索的几个方面：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;探索元素及其作用，确定架构的结构组成&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构中的结构是由元素构成的。在精心设计的架构中，每个元素都有明确的作用。任何没有明确作用的元素，都应该被剔除。探索设计方案，就是探索功能各异的元素的组合形式。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;探索关系及其接口，确定元素的交互方式&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;关系描述了架构中的两个元素如何协同工作以完成任务。组件接口就是一种关系，通信机制（比如HTTP、TCP、共享内存）和通信规则（如API、响应对象、请求数据）都定义了接口。从某种程度上说，管理接口和元素通信的规则也是一种架构。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;探索问题领域，理解架构所处的环境&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;每类问题都有自己的术语和概念，描述了它存在的环境。领域中的概念，无论是对象还是事件，都必须在架构的相应处加以说明。对问题领域的理解得越透彻，对架构元素的划分及功能分配就越理想。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;探索技术和框架，提升质量属性&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;现代软件开发技术都有倾向性。框架、中间件、库，任何现成的技术都带有“偏好”和“态度”，理解他们的特点才能更好地发挥其作用。而这种倾向反过来也会影响你的设计决策。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;探索构建和部署方法，确保架构可以交付&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构会影响软件的构建和部署方式。如果你想实现持续交付、多位开发人员并行工作、使用特定的测试策略，那么都需要在设计架构时考虑好。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;探索以往的设计，获得启发，指导决策&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;所有设计都是在已有设计基础上的重新设计和调整创新。大多数架构探索始于温故-审视已知的软件设计知识。设计知识可以总结成经验法则和模式。这种知识既来自你以往的工作，也来自多年来架构师社区积累的经验。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;62-接受约束&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#62-%E6%8E%A5%E5%8F%97%E7%BA%A6%E6%9D%9F&quot; aria-label=&quot;62 接受约束 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;6.2 接受约束&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;约束是无法更改的既定设计决策。约束分为两种类型：技术约束和业务约束。面对技术约束，我们别无选择。如果系统要求用 .NET 编写，那就必须放弃你喜欢的Java框架。业务约束则比较微妙。虽然也无法更改，但它们对架构的影响比不总是那么显而易见。假设有一项业务约束时系统必须在七月底展会开幕前上限，为了满足它，你可以从一下几个方面考虑：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;选择有利于并行开发的模式&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;选择有利于增量交付的模式&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;选择团队熟悉的技术以降低风险&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;选择支持自动化并能加快开发速度的技术&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;不做太多设计规划，接受技术债务，开发“大泥球”&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;第七章《分层模式》中将会介绍什么是“大泥球”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;业务约束还可能在架构之外得到满足，比如挑选工作能力强的开发人员，提前展开测试，或者将部分任务分包出去。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;早期的设计决策也可能成为约束，但它们实际上不是约束。就像房屋的承重墙一样，它框定了其他东西的大致位置。但愿这种决策也是可以更改的，移动承重墙虽然代价高，但终归是可行的。一定要分清楚自己选定的约束与外界的约束。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;63-提升质量属性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#63-%E6%8F%90%E5%8D%87%E8%B4%A8%E9%87%8F%E5%B1%9E%E6%80%A7&quot; aria-label=&quot;63 提升质量属性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;6.3 提升质量属性&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;开发软件有点像制作冰沙。要做好冰沙，你必须确保选对搅拌机。搅拌机之于冰沙，正如架构之于软件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你也许会觉得挑选搅拌机很容易。其实并非如此。你想要容易清洗的，方便安装的，噪音小的，动力强劲的，还是便携的？这些需求就相当于时搅拌机的质量属性。使用表格对比几种搅拌机的主要质量属性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;|标准搅拌机|手持搅拌机|链锯搅拌机
---|---|---|---
易清洗性|中|优|中
适合厨房安装|优|中|特劣
安静程度|中|优|特劣
动力|中|劣|特优
便携性|劣|特优|优
安全性|中|中|劣&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;三种搅拌机都具有相同的基本功能（搅拌）。它们有着可互换的部件，比如玻璃罐既能用在标准搅拌机上，也能用在链锯搅拌机上。除了质量属性之外，设计师还要考虑生产成本、制造工艺、外部接口等。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;买电子设备的时候也是如此。需要在各种品牌、参数、价格、自身需求等多方面综合考虑，选出一款最适合自己的产品。这个过程是煎熬的，但是结果确实令人满意的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;同理，软件架构师也要通过选择结构提升系统的质量属性。而选择结构通常指的就是探索各种架构模式。请记住，**所有设计都是在已有设计基础上的重新设计和调整创新！**找到能够提升既定质量属性的架构模式，把这些模式作为架构设计的起点，你才能做到事半功倍！&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;631-借助质量属性探索架构模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#631-%E5%80%9F%E5%8A%A9%E8%B4%A8%E9%87%8F%E5%B1%9E%E6%80%A7%E6%8E%A2%E7%B4%A2%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;631 借助质量属性探索架构模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;6.3.1 借助质量属性探索架构模式&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;假设我们要构建一个数据驱动的Web应用。你会选择哪种架构模式？下图展示了三种模式：三层模式、发布-订阅模式、面向服务架构模式。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a52e99e4c37a63e17971824793041975/f1901/3770f9da8103724a.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50.53191489361703%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABW0lEQVQoz1WSCY+CQAyF/f+/DCImamIMohjvAy+8L3ibr5uybJOBmen09fW1DUl6vV7Kskzn81lFUdg6HA7a7/d6v9+6XC5arVZ6Pp/m4/54PNr58XjodDrp8/kApQYfHJ1OR/P53ALKstRyudRsNrM94GEYarfbWVAQBOp2u7rdbvam2Wzqer3+AhLA8uzs+XOG8Xa7NSBYcOcENpuNsYb9/X63e2KNIejT6dQCvWTuKGuxWFgwpbOw9Xpt95zxTSYT21eA6NDv942+Aw4GA/V6Pdt7duz7/Vq5+DGAKTnP87+SMWh7MH8y85iGuSx1eZwRCTxRxRD04XBojcBBx2DLquvj+qVpahK5pu6ruky3GBu66YCcfWzqBmMaxVsflTpo1ZR2u23iulE2LKIoUhzH1k0P4o+v1WppPB7/Y9rw+plBsrrBejQamRSUiJ6uMT6AIJAkSTWfAP4AUyn/j4A0IIgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;3770f9da8103724a&quot;
        title=&quot;3770f9da8103724a&quot;
        src=&quot;/static/a52e99e4c37a63e17971824793041975/1d69c/3770f9da8103724a.png&quot;
        srcset=&quot;/static/a52e99e4c37a63e17971824793041975/4dcb9/3770f9da8103724a.png 188w,
/static/a52e99e4c37a63e17971824793041975/5ff7e/3770f9da8103724a.png 375w,
/static/a52e99e4c37a63e17971824793041975/1d69c/3770f9da8103724a.png 750w,
/static/a52e99e4c37a63e17971824793041975/f1901/3770f9da8103724a.png 942w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;三层模式&lt;/strong&gt; 每一层完成不同的任务。对Web应用来说，展现层负责U渲染，业务层运行于服务器端负验证业务规则，数据库负责存储数据。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;发布-订阅模式&lt;/strong&gt; 所有元素都将消息发布到事件总线上。组件可以订阅感兴趣的消息。事件可能不按顺序传送，也不确保传送成功（视消息系统的规则而定）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;面向服务架构模式&lt;/strong&gt; 服务都在中央注册表注册，以便调用者可以找到它们。组件查找并直接调用这些服务，服务响应并回复信息 （出现问题则不响应)。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;三种模式分别提升和抑制了不同的质量属性。你会如何选择？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;多数情況下，三层模式最理想。它易于测试、部署、描述。不过这种简单性是有代价的。三层模式很难提升可伸缩性和可用性等质量属性。如果不在架构中补充其他模式，三层模式可能无法满足我们的所有需求。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;发布-订阅模式具有较高的可更改性和灵活性。虽然这种灵活性很适合构建松耦合系统，但它也有缺点。在我们的数据驱动应用中，消息顺序对事件有影响，仅靠发布-订阅模式不能保证正确的消息顺序。如果选用合适的消息总线技术，也能让发布-订阅模式勉强工作，但不够干净利索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;面向服务的架构具有可更改、灵活、可测试的特点，同时它也易于扩展，比其他模式更容易提升可用性。但它是三种模式中最复杂的，架构设计的工作量最大。我们的应用采用这种模式有点小题大做了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这三种模式都可以用来实现我们的功能需求，选择架构模式关键要看质量属性。针对既定质量属性，要分出各种模式的优劣，我们还需要做进一步的分析。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;632-运用决策矩阵&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#632-%E8%BF%90%E7%94%A8%E5%86%B3%E7%AD%96%E7%9F%A9%E9%98%B5&quot; aria-label=&quot;632 运用决策矩阵 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;6.3.2 运用决策矩阵&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;决策矩阵是一个简单的表格，用于总结分析多个架构设计方案的利弊。它适合用来选择选择与架构相关的各种设计选项，包括架构模式、功能分配、技术方案等。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d3332a416b327c85ebda151fd837062f/de0bd/3c04233df2c9bb63.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 57.97872340425532%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABxklEQVQoz3WTCW+jMBCF+f9/bzdqEylRuX2BjcFcgbzquaXbqF1LFiMf37x5g5N5ucP3I6wPaLuAMC54PB74bXD9mBz7NkGVZ+j6AlWd0aobEmE6/Hm54nRJ8ff8hlsuMU4z1nXBsjzPdV2/5v2+YV0CjLiizs+osld4WyK5bxu2bUfTWgwhQGsD7z2EEKjrGlJKKKVQFAW01jDGxD3nHKx1GIYRUmqEcYqqk6OEzjk4Z9G2bdzo+z5OQpmAAEIPWNM0qIWAFALX6xWPfce+70j2z2AYBlhrkaZpvEBVVMO1rusijMkiuCxhpETLKoRA7/2Hp9+BvERFVVVFGOMQQlTEmODo3bqitRaz7zEbE2P7WdUTkNlZXpZlEUDv6NlRep7nsUyey/MCUgsIXUUBTPYE5GDJl8sFZVlGVbxI7wgdxzGqPjqslcYwedig4Kz7CTygBGRZGuGEEsKyuU5vD4WMpTIQqolV0a4vIDv8XSUPVpWAMU08yMbwSwvmecY0zRCijo9A2RE+ej38VMiff11GVPkrivSMt9tL7Cxt4G9BIFXzS98Oj5ls2zYcwpJ/zwl4bDNkcUKZnuBM9tFBa//7FH97ku+Wl5YPK4+YFwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;3c04233df2c9bb63&quot;
        title=&quot;3c04233df2c9bb63&quot;
        src=&quot;/static/d3332a416b327c85ebda151fd837062f/1d69c/3c04233df2c9bb63.png&quot;
        srcset=&quot;/static/d3332a416b327c85ebda151fd837062f/4dcb9/3c04233df2c9bb63.png 188w,
/static/d3332a416b327c85ebda151fd837062f/5ff7e/3c04233df2c9bb63.png 375w,
/static/d3332a416b327c85ebda151fd837062f/1d69c/3c04233df2c9bb63.png 750w,
/static/d3332a416b327c85ebda151fd837062f/78797/3c04233df2c9bb63.png 1125w,
/static/d3332a416b327c85ebda151fd837062f/aa440/3c04233df2c9bb63.png 1500w,
/static/d3332a416b327c85ebda151fd837062f/de0bd/3c04233df2c9bb63.png 2238w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;决策矩阵的第一列列出备选特性。矩阵每一行代表一个特性，每一列时你对相应设计选项的分析判断。建议使用易于阅读的记号来记录分析结果。总之要把分析结果用清晰的方式呈现出来。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;决策矩阵成形之后，最佳决策通常是显而易见的。用这种方式总结分析设计方案，可以立即排除那些阻碍实现既定系统特性的选项。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;回过头来再看之前搅拌机的那个表格，你会发现它就是搅拌机的决策矩阵。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;创建矩阵的过程比矩阵本身更重要。决策矩阵可以用来总结探索结果，还能用来于利益相关方就设计决策的取舍进行有效的讨论。有些人喜欢用数字来评分。作者建议不要这么做。用数字评分是一个糟糕的主意。有些人根据利益相关方的喜好调整数字，对每一列求和，考虑总体平均值，等等。那只会让事情变得复杂而低效。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;64-为架构元素分配功能&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#64-%E4%B8%BA%E6%9E%B6%E6%9E%84%E5%85%83%E7%B4%A0%E5%88%86%E9%85%8D%E5%8A%9F%E8%83%BD&quot; aria-label=&quot;64 为架构元素分配功能 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;6.4 为架构元素分配功能&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;架构中的每个元素都有功能。我们选择结构时会为每个元素分配特定的功能，以便实现所有既定的功能需求。以 Lionheart 项目为例（书中的一个例子），下面是从预算办公室收集到的功能需求。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;招投标系统的用户需要：搜索该市现在和过去的合同；将结果进行分页显示：查看每个公司的基本信息，包括公司名、电话、地址、过期合同、有效合同等：查看每个合同的基本信息，包括类型、状态、到期时间、投标公司、中标公司等；订阅接收合同更新的提醒。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这些功能需求还隐含了几项功能：用户可以搜素，意味着必须建立索引：要显示合同和公司信息，就必须存储它们：能够订阅，就要求系统存储电子邮件地址;更新时要提醒用户，就要做到可以识别更新。下图展示了用于实现这些功能需求的元素&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9c278b4799fee9fe8f7bff3d3de9ecda/37114/cc8d67158434c13d.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 61.170212765957444%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB4UlEQVQoz31SyW7bMBDV//9MDjnkkENvAXIrivTQOrAWyxYlUZspkiIt+RVvEruHohlgYMmceZuYbNuGr3qJDi7MsItBuARcr1dcLhf4EOBCgPceIQTpGCOSr8DWbcXoeuQqQ6EymGUEyzuH88832B/fMeoWp6qCcw7zPP8f8FY+OByrA8bzIApZ1lo0aYp6t8NsDIZhEHV/Adf1H0BaOZ/PGPoBtaqhWw1jjABSTWs0tO1gZoNxHGW273skVwDUc/1sFpm6rpNf3WmkaYo8z2XpBliUGU6qxDD0qOsay7IIcHKZJvj9O0JZIKgKliBaCyCD5vLpdBJ2qmZxWVVKmiQ3IjpI4rGEfnpE+fiA+fUFbV2jPB5RVZWAtG0rCg+HgyhgkYjZ8Zwumqa5kydbjPBtKyFv1sqVIAht8JmDXCA73wVwXTE7h2GahKQsy7vthANx21Br/fFVvYdSShSSnYC03DYNnPdYjYHb/ca8+wWXZwLSUFDTSEwJL2oMAUVRiA2y0R4HaIm93++RZxlKZpalmL49o3l+gnt9gaoq7NNUcuTOB2CMsihqY5QDNtl556ZPa8woeg/faXh+tGmSK8Zd5szZ+8VmRlzkn1xk354ZA9tZC8uzZZG23ssMdxkN6w9GaJen/ouH9AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;cc8d67158434c13d&quot;
        title=&quot;cc8d67158434c13d&quot;
        src=&quot;/static/9c278b4799fee9fe8f7bff3d3de9ecda/1d69c/cc8d67158434c13d.png&quot;
        srcset=&quot;/static/9c278b4799fee9fe8f7bff3d3de9ecda/4dcb9/cc8d67158434c13d.png 188w,
/static/9c278b4799fee9fe8f7bff3d3de9ecda/5ff7e/cc8d67158434c13d.png 375w,
/static/9c278b4799fee9fe8f7bff3d3de9ecda/1d69c/cc8d67158434c13d.png 750w,
/static/9c278b4799fee9fe8f7bff3d3de9ecda/78797/cc8d67158434c13d.png 1125w,
/static/9c278b4799fee9fe8f7bff3d3de9ecda/aa440/cc8d67158434c13d.png 1500w,
/static/9c278b4799fee9fe8f7bff3d3de9ecda/37114/cc8d67158434c13d.png 2300w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;元素功能表记录了架构中每个元素有权执行的基本任务。通过审视影响较大的功能需求，创建功能元素表，确保每个功能都有且仅有一个元素负责。此外，架构中的每个元素都至少应该负责一个功能，否则该元素就失去了存在的意义。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为元素分配功能时，影响较大的功能需求可以作为检查清单。后续的章节中将介绍一种明确功能的方法对系统进行建模。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;65-设计应变而生&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#65-%E8%AE%BE%E8%AE%A1%E5%BA%94%E5%8F%98%E8%80%8C%E7%94%9F&quot; aria-label=&quot;65 设计应变而生 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;6.5 设计，应变而生&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;此前，我们学习了在理解关键架构需求的基础上探索设计方案，进行设计决策。做好关键的设计决策对于打造稳健的架构至关重要，不过在软件里唯一𣎴变的就是变化。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;所有优秀的架构师都明白变更是不可避免的。通过选择决策时间点，以及将设计决策移出架构，我们可以做到“应变设计“(design for change)。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;651-推迟决策&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#651-%E6%8E%A8%E8%BF%9F%E5%86%B3%E7%AD%96&quot; aria-label=&quot;651 推迟决策 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;6.5.1 推迟决策&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;做出一个不易逆转的决定（比如架构决策）是一件大事。避免走入死胡同或走上歧路的办法是推迟决策。推迟设计决策（不到最后一刻不做决定），可以为研究和探索争取更多时间。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;《敏捷软件开发工具》一书提出了 “最后责任时刻” (last responsible moment)的概念——在避免失去重要备选方案的前提下，做出决策的最晚时间。而作者建议在“最佳责任时刻”（most responsible moment）做决策。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;理想情况下，最佳责任时刻就是最后责任时刻。但在实践中，最佳责任时刻要求我们留出额外的时间，以便处理无法筆控的外部依赖、建立共识、培训、验证设计。最佳责任时刻往往来得比我们想象的要来得早。以下问题可以帮助确定做出设计决策的最佳时机：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;不做决策是否阻碍了项目进展？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;决策能否解决不能再耽搁的问题？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;决策是否会创造更多选项或机会？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;推迟决策是否明显会带来更多风险？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;我是否理解并接受决策带来的一切后果？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;我有明确的理由说明为什么现在必须做这个决定吗？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;如果决策失误，是否有时问弥补？我能承受这样的错误吗？&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;即使我们能够找到最佳责任时刻，也不代表一定有足够的信息进行决策。如果出现这种情况，我们还有一个窍门可以避免情况恶化：可以把那些容易变化的东西移出架构。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;652-将设计决策移出架构&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#652-%E5%B0%86%E8%AE%BE%E8%AE%A1%E5%86%B3%E7%AD%96%E7%A7%BB%E5%87%BA%E6%9E%B6%E6%9E%84&quot; aria-label=&quot;652 将设计决策移出架构 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;6.5.2 将设计决策移出架构&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;如果设计决策以后容易发生变化，那么它就不再是一个架构问题。在可能的情况下，应该把容易变化的决策留给后续设计人员来做。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;己知的许多编程原则也可以作为很好的设计原则。例如，将 SOLD 原则用于架构设计可以带来许多类似面向对象设计的优点。SOLID 代表 5个面向对象设计的原则：single responsibility （单一功能）、open/closed（开闭原则）、Liskov substitution（里氏替换）、interface segregation（接口隔离）、dependency inversion
(依赖反转）。比如，如果架构中的元素具有单一功能，它就更容易隔离更改。再比如，创建接口清晰的元素能带来更多的灵活性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;有许多方法可以将设计决策移出架构，比如可插拔/可替换架构 (pluggable architecture )、外部配置、自描述数据、动态发现。它们都是在设计时（design time）或运行时 （runtime）更改系统的行为（而不修改架构），理想情況下也不会
对基本质量属性产生影响。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在主动选择架构方案时，首先利用发散思维，在接受约束（技术约束和业务约束）的前提下，从架构的关键点出发，探索可能有用的备选方案。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;按照系统预期的质量属性要求，将各方案进行对比，并运用决策举证，找出适合的架构模式。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在最终做决策之前，遵循”应变设计”的思路，推迟决策或者将容易变化的东西移出架构。保证基本质量属性不受影响。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[《架构师修炼之道》摘录05-挖掘关键架构需求]]></title><description><![CDATA[本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。 全书整体分为三个部分 第一部分介绍软件架构的基础知识和架构师必备的设计思维 第二部分讲解架构师需要掌握的核心技能和知识 第三部分讨论一系列…]]></description><link>https://zhanglun.github.io/blogs/《架构师修炼之道》摘录05-挖掘关键架构需求/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/《架构师修炼之道》摘录05-挖掘关键架构需求/</guid><pubDate>Sun, 02 Jan 2022 05:34:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;全书整体分为三个部分&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第一部分介绍软件架构的基础知识和架构师必备的设计思维&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第二部分讲解架构师需要掌握的核心技能和知识&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第三部分讨论一系列使用的架构设计方法&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;前两部分适合从头到尾通读，第三部分用于参考和检索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;第五章的标题是“挖掘关键架构”，本章主要阐述什么时关键架构需求（ASR)，如何挖掘关键架构需求。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;关键架构需求（architecturally significant requirement, ASR）是显著影响架构中的结构选择的需求。架构师有责任确定对架构有重大影响的需求。ASR 通常分为四类。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;约束&lt;/strong&gt; 给定或选定的不可更改的设计决策。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;质量属性&lt;/strong&gt; 外部可见特性，表征系统在特定环境下的运行情况。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;影响较大的功能需求&lt;/strong&gt; 架构设计需要特别注意的特性和功能。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;其他影响因素&lt;/strong&gt; 时间、知识、经验、技术、办公室政治、你的技术特长，以及其他影响决策的东西。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;51-用约束限制设计选择&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#51-%E7%94%A8%E7%BA%A6%E6%9D%9F%E9%99%90%E5%88%B6%E8%AE%BE%E8%AE%A1%E9%80%89%E6%8B%A9&quot; aria-label=&quot;51 用约束限制设计选择 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5.1 用约束限制设计选择&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;约束是外界限定的或自己选择的不可更改的设计决策。软件系统都有约束。适当的约束可以简化问题，但是过分的约束则会增加设计难度。约束会影响技术上或业务上的选择。业务约束限制了对人员、流程、成本的选择；技术约束限制了对可用技术的选择。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;技术约束&lt;/th&gt;
&lt;th&gt;业务约束&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;编程语言（必须能在 Java 虚拟机上运行&lt;/td&gt;
&lt;td&gt;团队组成与结构（x小组开发z组件）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;操作系统或平台（Windows、Linux、Be0）&lt;/td&gt;
&lt;td&gt;进度与预算&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;组件和技术（数据库只能用 DB2)&lt;/td&gt;
&lt;td&gt;法律限制&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;511-明确约束&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#511-%E6%98%8E%E7%A1%AE%E7%BA%A6%E6%9D%9F&quot; aria-label=&quot;511 明确约束 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5.1.1 明确约束&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;应该是用简洁的方描述约束及提出方，比如下方的表格。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;约束&lt;/th&gt;
&lt;th&gt;提出方&lt;/th&gt;
&lt;th&gt;类型&lt;/th&gt;
&lt;th&gt;背景&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;必须开源&lt;/td&gt;
&lt;td&gt;主管&lt;/td&gt;
&lt;td&gt;业务约束&lt;/td&gt;
&lt;td&gt;开源提升影响力，吸引人才加入团队。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;必须使用浏览器&lt;/td&gt;
&lt;td&gt;业务方&lt;/td&gt;
&lt;td&gt;技术约束&lt;/td&gt;
&lt;td&gt;降低交付和维护难度&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;约束一旦确定，就不能再讨价还价，因此接受约束一定要慎重。“必须这么做，否则项目就会失败”和“尽量这么做，除非有合适的理由” 有着天壤之别。随着系统逐渐成形，设计决策有可能变得越来越像约束。区分自己的设计决策与给定的约束越来越困难。系统不再简洁、敏捷、有延展性。最后，早期的设计决策有可能变成了设计师的枷锁，让修改架构变得极其困难。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构设计一定要仔细区分自己的决策与外界的约束。这虽然很困难，但你总是有权选择更改束手束脚的设计决策。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;52-定义质量属性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#52-%E5%AE%9A%E4%B9%89%E8%B4%A8%E9%87%8F%E5%B1%9E%E6%80%A7&quot; aria-label=&quot;52 定义质量属性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5.2 定义质量属性&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;质量属性描述了软件系统的外部可见特性以及我们对系统运行的期望，它在定义了系统执行某些操作时的表现。系统的这些能力有时候称为质量需求。下表中列出了《Softwarte Architecture in Practice》一书描述的常见质量属性。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;设计属性&lt;/th&gt;
&lt;th&gt;运行属性&lt;/th&gt;
&lt;th&gt;感知属性&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;可修改性&lt;/td&gt;
&lt;td&gt;可用性&lt;/td&gt;
&lt;td&gt;可管理性&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;可维护性&lt;/td&gt;
&lt;td&gt;可靠性&lt;/td&gt;
&lt;td&gt;可支持性&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;可复用性&lt;/td&gt;
&lt;td&gt;性能&lt;/td&gt;
&lt;td&gt;简单性&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;可测试性&lt;/td&gt;
&lt;td&gt;可伸缩性&lt;/td&gt;
&lt;td&gt;指导性&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;可构建性或开发时间&lt;/td&gt;
&lt;td&gt;安全性&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;每个架构设计决策都至少会提升或抑制一个质量属性。大多数设计决策在提升某些质量属性的同时抑制了其他的质量属性！牺牲某个质量属性换取另一个质量属性，架构的结构选择就是这样逐步实现的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;挖掘关键架构需求主要就是为了确定系统的质量属性。质量属性会在整个设计过程中用来指导挑选技术、结构、模式，以及评估设计决策的合理性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;质量属性是非功能性需求吗？&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;软件工程教科书通常会讨论两类需求：&lt;strong&gt;功能需求描述系统行为；非功能性需求描述功能需求之外的其他系统需求，包括质量属性和约束&lt;/strong&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;设计软件架构必须区分&lt;strong&gt;功能、约束、质量属性&lt;/strong&gt;，因为每种需求背后有不同的驱动力。例如，约束没有谈判余地，而质量属性则可以取舍。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;质量属性是非功能性需求，但这样分类有点怪，因为质量属性场景中也隐含了功能部分。质量属性仅在系统运行时才有意义。在质量属性场景中，软件的响应是某些功能的直接结果。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;521-用场景描述质量属性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#521-%E7%94%A8%E5%9C%BA%E6%99%AF%E6%8F%8F%E8%BF%B0%E8%B4%A8%E9%87%8F%E5%B1%9E%E6%80%A7&quot; aria-label=&quot;521 用场景描述质量属性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5.2.1 用场景描述质量属性&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;质量属性听起来很抽象（可拓展性、可用性、性能等）。应该赋予这些词汇更具体的含义。解决办法时用质量属性场景来明确地描述质量属性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/26a44fd0be94c2c2d7fa9061cd505ae0/ae2f8/e543be453ab22adf.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.808510638297875%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWElEQVQoz21SCW6EMAzk/99slwVykdtJgKnsLatWrSXLeGJG42PqvUMphX3f4ZwDEYHtuq5ffp7nH/8Pnxi01iKlBCbvY0BrLeSMhRAQY3wTsPHbtikYY7Cuq+S3iIkLYwyotaDWKuTL8hTFTMieUwJRFfXsXNdak9qcM3prko8xMHFirMOqdyjjoW1EKoTjGFLkY4H1+eV7Qq2ERoRSCfOiYPeIPRakXKReCDMNuNjwMSvYQAiZoNQGt3vY2KBdhLIRLnXElKUb7RISXXChSMx1YHQm7A21DfjUYTw/nqKKWz6vC4kO+ESwoSDTidcUgTYu+NTw3CxsqMIhCtt3/8cYMvgYApZlkQUxzpHnaLTGGP09R+6sloLH4/O9UMan4zjkR054m/M8v3MePrUmao21ggvGMyxFIm+aF8PfzDXdd+a9x7ZtQnqfwG2M8ftP/BbAm+Z43+8XRxK6TCzwyfEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;e543be453ab22adf&quot;
        title=&quot;e543be453ab22adf&quot;
        src=&quot;/static/26a44fd0be94c2c2d7fa9061cd505ae0/1d69c/e543be453ab22adf.png&quot;
        srcset=&quot;/static/26a44fd0be94c2c2d7fa9061cd505ae0/4dcb9/e543be453ab22adf.png 188w,
/static/26a44fd0be94c2c2d7fa9061cd505ae0/5ff7e/e543be453ab22adf.png 375w,
/static/26a44fd0be94c2c2d7fa9061cd505ae0/1d69c/e543be453ab22adf.png 750w,
/static/26a44fd0be94c2c2d7fa9061cd505ae0/78797/e543be453ab22adf.png 1125w,
/static/26a44fd0be94c2c2d7fa9061cd505ae0/aa440/e543be453ab22adf.png 1500w,
/static/26a44fd0be94c2c2d7fa9061cd505ae0/ae2f8/e543be453ab22adf.png 2496w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;刺激&lt;/strong&gt; 刺激是一个需要系统以某种方式做出响应的事件。刺激启动了一个场景，其类型由质量属性的类型决定。例如，可用性场景的刺激可能是节点变得不可用了，而可修改性场景的刺激可能是一个变更请求。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;来源&lt;/strong&gt; 刺激的来源，可以是人或系统，比如用户、系统组件、外部系统。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;软件部件&lt;/strong&gt; 系统的某个部分，场景描述中定义了其特征。也可以是整个系统或特定组件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;响应&lt;/strong&gt; 外部可见的活动，在软件部件受刺激后发生。刺激引发响应。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;响应度量&lt;/strong&gt; 定义响应成功的标准和条件。响应度量必须是具体、明确、可衡量的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;环境背景&lt;/strong&gt; 描述了场景中系统的操作环境。环境背景一般要明确说明《即使一切正常）。异常环境（如满负载、故障情况》尤其值得注意。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;下图展示了美国国家航空航天局 （NASA）喷气推进实验室（JL）火星探测机器人的可移植性场景。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/87334ffb966c08f7a1c59902f9438339/07fc0/0d3f117458eaf138.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 36.702127659574465%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABPElEQVQozz2RiW7jMAxE/f8/2KJpEtSNncNHJR8Sdb6FlGQFDDgUh6RENsuycDqdOJ/PdF1XeUHbthyPRw6HQ+VKKbZtQ2uNtZacMykleNknMo1zjhAi67bR91eMtYhzGGNqooijNB2GEWOKLzX2RmlkRSpKrCnJwW1EUSxzT7QzKQjl5JzIfsXoK2r4qZoUHbnEgiHKH5seiKKJ3tSijfOBsN8RfWO+X4j7hFlufHx+0V1a3NJj9ch8/yWLwiwPplmxqyvJzEw1ZyTaEXGBxvvw7GxutXAyD0gWax0xBggryQ4kc8etPasaSBmCaNTjh79HW63sM6VWU/7tvMeHgPce53yd4ZO7OsPiF82274zTVJdjrdC2v3x/H7lcujrfom9ijJU8k+U/ykLeqHcvWxq9NYWHEIivx5Ra/wAjNRuYxLmH/AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;0d3f117458eaf138&quot;
        title=&quot;0d3f117458eaf138&quot;
        src=&quot;/static/87334ffb966c08f7a1c59902f9438339/1d69c/0d3f117458eaf138.png&quot;
        srcset=&quot;/static/87334ffb966c08f7a1c59902f9438339/4dcb9/0d3f117458eaf138.png 188w,
/static/87334ffb966c08f7a1c59902f9438339/5ff7e/0d3f117458eaf138.png 375w,
/static/87334ffb966c08f7a1c59902f9438339/1d69c/0d3f117458eaf138.png 750w,
/static/87334ffb966c08f7a1c59902f9438339/78797/0d3f117458eaf138.png 1125w,
/static/87334ffb966c08f7a1c59902f9438339/aa440/0d3f117458eaf138.png 1500w,
/static/87334ffb966c08f7a1c59902f9438339/07fc0/0d3f117458eaf138.png 2480w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;质量属性场景的六个元素并非要逐点详细说明。只要说明刺激、来源、响应、响应度量，大致就够了。异常情况下还应加上对环境背景的说明。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;合格的质量属性场景应该表达需求的意图，确保所有人都能理解。如果能做到精确、可衡量，那就更好了。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;522-寻找具体可衡量的响应度量&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#522-%E5%AF%BB%E6%89%BE%E5%85%B7%E4%BD%93%E5%8F%AF%E8%A1%A1%E9%87%8F%E7%9A%84%E5%93%8D%E5%BA%94%E5%BA%A6%E9%87%8F&quot; aria-label=&quot;522 寻找具体可衡量的响应度量 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5.2.2 寻找具体可衡量的响应度量&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;给出响应度量，一开始需要根据你自己的经验来估计可能的数值。将利益相关方设想为站在你面前的稻草人，试着与之对话。“将系统移植到单片机上，需要花九个月时间，可以接受吗？”“六个月呢？” 最终，你会找到与利益相关方达成共识的响应度量。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;良好定义的响应度量时可测试的。在项目初期，架物可能只存在于纸面上。但可运行的系统迟早会出现。如果你不知道如何对场景进行测试，那么这个场景实际上就缺少具体、可衡量的响应度量。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;53-对功能需求分类&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#53-%E5%AF%B9%E5%8A%9F%E8%83%BD%E9%9C%80%E6%B1%82%E5%88%86%E7%B1%BB&quot; aria-label=&quot;53 对功能需求分类 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5.3 对功能需求分类&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;功能需求通常以用例或用户故事的形式记录，它定义了软件系统的行为，在某些特定情况下会影响架构设计。所有功能需求都对系统的成功至关重要，但并非所有系统功能都对软件架构有重大影响。如果某个功能需求影响架构决策，我们称之为&lt;strong&gt;影响较大的功能需求&lt;/strong&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;影响较大的功能需求常被称为&lt;strong&gt;架构杀手&lt;/strong&gt;。如果你的架构无法实现这样一个重要的、 高优先级的功能，那么你就不得不放弃这个架构，从头开始设计。确定影响较大的功能需求需要方法、技巧、经验，下面是我的一些做法：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;先画出概念架构草图，展示你当前对架构的构想。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;对功能需求进行大致分类，每类需求反映一个相同类型的架构问题。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;对照概念架构草图，思考每个分类如何实现。如果对于己知的粗粒度需求，实现功能的方式并不明显，那么它就可能对架构有重大影响。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;第2步的作用是将大量的功能需求归入少数有代表性的类别，以下是可用的些策略：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;寻找可以使用相同架构元素实现的功能需求。例如，需要持续运行的功能可以归为一类，而需要用户交互的功能可以归在另一类。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;寻找看起来有难度的功能需求，它们对架构可能有重大影响。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;寻找重要的、高优先级的功能需求。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;我们来看一个例子。第 1.2.3 节的计算器 App，将两个数字求和是一个重要的功能需求，但对架构几乎没有影响。现在假设我们收到一个新功能：要求用户丢失手机之后，仍然可以查看计算的历史信息。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;要查看历史信息？没问题。可以把用户操作保存在本地数据库。手机丢了怎么办？那就需要一个远程的数据库服务器。这又引入了许多新问题：如果用户的手机无法联网怎么办？可用性怎样衡量？可伸缩性呢？远程数据库的托管费用由谁出？数据变化时需要马上进行同步吗？问题越来越多。。。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;一个看似简单的功能需求引出了一系列的新问题。在计算器的例子里，我们可以将所有数学运算归为一类。实现查看历史信息的功能需要远程存储，它与其他功能需求不同，因此可以归为另一类。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构设计应该反映所有影响较大的功能需求，而分类的做法可以避免我们做重复的工作。这样做的目的是让我们对影响设计决策的重大需求引起重视。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;53-找出其他影响架构的因素&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#53-%E6%89%BE%E5%87%BA%E5%85%B6%E4%BB%96%E5%BD%B1%E5%93%8D%E6%9E%B6%E6%9E%84%E7%9A%84%E5%9B%A0%E7%B4%A0&quot; aria-label=&quot;53 找出其他影响架构的因素 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5.3 找出其他影响架构的因素&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;除了关键架构需求，还有其他一些因素会直接或间接影响架构。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a4c9b020cd2f23e59192723f02d769e4/9b379/b0ab2b6bff3a494a.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 71.27659574468085%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACtElEQVQ4y02TWXPaQBCE9f+fUxU7iY8YbHMIoftAIKED0C2BkAA7/i2dmsFO5WFKW7Xab7t7ZoWX598YvQ4wGT9jLk2gqRKWCwNlFuJ4yHDqSlxONT7eW5z7Cn2boS5i7LYB4shDsHbhrWxYpgLLkCAQ7AuozEUosojxaAhTk7ByDWRJjPZQou8b5GkE25BgaiJsU0aRb5EmEdyFCcNQoCkihMl4CHH6grk0hqqIfJOuSXBMFbvYR1Ol6LuG69Q3ONQJijREmcU4tiX2Tc7gbbyC72oQSM393Q3u725ZpfwJtXQFdZmiqbNr7Qt0/6ApTv0eC0eHZcrQ1Bm7cSz5Cnx8+ImH+x+YTl4gzkaYKyKk2RiB76IqU6RpjKrOUJQJsiTCqWvQthVWS4vdjEcDSLMJdFWC8PryxJk9Dx85S1WdwXF0eCsHebqB65rI8x3C0ENVpTi2Nc6nliOoq5Sbstms4XsOHEu9NoWgZFecvGImjiBOX7H2XKRJDN9boKlzJEmMvtvj/dKx6izd8D41rKoSJFsfgW9DIJv/j4w0n0ChTJY2d2/fFNhuAhwOJQ77kuHtocLbpcOpP/Ca4LttyGoFGpPh4AG/fn7H4OkeojhioGHIrKAsEv6ZMiNl7289g+oqYzjtWaYKVZkhDFdXIA337c03hhq6DMfWsfZdFPmOD9D37Xxky5QhASlHKlIYBit2QYMukNWvHKmzlKGuzdkylW1prIwgl/ORAaSc7OfZli8O1kuUxQ5x+AmU51N8dZvWBF04Br8ayjiOfAaQIsru48+ZL0h2EfJsg66tGb6NfQg0lOSfVMnzCav8UhgGS7YchR5D6RDlRvnRmvI9thW/pqpIkO1CCLapYmFpcB3jatO1sFzocGyNs6SKAo+fV5ZGbO18IvstV3ckYIamTFDlG/wFoliH9mcUzR4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;b0ab2b6bff3a494a&quot;
        title=&quot;b0ab2b6bff3a494a&quot;
        src=&quot;/static/a4c9b020cd2f23e59192723f02d769e4/1d69c/b0ab2b6bff3a494a.png&quot;
        srcset=&quot;/static/a4c9b020cd2f23e59192723f02d769e4/4dcb9/b0ab2b6bff3a494a.png 188w,
/static/a4c9b020cd2f23e59192723f02d769e4/5ff7e/b0ab2b6bff3a494a.png 375w,
/static/a4c9b020cd2f23e59192723f02d769e4/1d69c/b0ab2b6bff3a494a.png 750w,
/static/a4c9b020cd2f23e59192723f02d769e4/9b379/b0ab2b6bff3a494a.png 951w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构师的能力和经验决定了如何开展架构设计，以及有哪些备选项。你和团队对技术的掌握程度决定了你们的设计方式。如果你们只知道 Ruby on Rails, 那么就很可能会用它来设计架构。如果你手里只有锤子，那你看什么都像钉子。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构设计似乎总在追求热门技术。新硬件、新软件、新设计范式不断涌现，有些将对软件开发产生深远的影响，有些不过是“旧瓶装新酒。你的架构很可能就采用了最流行的设计，如同最时髦的发型。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;541-接受康威定律&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#541-%E6%8E%A5%E5%8F%97%E5%BA%B7%E5%A8%81%E5%AE%9A%E5%BE%8B&quot; aria-label=&quot;541 接受康威定律 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5.4.1 接受康威定律&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;团队的组织结构与合作形式会影响架构设计。康威定律描述了团队组织结构与架构之间的关系，该定律 1967 年由 Melvin Conway 提出，后因《人月神话》的引用而广为人知。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;markdown&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;“任何设计系统的组织………产生的设计必然是该组织沟通结构的写照。&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;同一个组件，三个不同的团队会开发出三种不同的版本。架构中各种元素的边界正是人们沟通边界的技能。康域定律反过来也成立。架构中的通信路径反过来也会影响团队的组织架构。如果你想设计最好的软件，那么你必须准备好重新组织团队。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;55-挖掘关键架构需求&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#55-%E6%8C%96%E6%8E%98%E5%85%B3%E9%94%AE%E6%9E%B6%E6%9E%84%E9%9C%80%E6%B1%82&quot; aria-label=&quot;55 挖掘关键架构需求 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5.5 挖掘关键架构需求&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;关键架构需求往往是隐藏着的，需要挖掘。它们可能隐藏在用户故事里，可能隐藏在业务经理含蓄的描述里，还可能隐藏在利益相关方的提示里。这些人知道自己想要什么，只是不清楚如何表达出来。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;产品待办列表 (backlog）是挖掘关键架构需求的宝藏。几乎每个功能需求都隐含或暗示了某些质量属性。有时用户故事会清楚地描述响应时间、可伸缩性需求，以及处理故障的方式。请将这些信息作为质量属性场景记录下来，以免它们在功能待办列表中丢失。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;与利益相关方沟通，询问他们担心什么，了解他们的关心的问题，告诉他们有哪些潜在的风险，有哪些可能会出现的问题。下面列举了一些用于挖掘关键架构需求的方法：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;GOM 研讨会&lt;/strong&gt;，将业务目标、质量属性响应度量与具体数据要求联系起来。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;利益相关方访谈&lt;/strong&gt;，搞清楚质量属性场景和约束，这对技术利益相关方尤其有效。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;假设清单&lt;/strong&gt;，将隐藏需求明晰化、 公开化。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;微型质量属性研讨会&lt;/strong&gt;，快速有效地定义高优先级的质量属性场景，这对任何类型的项目，以及有不同技能和背景的利益相关方都奏效。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;启动计划书&lt;/strong&gt;，启动一个新项目时，将启动计划书（inception deck）作为检查清单。架构设计是其中的主要内容。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;上述的这几种挖掘关键架构需求的方法，会在后续的章节中介绍。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;56-创建-ASR-工作簿&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#56-%E5%88%9B%E5%BB%BA-ASR-%E5%B7%A5%E4%BD%9C%E7%B0%BF&quot; aria-label=&quot;56 创建 ASR 工作簿 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5.6 创建 ASR 工作簿&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;发现关键架构需求（ASR）后，应该把它们记录在ASR工作簿里。新项目时，ASR 工作簿是一个需要顿繁修改的文档。架构稳定下来后，你就不会再频繁地修改它了，但是会更频繁地参考它。再往后，可执行的测试和源代码可能会取代 ASR 工作簿的部分作用，不过该文档仍是重要的历史记录。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;ASR 工作簿为程序员、测试人员，还有架构师提供系统背景信息。&lt;strong&gt;了解关键架构需求的人越多，所需的架构设计监督就越少。&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;下图是常用的ASR 工作簿大纲。你在做收集需求的计划时，可以把这个大纲作为检查清单。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/415e13766be7585ef54c1dca252f99d3/f3015/589177c5838b4cef.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 76.06382978723406%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmElEQVQ4y52UC2+bMBhF+/9/3bppnTKleUEY0Aaw8dvYZ0rSZksbIm1X+mSMrcO9xvYDN5RzPrfnzvkp5z/v39pbepiFTRGGDtW21EWJfn09gXP+X6AxsFkSrMR0NZNVl/F7TueBXkH7BSUq6vInOYib8z4B3794VceRKEB+fZsWISemacJ5928O35WiQgyPtLJjVa4RvqdXHfu2IuX0Kf6VQ+8D7ljOY50nhsRgBFv9TAieQQ34yRFTwEVLzumU4mOyC7DrBav1lqKsePz2xI/FkvVmR1Vur11naA+SXozMbbcTUBvLqDRKG6RUSK3p2p7995pGaBbPO4r6QC0iZSso6o6YQCjLINXJcUrTGTi3htEG2mWDiYlBakbjUC4hlaF96U6g0USql4F9faATav4vH+WV47BqPmQC4ye0DaeyIdFLQ9uNuDDd34deO6qniqru2WwqiqLF2sA93Yz8t8Nm8QtjA6M06NExhXQ503PJZoHRR0TZ0TUHyu2e7WpHUzZ44++flLu3Tc5YZdGjRkmNVYY0pbvA3/+ol/IU09uXAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ASR 工作簿大纲&quot;
        title=&quot;ASR 工作簿大纲&quot;
        src=&quot;/static/415e13766be7585ef54c1dca252f99d3/1d69c/589177c5838b4cef.png&quot;
        srcset=&quot;/static/415e13766be7585ef54c1dca252f99d3/4dcb9/589177c5838b4cef.png 188w,
/static/415e13766be7585ef54c1dca252f99d3/5ff7e/589177c5838b4cef.png 375w,
/static/415e13766be7585ef54c1dca252f99d3/1d69c/589177c5838b4cef.png 750w,
/static/415e13766be7585ef54c1dca252f99d3/78797/589177c5838b4cef.png 1125w,
/static/415e13766be7585ef54c1dca252f99d3/aa440/589177c5838b4cef.png 1500w,
/static/415e13766be7585ef54c1dca252f99d3/f3015/589177c5838b4cef.png 1804w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;“&lt;strong&gt;了解关键架构需求的人越多，所需的架构设计监督就越少&lt;/strong&gt;”这句话深有感触。在架构设计阶段，如果开发人员都能够参与，并且尽可能掌握更多的细节，这可以极大加强在架构落地过程中成员之间的默契。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;不同的架构可以实现相同的功能。功能本身不足以帮助我们决定如何设计系统。我们还需要知道关键架构需求，尤其是质量属性。当我们挖掘出关键架构需求时，通过工作簿的方式记录在文档中，为团队其他成员提供更多参考信息。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[将阿拉伯数字转换成大写中文]]></title><description><![CDATA[今天同事分享了一个有意思的算法题，感觉挺有意思的。题目来自浙大PAT考试 A1082 Read Number in Chinese。以下是原题： Given an integer with no more than 9 digits, you are supposed to r…]]></description><link>https://zhanglun.github.io/blogs/将阿拉伯数字转换成大写中文/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/将阿拉伯数字转换成大写中文/</guid><pubDate>Thu, 30 Dec 2021 14:10:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;今天同事分享了一个有意思的算法题，感觉挺有意思的。题目来自浙大PAT考试 &lt;strong&gt;A1082 Read Number in Chinese&lt;/strong&gt;。以下是原题：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Given an integer with no more than 9 digits, you are supposed to read it in the traditional Chinese way. Output &lt;code&gt;Fu&lt;/code&gt; first if it is negative. For example, -123456789 is read as &lt;code&gt;Fu yi Yi er Qian san Bai si Shi wu Wan liu Qian qi Bai ba Shi jiu&lt;/code&gt;. Note: zero (&lt;code&gt;ling&lt;/code&gt;) must be handled correctly according to the Chinese tradition. For example, 100800 is &lt;code&gt;yi Shi Wan ling ba Bai&lt;/code&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;给定一个不超过9位的整数，按照汉语阅读的习惯，将其转换成对应的中文。比如输入&lt;strong&gt;100800&lt;/strong&gt;，输出&lt;strong&gt;一十万零八百&lt;/strong&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;先试着来分析一下解题思路。首先，看到这个题目的第一反应是，我们需要提前枚举出对应的中文汉字。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;#39;零&amp;#39;,&amp;#39;一&amp;#39;,&amp;#39;二&amp;#39;,&amp;#39;三&amp;#39;,&amp;#39;四&amp;#39;,&amp;#39;五&amp;#39;,&amp;#39;六&amp;#39;,&amp;#39;七&amp;#39;,&amp;#39;八&amp;#39;,&amp;#39;九&amp;#39;,&amp;#39;十&amp;#39;,&amp;#39;百&amp;#39;,&amp;#39;千&amp;#39;, &amp;#39;万&amp;#39;, &amp;#39;亿&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;虽然数字很大，但是上述的这些汉字已经足够覆盖所有9位数以内的场景了。从两位数的数字开始，数字对应的表达就是“个位数字”+”计数单位”的组合。比如80是八十，102是一百零二，8080是八千零八十，123456是一十二万三千四百五十六。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b3acf1728ab6418f469ea566e03faacf/6c745/fc46a3a2c1d51771.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 67.02127659574468%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAADAUlEQVQ4yy2SV29bRxCF788O8p4XB6ADK0Uy6KJGymosYhN775eXYpEodopF7GIRZUfFX7CLPCxmMbNz9sw5o7RblzTqDmbTCLUbC51bB/dND/XCCfXcN5qFM2pZI42SiWrqkHrJSa94QjFzRK90RiljpKoe0b0+p6aZUFpNJ426ndksQr18RkM7oVcwU3BtUfJuUw7pyVvfc53YQzP9znXimBvHH6jeHW5cW6i+HbIWHdWIHtW5IwBdVCpWBn0fyZQRj3eXYslOMv0Nt+8L/uAuuSsTWfUEl+cT6YwV7cpEOHqAx/eFePyQfMGMlj9FzVlQ1Mwxt5ULoExeO2F/T0ez4SUc3iUU3CMRNxCLHVIonGMw6MhmL3A4tvH7PmM2/YXP+xm3W08qZSDoP0B59+4XTKYtXv5VqdfstFte8nmrzLlcepIJI2fnH0gmjdRrDlrNEN2um+uyhfuBn3LZTPXWRr/noVpxoUQjB+S1U75v0oxHAXgrMJ8m6bRddNqXskkY1+t6eHtRWTyoQInRMAAUmU5CPD2m+PmWY73KoNx13DQbTqaTMLWqjUE/xGQUo9/3MOj7Gd77pb79nhdpYCPAeBSUDMVmVG6stNuXDId+Om0/ivi9VrMzn0VIpYxYLz6S16wEAl+xWP7Gbt+RwieTBmy2bdJpC4mEgWDwK2bzn0Sj+1KOVstJuWRHiYT30bRT4ErqMJ/FaTV9Elw0quqxbCgWTSwfooxHSX6+5rjrXLJeJRj0vSwXMebTMP1eCEWn+xWb7R8JKIrfNyqrRYbJOChHWzxE5dhCq/UyzmSckloKTXnTJInHdYKr/CmaWBu9/jccjh3Wy4QsrldpnjY5VssYi3mM1SImQR/mERkF4OuLSvfOw+uzKrWV+UmQu04A5ejoPcHgrmR4P/CyWWd4esyxXAiQqAQUYOKI+3SS5u0197/rOTnVwyzC848003EMRaxGu+XiaZOSDJeLFOtllvksLJ0Xj0UUIwvjRsMkzz+ycqVEFExFfbNOMBrG+A/PqHdndudLSQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;fc46a3a2c1d51771&quot;
        title=&quot;fc46a3a2c1d51771&quot;
        src=&quot;/static/b3acf1728ab6418f469ea566e03faacf/1d69c/fc46a3a2c1d51771.png&quot;
        srcset=&quot;/static/b3acf1728ab6418f469ea566e03faacf/4dcb9/fc46a3a2c1d51771.png 188w,
/static/b3acf1728ab6418f469ea566e03faacf/5ff7e/fc46a3a2c1d51771.png 375w,
/static/b3acf1728ab6418f469ea566e03faacf/1d69c/fc46a3a2c1d51771.png 750w,
/static/b3acf1728ab6418f469ea566e03faacf/6c745/fc46a3a2c1d51771.png 893w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;因此我们可以推测，这道题中应该与每四位一次的循环操作有关。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;分割法&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%86%E5%89%B2%E6%B3%95&quot; aria-label=&quot;分割法 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;分割法&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;按照四位一轮转换的思路来尝试，先考虑第一种方法：从最后一位开始，每四位数字切隔一次，将数字分成小组，每个小组转换之后再反向合并起来。下面的例子实现的是加上“万”，“亿”，并不是完整代码。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function transform(num) {
    num = num + &amp;#39;&amp;#39;;

    let units = [&amp;#39;十&amp;#39;, &amp;#39;百&amp;#39;, &amp;#39;千&amp;#39;, &amp;#39;万&amp;#39;, &amp;#39;亿&amp;#39;];
    let group = [];
    
    // const transGroup = (g) =&amp;gt; {...}

    for(let i = num.length - 1; i &amp;gt;= 0; i = i -4) { // 反向分割
        group.push(num.slice(Math.max(i-4, 0), i + 1));
    }

    return group.map((item, idx) =&amp;gt; {
        // 转换每一组
        // transGroup(item);
        if (idx &amp;gt;= 1) { // 超过四位之后开始加上“万”、“亿”
            return item + units[idx + 2];
        }

        return item;
    }).reverse();
}

transform(4003);          =&amp;gt; [&amp;#39;4003&amp;#39;]
transform(403);           =&amp;gt; [&amp;#39;403&amp;#39;]
transform(4300);          =&amp;gt; [&amp;#39;4300&amp;#39;]
transform(103000);        =&amp;gt; [&amp;#39;10万&amp;#39;, &amp;#39;3000&amp;#39;]
transform(100303000);     =&amp;gt; [&amp;#39;1亿&amp;#39;, &amp;#39;0030万&amp;#39;, &amp;#39;3000&amp;#39;]
transform(1303101000);    =&amp;gt; [&amp;#39;13亿&amp;#39;, &amp;#39;0310万&amp;#39;, &amp;#39;1000&amp;#39;]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;到这一步其实题目已经解决一半了，接下来要做的事情就是实现四位数字的汉字转换，也就是代码中对应的&lt;code&gt;transGroup&lt;/code&gt;方法。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;...
const trans = (str) =&amp;gt; {
  let result = &amp;#39;&amp;#39;;
  let len = str.length;

  for(let i = 0; i &amp;lt;= len - 1; i++) {
    result+= nums[str[i]]; // 数字转换
    
    if (i &amp;lt; len -1) {  // 最后一位是每一组的各位，之前的每一位都要加上对应的计数单位
      +result += units[len - i - 2] || &amp;#39;&amp;#39;;
    }
  }
  
  return result;
}
...&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;补充了具体的函数实现后调试可以得出一下结果：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;transform(4003);          =&amp;gt; [&amp;#39;四千零百零十三&amp;#39;]
transform(403);           =&amp;gt; [&amp;#39;四百零十三&amp;#39;]
transform(4300);          =&amp;gt; [&amp;#39;四千三百零十零&amp;#39;]
transform(103000);        =&amp;gt; [&amp;#39;一十零万&amp;#39;, &amp;#39;三千零百零十零&amp;#39;]
transform(100303000);     =&amp;gt; [&amp;#39;一亿&amp;#39;, &amp;#39;零千零百三十零万&amp;#39;, &amp;#39;三千零百零十零&amp;#39;]
transform(1303101000);    =&amp;gt; [&amp;#39;一十三亿&amp;#39;, &amp;#39;零千三百一十零万&amp;#39;, &amp;#39;一千零百零十零&amp;#39;]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;可以看到，输出的结果与目标更加接近了。我们再将一些边界case处理好，就能实现数字对中文的转换。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;...
const trans = (str) =&amp;gt; {
  let result = &amp;#39;&amp;#39;;
  let len = str.length;
  let zeroFlag = false;

  for(let i = 0; i &amp;lt;= len - 1; i++) {
    if (parseInt(str[i], 10) === 0) { // 如果数字为0，标记0，进入下一轮循环
      zeroFlag = true;
    } else {
      if (zeroFlag) { // 如果本轮数字不为0，上轮标记为0，则转换数字，重置标记
        +result += nums[0];
        +zeroFlag = false;
      }

      result+= nums[str[i]]; // 数字转换
    
      if (i &amp;lt; len -1) {  // 最后一位是每一组的个位，之前的每一位都要加上对应的计数单位
        +result += units[len - i - 2] || &amp;#39;&amp;#39;;
      }
    }
  }
  
  return result;
}
...&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;再看一下输出的结果&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;transform(4003);          =&amp;gt; [&amp;#39;四千零三&amp;#39;]
transform(403);           =&amp;gt; [&amp;#39;四百零三&amp;#39;]
transform(4300);          =&amp;gt; [&amp;#39;四千三百&amp;#39;]
transform(103000);        =&amp;gt; [&amp;#39;一十万&amp;#39;, &amp;#39;三千&amp;#39;]
transform(100303000);     =&amp;gt; [&amp;#39;一亿&amp;#39;, &amp;#39;零三十万&amp;#39;, &amp;#39;三千&amp;#39;]
transform(1303101000);    =&amp;gt; [&amp;#39;一十三亿&amp;#39;, &amp;#39;零三百一十万&amp;#39;, &amp;#39;一千&amp;#39;]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;最后将数组输出为字符串即可。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;双指针法&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%8C%E6%8C%87%E9%92%88%E6%B3%95&quot; aria-label=&quot;双指针法 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;双指针法&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;比较推荐的解法是双指针解法，网上C语言版本的实现比较多。具体实现如下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;c&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;#include&amp;lt;iostream&amp;gt;
#include&amp;lt;string&amp;gt; 
#include&amp;lt;algorithm&amp;gt;
using namespace std;
/* 题意：将一个整数按照中文读法，输出其拼音 如： 输入 -123456789 输出 Fu yi Yi er Qian san Bai si Shi wu Wan liu Qian qi Bai ba Shi jiu 刚开始看是真的没思路，不晓得咋么去模拟，后面看算法笔记才晓得每个整数可以 从低位开始每四个一组（每组称为节，即个节，万节，亿节），大单位分别是&amp;quot;个（实际不说出来）&amp;quot;、 “万”、“亿”，每组内的数字又有小单位“千”、“百”、“十”、“个（实际不说出来）”。 明确了输出的规则如下： 1、如果数字的某节（例如个节，万节，亿节） 中，某个非零位（千位除外）的高位是零，那么在 需要在该非零位的发音前额外输出一个零。例如8080（ba qian ling ba shi）、8008（ba qian ling ba） 、10808（yi wan ling ba bai ling ba） 2、每节的末尾需要输出万或者亿（个节除外） 注意： 需要注意特判输入是0的时候直接输出ling */
string num[10]={&amp;quot;ling&amp;quot;, &amp;quot;yi&amp;quot;, &amp;quot;er&amp;quot;, &amp;quot;san&amp;quot;, &amp;quot;si&amp;quot;, &amp;quot;wu&amp;quot;, &amp;quot;liu&amp;quot;, &amp;quot;qi&amp;quot;, &amp;quot;ba&amp;quot;, &amp;quot;jiu&amp;quot;};
string wei[3]={&amp;quot;Shi&amp;quot;,&amp;quot;Bai&amp;quot;,&amp;quot;Qian&amp;quot;};
string jie[2]={&amp;quot;Wan&amp;quot;,&amp;quot;Yi&amp;quot;}; 
int main(){
	string str;
	cin&amp;gt;&amp;gt;str;
	int len=str.size();
	int left=0,right=len-1;
	if(str[left]==&amp;#39;-&amp;#39;){
		printf(&amp;quot;Fu&amp;quot;);
		left++;	
	}
	//前导零 
	while(str[left]==&amp;#39;0&amp;#39;&amp;amp;&amp;amp;left&amp;lt;len){
		left++;
	} 
	//特判输入是0的情况 
	if(left==len){
		cout&amp;lt;&amp;lt;&amp;quot;ling&amp;quot;&amp;lt;&amp;lt;endl;
		return 0;	
	}
	while(left+4&amp;lt;=right){//将left和right分别指向第一节的最高位和最低位 
		right-=4;
	}
	
	while(left&amp;lt;len){//依次判断每一节中（四位或者小于四位）
		bool isZero=false,isPrint=false;//isZero==false表示没有零 ，isPrint表示该节没有输出过其他的位（则相应不需要输出Wan或者Yi） 
		while(left&amp;lt;=right){//遍历每一节中的每一位 
			if(str[left]==&amp;#39;0&amp;#39;) isZero=true;
			else{//当前位不为0 
				if(isZero){//高位存在0 
				cout&amp;lt;&amp;lt;&amp;quot; ling&amp;quot;;
				isZero=false;
			} 
			if(left&amp;gt;0)cout&amp;lt;&amp;lt;&amp;quot; &amp;quot;;//只要不是首位，后面每一位输出之前都要输出空格
			cout&amp;lt;&amp;lt;num[str[left]-&amp;#39;0&amp;#39;];//输出当前位的数字
			isPrint=true;//说明本节至少输出过一位 
			if(left!=right){
				//除本节的个位以外，都需要输出十百千 
				cout&amp;lt;&amp;lt;&amp;quot; &amp;quot;&amp;lt;&amp;lt;wei[right-left-1]; 
			}	 
			}
			left++;
		}
		if(isPrint&amp;amp;&amp;amp;right!=len-1){//只要不是个节，则相应输出Wan或者Yi 
			cout&amp;lt;&amp;lt;&amp;quot; &amp;quot;&amp;lt;&amp;lt;jie[(len-1-right)/4-1]; 
		} 
		right+=4;//输出下一节 
	} 

	return 0;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;按照这个思路，我用JavaScript也实现了一遍。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function transform(num) {
    let nums = [&amp;#39;零&amp;#39;,&amp;#39;一&amp;#39;,&amp;#39;二&amp;#39;,&amp;#39;三&amp;#39;,&amp;#39;四&amp;#39;,&amp;#39;五&amp;#39;,&amp;#39;六&amp;#39;,&amp;#39;七&amp;#39;,&amp;#39;八&amp;#39;,&amp;#39;九&amp;#39;]
    let units = [&amp;#39;十&amp;#39;,&amp;#39;百&amp;#39;,&amp;#39;千&amp;#39;, &amp;#39;万&amp;#39;, &amp;#39;亿&amp;#39;];
    let result = &amp;#39;&amp;#39;;

    num = (num + &amp;#39;&amp;#39;);
    let len = num.length;
    let left = 0;
    let right = len - 1;

    if (num[0] === &amp;#39;-1&amp;#39;) {
        result += &amp;#39;负&amp;#39;;
        left++;
    }
    while (left + 4 &amp;lt;= right) {
        right -= 4;
    }

    while (left &amp;lt; len) {
        let zeroFlag = false;
        let isPrint = false;

        while(left &amp;lt;= right) {
            if (left &amp;gt; 0 &amp;amp;&amp;amp; num[left] == 0) { // 遇到0时，设置zeroFlag 为true，指针往后移动一位
                zeroFlag = true;
            } else {
                if (zeroFlag) {
                    result += nums[0]; //补零
                    zeroFlag = false;
                }

                result += nums[num[left]];

                isPrint = true; // 每一组中存在至少一个不为0的数字

                if (left !== right) { // 补充每一位的单位
                    result += units[right - left - 1];
                }
            }

            left++;
        }

        // 一轮结束时，如果存在至少一个不为0的数字 添加单位
        if (isPrint &amp;amp;&amp;amp; right !== len -1) {
            result += units[(len - 1 - right) / 4 + 2]; 
        }

        right += 4;
    }

    console.log(&amp;#39;result: &amp;#39;, result);
    return 0;
}

// 4003 四千零三
// 403 四百零三
// 4300 四千三百
// 103000 十万零三千
// 100303000 一亿零三十万三千
// 1303101000 十三亿零三百一十万一千

transform(4003);
transform(403);
transform(4300);
transform(103000);
transform(100303000);
transform(1303101000);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;一行实现&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%80%E8%A1%8C%E5%AE%9E%E7%8E%B0&quot; aria-label=&quot;一行实现 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;一行实现&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;同事何米酥甚至用一行代码就搞定了&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const trans = (str) =&amp;gt; String(str).split(/(?=(?:\d{4})+(?!\d))/g).map((chunk, i, chunkArr) =&amp;gt; chunk.split(&amp;#39;&amp;#39;).reduce(([flag, isPrint, print], c, ii, singleArr) =&amp;gt; [!!i &amp;amp;&amp;amp; (c === &amp;#39;0&amp;#39;), !!(isPrint || (c - &amp;#39;0&amp;#39;)), c === &amp;#39;0&amp;#39; ? print : print + (flag ? &amp;#39;零&amp;#39; : &amp;#39;&amp;#39;) + [&amp;#39;零&amp;#39;, &amp;#39;一&amp;#39;, &amp;#39;二&amp;#39;, &amp;#39;三&amp;#39;, &amp;#39;四&amp;#39;, &amp;#39;五&amp;#39;, &amp;#39;六&amp;#39;, &amp;#39;七&amp;#39;, &amp;#39;八&amp;#39;, &amp;#39;九&amp;#39;][c] + [&amp;#39;&amp;#39;, &amp;#39;十&amp;#39;, &amp;#39;百&amp;#39;, &amp;#39;千&amp;#39;][singleArr.length - 1 - ii]], [false, false, &amp;#39;&amp;#39;])[2] + (i !== chunkArr.length - 1 ? [&amp;#39;千&amp;#39;, &amp;#39;万&amp;#39;, &amp;#39;亿&amp;#39;][chunkArr.length - 1 - i] : &amp;#39;&amp;#39;)).join(&amp;#39;&amp;#39;)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;这个题目的关键在于找到数字转换的规律，按照四位一组的方式处理。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[《架构师修炼之道》摘录04-换位思考]]></title><description><![CDATA[本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。 全书整体分为三个部分 第一部分介绍软件架构的基础知识和架构师必备的设计思维 第二部分讲解架构师需要掌握的核心技能和知识 第三部分讨论一系列…]]></description><link>https://zhanglun.github.io/blogs/《架构师修炼之道》摘录04-换位思考/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/《架构师修炼之道》摘录04-换位思考/</guid><pubDate>Fri, 24 Dec 2021 05:34:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;全书整体分为三个部分&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第一部分介绍软件架构的基础知识和架构师必备的设计思维&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第二部分讲解架构师需要掌握的核心技能和知识&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第三部分讨论一系列使用的架构设计方法&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;前两部分适合从头到尾通读，第三部分用于参考和检索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;第四章的标题是“换位思考”，本章主要阐述如何从利益相关方的角度出发，换位思考，理解业务目标，为后续的架构设计铺路。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;开发软件是为了服务于人，因此必须理解受软件影响的人。只有理解他们的需求，才能搞清楚到底要解决什么问题。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;与软件有关、受软件影响的人称之为利益相关方。架构师有责任确定利益相关方并了解他们的需求。利益相关方对系统的期望将直接或间接影响我们的设计方式。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;换位思考也叫同理心，是推动设计的引擎。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;41-找合适的人谈&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#41-%E6%89%BE%E5%90%88%E9%80%82%E7%9A%84%E4%BA%BA%E8%B0%88&quot; aria-label=&quot;41 找合适的人谈 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;4.1 找合适的人谈&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;用户是重要的利益相关方，开发系统和维护系统的人也是。通常情况下，利益相关方不止一个人。与团队合作不同于与个人合作。每个人都有自己的看法，同一个团队也会有相左的意见。所以必须设法了解整个团队的想法。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;利益相关方关系我们开发的软件，他们将会影响架构设计。在要求利益相关方参加未来的设计研讨会时，需要先确定他们是谁。这时候得用上利益相关方关系图（stakeholder map)。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;42-创建利益相关方关系图&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#42-%E5%88%9B%E5%BB%BA%E5%88%A9%E7%9B%8A%E7%9B%B8%E5%85%B3%E6%96%B9%E5%85%B3%E7%B3%BB%E5%9B%BE&quot; aria-label=&quot;42 创建利益相关方关系图 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;4.2 创建利益相关方关系图&lt;/h2&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;下图是书中的一个案例。在实际工作中，你可以按照自己喜欢的方式来构建关系图。形式不重要，重要的是能够清楚表达利益相关方的关系&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 465px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/aef4b1b9047da4bd39a224414eb89a09/9ff85/e979b4777e53e897.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 101.59574468085107%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD4ElEQVQ4yz1UWXPbVBjVH2XgoZBOpzAUKAMPNNNgyN5C0ilZmtQ0zuJdsvZdulebJdlJ2h90mO9zysM3lqV7j852pdzf36IsJeZ1htu7Bp8+LXF332KxrNAsSrQ8FeqmQF6myPKEJ02j1YgIUeRD1zUMhzdQ2maO/b0tdDZewA9sBk3SAMvbGsvbOYMKGfHILEbxAFoUArqu4vj4LU5PjqBpU4xGAyjLZYtu9x12tv+AkCHKSiJOfBSlQCpCBnn9agedzjr6/R4D9weXiGIPZ2fHeLz2NdbWHjGGbqhQ2raGkAk838bdxxb3HxcsmaQWRYqyFDg82Mevv/zIgHmRQogQQWgjCB1sbnawsfECk0kfM30CpWnmaJoK8zrnxXmeoGkLSBmztCTx4XkmNHUE1zX4BbTG9y1MJgMYxhSTcR+D/hUGw2soi+Wc5dHmIHT59/M9YkAW1HWORVsyM8+3YNkaksRDFDmIQgdh4MBzTWjaGErdFgwgRIxqnrF/5OXR0SGi2OUQUhEwE0OfQuYxp22aKo+qDnFz3cNwcIUZAZJUMp5MzvKY/Qsjl0NK0wBVJZltUYmHlAVcz1ix8kw4jo735yfonr/DZHQDhSSZ5gyeZ3FdqG9pGiKKXHiugaYtUVaCN5Lptj1DGDqII5fl+r4Jz9H5v2lMoRQFlbrkYKhbxDQvEh5iQwFxOLGHwLd5U57FCIPV9dbm76zm6vJfuI5OgIL9o5nXBSx7xkzJT8cxmA3JJXACkSKAFCHiyIM6HeLpk8f46ssvsLP9JwLfgkILLVuHpk1gWTNOlqrSNAUnl8Q++0j3fc9ERh30LfaQenrx4T12d7e4Qq5jrADJt7rJEcceVyRNAmQigkhDLNoKMg3hexb7RJ2jNInlTB1D16ZwbQPT8QCT8QBKlqdc6CQJWGrblpiTXHvGGwWDmchkhCKPkckQtqWhyFNkMuaXEzN6Ie1RpEyxt7eNly/XOUVKleQeHrzC85++x1+vdxmMgpAiYh8JkK4JjGY86mPYv4ZtzaBkWYr19d+w9s0jXPS6LL2pC5yfHeOHZ0+xs9Vh32hI5sHf+9DUITMkMArH1FW+tkwNSlVlGI8HePPmgI/WvMqQZwkvmE4GXBW6/lyVn58/w+nJW1SlYJb0/EP3jJ85tg6F/KPuJWmIqpS8kAC06YgTts0ZTEPjl5iGitOTf9C76LK3tPay18V33z5hv6n87CGdFvpi8zErUpZTFoK9o7Tlg1xBwSX+/9Uqi4S7uLu9yenT2VbyfFVaGiozFZ3YMJhcBSHSgIcY08eDFIUPR09Tx+hf9zC46UHTRvgPk5Trr0JCfxoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;e979b4777e53e897&quot;
        title=&quot;e979b4777e53e897&quot;
        src=&quot;/static/aef4b1b9047da4bd39a224414eb89a09/9ff85/e979b4777e53e897.png&quot;
        srcset=&quot;/static/aef4b1b9047da4bd39a224414eb89a09/4dcb9/e979b4777e53e897.png 188w,
/static/aef4b1b9047da4bd39a224414eb89a09/5ff7e/e979b4777e53e897.png 375w,
/static/aef4b1b9047da4bd39a224414eb89a09/9ff85/e979b4777e53e897.png 465w&quot;
        sizes=&quot;(max-width: 465px) 100vw, 465px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构是为客户服务的，如何确保架构能够为客户带来价值呢？通用电气的软件架构师的办法是运用 &lt;strong&gt;“ 以客户为中心 ”&lt;/strong&gt; 的设计流程。先搞清楚谁是客户，他们想做什么；然后将系统按照客户的任务进行划分。架构师需要了解每项任务的启动步骤，以及哪里容易出错。这样，由表及里，确保深层结构能实现客户价值，通用电气将其称之为 &lt;strong&gt;“ 客户体验架构 ”&lt;/strong&gt;，设计流程如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;观察客户在正常流程下如何完成任务，向对方提问，确定对客户至关重要的事项，包括功能需求和质量属性需求。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;围绕客户需求设计系统并记录在原型里。原型应尽可能具有交互性，而不仅仅是流程图。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;尽早与客户一起评审原型，确保对方真正了解新系统的变化，以及这些变化对他们的影响。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;根据客户评审会上的反馈修改调整架构设计。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;这让我想到了一些B端系统的场景。参与的系统中有服务于开发人员的云平台系统，也有面向普通人的商家系统。这两类人群在工作方式、生活场景、对技术理解程度等多方面都有不同。但他们都是某一个系统的客户，在设计开发对应系统时，采用“以客户为中心”的设计流程来做。如果按照通用电气的设计流程来做，便可以在架构设计工作开始之前，了解到不同用户群体的操作习惯和工作方式，从而在设计阶段为我们提供更多帮助。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;43-了解业务目标&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#43-%E4%BA%86%E8%A7%A3%E4%B8%9A%E5%8A%A1%E7%9B%AE%E6%A0%87&quot; aria-label=&quot;43 了解业务目标 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;4.3 了解业务目标&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;所有的软件系统的开发都是为了满足业务目标。讨论系统的质量属性，权衡取舍、技术债务都需要以业务目标为基础。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;业务目标是架构的主要驱动因素。当多个需求发生冲突时，可以根据业务目标对他们进行优先级排序。描述业务目标应该使用简单明了的文字，从需求出发，阐明利益相关方想从软件系统中获得什么。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;主体&lt;/th&gt;
&lt;th&gt;目标&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;个人&lt;/td&gt;
&lt;td&gt;增加收入，扩大知名度，享受生活，获取知识&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;组织&lt;/td&gt;
&lt;td&gt;增加营收，实现利润最大化，发展业务，成为市场领导者，提高稳定性，进入新市场，击败竞争对手&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;员工&lt;/td&gt;
&lt;td&gt;获得工作意义，获取知识，帮助用户，成为专家&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;开发团队&lt;/td&gt;
&lt;td&gt;提升指定的质量属性，降低成本，增加新功能，实施标准，缩短上市时间&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;国家/政府&lt;/td&gt;
&lt;td&gt;安全、福利、社会责任、公民遵纪守法&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;431-记录业务目标&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#431-%E8%AE%B0%E5%BD%95%E4%B8%9A%E5%8A%A1%E7%9B%AE%E6%A0%87&quot; aria-label=&quot;431 记录业务目标 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;4.3.1 记录业务目标&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;清晰的业务目标应该是可衡量的，有明确的成功标准。这样的业务目标至少包含三个方面：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;主体&lt;/strong&gt; 特定的人或角色。如果利益相关方有名称，就加上名称。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;结果&lt;/strong&gt; 用可衡量的结果表达利益相关方的需求。如果系统成功，会带来哪些变化？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;背景&lt;/strong&gt; 背景信息有助于我们进一步理解需求。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;大多数系统只有三到五给业务目标。与多个利益相关方合作时，一定要标注目标的相对重要性，比如写上必须有（must have)或者最好有（nice to have)能起很好的效果。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;432-帮助描述业务目标&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#432-%E5%B8%AE%E5%8A%A9%E6%8F%8F%E8%BF%B0%E4%B8%9A%E5%8A%A1%E7%9B%AE%E6%A0%87&quot; aria-label=&quot;432 帮助描述业务目标 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;4.3.2 帮助描述业务目标&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;虽然利益相关方通常知道他们在做什么，但大部分人很难将需求用可衡量的方式描述出来。架构师应该准备一些简单的模板，帮助其表达需求。比如观点填空：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;（...）希望（...），因为（...）&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;举个例子：运营希望可以一键导入数据，因为人工填写数据很浪费时间&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;架构师应该与产品经理或者其他业务相关方合作，确定系统的业务目标。这些人通常可以毫不费力地描述系统的业务目标。如果他们也不能清楚地描述业务目标，你们应该一起搞清楚。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;这里可不是所谓的“技术驱动赋能业务”。所谓“赋能”&lt;strong&gt;是用更高级的手段解决问题。&lt;strong&gt;目前还处于确&lt;/strong&gt;定业务目标&lt;/strong&gt;的阶段。在我看来，这是从项目负责人的角度出发，帮助确定业务目标。为后续架构设计扫清模棱两可含糊不清的问题。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;换位思考很重要，只有清楚了利益相关方是谁以及他们的预期，我们才能做出更好的设计决策。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;理解业务目标也很重要。只有理解了业务目标，团队才能清楚架构设计的目标。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[JavaScript深拷贝的新方法-structureClone]]></title><description><![CDATA[对象拷贝这个话题算是老生常谈了，从浅拷贝到深拷贝，从最简单的JSON.stringfy()到递归遍历赋值，作为面试八股文的常客，字节的朋友甚至写出了惊艳面试官的深拷贝，不得不佩服。 通常在项目开发中，遇到深拷贝的场景，一般有多种处理方式： 使用其他第三方库 使用有前人“沉淀”的…]]></description><link>https://zhanglun.github.io/blogs/JavaScript深拷贝的新方法-structureClone/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/JavaScript深拷贝的新方法-structureClone/</guid><pubDate>Sat, 18 Dec 2021 02:30:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;对象拷贝这个话题算是老生常谈了，从浅拷贝到深拷贝，从最简单的JSON.stringfy()到递归遍历赋值，作为面试八股文的常客，字节的朋友甚至写出了&lt;a href=&quot;https://juejin.cn/post/6844903929705136141&quot; class=&quot;link-underline&quot;&gt;惊艳面试官的深拷贝&lt;/a&gt;，不得不佩服。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;通常在项目开发中，遇到深拷贝的场景，一般有多种处理方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;使用其他第三方库&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;使用有前人“沉淀”的类库&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;自己再“实现”一次&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;现在可以使用一个内置的方法来解决深拷贝的问题，它就是今天的主角：structuredClone()。在本文发布时，各浏览器的nightly版本中已经实现了这个API，在Firefox 94的版本中甚至已经是稳定状态了。Node 在v17的版本中&lt;a href=&quot;https://github.com/nodejs/node/pull/39759&quot; class=&quot;link-underline&quot;&gt;实现了这个API&lt;/a&gt;，可以直接使用了。让我们对它进行一些些简单的探索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在讨论JavaScript中的对象的拷贝问题时，通常是从浅拷贝和深拷贝两个角度来讨论。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;浅拷贝&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%B5%85%E6%8B%B7%E8%B4%9D&quot; aria-label=&quot;浅拷贝 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;浅拷贝&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;对于基本类型来说，拷贝就是复制对应的值，在内存中新开辟一块地址保存这个值。而引用类型的浅拷贝则是复制其内存地址。如果被拷贝对象的属性中有其他引用类型，当拷贝后的对象对内部的引用类型发生变化之后，原始对象也会受到影响。我们使用解构来举个简单的例子：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;typescript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const myOriginal = {
  someProp: &amp;quot;with a string value&amp;quot;,
  anotherProp: {
    withAnotherProp: 1,
    andAnotherProp: true
  }
};

const myShallowCopy = {...myOriginal};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;修改或者添加拷贝结果的属性时，原对象不受影响。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;typescript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;myShallowCopy.aNewProp = &amp;quot;a new value&amp;quot;;
console.log(myOriginal.aNewProp)
// ^  `undefined`&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;但是，添加或者修改内部嵌套的属性时，两个对象会同步修改。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;typescript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;myShallowCopy.anotherProp.aNewProp = &amp;quot;a new value&amp;quot;;
console.log(myOriginal.anotherProp.aNewProp) 
// ^ logs `a new value`&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;深拷贝&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%B7%B1%E6%8B%B7%E8%B4%9D&quot; aria-label=&quot;深拷贝 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;深拷贝&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;深拷贝的逻辑是将一个对象的属性逐一复制，当属性的值是一个对象时，创建一个新的对象，重复复制的过程，直到属性值为基本类型。需要所有的对象最终都的内存地址都是全新的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在不使用类库的情况下，使用 JSON API 可以快速实现深拷贝：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;typescript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const myDeepCopy = JSON.parse(JSON.stringify(myOriginal));&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这个方法简单易用，而且V8针对 JSON.parse()做过优化，尽可能提高JSON.parse()的执行效率。但是它也有一些局限性：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;无法处理循环引用&lt;/strong&gt;：当对象存在循环引用时，JSON.stringify()会抛出错误&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;不支持一些内置的类型&lt;/strong&gt;：如果属性中包含一些内置的对象类型，JSON.stringify()执行时，会去掉一些属性值，最后输出的是”{}“字符串，比如： Map, Set, Date, RegExp 等&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;丢弃函数:&lt;/strong&gt; 如果属性值是一个函数，JSON.stringify 会直接抛弃这个属性&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;在 structuredClone 出现之前，JSON API 似乎是唯一一个解决深拷贝问题的API, 虽然不太完美。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;StructuredClone&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#StructuredClone&quot; aria-label=&quot;StructuredClone permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;StructuredClone&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在HTML Sepc 中通过了&lt;a href=&quot;https://html.spec.whatwg.org/multipage/structured-data.html#dom-structuredclone&quot; class=&quot;link-underline&quot;&gt;StructuredClone()&lt;/a&gt;的提案，帮助我们在一些场景中方便的复制结构化对象。用法非常简单，很轻松地就能解决深拷贝的问题。在内部实现中，通过维护一个记录引用访问状态的Map来实现对循环引用的支持。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;typescript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const myDeepCopy = structuredClone(myOriginal);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;还支持第二个参数： transfter，这个参数是可选的，可以将被复制对象中的ArrayBuffer等可转换的对象转移到新的对象中，而不是复制一份，比如：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;typescript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var uInt8Array = new Uint8Array(1024 * 1024 * 16); // 16MB
for (var i = 0; i &amp;lt; uInt8Array.length; ++i) {
  uInt8Array[i] = i;
}

const transferred = structuredClone(uInt8Array, { transfer: [uInt8Array.buffer] }).
console.log(uInt8Array.byteLength);  // 0
console.log(transferred.byteLength); // 16MB&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在复制时，将 uInt8Array 的 buffer 对象转移到 transferred 中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;除了我们显示的调用这个API之外，它也经常在内部被其他的API调用。比如使用IndexedDB存储数据时，通过postMessage在Worker之间传递消息或者执行其他一些涉及到复制对象相关的API。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;相比JSON API，在深拷贝这件事情上，structuredClone有一些优势，比如支持循环引用，对数据类型的支持能力更加健壮，甚至执行效率上又有一些优势。但是structuredClone本身亦有一些限制：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;函数不能复制，抛出&lt;code&gt;DataCloneError&lt;/code&gt;的错误类型&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;DOM 节点不能复制，抛出&lt;code&gt;DataCloneError&lt;/code&gt;的错误类型&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;其他明确不会保留的属性：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;RegExp中的lastIndex不会被保留&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;属性描述符，setter, getter 等其他类似的特性不会复制。如果一个对象通过属性描述符标记为只读，复制之后将会变成可读可写，因为可读可写是默认值&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;原型链不会被遍历，也不会被复制&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;如果这些限制不影响你的使用，structuredClone将会是一个不错的选择。反之你也可以继续使用第三方库来解决深拷贝的问题。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;参考&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%82%E8%80%83&quot; aria-label=&quot;参考 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://web.dev/structured-clone/&quot; class=&quot;link-underline&quot;&gt;https://web.dev/structured-clone/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/structuredClone#browser_compatibility&quot; class=&quot;link-underline&quot;&gt;https://developer.mozilla.org/en-US/docs/Web/API/structuredClone#browser_compatibility&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm#see_also&quot; class=&quot;link-underline&quot;&gt;https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm#see_also&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[【译】防御性CSS]]></title><description><![CDATA[原文：https://ishadeed.com/article/defensive-css/ 有时候，我们希望有一种方式来避免遇到某种CSS的问题或者行为。要知道，内容是动态的，网页上的内容会发生变化，从而增加了出现CSS问题或者一些奇怪行为的可能性。 防御性CSS是一个片段的…]]></description><link>https://zhanglun.github.io/blogs/【译】防御性CSS/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/【译】防御性CSS/</guid><pubDate>Sat, 11 Dec 2021 04:00:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;原文：&lt;a href=&quot;https://ishadeed.com/article/defensive-css/&quot; class=&quot;link-underline&quot;&gt;https://ishadeed.com/article/defensive-css/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;有时候，我们希望有一种方式来避免遇到某种CSS的问题或者行为。要知道，内容是动态的，网页上的内容会发生变化，从而增加了出现CSS问题或者一些奇怪行为的可能性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;防御性CSS是一个片段的集合，可以帮助你编写受保护的CSS。换句话说，你在未来会遇到更少的问题。如果你按照我的博客，你可能会读到我不久前写的一篇文章，它被称为“以防万一的心态”。这篇文章是在它的基础上写的，并将是一个持续的片段列表。如果你有任何建议，请随时让我知道。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Flexbox-Wrapping&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Flexbox-Wrapping&quot; aria-label=&quot;Flexbox Wrapping permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Flexbox Wrapping&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;CSS flexbox 是现在最有用的CSS布局特性之一。在一个选择器上添加 &lt;code&gt;display: flex&lt;/code&gt;，让子项挨着排序，这很诱人。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;问题是，当空间不足时，那些子项默认不会插入到一个新的行。我们需要使用 flex-wrap：wrap 来改变这个行为。下面是一个典型的例子。我们有一组需要挨着排序的选项。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.options-list {
    display: flex;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b61c66dddd00a7fb947c34455f0e10c4/05244/9728892ad7603d99.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 38.297872340425535%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1klEQVQoz62RPU4EMQyF5/7noaDiAJRb0iEoYEgQO7NO7BnbD8Xzo2UBsQWRPjl2nJeXpCP+gBtcVfEfdKVUEJGXUnBOrXWn5US0rEWkvXZJtzb6tsHM4iRhhogErebuEc095q3n/KBdcHW0C7ahOuO1f0NKGalPi5gvor6Ju391vvLNYRunOuH28Aw6Tcj3L5AquHm8Q5YB48MB1D/Bgbj+VYKzKt6PI0wNQx7g5khDxmyKMh4xCUffVQ453o4hXGNe1ygsQWWOvEG/Odx++adf+4tLl5/v8m3TxMOb3wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;9728892ad7603d99&quot;
        title=&quot;9728892ad7603d99&quot;
        src=&quot;/static/b61c66dddd00a7fb947c34455f0e10c4/1d69c/9728892ad7603d99.png&quot;
        srcset=&quot;/static/b61c66dddd00a7fb947c34455f0e10c4/4dcb9/9728892ad7603d99.png 188w,
/static/b61c66dddd00a7fb947c34455f0e10c4/5ff7e/9728892ad7603d99.png 375w,
/static/b61c66dddd00a7fb947c34455f0e10c4/1d69c/9728892ad7603d99.png 750w,
/static/b61c66dddd00a7fb947c34455f0e10c4/78797/9728892ad7603d99.png 1125w,
/static/b61c66dddd00a7fb947c34455f0e10c4/aa440/9728892ad7603d99.png 1500w,
/static/b61c66dddd00a7fb947c34455f0e10c4/05244/9728892ad7603d99.png 1752w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当空间较少时，会出现水平滚动条。这应该是预料之中的，实际上并不是一个“问题”。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7150774d32cbdcd49135adeee58d65de/56e36/cb99fca1eb785489.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 30.851063829787233%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxklEQVQY042RzQrCMBCE+/6PJnrQg4oeRFBQMU2aZnfzgx1poraioIchm2TnyzKpyJwggZBiQozxixJSKur3IYZyHsLX/oolgIlBRB9iZlhdQ6krrlqh6zp08VbufADxp6/KBRfzU5RXAovHbHeBMYxmpcBeMDnNoVsDtVmg1QosAqbBX41B/HqxAIkF62MN7xPsXkOix/SwyMDzdpmn74H0Gzg0uMbA2gZOHjlTici6oe9/oAja1sE5lwPvP0b8+0TjugfeAaqLz5+m3BKXAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;cb99fca1eb785489&quot;
        title=&quot;cb99fca1eb785489&quot;
        src=&quot;/static/7150774d32cbdcd49135adeee58d65de/1d69c/cb99fca1eb785489.png&quot;
        srcset=&quot;/static/7150774d32cbdcd49135adeee58d65de/4dcb9/cb99fca1eb785489.png 188w,
/static/7150774d32cbdcd49135adeee58d65de/5ff7e/cb99fca1eb785489.png 375w,
/static/7150774d32cbdcd49135adeee58d65de/1d69c/cb99fca1eb785489.png 750w,
/static/7150774d32cbdcd49135adeee58d65de/78797/cb99fca1eb785489.png 1125w,
/static/7150774d32cbdcd49135adeee58d65de/aa440/cb99fca1eb785489.png 1500w,
/static/7150774d32cbdcd49135adeee58d65de/56e36/cb99fca1eb785489.png 1750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;注意，子项依然是挨在一起的。要修复这个问题，我们需要允许flex换行。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.options-list {
    display: flex;
    flex-wrap: wrap;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/03e27aa7aac3c16c37d92c701ed31591/56e36/4273d7142ec893be.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 36.17021276595745%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuklEQVQoz52Qy2rDQAxF/f8f1W1XWQe6KaWF0qT2xE0lzUgen+AYJ5AaSrI4XCGkq0cj6RMrQnjg7isEEVfWa640agUVRUT+oKr8pI62/aZNLbVWzGy1dqE5Bzo3L8hZBbXM5nVH3ytpu6dGpZRyGbZGc5uYJ82GosbLR0LVObwdqMNIzvkBw2m76Q0m7OSLGBzt99TByY9tKGQ1ut/E0/sz5ka33eB6pHjcb7jo9K/qA+M4kj1m/efkE0bxHnA78ouRAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;4273d7142ec893be&quot;
        title=&quot;4273d7142ec893be&quot;
        src=&quot;/static/03e27aa7aac3c16c37d92c701ed31591/1d69c/4273d7142ec893be.png&quot;
        srcset=&quot;/static/03e27aa7aac3c16c37d92c701ed31591/4dcb9/4273d7142ec893be.png 188w,
/static/03e27aa7aac3c16c37d92c701ed31591/5ff7e/4273d7142ec893be.png 375w,
/static/03e27aa7aac3c16c37d92c701ed31591/1d69c/4273d7142ec893be.png 750w,
/static/03e27aa7aac3c16c37d92c701ed31591/78797/4273d7142ec893be.png 1125w,
/static/03e27aa7aac3c16c37d92c701ed31591/aa440/4273d7142ec893be.png 1500w,
/static/03e27aa7aac3c16c37d92c701ed31591/56e36/4273d7142ec893be.png 1750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;使用flexbox时，一般的经验法则是允许换行，除非你想要一个滚动条。这是另一回事，但尽量使用flex-wrap 来避免意外的布局行为（在我们的例子中，是水平滚动）。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Spacing&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Spacing&quot; aria-label=&quot;Spacing permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Spacing&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;开发者需要考虑不同内容的长度。这意味着，间距需要添加到组件中，即使它看起来不需要&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0045d7ca9f88e659ae0e4a52101f49ee/56e36/e33b37f58dc5f0c6.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 35.638297872340424%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAApklEQVQoz42Qyw6DIBBF+f9P7FY3LIwGeYnAbS7NGKSJ7SQnM8C8uMroF3yyKLki59w4z/OG3P+DCjHB+wDn3EWMESklHMfR8N5/EUJovq8jyjnbAnmk11pjmibM89xisVrrhTQYB6n+INsZY7AsC9Z1xbZtbRt+vbdSym2Jx4Z9Igv5ferDWLSicdDPhpK07zus/chBLzmMCYc8bjjqODLe9xr2b2/T6iCHZ++PSQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;e33b37f58dc5f0c6&quot;
        title=&quot;e33b37f58dc5f0c6&quot;
        src=&quot;/static/0045d7ca9f88e659ae0e4a52101f49ee/1d69c/e33b37f58dc5f0c6.png&quot;
        srcset=&quot;/static/0045d7ca9f88e659ae0e4a52101f49ee/4dcb9/e33b37f58dc5f0c6.png 188w,
/static/0045d7ca9f88e659ae0e4a52101f49ee/5ff7e/e33b37f58dc5f0c6.png 375w,
/static/0045d7ca9f88e659ae0e4a52101f49ee/1d69c/e33b37f58dc5f0c6.png 750w,
/static/0045d7ca9f88e659ae0e4a52101f49ee/78797/e33b37f58dc5f0c6.png 1125w,
/static/0045d7ca9f88e659ae0e4a52101f49ee/aa440/e33b37f58dc5f0c6.png 1500w,
/static/0045d7ca9f88e659ae0e4a52101f49ee/56e36/e33b37f58dc5f0c6.png 1750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在这个例子中，在右边有一个标题和一个操作按钮。现在看起来很好。但是，让我们来看看当标题更长时会发生什么。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/202fcfb9e876497f1253fb18714d4704/56e36/6982c5c76b88198c.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 35.638297872340424%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAs0lEQVQoz42Q2wqEMAxE+/+fuA8+KVIRlNqbtW2W6ZKSdVlQOExqJkMbZfSLfLJUcqWcc+O6rr9wn713VIiJvA/knGt47ynGSOd5dmVSShRCaP+hPCNRztmvMKjWmuZ57kzTROM4NpZloWEYaF3XHoo5RskDmjAZY2jbNtr3vXMcR+vhubgh9FEgzFxDSyltN7VWwgfl+lEgK25k7WcdUPagBtinnPkJlGHSIPuyd987B74BaEwevKR6rYsAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;6982c5c76b88198c&quot;
        title=&quot;6982c5c76b88198c&quot;
        src=&quot;/static/202fcfb9e876497f1253fb18714d4704/1d69c/6982c5c76b88198c.png&quot;
        srcset=&quot;/static/202fcfb9e876497f1253fb18714d4704/4dcb9/6982c5c76b88198c.png 188w,
/static/202fcfb9e876497f1253fb18714d4704/5ff7e/6982c5c76b88198c.png 375w,
/static/202fcfb9e876497f1253fb18714d4704/1d69c/6982c5c76b88198c.png 750w,
/static/202fcfb9e876497f1253fb18714d4704/78797/6982c5c76b88198c.png 1125w,
/static/202fcfb9e876497f1253fb18714d4704/aa440/6982c5c76b88198c.png 1500w,
/static/202fcfb9e876497f1253fb18714d4704/56e36/6982c5c76b88198c.png 1750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;注意到文字离操作按钮太近了吗？你可能正在考虑换行，但是我将在另外一节中讨论这个问题。现在，让我们把注意力放在间距上。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果标题有间距和文本截断，我们就不会看到这个问题。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.section__title {
    margin-right: 1rem;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5848f29eeefe28b93c078238bd73bd13/56e36/3be09f7f38cf839d.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.85106382978723%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEUlEQVQoz5VSa2+EIBD0///Dfrqc9dVTa1VgZYGbZrEYrrleLMlkH7CTySyFmhqQ1XDswMwRIYQM/ujncM497ReGLIw20Fof6PsebdOg/ejRl2/w6w0BgPcO3vsIpdTDTEIRE6NhzE66bRvmecYwDBinL3x2V/A6INzxcERhmpGYUOSFXBIRlmWJpOu6gFkGCcw2WpAUypG3pwjzh5JLFOV7vveF9JTCRCJIJHkdQRqk1WvC/KLrOpRliaqqUNc12rZF0zSxd32vMXcX6NsFmuyxjD8VJhWyxbTJpI6thQ8BblPwtIJoO+fhNE0YxzFGqYXY2n0p8b8597+lHF79QHpCeHhqDBzzOQ+ffdZX+E36DShxVLNaHm2aAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;3be09f7f38cf839d&quot;
        title=&quot;3be09f7f38cf839d&quot;
        src=&quot;/static/5848f29eeefe28b93c078238bd73bd13/1d69c/3be09f7f38cf839d.png&quot;
        srcset=&quot;/static/5848f29eeefe28b93c078238bd73bd13/4dcb9/3be09f7f38cf839d.png 188w,
/static/5848f29eeefe28b93c078238bd73bd13/5ff7e/3be09f7f38cf839d.png 375w,
/static/5848f29eeefe28b93c078238bd73bd13/1d69c/3be09f7f38cf839d.png 750w,
/static/5848f29eeefe28b93c078238bd73bd13/78797/3be09f7f38cf839d.png 1125w,
/static/5848f29eeefe28b93c078238bd73bd13/aa440/3be09f7f38cf839d.png 1500w,
/static/5848f29eeefe28b93c078238bd73bd13/56e36/3be09f7f38cf839d.png 1750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h1 class=&quot;heading title heading&quot; id=&quot;Long-Content&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Long-Content&quot; aria-label=&quot;Long Content permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Long Content&lt;/h1&gt;
&lt;p class=&quot;para&quot;&gt;在构建布局时，考虑到长内容是很重要的。正如你在前面所看到的，当章节的标题太长时，就会被截断了。这是可选的，但是对于一些UI来说，考虑到这一点很重要。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;对我来说，这是一种防御性的CSS方法。在“问题”真正发生之前就去解决它，这很好。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这里是一个人名的列表，现在看起来很完美。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/03a3fe617da04414d7c0fd316ca50368/56e36/70afebef41fb6a65.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.91489361702128%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAnElEQVQoz62S6woEIQiFe/8H3X8VUdoVXBSMYUZ22aXg0Mnqy0RX4otqB5pj0hjjoTnnlrV/l8PaCQEJAB5CRCqlyMxqrYmssyonBmFfYnGs1iow772sc86yt9baj1lyVvAKjDHu13kwULO2wF+BIQSJcYa99zNA9UeA+mX2KSWJK+hvoHpunSMZHq2hfvnaNj8B7/VhsM7qP9XwDZceVYmgE7+wAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;70afebef41fb6a65&quot;
        title=&quot;70afebef41fb6a65&quot;
        src=&quot;/static/03a3fe617da04414d7c0fd316ca50368/1d69c/70afebef41fb6a65.png&quot;
        srcset=&quot;/static/03a3fe617da04414d7c0fd316ca50368/4dcb9/70afebef41fb6a65.png 188w,
/static/03a3fe617da04414d7c0fd316ca50368/5ff7e/70afebef41fb6a65.png 375w,
/static/03a3fe617da04414d7c0fd316ca50368/1d69c/70afebef41fb6a65.png 750w,
/static/03a3fe617da04414d7c0fd316ca50368/78797/70afebef41fb6a65.png 1125w,
/static/03a3fe617da04414d7c0fd316ca50368/aa440/70afebef41fb6a65.png 1500w,
/static/03a3fe617da04414d7c0fd316ca50368/56e36/70afebef41fb6a65.png 1750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;然而，因为这是用户产生的内容，我们需要注意在内容太长的情况下如何布局。请看下图：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5906ee43148354a2badac394d2ffb64d/56e36/7299ce566060e9bc.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.91489361702128%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAmUlEQVQoz6WRCwoDIQwFvf9BCyJYBI1/sjyLYFVodxWGBIljjMK+X+yj45wyp5SOEeQjkyN2zi2EEBoxxq9ord3WA9ESckxEC12Q86f7UkoDZ3b1QOw2+wEIAYQAC0J0ONb9LQTGmOWSnt8WImqtWSnFUsq2h6c/Fs5P7rM8Eo6fUmtt+eMZ7oRHnzILEW8L5/l47/lXzSi8AJrhV3jeDmZjAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;7299ce566060e9bc&quot;
        title=&quot;7299ce566060e9bc&quot;
        src=&quot;/static/5906ee43148354a2badac394d2ffb64d/1d69c/7299ce566060e9bc.png&quot;
        srcset=&quot;/static/5906ee43148354a2badac394d2ffb64d/4dcb9/7299ce566060e9bc.png 188w,
/static/5906ee43148354a2badac394d2ffb64d/5ff7e/7299ce566060e9bc.png 375w,
/static/5906ee43148354a2badac394d2ffb64d/1d69c/7299ce566060e9bc.png 750w,
/static/5906ee43148354a2badac394d2ffb64d/78797/7299ce566060e9bc.png 1125w,
/static/5906ee43148354a2badac394d2ffb64d/aa440/7299ce566060e9bc.png 1500w,
/static/5906ee43148354a2badac394d2ffb64d/56e36/7299ce566060e9bc.png 1750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在这样的布局中，一致性很重要。为了实现这个一致性，我们可以通过使用&lt;code&gt;text-overflow&lt;/code&gt;和它的朋友，简单地截断名字。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.username {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/117cf145217d131dd49d984828175068/56e36/78df0f2f9791a940.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.91489361702128%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkUlEQVQoz7WR6wrDIAxGff8H7d+JmGi8kPE5UtpV2IpUOERiPGji4mvTJKS1VC2lLOM4iTKxEtGFnPNARE5xVmu4sWFSZr5gglo/r2+tDXBnVg/cLGkXIAQQAiwIY4ynur+FIISgKaWRQ8RL7fyW0CTe+71vS8LZl62XS8LjUHrvaz18XIh4W/jdHwziV81R+AZXclfhZNZJbAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;78df0f2f9791a940&quot;
        title=&quot;78df0f2f9791a940&quot;
        src=&quot;/static/117cf145217d131dd49d984828175068/1d69c/78df0f2f9791a940.png&quot;
        srcset=&quot;/static/117cf145217d131dd49d984828175068/4dcb9/78df0f2f9791a940.png 188w,
/static/117cf145217d131dd49d984828175068/5ff7e/78df0f2f9791a940.png 375w,
/static/117cf145217d131dd49d984828175068/1d69c/78df0f2f9791a940.png 750w,
/static/117cf145217d131dd49d984828175068/78797/78df0f2f9791a940.png 1125w,
/static/117cf145217d131dd49d984828175068/aa440/78df0f2f9791a940.png 1500w,
/static/117cf145217d131dd49d984828175068/56e36/78df0f2f9791a940.png 1750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果你有兴趣磨练你在CSS中处理长内容的技巧，我写了&lt;a href=&quot;https://ishadeed.com/article/css-short-long-content/&quot; class=&quot;link-underline&quot;&gt;一篇关于这个主题的详细文章&lt;/a&gt;。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;防止图片被拉伸或者被压缩&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%98%B2%E6%AD%A2%E5%9B%BE%E7%89%87%E8%A2%AB%E6%8B%89%E4%BC%B8%E6%88%96%E8%80%85%E8%A2%AB%E5%8E%8B%E7%BC%A9&quot; aria-label=&quot;防止图片被拉伸或者被压缩 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;防止图片被拉伸或者被压缩&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;当我们在网页上无法控制图片的长宽比时，最好能提前考虑，当用户上传的图片没有与长宽比对齐时，提供一个解决方案。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在下面的例子中，我们有一个带有照片的卡片组件。它看起来不错。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/378dea39d835fb436dedc93c8ac90870/56e36/f2651ca59cb71838.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 38.82978723404255%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKklEQVQoz42Ru04CQRSGeSULbXwAS15BQ2Fpp6WlhZ0PYKg1SohRGyXBKBAaCg2JJNrARrkK7tyWndnPLAQCeGOSL2fOzJz/zPyTELqLcxHWhlhrpzjniKKIeMTBupgI69zcuUUSWmmklHMopRn0e7Rabd4aDTrNOqLn4ffbfA76KKW+1UxIjAXUlDjXWtPpfpArVcnfl6kUbqkVM9QLWXrvHtoYFusmJBYXhJCE4ZBqtUb5+oLT/RTp1BqXu0nyxzu0G0+YwCKl+F8w7ur7/si3XPaEvY0VDpOrpLfWeTjYpHS0jfdcwYQOKZYUHD3ZBLS8OjfZM64y5zwW71DNV0zzBTnj4VKCUx+NQQdDZPxp2iB1QGCjP/379YaTuRA+Qohx9MfM7v8k+AVFYlgK33JdQwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;f2651ca59cb71838&quot;
        title=&quot;f2651ca59cb71838&quot;
        src=&quot;/static/378dea39d835fb436dedc93c8ac90870/1d69c/f2651ca59cb71838.png&quot;
        srcset=&quot;/static/378dea39d835fb436dedc93c8ac90870/4dcb9/f2651ca59cb71838.png 188w,
/static/378dea39d835fb436dedc93c8ac90870/5ff7e/f2651ca59cb71838.png 375w,
/static/378dea39d835fb436dedc93c8ac90870/1d69c/f2651ca59cb71838.png 750w,
/static/378dea39d835fb436dedc93c8ac90870/78797/f2651ca59cb71838.png 1125w,
/static/378dea39d835fb436dedc93c8ac90870/aa440/f2651ca59cb71838.png 1500w,
/static/378dea39d835fb436dedc93c8ac90870/56e36/f2651ca59cb71838.png 1750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当用户上传了一张不同尺寸的图片是，它会被拉伸。这不是好事。看看图片是如何被拉伸的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/89f14f1834d668a66cb0fba7ca7dbd62/56e36/d9eb5ad701b25143.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 45.212765957446805%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB8UlEQVQoz32STWsTURSG8zv8BYKKW90o4kJw16IWi1mJX3Rl/KhVmopKsRZBipiVVqh2IbgRBVdqkKZIrJpGjWKlJU2mycwknY87cyfJpI/Mbad1IV54Ofeee+57zn3PSTi1n/htQTdcIwxDut3uJqLzv/C/mIQM2vi+xPM8HNvGslaxVtfhOo7yx/B9X1nLshRs21G+2B8h4XlCbYJWC+FL6oaJ0Wiimw3lk0GwQbb+QHg+uqFTWV6mXqshXIEQW8kSiiwI0Fc0vsxkWSjOUXj/jlJ+lvzMLFaziZRSkRtalUx6kKnxNA/TV5gaTXPn2jBf5z7SCUOEECSEcOmswXwuS//ObST372Vs4DRD5wY4nzyBtlxWhFGl1cUFUgd20LN7OzdOJrk7PMKZI70UPuTohN2YUNDudPj1/RsT1we5ebaf9KUh+g7u4/7Vi5iGjuu6OK5LeWmJVF8PR/fsYuTCZY73HuPU4UMUP31WHIow+rKUAUZ9hXz2FU8zE9y7NcaT0RTFlw8QdlM1LZLF1HVyb17z9vkjnj2eJDN+mxfT02iVCjKQWxpGgrqug1b+TWm+wOKPEpZZo2nqKmssuCI1G1S1GmajocYmWsFm43wScXBkg1ZbiRuV78tAaff3veqyiKZC4AmBbds4G6MVd/kPnfZ+zD+aezIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;d9eb5ad701b25143&quot;
        title=&quot;d9eb5ad701b25143&quot;
        src=&quot;/static/89f14f1834d668a66cb0fba7ca7dbd62/1d69c/d9eb5ad701b25143.png&quot;
        srcset=&quot;/static/89f14f1834d668a66cb0fba7ca7dbd62/4dcb9/d9eb5ad701b25143.png 188w,
/static/89f14f1834d668a66cb0fba7ca7dbd62/5ff7e/d9eb5ad701b25143.png 375w,
/static/89f14f1834d668a66cb0fba7ca7dbd62/1d69c/d9eb5ad701b25143.png 750w,
/static/89f14f1834d668a66cb0fba7ca7dbd62/78797/d9eb5ad701b25143.png 1125w,
/static/89f14f1834d668a66cb0fba7ca7dbd62/aa440/d9eb5ad701b25143.png 1500w,
/static/89f14f1834d668a66cb0fba7ca7dbd62/56e36/d9eb5ad701b25143.png 1750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;最简单的修复方式是使用 CSS &lt;code&gt;object-fit&lt;/code&gt; 。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.card__thumb {
    object-fit: cover;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ea403e26449ae8e633f9ff1432f06ea2/56e36/5fe5a5a4a32c44fe.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 45.212765957446805%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABL0lEQVQoz42SsUoDQRCG7w3sfRErGyvBTgiiRewsRNNqFUQUra4RRRIRbDRGsIuWNtpZiY2NBDFyKOZyd7ubZHN7n9xhQkwumOKDZebff2Z3xvKdF5QOMCYiDMNUjDEJo/L9WM2WRqkmUsohlFL4vo/runie34ulabtYUoqesIuUChULVJOG5+E4Dh+1Gl6jgYhzSg7d6WINBpJKQqDDkOsjm8PNVQr5DUr7eez8FpVyCRNFCCHGNxQiIATs9WVmJifIZeY52NllcXaOy8IxESCCILXLkR22tebqtMheLsv22grZzAJL01Pc31boGJN0OL7hr/Ct+srz4wM35XMuTorcndl8V5+IB5n29/8a1usu7+81nM8vWm2dPFXrzp9pj2U4vBoiWZ+Y+DxYuN/wB/rcnIPuGfFmAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;5fe5a5a4a32c44fe&quot;
        title=&quot;5fe5a5a4a32c44fe&quot;
        src=&quot;/static/ea403e26449ae8e633f9ff1432f06ea2/1d69c/5fe5a5a4a32c44fe.png&quot;
        srcset=&quot;/static/ea403e26449ae8e633f9ff1432f06ea2/4dcb9/5fe5a5a4a32c44fe.png 188w,
/static/ea403e26449ae8e633f9ff1432f06ea2/5ff7e/5fe5a5a4a32c44fe.png 375w,
/static/ea403e26449ae8e633f9ff1432f06ea2/1d69c/5fe5a5a4a32c44fe.png 750w,
/static/ea403e26449ae8e633f9ff1432f06ea2/78797/5fe5a5a4a32c44fe.png 1125w,
/static/ea403e26449ae8e633f9ff1432f06ea2/aa440/5fe5a5a4a32c44fe.png 1500w,
/static/ea403e26449ae8e633f9ff1432f06ea2/56e36/5fe5a5a4a32c44fe.png 1750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在项目层面上，我倾向于为所有图像添加对象匹配，以避免出现意外的图像结果。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;img {
    object-fit: cover;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在 Smashing Magazine 的&lt;a href=&quot;https://www.smashingmagazine.com/2021/10/object-fit-background-size-css/&quot; class=&quot;link-underline&quot;&gt;这篇文章&lt;/a&gt;中学习更多关于&lt;code&gt;object-fix&lt;/code&gt;的内容。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;锁定滚动链Lock-Scroll-Chaining&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%94%81%E5%AE%9A%E6%BB%9A%E5%8A%A8%E9%93%BELock-Scroll-Chaining&quot; aria-label=&quot;锁定滚动链Lock Scroll Chaining permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;锁定滚动链（Lock Scroll Chaining)&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;你是否曾经打开一个模态并开始滚动，然后当你到达终点并继续滚动时，模态下面的内容（主体元素）会滚动？这就是所谓的滚动链(Scroll Chaining)。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在过去的几年里，有几种hack方式可以做到这一点，但是现在，我们可以只使用CSS来做，这里要感谢&lt;code&gt;overscroll-behavior&lt;/code&gt;这个CSS属性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在下图中，你可以看到默认的滚动链行为。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f53e9685ef07e3062844239ca54ccad4/29007/2aefb83a976227cc.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 52.659574468085104%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXklEQVQoz5VS7U7DIBT1/R/JHz7AjJqp63Tdln10K1BKP6AdbWmPAdsmc2ZTkpNzcy8cuPdwBwBd12FYQ2y5aZoz1HUNY8xY736csetuTNgNPdq2hVIKjDFwzkEodRwEgct9b+/OLj8THG/sC5XWUFIisoJRBEapQ8y5y5dledHR5QsB1MbgkOfYZzl2WY4Vj7Hk8ch+xF0+VAW83R5lVV1pGYBuGix4jBmL8EYoVrHAWiRYiQSbJHXxjDL4SYr7ySNSqW4JGixjgY+Iw6MMUkrXYp5lbgxaaywowzrL8fD0jEz9UXAeccwIhVTKmWOFrVguJT4JxTJJMfF9yNPpf4JFUaDs0ZrGGeQdQ/giwetuj+L2DA1813IMjzAchUAoEsckTbGlFHNCneDLZgul9XXByhg3eCtojZmGBNMj6Tl0RtnXW5Peg8Ntly3br2OFreNVHw+o29bVB/z2sb8AVzlSKSDENw4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;2aefb83a976227cc&quot;
        title=&quot;2aefb83a976227cc&quot;
        src=&quot;/static/f53e9685ef07e3062844239ca54ccad4/1d69c/2aefb83a976227cc.png&quot;
        srcset=&quot;/static/f53e9685ef07e3062844239ca54ccad4/4dcb9/2aefb83a976227cc.png 188w,
/static/f53e9685ef07e3062844239ca54ccad4/5ff7e/2aefb83a976227cc.png 375w,
/static/f53e9685ef07e3062844239ca54ccad4/1d69c/2aefb83a976227cc.png 750w,
/static/f53e9685ef07e3062844239ca54ccad4/78797/2aefb83a976227cc.png 1125w,
/static/f53e9685ef07e3062844239ca54ccad4/aa440/2aefb83a976227cc.png 1500w,
/static/f53e9685ef07e3062844239ca54ccad4/29007/2aefb83a976227cc.png 1600w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了提前避免这种情况，我们可以将其添加到任何需要滚动的组件中（例如：聊天组件、移动菜单…等）。这个属性的好处是，在有滚动之前，它不会产生影响。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.modal__content {
    overscroll-behavior-y: contain;
    overflow-y: auto;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9f0ce3570b786e2218a82c4a7bbd9c6b/29007/e74771556ee0eaf1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 52.659574468085104%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZ0lEQVQoz5WSi07kMAxF+f9fWml/ADrAop0F5lFogb6btE2adprpWU2h86gQA5auYlvxzXXsC4C+73m3fu9ba+m6bo9d3LbtgLFmvHuoh4vROb7Q2Z48F8RxTBInhGFIlmW4rovneWy321OiKeH0pbTqkJWh1oq6rtFao5TCGIOua0zTnIg40E0IW2t5EhJXCNZC8JjlJ3hIM9a5wCsrnMUSZcznLY+JputYZDnzOMF5CZkHOQ+R4D4UPMZyiG9eI1ay4NflFVKpc4SW5aAk5fI5RJaaWmuqsmLTtui6YeZFuEXB79k1hdLfJcxw/AhZKrRSlFU1TDcTBTd+xFpKnNUaZZofKPRCykrTaE2tNL21RHHKlfvGSkhuPR/dtOcJd3/4L0lx/IA7P2b+mvD3JRnOa/eNmR+wzAWzp2dUc0bhOOXFh8q7MOJPcMA8SoYOXCG5D0LMZvM14X6vjpZ8arv08e5N9/A/4s5RfUlg0lkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;e74771556ee0eaf1&quot;
        title=&quot;e74771556ee0eaf1&quot;
        src=&quot;/static/9f0ce3570b786e2218a82c4a7bbd9c6b/1d69c/e74771556ee0eaf1.png&quot;
        srcset=&quot;/static/9f0ce3570b786e2218a82c4a7bbd9c6b/4dcb9/e74771556ee0eaf1.png 188w,
/static/9f0ce3570b786e2218a82c4a7bbd9c6b/5ff7e/e74771556ee0eaf1.png 375w,
/static/9f0ce3570b786e2218a82c4a7bbd9c6b/1d69c/e74771556ee0eaf1.png 750w,
/static/9f0ce3570b786e2218a82c4a7bbd9c6b/78797/e74771556ee0eaf1.png 1125w,
/static/9f0ce3570b786e2218a82c4a7bbd9c6b/aa440/e74771556ee0eaf1.png 1500w,
/static/9f0ce3570b786e2218a82c4a7bbd9c6b/29007/e74771556ee0eaf1.png 1600w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果你想了解更多情况，我写了一篇[详细的文章](&lt;a href=&quot;https://ishadeed.com/article/prevent-scroll-chaining-overscroll-behavior/&quot; class=&quot;link-underline&quot;&gt;https://ishadeed.com/article/prevent-scroll-chaining-overscroll-behavior/&lt;/a&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;CSS-变量降级&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#CSS-%E5%8F%98%E9%87%8F%E9%99%8D%E7%BA%A7&quot; aria-label=&quot;CSS 变量降级 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CSS 变量降级&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;CSS 变量在网页设计中得到了越来越多的应用。我们可以使用一种方法，在CSS变量的值因某种原因为空的情况下，以一种不破坏体验的方式使用它们。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这在通过 Javascript 输入 CSS 变量的值时特别有用。下面是一个例子。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.message__bubble {
    max-width: calc(100% - var(--actions-width));
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt; &lt;code&gt;--actions-width&lt;/code&gt; 在 &lt;code&gt;calc()&lt;/code&gt; 方法中被使用，并且它的值来自 JavaScript。假设因为某些原因，JavaScrippt失败了，会发生什么呢？&lt;code&gt;max-width&lt;/code&gt; 将会被计算为 &lt;code&gt;none&lt;/code&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们可以提前避免，在var()中添加一个回退的值。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.message__bubble {
    max-width: calc(100% - var(--actions-width, 70px));
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这样依赖，如果变量没有定义，就会使用降级（70px）值。这种方法可以在变量有可能失效的情况下使用。否则就不需要了。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;使用固定宽度或者高度&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8%E5%9B%BA%E5%AE%9A%E5%AE%BD%E5%BA%A6%E6%88%96%E8%80%85%E9%AB%98%E5%BA%A6&quot; aria-label=&quot;使用固定宽度或者高度 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用固定宽度或者高度&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;破坏布局的常见情况之一是对一个有不同长度内容的元素使用固定宽度或者高度。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;固定高度&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9B%BA%E5%AE%9A%E9%AB%98%E5%BA%A6&quot; aria-label=&quot;固定高度 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;固定高度&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;我经常看到一个 &lt;code&gt;hero&lt;/code&gt; 章节有一个固定的高度，而内容却大于这个高度，这导致了布局的破坏。不确定这看起来是什么样子的？在这里：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.hero {
    height: 350px;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0cdb7ff95a78514bd21bef1c7e784626/7970d/f9c8e3ca02365936.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 47.87234042553191%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlUlEQVQoz42Su24TQRRA8x/U/BwSSIgaIWoahGiokPIBlKGAjgZBAUSxEnu9fu7M7OzOy2s7tpd4TzTr4GAokpGOruZq5tw7j6NQLXGhwvqAD/N7Y/0c4ypcmBOqBX62ILqOfLUkOM9y4anr32w2mzuoWa3XsN0AVzRXNcb6W2GssLxcc9+xbXbxW7Lh5QfB155H5wIbDoQrjDFkWUZRFAghsNa2G5umadkLt1DWfV6cfObB45+8/TjBlwrj/+kwCqJQKYWUkjzPKY1pC2hdUFUVdV1DA++TVzz58oiHz37x5mSKL+Wh8HIVhabtLAqLQqOkREqxy0mJEBkheNjCcf81z78/5d2njB+pRyuB+3Pk3WUuGIwmnHXOOe8mbUzSIRe9/g0p6XCCyAusqxiUI3q6C03Ner1CaXP7KFEmCk+nn3F6MaKTTDntjumNNQNhSTPTMpCOcR4YKs9EVUzzOUlmSYVDFv5/YVw81TMmN8T5WPk9o4h0jJRjGJF2l1MOod3fwmX7QXXp0eYuwgFFGz2lne2F1xPI61B4ae8pAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;f9c8e3ca02365936&quot;
        title=&quot;f9c8e3ca02365936&quot;
        src=&quot;/static/0cdb7ff95a78514bd21bef1c7e784626/1d69c/f9c8e3ca02365936.png&quot;
        srcset=&quot;/static/0cdb7ff95a78514bd21bef1c7e784626/4dcb9/f9c8e3ca02365936.png 188w,
/static/0cdb7ff95a78514bd21bef1c7e784626/5ff7e/f9c8e3ca02365936.png 375w,
/static/0cdb7ff95a78514bd21bef1c7e784626/1d69c/f9c8e3ca02365936.png 750w,
/static/0cdb7ff95a78514bd21bef1c7e784626/78797/f9c8e3ca02365936.png 1125w,
/static/0cdb7ff95a78514bd21bef1c7e784626/aa440/f9c8e3ca02365936.png 1500w,
/static/0cdb7ff95a78514bd21bef1c7e784626/7970d/f9c8e3ca02365936.png 1908w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了避免内容从&lt;code&gt;hero&lt;/code&gt;中漏出，我们需要使用&lt;code&gt;min-height&lt;/code&gt;来代替&lt;code&gt;height&lt;/code&gt;。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.hero {
    min-height: 350px;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/746ed60d16d058e2072758fc248a27c5/7970d/13aef645e8159a1d.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 47.87234042553191%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfElEQVQoz42SPa/TMBRA+z/Y+XFICCRGBsTMwAAS6/sFjDwhMTIAEhKs9KlCzZdjxx9x66YJTQ6y29dCXyWwdHJtJzn35sYz5wPGebR1WLfC/IG9wO2+tp7G+LR2fo1t10TXzPqAM5awtgzDL/q+/yfddgtjD+yYdgONtidhzBA2W/53jNM+fpn3PH9b8OmHpRYF2v0l7GiahjzPkVJSFAVa6/TiNE2Jo3AENdzw7N0H7j38xuvrJVZVNPasQmM0eV5QVRVlWSKESEligoj3nmEYkvTq5gWPPj7g/pPvvLrOLgk7lFKpwltZrDKusyxL8xiNMUw7uJq/5Onnx7x5n/F1rhFlgXFnFUpZs1gsWC6XKUZxlERppK5r2ral3/bIUFH4n4cmTGhz56d0hBCw1rJarXDOpc/b929kjI27MHZjvA+bTXc4PoFZPENCOaqmRWiPOMRKOUrpKNUBaSmOmETciwhlThXGizItlTR3EMrukfY0PyM+J7U7Cn8DVTzxgPr1kwwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;13aef645e8159a1d&quot;
        title=&quot;13aef645e8159a1d&quot;
        src=&quot;/static/746ed60d16d058e2072758fc248a27c5/1d69c/13aef645e8159a1d.png&quot;
        srcset=&quot;/static/746ed60d16d058e2072758fc248a27c5/4dcb9/13aef645e8159a1d.png 188w,
/static/746ed60d16d058e2072758fc248a27c5/5ff7e/13aef645e8159a1d.png 375w,
/static/746ed60d16d058e2072758fc248a27c5/1d69c/13aef645e8159a1d.png 750w,
/static/746ed60d16d058e2072758fc248a27c5/78797/13aef645e8159a1d.png 1125w,
/static/746ed60d16d058e2072758fc248a27c5/aa440/13aef645e8159a1d.png 1500w,
/static/746ed60d16d058e2072758fc248a27c5/7970d/13aef645e8159a1d.png 1908w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这样依赖，如果内容变大了，布局也不会破坏。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;固定宽度&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9B%BA%E5%AE%9A%E5%AE%BD%E5%BA%A6&quot; aria-label=&quot;固定宽度 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;固定宽度&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;你有没有见过一个按钮，它的标签离左右边缘太近？这是由于使用了固定宽度。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.button {
    width: 100px;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果按钮的标签比100px长，标签会离边缘很近。如果标签太长了，文字就会从里面溢出，这样不好。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/220f468b27fc5370ea7e0b59c0495073/52ab5/6038e09939373021.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.808510638297875%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA4klEQVQoz51Ri27CMAzM//9lR9lGA12BOI8mzk0Oc1YEmsQinXrn1udrbMgOuHqLXBg555dQSnmoGR8ivA8gog7n3A3kOr+r/+hnMEq8920CM98BFajMLU2tIioq16bl/bquvV9glEhRTSRBCAHXRBimHb78udU/Tge8TSPscoQeCSHfq4dRIk+ZKhOFxxjhEmG0+2Yo53SZMR7f8TlPoEi/hvSHoSaO4WY4TCNmWlrzEi4t4c7ucTjbVivPEqqQdGK6hd6fblW03CEXRskFKaUeqC9FxXaLr0D7H375v9hu+RuO1ruaiUN7lwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;6038e09939373021&quot;
        title=&quot;6038e09939373021&quot;
        src=&quot;/static/220f468b27fc5370ea7e0b59c0495073/1d69c/6038e09939373021.png&quot;
        srcset=&quot;/static/220f468b27fc5370ea7e0b59c0495073/4dcb9/6038e09939373021.png 188w,
/static/220f468b27fc5370ea7e0b59c0495073/5ff7e/6038e09939373021.png 375w,
/static/220f468b27fc5370ea7e0b59c0495073/1d69c/6038e09939373021.png 750w,
/static/220f468b27fc5370ea7e0b59c0495073/78797/6038e09939373021.png 1125w,
/static/220f468b27fc5370ea7e0b59c0495073/52ab5/6038e09939373021.png 1420w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;要修复这个问题，我们可以简单地使用&lt;code&gt;min-width&lt;/code&gt;代替&lt;code&gt;width&lt;/code&gt;。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.button {
    min-width: 100px;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h1 class=&quot;heading title heading&quot; id=&quot;忘记了Background-Repeat&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%BF%98%E8%AE%B0%E4%BA%86Background-Repeat&quot; aria-label=&quot;忘记了Background Repeat permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;忘记了 &lt;code&gt;Background-Repeat&lt;/code&gt;&lt;/h1&gt;
&lt;p class=&quot;para&quot;&gt;很多时候，当使用一张大的图片作为背景时，我们往往会忘记考虑设计在大屏幕上观看时的情况。那个背景会默认重复。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这在笔记本电脑的屏幕上大多不会看到，但在大屏幕上可以清楚地看到。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e5d79d8485b8f0cc27f244199e238aec/52ab5/cc8e368f4842b626.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 45.74468085106383%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACFElEQVQoz3WSz0tUURTHZ9WmZesW/QFtImgdBUKrNhqt2gUhKEWLwMSQUDct2ogL2ygEOYQSJVgpBfkDzdGcGcc3OJOOzmQzb2Z8vvvufe/d9/zEezqFiy58Oeee8+Uc7vd7E06thO3U8HVAEASEYRhHrX201mfg+/ovJwyDM/VWnpDKRUmF9j0Omw3qZo0jy0K5LlIpHMeJ4bkK33OxrEPqpkmz2US6LkrJuC6ljHmJqFA5qLO4mmV9I4dhbFHaMWiW8jTKe0glEUKSNXZYWc+xvf0Tw9hkr5ChXjQolSospTYx6w1cpU4G5otV1tbSzLx5xdxIL99G+1h5/Zy99fd4OqTRsEild1n++pmpkUHmR56wMDZIZnKAbDbP99U0jWolflVC2DbDA/1MP73Ho8vneHnrAm87LvGhr535iV6ik1paYLSni8nONh5fPU/y7kWmHtxg+kUHz+7fZnboIQfpRdzgONJQsTDzji/JcYofk6QmhiksfaK8Ost+ZoUQMNaW6b55hb47bYx3tTM91Ek+OcTWWA/9HdfpbrtGIfMDHYQkpOMQHIMGPE5jCK4OcX0di23bR5R3CmzlNjEMA7Oyi1Xb58is8Gu3SC6zgRUZGWnoyEh0gRA2jm0TSeBEuRA4joidi4b6QYDneZimye9qjfJBjWplGynMWGd1+iMSLbv/h1b/ZKk4WSQEMu7/u7e4fwDpNX/C15SxBQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;cc8e368f4842b626&quot;
        title=&quot;cc8e368f4842b626&quot;
        src=&quot;/static/e5d79d8485b8f0cc27f244199e238aec/1d69c/cc8e368f4842b626.png&quot;
        srcset=&quot;/static/e5d79d8485b8f0cc27f244199e238aec/4dcb9/cc8e368f4842b626.png 188w,
/static/e5d79d8485b8f0cc27f244199e238aec/5ff7e/cc8e368f4842b626.png 375w,
/static/e5d79d8485b8f0cc27f244199e238aec/1d69c/cc8e368f4842b626.png 750w,
/static/e5d79d8485b8f0cc27f244199e238aec/78797/cc8e368f4842b626.png 1125w,
/static/e5d79d8485b8f0cc27f244199e238aec/52ab5/cc8e368f4842b626.png 1420w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了提前避免这种行为，请确保重置了 &lt;code&gt;background-repeat&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.hero {
    background-image: url(&amp;#39;..&amp;#39;);
    background-repeat: no-repeat;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;垂直方向的媒体查询&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9E%82%E7%9B%B4%E6%96%B9%E5%90%91%E7%9A%84%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2&quot; aria-label=&quot;垂直方向的媒体查询 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;垂直方向的媒体查询&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;有时候，我们总是禁不住写一个组件，并且只通过调整浏览器的宽度进行测试。根据浏览器的高度进行测试可以发现一些有趣的问题。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这里有一个我见过很多次的问题。我们有一个带有主要和次要链接的aside组件。次要链接应该被定位在旁白部分的最底部。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;考虑一下下面的例子。主导航和次导航看起来还不错。在我看到的这个例子中，开发者给二级导航添加了&lt;code&gt;position: sticky&lt;/code&gt;，这样它就可以粘在底部了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7101416d382fc41660cfc28a48991410/e216b/89911cdc5c263205.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 63.829787234042556%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAUlEQVQ4y42Txw6DMBBE+f//zIEL1TbNsNFzNMgxpFgaFraMt1G55mHT4i3G3ZZlsXVdT2zb9vb9D6owr+adt3EcLcaYSCD2/qWbpsnmef4J/IipQngFNk1j+74bB4kRHTKEcKKsQkCPvSIABbcgOWSKkYuGYUjATtAdFJ8y5MGHcy4hJxQZxHkmIinfL4Rd16X3O0LseXB+wS2hhkD/1MO2bRO4CKl+IkFJfBIyWUhQHsfx1kNlh58yVt8/liwinbzkvu9PUjIFXwlVAntUEkIGlJl28uuUVVpd15e1EaGQ72O5k5ehoKCXkOFAAGV+6iH+t39K/idoeoJ2s0Tpl+MJnMrzsUf+MzwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;89911cdc5c263205&quot;
        title=&quot;89911cdc5c263205&quot;
        src=&quot;/static/7101416d382fc41660cfc28a48991410/1d69c/89911cdc5c263205.png&quot;
        srcset=&quot;/static/7101416d382fc41660cfc28a48991410/4dcb9/89911cdc5c263205.png 188w,
/static/7101416d382fc41660cfc28a48991410/5ff7e/89911cdc5c263205.png 375w,
/static/7101416d382fc41660cfc28a48991410/1d69c/89911cdc5c263205.png 750w,
/static/7101416d382fc41660cfc28a48991410/78797/89911cdc5c263205.png 1125w,
/static/7101416d382fc41660cfc28a48991410/aa440/89911cdc5c263205.png 1500w,
/static/7101416d382fc41660cfc28a48991410/e216b/89911cdc5c263205.png 1904w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;然而，如果浏览器的高度变小了，布局就会破碎。注意这两个导航是如何重叠的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/02664b4e9513540c864f9f0bd8775d3b/e216b/852b4623a3316694.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 52.659574468085104%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7klEQVQoz3WSi46FIAxE/f9PNXt9ovjCbk5zx4DLmowgdKbT1maOP5aS2XmeD67repCfv+/yGO2bGDcLS7B93+04Dl/XdbVlWXzdtq1AjLEKcZoQgrVt6+p6IPZ9b+M4+p5gAJGkNRDngmx0cN+3AyKXJJvnuXBKBW+Ugl/yNE2PQwT5HobBgSB9qgn9FfyWRHkIyaHcAQJFzFF1qIYikAuSoOs6d8iK4/dQqg55dZ+PE7hQyZqapq2eKnHez0KQYCbKBY8ckoBzQNk4Vk81yOqUIUNAELGUUjFlkDtkrU1bnEa/hMrMf+r/oFbU8At7mViroSK9sgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;852b4623a3316694&quot;
        title=&quot;852b4623a3316694&quot;
        src=&quot;/static/02664b4e9513540c864f9f0bd8775d3b/1d69c/852b4623a3316694.png&quot;
        srcset=&quot;/static/02664b4e9513540c864f9f0bd8775d3b/4dcb9/852b4623a3316694.png 188w,
/static/02664b4e9513540c864f9f0bd8775d3b/5ff7e/852b4623a3316694.png 375w,
/static/02664b4e9513540c864f9f0bd8775d3b/1d69c/852b4623a3316694.png 750w,
/static/02664b4e9513540c864f9f0bd8775d3b/78797/852b4623a3316694.png 1125w,
/static/02664b4e9513540c864f9f0bd8775d3b/aa440/852b4623a3316694.png 1500w,
/static/02664b4e9513540c864f9f0bd8775d3b/e216b/852b4623a3316694.png 1904w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;通过使用 CSS 垂直媒体查询，我们可以避免这样的问题。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;@media (min-height: 600px) {
    .aside__secondary {
        position: sticky;
        bottom: 0;
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这样一来，只有当视图高度大于或者等于600像素时，二级导航才会被粘在底部。好多了，对吧？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;可能有更好的方法来实现这一行为（比如使用 margin-auto），但我在这个例子中专注于垂直查询。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;使用Justify-Content-Space-Between&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8Justify-Content-Space-Between&quot; aria-label=&quot;使用Justify Content Space Between permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用 &lt;code&gt;Justify-Content: Space-Between&lt;/code&gt;&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在一个flex容器中，你可能会使用 &lt;code&gt;justify-content&lt;/code&gt; 来使子项之间有一定的间隔。如果有一定数量的子项目，布局看起来会很好。然而，当它们增加或减少时，布局会看起来很奇怪。考虑下面的例子。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/bea8a9e6c3fe54a8c0ac7c38578ef63a/52ab5/569924e65ef8eb04.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.27659574468085%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcUlEQVQoz3WSW3PaQAxG+f+/LZOHNhOghQBNgiFrE7D3ImnXczp28dTttA9ndNnVNxpJi+AOdNFRSk/JmZwzpRT6vh/tnCnX3+Ppb77XDSxiEmJMhBDw3o+2bVtOpxPn85mqqkZb1zXH6jjG1ami6zr8rGZiMTkpJUQMUSMlxbcdIXSE6AlDURcIfiDibx0qCRUZiTGOGoNdTEE2I0eH+grzJ6QOXJvC9VLwTunShWvfcMs1oQ3UueDMuJWCqc4Fhw4jpolYfyF+PJA+Hqi3jt0ys1sq72vPe/jO1pbs5Zlj41iK8SzKTg39n2BqnojukeQeaV5q9uvMfm0cvwWOYcMurznoiuriWElmJcpBhzH9S9AE+VyTmq9I88T1cOF1k3ndGh8vkXPc8yNvedMN7vPCRjMbVd4s/93hrxkOyaFLlYCliLaJFIcFGdoJEiIpJ5IOb5FkRlRFzBCR34KTM57NfePjOYThHGb4MMP/yUzjJ/Fjs2HoyYmAAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;569924e65ef8eb04&quot;
        title=&quot;569924e65ef8eb04&quot;
        src=&quot;/static/bea8a9e6c3fe54a8c0ac7c38578ef63a/1d69c/569924e65ef8eb04.png&quot;
        srcset=&quot;/static/bea8a9e6c3fe54a8c0ac7c38578ef63a/4dcb9/569924e65ef8eb04.png 188w,
/static/bea8a9e6c3fe54a8c0ac7c38578ef63a/5ff7e/569924e65ef8eb04.png 375w,
/static/bea8a9e6c3fe54a8c0ac7c38578ef63a/1d69c/569924e65ef8eb04.png 750w,
/static/bea8a9e6c3fe54a8c0ac7c38578ef63a/78797/569924e65ef8eb04.png 1125w,
/static/bea8a9e6c3fe54a8c0ac7c38578ef63a/52ab5/569924e65ef8eb04.png 1420w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们有一个flex容器，它有四个子项。子项之间的间距不是&lt;code&gt;gap&lt;/code&gt;或者&lt;code&gt;margin&lt;/code&gt;，这是因为容器使有&lt;code&gt;justify-content: space-between&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.wrapper {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当子项的数量小于4个时，将发生以下情况。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/dee1ce6f68b250d94f2bfd4f42b0a458/52ab5/966e9a752f9b94e5.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.27659574468085%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZ0lEQVQoz3WSaY/TQAxA+/9/G4cEC1vEQjfdltzkmsueiR5KtikBwYensa3xkzXjg60zJleT0kyKkRgjKSXmJU/pD7bafMu3u/HWt3BwPuCcx1qLMWY9x3GkKAuquiIvcsqypGka8jwnLwvyomCaJsyuZ+OwBd57QlCCKN4LUzcwtT12NDjrccZh+ompHTD9iIRwxzm3OpbzsCVRlehqxOSoLZiLEc4Wazq6uaWfW0I3QGaQ2lGnSK2RISVUZC9cJnSoeFzzAVe9wVZv0UsFZ08+fOebfl5pmytklr40fBLhMQgnUeR/Qt8+4Ot3uPo9en0VFsMzp3jkpEd+tj/uwkcRjkHIZHmmfwk1ELov+PYjrn0gXRvIPPX4wjk+rfRtAc+WqbJ8VeUpKBeNf0/4+oZLcZlSgkWCQ6sJvYwE4/DR49UjnSW+jEhjcVFxIgRVQgi/hVuwrs3tx7d1WFfC2DvG7Os7do5f8sm0Kc/Fe34AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;966e9a752f9b94e5&quot;
        title=&quot;966e9a752f9b94e5&quot;
        src=&quot;/static/dee1ce6f68b250d94f2bfd4f42b0a458/1d69c/966e9a752f9b94e5.png&quot;
        srcset=&quot;/static/dee1ce6f68b250d94f2bfd4f42b0a458/4dcb9/966e9a752f9b94e5.png 188w,
/static/dee1ce6f68b250d94f2bfd4f42b0a458/5ff7e/966e9a752f9b94e5.png 375w,
/static/dee1ce6f68b250d94f2bfd4f42b0a458/1d69c/966e9a752f9b94e5.png 750w,
/static/dee1ce6f68b250d94f2bfd4f42b0a458/78797/966e9a752f9b94e5.png 1125w,
/static/dee1ce6f68b250d94f2bfd4f42b0a458/52ab5/966e9a752f9b94e5.png 1420w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这样不好，有几种不同的解决方案：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;Margin&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;Flexbox gap (谨慎使用)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;Padding (可以应用于每个子元素的父元素)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;添加空的元素作为间隔&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;为了简单起见，我将使用&lt;code&gt;gap&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.wrapper {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ae7ee6cb06456ec1c53a23a11b4051a9/52ab5/824deddb68a96850.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.27659574468085%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQ0lEQVQoz42S7W7bMAxF8/7PVhRDtwXZkDpb2mJ17Mx1LJEUZfcUtuvVCPpjBA5EUcTV193E6jedVPT9QJ8z+Z0l7/ueYRimcWSp5VXvmo2oIaLEGIkh/CPEMNWapqE8lZSnE23bTrUQ5rXP2CyJqmLmH4iRzFFRQhuQLpBUcTNMdepfEJFJYxw3yyS7k6UihT9494y2f2lyTTPUhNjQSqbuM7VnfBgY45U53H0tOJ5Q8KRIfYdUN2h5S13fU/iOwrc8tvccLoltSmw1ccl5FnydJVNKnwvq+RtS3aLlF851wcF/csg7ntqCX11i587O/lfQDWt+oOevWPWdl/ORBy845j3l5chjl9i7s7dE7AfWcXXl+Q3HXcZTJou4CqkT1BXNSoqCRUPc0bHvyipm9iG4JJMd3n88TNYYbbRmZakr1hpvEhC31VXVQp0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;824deddb68a96850&quot;
        title=&quot;824deddb68a96850&quot;
        src=&quot;/static/ae7ee6cb06456ec1c53a23a11b4051a9/1d69c/824deddb68a96850.png&quot;
        srcset=&quot;/static/ae7ee6cb06456ec1c53a23a11b4051a9/4dcb9/824deddb68a96850.png 188w,
/static/ae7ee6cb06456ec1c53a23a11b4051a9/5ff7e/824deddb68a96850.png 375w,
/static/ae7ee6cb06456ec1c53a23a11b4051a9/1d69c/824deddb68a96850.png 750w,
/static/ae7ee6cb06456ec1c53a23a11b4051a9/78797/824deddb68a96850.png 1125w,
/static/ae7ee6cb06456ec1c53a23a11b4051a9/52ab5/824deddb68a96850.png 1420w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;悬停在图片上的文字&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%82%AC%E5%81%9C%E5%9C%A8%E5%9B%BE%E7%89%87%E4%B8%8A%E7%9A%84%E6%96%87%E5%AD%97&quot; aria-label=&quot;悬停在图片上的文字 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;悬停在图片上的文字&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;当使用悬停在一个图片附近的文字时，必须考虑到图像无法加载的情况。文本会是什么样子？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这是一个例子：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d24dd384847503709c7ac5be8be0f67e/56e36/4fe97c0fb534f9ef.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 44.680851063829785%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABgUlEQVQoz42RvUtbURjG8xe4uHRwVCmCBY1oGnRIIShqBBdRpGAofkAmNcboIKJRooLGRToUQaSlm0u3Ugqii4uoqOAX6iKuuefea849Nz+5VyIRNTr8eHk4z/Ocw3s86dsTDCmwVRal1COWZRUk35uPx7yTGIaJruuPGKaJdILKwTFars5kJFJKLEthmk8zOTy6Lh5KDAMhhFtwtLfLVHSIlflpfizOkEokWBwf4XtymlRyjolojMvzc/cSJ+Nkc3jyhdA0ssD/Pxs0lxVT+6GIprpqmqsr6QsFifSECfjqafHXcHywj7Kz7yvc/PeX4KePNFSUEvBWEYtESM4u0PglSMDr5WuojePDQ5Sy3ygUAmXb7GxvMTzwjdmJGP2tn+nt7KA91E5deQkhv4/h3jBXlxfuPgsWOrvMSMnZ6Qm/1tf4ubbK8lyCyXicsWicwXAXqcFufi+NcntzzV1G4vxBwcLc1NJpNE1DEzrC0ZpwX2MaDzPf+2rhS4Zn52947wGNJHJQcq401gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;4fe97c0fb534f9ef&quot;
        title=&quot;4fe97c0fb534f9ef&quot;
        src=&quot;/static/d24dd384847503709c7ac5be8be0f67e/1d69c/4fe97c0fb534f9ef.png&quot;
        srcset=&quot;/static/d24dd384847503709c7ac5be8be0f67e/4dcb9/4fe97c0fb534f9ef.png 188w,
/static/d24dd384847503709c7ac5be8be0f67e/5ff7e/4fe97c0fb534f9ef.png 375w,
/static/d24dd384847503709c7ac5be8be0f67e/1d69c/4fe97c0fb534f9ef.png 750w,
/static/d24dd384847503709c7ac5be8be0f67e/78797/4fe97c0fb534f9ef.png 1125w,
/static/d24dd384847503709c7ac5be8be0f67e/aa440/4fe97c0fb534f9ef.png 1500w,
/static/d24dd384847503709c7ac5be8be0f67e/56e36/4fe97c0fb534f9ef.png 1750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;文字看起来时可阅读的，但是，当图片加载失败的时候，它就会了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6ac229644b0ae1abeca0850d231d93f0/56e36/988cbed92b520cb9.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 44.680851063829785%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAcklEQVQoz62R3QqAMAiF9/6P2Bt0G/4xTMOBEaMYtYTDVI7uYyvbujhV8F3NVXVahaU6ETsi/qKCCC0hoqbImXlIkt6cS5W+ESYR8VHEpa8XmllTUmUdMUWYSz4T/vaGaYgTAM6fi7yvr94hYd970h3hAbuRvou6WBjqAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;988cbed92b520cb9&quot;
        title=&quot;988cbed92b520cb9&quot;
        src=&quot;/static/6ac229644b0ae1abeca0850d231d93f0/1d69c/988cbed92b520cb9.png&quot;
        srcset=&quot;/static/6ac229644b0ae1abeca0850d231d93f0/4dcb9/988cbed92b520cb9.png 188w,
/static/6ac229644b0ae1abeca0850d231d93f0/5ff7e/988cbed92b520cb9.png 375w,
/static/6ac229644b0ae1abeca0850d231d93f0/1d69c/988cbed92b520cb9.png 750w,
/static/6ac229644b0ae1abeca0850d231d93f0/78797/988cbed92b520cb9.png 1125w,
/static/6ac229644b0ae1abeca0850d231d93f0/aa440/988cbed92b520cb9.png 1500w,
/static/6ac229644b0ae1abeca0850d231d93f0/56e36/988cbed92b520cb9.png 1750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们可以通过给图片元素添加一个背景颜色来轻松解决。这个背景只有在图片加载失败的时候才会可见。这很酷，不是吗？&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.card__img {
    background-color: grey;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d289d54cdce493b59654afae40cf7e68/56e36/49963ec7273a0ee6.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 44.680851063829785%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGElEQVQoz4WS30uTYRTH3z+g2/6E6iqFsnLKIJ3spbnB2M9iZTmFkFHQILqKCLqwG6G8cvYndNFYDhLcUiO33CabiRFBrnQmpOAcc+/e990nnkcd3nUeDud7vg/nPF+ec5TqzndqjSqGbqA3m+i6jqHrbdw8jif4dH6al3WGgXKo6ZhmC90waOoGmtakoWkYpik5s2XKXNM0TNOURQI3GkecaCR4Eev1Okp1f5+VXIGvpSIbP9bJZzN8Ss1RWs7ybbXEl8wylc1NyuUyuVyOfD5PKpU69jTZTJZCocDa2hq1Wg2l8rvMiNqLr+cSI65+QjdUhvosRIeC3AvcxHb1CrOJd8Sm32C32/H5fHi9XtxuNx6PR2Kn08nY2Bh7e3sovzZ+4rdc5PLZM3SdP0fQPsCT+6NEHzziencvTkuXbDgVm0ZV7bJJIBAgHA4TDAZl7nK5ZMPd3V2UytYWo34Pd70uArZrRG4HefZ8nP6ebqydHdxx+5mfm2MqFsPhcEiFoVCIaDTK8PBwW20kEjlS+Gd7m4nxF0xOvOTpwzBDzgG8Li99nRe4Ze3gccjB+spnXr2exGq1Mjg4iKqq2Gw2+QXiEYGFYqmwWq2yWipSyC+TXVpiYX6RhY8LzCaTZD68pbT4nr87mxSLJeLxOMlkkpmZmXYUnkgkSKfTHBwcoIhRn+yQGH+r1UIcYSagt+Cw0ZD3/zOxNv8ACSsmoYtFQ50AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;49963ec7273a0ee6&quot;
        title=&quot;49963ec7273a0ee6&quot;
        src=&quot;/static/d289d54cdce493b59654afae40cf7e68/1d69c/49963ec7273a0ee6.png&quot;
        srcset=&quot;/static/d289d54cdce493b59654afae40cf7e68/4dcb9/49963ec7273a0ee6.png 188w,
/static/d289d54cdce493b59654afae40cf7e68/5ff7e/49963ec7273a0ee6.png 375w,
/static/d289d54cdce493b59654afae40cf7e68/1d69c/49963ec7273a0ee6.png 750w,
/static/d289d54cdce493b59654afae40cf7e68/78797/49963ec7273a0ee6.png 1125w,
/static/d289d54cdce493b59654afae40cf7e68/aa440/49963ec7273a0ee6.png 1500w,
/static/d289d54cdce493b59654afae40cf7e68/56e36/49963ec7273a0ee6.png 1750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;当心CSS网格中的固定值&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%BD%93%E5%BF%83CSS%E7%BD%91%E6%A0%BC%E4%B8%AD%E7%9A%84%E5%9B%BA%E5%AE%9A%E5%80%BC&quot; aria-label=&quot;当心CSS网格中的固定值 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;当心CSS网格中的固定值&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;假设我们有一个网格，它包含一个aside和main。CSS 看起来是这样：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.wrapper {
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 1rem;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;由于缺乏空间，这在小的视口尺寸上会出现问题。为了避免这样的问题，在使用上述CSS网格时，一定要使用媒体查询。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;@media (min-width: 600px) {
    .wrapper {
        display: grid;
        grid-template-columns: 250px 1fr;
        gap: 1rem;
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;只有在需要的时候显示滚动条&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%AA%E6%9C%89%E5%9C%A8%E9%9C%80%E8%A6%81%E7%9A%84%E6%97%B6%E5%80%99%E6%98%BE%E7%A4%BA%E6%BB%9A%E5%8A%A8%E6%9D%A1&quot; aria-label=&quot;只有在需要的时候显示滚动条 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;只有在需要的时候显示滚动条&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;幸运的是，只有在内容较长的情况下，我们才能控制是否显示滚动条。也就是说，我们强烈建议使用&lt;code&gt;auto&lt;/code&gt;作为&lt;code&gt;overflow&lt;/code&gt;的值。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;请看下面的例子。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a9b9628f1667de8d92802102ee87b416/56e36/076a98fe1e2e33b9.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.48936170212767%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMElEQVQoz3WR7W6DIBiFe/PbRey29meL1qk1sxVQvl4UtD0L2HZ16X48BHLO+wTCjoYWoyfMYUYI4Q8LgleYTA5PkRoh+Ce9X3Zu9HDkQEQgsg8YkAsg+Q6Wv6AvXjHUbyCrnnTpzi4uzq0HJiw6TuiYxYlZMEHoBw03LiA3Y5ABHSMwTjh2a1cqC2stnHOJq3C94ZHF4ghlAgbpoc2MpmnSQLwx4xZNSxiURy8nKDNDG4LW+u7YCPNS4SNX+NwrFJUGExO0VlehhVQjeukTYpgg9Zxm/xVWB4mvWuHwrdGeLKSOQpOyKPXe43xeVpYFl8s5ZcaYrfAmtdagqkrs9zmKokDbtvfijbqukWVZysuy3GRJeBtYhRacCzDGEkKIjTDu+75H13XgnCceXxg/5QcWpGQiFMGq8gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;076a98fe1e2e33b9&quot;
        title=&quot;076a98fe1e2e33b9&quot;
        src=&quot;/static/a9b9628f1667de8d92802102ee87b416/1d69c/076a98fe1e2e33b9.png&quot;
        srcset=&quot;/static/a9b9628f1667de8d92802102ee87b416/4dcb9/076a98fe1e2e33b9.png 188w,
/static/a9b9628f1667de8d92802102ee87b416/5ff7e/076a98fe1e2e33b9.png 375w,
/static/a9b9628f1667de8d92802102ee87b416/1d69c/076a98fe1e2e33b9.png 750w,
/static/a9b9628f1667de8d92802102ee87b416/78797/076a98fe1e2e33b9.png 1125w,
/static/a9b9628f1667de8d92802102ee87b416/aa440/076a98fe1e2e33b9.png 1500w,
/static/a9b9628f1667de8d92802102ee87b416/56e36/076a98fe1e2e33b9.png 1750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;请注意，即使内容很短，也有一个滚动条可见。这对一个用户界面来说并不是好事。作为一个设计师，在不需要滚动条的情况下看到滚动条是很混乱的。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.element {
    overflow-y: auto;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;使用overflow-y: auto，滚动条只有在内容较长时才可见。否则，它就不会在那。下面是一个更新之后的图&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a3998a387ad6a12263aff78403d27ef4/56e36/99a3575a0e33c925.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.48936170212767%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLUlEQVQoz3WR2U7DMBBF+/PwEfwWL6AmoWkjQmq78TZOPEl0kd2FQMvD8TZ3jkbyhvoWQyRMPIGZ/zCDo8HoC0QqEMMezPFB7odNGCICBRARiPwKBwoM0q+QxRNU+Qy9f0Eg8yBLNzZpCeF8EcrjKAlH4dEJD6EIp94iDDMoTOg1oxMEISnXU9a5kPtDCJmL8Dzhl0gMMI7R6wjrJjRNA+/PEwvp0bSE3kScdIS2jGFkrB2/hMXO4K0weC8NqtpCqBHWmovQQ5shixKqH9EbBk/T/8L6oPGxNzh8WrSdh7ZJ6HItSTlGLMuCZZ6xLHM+j+N4L7w+eO9Q1zuUZYGqqtC27S2YdudSfY/tdouyLHMmvV0zWbhuSFNIqSCEyCil7oRSylzrui6zFqZP+QZnj2Q7YiDaSwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;99a3575a0e33c925&quot;
        title=&quot;99a3575a0e33c925&quot;
        src=&quot;/static/a3998a387ad6a12263aff78403d27ef4/1d69c/99a3575a0e33c925.png&quot;
        srcset=&quot;/static/a3998a387ad6a12263aff78403d27ef4/4dcb9/99a3575a0e33c925.png 188w,
/static/a3998a387ad6a12263aff78403d27ef4/5ff7e/99a3575a0e33c925.png 375w,
/static/a3998a387ad6a12263aff78403d27ef4/1d69c/99a3575a0e33c925.png 750w,
/static/a3998a387ad6a12263aff78403d27ef4/78797/99a3575a0e33c925.png 1125w,
/static/a3998a387ad6a12263aff78403d27ef4/aa440/99a3575a0e33c925.png 1500w,
/static/a3998a387ad6a12263aff78403d27ef4/56e36/99a3575a0e33c925.png 1750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;滚动条的槽&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%BB%9A%E5%8A%A8%E6%9D%A1%E7%9A%84%E6%A7%BD&quot; aria-label=&quot;滚动条的槽 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;滚动条的槽&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;另一个和滚动相关的事情就是滚动条的槽。以前面的例子为例，当内容变长时，增加一个滚动条会导致布局转移。发生布局移动的原因是为滚动条预留了一个空间。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;考虑如下图：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f816268a3571e8e0adefd78574ca4eb8/8b70b/0c275c70415f2f44.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 57.446808510638306%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlElEQVQoz6WS2W7bMBBF/f8f1X5B0resTiwvkkjK4iKSspbIpyAduwgKFEUr4OBSmtEFZ1n5tiQOgWmcGMfxv1mFeCL4gPf+Qud/nf+BVT4ETwie2EeaRrF+W2OMwfuOzneEEG6kHGMNRbHBOZvjl/9j9ljF0FO3B173T2zKNS/FI6/bJ46dpDsZGl/TugahK152jxTVW44nWi9xo2N3uEe+3xFPYzKMSFNRiwqlGuq6RimFtZYUi4On7RqUqalEmXOEEEgpsdYwTAuivOfw8I1+mC+Gytaoo0JrjTaatm0zMfaET8PGStRR5laknKRGa07jB7L8Qfnw/WKYBpLKmz9mWOC8nFmWM9dnXiZ013C0MvdrnmbGYbxtxbKAUM8c3u/oryULW9INhjh54thlDUlHj+4/b2fr3OtGS5SWNCapwHrNtl1TiA19PLFKkzNOc7SK1jZfccf83XmXy90eCkqxZ1/tbqT3bblBNZIY42Vt0sjjH0hxZx261VhjMdr8hnMur1W+4d8sbN7BGInxql+5+vwE3HdGDYZcYO0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;0c275c70415f2f44&quot;
        title=&quot;0c275c70415f2f44&quot;
        src=&quot;/static/f816268a3571e8e0adefd78574ca4eb8/1d69c/0c275c70415f2f44.png&quot;
        srcset=&quot;/static/f816268a3571e8e0adefd78574ca4eb8/4dcb9/0c275c70415f2f44.png 188w,
/static/f816268a3571e8e0adefd78574ca4eb8/5ff7e/0c275c70415f2f44.png 375w,
/static/f816268a3571e8e0adefd78574ca4eb8/1d69c/0c275c70415f2f44.png 750w,
/static/f816268a3571e8e0adefd78574ca4eb8/78797/0c275c70415f2f44.png 1125w,
/static/f816268a3571e8e0adefd78574ca4eb8/8b70b/0c275c70415f2f44.png 1266w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;请注意，由于显示了滚动条，当内容变长时，它是如何移位的。我们可以通过使用 &lt;code&gt;scrollbar-gutter&lt;/code&gt;属性来避免这种行为&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.element {
    scrollbar-gutter: stable;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8a52899196551d17fcd0eb00b8a5925c/8b70b/e58ae0a10271c462.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 57.446808510638306%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABz0lEQVQoz6WSSZPTMBSE8///ERy5QcGJGTIkjJdYXhJJXrTZiZP5KMuTwIEbh64n6bW69Fq9sbrET47L+cL5fP5vbJwfsdZhjMFai3PugWVvrcEaG9crx/ybY9f7m7vINE7xQAhBVVYURRGFvA+44B8c7zxN3SAKEbl3jo8Ps2wWguyOpOWevErYpVt22ZZKFXRBU1UpKhUoI0nEjrxO+Jn+4CV5ptaCzrdUpz1SbPFhXAQDTVuSFq+IsiA7pBxETttr7OQpfm2pvjxzckeSfI+oBHmRRXRDiw2BovhG8f0DYbqyccsLhyO96eM4y2hLNYNhmi/IQ0b9dYsOmn7ocO+cBWYYmM5XZPOMePpImOb3kfuGttMEP0Yx7z1jCMy3G8csWQW9ou0UY5hiP/jANI7M8xtNs0W8fCKMl1Xw1Nf42XHjyvVtjphvF268Uad7qs9PSH9CdUesMxg7xDrYHj96DuqVV7FjXDxcRlCD5KRK6jKPn1HJFXVbUpYpOq/QRnOoMtIiIRN/cCgzCpnRqDpOF2PjQ8CqHp1WSKWQJ4mSCqX06lnwD1+llCilIrTSkWuGNToxNvdwRqOXi95Fj9Z6D659cJZe5Hr31/5P/zd/nEJtgXSoJAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;e58ae0a10271c462&quot;
        title=&quot;e58ae0a10271c462&quot;
        src=&quot;/static/8a52899196551d17fcd0eb00b8a5925c/1d69c/e58ae0a10271c462.png&quot;
        srcset=&quot;/static/8a52899196551d17fcd0eb00b8a5925c/4dcb9/e58ae0a10271c462.png 188w,
/static/8a52899196551d17fcd0eb00b8a5925c/5ff7e/e58ae0a10271c462.png 375w,
/static/8a52899196551d17fcd0eb00b8a5925c/1d69c/e58ae0a10271c462.png 750w,
/static/8a52899196551d17fcd0eb00b8a5925c/78797/e58ae0a10271c462.png 1125w,
/static/8a52899196551d17fcd0eb00b8a5925c/8b70b/e58ae0a10271c462.png 1266w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;CSS-Flexbox中的最小内容尺寸&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#CSS-Flexbox%E4%B8%AD%E7%9A%84%E6%9C%80%E5%B0%8F%E5%86%85%E5%AE%B9%E5%B0%BA%E5%AF%B8&quot; aria-label=&quot;CSS Flexbox中的最小内容尺寸 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CSS Flexbox中的最小内容尺寸&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;If a flex item has a text element or an image that is bigger than is longer than the item itself, the browser won’t shrink them. That is the default behavior for flexbox.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Consider the following example.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果一个flex项中的文本元素或图像大于或长于该项目本身，浏览器就不会缩小它们。这就是Flexbox的默认行为。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.card {
    display: flex;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;When the title has a very long word, it won’t wrap into a new line.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当标题有一个很长的单词，它不会插入到新的一行。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/23df159e9bb4c9b03e944d4ae95432f2/8b70b/ea1f9630ee4d52d1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.27659574468085%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1ElEQVQoz42SiW4DIQxE9/+/s92KJntim2OlnWrcJsqSo0EaAcZ+DEcXx09oFtRSUUo5KOd8pzanVSeaIFEQY7xKRGFmSJYOIPaMq+oh/1adD4QQcXHOwpP2GPUEU/PYsixIKYGt1vq3sdypawNMTDnhLF+Y9IwYBeu6YpomX9/33Tdk7LbmJZBHKrmi5OJuqG3bvCeMTpnTwp4CWTTaNxYboaJeTEcXV/M8I4Rwnf/rkMAgHxg0+B22wGEY0Pf9+0AC1H5f+tHXefvIl8VnX+KRWoc/fDi3LZgzCJ4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ea1f9630ee4d52d1&quot;
        title=&quot;ea1f9630ee4d52d1&quot;
        src=&quot;/static/23df159e9bb4c9b03e944d4ae95432f2/1d69c/ea1f9630ee4d52d1.png&quot;
        srcset=&quot;/static/23df159e9bb4c9b03e944d4ae95432f2/4dcb9/ea1f9630ee4d52d1.png 188w,
/static/23df159e9bb4c9b03e944d4ae95432f2/5ff7e/ea1f9630ee4d52d1.png 375w,
/static/23df159e9bb4c9b03e944d4ae95432f2/1d69c/ea1f9630ee4d52d1.png 750w,
/static/23df159e9bb4c9b03e944d4ae95432f2/78797/ea1f9630ee4d52d1.png 1125w,
/static/23df159e9bb4c9b03e944d4ae95432f2/8b70b/ea1f9630ee4d52d1.png 1266w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;即使我们使用 &lt;code&gt;overflow-break: break-word&lt;/code&gt;,它不管用。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.card__title {
    overflow-wrap: break-word;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;要改变这个默认行为，我们需要设置flex项目的&lt;code&gt;min-width&lt;/code&gt;为&lt;code&gt;0&lt;/code&gt;。这是因为&lt;code&gt;min-width&lt;/code&gt;的默认值是&lt;code&gt;auto&lt;/code&gt;，所以出现了溢出&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;**.card__title {
    overflow-wrap: break-word;
    min-width: 0;
}**&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;同样的方法也适用于列flex容器，但是我们使用&lt;code&gt;min-height： 0&lt;/code&gt;来代替。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/201f96baf2902f5924da25f7ea02b3a4/8b70b/2abc2f0b939398f3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 32.4468085106383%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlUlEQVQY042Q3QrDIAyFff/HrIVtUFY1P+puMhKnOFlhFx/G5ORo4uB5E8ootb6k1joopVwy61YcUhYEFAAY6J2JG9zIOQ8Qv/UzzgIEE3Wh/uLkQyKfAtDyIQRDY63bw5+eGbcmuuEDvRx4l93vsvlNYoxWJyIbrRuuxj8NtYmYbNS+z3lPWv/LcBZ1Ukrj7FyZqeEbfTTPNI/qMTsAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;2abc2f0b939398f3&quot;
        title=&quot;2abc2f0b939398f3&quot;
        src=&quot;/static/201f96baf2902f5924da25f7ea02b3a4/1d69c/2abc2f0b939398f3.png&quot;
        srcset=&quot;/static/201f96baf2902f5924da25f7ea02b3a4/4dcb9/2abc2f0b939398f3.png 188w,
/static/201f96baf2902f5924da25f7ea02b3a4/5ff7e/2abc2f0b939398f3.png 375w,
/static/201f96baf2902f5924da25f7ea02b3a4/1d69c/2abc2f0b939398f3.png 750w,
/static/201f96baf2902f5924da25f7ea02b3a4/78797/2abc2f0b939398f3.png 1125w,
/static/201f96baf2902f5924da25f7ea02b3a4/8b70b/2abc2f0b939398f3.png 1266w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;CSS-网格中的最小内容尺寸&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#CSS-%E7%BD%91%E6%A0%BC%E4%B8%AD%E7%9A%84%E6%9C%80%E5%B0%8F%E5%86%85%E5%AE%B9%E5%B0%BA%E5%AF%B8&quot; aria-label=&quot;CSS 网格中的最小内容尺寸 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CSS 网格中的最小内容尺寸&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;与flexbox类似，CSS grid对其子项目有一个默认的最小内容尺寸，即&lt;code&gt;auto&lt;/code&gt;。这意味着，如果有一个元素比网格项大，它将溢出。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/97045195f2924e517c5f634960992acb/0d98f/f7312a88bd883049.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 65.95744680851064%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACD0lEQVQ4y4WS3W4TMRBG88o0qYQQlzxYLzaRUIVoaVELgRCaJoFN9tf22l7be5BdSkNbwUifRvbYx5/tGb15PeHlqwlHL8ZMJlETxuNx0tH4KCmNjw70u358fPzX+qhRZyzWWGL44Om0ZhgG/hUhBKy1FEVBWZYIKTHGpLmREC1CCPq+RxuL6jTW9jjv0gE+uAQI7k6DH9Ba07Yty+WS7XabwFVVpblRhMl0gqNtA0IEpPTIXlDbiqav0EZjS4etHH3j0NokEzc3N2w2G/b7PXVdp7kEVEqitaNpfJIQD8CoO6BP0L7xmGeA0eEfYHRoe4fqLH0f8B601XRGEYhXdmipccYzuCG9V9wXr3x7e/vUoZQKZzp8s8ebLj1uby3eD2yKgaIN9M6ijUkfFutx3z2oaZrHQEmwBlSTsg8DwxBwfmBbeMo2pLH3If3yvUOlVNp7qNF9IbZLUVd47/hf9KZHCpmgj5WAulPku47T04r5V81Cz7k0Z+Q/djRnmvKz4mon+bBRLOWay+49C/EFKRRCPgHGllGUZeDiAq4/OT7qc97ajM1qS5NpdueSd1vJ7LviWnzj1GR8Ulco+cyV7x40fnmEdtR1R60qSlUgWoEsFKJSlEJSNJJGteTNT/IqT418qORwPp9zcnLCdJo9KJsyzWZk04xslqU8zTJmB7WYF4sF6/U6tc5qtSLPc34ByurBgHB/MK8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;f7312a88bd883049&quot;
        title=&quot;f7312a88bd883049&quot;
        src=&quot;/static/97045195f2924e517c5f634960992acb/1d69c/f7312a88bd883049.png&quot;
        srcset=&quot;/static/97045195f2924e517c5f634960992acb/4dcb9/f7312a88bd883049.png 188w,
/static/97045195f2924e517c5f634960992acb/5ff7e/f7312a88bd883049.png 375w,
/static/97045195f2924e517c5f634960992acb/1d69c/f7312a88bd883049.png 750w,
/static/97045195f2924e517c5f634960992acb/78797/f7312a88bd883049.png 1125w,
/static/97045195f2924e517c5f634960992acb/0d98f/f7312a88bd883049.png 1276w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在上面的例子中，我们在主部分有一个 carousel。为了说明情况，这里是HTML和CSS。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;div class=&amp;quot;wrapper&amp;quot;&amp;gt;
    &amp;lt;main&amp;gt;
        &amp;lt;section class=&amp;quot;carousel&amp;quot;&amp;gt;&amp;lt;/section&amp;gt;
    &amp;lt;/main&amp;gt;
    &amp;lt;aside&amp;gt;&amp;lt;/aside&amp;gt;
&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;@media (min-width: 1020px) {
    .wrapper {
        display: grid;
        grid-template-columns: 1fr 248px;
        grid-gap: 40px;
    }
}

.carousel {
    display: flex;
    overflow-x: auto;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;由于carousel是一个灵活的容器，不会换行，它的宽度比主部分大，因此网格项也“尊重”它。结果，出现了水平滚动。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了解决这个问题，我们有三种不同的解决方案。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;使用 &lt;code&gt;minmax()&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;为网格项设置 &lt;code&gt;min-width&lt;/code&gt; &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;为网格项添加 &lt;code&gt;overflow: hidden&lt;/code&gt; &lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;作为一种防御性的CSS机制，我会选择第一种，即使用 &lt;code&gt;minmax()&lt;/code&gt; 函数&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;@media (min-width: 1020px) {
    .wrapper {
        display: grid;
        grid-template-columns: minmax(0, 1fr) 248px;
        grid-gap: 40px;
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;自动填充-VS-自动适应&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85-VS-%E8%87%AA%E5%8A%A8%E9%80%82%E5%BA%94&quot; aria-label=&quot;自动填充 VS 自动适应 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自动填充 VS 自动适应&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;当使用 CSS 网格的 minmax() 方法是，决定使用&lt;code&gt;auto-fit&lt;/code&gt;还是&lt;code&gt;auto-fill&lt;/code&gt;的关键字很重要。一旦使用不当，会导致意想不到的结果。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当使用minmax()函数时，auto-fit关键字将扩展网格项目以填补可用空间。而auto-fill将保留可用的空间，而不改变网格项的宽度。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1b1dd44b3e03d2059e8898be8ce47db8/322c5/c7a83147b5b25888.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.76595744680851%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAADNUlEQVQ4y4WP609bBRTA+/eYaOZryADHYxsbGY+wET/4wY9miR82J9GNR4aCMDQxLi6MjLjA2jIGxMlEZC2l7eUxaMMosElLIaF0NNDb0nu53FcLP9OiiYkfPMnvnOTknF/OseQV3eRsxddcqGrjQnUbVZduc7G2g5LyFsor2yivbKWipp1zF1spPneLsxXfkH+6gbzCG3zw4c3/YCkoaeR8ZRvVlzupvvwdNXWd1NR1UFnbTtWlDqpqO6it68zV02eaKTl/i6IzzRSWNXGquCEn/4ecMNv8/rbAxGiC8ZEEPfcEFqefsPVqgsWZp4x0/UpkxMfWyDxDd5/yYMHDcHiOx8FZPvr0B04W3KCgtJHC0sac1FJQ2kD33QUWZw7xeQ8Zsi8QC/5BOj7D65ATwTqOKfxJWniFq8/JL1E/rv0VHHtLfPzZj7yb9yX5xQ1kP80JT5U00NuzQugFvPTBb8MryFsToPpJRd34B13gXwd/mNkBD2PJALNHIQRzlU+u/cT7+V9RWNpEUVlTTmp54+2rXLlip/NbgfZWgS+u2+m60421p5euO/dpudaNtW0Ia+sgzVfvU3/PSnPvAI0/P6KspoU33/mcE3n1nDhZz1vvXccy/OQ5/Y8FHtrdWPuzeOizCTzsF+izebENCDywTdLX78X6yIvd5sVuF3IMDs+S3f83FnKhk04rmOY+qppE0yTgCMNUMU0dXVOOxzji/8KiGwbbUYm1VZGNtSThUJLt6C5ibA0xtsFONIiuiOhxCW07iRZLYsT2kGSZqJZkW00SVRPENZlM5hCLYWisvUwz7dCZc+tMO9NEQrvoOx72t7worz0o23Mo80FkxyKSK4DqWGZ9M8xoKsC4GGBUXGBeCh9fqGkqoRWTKccBc26VKafBZnAHNeZBiniRt9woMR+KL4Q8sYTsXkZzrbARWWdMWsKRWGIssYhfXj8WHh1lCC4bTD1TeT6pMuUw2FzNCt1IEQ9yZBIlNo8yH0J2BJBcS6jOZTY2w/yeCvAskb3wBT7pb2E2KXKGZDzDnnhcVUUnoycw1SwiaS1FOqVgxiVMUSYjyhyoB+yaMnFDYteQSJkHOeFf56swwRgl+ngAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;c7a83147b5b25888&quot;
        title=&quot;c7a83147b5b25888&quot;
        src=&quot;/static/1b1dd44b3e03d2059e8898be8ce47db8/1d69c/c7a83147b5b25888.png&quot;
        srcset=&quot;/static/1b1dd44b3e03d2059e8898be8ce47db8/4dcb9/c7a83147b5b25888.png 188w,
/static/1b1dd44b3e03d2059e8898be8ce47db8/5ff7e/c7a83147b5b25888.png 375w,
/static/1b1dd44b3e03d2059e8898be8ce47db8/1d69c/c7a83147b5b25888.png 750w,
/static/1b1dd44b3e03d2059e8898be8ce47db8/78797/c7a83147b5b25888.png 1125w,
/static/1b1dd44b3e03d2059e8898be8ce47db8/aa440/c7a83147b5b25888.png 1500w,
/static/1b1dd44b3e03d2059e8898be8ce47db8/322c5/c7a83147b5b25888.png 2286w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;也就是说，使用&lt;code&gt;auto-fit&lt;/code&gt;可能会导致网格项目太宽，特别是当它们小于预期时。考虑一下下面的例子。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.wrapper {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    grid-gap: 1rem;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果只有一个网格项目，并且使用了&lt;code&gt;auto-fit&lt;/code&gt;，该项目将展开以填充容器宽度。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/be86135edcfdd4a3d86040ccb22572ea/0330c/2b340088c3b1a9f9.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50.53191489361703%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpUlEQVQoz5WRW2/aQBCF+f9/p/QlzbVpMUkpkSq1JVEAU9KEu7G9M2N84avWkFD61odPu2eOdLRntuHmYySLyfOSoszZbnOqV7wuDhRlSV5td5T+LMi3f5HnNNQyVI0sU5ZzYTQQxqHyOxRelsJgJYRLIVwpyWKCvgyQSYhMR8hzjAwTdJggowRxQkNEWEdrUhfR7zkumspZM6J9qnRHwvuho/kQ8eEpJ+p/QzrvWN820R/n6NcFaXNG3HzBLle7QFVlMpkyfgoJH2PuAqPbdnzvGL1nJXhW2mNHZ7phPX7EegGu10YHXeTnCgkiXLDE7uLDC818ZV9dSdMEM6GsCizzOq7PWpvU2q+nqgpUXa03mdXaZ9WBPsgyI14Ls4ljMdOa+VSYTw/aM5vKztv7s1d/LrtAH5YkKUmyYvDg+HRitC+M4Fz3WM3nU8f1SbzXeuS3TpUv14rzlX3dxWLJr/GQ/n1M68y4uRRurpTbK3vDz4Lz9GhW89F7Rre1D3zd4WazIU2FxTxmHTlUCjZZRWYH/tXHlIfK/vK2S1OyzP4b/wc+8A/Cbu+xZYFCGwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;2b340088c3b1a9f9&quot;
        title=&quot;2b340088c3b1a9f9&quot;
        src=&quot;/static/be86135edcfdd4a3d86040ccb22572ea/1d69c/2b340088c3b1a9f9.png&quot;
        srcset=&quot;/static/be86135edcfdd4a3d86040ccb22572ea/4dcb9/2b340088c3b1a9f9.png 188w,
/static/be86135edcfdd4a3d86040ccb22572ea/5ff7e/2b340088c3b1a9f9.png 375w,
/static/be86135edcfdd4a3d86040ccb22572ea/1d69c/2b340088c3b1a9f9.png 750w,
/static/be86135edcfdd4a3d86040ccb22572ea/78797/2b340088c3b1a9f9.png 1125w,
/static/be86135edcfdd4a3d86040ccb22572ea/aa440/2b340088c3b1a9f9.png 1500w,
/static/be86135edcfdd4a3d86040ccb22572ea/0330c/2b340088c3b1a9f9.png 2458w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在大部分时间，这样的行为是不需要的。所以在我看来，使用&lt;code&gt;auto-fill&lt;/code&gt;是更好的。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.wrapper {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    grid-gap: 1rem;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5cef265ab518019b5f64bae6a5473ec3/0330c/21cfb7bbd51a3f12.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50.53191489361703%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjklEQVQoz42QW2/TQBSE8///DuYBaCmoglhVSCUkUFI1sU1Cc/Mla+8569hOvspOmiAeoA+j1WhmZ2e2ZzczpDRUVUPdVBwOFfsXtLy+oG4aqv3hiKY9a6rDH6gqeupKVB1lqSQbIZoKs1D5HQqLRJimQpgIYark8RJdTJFliKwi5MkgQY4GORLliBV6IsI221LYjMnIcuMp116Gf6UMI+FtYPEeMj7MK7LJd2Twhu2dh/78iH6LKbw1xlvgPqXHQFVluVwxm0eEj4b7vmPoW34MHOMnxV8o/twyWO0w80fcuI8d+bhgiI5StJ9h/QR3by4NnWsnt9OVoshxTmj2dceNMYgqdV3TeluuJ26t7bhTd9a7wNbgSofZCuulJdk44rVQFIKI7XQV6S5Ye/SL6JGfdDnp3eQ8L8jzlODBcvtOuX1v8G+UNG7bX8xdsP6b99q5cZzwaxYwGRu+XilfrrfcfVbSRLr5Lxdeg/Mf7na7bmK8Md10ler8uoqe2/wPvb8rtxPL0nU4B+rrA58B4In41Ep+ku0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;21cfb7bbd51a3f12&quot;
        title=&quot;21cfb7bbd51a3f12&quot;
        src=&quot;/static/5cef265ab518019b5f64bae6a5473ec3/1d69c/21cfb7bbd51a3f12.png&quot;
        srcset=&quot;/static/5cef265ab518019b5f64bae6a5473ec3/4dcb9/21cfb7bbd51a3f12.png 188w,
/static/5cef265ab518019b5f64bae6a5473ec3/5ff7e/21cfb7bbd51a3f12.png 375w,
/static/5cef265ab518019b5f64bae6a5473ec3/1d69c/21cfb7bbd51a3f12.png 750w,
/static/5cef265ab518019b5f64bae6a5473ec3/78797/21cfb7bbd51a3f12.png 1125w,
/static/5cef265ab518019b5f64bae6a5473ec3/aa440/21cfb7bbd51a3f12.png 1500w,
/static/5cef265ab518019b5f64bae6a5473ec3/0330c/21cfb7bbd51a3f12.png 2458w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;图片最大宽度&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9B%BE%E7%89%87%E6%9C%80%E5%A4%A7%E5%AE%BD%E5%BA%A6&quot; aria-label=&quot;图片最大宽度 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;图片最大宽度&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;作为一般规则，不要忘记给所有的图片设置最大宽度：100%。这可以添加到你使用的 CSS reset 中。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;img {
    max-width: 100%;
    object-fit: cover;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h1 class=&quot;heading title heading&quot; id=&quot;Position-Sticky-Css-Grid&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Position-Sticky-Css-Grid&quot; aria-label=&quot;Position Sticky Css Grid permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Position: Sticky Css Grid&lt;/h1&gt;
&lt;p class=&quot;para&quot;&gt;你有没有试过对网格容器的一个子项使用 &lt;code&gt;position: sticky&lt;/code&gt;？网格项目的默认行为是拉伸 stretch 。结果是，下面的例子中的旁置元素等于主部分的高度。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/68211589d39e702b1e12c7529a90a16c/29007/6a6c39468c2d2fa2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.06382978723405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6UlEQVQoz5WS226EMAxE+f9/5LWtVJUkjh1yAaZyireAULcbaTJCxJODzRC/3pAyo5aKVitKKcg5I5v/Q1pjGiILiAg0Tfj8eAc5h0QEEcE8z0+VUvqp3zXoFonA3mMcR4QQgNbARPDe92d1k3Pu4cyM1hpijD1MfdAthgAJAc576Go5Q5j7IS26Uulnmt8GkgYS9cBt23pg1oK9L7XWk6xf67p23QZq3ybn0JYFy06o7/jgJu1vOVx2G1gkwVZTup3wOMnrZP8kLCK/gTkjiZzIlOpFQjkTpvT033uJ0KZ8PGxSSgu9En4DbnYHb5C9+kkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;6a6c39468c2d2fa2&quot;
        title=&quot;6a6c39468c2d2fa2&quot;
        src=&quot;/static/68211589d39e702b1e12c7529a90a16c/1d69c/6a6c39468c2d2fa2.png&quot;
        srcset=&quot;/static/68211589d39e702b1e12c7529a90a16c/4dcb9/6a6c39468c2d2fa2.png 188w,
/static/68211589d39e702b1e12c7529a90a16c/5ff7e/6a6c39468c2d2fa2.png 375w,
/static/68211589d39e702b1e12c7529a90a16c/1d69c/6a6c39468c2d2fa2.png 750w,
/static/68211589d39e702b1e12c7529a90a16c/78797/6a6c39468c2d2fa2.png 1125w,
/static/68211589d39e702b1e12c7529a90a16c/aa440/6a6c39468c2d2fa2.png 1500w,
/static/68211589d39e702b1e12c7529a90a16c/29007/6a6c39468c2d2fa2.png 1600w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了让它能按照预期的那样工作，你需要重置 &lt;code&gt;align-self&lt;/code&gt; property.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;aside {
    align-self: start;
    position: sticky;
    top: 1rem;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/51d67ad7ac2cf65ac44c4c80d896af4c/29007/af908792cd995efe.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.06382978723405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6ElEQVQoz5WSbW+EIBCE/f//0a9tk0aBZUFeqtMMPRrOermrycOKsOOwy+SXN8SkKLmgloKcM1JKSD2+AHM6k9cAEYGsKz4/3iHGIIoghIBt254SY/zJvzFx8CJQazHPM5xzQK1QEVhr25yxY4z5jaqKWiu8902MceLgnUNwDsZa8KkpIai2TUw6u+Ixe7wUFAqKNMHjOJpgYsKtLqWUO3q99n1vXAqybuuytMZ8bVtzyDUdYof1zcPP/gryaM7dcdXJ8/zSYX+RE+ze6Iyu/uXQD3D+yt17WMORvkAXvDLjtw5ddtGzw28xkQXMg0Xb6AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;af908792cd995efe&quot;
        title=&quot;af908792cd995efe&quot;
        src=&quot;/static/51d67ad7ac2cf65ac44c4c80d896af4c/1d69c/af908792cd995efe.png&quot;
        srcset=&quot;/static/51d67ad7ac2cf65ac44c4c80d896af4c/4dcb9/af908792cd995efe.png 188w,
/static/51d67ad7ac2cf65ac44c4c80d896af4c/5ff7e/af908792cd995efe.png 375w,
/static/51d67ad7ac2cf65ac44c4c80d896af4c/1d69c/af908792cd995efe.png 750w,
/static/51d67ad7ac2cf65ac44c4c80d896af4c/78797/af908792cd995efe.png 1125w,
/static/51d67ad7ac2cf65ac44c4c80d896af4c/aa440/af908792cd995efe.png 1500w,
/static/51d67ad7ac2cf65ac44c4c80d896af4c/29007/af908792cd995efe.png 1600w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h1 class=&quot;heading title heading&quot; id=&quot;选择器分组&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%80%89%E6%8B%A9%E5%99%A8%E5%88%86%E7%BB%84&quot; aria-label=&quot;选择器分组 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;选择器分组&lt;/h1&gt;
&lt;p class=&quot;para&quot;&gt;我们不建议将那些需要在不同浏览器上使用的选择器分组。例如，为一个输入的占位符设计样式，需要在每个浏览器上使用多个选择器。根据w3c的规定，如果我们把选择器分组，整个规则就会失效&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;_/* Don&amp;#39;t do this, please */_
input::-webkit-input-placeholder**,**input:-moz-placeholder {
    color: #222;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;而是这样做：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;input::-webkit-input-placeholder {
    color: #222;
}

input:-moz-placeholder {
    color: #222;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h1 class=&quot;heading title heading&quot; id=&quot;这不是终点&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%BF%99%E4%B8%8D%E6%98%AF%E7%BB%88%E7%82%B9&quot; aria-label=&quot;这不是终点 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;这不是终点&lt;/h1&gt;
&lt;p class=&quot;para&quot;&gt;这还不是结束，但我真的很喜欢记录所有这些技术。这是一个正在进行的防御性CSS技术的列表，我个人使用这些技术取决于我正在做的项目。如果你有什么建议，请通过Twitter @shadeed9联系我们&lt;/p&gt;</content:encoded></item><item><title><![CDATA[《架构修炼师之道》摘录03-制定设计策略]]></title><description><![CDATA[本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。 全书整体分为三个部分 第一部分介绍软件架构的基础知识和架构师必备的设计思维 第二部分讲解架构师需要掌握的核心技能和知识 第三部分讨论一系列…]]></description><link>https://zhanglun.github.io/blogs/《架构修炼师之道》摘录03-制定设计策略/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/《架构修炼师之道》摘录03-制定设计策略/</guid><pubDate>Thu, 14 Oct 2021 10:30:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;全书整体分为三个部分&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第一部分介绍软件架构的基础知识和架构师必备的设计思维&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第二部分讲解架构师需要掌握的核心技能和知识&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第三部分讨论一系列使用的架构设计方法&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;前两部分适合从头到尾通读，第三部分用于参考和检索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;第三章的标题是“制定设计策略”，本章将学习如何根据系统风险选择思维模式，并将其作为设计策略的一部分。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构设计很容易陷入混乱无序的状态。即使是系统充满了不确定性，也必须制订计划。凡事预则立，只有凭借稳固的设计策略，才能应付各种不确定性。有的人认为检验架构需要先将其实现，但是本书中的建议是：设计过程中逐步验证架构的各个部分，同时运用思维模式和TDC循环确定下一步做什么。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;31-找到够用的设计&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#31-%E6%89%BE%E5%88%B0%E5%A4%9F%E7%94%A8%E7%9A%84%E8%AE%BE%E8%AE%A1&quot; aria-label=&quot;31 找到够用的设计 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3.1 找到够用的设计&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在理性的世界中，我们可以先完成得定义问题，然后在设计完美的架构解决问题。很可惜，我们生活的不是一个理性的世界。“有限理性”这个词被创造出来，用于描述由时间、资金、技术、知识等限制造成的障碍，这些障碍增加了解决问题的难度。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构设计的目标不是理性地寻求最佳设计，而是找到一个够用的设计。只要能满足需求、令人满意，就是够用的设计。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;可以通过强化以下方法来寻找够用的设计。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;将解决方案看成实验&lt;/strong&gt;。架构师不是无所不知的先知。应该将每个可能的解决方案当成待验证的实验。验证的速度和效率越高，找到合适的组合结构的时间就越短，相关利益方受益越快。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;设法降低风险&lt;/strong&gt;。架构是软件系统的基础。如果架构出错，那一切都完了。架构师必须时刻考虑哪些地方可能会出错，并据此展开设计。根据风险决定接下来设计什么。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;努力简化问题&lt;/strong&gt;。简单的问题通常也有简单的解法。简化问题的方法很多，比如减少利益相关方的数量可以减少冲突的观点。增加或减少约束条件，关注问题的子集，也可以降低问题的复杂度。识别常规问题，使用现成的解决方案，运用集体经验解决。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;快速迭代学习&lt;/strong&gt;。学习得越快就探索得越多，对解决方案也就越有信心。如果有可能失败，越早知道越好。设计周期太长往往是因为目标过于宏远抽象，相比之下，我们更喜欢能产生具体成果得频繁迭代设计。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;同时考虑问题和解决方案&lt;/strong&gt;。问题的边界是由可能的解法勾勒得。为了理解问题，我们必须探索各种解决方案，而为了更好地探索解决方案，我们又必须加深对问题的理解。设计软件架构需要我们同时考虑问题及其解决方案。在架构设计初期试着编写一些代码，就是这种策略的具体运用。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;避免“完全理性”的设计不是放弃理性和计划，我们仍然要实现做一些架构设计工作，确定哪一部分架构马上设计，哪些以后考虑。尽早制定出这样的设计策略，既可以让团队明白架构将如何生长，也能培养各方对项目的信心。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;32-决定前期做多少架构设计&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#32-%E5%86%B3%E5%AE%9A%E5%89%8D%E6%9C%9F%E5%81%9A%E5%A4%9A%E5%B0%91%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1&quot; aria-label=&quot;32 决定前期做多少架构设计 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3.2 决定前期做多少架构设计&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;所有软甲系统都有架构，都离不开架构。如果前期不设计交媾，那么开发出来的系统可能不符合要求。适当的时间设计架构能降低未来返工的风险。但是前期在架构设计上花的时间太长也会耽误开发，延迟交付。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;软件系统的规模和需求各不相同，但每个系统都有一个设计的最佳平衡点——在开发之前用最适合的时间设计架构。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在《Architecting: How Much and When》一书中，作者 Boehm 证明了开发、架构设计、返工是构成项目工期的三个主要部分。返工包括弥补设计缺陷、重写代码、改正错误等。要找到最佳平衡点，必须整体考虑设计成本，以及为了完成系统不可避免的返工。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 666px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e2e3c8be16af9a72e2d801b11cd13d0b/ace37/fa795eed65810ec2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.61702127659575%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXUlEQVQoz5VRbWuCUBT2R/eTgrHITJOcfohePkzYCksKshIb2bXa7txMLMOecW+zBVtjO3A47w/POUcAgOPxiEth8U96WbsmQpZl3AmCALphwPf9q82/AX0DfKUUj+Y9AkLYJJI4xn6/B6unaYrdbncGZbmc6aXPVMiRM3eCVLrFu3iD+K6G6OUZrufBdV3OPkkS/EWEYrGIQqGAN0rh2DbCpQ/yCUSWSw40nU55vFqtOOvRaARCCKIogm3bWK/XXwx7vR40rQ5nMoFar+NpscBDt4tms4nZbIYwDNFoNNBqtWBZFjabDURRhGma8DwP5XIZ/X4fh8PhxLDdbkOSJCiyDE3TUFMUqKoKXdd5vlQqneqKgmq1ymNZllGpVDgY81ktP4kQxzE/+Hg85k2GYaDT6fCm+XzOV2SrMd1ut2D9zOY+yzObP/f8FEopX2k4HMJxHAwGAz70H2E3/AC6GZvoLZVp2gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;fa795eed65810ec2&quot;
        title=&quot;fa795eed65810ec2&quot;
        src=&quot;/static/e2e3c8be16af9a72e2d801b11cd13d0b/ace37/fa795eed65810ec2.png&quot;
        srcset=&quot;/static/e2e3c8be16af9a72e2d801b11cd13d0b/4dcb9/fa795eed65810ec2.png 188w,
/static/e2e3c8be16af9a72e2d801b11cd13d0b/5ff7e/fa795eed65810ec2.png 375w,
/static/e2e3c8be16af9a72e2d801b11cd13d0b/ace37/fa795eed65810ec2.png 666w&quot;
        sizes=&quot;(max-width: 666px) 100vw, 666px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;最佳平衡点主要由软件规模、需求变更、系统复杂度决定给。作者证明随着架构规划时间的增加，返工量会逐步减少。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在这个例子中，当用于架构设计的时间少于20%时，最终的项目工期随着架构设计时间的增加逐步减少，但边际效益在递减。随着架构设计时间的进一步增加，虽然返工量仍然会减少吗，但整个项目的工期反而变成了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;除此之外，作者还研究了随着系统规模变化，最佳平衡点的变动情况，这些数据可以用来评估你的架构设计时间是否在合理范围内。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这张图中包含了一些重要信息，分析一下其中要点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;软件系统越大，前期做架构设计的获益就越大&lt;/strong&gt;。大型软件系统（1000w行代码左右）将37%的时间花在架构设计上是一个明智的选择。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;软件系统越小，前期做架构设计的收益就越小&lt;/strong&gt;。1w行代码左右的系统华仔前期架构设计上的时间不应该超过5%。有时候直接重启收益更高。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;前期架构设计做的不够，要对后期返工做好心理准备&lt;/strong&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;前期架构设计的投入越多，后期返工就越少&lt;/strong&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;用系统规模来估计前期架构设计的工作量很方便，因为规模很容易衡量和预估。也可以使用系统复杂度来决定前期架构设计的工作量。不过这要是情况而定，对于有现成解决方案的系统，即使规模很大也可以不用做太多前期架构规划。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;322-示例架构对总工期的影响&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#322-%E7%A4%BA%E4%BE%8B%E6%9E%B6%E6%9E%84%E5%AF%B9%E6%80%BB%E5%B7%A5%E6%9C%9F%E7%9A%84%E5%BD%B1%E5%93%8D&quot; aria-label=&quot;322 示例架构对总工期的影响 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3.2.2 示例：架构对总工期的影响&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;假设我们正在开发一个规模约为十万行代码的系统，预计开发周期100天。按照前面提到的数据，如果我们只用 5%的时间做架构设计，那么项目总工期将延长43%。如果我们在架构设计上投入更多时间，如开发周期的 17%，那么项目总工期只会延长 38%。当然，继续延长架构设计时问并不意味着总工期会一直缩短。假设我们用三分之一的开发周期设计架构，尽管可以减少返工，但是整个项目的工期却延长了约40%，总工期反而变长了。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;架构设计时间&lt;/th&gt;
&lt;th&gt;返工时间&lt;/th&gt;
&lt;th&gt;总工期&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;5天&lt;/td&gt;
&lt;td&gt;38天&lt;/td&gt;
&lt;td&gt;143天&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;17天&lt;/td&gt;
&lt;td&gt;21天&lt;/td&gt;
&lt;td&gt;138天&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;33天&lt;/td&gt;
&lt;td&gt;7天&lt;/td&gt;
&lt;td&gt;140天&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;Boehm 的研究让我们大致了解了应该花多少时间来设计架构，但是我们还不知道何时开展设计，以及何时运用第二章提到的思维模式。Boehm也做过这方面的研究，他的建议是用风险决定何时关注架构。用正确的方式看待风险，借助它确定设计内容，并且让利益相关方参与设计过程。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;33-用风险做向导&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#33-%E7%94%A8%E9%A3%8E%E9%99%A9%E5%81%9A%E5%90%91%E5%AF%BC&quot; aria-label=&quot;33 用风险做向导 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3.3 用风险做向导&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;值得开发的软件总是有风险的。在新项目开始时，你感到不安是很自然的。毕竟，如果我们一开始就什么都知道，对要开发的东西没有任何疑问，那还要架构师做什么？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;应该充分利用这种不安。风险是很好的指示器，它提醒我们什么东西会构成障碍。凭直觉写下你对系统的担优和顾虑，对它们排序，列出优先级，把风险最高、最麻烦的排在前面。然后，选择合适的思维模式降低风险。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;直觉告诉我们从哪里开始，但它不会告诉我们如何前进。直觉告诉我们哪儿不对劲，但是要完成工作，我们不能仅仅依靠直觉。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;331-确定条件和后果&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#331-%E7%A1%AE%E5%AE%9A%E6%9D%A1%E4%BB%B6%E5%92%8C%E5%90%8E%E6%9E%9C&quot; aria-label=&quot;331 确定条件和后果 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3.3.1 确定条件和后果&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;描述风险需要两部分：条件和后果。条件是当前的实际情况，后果是由条件引发的、将来可能出现的不良状糠。建议使用一种简单的模板记录风险：条件；后果。只有清楚条件和后果，才能决定如何处理风险。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;332-借助风险选择思维模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#332-%E5%80%9F%E5%8A%A9%E9%A3%8E%E9%99%A9%E9%80%89%E6%8B%A9%E6%80%9D%E7%BB%B4%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;332 借助风险选择思维模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3.3.2 借助风险选择思维模式&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;软件架构设计是一项降低风险的活动。只要你为系统担心，就表明项目有风险。如果你能用清楚的 “条件；后果，描述风险，就能用它指导自己的设计活动。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;下面我列举几个以往项目中的风险，以及团队降低风险的对策。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;模型训练服务最初是为其他目的开发的；新请求可能会导致其过载。&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;思维模式：理解、评估&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;对策：与开发模型训练服务的团队进行沟通，了解其可伸缩性；做实验测算吞吐量。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;数据处理将消耗大量的时间和资源；可能无法顺利完成处理任务&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;思维模式：探索&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;对筑：头脑风鬆，探讨提高可華性的方法，研乳任务调度模式，寻找可缩短处理时间的替代设计方案。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;需要大量数据训练给计模型：数据的存储成本高，樓型可能无法盈利。&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;思维模式：展示&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;对策：建立成本估算模型，向利益相关方展示各种设计方案的利弊；通过调整待办列表(backlog）的优先级减小风险的时间窗口。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;存储的数据可能包含敏感的客户信息；对数据进行隔离的要求超出我们的能力范围。&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;思维模式：评估&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;对策：根据需求对可用的计算平台进行打分。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;风险帮助我们决定设计内容；思维模式帮助我们指定降低风险的策略。在面对必须降低的风险时，首先确定可以解决的部分：风险的条件、影响、概率、时间窗口。然后选择一种思维模式。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;如果&lt;/th&gt;
&lt;th&gt;可以尝试&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;要解决的问题还不确定，对于利益相关方和其他系统参与者，还需要更加深入地了解。&lt;/td&gt;
&lt;td&gt;理解&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;解决方案还不确定，需要充分了解可选的方案&lt;/td&gt;
&lt;td&gt;探索&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;利益相关方不完全了解准备实施的方案&lt;/td&gt;
&lt;td&gt;展示&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;在设计决策上举棋不定&lt;/td&gt;
&lt;td&gt;评估&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;333-风险降低之后转为被动设计&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#333-%E9%A3%8E%E9%99%A9%E9%99%8D%E4%BD%8E%E4%B9%8B%E5%90%8E%E8%BD%AC%E4%B8%BA%E8%A2%AB%E5%8A%A8%E8%AE%BE%E8%AE%A1&quot; aria-label=&quot;333 风险降低之后转为被动设计 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3.3.3 风险降低之后转为被动设计&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;架构师应该努力将技术风险降低到架构不再是系统中最大风险源的地步。一旦将架构风险降低到“恰如其分“的地步，就可以考虑将时间花在其他地方了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;此时可以从&lt;strong&gt;主动设计&lt;/strong&gt;转为&lt;strong&gt;被动设计&lt;/strong&gt;。主动设计是指主动设法降低架构风险。被动设计是指监控系统运行表现，只在必要时采取纠正措施。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;被动设计有很多工作可以作，比如进一步修改和完善文档；根据出现的新情况对架构进行微调。还可以通过结对编程和代码评审培训团队成员。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;除此之外架构还有可能重新成为最大的风险源。此时需要切回主动设计模式，根据实际情况调整架构。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;在架构设计之初，通过前文提到的TOC循环，尽可能地考虑周全，将架构设计完备，减少风险的出现，不让架构成为瓶颈。之后再通过一些手段，比如监控、灰度发布等手段验证运行，在遇到新问题时及时纠正，完善架构的设计。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;34-制订设计计划&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#34-%E5%88%B6%E8%AE%A2%E8%AE%BE%E8%AE%A1%E8%AE%A1%E5%88%92&quot; aria-label=&quot;34 制订设计计划 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3.4 制订设计计划&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;设计计划指出团队在架构上分配时间的总体策略。要花多少时间做前期分析？预计需求是否会发生变化？何时开始编写代码？良好的设计计划应该提出目标并解释这些细节。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;设计计划不一定是正式的时间表，但是要体现出架构师的思路。可以将计划记录在简单的文档中，格式不定，但是内容最好包括一下几个方面：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;结束设计的条件&lt;/strong&gt; 是限定前期设计的时间？还是通过设计将风险降低到预期？是在开发之前尽量少的前期设计？还是尽可能完整地做好架构规划？各部分的实施独立展开还是某许部分需要一起开始？这些都没有定数，很大程度取决于团队、利益相关方、项目背景的实际情况。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;必要的设计成果&lt;/strong&gt; 在开始之前，告诉大家你准备如何记录架构设计。是画在白板上拍照，还是传统的文档记录？是否有现成模板？设计成果（用例、类图、架构图、设计文档等）保存在哪里？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;时间节点&lt;/strong&gt; 给出关键设计工作的时间节点。无论项目大小，至少要给出对架构设计有重大影响的事件的时间节点。比如：需求评审、设计评审、技术评审。此外，还需要给出利益相关方会面的时间节点。在开发工作即将开始时，或者确定初期工作包含的范围时，需要召开相关的同步会议。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;重大风险&lt;/strong&gt; 使用的是风险驱动的设计方法，因此应该将重大风险也放在设计计划里。在软件系统的整个生命周期中，应该不断回顾风险列表。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;概念架构设计&lt;/strong&gt; 可以先从可行的解决方案里面选择一个。概念架构不用很复杂，你可以画一张草图，只要能表达初步的设计想法就行。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;明确方案设计的排期。根据实际情况，采用不同的标准。但无论如何，在制定设计计划时，都需要给到一个明确的设计完成时间。同时整个设计过程中的关键时间节点也需要明确。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;方案设计最终一定会产出一些内容。无论是何种形式，无论以什么载体保存数据，都需要将最后产出的内容存储记录。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在方案设计过程中，要时刻关注风险。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结语语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E8%AF%AD%E8%AF%AD&quot; aria-label=&quot;结语语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结语语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;本章学习了如何借助风险规划设计活动。风险可以帮助我们决定做多少前期架构设计，以及采用哪种思维模式解决问题。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;许多团队开发新系统的第一个风险是理解软件的受益对象。第4章将学习运用理解思维模式，设身处地地理解软件的服务人群。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;只有站在利益相关方的角度看待问题，你才能更深入地理解他们的实际需求。理解了利益相关方的实际需求，就能增加解决问题的机会。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[《架构修炼师之道》摘录02-设计思维基础]]></title><description><![CDATA[本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。 全书整体分为三个部分 第一部分介绍软件架构的基础知识和架构师必备的设计思维 第二部分讲解架构师需要掌握的核心技能和知识 第三部分讨论一系列…]]></description><link>https://zhanglun.github.io/blogs/《架构修炼师之道》摘录02-设计思维基础/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/《架构修炼师之道》摘录02-设计思维基础/</guid><pubDate>Sat, 04 Sep 2021 11:30:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;全书整体分为三个部分&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第一部分介绍软件架构的基础知识和架构师必备的设计思维&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第二部分讲解架构师需要掌握的核心技能和知识&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第三部分讨论一系列使用的架构设计方法&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;前两部分适合从头到尾通读，第三部分用于参考和检索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;第二章的标题是“设计思维基础”，整章的主要讲解如何在架构设计中运用设计思维。首先介绍设计思维的四条基本原则，然后学习使用思维模式确保架构设计朝正确的方向前进。最后教我们如何选择何时的思维模式。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;21-设计思维的四条原则&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#21-%E8%AE%BE%E8%AE%A1%E6%80%9D%E7%BB%B4%E7%9A%84%E5%9B%9B%E6%9D%A1%E5%8E%9F%E5%88%99&quot; aria-label=&quot;21 设计思维的四条原则 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2.1 设计思维的四条原则&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;设计思维是一种从他人的角度思考问题及其解决方案的一种方式。设计思维有基本的规则，在《Design Thinking: Understand Improve-Apply》一书提出了四条基本的设计原则。这些原则不仅适用于软件架构设计，也适用于程序设计，交互设计，以及所有设计工作。下面是这四条设计原则：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;以人为本（human）&lt;/strong&gt;：设计的本质是社交&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;推迟决策（ambiguity）&lt;/strong&gt;：推迟不确定的决策&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;善于借鉴（redesign）&lt;/strong&gt;：所有设计都是在已有设计基础上的重新设计和调整创新&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;化虚为实（tangibility）&lt;/strong&gt;：让想法具体化、有形化，以便于沟通交流&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;我们使用“HART”来记忆这些原则。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;211-以人为本-Design-for-Humans&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#211-%E4%BB%A5%E4%BA%BA%E4%B8%BA%E6%9C%AC-Design-for-Humans&quot; aria-label=&quot;211 以人为本 Design for Humans permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2.1.1 以人为本 Design for Humans&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;设计本身是围绕人展开的工作。软件既为人所用，也依靠人开发。架构设计中的每一个决策都要以某种方式让人们受益。每个设计决策也都必须与他人分享并获得理解。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构师必须要有同理心，能够理解利益相关方的要求。要关心的不仅是最终用户，还有最终用户要帮助的人，编写代码的程序员，测试人员，项目经理。设计软件系统需要与团队合作，请尊重他们，倾听他们的心声，理解他们的意图，这才是以人为本的设计方法&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;架构师要理解需求，理解背后的受益，站在利益相关方的角度来思考和设计。架构设计需要团队合作，架构师需要与团队成员多沟通、多倾听，换位思考。架构师处于多角色的中心，在团队中会承担起胶水的作用，将团队紧紧团结在一起。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;尊重所有直接和间接与架构有关的人，换位思考，理解他们的感受，你才能成为出色的架构师、沟通者、领导者。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;212-推出决策&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#212-%E6%8E%A8%E5%87%BA%E5%86%B3%E7%AD%96&quot; aria-label=&quot;212 推出决策 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2.1.2 推出决策&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;工程上的“模棱两可”是危险的，设计决策必须做到准确、清晰。在不到条件成熟的最后一刻，不要着急做出最终的决策。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;软件架构的目标是安排系统结构，提升期望的质量属性。建议设计极简主义架构。极简主义架构只关心高优先级的质量属性，只考虑如何在提升这些质量属性的同时尽量降低风险。除此之外的其他设计决策都可以悬置，等时机成熟之后再做决定。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这要求我们尽可能推迟那种一旦决定就难以更改的设计决策。推迟决策可以让我们更加从容地应对软件开发大环境的变化。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;213-善于借鉴&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#213-%E5%96%84%E4%BA%8E%E5%80%9F%E9%89%B4&quot; aria-label=&quot;213 善于借鉴 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2.1.3 善于借鉴&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;善于借鉴原则鼓励我们留心琢磨熟悉的事物——研究以往的设计、探索其中的规律。随着人们开发的软件越来越多，我们在软件设计方面沉淀的知识也越来越多。你所面临的问题，其他团队可能已经遇到过，甚至有可借鉴的解决方案。你完全可以在别人的基础上开始自己的设计。又或许有人已经搭建了框架，正好可以解决你的问题。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在设计软件架构之前，我们应该多花点时间研究已有的设计，而不是凭空创建一个新的出来。忽视千人的经验是最低效的架构设计方法之一。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;借鉴本身是一种非常好的学习方式。前人的经验总结可以在一定程度上帮助解决我们的问题。就像文中说到的，甚至有现成的方案或者框架可以采用。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;目前行业内对借鉴这事可以说是已经“炉火纯青”了。使用社区开源的方案，包装之后打上自己的标签和品牌，进行“二次开源”。对外获取影响力和声望，对内获取晋升的机会。但是在“二次开源”的过程中，大家往往都选择有意忽视自己借鉴、学习的方案，试图将自己的成果装饰成是开创性的、先进性的。这借鉴的开源项目及其作者、团队都是十分不公平的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;214-化虚为实&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#214-%E5%8C%96%E8%99%9A%E4%B8%BA%E5%AE%9E&quot; aria-label=&quot;214 化虚为实 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2.1.4 化虚为实&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;代码不够直观，不适合用来讨论质量属性、组件、设计原理、决策结果之类的问题。讲解架构设计，只展示代码是行不通的，必须用其他方式把架构呈现出来。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;呈现架构的方式有很多，可以画出来，可以制作原型或者简单的模型，可以演示部分系统的控制流程，甚至可以打比方。这些方式能从不同的角度展示软件的结构和质量属性，方便他人理解架构设计。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;化虚为实与以人为本密切相关。人们只有通过感性的认识才能理解和消化架构。分享架构的唯一方式是把它具体地呈现出来。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;22-运用思维模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#22-%E8%BF%90%E7%94%A8%E6%80%9D%E7%BB%B4%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;22 运用思维模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2.2 运用思维模式&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;设计软件系统需要我们从不同的角度考虑架构。设计思维模式可以帮助我们在合适的时机关注合适的细节。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;设计思维模式分为：理解、探索、展示、评估。每种思维模式都有配套的方法。设计架构时，我们先选择一种思维模式，再运用配套的方法发现架构，然后不断重复这个过程。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/967ae246abbaacd1a67d102ea891d809/99f37/169c8eb23aaa0a64.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.85106382978723%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACA0lEQVQoz02Q2Y7cNhRE+/8/LG8GEhtBxoZtTHqR1Nq4X+59DGliIA8FsorAubd46b1R4k5JipoNWVaSn8h+ILkHyQ/UbDE+s2jhuYdT8x5YlHxIC8YnWu9cWomUMNKrpxcDPQCRV3W0YulZkcPErBMuNqxUXOzEClYa2pczn1UkpsKl1QM40KuD7lnnO39++gPxGzR3Dikys+iET51YYFWev778gzL+9Km+TqB8ABM1zryah1dinR98//aFkjQ0z6s5xI1MmyC5kyrsJvD57zdW5U6f64tF/w94VG5po8YNqgbcf36hxZloHwxbxEhDhYo5Knfw6YWRio2dp06kXLm0VjF+QtsBZR9s5s6qruz2fnptH0hSuHVnv97ZrnfWf28s79fT77cHapjO99Yal1Qiq1+IJeOzkFqh0Ig1E0o8s80vpGmkqY2qFV0rcIamdsq60LRC7jdKCFxiEWY7EnJAijAtI2/f37DBIDkQkmexI3GeqdaCCHoaef/6Fdl3urN0EfztRvb+N3AglkRqiU1t/Hj/gRNHLPEcNKoraVno3kPwuGXh8fMnSSteEiAn4jhSJHxUfpoHJmqMKGzSuGLYw8rmZ1Y/89R3ZBjO2vE5kQ/4UXfbiEc2jYT7jZoSl947uSYO8O8zZuHY/FQWSivUGM8/+pA/t6kiFO8pzp33g/UL5mdNQMCmv4kAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;169c8eb23aaa0a64&quot;
        title=&quot;169c8eb23aaa0a64&quot;
        src=&quot;/static/967ae246abbaacd1a67d102ea891d809/1d69c/169c8eb23aaa0a64.png&quot;
        srcset=&quot;/static/967ae246abbaacd1a67d102ea891d809/4dcb9/169c8eb23aaa0a64.png 188w,
/static/967ae246abbaacd1a67d102ea891d809/5ff7e/169c8eb23aaa0a64.png 375w,
/static/967ae246abbaacd1a67d102ea891d809/1d69c/169c8eb23aaa0a64.png 750w,
/static/967ae246abbaacd1a67d102ea891d809/99f37/169c8eb23aaa0a64.png 1100w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;221-理解问题&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#221-%E7%90%86%E8%A7%A3%E9%97%AE%E9%A2%98&quot; aria-label=&quot;221 理解问题 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2.2.1 理解问题&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;理解问题要求我们主动从利益相关方获取信息，清晰地描述问题。理解对方的需求其实就是站在对方的角度考虑问题。为了理解问题，我们必须要了解所有与系统相关的人以及他们需要什么。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们纪要关心研究利益相关方关心的业务目标和质量属性，也要掌握开发团队自身的工作风格，这样才能把我设计的轻重缓急，取舍利弊。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;222-探索想法&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#222-%E6%8E%A2%E7%B4%A2%E6%83%B3%E6%B3%95&quot; aria-label=&quot;222 探索想法 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2.2.2 探索想法&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;探索指的是形成一系列设计概念，确定解决问题的工程方法。头脑风暴只是探索想法的一种手段。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;探索软件架构意味着尝试各种结构的组合，直到找到最能提升目标质量属性的那种组合。为了找到最佳组合，需要研究大量的模式、技术、开发方法。这种思维模式不仅能在架构规划时发挥作用，在与利益相关方协作时也能派上用场。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;223-展示想法&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#223-%E5%B1%95%E7%A4%BA%E6%83%B3%E6%B3%95&quot; aria-label=&quot;223 展示想法 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2.2.3 展示想法&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;最常见的展示方式是制作模型，除了线框图，你还可以制作原型、编写文档、展示数据，等等。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这种思维模式是帮助团队摆脱“分析瘫痪”的绝佳方式。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;224-评估适用性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#224-%E8%AF%84%E4%BC%B0%E9%80%82%E7%94%A8%E6%80%A7&quot; aria-label=&quot;224 评估适用性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2.2.4 评估适用性&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;我们怎么知道某一个设计决策是否真能解决问题呢？评估可以帮助我们发现设计决策是否合适。评估不是要么不做，要么全做。我们既可以评估全部架构，也可以评估部分架构，还可以只评估某个模型、概念、想法。最常用的评估方式是针对不同的场景审视某一块架构，还可以通过做实验，或者通过检查决策风险来展开评估。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;评估在验证架构设计时非常有用。评估还可以用来检查任何工作成果，判断它们是否满足我们的需求。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;思维模式需要与一种循环流程配合使用，以便我们能够从一种思维模式快速切换到另一种。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;23-思考动手检查&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#23-%E6%80%9D%E8%80%83%E5%8A%A8%E6%89%8B%E6%A3%80%E6%9F%A5&quot; aria-label=&quot;23 思考动手检查 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2.3 思考、动手、检查&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;软件开发每天都会接触到新东西，为了调整我们的思维模式，跟上不断变化的环境，我们需要一套循环流程。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这个方法分三步：思考、动手、检查。我们称之为 TDC 循环。每一次循环迭代都针对一种特定的思维模式展开。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3eff05929e445abd676e32a2dbcdbe4b/80cfc/b1e2660c9df0fb2a.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 44.680851063829785%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABT0lEQVQoz4WSC27bMBBEdf87NSfwIey2siKJMiXx/30FJTdB0gRdYMABCc7OLNmVUvgKtVZyUCQ7k91Mamg8GkqpfHev+yzyziGqXxS7EPVMMoJsBYSFdd3o+55Wn+923zuErHuqk6zTT4wcDl79ghAL1+v1/w7fxEoh5oLemrNXsh0PJDPh7YpSGqV2UkofUn0ZudYCVEJMhFTOWPVEBVKG+NxvKf4R5FntIKaMDwkfM8pGYkyH29akrTknUg6sWmO8O3jKp8u/1SmlmKYRbSxSRzaTENKw6cC8eVblj84pF3a38TCC13VgePRIu7A5iTaa2+1G0+raa10uF8Qi0b7iYuH3MKGMZ7cFsdo359JIfA4IKbiPd2KO6KgYxjsvP14QQpwOx3HEOc+qA8vmWPaA2Dzz6p7zOoaFCYpFTzzMjLQCoUZ2J9n38xuFEPgD8GO8VLXcVDMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;b1e2660c9df0fb2a&quot;
        title=&quot;b1e2660c9df0fb2a&quot;
        src=&quot;/static/3eff05929e445abd676e32a2dbcdbe4b/1d69c/b1e2660c9df0fb2a.png&quot;
        srcset=&quot;/static/3eff05929e445abd676e32a2dbcdbe4b/4dcb9/b1e2660c9df0fb2a.png 188w,
/static/3eff05929e445abd676e32a2dbcdbe4b/5ff7e/b1e2660c9df0fb2a.png 375w,
/static/3eff05929e445abd676e32a2dbcdbe4b/1d69c/b1e2660c9df0fb2a.png 750w,
/static/3eff05929e445abd676e32a2dbcdbe4b/78797/b1e2660c9df0fb2a.png 1125w,
/static/3eff05929e445abd676e32a2dbcdbe4b/aa440/b1e2660c9df0fb2a.png 1500w,
/static/3eff05929e445abd676e32a2dbcdbe4b/80cfc/b1e2660c9df0fb2a.png 1844w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;231-迭代学习&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#231-%E8%BF%AD%E4%BB%A3%E5%AD%A6%E4%B9%A0&quot; aria-label=&quot;231 迭代学习 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2.3.1 迭代学习&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;一次循环可长可短，短则几分钟，长则好几天。每次迭代都遵循相同的步骤，但具体执行会采用思维模式的不同而变化。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;思考&lt;/strong&gt; 我们想要了解什么？我们需要回答哪些问题？最大的风险是什么？想想如何制定计划获取信息，从而解答疑问、降低风险。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;动手&lt;/strong&gt; 制作有形的、具体的东西，方便快捷地分享思路、检验想法。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;检查&lt;/strong&gt; 慎重检查执行上一步的成果，以便决定下一步行动。从检查中获得的洞察和理解将告诉我们下一步做什么。然后再回到第一步-思考。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;232-组合运用思维模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#232-%E7%BB%84%E5%90%88%E8%BF%90%E7%94%A8%E6%80%9D%E7%BB%B4%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;232 组合运用思维模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2.3.2 组合运用思维模式&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;你可以把四种思维模式想象成四个工具箱，每个箱子里都装着适合特定类型设计工作的工具。挑选合适的思维模式，才能在深入理解问题的同时降低风险。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6dc3a1666fcdc1dc11ae98fa7c94738c/10ab7/3ac6dbcf41e914c8.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 68.08510638297872%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB7UlEQVQ4y4VUXXPaQAz0//9JPPDADC1l0iaQ1DXGQElJCHaSnj/Pd7677Uhg40Km1YxGcJZXK93KXlEU0FrDGAPnHMistVdOzz6KZO17TdPAG41G8H0fYRhyQi0lLq0PTIX7/6WU7ESKAYkhHSiloZVC8iYQrncIoi3mfoT14wHWOWZBTvl5nnMsyxKz2QzT6ZQjFfBaFkfaDto4/NzFCJYRg+5e3mDtEcwaBWcqUGrLlFgRMDkzvJ6XgzMSsLLXsuGoVI3k8MTdtIwJpKqq8wy72ZwGHMcJ1qsFFosFhBB8RmzI6lph92uLupYdoFKKAYl1B8jtuiOg0QUalXHCJfujNXBWdyMiQCkvGCptIJVBJTWKLIbSDRpjudWzTCwa45idLAWMBYx1KMoKIs1B9RiQkGc/Nvhy6+PrPOT47WGF+2AD21RIRYJotYJRKQ5JjJv5Enffl7jz17h9iPBpOsPnmznCzZ6LM8OilOzx6zue9gnyUrK3QyeN0W/dGLy+Czy/JMgKid9pjjQvkRUVqlqfGbaWpoK1eBJStxH9tsmyVFyJH6fiXpIkiOOYnW6VZPO/laNbFSLFdrtFEATIsux8KePxGMPhEJPJpJPIR7vcXz0yAhsMBuz7/Z7PaDReP7Fl8a+PwbWM8JfI/wA43jwmpTss8QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;3ac6dbcf41e914c8&quot;
        title=&quot;3ac6dbcf41e914c8&quot;
        src=&quot;/static/6dc3a1666fcdc1dc11ae98fa7c94738c/1d69c/3ac6dbcf41e914c8.png&quot;
        srcset=&quot;/static/6dc3a1666fcdc1dc11ae98fa7c94738c/4dcb9/3ac6dbcf41e914c8.png 188w,
/static/6dc3a1666fcdc1dc11ae98fa7c94738c/5ff7e/3ac6dbcf41e914c8.png 375w,
/static/6dc3a1666fcdc1dc11ae98fa7c94738c/1d69c/3ac6dbcf41e914c8.png 750w,
/static/6dc3a1666fcdc1dc11ae98fa7c94738c/78797/3ac6dbcf41e914c8.png 1125w,
/static/6dc3a1666fcdc1dc11ae98fa7c94738c/aa440/3ac6dbcf41e914c8.png 1500w,
/static/6dc3a1666fcdc1dc11ae98fa7c94738c/10ab7/3ac6dbcf41e914c8.png 1552w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;有经验的架构师往往没有意识到他们在从不同的角度考虑架构设计。多年的实践经验让他们可以凭借本能和直觉做判断。然而对于一般人来说，认识这四种思维模式可以更好地帮我们跳出思维定势。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;233-实践-TDC循环与思维模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#233-%E5%AE%9E%E8%B7%B5-TDC%E5%BE%AA%E7%8E%AF%E4%B8%8E%E6%80%9D%E7%BB%B4%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;233 实践 TDC循环与思维模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2.3.3 实践： TDC循环与思维模式&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;用一个具体的例子展示TDC循环和思维模式在实际工作中的使用。假设客户刚刚告诉我们一个新的约束条件-增加了项目的风险-系统架构因此可能无法满足性能要求。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;我将书中的内容整理成一个表格，方便理解&lt;/p&gt;
&lt;/blockquote&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;运用的思维模式&lt;/th&gt;
&lt;th&gt;思考&lt;/th&gt;
&lt;th&gt;行动&lt;/th&gt;
&lt;th&gt;检查&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;理解问题&lt;/td&gt;
&lt;td&gt;找出相关的质量属性场景&lt;/td&gt;
&lt;td&gt;用头脑风暴的方式收集场景，记录在案&lt;/td&gt;
&lt;td&gt;团队和客户审查场景并提供反馈意见&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;探索想法&lt;/td&gt;
&lt;td&gt;设计一个实验，验证设计决策能否提升特定的质量属性&lt;/td&gt;
&lt;td&gt;编写简单的脚本，用于驱动系统已有部分以及收集数据。进行实验&lt;/td&gt;
&lt;td&gt;收集到数据口，检查结果得出结论：新的约束会影响性能，但只有几百毫秒的延迟&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;展示想法&lt;/td&gt;
&lt;td&gt;做一个简单的原型，便于沟通&lt;/td&gt;
&lt;td&gt;制作用于演示程序工作流程的原型&lt;/td&gt;
&lt;td&gt;演示原型给客户看，介绍为什么性能受到了影响。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;原型让客户直观体会到此前不了解的问题。接下来，我们再采用理解模式提炼新的需求。借助探索模式检查双方对问题的理解。TDC就这样继续下去。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;以上是《架构师修炼之道》一书的第二章节的内容，主要介绍了HART原则，介绍了四种思维模式，阐述了如何通过TDC循环组合使用思维模式来帮助架构师实现架构设计，并给出了一个简单的案例。这一部分属于架构设计相关的理论知识，后续的章节将从架构设计原理开始一步步展开实践，讲解如何使用这些原则和模式完成软件架构设计。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[博客又搬家了]]></title><description><![CDATA[不知不觉，从14年到现在，自己的博客已经维护了8年了。虽然文章写的不多，质量也参差不齐，但是热情还是在的。 之前因为Hexo构建速度慢的问题，我将构建工具迁移到了Hugo生态。到目前为止，运行了小一年。但是本质上来说，除了更换了主题之外，其他并无太多差别。之所以说没有太多差别，…]]></description><link>https://zhanglun.github.io/blogs/博客又搬家了/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/博客又搬家了/</guid><pubDate>Thu, 19 Aug 2021 11:03:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;不知不觉，从14年到现在，自己的博客已经维护了8年了。虽然文章写的不多，质量也参差不齐，但是热情还是在的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;之前因为Hexo构建速度慢的问题，我将构建工具迁移到了Hugo生态。到目前为止，运行了小一年。但是本质上来说，除了更换了主题之外，其他并无太多差别。之所以说没有太多差别，原因在于Hexo和Hugo。它们都是静态网页生成器，使用Markdown管理内容，在编译阶段，将内容的信息提取之后，利用模板引擎输出网页。在我看来，这就像吃饭的时候，使用竹筷子还是木筷子一样。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这看起来也挺好，但是对我而言还是有几个不满意的地方：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;内容创作不连贯。使用git管理博客依赖环境配置，无法随时随地写文章。而我平时喜欢使用笔记软件整理资料，写好之后需要转入git仓库，存在着一种割裂感。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;博客定制性差。想自定义必须学习其数据格式和对应的模板语言，而学习的收益太低&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;有没有一种方式，可以实现随时随地写文章，随时随地发布呢？答案是：有！那就是&lt;strong&gt;Notion&lt;/strong&gt;和&lt;strong&gt;Gatsby&lt;/strong&gt;。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Notion-和-Gatsby&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Notion-%E5%92%8C-Gatsby&quot; aria-label=&quot;Notion 和 Gatsby permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Notion 和 Gatsby&lt;/h2&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Notion&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Notion&quot; aria-label=&quot;Notion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Notion&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;Notion这款工具我已经用了一段时间了。对我来说，是目前使用最舒服的笔记工具了。简单的界面，强大的功能，多平台兼容。同时Notion 提供了开发API，而这就是我最需要的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;将Notion的API和Github Actions 结合，把Notion中的内容转换成博客，以实现随时书写，随时发布的能力。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Gatsby&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Gatsby&quot; aria-label=&quot;Gatsby permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Gatsby&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;Gatsby.js 起初只是一个基于 React 开发的一个框架，用于帮助开发者构建快速的网站或者 apps。通过 GraphQL 处理数据来源，然后输出作为网站的数据，再通过 HTML、CSS、React 将数据展示出来。现在衍生出来一个围绕 Gatsby 的构建，预览和部署网站的云平台。下图是Gatbsby的工作原理&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/390d1c4b8d3cc6c7c330576ae78bf713/60b3a/eb55a3e89e03e681.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 64.36170212765958%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACBElEQVQ4y11Ti27bMAz0/39duwfWFdnaJmlT52FbkvWgROkG0nawjQAh+0SRpyPVxcyYfMacCm4zYZgJggVimJDhiUGl6vfgCeMaW7jqOviMKWSNz1zRSYJdP+P1GvDtaPB0crg5gg0ZP09WC9iY8XKZ8ePDKnYcgmK9TXjcj3g6WYyeNGnXWoVzMyZjQSkhZ4JgtTXEGBGT/DegNWQiEGWIlcK6l2JErYxcCmqt6JgZ+8M7XvcHBUrOCCGglOWgsVbxViumySiWUkSMAcwFm0nMmrCilIJIGTYQvGhpAz4uo2o0OQ/jI1wgXCenMcfzgMknuLiciVQgxORW3VYhc0MqFU2qtQWThuzOHoch4jQlnAyhN2lhtKgA4oqQ+c60E33kOtIhqTinpaq4dPZ98OhNxMVG9Cbg6tJ936esZ2RVWYRhrQ2Us4pdmHUcJHmpDXOICDEhEWkDxGcfULhpnDiviXjTUGj+fnnDw5fv8CHcqaeUQERrR4u6mGDS/f/t3hRhmPMiqjaIGcM4LuOyauVDxOy9iq56F4ZzTidBMGXIa8KNrqx21ez5ZHRQKRfV6HCb8XZxui8HRdvdp8Wv3sIE0kRbju5v2jYWfSkPe4OzTaql+P4W8Pzp9CWIXR3hcW/w9Wj0uYq1f7q8XkXesKeiLjMo15F3vOCs2BYn3+JbkS3PH4mr9JcvuQLNAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;eb55a3e89e03e681&quot;
        title=&quot;eb55a3e89e03e681&quot;
        src=&quot;/static/390d1c4b8d3cc6c7c330576ae78bf713/1d69c/eb55a3e89e03e681.png&quot;
        srcset=&quot;/static/390d1c4b8d3cc6c7c330576ae78bf713/4dcb9/eb55a3e89e03e681.png 188w,
/static/390d1c4b8d3cc6c7c330576ae78bf713/5ff7e/eb55a3e89e03e681.png 375w,
/static/390d1c4b8d3cc6c7c330576ae78bf713/1d69c/eb55a3e89e03e681.png 750w,
/static/390d1c4b8d3cc6c7c330576ae78bf713/78797/eb55a3e89e03e681.png 1125w,
/static/390d1c4b8d3cc6c7c330576ae78bf713/60b3a/eb55a3e89e03e681.png 1179w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;重新定义博客工作流&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%87%8D%E6%96%B0%E5%AE%9A%E4%B9%89%E5%8D%9A%E5%AE%A2%E5%B7%A5%E4%BD%9C%E6%B5%81&quot; aria-label=&quot;重新定义博客工作流 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;重新定义博客工作流&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;现在博客创建和发布的流程如下&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/96475e5f93be2c0fef68b1dcb3234932/7bf07/a457a9a8d7d5363c.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.319148936170215%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzklEQVQoz0VT2ZKbMBD0/39T3vO6L6mkyl5g7fIBAd23BJ2aAW9ETUmipVFPt3RqrYFiXVdQ27YNKSXEGOGc/Q5rLbz3HM45WGuOuUMIgdfnnHGiRI/HA0opjOMIIQSDMQcIO2OSLw7lBXxwyCnDeAXpFix6hrALTFRMgg46EaNhGHC/39F1HW63G5TSKGuCyxbDbcB5OPNYOwVrHGY1wRWLy3DBJCb4alFK2RMSw2mamC41Kp+AUjO0V3y6DhLaS/6HDUg1wkTNGDE3QSGXzBJwQh8Cn0DJaq1cMoGkmzEaxux6LcvCVSipIBZx4IYJEM4aUhJgRaVkh0EkA8W7vYe0iSQhraWU3ybyt21s7Km2FU9NSRuwrai1MUNyjpw0FMTSGjaODCSMkpsDJ6bEcme4AT864OMJhAa0WuB9QK4JOig2YNYTa0gul1zY5b9qhLSCg9alnHYNUSOuT4WfZw9vHSqLG5BbhE0W3VeH/tojlIBFztBKYxIv/Ln8xufXJ/pbj5d8oLV6XBs9Yn38wiauwNwjJ7rQHqVlPpmcJBdt1CitsG4he57baGCChg2ay2WGVDIrePRvl9+vJcTAEak/tNtfy66bdf9fEO35B0JMT+6G9QK9AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;a457a9a8d7d5363c&quot;
        title=&quot;a457a9a8d7d5363c&quot;
        src=&quot;/static/96475e5f93be2c0fef68b1dcb3234932/1d69c/a457a9a8d7d5363c.png&quot;
        srcset=&quot;/static/96475e5f93be2c0fef68b1dcb3234932/4dcb9/a457a9a8d7d5363c.png 188w,
/static/96475e5f93be2c0fef68b1dcb3234932/5ff7e/a457a9a8d7d5363c.png 375w,
/static/96475e5f93be2c0fef68b1dcb3234932/1d69c/a457a9a8d7d5363c.png 750w,
/static/96475e5f93be2c0fef68b1dcb3234932/78797/a457a9a8d7d5363c.png 1125w,
/static/96475e5f93be2c0fef68b1dcb3234932/7bf07/a457a9a8d7d5363c.png 1128w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;而结合Notion API之后，发布的流程变为：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/98c95fbf4ba90546583cdfb2c09cc308/5f652/a5b25383d42aed53.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.59574468085106%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXElEQVQoz6VSi2rDMAzM//9bWGFspdCQZKzO04/YcR5OmhtSCcsGG4wZhCXbOp9OisZxRFmW2LYN67rifr//y6K+73G9XjnYQb8DH8/mecY8PWwaJxChaZrY6E1ETpqmkFLy5U9rB3e9he4llGvYyLeDQecMlmVBRCB5njO6MQZN08B7j2EYeHfOwVrLzGiproXyEsYbPJ+f0egGbrKolMCyrIjo8eVyQdu2zDKOYwZWSuF0OkFrjbqukWUZxE3gJt7RDRrS1ngrMhivmKGxBmEOD4ZCCP6d2JCexJIaRSBVVfE9aU0aS91Ce4nGVDgnL6hNBTt2aHWNEAIiKoUSiB2BHJtx1I7jDdBWQfkGpRJ4eo2RlykkxzesVDLpRCUTux1g7+hx3/1h8HDewvoOzncwTqPrDVzvPptSFAWD7Ym/jQ0lsYWFNQvh4dMZjw0BJknyp+HdtqO/fRnsD6jDBVcT5z9KAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;a5b25383d42aed53&quot;
        title=&quot;a5b25383d42aed53&quot;
        src=&quot;/static/98c95fbf4ba90546583cdfb2c09cc308/1d69c/a5b25383d42aed53.png&quot;
        srcset=&quot;/static/98c95fbf4ba90546583cdfb2c09cc308/4dcb9/a5b25383d42aed53.png 188w,
/static/98c95fbf4ba90546583cdfb2c09cc308/5ff7e/a5b25383d42aed53.png 375w,
/static/98c95fbf4ba90546583cdfb2c09cc308/1d69c/a5b25383d42aed53.png 750w,
/static/98c95fbf4ba90546583cdfb2c09cc308/78797/a5b25383d42aed53.png 1125w,
/static/98c95fbf4ba90546583cdfb2c09cc308/5f652/a5b25383d42aed53.png 1302w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;连接Gatsby和Notion&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%BF%9E%E6%8E%A5Gatsby%E5%92%8CNotion&quot; aria-label=&quot;连接Gatsby和Notion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;连接Gatsby和Notion&lt;/h2&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;01-使用Gatsby创建网站&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#01-%E4%BD%BF%E7%94%A8Gatsby%E5%88%9B%E5%BB%BA%E7%BD%91%E7%AB%99&quot; aria-label=&quot;01 使用Gatsby创建网站 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;01 使用Gatsby创建网站&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;如果是第一次使用，建议先通读一次&lt;a href=&quot;https://www.gatsbyjs.com/docs/tutorial/&quot; class=&quot;link-underline&quot;&gt;官方文档&lt;/a&gt;， 然后选择 &lt;a href=&quot;https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-blog/&quot; class=&quot;link-underline&quot;&gt;gatsby-starter-blog&lt;/a&gt; 这个模板开始搭建自己的博客。具体的搭建细节，我就不在这里赘述了。能看到这篇文章的人应该都能搞定的把？&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;02-创建Notion-数据库&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#02-%E5%88%9B%E5%BB%BANotion-%E6%95%B0%E6%8D%AE%E5%BA%93&quot; aria-label=&quot;02 创建Notion 数据库 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;02 创建Notion 数据库&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在自己的workspace中创建新建一个数据库类型的Page。视图类型选择Table会更加直观。下图是我的database的截图：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a5b65dac435680399830cfe743a57995/c5394/26cedee27e109502.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 40.95744680851064%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRUlEQVQoz3VS2W4DIQzk/7+pX9HtNqnyUjXKAclesIs5DFPBJlGqtpaMJSwPM2ME2Rnj0MEYAz1NGIYe0zjCe48SOedH/hfPHaHUGZu2QdO84mO7QfvWoG2bCnwHfAzmjJTSr4qc0FHE3gQIM8+w1v7JgJkRmZGYkctguYsRzhFCCFWFK0oy470jvOw1xKwH9N0VRIQYYwUpWeADOUwnBXIeswugmOA4wYeA8r7VCtaom+T1FEwXKHmElBLG6NVLrYu+CrQ/njBah8/LCGkcrsQYzQxPDmpS6ExXgYr0lDPE1B9xOHxBKVWXcvemxLIs2G13lflzxLgy1P1XzeflCVoGdNcL+r6HlGc4524CMrzzUAdVa/GZzIBI88MarSWMVjfAlYjgYGHtUj0sQ3c2pcmJQWTBHGvfLwbsV69LUnBw8ef3+gZcDm4KI0x+HgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;26cedee27e109502&quot;
        title=&quot;26cedee27e109502&quot;
        src=&quot;/static/a5b65dac435680399830cfe743a57995/1d69c/26cedee27e109502.png&quot;
        srcset=&quot;/static/a5b65dac435680399830cfe743a57995/4dcb9/26cedee27e109502.png 188w,
/static/a5b65dac435680399830cfe743a57995/5ff7e/26cedee27e109502.png 375w,
/static/a5b65dac435680399830cfe743a57995/1d69c/26cedee27e109502.png 750w,
/static/a5b65dac435680399830cfe743a57995/78797/26cedee27e109502.png 1125w,
/static/a5b65dac435680399830cfe743a57995/aa440/26cedee27e109502.png 1500w,
/static/a5b65dac435680399830cfe743a57995/c5394/26cedee27e109502.png 1535w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你可以按需设置自己需要的字段，也可以参考我的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;title: 文章标题&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;categorise: 文章分类&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;域 业务领域&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;术 解决方案&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;技 技术研究&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;阵 技术应用&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;法 手段方法&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;理 理论学习&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;器 工具使用&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;杂 杂七杂八&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;tags：文章标签&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;date：发布时间&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;status: 文章状态&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;working: 未完成&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;publish: 已发布&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;draft: 草稿&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;03-创建API-Intergation&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#03-%E5%88%9B%E5%BB%BAAPI-Intergation&quot; aria-label=&quot;03 创建API Intergation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;03 创建API Intergation&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;首先，前往 &lt;a href=&quot;https://www.notion.so/my-integrations&quot; class=&quot;link-underline&quot;&gt;Notion 开发平台&lt;/a&gt;创建自己的API Intergation，拿到整个流程中最为关键的secret，具体步骤可以参考&lt;a href=&quot;https://developers.notion.com/docs/getting-started#getting-started&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;img src=&quot;/9922e967372e985a09454f2ff7ef0442/1f5a00eb368a1275.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;04-关联数据库&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#04-%E5%85%B3%E8%81%94%E6%95%B0%E6%8D%AE%E5%BA%93&quot; aria-label=&quot;04 关联数据库 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;04 关联数据库&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;当Intergation创建完毕时，还需要将其与我们的目标database关联上。如下图所示，在share中找到&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;img src=&quot;/6e3694fe5689e9e9c607d3025267fd83/a67eb58c664caa4f.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;关联完毕之后，就可以通过 secret 和 database id 来实现对数据库的操作了。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;05-使用插件连接-Gatsby-和-Notion&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#05-%E4%BD%BF%E7%94%A8%E6%8F%92%E4%BB%B6%E8%BF%9E%E6%8E%A5-Gatsby-%E5%92%8C-Notion&quot; aria-label=&quot;05 使用插件连接 Gatsby 和 Notion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;05 使用插件连接 Gatsby 和 Notion&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;Gastby 的工作原理在前文已经介绍过了。我们可以选择我们喜欢的数据来源，通过插件，将数据同步至 GraphQL 数据层，之后的事情交给GatsBy就行。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你可以自己写代码调用Notion API，也可以使用gatsby提供的插件。我选用目前排名比较靠前的 &lt;a href=&quot;https://github.com/orlowdev/gatsby-source-notion-api&quot; class=&quot;link-underline&quot;&gt;https://github.com/orlowdev/gatsby-source-notion-api&lt;/a&gt;。虽然作者说还在开发中，但是试用之后发现能够满足我的需求，我就不再自己花时间折腾了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;接入的具体步骤如下，在依赖安装完毕之后，修改 &lt;code&gt;gatsby.config.js&lt;/code&gt; 中的 &lt;code&gt;plugins&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;plugins: [
    ...
    // 本地markdown文件，之前的文章
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        path: `${__dirname}/content/blog`,
        name: `blog`,
      },
    },
    {
      resolve: `gatsby-source-notion-api`,
      options: {
        token: `${INTEGRATION_TOKEN}`,
        databaseId: `${DATABASE_ID}`,
        propsToFrontmatter: true,
        lowerTitleLevel: true,
      },
    },
    ...
  ],&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;我保留了之前写的 markdown 博客，放在 content/blog 目录中，新增了 notion api 的插件。这样一来，以前的文章不受影响，新写的文章都在 notion 中。部署时，两个数据源的内容一起部署。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;插件接入后，可以通过 &lt;code&gt;allNotion&lt;/code&gt; 条件进行查询，这种方式可以查询到来自Notion的数据&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;graphql&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;query {
	allNotion {
		edges {
			node {
				id
				parent
				children
				internal
				title
				properties {
					My_Prop_1
					My_Prop_2
				}
				archived
				createdAt
				updatedAt
				markdown
				raw
			}
		}
	}
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果本地content/blog中有历史文章，可以使用 &lt;code&gt;allMarkdownRemark&lt;/code&gt; 查询，他会包含所有的数据内容。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;graphql&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;query {
	allMarkdownRemark {
		edges {
			node {
				frontmatter {
					title
				}
				html
			}
		}
	}
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;06-使用-GraphQL-Schema-Resolver-兼容数据可选&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#06-%E4%BD%BF%E7%94%A8-GraphQL-Schema-Resolver-%E5%85%BC%E5%AE%B9%E6%95%B0%E6%8D%AE%E5%8F%AF%E9%80%89&quot; aria-label=&quot;06 使用 GraphQL Schema Resolver 兼容数据可选 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;06 使用 GraphQL Schema Resolver 兼容数据（可选）&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;通常Hugo(Hexo)中定义的tags和categories都是字符串数组。而Notion的database中我将tags和categories定义为Select类型的属性，保存的值对象，Notion 插件返回的 frontmatter中的tags和categories都是包含了id、color和name的对象数组。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;GraphQL的类型定义中，没有类似“Any”的类型，而内置的 ScalarType 和 ObjectType 又不能union，解决方案是使用&lt;code&gt;resolver&lt;/code&gt;处理返回的值，将tags处理为一个字符串数组，categories处理成一个字符串。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;schema.buildObjectType({
	...
	tags: {
    type: &amp;quot;[String]&amp;quot;,
    resolve(source) {
      return source.tags.map((t) =&amp;gt; t.name || t);
    } 
  },
  categories: {
    type: &amp;quot;String&amp;quot;,
    resolve(source) {
      return source.categories;
    }
  },
  ...
})&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;最后在查询时返回的数据格式如下：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 376px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ba7bcd5a9d3d3247cde5479754027218/d38a6/b964b3845ce8b0b8.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 81.91489361702128%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACg0lEQVQ4y2VT2XLbMAz0/39RH9uZ3k7ipK5dH0psWbdF8aZEymm2Q8pW4+QBAgkNlgtgMek6i6wWmK5z/Fjn+LpIsYprNJRDSIX4kKCzDqbtgrWdDTberYXphrPpLCb+0FmLpGS4X2b4tsrRmBbGdpBKI6tKdM7BWBuSL4DtqUfb9zBCo21tAGvbDpP2/FLvHGxOYeYJ2Oct2OwAdheD3e5BZzH4MgObxWC/U4ioRPMlAr3ZQWYUnMuR9eRCXZsWsuKQJQPflJBpA1UwqCMffE4htiU0UzDCQEQVZExCLmX8GtC6PlCWBxLYkI9r0Lt4sJs92P0BbJ4G4Na5ofRzyR6o69zY34n/VMc6AHpTXEMkBIpIaGmguYYWOvhL4y9tem0jQz/BbRShIQSnvsfp+YTTy3Pwfd/D9T36Uw/bu/cTfgMWGPoJ74sGUVpjuT9ifaixORBsE4LIW0rwlFPscoqGCTDGURTVWKZ5BRYY+gNXLf7ENaarHPOE4MN9jO+bAjsisMwaTLcFMqqgWgPCObJjBffyF8a0geUVw4sOrW9uwaC3JcSvBHpTQM0TqEUKsztCPR3DVP2k2SINJnxc6qs2TF43WNUCIq4h9nXwfsohiUjIhEA3MkzaA3tFeEk1Db0GHOs3HWROwVc52EMCvshApzuwhwPEYxWYeSHzVRHE7f/LuIbU+rrkkaHpoGsRmHjzQuaLdGBSC6iSDfGzyP2GaCJRJ1XIvRK2l44H9tvhX6e3+8CMfFoHYfut8Mzpz11gNgg9Cauoc/Z+yseajEH/qqYKmsrQK38P7H2skdBMn/1wN9a+1aFD9PgIpcwg3LBaZ/Pr5c6CvsSs/e+de7cp/wAOAr4iT9nBLgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;b964b3845ce8b0b8&quot;
        title=&quot;b964b3845ce8b0b8&quot;
        src=&quot;/static/ba7bcd5a9d3d3247cde5479754027218/d38a6/b964b3845ce8b0b8.png&quot;
        srcset=&quot;/static/ba7bcd5a9d3d3247cde5479754027218/4dcb9/b964b3845ce8b0b8.png 188w,
/static/ba7bcd5a9d3d3247cde5479754027218/5ff7e/b964b3845ce8b0b8.png 375w,
/static/ba7bcd5a9d3d3247cde5479754027218/d38a6/b964b3845ce8b0b8.png 376w&quot;
        sizes=&quot;(max-width: 376px) 100vw, 376px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;OK，到目前为止，我们已经成功将Gatsby和Notion联系在一起。Notion的内容可以作为Gastby的数据源，输出在网站中，同时现有markdown的也能够无缝迁移。随写随发的目标，我们已经完成了一大半。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;07-将Notion导出项目目录通过-source-file-system-加载&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#07-%E5%B0%86Notion%E5%AF%BC%E5%87%BA%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E9%80%9A%E8%BF%87-source-file-system-%E5%8A%A0%E8%BD%BD&quot; aria-label=&quot;07 将Notion导出项目目录通过 source file system 加载 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;07 将Notion导出项目目录，通过 source file system 加载&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;使用了一段时间后，发现 gatsby-notion-api 有几个不太好用的地方（毕竟只是作者的实验性项目）：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;无法转换Table&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;串行请求页面导致构建时间比较长。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;无法缓存，导致每次都是全量构建&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;于是想自己写一个，使用 &lt;a href=&quot;https://www.npmjs.com/package/notion-client&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;notion-client&lt;/strong&gt;&lt;/a&gt; 提供开箱即用的API调用，使用 &lt;a href=&quot;https://github.com/souvikinator/notion-to-md&quot; class=&quot;link-underline&quot;&gt;&lt;strong&gt;notion-to-md&lt;/strong&gt;&lt;/a&gt; 将页面转换成markdown 文件。不幸的是，Gatsby在 build 的时候总是出现莫名奇妙的错误。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/84e78f5006fdb9e043f78c7e94981770/3c492/ea31a6dda92a6a18.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 143.61702127659575%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAYAAACqhkzFAAAACXBIWXMAAAsTAAALEwEAmpwYAAADxElEQVRIx21W0XLbNhDkRzSJRAIEQJAACJCUZLm25fFLJmk/oG0yk7T//xvbuYPAULYfdo4EqeXtYe+g6u9Y42f8hL/CDgddo5c1mqaGEA2klAyl1Iq2lfyMnwsBuUYBKQWqZXQ4hAGTswiuR287ODcgpYQYRzjnIIRgtG17SyjFG1TzsiCmhGmeMc0TxjgipYi7uzscDgecTifEGDFNE7quu2YtUNf7TCwzaI0+VnnvYDsDrRTGMcBaA2M0rO2YoO/7FVprJuQsmwYNo0Zd12vGFclSrcRu9wnn8xldZ9aHJLHUMRNlyVmeXLPNJcllqI7HI5Rq15RXKYxM+npTmKRpNh+WK6p5nlge1S2EwLJD8BiGnms3DMMNaSFs6uKGLHclPBwW6FbgsCxwzqPvLZNZ3m0Ha+0bwrLTVEOqX1FF99XxeOAXDoeEx8cTUhqZsPiwkP2KcmMT+dY2JI+23bkOIVh0nV6LT7UtZO8Rbmt3I7mVki1Bvtvvd2jb8vJW6i3he2T0u+p0OnLqVLPT8Qit1aYT5I1swnsyhfhVAs6QFsi4T0+PWJaZjU0kxhheJ4MXUnq3WU293Zhss+p8voNWAp3ReHl5AdmISLOFRjY72ee1H1+DstvXDaplWXhi0AZcLhfuYaoH1bJ8neK2YwhlYGyvRSNQkZEd+85imhLIRpQlGT1PnDwYKFu6pkjZ07PynECl4RpeLk94eLjH+e7EuDw9MoJ3PMbcMHDnBO9Bg4Tuh76Hdw6e1zw3ANWbylJZ51Arzfhtt8eHfb3iYy3wsRH4QLGgyRCv5Ofy0KYMGl+jxufQ4ks0fP01GXy5xj8miz/nfhM7vh6MhmzVjfG5hp8Xh/+eE77f9/h5SfjxlPDzeca/zwt+PEZ8uw/4/lBiwrd7j39+H+GNgmxvO0kKiUqoFjZYGG9hQw/jPDof4KYJxo/YK4NamRx1iR1M10G9IRSoOqOwTAPSaLFMHss8YZ4S5inCu4H9mWFgtIZWbY5a3wyOYqHKGIUYB4xjf40Ez7ahac676B188GytchS8HbwtWqVQ0XRJaUCMfcZoEaPDvMzcMeRN8mVM2W804clOhfS14TlDGlsxWoyjxRgsQugwjtlnZGKKZGgyMp05pYf3+/3aTbvdju+vhDk7ks0IPROWfi5dQh2TTaxZPk0o21u+Xo1NhFPqOUNrNYSQPMLKcNXXDaA1ivlAk6vk7cS5StaIkaQ5Bp0pJItBGVAm1ywIRFyGb5FdQCchE/pr31LP3p7LcvVYQT7Uxc3fk+2m/A/4/y0jGFurHQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ea31a6dda92a6a18&quot;
        title=&quot;ea31a6dda92a6a18&quot;
        src=&quot;/static/84e78f5006fdb9e043f78c7e94981770/1d69c/ea31a6dda92a6a18.png&quot;
        srcset=&quot;/static/84e78f5006fdb9e043f78c7e94981770/4dcb9/ea31a6dda92a6a18.png 188w,
/static/84e78f5006fdb9e043f78c7e94981770/5ff7e/ea31a6dda92a6a18.png 375w,
/static/84e78f5006fdb9e043f78c7e94981770/1d69c/ea31a6dda92a6a18.png 750w,
/static/84e78f5006fdb9e043f78c7e94981770/78797/ea31a6dda92a6a18.png 1125w,
/static/84e78f5006fdb9e043f78c7e94981770/3c492/ea31a6dda92a6a18.png 1300w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a9c1eafc214a89958596e5bb3111f295/4352a/1f39fbd8b14e8176.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 135.63829787234042%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsTAAALEwEAmpwYAAADbElEQVRIx4VV2ZLbNhDkRyQVEQAvECdBUqJWq5Xtx9hVOaqczdoP+f8f6dQMRYqS7eShCwRZbMx0zwyyL0nhnyTwtRMYtYKtFIqyQFWVqKqKUZblDUUBKSWkFFBKoigUyrJYkQ19Qh89grMwxsB7j5Q6HA57DMMA5xwT1XV9JS2YSArBpELmKJRiYkLWdR28d4gxoOsinLO8juOAlBKT0hpjvBLOPyqlmFhJOR9wXTNjWtQ1pSaQkoFS+ZrGkvI29SWSbZp3KVNETVNDiBz7/cjabQnv9PsPwjVlSrVpGk6BfljEVqxLwe++F+G3uEZIhGRGCJ4NoL21hhHCfNhCWqwO3yDYHLkGlPV9gjGa0yV3iZjISFtyfEv4mP4CpQoIoSDlknJdcWR937PDREanblPepv5oFJNKBSUkMoqICK0xXHtk0KPLP4pw1ZVMUQVULpFRvWndoKlrTNPEpizOPUbyvf2c8mwKgQubUiTdSEd63rq8iP1Iek9YQEjFyPqUYNqWiT58eI9xHFdj6DDaa63/X0OlIEnDLkbuFNLufD6z00ROeyKiUqIft2ltMbegmjWcTQnwznE/T9MBx+PETlOU/M177mN6JtABtFL09J5grb0RXi4veP/ugufTE87PJ7y7vOB8PiF4Nx9ExR4CIh3gHZy1DDrIcSAebdteu6hAVmsNUdXIywo/5eKKnNefhZqRy9uzUMjV0r83LJpmT67Gl6PD57HB62TxemjndTL4+2Dw9uTxdgp4O3q8Tg5fjxYnW+GXXPAcXNpvacHs4Bu8vgT8Phl8fon44yniz+eEvy4jfps8Pg4Gn0aHT6PFr73Bx9Rgb2bCxZCFjAlVWaANBtq1MMFCO482BNiuQ9kayLqBYmheSZpKa9QPnbOUUEZaDL1FF1uk5DH0PVKKDC6fuoamEmoabkmR75Dn+QY77HY7jpL2WVUV6CIV8YzgNWJ0oClEoBJaphCVFo26eW7KuzpcwISRCK+kIbRMmPrurtYItHfe8Uh7dHd1mQmDwTBY9L3FOFikzqDvO76cEkfaY7/fX6+IaiVj7er7AcEa0uUUIw2IhttQ63ptvUdQdAvmy61ai3ol7DrHsLZFoxseZzM0dKu5Ewi0J5IZ9arhtsAzuuXmvvU8tYnodqt9OwO3RUxk5OytuHP8CwQk8y8UIMnDAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;1f39fbd8b14e8176&quot;
        title=&quot;1f39fbd8b14e8176&quot;
        src=&quot;/static/a9c1eafc214a89958596e5bb3111f295/1d69c/1f39fbd8b14e8176.png&quot;
        srcset=&quot;/static/a9c1eafc214a89958596e5bb3111f295/4dcb9/1f39fbd8b14e8176.png 188w,
/static/a9c1eafc214a89958596e5bb3111f295/5ff7e/1f39fbd8b14e8176.png 375w,
/static/a9c1eafc214a89958596e5bb3111f295/1d69c/1f39fbd8b14e8176.png 750w,
/static/a9c1eafc214a89958596e5bb3111f295/78797/1f39fbd8b14e8176.png 1125w,
/static/a9c1eafc214a89958596e5bb3111f295/4352a/1f39fbd8b14e8176.png 1364w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;经过百般对比和调试，翻阅Gatsby的文档。最后发现可能是在CreateNode的时候传入的参数有问题，但是调试是在是太麻烦了。随着耐心的逐渐消失，我决定换个思路。构建之前，将内容下载到本地，再通过 source file system 来处理。后续还方便做缓存。具体代码在&lt;a href=&quot;https://github.com/zhanglun/zhanglun.github.io/tree/master/scripts/notion&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;2022年5月21日更新&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;下载到本地的方式成功运行了一两周，接下来的时间里，Github在执行Action时，不停地遇到如下图所示的错误。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9c26f1a01a38586905846eefda3ee7e4/71c1d/24c0968f07052424.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 95.2127659574468%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACaUlEQVQ4y4VUyXbaQBDkXwIW2mfXgpCQjVlMEu855ZyT/V7+/1J53QJZcrB9qNfTaKjp6prpiR9J2HyJ1eUOq8st2vUeDcWrHerVNa42B15f737w96yoUVYtpM4hjoiFxWwe48JPMAlihSg1mIUSFxFBwYsVpqHgOMxnoeB8nmhM/YQJvCDlOCJMhcGf2zu8Pj/j5fHxiAe8PDz0+esT4YnXf3894/fNgUlOOJFOglgjSjQO7Qp311cdNjvcbva4397gfnfAz/UW22WD7XLF2DctmqLqiUYVhonGPJLwohSh0AhShUBY+KlFKDMEabcmubNAYErwU14PiU5gyfNQQioN6xyMddCuRLFoYbIKfihAe+hgBq1jBTLzPVlPSB9joaCtgzIOyi0gbclmDcmoPZQHXxGS5ERoGJdB2ww6qyBNOSAiUoN5KDD1ov+MGBL3khOhYJyDywukKuM/c0U9oebfzhkxqpA2+pFiQpKcCHOUpcfxDOE58LXxj5K1y5BIwyTUv/DYQ14nuu/pZ6QjycoYaJuzKfQcT9LpQALto5cx7N+HLkepgtAWQjlIUzBi4UayqTVe8Hkfe5dTqaGMhTQ5bFEzyGk6bHx1ugO+rDAWkgnZGJn1Mt+DWuB98EoGPRSIUglpHITuCMmAkwmJdDyiKKd4zu3+LftHFwN20SISFkHSSewq72bdt4vwDV7EF5xA+Xja0IDNKjTthofoevudQYOVh+t6D2VLdpxAZlHkqlPDeTB4hhMRCeTSoNQZimyBqqg5LhcN6qpFVdZYFDWqskGZVxxzW0ImCiJW0MIiCVOE8xiRH+MfRt5WPkd7NDUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;24c0968f07052424&quot;
        title=&quot;24c0968f07052424&quot;
        src=&quot;/static/9c26f1a01a38586905846eefda3ee7e4/1d69c/24c0968f07052424.png&quot;
        srcset=&quot;/static/9c26f1a01a38586905846eefda3ee7e4/4dcb9/24c0968f07052424.png 188w,
/static/9c26f1a01a38586905846eefda3ee7e4/5ff7e/24c0968f07052424.png 375w,
/static/9c26f1a01a38586905846eefda3ee7e4/1d69c/24c0968f07052424.png 750w,
/static/9c26f1a01a38586905846eefda3ee7e4/78797/24c0968f07052424.png 1125w,
/static/9c26f1a01a38586905846eefda3ee7e4/aa440/24c0968f07052424.png 1500w,
/static/9c26f1a01a38586905846eefda3ee7e4/71c1d/24c0968f07052424.png 1536w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;调试了很久，最后发现是依赖的 &lt;a href=&quot;https://www.gatsbyjs.com/plugins/gatsby-remark-images-anywhere/&quot; class=&quot;link-underline&quot;&gt;gatsby-remark-images-anywhere&lt;/a&gt; 所导致。这个插件会做的事情是将远程图片下载到static目录，同时修改文章中图片的引用。我也不想深究背后的问题，自己写一个脚本不是更方便么？&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;自动部署的实现&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E7%9A%84%E5%AE%9E%E7%8E%B0&quot; aria-label=&quot;自动部署的实现 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自动部署的实现&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;使用类Hugo的静态网站生成器时，自动部署的关键点在于push操作能够触发配置的CI流程。而改用Notion之后，如何触发构建和部署呢？目前我想到了两个方式：手动触发构建和定时任务。后者相比之下更加“自动化”。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;其实有一种取巧地方式：通过Chrome插件在Notion的Web页面上插入一个按钮。这个按钮点击时调用webhook触发Action。不过暂时不打算折腾这些。毕竟还有一些待完成的工作要做。考虑到我已经实现了“随时写”的目标，“随时发”倒也没有那么迫切了。所以我决定先采用定时发布的方式来解决部署的问题。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我在Github Action的市场中找到一个已经做好的Action帮助我实现博客的编译和github page的部署，这里是它的&lt;a href=&quot;https://github.com/enriikke/gatsby-gh-pages-action&quot; class=&quot;link-underline&quot;&gt;仓库地址&lt;/a&gt; 。按照它的教程很快就能定制出自己的Action。我在此基础上增加了一个定时任务，每天零时的时候执行一次，暂且先当作是实现了“自动化部署”吧。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;name: Gatsby Publish
on:
  schedule:
    - cron: &amp;quot;0 0 * * *&amp;quot;
  workflow_dispatch:
  push:
    branches:
      - mast

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: enriikke/gatsby-gh-pages-action@v2
        with:
          access-token: ${{ secrets.gatsbyDeploy }}
          deploy-branch: gh-pages
          deploy-repo: gatsby-starter-blog&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;其他&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%85%B6%E4%BB%96&quot; aria-label=&quot;其他 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;其他&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;现在将Notion作为CMS的想法已经基本实现。接下来地主要工作是定制化设计和开发博客主题。目前设计的第一版已经完成了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ac2a14ea463d2cf90a49c1ab8e918c7a/0d292/b73141e3ac029d53.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 144.14893617021275%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAYAAACqhkzFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEMElEQVRIx6VVa0wcVRS+lVZoYYmuFCsWQsWSYugj1tQ/Gh8RrTFtAAW6JRYoJUVrTUiM2kT/aAiJivIImkUI0EazVki7S1WMNSpYa5vqYktjY6KNAjssuzszO7Oz7OzO7mfOhSHSWAt4kpP7Oue7Z875zh2G/5B4PI5oNIZozECM1JhVPRqFHo3xkdZGPA4jnuBz1tbRiaa2bjR39ODt9m40vWeHve84vv/xAtRgANBVRDUJekhERBWhyT4E/QIUv4CgzwM1MAXVL0AS/oTkmwJbszYPbIUVLD0PSbdtRGrWFqRnb8OdW4uwq/IQ7N19cLpccDqdcDmd6O8fgOOT43CedOLU4CAGXS585nKh3+HA2TNnwLIL7scqay5u2XAfsjY/gswNW5FTsAObNm9H/pYdePTJYhSXVcL2bA1qag/i6TIbntmzD+/3fIrOoyfw4dEBdB8bQEtHL7748luwzNxCrMzYCGvBQ8gseBCWdflYY81BiiUDGdn5yM7fhlRrFu6+92E8UV6PopIqPF5SjfpX3sGrjR/gtSY73ny3B6832dHvOg22NmcTVt1RiLTc7Uhedw/2Hz6Cjxz96Or9GF19DrTbe9HU3I7WLgec37jhOn0Og1/9gM+/PovKQ2+gqPxFFFe9hJ0Vh9HW6QAbvTiGn9y/4OfRi7gweglqSFtQaVEM4Pz5c7g8dgl6JLzg7Oq4gLErf+DX367i8pXfMT4pgF1LlUQiDl2PIhLRIUkyREmGooYQVFQEJBmaFubnhmGQ9QJfw4iBzczMIBKJcKU5Geq6jkAgAJ/Ph+npaXi9XkzPqSRJCAaDnKPEQ9PX9GfkHI1GudJ89mYz2gTfUxQFmqYhFostiMj0Mf0J9F8BCYgiIKE9iopAad/sIJovGZBaaXLSg++Gh+F2u3mU5vmSAE1RtTAvREAklSDKQRhGfPGfTEklOeU8gd07H8Pe8lLYykpQvacU+ypKYCsrRfHup7C/porTiaIkkOsChsOzPGtpfguMMSQnMaxks7o6icGSfBNWMIb1WbfD4/Fw20UBtra2cEBLugXpaavxQOF6WG9NR5olDSkpNyMv7y4IgrB4wMbGRg5ImsUYTlYkYVcem99LTU3FxMTEjQHNHA4NDWGvzYaDdQfwQl0tXq6vxZHna/Fc3QHUVFehoaGBU+mGOfwnbcyIQ5oGVZuBooURCoU4uU2OLomHNJISqCiKvN3M82USe7YrKCKKjOd3rlOWRWweZTwOjyBgeK5T6PPN6JbVKfRkeX1+eIQpCFNe+AIiIro+f+GiAPmzpOs8b6RUTVmS+EhrWZbnny9Kx6JzSMZkoKoq/H4/B6Q52S25KNeKybXE/ymKyTV6tUdGRnhR6DyxXEASWVEgeKfx1/gEJiY9vED0r1lyUSh/qqLwV5ryRoWQ5SBfEydJr1eUvwHfnd2m4C3ZbQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;b73141e3ac029d53&quot;
        title=&quot;b73141e3ac029d53&quot;
        src=&quot;/static/ac2a14ea463d2cf90a49c1ab8e918c7a/1d69c/b73141e3ac029d53.png&quot;
        srcset=&quot;/static/ac2a14ea463d2cf90a49c1ab8e918c7a/4dcb9/b73141e3ac029d53.png 188w,
/static/ac2a14ea463d2cf90a49c1ab8e918c7a/5ff7e/b73141e3ac029d53.png 375w,
/static/ac2a14ea463d2cf90a49c1ab8e918c7a/1d69c/b73141e3ac029d53.png 750w,
/static/ac2a14ea463d2cf90a49c1ab8e918c7a/78797/b73141e3ac029d53.png 1125w,
/static/ac2a14ea463d2cf90a49c1ab8e918c7a/aa440/b73141e3ac029d53.png 1500w,
/static/ac2a14ea463d2cf90a49c1ab8e918c7a/0d292/b73141e3ac029d53.png 1620w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e352024a15f187c6da3c35997fb7f00c/6a5c3/c18738a69359bbce.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 84.04255319148936%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADJElEQVQ4y5WTbWwUVRSGJ0b5R/ADkhpTi4AgllJMttSSiCSIpEVU0OKmCSpiW35QUDHGWCMmtlaFUkpC4481tmiR2DQQI2gwTRqa+lFjSIMbyvZru+1S2+12293uztw7s/OYuZuNGyNhvcnJvHPuPc89Z84ZbSEWQ9d1hBBEozFCoRnm5udJL1NKpBTqaZoSUwr0RBxdT5CIx5HCUD7njBQCbV/VQTaVutn2wmuUvVRF2Z5K3K+/Re3Hp+jq7mE6OEooOMLU+DB/BYYI+gcZGx7A7/My5vMSGPQSuHENX38fgWEf2lrXFjTtbrR7VrIoJ5/FD6xjSe567lu5kTXFpVTWvENjcwsnmk9z8lQLDZ81UtdwnLb2b2k/18nXZzs4+00HHk8b3d09aEVP7uCOJbncu2ojea4yluYVsCyvgNy8FeQXunh881O4SjazrfRZyt172fl8Oduf2U39yVZaWi/weWsnnq/O03T6DD9cvoL2cEEx2l05LHqwiDtz1rF0eSGPbNjE8jUbWPFoEasfe4L7H8pnbUkZu6uP4q6upaLqXWpqm9j3Rj0vH/yQ6rc/4dWaj2g99z1axSuVuLbuYsvOCoqfLufTZg9T0yECEzcJjAcZHRvHNzTKkH+CyZkok9MRbk6FCYUjHG38kv1HGjj03nEq36yjveMSGlksm+xW0rLQnJExDEOZo6VpIqRkdibEfCSsYL9e6eLn7p8wkzDS9wth3+8kbVuNWjrWMAS6YaA5L1JKtemYjc1cZI7vLl4iODFGLG5w+MBhWpoaiURNPO+76TpTR9JGzWU6zmEYmcA01LIsbBv8/gCzsxFVyuWuXq55byh93dvLwEC/0pmJ3BJomqY6PG/o6FKm/hbL2TeUDkUWiC4klBa3AxpC4NQSji9Q399L2/CfWJbg6o9fMPjbBSZD05S4Cnlu13YMU6pqsgAmiegJjnn76By5jmUKJr09hEf/YCo8Q83eF6n/4IjK/rbAzJLnYrHUBUDCMNFFyi+EgZ20s/+GqimZM+h0yDGn/7atZNJOaefyrIBpUAr2j7Yz/f8nQ/4VeCv9X8C/Af+Lip0BKyxrAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;c18738a69359bbce&quot;
        title=&quot;c18738a69359bbce&quot;
        src=&quot;/static/e352024a15f187c6da3c35997fb7f00c/1d69c/c18738a69359bbce.png&quot;
        srcset=&quot;/static/e352024a15f187c6da3c35997fb7f00c/4dcb9/c18738a69359bbce.png 188w,
/static/e352024a15f187c6da3c35997fb7f00c/5ff7e/c18738a69359bbce.png 375w,
/static/e352024a15f187c6da3c35997fb7f00c/1d69c/c18738a69359bbce.png 750w,
/static/e352024a15f187c6da3c35997fb7f00c/78797/c18738a69359bbce.png 1125w,
/static/e352024a15f187c6da3c35997fb7f00c/aa440/c18738a69359bbce.png 1500w,
/static/e352024a15f187c6da3c35997fb7f00c/6a5c3/c18738a69359bbce.png 1646w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;代码已经开发了一部分，维护在&lt;a href=&quot;https://github.com/zhanglun/gatsby-starter-blog&quot; class=&quot;link-underline&quot;&gt;zhanglun/gatsby-starter-blog&lt;/a&gt;。等完工之后，将博客迁移到这个方案。期间再研究研究，看看是否能找到更好的自动化方案。在此期间就继续慢慢感受Notion的魅力吧。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;2022-04-23 更新：&lt;br&gt;
网站整体的风格已经变了，欢迎访问&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;参考&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%82%E8%80%83&quot; aria-label=&quot;参考 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://arnaudvalensi.github.io/blog/making-a-blog-using-notion-gatsby-and-github-pages/&quot; class=&quot;link-underline&quot;&gt;Making a Blog Using Notion, Gatsby, and Github Pages&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://github.com/enriikke/gatsby-gh-pages-action&quot; class=&quot;link-underline&quot;&gt;gatsby-gh-pages-action&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://kontent.ai/blog/how-to-trigger-github-action-using-webhook-with-no-code&quot; class=&quot;link-underline&quot;&gt;how-to-trigger-github-action-using-webhook-with-no-code&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://brunoscheufler.com/blog/2021-10-17-updating-notion-pages-on-a-schedule-with-github-actions#scheduling-it&quot; class=&quot;link-underline&quot;&gt;Updating Notion Pages on a Schedule with GitHub Actions&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[《架构修炼师之道》摘录01-成为软件架构师]]></title><description><![CDATA[本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。 全书整体分为三个部分 第一部分介绍软件架构的基础知识和架构师必备的设计思维 第二部分讲解架构师需要掌握的核心技能和知识 第三部分讨论一系列…]]></description><link>https://zhanglun.github.io/blogs/《架构修炼师之道》摘录01-成为软件架构师/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/《架构修炼师之道》摘录01-成为软件架构师/</guid><pubDate>Fri, 09 Jul 2021 08:00:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;全书整体分为三个部分&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第一部分介绍软件架构的基础知识和架构师必备的设计思维&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第二部分讲解架构师需要掌握的核心技能和知识&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第三部分讨论一系列使用的架构设计方法&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;前两部分适合从头到尾通读，第三部分用于参考和检索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;”软件架构导论“是第一部分的大标题，从标题可以看到，这一部分是介绍一些基本概念，架构原则和一些基础的设计知识等内容。作为深入架构设计的铺垫，这些内容必不可少。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;1-成为软件架构师&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-%E6%88%90%E4%B8%BA%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88&quot; aria-label=&quot;1 成为软件架构师 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1 成为软件架构师&lt;/h2&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;11-软件架构师的职责&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#11-%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%84%E8%81%8C%E8%B4%A3&quot; aria-label=&quot;11 软件架构师的职责 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.1 软件架构师的职责&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;什么是软件架构师？除了编程之外，还多诸多其他职责。从工程角度看待问题，将系统拆解成为众多可实现的模块，同时兼顾大局，保证系统整体有效运作；权衡软件功能和软件质量，管控技术栈，尽可能减少技术债务；锻炼和提升整个团队的架构设计能力；等等&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构师在团队里面的角色很独特。不是项目经理，却需要把控软件交付周期。不是产品经理，却要保证软件满足业务目标。编程的同时，还需要做更多的架构设计。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/06a59de482dcf958399619f3ee370e2a/e8e04/2287df661c29a527.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 70.74468085106383%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACaElEQVQ4y22T627kRBCF8/4vwV/ECyCEBBKCzS4LQrACokwyk8STmfHd7nu3u/tD7ZlFye6WVLLVsj+fqnN8lVKidM4QTIcbb/DikSArFjdSyvnAqdd0k2VSnmE2LDGS8/ndl331P0xWhGlLMh3JDiQ3s8wbhmbLafQIs6BsxPhEPzv2jWRZCjS/BmaKsppF7snBkp0kWgFBE6zmUN2itMIE0C6iXSLEvH6gHjR8CoyLw423ZK9IroAURAteIOcZKSRifMb4jI/gljPYL5l+tli/vIJexaAI4nFVx6IY6j3XP/2AmVravmFWgqnfMgrD9bvf2T09Y5cCzjSjxbiw7vkF0BDkM9kbshM40XOs7mn7LXfVPX/ffuDY7ngeWx4PByZhUZexm9GgrQdeKEy5TLcj2ZHs9WpGN96j1ZG2r7m52zAcfmUUAyc5IVzA+oQNmXayxJheGXNVHI7FAPFU3GGWJ8b5iNEDcn7icLyjk5JJtAzDA+3crCO3s8N8ou4Sm0haoYYgKvr2A/OwQYwbuvov7nY3bA819aw49i1V9Sf7/QZtF0pCisKY0nq9ADP5ksUifRJPzKLCuIF67Lh+/5ZR9MxGMijNcWoQJa9qB0lxrnw2JudzsM99Dql0Ch0c2hu0V/jkUV6hnMQETStPLEHSPrzlzXdf8e7Hb/jl+6/557dvifrwEnherguGTp4woQA1yl1gvpzX9Kpbc6r6e6rNe6rbNzz8+zP14x9EN7wGli416X5VUkDSCqQTdLKhEYfL/5v5UpXjz4AflfrFMeqOVhxXxdpJctl3zsQY1+diXNb7j11M+Q8qlTbkCzmgwQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;2287df661c29a527&quot;
        title=&quot;2287df661c29a527&quot;
        src=&quot;/static/06a59de482dcf958399619f3ee370e2a/1d69c/2287df661c29a527.png&quot;
        srcset=&quot;/static/06a59de482dcf958399619f3ee370e2a/4dcb9/2287df661c29a527.png 188w,
/static/06a59de482dcf958399619f3ee370e2a/5ff7e/2287df661c29a527.png 375w,
/static/06a59de482dcf958399619f3ee370e2a/1d69c/2287df661c29a527.png 750w,
/static/06a59de482dcf958399619f3ee370e2a/78797/2287df661c29a527.png 1125w,
/static/06a59de482dcf958399619f3ee370e2a/e8e04/2287df661c29a527.png 1270w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;111-从工程角度定义问题&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#111-%E4%BB%8E%E5%B7%A5%E7%A8%8B%E8%A7%92%E5%BA%A6%E5%AE%9A%E4%B9%89%E9%97%AE%E9%A2%98&quot; aria-label=&quot;111 从工程角度定义问题 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.1.1 从工程角度定义问题&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;软件的所有利益相关方都有着自己对项目的预期。所以架构师需要和产品经理、项目经理一起协作，共同定义项目的需求和目标。虽然大部分场景下都是产品经理定义功能特性，也就是我们说的”需求“，但是架构师需要关注另一种需求——质量属性。除此之外，还需要密切关注影响架构设计方向的约束和特性。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;112-分解系统分配职责&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#112-%E5%88%86%E8%A7%A3%E7%B3%BB%E7%BB%9F%E5%88%86%E9%85%8D%E8%81%8C%E8%B4%A3&quot; aria-label=&quot;112 分解系统分配职责 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.1.2 分解系统，分配职责&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;有的软件系统，挤成一团，臃肿笨重，一起发布迭代。如果将软件拆分成各种”零件“，大家各司其职，开发和交付的过程都会变得顺利很多。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构师只有把软件系统进行分解，才能制定出一个满足质量属性和其他系统需求的策略。比如，你可以指定一个组件实现用户注册的功能，指定另外一个组件负责图像的识别；可以分配不同的团队开发不同的模块；可以将数据读写分离，使系统具备更高的可靠性，可用性，可伸缩性。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;113-关注大局&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#113-%E5%85%B3%E6%B3%A8%E5%A4%A7%E5%B1%80&quot; aria-label=&quot;113 关注大局 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.1.3 关注大局&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;软件系统所处的环境中包含用户，企业，开发团队三类角色。企业雇佣和管理开发团队，开发团队开发并设计软件系统，将其运行在选用的硬件中。用户使用软件，从中获取乐趣与利润。企业则从用户中获取利润与收益。整个环境中包含的角色，软件，硬件等㩐诸多因素。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;从全局角度考虑整体系统意味着架构师需要处理的不仅仅是技术问题，人员，过程，业务需求等技术和非技术因素都将影响最后的软件系统。即使一个小小的决策也可能会产生深远的影响。所以架构师必须高瞻远瞩，纵观全局，不能只着眼于局部细节的设计。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;软件设计是一个不断挣扎的过程，在想要达成的目标与必须接受的现实之间寻找平衡。必须深思熟虑并做出取舍。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;114-在质量属性之间做取舍&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#114-%E5%9C%A8%E8%B4%A8%E9%87%8F%E5%B1%9E%E6%80%A7%E4%B9%8B%E9%97%B4%E5%81%9A%E5%8F%96%E8%88%8D&quot; aria-label=&quot;114 在质量属性之间做取舍 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.1.4 在质量属性之间做取舍&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;举个例子，假设需求目标要求系统的并发必须高达N/qps，（假设N是一个很大的值），我们可以通过加机器的方式来提高负载。但是这样一来硬件成本也就增加了。这就是一个典型的取舍：用高成本来换取高可用&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;软件开发过程中，类似的取舍很常见。架构师需要找出备选方案，再与各方一起协商如何取舍最合理。系统的拆解和分割也不一定会有预期般的干净利落，过程中可能会犯错。开发过程中也会不断地往架构中引入技术债。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;115-管理技术债务&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#115-%E7%AE%A1%E7%90%86%E6%8A%80%E6%9C%AF%E5%80%BA%E5%8A%A1&quot; aria-label=&quot;115 管理技术债务 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.1.5 管理技术债务&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;所有的软件都有技术债务。软件架构师知道系统是如何分解的，关注大局，指导划分出的各个模块协调工作，还需要将业务目标和技术决策放在一起考虑。只有这样才能游刃有余地管理技术债务。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;技术债务就像一条鸿沟，一边是当前的软件系统设计，另一边是你想要的，能够持续产生价值的设计。债务的多少可以通过填平这一鸿沟所需的代价衡量。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;这一点深有体会。现在维护的系统中，充斥着过去多个团队的设计理念和技术选型，并一直影响着后续接受维护的开发人员。技术债务就像是泛滥的洪水，硬生生地阻挡在我和我目标架构中间。目前唯一的策略是， 治理泛滥洪水的同时修建一些健壮的桥梁，帮助早日抵达目标。而这些都是偿还技术债务的代价。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;有时候，开发团队会适当引入技术债务来帮助快速实现业务目标，后续再逐步偿还代价。架构师在这个过程中，需要明确技术债务，帮助开发团队决定何时采用，如何管理。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;116-提升团队的架构技能&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#116-%E6%8F%90%E5%8D%87%E5%9B%A2%E9%98%9F%E7%9A%84%E6%9E%B6%E6%9E%84%E6%8A%80%E8%83%BD&quot; aria-label=&quot;116 提升团队的架构技能 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.1.6 提升团队的架构技能&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;架构师是整个团队的导师和顾问。设计酷炫却无人理解的架构毫无意义。作为团队的架构专家，架构师有责任向团队分享知识，帮助他们成功地开发出软件&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构师应当适时地传授设计技巧和架构理念。可以和组员结对设计，写文档授业解惑，还可以提出建设性的批评。把架构设计当作是一项社交活动，让团队成员参与到设计过程中来，这是最有效提升团队架构技能的方法。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;个人感觉在这里架构师的角色有一点leadership的意思，带领大家往前冲，达成目标。有leadership的加持，应该能够帮助成为更好的架构师吧？&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;12-什么是软件架构&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#12-%E4%BB%80%E4%B9%88%E6%98%AF%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84&quot; aria-label=&quot;12 什么是软件架构 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.2 什么是软件架构&lt;/h2&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;所谓的架构，是指构成一个系统的主要元素及它们之间的主要关联，这些元素和关联能够反映该系统的本质特征。从抽象的系统层面来看，软件架构、系统架构、解决方案架构和企业架构，本质上是一致的，区别在于关注的主体不同。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;软件架构是关于如何组织软件的一系列重大设计决策的集合，旨在实现期望的质量属性和其他软件特性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;设计决策的重要性体现在许多方面。可能对软件的质量属性、开发进度、成本产生影响。可能会影响到很多人，甚至影响到上下游的其他软件系统。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;好的架构能提升需求方要求的质量属性，抑制或者消除潜在的隐患。帮助开发团队多快好省地输出成果，不用连续加班。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;121-定义基本结构&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#121-%E5%AE%9A%E4%B9%89%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84&quot; aria-label=&quot;121 定义基本结构 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.2.1 定义基本结构&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;软件有它的主体结构。这个结构定义了软件系统的组织和协调方式。体现在你编写的代码和运行的软件中，甚至体现在你与他人的协作中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;将两个元素以某种关系连接在一起。为了避免空想架构导致无法落地，可以使用三种类型的元素和关系来构建架构。在《Software Architecture in Practice》一书中将这三种类型定义为模块（module）、组件连接器（component &amp;#x26; connector 简称 C&amp;#x26;C）和分配（allocation）。将相同类型的元素和关系连接在一起，就形成了结构。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;|示例元素|示例关系
---|---|---
模块|类、包、层、存储过程、模块、配置文件、数据库表|使用、允许使用、依赖
组件连接器|对象、连接、线程、进程、层、过滤器|调用、订阅、管道、发布、返回
分配|服务器、传感器、台式机、负载均衡器、团队、用户、Docker 容器|运行于、负责、开发、存储、支付&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;模块结构存在于设计阶段。编写代码的过程也是你与模块结构进行交互的过程。即使软件没有运行，模块结构依然存在于文件系统中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;组件连接器结构在软件运行时出现。在运行时，组件可以创建与其他组件的连接、产生新进程以及实例化新对象。系统不运行时C&amp;#x26;C结构便不复存在。只能从其运行留下的日志文件或者数据库条目中窥见其身影。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;分配结构展示了模块与C&amp;#x26;C之间，以及这些元素与现实物理元素之间的协同与响应关系。分配结构又称映射结构，因为它显示了元素之间的映射关系。比如某一个元素时运行在客户端，还是运行在服务器上？A团队负责构建系统的哪个部分？分配结构恩卡依回答这些问题。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;不同类型的结构适合用来思考不同的系统特性。比如模块接口可以考虑测试性和可维护性。C&amp;#x26;C结构则考虑运行时的问题，比如可以性和性能。如果你发现自己使用了混合结构（如静态元素使用了动态关系），那说明你的理解还有不足之处。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;13-称为团队的架构师&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#13-%E7%A7%B0%E4%B8%BA%E5%9B%A2%E9%98%9F%E7%9A%84%E6%9E%B6%E6%9E%84%E5%B8%88&quot; aria-label=&quot;13 称为团队的架构师 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.3 称为团队的架构师&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;有的团队有明确的架构师角色，而有的没有。虽然有的团队没有这样的头衔，但是仔细观察你会发现，有人在不知不觉中承担了这份工作。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构师可以是团队的领导者，也可以是那些以特定方式思考软件设计的人。架构师的名片上不一定印着”软件架构师“。每个团队都需要至少一名架构师，优秀的团队则不止一位。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果团队没有架构师，那么我们的机会就来了。只要乐意，你可以随时将架构思维引入团队的设计讨论，询问关于质量属性的问题，指明团队如何取舍，主动设计决策并开始接受更多架构设计职责。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果团队有架构师，可以主动帮忙，多多合作。开发软件系统是浩大的工程，关注细节的人越多，团队成功的可能性越大。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;131-从程序员向架构师转变&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#131-%E4%BB%8E%E7%A8%8B%E5%BA%8F%E5%91%98%E5%90%91%E6%9E%B6%E6%9E%84%E5%B8%88%E8%BD%AC%E5%8F%98&quot; aria-label=&quot;131 从程序员向架构师转变 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.3.1 从程序员向架构师转变&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在成为架构师之前，应该参与开发过3-5个系统，且承担的技术职责应该不断增加。随着架构职责增加，你会发现编程的时间越来越少。这是正常的，但是架构师不能完全放弃编程。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了记录和评估你从程序员到架构师的转变过程，你可以建立一个档案吗，记录你在每个项目中担任的角色，简要描述系统情况以及开发过程中学到的知识。这种回顾对所有技术领导者，尤其是架构师来说是必不可少的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;针对档案中的每一个项目，回答一下问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;项目的利益方是谁，主要业务目标是什么？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;项目的整体解决方案是什么样的？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;涉及到哪些技术？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;最大的风险是什么？你是如何克服的？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;如果有机会重新做一遍项目，你会如何改进？&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;无论你希望获得职位晋升，还是提高专业水平，都要有耐心。时刻做好准备，把握一切设计架构的机会。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;确实如此。站在技术的角度来说，如果想要能够往上走一个层级（这个层级指的是内在的能力，评价标准是个人过往的经验核能力。不是国内各公司的职级体系），确实需要有耐心，时刻准备。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;架构师不仅是团队中的角色，更是一种思维方式。即使是程序员，每天也会做出很多设计决定，其中有一部分是具有架构意义的。所以无论是谁，都应该慎重决策。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;14-开发出色的软件&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#14-%E5%BC%80%E5%8F%91%E5%87%BA%E8%89%B2%E7%9A%84%E8%BD%AF%E4%BB%B6&quot; aria-label=&quot;14 开发出色的软件 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.4 开发出色的软件&lt;/h2&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;书中提到架构可以从6个方面指引开发团队打造出色的软件，并在后续的章节中详细讲解了这几个方面。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;架构将大问题分解为容易处理的小问题。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;软件就爱够告诉大家如何协同工作。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;软件架构为讨论负责设计提供了基本词汇&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;软件架构关注的不仅仅是功能&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;软件架构让你避免犯重大错误&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;架构让软件更灵活&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;以上是《架构师修炼之道》一书的第一章节的内容，主要阐述了什么是架构师、什么是软件架构、以及软件架构对软件开发一些帮助。通过细品本章内容，我也意识到，其实我的工作已经是半个架构师了。书中提到的技术债务有亲身经历，好的架构可以为项目带来的帮助和提升这一点也是感同身受。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;下一章将介绍如何借助设计思维来确定架构设计该怎么做&lt;/p&gt;</content:encoded></item><item><title><![CDATA[《架构修炼师之道》摘录01-成为软件架构师]]></title><description><![CDATA[https://www.notion.so/images/page-cover/nasa_robert_stewart_spacewalk_2.jpg 本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的…]]></description><link>https://zhanglun.github.io/blogs/asdfasdf/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/asdfasdf/</guid><pubDate>Fri, 09 Jul 2021 08:00:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://www.notion.so/images/page-cover/nasa_robert_stewart_spacewalk_2.jpg&quot; class=&quot;link-underline&quot;&gt;https://www.notion.so/images/page-cover/nasa_robert_stewart_spacewalk_2.jpg&lt;/a&gt;&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;本系列内容来自《架构师修炼之道》。在自己的笔记中以半摘录的方式，用 blockquote 穿插自己的思考和感悟，以加深对内容的理解和消化。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;全书整体分为三个部分&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第一部分介绍软件架构的基础知识和架构师必备的设计思维&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第二部分讲解架构师需要掌握的核心技能和知识&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;第三部分讨论一系列使用的架构设计方法&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;前两部分适合从头到尾通读，第三部分用于参考和检索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;”软件架构导论“是第一部分的大标题，从标题可以看到，这一部分是介绍一些基本概念，架构原则和一些基础的设计知识等内容。作为深入架构设计的铺垫，这些内容必不可少。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;1-成为软件架构师&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-%E6%88%90%E4%B8%BA%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88&quot; aria-label=&quot;1 成为软件架构师 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1 成为软件架构师&lt;/h2&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;11-软件架构师的职责&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#11-%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%84%E8%81%8C%E8%B4%A3&quot; aria-label=&quot;11 软件架构师的职责 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.1 软件架构师的职责&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;什么是软件架构师？除了编程之外，还多诸多其他职责。从工程角度看待问题，将系统拆解成为众多可实现的模块，同时兼顾大局，保证系统整体有效运作；权衡软件功能和软件质量，管控技术栈，尽可能减少技术债务；锻炼和提升整个团队的架构设计能力；等等&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构师在团队里面的角色很独特。不是项目经理，却需要把控软件交付周期。不是产品经理，却要保证软件满足业务目标。编程的同时，还需要做更多的架构设计。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;img src=&quot;images/1931f31ed3fc52bf.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;#x26;X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&amp;#x26;X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220521%2Fus-west-2%2Fs3%2Faws4_request&amp;#x26;X-Amz-Date=20220521T033932Z&amp;#x26;X-Amz-Expires=3600&amp;#x26;X-Amz-Signature=f42f6d2aa0024bb25cc42e947648b3728daa12c4d33610b29b3cff178dacb118&amp;#x26;X-Amz-SignedHeaders=host&amp;#x26;x-id=GetObject&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;111-从工程角度定义问题&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#111-%E4%BB%8E%E5%B7%A5%E7%A8%8B%E8%A7%92%E5%BA%A6%E5%AE%9A%E4%B9%89%E9%97%AE%E9%A2%98&quot; aria-label=&quot;111 从工程角度定义问题 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.1.1 从工程角度定义问题&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;软件的所有利益相关方都有着自己对项目的预期。所以架构师需要和产品经理、项目经理一起协作，共同定义项目的需求和目标。虽然大部分场景下都是产品经理定义功能特性，也就是我们说的”需求“，但是架构师需要关注另一种需求——质量属性。除此之外，还需要密切关注影响架构设计方向的约束和特性。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;112-分解系统分配职责&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#112-%E5%88%86%E8%A7%A3%E7%B3%BB%E7%BB%9F%E5%88%86%E9%85%8D%E8%81%8C%E8%B4%A3&quot; aria-label=&quot;112 分解系统分配职责 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.1.2 分解系统，分配职责&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;有的软件系统，挤成一团，臃肿笨重，一起发布迭代。如果将软件拆分成各种”零件“，大家各司其职，开发和交付的过程都会变得顺利很多。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构师只有把软件系统进行分解，才能制定出一个满足质量属性和其他系统需求的策略。比如，你可以指定一个组件实现用户注册的功能，指定另外一个组件负责图像的识别；可以分配不同的团队开发不同的模块；可以将数据读写分离，使系统具备更高的可靠性，可用性，可伸缩性。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;113-关注大局&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#113-%E5%85%B3%E6%B3%A8%E5%A4%A7%E5%B1%80&quot; aria-label=&quot;113 关注大局 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.1.3 关注大局&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;软件系统所处的环境中包含用户，企业，开发团队三类角色。企业雇佣和管理开发团队，开发团队开发并设计软件系统，将其运行在选用的硬件中。用户使用软件，从中获取乐趣与利润。企业则从用户中获取利润与收益。整个环境中包含的角色，软件，硬件等㩐诸多因素。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;从全局角度考虑整体系统意味着架构师需要处理的不仅仅是技术问题，人员，过程，业务需求等技术和非技术因素都将影响最后的软件系统。即使一个小小的决策也可能会产生深远的影响。所以架构师必须高瞻远瞩，纵观全局，不能只着眼于局部细节的设计。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;软件设计是一个不断挣扎的过程，在想要达成的目标与必须接受的现实之间寻找平衡。必须深思熟虑并做出取舍。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;114-在质量属性之间做取舍&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#114-%E5%9C%A8%E8%B4%A8%E9%87%8F%E5%B1%9E%E6%80%A7%E4%B9%8B%E9%97%B4%E5%81%9A%E5%8F%96%E8%88%8D&quot; aria-label=&quot;114 在质量属性之间做取舍 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.1.4 在质量属性之间做取舍&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;举个例子，假设需求目标要求系统的并发必须高达N/qps，（假设N是一个很大的值），我们可以通过加机器的方式来提高负载。但是这样一来硬件成本也就增加了。这就是一个典型的取舍：用高成本来换取高可用&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;软件开发过程中，类似的取舍很常见。架构师需要找出备选方案，再与各方一起协商如何取舍最合理。系统的拆解和分割也不一定会有预期般的干净利落，过程中可能会犯错。开发过程中也会不断地往架构中引入技术债。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;115-管理技术债务&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#115-%E7%AE%A1%E7%90%86%E6%8A%80%E6%9C%AF%E5%80%BA%E5%8A%A1&quot; aria-label=&quot;115 管理技术债务 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.1.5 管理技术债务&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;所有的软件都有技术债务。软件架构师知道系统是如何分解的，关注大局，指导划分出的各个模块协调工作，还需要将业务目标和技术决策放在一起考虑。只有这样才能游刃有余地管理技术债务。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;技术债务就像一条鸿沟，一边是当前的软件系统设计，另一边是你想要的，能够持续产生价值的设计。债务的多少可以通过填平这一鸿沟所需的代价衡量。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;这一点深有体会。现在维护的系统中，充斥着过去多个团队的设计理念和技术选型，并一直影响着后续接受维护的开发人员。技术债务就像是泛滥的洪水，硬生生地阻挡在我和我目标架构中间。目前唯一的策略是， 治理泛滥洪水的同时修建一些健壮的桥梁，帮助早日抵达目标。而这些都是偿还技术债务的代价。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;有时候，开发团队会适当引入技术债务来帮助快速实现业务目标，后续再逐步偿还代价。架构师在这个过程中，需要明确技术债务，帮助开发团队决定何时采用，如何管理。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;116-提升团队的架构技能&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#116-%E6%8F%90%E5%8D%87%E5%9B%A2%E9%98%9F%E7%9A%84%E6%9E%B6%E6%9E%84%E6%8A%80%E8%83%BD&quot; aria-label=&quot;116 提升团队的架构技能 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.1.6 提升团队的架构技能&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;架构师是整个团队的导师和顾问。设计酷炫却无人理解的架构毫无意义。作为团队的架构专家，架构师有责任向团队分享知识，帮助他们成功地开发出软件&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构师应当适时地传授设计技巧和架构理念。可以和组员结对设计，写文档授业解惑，还可以提出建设性的批评。把架构设计当作是一项社交活动，让团队成员参与到设计过程中来，这是最有效提升团队架构技能的方法。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;个人感觉在这里架构师的角色有一点leadership的意思，带领大家往前冲，达成目标。有leadership的加持，应该能够帮助成为更好的架构师吧？&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;12-什么是软件架构&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#12-%E4%BB%80%E4%B9%88%E6%98%AF%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84&quot; aria-label=&quot;12 什么是软件架构 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.2 什么是软件架构&lt;/h2&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;所谓的架构，是指构成一个系统的主要元素及它们之间的主要关联，这些元素和关联能够反映该系统的本质特征。从抽象的系统层面来看，软件架构、系统架构、解决方案架构和企业架构，本质上是一致的，区别在于关注的主体不同。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;软件架构是关于如何组织软件的一系列重大设计决策的集合，旨在实现期望的质量属性和其他软件特性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;设计决策的重要性体现在许多方面。可能对软件的质量属性、开发进度、成本产生影响。可能会影响到很多人，甚至影响到上下游的其他软件系统。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;好的架构能提升需求方要求的质量属性，抑制或者消除潜在的隐患。帮助开发团队多快好省地输出成果，不用连续加班。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;121-定义基本结构&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#121-%E5%AE%9A%E4%B9%89%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84&quot; aria-label=&quot;121 定义基本结构 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.2.1 定义基本结构&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;软件有它的主体结构。这个结构定义了软件系统的组织和协调方式。体现在你编写的代码和运行的软件中，甚至体现在你与他人的协作中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;将两个元素以某种关系连接在一起。为了避免空想架构导致无法落地，可以使用三种类型的元素和关系来构建架构。在《Software Architecture in Practice》一书中将这三种类型定义为模块（module）、组件连接器（component &amp;#x26; connector 简称 C&amp;#x26;C）和分配（allocation）。将相同类型的元素和关系连接在一起，就形成了结构。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;|示例元素|示例关系
---|---|---
模块|类、包、层、存储过程、模块、配置文件、数据库表|使用、允许使用、依赖
组件连接器|对象、连接、线程、进程、层、过滤器|调用、订阅、管道、发布、返回
分配|服务器、传感器、台式机、负载均衡器、团队、用户、Docker 容器|运行于、负责、开发、存储、支付&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;模块结构存在于设计阶段。编写代码的过程也是你与模块结构进行交互的过程。即使软件没有运行，模块结构依然存在于文件系统中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;组件连接器结构在软件运行时出现。在运行时，组件可以创建与其他组件的连接、产生新进程以及实例化新对象。系统不运行时C&amp;#x26;C结构便不复存在。只能从其运行留下的日志文件或者数据库条目中窥见其身影。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;分配结构展示了模块与C&amp;#x26;C之间，以及这些元素与现实物理元素之间的协同与响应关系。分配结构又称映射结构，因为它显示了元素之间的映射关系。比如某一个元素时运行在客户端，还是运行在服务器上？A团队负责构建系统的哪个部分？分配结构恩卡依回答这些问题。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;不同类型的结构适合用来思考不同的系统特性。比如模块接口可以考虑测试性和可维护性。C&amp;#x26;C结构则考虑运行时的问题，比如可以性和性能。如果你发现自己使用了混合结构（如静态元素使用了动态关系），那说明你的理解还有不足之处。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;13-称为团队的架构师&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#13-%E7%A7%B0%E4%B8%BA%E5%9B%A2%E9%98%9F%E7%9A%84%E6%9E%B6%E6%9E%84%E5%B8%88&quot; aria-label=&quot;13 称为团队的架构师 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.3 称为团队的架构师&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;有的团队有明确的架构师角色，而有的没有。虽然有的团队没有这样的头衔，但是仔细观察你会发现，有人在不知不觉中承担了这份工作。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;架构师可以是团队的领导者，也可以是那些以特定方式思考软件设计的人。架构师的名片上不一定印着”软件架构师“。每个团队都需要至少一名架构师，优秀的团队则不止一位。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果团队没有架构师，那么我们的机会就来了。只要乐意，你可以随时将架构思维引入团队的设计讨论，询问关于质量属性的问题，指明团队如何取舍，主动设计决策并开始接受更多架构设计职责。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果团队有架构师，可以主动帮忙，多多合作。开发软件系统是浩大的工程，关注细节的人越多，团队成功的可能性越大。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;131-从程序员向架构师转变&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#131-%E4%BB%8E%E7%A8%8B%E5%BA%8F%E5%91%98%E5%90%91%E6%9E%B6%E6%9E%84%E5%B8%88%E8%BD%AC%E5%8F%98&quot; aria-label=&quot;131 从程序员向架构师转变 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.3.1 从程序员向架构师转变&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在成为架构师之前，应该参与开发过3-5个系统，且承担的技术职责应该不断增加。随着架构职责增加，你会发现编程的时间越来越少。这是正常的，但是架构师不能完全放弃编程。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了记录和评估你从程序员到架构师的转变过程，你可以建立一个档案吗，记录你在每个项目中担任的角色，简要描述系统情况以及开发过程中学到的知识。这种回顾对所有技术领导者，尤其是架构师来说是必不可少的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;针对档案中的每一个项目，回答一下问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;项目的利益方是谁，主要业务目标是什么？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;项目的整体解决方案是什么样的？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;涉及到哪些技术？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;最大的风险是什么？你是如何克服的？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;如果有机会重新做一遍项目，你会如何改进？&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;无论你希望获得职位晋升，还是提高专业水平，都要有耐心。时刻做好准备，把握一切设计架构的机会。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;确实如此。站在技术的角度来说，如果想要能够往上走一个层级（这个层级指的是内在的能力，评价标准是个人过往的经验核能力。不是国内各公司的职级体系），确实需要有耐心，时刻准备。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;架构师不仅是团队中的角色，更是一种思维方式。即使是程序员，每天也会做出很多设计决定，其中有一部分是具有架构意义的。所以无论是谁，都应该慎重决策。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;14-开发出色的软件&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#14-%E5%BC%80%E5%8F%91%E5%87%BA%E8%89%B2%E7%9A%84%E8%BD%AF%E4%BB%B6&quot; aria-label=&quot;14 开发出色的软件 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1.4 开发出色的软件&lt;/h2&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;书中提到架构可以从6个方面指引开发团队打造出色的软件，并在后续的章节中详细讲解了这几个方面。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;架构将大问题分解为容易处理的小问题。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;软件就爱够告诉大家如何协同工作。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;软件架构为讨论负责设计提供了基本词汇&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;软件架构关注的不仅仅是功能&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;软件架构让你避免犯重大错误&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;架构让软件更灵活&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;以上是《架构师修炼之道》一书的第一章节的内容，主要阐述了什么是架构师、什么是软件架构、以及软件架构对软件开发一些帮助。通过细品本章内容，我也意识到，其实我的工作已经是半个架构师了。书中提到的技术债务有亲身经历，好的架构可以为项目带来的帮助和提升这一点也是感同身受。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;下一章将介绍如何借助设计思维来确定架构设计该怎么做&lt;/p&gt;</content:encoded></item><item><title><![CDATA[ParseInt()的迷幻行为]]></title><description><![CDATA[最近看到一片文章 Solving a Mystery Behavior of parseInt() in JavaScript，讲的是JavaScript中的parseInt()的一个奇怪现象。 parseInt()是JavaScript内置的一个方法，能将数字型的字符串转换成…]]></description><link>https://zhanglun.github.io/blogs/2021-04-23-ParseInt()的迷幻行为/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2021-04-23-ParseInt()的迷幻行为/</guid><pubDate>Fri, 23 Apr 2021 06:20:51 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;最近看到一片文章 &lt;a href=&quot;%5Bhttps://dmitripavlutin.com/parseint-mystery-javascript/%5D(https://dmitripavlutin.com/parseint-mystery-javascript/)&quot; class=&quot;link-underline&quot;&gt;Solving a Mystery Behavior of parseInt() in JavaScript&lt;/a&gt;，讲的是JavaScript中的&lt;code&gt;parseInt()&lt;/code&gt;的一个奇怪现象。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;parseInt()&lt;/code&gt;是JavaScript内置的一个方法，能将数字型的字符串转换成整数。例如， 将 &lt;code&gt;&apos;100&apos;&lt;/code&gt;转换成&lt;code&gt;100&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const number = parseInt(&amp;#39;100&amp;#39;);
console.log(number); // 100&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;parseInt(numbericalString, radix)&lt;/code&gt;也可以接受第二个参数，解析一个字符串并返回指定基数的十进制整数， &lt;code&gt;radix&lt;/code&gt; 是2-36之间的整数，表示被解析字符串的基数，常用的是2，8，10和16。例如&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const number = parseInt(&amp;#39;100&amp;#39;, 2);
console.log(number); // 4

const number = parseInt(&amp;#39;100&amp;#39;, 8);
console.log(number); // 64&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;以上是&lt;code&gt;parseInt()&lt;/code&gt;的基本用法。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;parseInt的一个奇怪行为&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#parseInt%E7%9A%84%E4%B8%80%E4%B8%AA%E5%A5%87%E6%80%AA%E8%A1%8C%E4%B8%BA&quot; aria-label=&quot;parseInt的一个奇怪行为 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;parseInt()的一个奇怪行为&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt; praseInt(numbericalString)&lt;/code&gt; 会将其第一个参数转换为一个字符串，对该字符串进行解析，然后返回一个整数或 NaN，所以我们可以用 &lt;code&gt;parseInt()&lt;/code&gt; 方法来获取浮点数的整数。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;parseInt(0.5);      // =&amp;gt; 0
parseInt(0.05);     // =&amp;gt; 0
parseInt(0.005);    // =&amp;gt; 0
parseInt(0.0005);   // =&amp;gt; 0
parseInt(0.00005);  // =&amp;gt; 0
parseInt(0.000005); // =&amp;gt; 0&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;获取0.5，0.05这样的浮点数的整数返回&lt;code&gt;0&lt;/code&gt;，这看起来没有任何问题。但是 &lt;code&gt;parseInt()&lt;/code&gt; 会讲&lt;code&gt;0.0000005&lt;/code&gt; 转换成5。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;parseInt(0.0000005); // 5&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这到底是为什么呢？&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;解开谜团&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%A7%A3%E5%BC%80%E8%B0%9C%E5%9B%A2&quot; aria-label=&quot;解开谜团 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;解开谜团&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;前面提到 &lt;code&gt;parseInt&lt;/code&gt; 执行时，会先将第一个参数转换成字符串(&lt;a href=&quot;https://262.ecma-international.org/5.1/#sec-15.1.2.2&quot; class=&quot;link-underline&quot;&gt;ECMASCript ParseInt()&lt;/a&gt;)。其具体步骤如下，&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;声明&lt;code&gt;inputString&lt;/code&gt; = String(string)。&lt;/li&gt;
&lt;li&gt;声明 &lt;code&gt;S&lt;/code&gt;, 保存去掉 &lt;code&gt;inputString&lt;/code&gt; 开头的空格之后的字符串，如果 &lt;code&gt;inputString&lt;/code&gt; 是空字符串则返回空字符串。&lt;/li&gt;
&lt;li&gt;声明标记位 &lt;code&gt;sign&lt;/code&gt; = 1。&lt;/li&gt;
&lt;li&gt;如果&lt;code&gt;S&lt;/code&gt;不为空且第一个字符是减号&lt;code&gt;-&lt;/code&gt;，&lt;code&gt;sign&lt;/code&gt;设置为&lt;code&gt;-1&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;如果&lt;code&gt;S&lt;/code&gt;不为空且第一个字符是加号&lt;code&gt;+&lt;/code&gt;或者减号&lt;code&gt;-&lt;/code&gt;，移除第一个字符串。&lt;/li&gt;
&lt;li&gt;声明&lt;code&gt;R=ToInt32(radix)&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;声明&lt;code&gt;stripPrefix = true&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;如果 R !== 0，则&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;a. 如果R &amp;#x3C; 2 或者 R &gt; 36，返回NaN。&lt;/li&gt;
&lt;li&gt;b. 如果 R !== 16，设置&lt;code&gt;stripPrefix = false&lt;/code&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;9&quot;&gt;
&lt;li&gt;如果 R == 0&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;a. 设置 R = 10&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;10&quot;&gt;
&lt;li&gt;如果 stripPrefix === true&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;a. 如果S的长度大于2且前两个字符是&lt;code&gt;0x&lt;/code&gt;或者&lt;code&gt;0X&lt;/code&gt;，移除前两个字符，同时设置R = 16&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;11&quot;&gt;
&lt;li&gt;如果S包含了当前R进制不相关的字符（假定第一个这样的字符是Q)，设置Z为S的一个子字符串，这个子字符串是Q之前的所有字符。否则设置Z=S&lt;/li&gt;
&lt;li&gt;如果 &lt;code&gt;Z&lt;/code&gt; 为空，返回 &lt;code&gt;NaN&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;声明 &lt;code&gt;mathInt&lt;/code&gt; 为Z在当前R进制下的整数&lt;/li&gt;
&lt;li&gt;声明 &lt;code&gt;number&lt;/code&gt; 为 &lt;code&gt;mathInt&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;返回 &lt;code&gt;sign x number&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;那我们先用 &lt;code&gt;String()&lt;/code&gt; 来测试&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;String(0.5);      // =&amp;gt; &amp;#39;0.5&amp;#39;
String(0.05);     // =&amp;gt; &amp;#39;0.05&amp;#39;
String(0.005);    // =&amp;gt; &amp;#39;0.05&amp;#39;
String(0.0005);   // =&amp;gt; &amp;#39;0.005&amp;#39; 
String(0.00005);  // =&amp;gt; &amp;#39;0.00005&amp;#39;
String(0.000005); // =&amp;gt; &amp;#39;0.000005&amp;#39;

String(0.0000005); // =&amp;gt; &amp;#39;5e-7&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;可以看到&lt;code&gt;String(0.0000005)&lt;/code&gt;返回了科学计数法的格式&lt;code&gt;5e-7&lt;/code&gt;，那么按照上面提到的 &lt;code&gt;parseInt()&lt;/code&gt; 的实际处理过程，确实是返回&lt;code&gt;5&lt;/code&gt;。由于某些数字在其字符串表示形式中使用e字符（例如 6.022×23 表示 6.022e23 ），因此当对非常大或非常小的数字使用数字时，使用 &lt;code&gt;parseInt&lt;/code&gt; 截断数字将产生意外结果。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;将浮点数转换成整数的另一个更加安全的是 &lt;code&gt;Math.floor()&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Math.floor(0.5);      // =&amp;gt; 0
Math.floor(0.05);     // =&amp;gt; 0
Math.floor(0.005);    // =&amp;gt; 0
Math.floor(0.0005);   // =&amp;gt; 0
Math.floor(0.00005);  // =&amp;gt; 0
Math.floor(0.000005); // =&amp;gt; 0

Math.floor(0.0000005); // =&amp;gt; 0&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;那 parseInt(999999999999999999999) 返回多少呢？&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;参考文章&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0&quot; aria-label=&quot;参考文章 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;参考文章&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://dmitripavlutin.com/parseint-mystery-javascript/&quot; class=&quot;link-underline&quot;&gt;Solving a Mystery Behavior of parseInt() in JavaScript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/parseInt&quot; class=&quot;link-underline&quot;&gt;MDN ParseInt&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://262.ecma-international.org/5.1/#sec-15.1.2.2&quot; class=&quot;link-underline&quot;&gt;ECMASCript ParseInt()&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[劝架CommonJS和ESModule]]></title><description><![CDATA[今天在开发过程中遇到一个报错 糟糕，遇到CommonJS和ESModule两兄弟打架了😢 错误信息简单翻译一下就是: 我项目中使用require()加载了一个ES Module，后者不支持require()。要么我把自己的 JavaScript 文件后缀改成 .cjs ，然后用…]]></description><link>https://zhanglun.github.io/blogs/劝架CommonJS和ESModule/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/劝架CommonJS和ESModule/</guid><pubDate>Wed, 10 Feb 2021 09:29:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;今天在开发过程中遇到一个报错&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Error [ERR_REQUIRE_ESM]: Must use import to load ES Module: /root/projects/build-tool/node_modules/ora/index.js
require() of ES modules is not supported.
require() of /root/projects/build-tool/node_modules/ora/index.js from /root/projects/build-tool/init.js is an ES module file as it is a .js file whose nearest parent package.json contains &amp;quot;type&amp;quot;: &amp;quot;module&amp;quot; which defines all .js files in that package scope as ES modules.
Instead rename index.js to end in .cjs, change the requiring code to use import(), or remove &amp;quot;type&amp;quot;: &amp;quot;module&amp;quot; from /root/projects/build-tool/node_modules/ora/package.json.&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;糟糕，遇到CommonJS和ESModule两兄弟打架了😢&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;错误信息简单翻译一下就是: 我项目中使用&lt;code&gt;require()&lt;/code&gt;加载了一个ES Module，后者不支持&lt;code&gt;require()&lt;/code&gt;。要么我把自己的 JavaScript 文件后缀改成 &lt;code&gt;.cjs&lt;/code&gt; ，然后用 &lt;code&gt;import()&lt;/code&gt; 方法加载&lt;code&gt;Ora&lt;/code&gt;。要么我把Ora的package.json 中的 &lt;code&gt;type: module&lt;/code&gt; 去掉&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;按照第一种方式修改之后，代码立马就能跑起来。但是这种方法还是有些问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;项目中其他文件也有可能会引入到ESModule模式的依赖，我需要改更多文件的后缀&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;文件后缀修改之后，在其被导入的地方需要同步修改&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;目录中&lt;code&gt;.js&lt;/code&gt;和&lt;code&gt;.cjs&lt;/code&gt;的文件混在一起，都是JavaScript却总是给开发者一种混乱的感觉&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;在文件内部 &lt;code&gt;require()&lt;/code&gt; 和 &lt;code&gt;import()&lt;/code&gt; 并存，也带来了混乱&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;那么有没有更加优雅的“劝架”方法呢？在回答这个问题前，我们先来认识认识这两兄弟。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;CommonJS&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#CommonJS&quot; aria-label=&quot;CommonJS permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CommonJS&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在ESModule诞生之前，CommonJS作为NodeJS的模块系统标准。CommonJS是NodeJS社区孵化出的模块标准，实现了JavaScript在服务端的模块化。在CommonJS中，每一个JavaScript文件都是一个模块，可以使用&lt;code&gt;module.exports&lt;/code&gt; 或者 &lt;code&gt;exports&lt;/code&gt;导出变量，函数和对象。使用&lt;code&gt;require()&lt;/code&gt;加载模块。默认使用同步的方式加载模块。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// foo.js
module.exports = function() { 
  return &amp;#39;Hello foo!&amp;#39;;
}

// index.js
var foo = require(&amp;#39;./foo&amp;#39;);
console.log(foo()); // Hello foo!&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;具体的标准可以参考 &lt;a href=&quot;%5Bhttps://nodejs.org/dist/latest-v16.x/docs/api/modules.html%5D(https://nodejs.org/dist/latest-v16.x/docs/api/modules.html)&quot; class=&quot;link-underline&quot;&gt;NodeJS Modules&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;CommonJS是面向服务端的模块系统，浏览器端无法使用。早期使用AMD模块规范在浏览器端实现JavaScript的模块化开发和加载。Webpack等构建工具，按照NodeJS中的CommonJS标准，实现了一套解析逻辑，在打包阶段注入对CommonJS模块的解析逻辑，使得能够像NodeJS一样加载和导出CommonJS。这使得在前端开发阶段就能用上相对比较“标准化”的模块化开发。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;ESModule&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ESModule&quot; aria-label=&quot;ESModule permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ESModule&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在 ES6 提出了 ESModule 作为语言标准以后，JavaScript这门语言终于有了自己的模块化方案了，具体的标准可参考&lt;a href=&quot;%5Bhttps://tc39.es/ecma262/#sec-modules%5D(https://tc39.es/ecma262/#sec-modules)&quot; class=&quot;link-underline&quot;&gt;ECMAScript Modules&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;自 Node v8.5以来，开发人员已经能够使用参数&lt;code&gt;--experimental-modules&lt;/code&gt; 开启对ES模块规范的支持。从Node v12.4开始，模块可以在.mjs文件（或在某些情况下的.js文件）中定义，或者在Package.json中增加&lt;code&gt;type: modules&lt;/code&gt;来表示启用ESModule。而自Node v15.3开始，可以不用 experimental flag 使用ESModule。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;与CommonJS相比对最为直观的差别是，ESModule 使用 import 导出模块，使用 import 加载模块。比如说：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// foo.mjs
export function foo() { 
  return &amp;#39;Hello foo!&amp;#39;; 
}

// index.mjs
import { foo } from &amp;#39;./foo.mjs&amp;#39;;
console.log(foo()); // Hello foo!&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当然二者的差别不止如此。而二者之间的差异也间接引发了文章开篇所提到的那个问题。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;简单谈谈二者的差异&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AE%80%E5%8D%95%E8%B0%88%E8%B0%88%E4%BA%8C%E8%80%85%E7%9A%84%E5%B7%AE%E5%BC%82&quot; aria-label=&quot;简单谈谈二者的差异 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;简单谈谈二者的差异&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在CommonJS中，require() 是同步的。它不会返回Promise，也支持Callback。加载到模块之后会立刻执行，返回模块返回的对象。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在ESM中，模块的查找模块加载器。查找阶段，解析JavaScript文件找到import和export的调用，但不会执行import的文件。在解析阶段，ESM加载器可以立即检测到命名导入中的错误，并抛出一个异常，而不需要实际运行依赖的代码。解析通过之后，加载器开始异步下载和解析你导入的JavaScript，构造出依赖的module graph，最后代码开始执行。ES模块加载器保证了，在ES Module 构建的依赖图中，所有的脚本都是并行下载，但是顺序执行。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;可以看到，二者在模块加载和解析的过程已经有很大的差别了。这也使得两种方案下的模块无法很好的互相导入和导出。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;CommonJS不能 &lt;code&gt;require()&lt;/code&gt; ESModule的最简单的原因是，后者允许顶层的await ，但是前者不行。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在ESModule中，你可以这么写：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;export const foo = await fetch(&amp;#39;./data.json&amp;#39;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;但是在CommonJS中你得这么写：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;(async () =&amp;gt; {
	const { foo } = await fetch(&amp;#39;./foo.mjs&amp;#39;);
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;CommonJS可以导入 ESMoudle，但是不太好用。必须使用异步的动态导入&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;(async () =&amp;gt; {
    const {foo} = await import(&amp;#39;./foo.mjs&amp;#39;);
})();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;虽然能用，但是在导出的时候你得导出Promise，这可能会让使用的人感到困惑。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;ESModule 不能在导入阶段直接导入CommonJS具名导出的对象，你可以这么写：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;import _ form &amp;#39;./lodahs.cjs&amp;#39;;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;但是不能在导入的同时进行解构，因为解构出来的对象是&lt;strong&gt;具名导出的对象&lt;/strong&gt;，下面的操作会报错&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;import { shuffle } from &amp;#39;./lodash.cjs&amp;#39;
// SyntaxError: The requested module &amp;#39;./lodash.cjs&amp;#39; does not provide an export named &amp;#39;shuffle&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;因为CommonJS只有在执行的时候才能计算出&lt;strong&gt;具名导出的对象&lt;/strong&gt;，而ESModule的模块计算发生在解析阶段。所以你只能在导入之后再解构。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;import _ from &amp;#39;./lodash.cjs&amp;#39;;
const {shuffle} = _;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;对导出对象的处理上也有差异，在CommonJS中，导出的对象所指向的值是可以修改的&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// b.js
exports.name = &amp;#39;b&amp;#39;;

// a.js
let { name } = require(&amp;#39;b&amp;#39;);
name = 123;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;而使用ESModule规范的导入被当成常量处理，不允许修改：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// a.js
export let num = 1
export const addNumber = ()=&amp;gt;{
    num++
}

// b.js
import {  num , addNumber } from &amp;#39;./a&amp;#39;
num = 2

// 报错
num = 2
    ^
TypeError: Assignment to constant variable.&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;二者有如此多的差异，最好还是不要混用。但是在ESModule出现之前，所有的NPM包都是CommonJS规范标准下开发的。在实际开发过程中难免会遇到二者混合出现的场景，也就是文章开头遇到的错误。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;但是再想想，在日常的前端开发中，似乎经常遇到两种写法混用的情况，而且还没有遇到任何上述提到的问题。为什么呢？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;那是因为现在前端开发基本使用bundler工具打包过，其中使用了babel，将ES6的语法进行了转换，bundler工具最后以CommonJS的模式输出。在产出物中可以找到&lt;code&gt;__esModule&lt;/code&gt;属性，将导入的模块标记为ESModule，方便后续的处理。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// a.js
export default 1;

// main.js
import a from &amp;#39;./a&amp;#39;;

console.log(a);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;转换之后&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// a.js
Object.defineProperty(exports, &amp;quot;__esModule&amp;quot;, {
  value: true
});
exports.default = 1;

// main.js
&amp;#39;use strict&amp;#39;;

var _a = require(&amp;#39;./a&amp;#39;);

var _a2 = _interopRequireDefault(_a);

function _interopRequireDefault(obj) { return obj &amp;amp;&amp;amp; obj.__esModule ? obj : { default: obj }; }

console.log(_a2.default);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;所以回到最初的问题，有没有更优雅一些当时来解决我的问题呢？有，加上babel配置进行一次编译。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;加上一次编译&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8A%A0%E4%B8%8A%E4%B8%80%E6%AC%A1%E7%BC%96%E8%AF%91&quot; aria-label=&quot;加上一次编译 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;加上一次编译&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;@babel/preset-env 是babel的一个核心插件，用来转换代码，让开发者能用上新的特性。其中的modules属性允许我们将ES Module 转换成另一个模块类型。默认是auto， 设置为目标模块类型为CommonJS即可。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;参考：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://redfin.engineering/node-modules-at-war-why-commonjs-and-es-modules-cant-get-along-9617135eeca1&quot; class=&quot;link-underline&quot;&gt;Node Modules at War: Why CommonJS and ES Modules Can’t Get Along&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;CommonJS的执行过程&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#CommonJS%E7%9A%84%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B&quot; aria-label=&quot;CommonJS的执行过程 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CommonJS的执行过程&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在CommonJS中，使用require()加载模块，使用module.exports 导出模块。咱们先来看看require()，考虑一下代码：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// main.js
const fs = require(&amp;#39;fs&amp;#39;);
const a = require(&amp;#39;./a&amp;#39;;
const b = require(&amp;#39;../b/index.js&amp;#39;);

module.exports = {
	a,
  b
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在main.js 真正执行之前，Node会用一个Module Wrapper 将代码包裹&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;(function (exports, require, module, __filename, __dirname) {
	// main.js
	const fs = require(&amp;#39;fs&amp;#39;);
	const a = require(&amp;#39;./a&amp;#39;;
	const b = require(&amp;#39;../b/index.js&amp;#39;);
	
	module.exports = {
		a,
	  b
	}
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;通过这种方式实现了：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;将模块顶部的变量作用域（比如： var, const或者let)限制在模块中，而不是全局对象global&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;提供了一些指向当前模块的，看起来像是全局的变量&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;module 和 exports ，可以导出模块中的值&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;__filename是模块的绝对路径，__dirname是模块文件所在的文件夹路径&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;解决了模块作用域的问题之后，再来看看require()的事情。使用require可以导入NodeJS模块，JSON和本地文件。假设我们在目录Y中使用require(x)导入X，具体的执行过程如下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;plaintext&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;1. 如果 X 是核心模块（比如： fs, path, http)
   a. 返回核心模块
   b. 停止
2. 如果 X 以 &amp;#39;/&amp;#39; 开头
   a. 将 Y 设置为系统根目录
3. 如果 X 以 &amp;#39;./&amp;#39; or &amp;#39;/&amp;#39; 或者 &amp;#39;../&amp;#39;开头，按照下面的步骤顺序执行
   a. 执行 LOAD_AS_FILE(Y + X)
   b. 执行 LOAD_AS_DIRECTORY(Y + X)
   c. 抛错 &amp;quot;not found&amp;quot;
4. 如果 X 以 &amp;#39;#&amp;#39; 开头
   a. 执行 LOAD_PACKAGE_IMPORTS(X, dirname(Y))
5. 执行 LOAD_PACKAGE_SELF(X, dirname(Y))
6. 执行 LOAD_NODE_MODULES(X, dirname(Y))
7. 抛错 &amp;quot;not found&amp;quot;

LOAD_AS_FILE(X)
1. 如果 X 是一个文件, 以该文件的格式加载。停止
2. 如果 X.js 是一个文件, 以 JavaScript 文本的形式加载该文件。停止
3. 如果 X.json 是一个文件, 将它解析为一个 JavaScript 对象。 停止
4. 如果 X.node 是一个文件, 以二进制插件的形式加载该文件。 停止

LOAD_INDEX(X)
1. 如果 X/index.js 是一个文件, 以 JavaScript 文本的形式加载该文件。 停止
2. 如果 X/index.json 是一个文件, 将它解析为一个 JavaScript 对象。停止
3. 如果 X/index.node 是一个文件, 以二进制插件的形式加载该文件。停止

LOAD_AS_DIRECTORY(X)
1. 如果 X/package.json 是一个文件,
   a. 解析这个文件，查找 main 字段
   b. 如果 main 是可为 false 的值，前往第二步
   c. 否则 创建一个新的路径 M = X + (json main field)
   d. LOAD_AS_FILE(M)
   e. LOAD_INDEX(M)
   f. 抛错 &amp;quot;not found&amp;quot;
2. LOAD_INDEX(X)

LOAD_NODE_MODULES(X, START)
1. 从当前目录开始，向上遍历找到所有的“node_modules” let DIRS = NODE_MODULES_PATHS(START)
2. 遍历每一个目录，依次执行下面的步骤，直到最后抛出 &amp;quot;not found&amp;quot;
   a. LOAD_PACKAGE_EXPORTS(X, DIR)
   b. LOAD_AS_FILE(DIR/X)
   c. LOAD_AS_DIRECTORY(DIR/X)

NODE_MODULES_PATHS(START)
1. let PARTS = path split(START)
2. let I = count of PARTS - 1
3. let DIRS = [GLOBAL_FOLDERS]
4. while I &amp;gt;= 0,
   a. if PARTS[I] = &amp;quot;node_modules&amp;quot; CONTINUE
   b. DIR = path join(PARTS[0 .. I] + &amp;quot;node_modules&amp;quot;)
   c. DIRS = DIRS + DIR
   d. let I = I - 1
5. return DIRS

LOAD_PACKAGE_IMPORTS(X, DIR)
1. 找到离DIR最近的作用域SCOPE
2. 如果没有找到SCOPE，返回
3. 如果 SCOPE/package.json &amp;quot;imports&amp;quot; 是 null 或者 undefined, 返回
4. 4. 如果 SCOPE/package.json 的 &amp;quot;imports&amp;quot; 不为空，则检查 X 和 SCOPE 对应的文件的路径 let MATCH = PACKAGE_IMPORTS_RESOLVE(X, pathToFileURL(SCOPE), [&amp;quot;node&amp;quot;, &amp;quot;require&amp;quot;]) 。
5. RESOLVE_ESM_MATCH(MATCH).

LOAD_PACKAGE_EXPORTS(X, DIR)
1. Try to interpret X as a combination of NAME and SUBPATH where the name
   may have a @scope/ prefix and the subpath begins with a slash (`/`).
2. 如果 X does not match this pattern or DIR/NAME/package.json is not a file,
   return.
3. Parse DIR/NAME/package.json, and look for &amp;quot;exports&amp;quot; field.
4. If &amp;quot;exports&amp;quot; is null or undefined, return.
5. let MATCH = PACKAGE_EXPORTS_RESOLVE(pathToFileURL(DIR/NAME), &amp;quot;.&amp;quot; + SUBPATH,
   `package.json` &amp;quot;exports&amp;quot;, [&amp;quot;node&amp;quot;, &amp;quot;require&amp;quot;])defined in the ESM resolver.
6. RESOLVE_ESM_MATCH(MATCH)

LOAD_PACKAGE_SELF(X, DIR)
1. Find the closest package scope SCOPE to DIR.
2. If no scope was found, return.
3. If the SCOPE/package.json &amp;quot;exports&amp;quot; is null or undefined, return.
4. If the SCOPE/package.json &amp;quot;name&amp;quot; is not the first segment of X, return.
5. let MATCH = PACKAGE_EXPORTS_RESOLVE(pathToFileURL(SCOPE),
   &amp;quot;.&amp;quot; + X.slice(&amp;quot;name&amp;quot;.length), `package.json` &amp;quot;exports&amp;quot;, [&amp;quot;node&amp;quot;, &amp;quot;require&amp;quot;])
defined in the ESM resolver.
6. RESOLVE_ESM_MATCH(MATCH)

RESOLVE_ESM_MATCH(MATCH)
1. let { RESOLVED, EXACT } = MATCH
2. let RESOLVED_PATH = fileURLToPath(RESOLVED)
3. If EXACT is true,
   a. If the file at RESOLVED_PATH exists, load RESOLVED_PATH as its extension
      format. 停止
4. Otherwise, if EXACT is false,
   a. LOAD_AS_FILE(RESOLVED_PATH)
   b. LOAD_AS_DIRECTORY(RESOLVED_PATH)
5. THROW &amp;quot;not found&amp;quot;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;PACKAGE_IMPORTS_RESOLVE&lt;/code&gt; 的定义在 &lt;a href=&quot;https://nodejs.org/docs/latest-v14.x/api/esm.html#esm_resolver_algorithm&quot; class=&quot;link-underline&quot;&gt;esm_resolver_algorithm&lt;/a&gt;，里面还执行了其他的算法逻辑，感兴趣的同学可以自行阅读。在模块查找的过程中，如果找到了的package.json中有import字段，便会执行 &lt;code&gt;PACKAGE_IMPORTS_RESOLVE&lt;/code&gt; ，返回的是一个对象：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;```javascript
resolvedMatch {
	resolved: String; // 模块对应的路径
	exact: Boolean; // 精确查找 or 模糊查找
}
```&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[关于JavaScript的随机数]]></title><description><![CDATA[最近正在实现一个动画特效，有一个非常简单的需求 请求获取到一个数组A之后，将数组的内容以动画弹窗的方式展示给用户，要求： 每次弹窗出现的时间间隔是随机 弹窗的内容从数组A随机的一个元素 这里就涉及到随机数的创建了。 在JavaScript中生成随机数 在JavaScript中获…]]></description><link>https://zhanglun.github.io/blogs/2020-12-14-随机的联想/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2020-12-14-随机的联想/</guid><pubDate>Mon, 14 Dec 2020 07:29:41 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;最近正在实现一个动画特效，有一个非常简单的需求&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;请求获取到一个数组A之后，将数组的内容以动画弹窗的方式展示给用户，要求：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;每次弹窗出现的时间间隔是随机&lt;/li&gt;
&lt;li&gt;弹窗的内容从数组A随机的一个元素&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;这里就涉及到随机数的创建了。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;在JavaScript中生成随机数&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9C%A8JavaScript%E4%B8%AD%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0&quot; aria-label=&quot;在JavaScript中生成随机数 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;在JavaScript中生成随机数&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在JavaScript中获取随机数的方式很简单，&lt;code&gt;Math.random()&lt;/code&gt;返回一个范围[0, 1)的随机数。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const value = Math.random();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;利用这个可以快速实现指定区间内的随机数.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// [0, max)区间的一个随机整数
function getRandomInt(max) {
  return Math.floor(Math.random() * max);
}

// [min, max)区间的一个随机数
function getRandomArbitrary(min, max) {
  return Math.random() * (max - min) + min;
}

// [min, max)区间的一个随机整数
function getRandomInt(min, max) {
  min = Math.ceil(min);
  max = Math.floor(max);
  return Math.floor(Math.random() * (max - min)) + min; //不含最大值，含最小值
}
// [min, max]区间的一个随机整数
function getRandomIntInclusive(min, max) {
  min = Math.ceil(min);
  max = Math.floor(max);
  return Math.floor(Math.random() * (max - min + 1)) + min; //含最大值，含最小值 
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;似乎&lt;code&gt;Math.random()&lt;/code&gt;就只有这么多内容？如果只是使用，似乎足矣。但是对一个小细节我很在意：&lt;code&gt;Math.random()&lt;/code&gt;返回的&lt;strong&gt;伪随机数&lt;/strong&gt;。伪随机数？假的随机？难道随机数还分真假？好奇心驱使我继续挖掘&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;真假随机数&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%9C%9F%E5%81%87%E9%9A%8F%E6%9C%BA%E6%95%B0&quot; aria-label=&quot;真假随机数 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;真假随机数？&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在讨论真假之前，先明确&lt;strong&gt;随机数&lt;/strong&gt;的定义。随机数在不同领域范畴有不同含义，在密码学领域中，一个数字是否是随机数，需要满足下面三个条件：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;统计学伪随机性。统计学伪随机性指的是在给定的随机比特流样本中，1的数量大致等于0的数量，同理，“10”“01”“00”“11”四者数量大致相等。类似的标准被称为统计学随机性。满足这类要求的数字在人类“一眼看上去”是随机的。&lt;/li&gt;
&lt;li&gt;密码学安全伪随机性。其定义为，给定随机样本的一部分和随机算法，不能有效的演算出随机样本的剩余部分。&lt;/li&gt;
&lt;li&gt;真随机性。其定义为随机样本不可重现。实际上只要给定边界条件，真随机数并不存在，可是如果产生一个真随机数样本的边界条件十分复杂且难以捕捉（比如当地的背景辐射波动值），可以认为用这个方法演算出来了真随机数。但实际上，这也只是非常接近真随机数的伪随机数，一般认为，无论是背景辐射、物理噪音、抛硬币等等都是可被观察了解的，任何基于经典力学产生的随机数，都只是伪随机数&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;相应的，随机数也分为三类：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;伪随机数：满足第一个条件的随机数。&lt;/li&gt;
&lt;li&gt;密码学安全的伪随机数：同时满足前两个条件的随机数。可以通过密码学安全伪随机数生成器计算得出。&lt;/li&gt;
&lt;li&gt;真随机数：同时满足三个条件的随机数。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;也就是说前面提到的 &lt;code&gt;Math.random()&lt;/code&gt;返回的伪随机数满足条件：统计学伪随机性，简单来说就是“看上去随机的”。那在计算机中这个所谓的“统计学伪随机”是怎么一回事呢？下面是来自wiki百科的解释&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;伪随机性（英语：Pseudorandomness）是一个过程似乎是随机的，但实际上并不是。例如伪随机数是使用一个确定性的算法计算出来的似乎是随机的数序，因此伪随机数实际上并不随机。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;在计算机中，计算随机数的函数称之为随机函数。这些函数都是有周期性的。怎么理解这个周期性？简单来说就是生成的随机数有着周期性变化规律，一旦掌握了这个规律，便能推测下一次随机的返回的结果。下图1是真随机数的可视化效果，图2是伪随机数的可视化效果
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 512px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/749a06e8fff9b0f290c090110d560615/36dd4/1.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAH/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAEQoJQA/8QAFBABAAAAAAAAAAAAAAAAAAAAMP/aAAgBAQABBQIf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFBABAAAAAAAAAAAAAAAAAAAAMP/aAAgBAQAGPwIf/8QAFBABAAAAAAAAAAAAAAAAAAAAMP/aAAgBAQABPyEf/9oADAMBAAIAAwAAABATCAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAbEAACAgMBAAAAAAAAAAAAAAAAARExQWGRUf/aAAgBAQABPxBQjGyJtJlJpEcOFNbQiX6f/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;1&quot;
        title=&quot;1&quot;
        src=&quot;/static/749a06e8fff9b0f290c090110d560615/36dd4/1.jpg&quot;
        srcset=&quot;/static/749a06e8fff9b0f290c090110d560615/bc01b/1.jpg 188w,
/static/749a06e8fff9b0f290c090110d560615/bf173/1.jpg 375w,
/static/749a06e8fff9b0f290c090110d560615/36dd4/1.jpg 512w&quot;
        sizes=&quot;(max-width: 512px) 100vw, 512px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;图1&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 512px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4ad016549c3d65c289a0705d0ea5e8ec/36dd4/2.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAH/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAEAACA//8QAFBABAAAAAAAAAAAAAAAAAAAAMP/aAAgBAQABBQIf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFBABAAAAAAAAAAAAAAAAAAAAMP/aAAgBAQAGPwIf/8QAFBABAAAAAAAAAAAAAAAAAAAAMP/aAAgBAQABPyEf/9oADAMBAAIAAwAAABAAADz/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAeEAABBAEFAAAAAAAAAAAAAAABABAhMRFBYXGh8P/aAAgBAQABPxBvaq2xt0wEjhChAX//2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;2&quot;
        title=&quot;2&quot;
        src=&quot;/static/4ad016549c3d65c289a0705d0ea5e8ec/36dd4/2.jpg&quot;
        srcset=&quot;/static/4ad016549c3d65c289a0705d0ea5e8ec/bc01b/2.jpg 188w,
/static/4ad016549c3d65c289a0705d0ea5e8ec/bf173/2.jpg 375w,
/static/4ad016549c3d65c289a0705d0ea5e8ec/36dd4/2.jpg 512w&quot;
        sizes=&quot;(max-width: 512px) 100vw, 512px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;图2&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;周期性体现在图2的有规律的纹理中，关于这个周期性参数，也是一个很大的课题，不在本次研究的范围。所有的计算机算法均是确定性算法，所以随机函数生成的都是伪随机数。大部分编程语言库中预备了的随机函数生成的都是统计学伪随机数。试着用伪代码来实现一个rondaon&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let int next = 1;    // 种子

// 生成伪随机数
const rand = () =&amp;gt; {
    next = next * 1103515245 + 12345;
    return (next / 65536) % 32768;
}

// 修改种
const srand = (seed) {
    next = seed;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Web-Crypto-API&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Web-Crypto-API&quot; aria-label=&quot;Web Crypto API permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Web Crypto API&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;Math.random() 不能提供像密码一样安全的随机数字。不要使用它们来处理有关安全的事情。使用 &lt;code&gt;Web Crypto API&lt;/code&gt; 来代替, 和更精确的 `window.crypto.getRandomValues() 方法。Crypto.getRandomValues() 方法可以获取符合密码学要求的安全的随机值。传入参数的数组被随机值填充。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var array = new Uint32Array(10);
window.crypto.getRandomValues(array);

console.log(&amp;quot;Your lucky numbers:&amp;quot;);
for (var i = 0; i &amp;lt; array.length; i++) {
    console.log(array[i]);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;V8中的Random&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#V8%E4%B8%AD%E7%9A%84Random&quot; aria-label=&quot;V8中的Random permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;V8中的Random&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;先明确一点，在ECMAScript中定义的 &lt;a href=&quot;https://262.ecma-international.org/6.0/#sec-math.random&quot; class=&quot;link-underline&quot;&gt;Math.random()&lt;/a&gt;是规范，各自的实现取决于宿主环境。在V8和大多数的JavaScript引擎中，random都是使用一个伪随机数生成器（PRNG）实现的。在PRNG中，随机数都是从一个内部的状态导出的，也就是我们常说的“随机种子”，内部再通过确定的方法确定新的随机数。由于seed是确定的，创建的一系列随机数也是确定的，又因为seed的大小是固定的，使得最后创建的数字会出现重复。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;有很多PRNG算法，比较有名的是Mersenne-Twister算法和LCG算法。他们各有优势和不足，感兴趣的朋友可以自行查阅，这里不做讨论（超纲了）。在15年的之前V8使用的是MWC1616算法来实现随机数，但是有一些(&lt;a href=&quot;https://v8.dev/blog/math-random&quot; class=&quot;link-underline&quot;&gt;问题&lt;/a&gt;)，在15年之后将算法替换成了&lt;a href=&quot;http://vigna.di.unimi.it/ftp/papers/xorshiftplus.pdf&quot; class=&quot;link-underline&quot;&gt;xorshift128+&lt;/a&gt;。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;参考&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%82%E8%80%83&quot; aria-label=&quot;参考 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;参考&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%80%A7&quot; class=&quot;link-underline&quot;&gt;伪随机性&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Math/random&quot; class=&quot;link-underline&quot;&gt;Math.random()&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://v8.dev/blog/math-random&quot; class=&quot;link-underline&quot;&gt;There’s Math.random(), and then there’s Math.random()&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://262.ecma-international.org/6.0/#sec-math.random&quot; class=&quot;link-underline&quot;&gt;sec-math.random&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[如何在项目中接入single-spa]]></title><description><![CDATA[之前的文章single-spa源码解析-registerApplication和start中，对single-spa提供的两个关键方法的源码进行了简单分析。今天来讲一讲如何在项目中接入使用。 要创建一个single-spa应用程序，需要做三件事： 创建一个 html 文件 这个…]]></description><link>https://zhanglun.github.io/blogs/2020-11-28-如何在项目中接入single-spa/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2020-11-28-如何在项目中接入single-spa/</guid><pubDate>Sat, 28 Nov 2020 12:27:18 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;之前的文章&lt;a href=&quot;../single-spa%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-registerapplication%E5%92%8Cstart&quot; class=&quot;link-underline&quot;&gt;single-spa源码解析-registerApplication和start&lt;/a&gt;中，对single-spa提供的两个关键方法的源码进行了简单分析。今天来讲一讲如何在项目中接入使用。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;要创建一个single-spa应用程序，需要做三件事：&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;创建一个-html-文件&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-html-%E6%96%87%E4%BB%B6&quot; aria-label=&quot;创建一个 html 文件 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建一个 html 文件&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;这个文件的目的就是加载single-spa的 config 配置，调用 &lt;code&gt;registerApplication()&lt;/code&gt; 方法。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;html&amp;gt;
&amp;lt;body&amp;gt;
	&amp;lt;script src=&amp;quot;single-spa-config.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;创建一个single-spa-config&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAsingle-spa-config&quot; aria-label=&quot;创建一个single spa config permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建一个single-spa-config。&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;只有先注册应用，single—spa才能知道在什么时机，如何初始化、下载、挂载和卸载对应的应用。通常会在配置文件中将应用注册。通过调用&lt;code&gt;registerApplication&lt;/code&gt;方法来注册应用。例如：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// single-spa-config.js
import { registerApplication, start } from &amp;#39;single-spa&amp;#39;;
// Simple usage
registerApplication(
  &amp;#39;app2&amp;#39;,
  () =&amp;gt; import(&amp;#39;src/app2/main.js&amp;#39;),
  (location) =&amp;gt; location.pathname.startsWith(&amp;#39;/app2&amp;#39;),
  { some: &amp;#39;value&amp;#39; }
);
// Config with more expressive API
registerApplication({
  name: &amp;#39;app1&amp;#39;,
  app: () =&amp;gt; import(&amp;#39;src/app1/main.js&amp;#39;),
  activeWhen: &amp;#39;/app1&amp;#39;,
  customProps: {
    some: &amp;#39;value&amp;#39;,
  }
);
start();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;参数&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%82%E6%95%B0&quot; aria-label=&quot;参数 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;参数&lt;/h3&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;name&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#name&quot; aria-label=&quot;name permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;name&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;registerApplication&lt;/code&gt;的第一个参数表示应用名称，&lt;code&gt;name&lt;/code&gt;必须是string类型&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;Loading-Function-or-Application&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Loading-Function-or-Application&quot; aria-label=&quot;Loading Function or Application permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Loading Function or Application&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;registerApplication&lt;/code&gt;可以是一个Promise类型的 &lt;a href=&quot;configuration#loading-function&quot; class=&quot;link-underline&quot;&gt;加载函数&lt;/a&gt;，也可以是一个已经被解析的应用。&lt;/p&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;Application-as-second-argument&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Application-as-second-argument&quot; aria-label=&quot;Application as second argument permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Application as second argument&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;你可以选择将一个已经被解析过的应用作为&lt;code&gt;registerApplication&lt;/code&gt;的第二个参数，这个应用其实是一个包含各个生命周期函数的对象。我们既可以从另外一个文件中引入该对象，也可以在single-spa的配置文件中定义这个对象。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const application = {
  bootstrap: () =&amp;gt; Promise.resolve(), //bootstrap function
  mount: () =&amp;gt; Promise.resolve(), //mount function
  unmount: () =&amp;gt; Promise.resolve(), //unmount function
}
registerApplication(&amp;#39;applicationName&amp;#39;, application, activityFunction)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;加载函数&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8A%A0%E8%BD%BD%E5%87%BD%E6%95%B0&quot; aria-label=&quot;加载函数 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;加载函数&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;registerApplication&lt;/code&gt;的第二个参数必须是返回promise的函数(或&lt;a href=&quot;https://ponyfoo.com/articles/understanding-javascript-async-await&quot; class=&quot;link-underline&quot;&gt;“async function”&lt;/a&gt;方法)。这个函数没有入参，会在应用第一次被下载时调用。返回的Promise resolve之后的结果必须是一个可以被解析的应用。常见的实现方法是使用import加载：&lt;code&gt;() =&gt; import(&apos;/path/to/application.js&apos;)&lt;/code&gt;&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;激活函数&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0&quot; aria-label=&quot;激活函数 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;激活函数&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;registerApplication&lt;/code&gt;的第三个参数需要是一个纯函数，&lt;code&gt;window.location&lt;/code&gt;会作为第一个参数被调用，当函数返回的值为真(truthy)值时，应用会被激活。通常情况下，Activity function会根据&lt;code&gt;window.location&lt;/code&gt;/后面的path来决定该应用是否需要被激活。
另外一种场景是single-spa根据顶级路由查找应用，而每个应用会处理自身的子路由。 在以下场景，single-spa会调用应用的activity function&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在以下情况下，single-spa将调用每个应用的活动函数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;hashchange&lt;/code&gt; or &lt;code&gt;popstate&lt;/code&gt;事件触发时&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pushState&lt;/code&gt; or &lt;code&gt;replaceState&lt;/code&gt;被调用时&lt;/li&gt;
&lt;li&gt;在single-spa上手动调用[&lt;code&gt;triggerAppChange&lt;/code&gt;] 方法&lt;/li&gt;
&lt;li&gt;&lt;code&gt;checkActivityFunctions&lt;/code&gt;方法被调用时&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;自定义属性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B1%9E%E6%80%A7&quot; aria-label=&quot;自定义属性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自定义属性&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;registerApplication&lt;/code&gt;函数可选的第四个参数是 &lt;a href=&quot;/docs/building-applications/#custom-props&quot; class=&quot;link-underline&quot;&gt;custom props&lt;/a&gt;。这个参数会传递给 single-spa 的 &lt;code&gt;lifecycle&lt;/code&gt; 函数。自定义属性可以是一个对象，也可以是一个返回Object的函数。如果自定属性是一个函数，函数的参数是应用的名字（application name)和当前&lt;code&gt;window.location&lt;/code&gt;。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;使用对象参数&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8%E5%AF%B9%E8%B1%A1%E5%8F%82%E6%95%B0&quot; aria-label=&quot;使用对象参数 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用对象参数&lt;/h3&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;singleSpa.registerApplication({
  name: &amp;#39;myApp&amp;#39;,
  app: () =&amp;gt; import(&amp;#39;src/myApp/main.js&amp;#39;),
  activeWhen: [&amp;#39;/myApp&amp;#39;, (location) =&amp;gt; location.pathname.startsWith(&amp;#39;/some/other/path&amp;#39;)],
  customProps: {
    some: &amp;#39;value&amp;#39;,
  },
});

singleSpa.registerApplication({
  name: &amp;#39;myApp&amp;#39;,
  app: () =&amp;gt; import(&amp;#39;src/myApp/main.js&amp;#39;),
  activeWhen: [&amp;#39;/myApp&amp;#39;, (location) =&amp;gt; location.pathname.startsWith(&amp;#39;/some/other/path&amp;#39;)],
  customProps: (name, location) =&amp;gt; ({
    some: &amp;#39;value&amp;#39;,
  }),
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;configname&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#configname&quot; aria-label=&quot;configname permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;config.name&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;必须是字符串。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;configapp&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#configapp&quot; aria-label=&quot;configapp permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;config.app&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;应用的定义，它可以是一个单spa生命周期的对象，加载函数或者与第二个参数相同。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;configactiveWhen&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#configactiveWhen&quot; aria-label=&quot;configactiveWhen permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;config.activeWhen&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;可以是激活函数，比如参数API、路径前缀或两者的数组。因为最常见的用例是使用&lt;code&gt;window.location&lt;/code&gt; 将其URL前缀进行匹配，所以我们帮你实现了这个方法。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;Path-prefix&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Path-prefix&quot; aria-label=&quot;Path prefix permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Path prefix&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;路径前缀会匹配url，允许以下每一种前缀：&lt;/p&gt;
&lt;dl&gt;
  &lt;dt&gt;&apos;/app1&apos;&lt;/dt&gt;
  &lt;dd&gt;✅ https://app.com/app1&lt;/dd&gt;
  &lt;dd&gt;✅ https://app.com/app1/anything/everything&lt;/dd&gt;
  &lt;dd&gt;🚫 https://app.com/app2&lt;/dd&gt;
  &lt;dt&gt;&apos;/users/:userId/profile&apos;&lt;/dt&gt;
  &lt;dd&gt;✅ https://app.com/users/123/profile&lt;/dd&gt;
  &lt;dd&gt;✅ https://app.com/users/123/profile/sub-profile/&lt;/dd&gt;
  &lt;dd&gt;🚫 https://app.com/users//profile/sub-profile/&lt;/dd&gt;
  &lt;dd&gt;🚫 https://app.com/users/profile/sub-profile/&lt;/dd&gt;
  &lt;dt&gt;&apos;/pathname/#/hash&apos;&lt;/dt&gt;
  &lt;dd&gt;✅ https://app.com/pathname/#/hash&lt;/dd&gt;
  &lt;dd&gt;✅ https://app.com/pathname/#/hash/route/nested&lt;/dd&gt;
  &lt;dd&gt;🚫 https://app.com/pathname#/hash/route/nested&lt;/dd&gt;
  &lt;dd&gt;🚫 https://app.com/pathname#/another-hash&lt;/dd&gt;
  &lt;dt&gt;[&apos;/pathname/#/hash&apos;, &apos;/app1&apos;]&lt;/dt&gt;
  &lt;dd&gt;✅ https://app.com/pathname/#/hash/route/nested&lt;/dd&gt;
  &lt;dd&gt;✅ https://app.com/app1/anything/everything&lt;/dd&gt;
  &lt;dd&gt;🚫 https://app.com/pathname/app1&lt;/dd&gt;
  &lt;dd&gt;🚫 https://app.com/app2&lt;/dd&gt;
&lt;/dl&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;自定义属性-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B1%9E%E6%80%A7-1&quot; aria-label=&quot;自定义属性 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自定义属性&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;registerApplication&lt;/code&gt;函数可选的第四个参数是 &lt;a href=&quot;/docs/building-applications/#custom-props&quot; class=&quot;link-underline&quot;&gt;custom props&lt;/a&gt;。这个参数会传递给 single-spa 的 &lt;code&gt;lifecycle&lt;/code&gt; 函数。自定义属性可以是一个对象，也可以是一个返回Object的函数。如果自定属性是一个函数，函数的参数是应用的名字（application name)和当前&lt;code&gt;window.location&lt;/code&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;调用-singleSpastart&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%B0%83%E7%94%A8-singleSpastart&quot; aria-label=&quot;调用 singleSpastart permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;调用 singleSpa.start()&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;api.md#start&quot; class=&quot;link-underline&quot;&gt;&lt;code&gt;start()方法&lt;/code&gt;&lt;/a&gt; &lt;strong&gt;必须&lt;/strong&gt;被single-spa配置文件的js调用，这时应用才会被真正挂载。在&lt;code&gt;start&lt;/code&gt;被调用之前，应用先被下载，但不会初始化/挂载/卸载。&lt;code&gt;start&lt;/code&gt;方法可以协助我们更好提升应用的性能。举个例子，我们可能会马上注册一个应用(为了立刻下载代码)，但不能马上就在DOM节点上挂载该应用，而是需要等一个AJAX请求(可能会获取用户的登录信息)完成后，再根据结果进行挂载。这种情况下，最佳实践是先调用&lt;code&gt;registerApplication&lt;/code&gt;，等AJAX请求完成后再调用&lt;code&gt;start&lt;/code&gt;。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//single-spa-config.js
import { start } from &amp;#39;single-spa&amp;#39;;

/*在注册应用之前调用start意味着single-spa可以立即安装应用，无需等待单页应用的任何初始设置。*/
start();
// 注册应用。。。。&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;创建一个应用程序&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F&quot; aria-label=&quot;创建一个应用程序 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建一个应用程序。&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;single-spa 应用与普通的单页面是一样的，只不过它没有HTML页面。在一个single-spa中，可以包含许多被注册的应用，而各个应用可以使用不同的框架。被注册的这些应用维护自己的客户端路由，使用自己需要的框架或者类库。应用只要通过挂载，便可渲染自己的html页面，并自由实现功能。“挂载”(mounted)的概念指的是被注册的应用内容是否已展示在DOM上。我们可通过应用的&lt;a href=&quot;#%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0&quot; class=&quot;link-underline&quot;&gt;activity function&lt;/a&gt;来判断其是否已被挂载。应用在未挂载之前，会一直保持休眠状态。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在一个 single-spa 页面，注册的应用会经过下载(loaded)、初始化(initialized)、被挂载(mounted)、卸载(unmounted)和unloaded（被移除）等过程。single-spa会通过“生命周期”为这些过程提供钩子函数。
生命周期函数是 single-spa 在注册的应用上调用的一系列函数，single-spa 会在各应用的主文件中，查找对应的函数名并进行调用。所以注册的应用必须保证在其入口文件实现下面提到的各个生命周期函数。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;bootstrap&lt;/code&gt;, &lt;code&gt;mount&lt;/code&gt;, and &lt;code&gt;unmount&lt;/code&gt;的实现是必须的，&lt;code&gt;unload&lt;/code&gt;则是可选的&lt;/li&gt;
&lt;li&gt;生命周期函数必须有返回值，可以是Promise或者&lt;code&gt;async&lt;/code&gt;函数&lt;/li&gt;
&lt;li&gt;如果导出的是函数数组而不是单个函数，这些函数会被依次调用，对于promise函数，会等到resolve之后再调用下一个函数&lt;/li&gt;
&lt;li&gt;如果 single-spa &lt;a href=&quot;api.md#start&quot; class=&quot;link-underline&quot;&gt;未启动&lt;/a&gt;，各个应用会被下载，但不会被初始化、挂载或卸载。&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;注&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在&lt;a href=&quot;ecosystem.md&quot; class=&quot;link-underline&quot;&gt;single-spa 生态&lt;/a&gt;中有各个主流框架对于生命周期函数的实现，这些文档有助于理解这些helper执行的操作，也有助于你自己实现生命周期函数。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;生命周期参数&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%8F%82%E6%95%B0&quot; aria-label=&quot;生命周期参数 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;生命周期参数&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;生命周期函数使用”props” 传参，这个对象包含single-spa相关信息和其他的自定义属性。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function bootstrap(props) {
  const {
    name,        // 应用名称
    singleSpa,   // singleSpa实例
    mountParcel, // 手动挂载的函数
    customProps  // 自定义属性
  } = props;     // Props 会传给每个生命周期函数
  return Promise.resolve();
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;内置参数&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%86%85%E7%BD%AE%E5%8F%82%E6%95%B0&quot; aria-label=&quot;内置参数 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;内置参数&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;每个生命周期函数的入参都会保证有如下参数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;name&lt;/code&gt;: 注册到 single-spa 的应用名称&lt;/li&gt;
&lt;li&gt;&lt;code&gt;singleSpa&lt;/code&gt;: 对singleSpa 实例的引用, 方便各应用和类库调用singleSpa提供的API时不再导入它。 可以解决有多个webpack配置文件构建时无法保证只引用一个singleSpa实例的问题。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mountParcel&lt;/code&gt;: &lt;a href=&quot;/docs/parcels-api.html#mountparcel&quot; class=&quot;link-underline&quot;&gt;mountParcel 函数&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;自定义参数&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0&quot; aria-label=&quot;自定义参数 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自定义参数&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;除single-spa提供的内置参数外，还可以指定自定义参数，在调用各个生命周期函数时传入。指定方法是在调用&lt;code&gt;registerApplication&lt;/code&gt;时，传入第4个参数。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// root.application.js
singleSpa.registerApplication({
  name: &amp;#39;app1&amp;#39;,
  activeWhen,
  app,
  customProps: { authToken: &amp;quot;d83jD63UdZ6RS6f70D0&amp;quot; }
});
singleSpa.registerApplication({
  name: &amp;#39;app1&amp;#39;,
  activeWhen,
  app,
  customProps: (name, location) =&amp;gt; {
    return { authToken: &amp;quot;d83jD63UdZ6RS6f70D0&amp;quot; };
  }
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// app1.js
export function mount(props) {
  console.log(props.authToken); // 可以在 app1 中获取到authToken参数
  return reactLifecycles.mount(props);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;可能使用到的场景：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;各个应用共享一个公共的 access token&lt;/li&gt;
&lt;li&gt;下发初始化信息，如渲染目标&lt;/li&gt;
&lt;li&gt;传递对事件总线（event bus）的引用，方便各应用之间进行通信&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;注意如果没有提供自定义参数，则&lt;code&gt;props.customProps&lt;/code&gt;默认会返回一个空对象。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;下载load&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%8B%E8%BD%BDload&quot; aria-label=&quot;下载load permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;下载(load)&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;注册的应用会被懒加载，这指的是该应用的代码会从服务器端下载并执行。注册的应用在&lt;a href=&quot;#%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0&quot; class=&quot;link-underline&quot;&gt;activity function&lt;/a&gt; 第一次返回真值(truthy value)时，下载动作会发生。在下载过程中，建议尽可能执行少的操作，可以在&lt;code&gt;bootstrap&lt;/code&gt;生命周期之后再执行各项操作。若确实有在下载时需要执行的操作，可将代码放入子应用入口文件中，但要放在各导出函数的外部。例如：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;console.log(&amp;quot;The registered application has been loaded!&amp;quot;);
export async function bootstrap(props) {...}
export async function mount(props) {...}
export async function unmount(props) {...}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;初始化&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9D%E5%A7%8B%E5%8C%96&quot; aria-label=&quot;初始化 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;初始化&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;这个生命周期函数会在应用&lt;strong&gt;第一次&lt;/strong&gt;挂载前&lt;strong&gt;执行一次&lt;/strong&gt;。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;export function bootstrap(props) {
  return Promise
    .resolve()
    .then(() =&amp;gt; {
      // One-time initialization code goes here
      console.log(&amp;#39;bootstrapped!&amp;#39;)
    });
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;挂载&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%8C%82%E8%BD%BD&quot; aria-label=&quot;挂载 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;挂载&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;每当应用的&lt;a href=&quot;#%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0&quot; class=&quot;link-underline&quot;&gt;activity function&lt;/a&gt;返回真值，但该应用处于未挂载状态时，挂载的生命周期函数就会被调用。调用时，函数会根据URL来确定当前被激活的路由，创建DOM元素、监听DOM事件等以向用户呈现渲染的内容。任何子路由的改变（如&lt;code&gt;hashchange&lt;/code&gt;或&lt;code&gt;popstate&lt;/code&gt;等）不会再次触发&lt;code&gt;mount&lt;/code&gt;，需要各应用自行处理。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;
export function mount(props) {
  return Promise
    .resolve()
    .then(() =&amp;gt; {
      // Do framework UI rendering here
      console.log(&amp;#39;mounted!&amp;#39;)
    });
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;卸载&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8D%B8%E8%BD%BD&quot; aria-label=&quot;卸载 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;卸载&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;每当应用的&lt;a href=&quot;#%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0&quot; class=&quot;link-underline&quot;&gt;activity function&lt;/a&gt;返回假值，但该应用已挂载时，卸载的生命周期函数就会被调用。卸载函数被调用时，会清理在挂载应用时被创建的DOM元素、事件监听、内存、全局变量和消息订阅等。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;export function unmount(props) {
  return Promise
    .resolve()
    .then(() =&amp;gt; {
      // Do framework UI unrendering here
      console.log(&amp;#39;unmounted!&amp;#39;);
    });
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;移除&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%A7%BB%E9%99%A4&quot; aria-label=&quot;移除 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;移除&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;“移除”生命周期函数的实现是可选的，它只有在&lt;a href=&quot;api.md#unloadapplication&quot; class=&quot;link-underline&quot;&gt;unloadApplication&lt;/a&gt;被调用时才会触发。如果一个已注册的应用没有实现这个生命周期函数，则假设这个应用无需被移除。
移除的目的是各应用在移除之前执行部分逻辑，一旦应用被移除，它的状态将会变成NOT_LOADED，下次激活时会被重新初始化。
移除函数的设计动机是对所有注册的应用实现“热下载”，不过在其他场景中也非常有用，比如想要重新初始化一个应用，且在重新初始化之前执行一些逻辑操作时。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;export function unload(props) {
  return Promise
    .resolve()
    .then(() =&amp;gt; {
      // Hot-reloading implementation goes here
      console.log(&amp;#39;unloaded!&amp;#39;);
    });
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;超时&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%B6%85%E6%97%B6&quot; aria-label=&quot;超时 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;超时&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;默认情况下，所有注册的应用遵循&lt;a href=&quot;/docs/api#setbootstrapmaxtime&quot; class=&quot;link-underline&quot;&gt;全局超时配置&lt;/a&gt;，但对于每个应用，也可以通过在主入口文件导出一个&lt;code&gt;timeouts&lt;/code&gt;对象来重新定义超时时间。如：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// app-1.main-entry.js
export function bootstrap(props) {...}
export function mount(props) {...}
export function unmount(props) {...}
export const timeouts = {
  bootstrap: {
    millis: 5000,
    dieOnTimeout: true,
    warningMillis: 2500,
  },
  mount: {
    millis: 5000,
    dieOnTimeout: false,
    warningMillis: 2500,
  },
  unmount: {
    millis: 5000,
    dieOnTimeout: true,
    warningMillis: 2500,
  },
  unload: {
    millis: 5000,
    dieOnTimeout: true,
    warningMillis: 2500,
  },
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;注意&lt;code&gt;millis&lt;/code&gt;指的是最终控制台输出警告的毫秒数，&lt;code&gt;warningMillis&lt;/code&gt;指的是将警告打印到控制台(间隔)的毫秒数。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;使用single-spa生态快速接入&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8single-spa%E7%94%9F%E6%80%81%E5%BF%AB%E9%80%9F%E6%8E%A5%E5%85%A5&quot; aria-label=&quot;使用single spa生态快速接入 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用single-spa生态快速接入&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;single-spa官方团队针对不同流行框架创建了一些项目，帮助开发者使用自己选择的框架来创建single-spa应用。这里以React为例。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;官方提供了&lt;a href=&quot;https://github.com/single-spa/single-spa-react&quot; class=&quot;link-underline&quot;&gt;single-spa-react&lt;/a&gt;，为React应用提供了生命周期钩子。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;来看一下案例，singleSpaReact最后返回的包含各生命周期函数的对象：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;import React from &amp;#39;react&amp;#39;;
import ReactDOM from &amp;#39;react-dom&amp;#39;;
import rootComponent from &amp;#39;./path-to-root-component.js&amp;#39;;
// Note that SingleSpaContext is a react@16.3 (if available) context that provides the singleSpa props
import singleSpaReact, {SingleSpaContext} from &amp;#39;single-spa-react&amp;#39;;

const reactLifecycles = singleSpaReact({
  React,
  ReactDOM,
  rootComponent,
  errorBoundary(err, info, props) {
    // https://reactjs.org/docs/error-boundaries.html
    return (
      &amp;lt;div&amp;gt;This renders when a catastrophic error occurs&amp;lt;/div&amp;gt;
    );
  },
});

export const bootstrap = reactLifecycles.bootstrap;
export const mount = reactLifecycles.mount;
export const unmount = reactLifecycles.unmount;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;single-spa-react的源码不难，主要包括参数处理，和针对React框架的一些特点和语法实现了DOM的创建和插入，这里就不做过多分析，有兴趣的朋友可以自行阅读。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;参考&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%82%E8%80%83&quot; aria-label=&quot;参考 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;参考&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://single-spa.js.org/docs/building-applications&quot; class=&quot;link-underline&quot;&gt;single-spa building-applications&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://single-spa.js.org/docs/configuration&quot; class=&quot;link-underline&quot;&gt;COnfiguring single-spa&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[single-spa源码解析-registerApplication和start]]></title><description><![CDATA[首先将问题简化，假定主应用和子应用都已经准备好的情况下，针对应用的注册和启动这两个关键操作进行分析。 在主应用中只需要调用registerApplication即可注册子应用，调用start启动主应用。比如下面的例子 registerApplication 先让我们来看一下函数…]]></description><link>https://zhanglun.github.io/blogs/2020-11-21-single-spa源码解析-registerApplication和start/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2020-11-21-single-spa源码解析-registerApplication和start/</guid><pubDate>Sat, 21 Nov 2020 13:28:13 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;首先将问题简化，假定主应用和子应用都已经准备好的情况下，针对应用的注册和启动这两个关键操作进行分析。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在主应用中只需要调用&lt;code&gt;registerApplication&lt;/code&gt;即可注册子应用，调用&lt;code&gt;start&lt;/code&gt;启动主应用。比如下面的例子&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// single-spa-config.js
import { registerApplication, start } from &amp;#39;single-spa&amp;#39;;

// 使用简单参数
registerApplication(
  &amp;#39;app2&amp;#39;, 
  () =&amp;gt; import(&amp;#39;src/app2/main.js&amp;#39;),
  (location) =&amp;gt; location.pathname.startsWith(&amp;#39;/app2&amp;#39;),
  { some: &amp;#39;value&amp;#39; },
);

// 使用对象参数
registerApplication({
  name: &amp;#39;app1&amp;#39;,
  app: () =&amp;gt; import(&amp;#39;src/app1/main.js&amp;#39;),
  activeWhen: &amp;#39;/app1&amp;#39;,
  customProps: {
    some: &amp;#39;value&amp;#39;,
  }
);

start();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;registerApplication&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#registerApplication&quot; aria-label=&quot;registerApplication permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;registerApplication&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;先让我们来看一下函数签名&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;registerApplication(
  appNameOrConfig,
  appOrLoadApp,
  activeWhen,
  customProps
)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;可以传四个参数，也能传递一个对象。对象参数的效果与四个参数效果一样。因为在 &lt;code&gt;registerApplication&lt;/code&gt; 函数的顶部就会执行来一个序列化参数的操作，统一将参数转换成约定 &lt;code&gt;registration&lt;/code&gt;。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// src/application/apps.js
export function registerApplication(
  appNameOrConfig,
  appOrLoadApp,
  activeWhen,
  customProps
) {
  const registration = sanitizeArguments(
    appNameOrConfig,
    appOrLoadApp,
    activeWhen,
    customProps
  );
  ...
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;序列化参数&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%BA%8F%E5%88%97%E5%8C%96%E5%8F%82%E6%95%B0&quot; aria-label=&quot;序列化参数 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;序列化参数&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;sanitizeArguments&lt;/code&gt;这个方法里面的逻辑不复杂，简单来说就是将各参数序列化成需要的类型。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function sanitizeArguments(
  appNameOrConfig,
  appOrLoadApp,
  activeWhen,
  customProps
) {
  const usingObjectAPI = typeof appNameOrConfig === &amp;quot;object&amp;quot;;

  const registration = {
    name: null,
    loadApp: null,
    activeWhen: null,
    customProps: null,
  };

  if (usingObjectAPI) {
    validateRegisterWithConfig(appNameOrConfig);
    registration.name = appNameOrConfig.name;
    registration.loadApp = appNameOrConfig.app;
    registration.activeWhen = appNameOrConfig.activeWhen;
    registration.customProps = appNameOrConfig.customProps;
  } else {

// 校验各参数类型，如果不通过就抛出错误。
    validateRegisterWithArguments(
      appNameOrConfig,
      appOrLoadApp,
      activeWhen,
      customProps
    );
    registration.name = appNameOrConfig;
    registration.loadApp = appOrLoadApp;
    registration.activeWhen = activeWhen;
    registration.customProps = customProps;
  }

  registration.loadApp = sanitizeLoadApp(registration.loadApp);
  registration.customProps = sanitizeCustomProps(registration.customProps);
  registration.activeWhen = sanitizeActiveWhen(registration.activeWhen);

  return registration;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;将应用注入&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B0%86%E5%BA%94%E7%94%A8%E6%B3%A8%E5%85%A5&quot; aria-label=&quot;将应用注入 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;将应用注入&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;参数序列化之后，先调用 &lt;code&gt;getAppNames&lt;/code&gt; 方法检查是否存在重复注册的子应用，如果有则抛出错误&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;if (getAppNames().indexOf(registration.name) !== -1)
  throw Error(
    formatErrorMessage(
      21,
      __DEV__ &amp;amp;&amp;amp;
      `There is already an app registered with name ${registration.name}`,
      registration.name
    )
  );&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果不存在重复注册的应用，接下来就将所有的应用注册到 apps 数组中，执行 &lt;code&gt;reroute()&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;apps.push(
  assign(
    {
      loadErrorTime: null,
      status: NOT_LOADED,
      parcels: {},
      devtools: {
        overlays: {
          options: {},
          selectors: [],
        },
      },
    },
    registration
  )
);

if (isInBrowser) {
  ensureJQuerySupport();
  reroute();
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;start&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#start&quot; aria-label=&quot;start permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;start&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;因为&lt;code&gt;start&lt;/code&gt;方法和&lt;code&gt;registeApplication&lt;/code&gt;方法最后都调用了&lt;code&gt;reroute&lt;/code&gt;，&lt;code&gt;start&lt;/code&gt;的代码比较少，所以先介绍start方法。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// src/start.js
import { reroute } from &amp;quot;./navigation/reroute.js&amp;quot;;
import { formatErrorMessage } from &amp;quot;./applications/app-errors.js&amp;quot;;
import { setUrlRerouteOnly } from &amp;quot;./navigation/navigation-events.js&amp;quot;;
import { isInBrowser } from &amp;quot;./utils/runtime-environment.js&amp;quot;;

let started = false;

export function start(opts) {
  started = true;
  if (opts &amp;amp;&amp;amp; opts.urlRerouteOnly) {
    setUrlRerouteOnly(opts.urlRerouteOnly);
  }
  if (isInBrowser) {
    reroute();
  }
}

export function isStarted() {
  return started;
}

if (isInBrowser) {
  setTimeout(() =&amp;gt; {
    if (!started) {
      console.warn(
        formatErrorMessage(
          1,
          __DEV__ &amp;amp;&amp;amp;
            `singleSpa.start() has not been called, 5000ms after single-spa was loaded. Before start() is called, apps can be declared and loaded, but not bootstrapped or mounted.`
        )
      );
    }
  }, 5000);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;首先申明了一个 &lt;code&gt;started&lt;/code&gt; 变量作为应用启动的标记，默认是 &lt;code&gt;false&lt;/code&gt;，表示未启动。&lt;code&gt;isStarted()&lt;/code&gt;返回这个标记，用来判断当前应用的状态。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;start`方法接受一个options参数，目前只有一个配置：urlRerouteOnly。默认是false。如果设置成true，调用history.pushState() 和 history.replaceState() 时不会触发 reroute，除非客户端路由真的发生了变化。设置为true时在某些时候会有更好的性能。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;urlRerouteOnly&lt;/code&gt;会在navigation-events中使用，后面再讲。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在文件的最后作了一个超时检测，在代码执行5s后&lt;code&gt;isStarted&lt;/code&gt;状态依旧是&lt;code&gt;false&lt;/code&gt;时抛出一个警告。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;接下来看一下核心方法Reroute&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;reroute&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reroute&quot; aria-label=&quot;reroute permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;reroute&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;默认设置 &lt;code&gt;appChangeUnderway&lt;/code&gt;为&lt;code&gt;false&lt;/code&gt;。函数每次执行时都会判断&lt;code&gt;appChangeUnderway&lt;/code&gt;。&lt;code&gt;appChangeUnderway&lt;/code&gt;为&lt;code&gt;true&lt;/code&gt;时表示当前有&lt;code&gt;reroute&lt;/code&gt;的任务正在执行(reroute被调用了并且其中的promsie任务还没结束），此时返回一个Promise，内部将resolve，reject和reoute的第二个参数一起 push 到&lt;code&gt;peopleWaitingOnAppChange&lt;/code&gt;中，等当前reroute对应的任务执行完成之后在作为 &lt;code&gt;pendingPromise&lt;/code&gt; 参数继续执行。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;if (appChangeUnderway) {
  return new Promise((resolve, reject) =&amp;gt; {
    peopleWaitingOnAppChange.push({
      resolve,
      reject,
      eventArguments,
    });
  });
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;但是&lt;code&gt;appChangeUnderway&lt;/code&gt;初始值是&lt;code&gt;false&lt;/code&gt;，在什么时候被修改成true的呢？接着往下看。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;调用&lt;code&gt;getAppChanges()&lt;/code&gt;方法将注册的应用按照当前各自的生命周期分组:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;加载失败（LOAD_ERROR) 的app放入appToUnload&lt;/li&gt;
&lt;li&gt;未下载（NOT_LOADED)和下载中（LOADING_SOURCE_CODE)的app放入 appsToLoad&lt;/li&gt;
&lt;li&gt;未引导（NOT_BOOTSTRAPPED)和未挂载（NOT_MOUNTED)的app放入appsToUnload或者appsToMount&lt;/li&gt;
&lt;li&gt;已挂载（MOUNTED)的app放入appsToUnmount&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;未引导（NOT_BOOTSTRAPPED)和未挂载（NOT_MOUNTED)的app会多加一个判断，当前window.location匹配activeWhen规则时放入appToMount数组，否则放入appsToUnload。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;分组完毕之后，判断前文提到的started状态。如果started为true，将appChangeUnderway也设置为true，然后将app按照toUnload，toLoad,toUnmount和toMount的分组数组合并在一起，保存到appsThatChanged数组中。最后调用 performAppChanges 方法，返回执行的结果。如果started为false，将ToLoad的app赋值给appsThatChanged，然后调用loadApps方法，并返回执行的结果。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;loadApps-和-performAppChanges&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#loadApps-%E5%92%8C-performAppChanges&quot; aria-label=&quot;loadApps 和 performAppChanges permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;loadApps 和 performAppChanges&lt;/h3&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;loadApps&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#loadApps&quot; aria-label=&quot;loadApps permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;loadApps&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;先来看较为简单的loadApps()方法。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function loadApps() {
  return Promise.resolve().then(() =&amp;gt; {
    const loadPromises = appsToLoad.map(toLoadPromise);

    return (
      Promise.all(loadPromises)
        .then(callAllEventListeners)
        // there are no mounted apps, before start() is called, so we always return []
        .then(() =&amp;gt; [])
        .catch((err) =&amp;gt; {
          callAllEventListeners();
          throw err;
        })
    );
  });
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;loadApps&lt;/code&gt;只有在启动的时候会调用一次，此时&lt;code&gt;started&lt;/code&gt; 为 &lt;code&gt;false&lt;/code&gt;。这个方法具体做了什么事情呢？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;遍历appsToLoad中的app，最后返回一个Promise数组，通过Promise.all()一次性全部调用将app的状态设置为 &lt;code&gt;LOADING_SOURCE_CODE&lt;/code&gt;，然后检查参数中的生命周期函数，将这些函数挂载到app上。然后再调用 &lt;code&gt;callAllEventListeners&lt;/code&gt; 方法，劫持 &lt;code&gt;hashchange&lt;/code&gt; 和&lt;code&gt;popstate&lt;/code&gt;这两个事件。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;performAppChanges&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#performAppChanges&quot; aria-label=&quot;performAppChanges permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;performAppChanges&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;如果应用已经启动，即 &lt;code&gt;started&lt;/code&gt;为 &lt;code&gt;true&lt;/code&gt; 时，逻辑会进入到 &lt;code&gt;performAppChanges&lt;/code&gt; 方法，这个方法有点长。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function performAppChanges() {
  return Promise.resolve().then(() =&amp;gt; {
    // https://github.com/single-spa/single-spa/issues/545
    window.dispatchEvent(
      new CustomEvent(
        appsThatChanged.length === 0
          ? &amp;quot;single-spa:before-no-app-change&amp;quot;
          : &amp;quot;single-spa:before-app-change&amp;quot;,
        getCustomEventDetail(true)
      )
    );

    window.dispatchEvent(
      new CustomEvent(
        &amp;quot;single-spa:before-routing-event&amp;quot;,
        getCustomEventDetail(true, { cancelNavigation })
      )
    );

    if (navigationIsCanceled) {
      window.dispatchEvent(
        new CustomEvent(
          &amp;quot;single-spa:before-mount-routing-event&amp;quot;,
          getCustomEventDetail(true)
        )
      );
      finishUpAndReturn();
      navigateToUrl(oldUrl);
      return;
    }

    const unloadPromises = appsToUnload.map(toUnloadPromise);

    const unmountUnloadPromises = appsToUnmount
      .map(toUnmountPromise)
      .map((unmountPromise) =&amp;gt; unmountPromise.then(toUnloadPromise));

    const allUnmountPromises = unmountUnloadPromises.concat(unloadPromises);

    const unmountAllPromise = Promise.all(allUnmountPromises);

    unmountAllPromise.then(() =&amp;gt; {
      window.dispatchEvent(
        new CustomEvent(
          &amp;quot;single-spa:before-mount-routing-event&amp;quot;,
          getCustomEventDetail(true)
        )
      );
    });

    /* We load and bootstrap apps while other apps are unmounting, but we
      * wait to mount the app until all apps are finishing unmounting
      */
    const loadThenMountPromises = appsToLoad.map((app) =&amp;gt; {
      return toLoadPromise(app).then((app) =&amp;gt;
        tryToBootstrapAndMount(app, unmountAllPromise)
      );
    });

    /* These are the apps that are already bootstrapped and just need
      * to be mounted. They each wait for all unmounting apps to finish up
      * before they mount.
      */
    const mountPromises = appsToMount
      .filter((appToMount) =&amp;gt; appsToLoad.indexOf(appToMount) &amp;lt; 0)
      .map((appToMount) =&amp;gt; {
        return tryToBootstrapAndMount(appToMount, unmountAllPromise);
      });
    return unmountAllPromise
      .catch((err) =&amp;gt; {
        callAllEventListeners();
        throw err;
      })
      .then(() =&amp;gt; {
        /* Now that the apps that needed to be unmounted are unmounted, their DOM navigation
          * events (like hashchange or popstate) should have been cleaned up. So it&amp;#39;s safe
          * to let the remaining captured event listeners to handle about the DOM event.
          */
        callAllEventListeners();

        return Promise.all(loadThenMountPromises.concat(mountPromises))
          .catch((err) =&amp;gt; {
            pendingPromises.forEach((promise) =&amp;gt; promise.reject(err));
            throw err;
          })
          .then(finishUpAndReturn);
      });
  });
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;可以看到，这个方法也是放在一个 &lt;code&gt;Promise.resolve()&lt;/code&gt;中。首先触发了一些自定义事件，然后根据应用状态分别创建了对应取消操作的Promise数组。需要被移除的应用 &lt;code&gt;appToUnLoad&lt;/code&gt;创建了&lt;code&gt;unLoadPromises&lt;/code&gt;，需要被卸载的应用&lt;code&gt;appsToUnmount&lt;/code&gt;先创建卸载的&lt;code&gt;toUnmountPromise&lt;/code&gt;，再创建 &lt;code&gt;unLoadPromise&lt;/code&gt;。最后将所有的Promise合并成一个数组通过Promise.all执行，执行完成之后触发&lt;code&gt;single-spa:before-mount-routing-event&lt;/code&gt;事件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;至此，需要unmount和unload的app执行过程都结束了，接下来如法炮制开始load和mount对应的应用。使用 &lt;code&gt;appToLoad&lt;/code&gt; 和 &lt;code&gt;appToMount&lt;/code&gt; 创建一个Promise数组，通过Promise.all执行。在app对应状态变更完成之后，调用 &lt;code&gt;tryToBootstrapAndMount&lt;/code&gt;完成引导并挂载应用。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function tryToBootstrapAndMount(app, unmountAllPromise) {
  if (shouldBeActive(app)) {
    return toBootstrapPromise(app).then((app) =&amp;gt;
      unmountAllPromise.then(() =&amp;gt;
        shouldBeActive(app) ? toMountPromise(app) : app
      )
    );
  } else {
    return unmountAllPromise.then(() =&amp;gt; app);
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;引导并挂载成功之后触发一次&lt;code&gt;single-spa:routing-event&lt;/code&gt;事件，根据变化的app数量决定触发&lt;code&gt;single-spa:no-app-change&lt;/code&gt;事件还是&lt;code&gt;single-spa:app-change&lt;/code&gt;事件。最后将&lt;code&gt;appChangeUnderway&lt;/code&gt;设置为&lt;code&gt;false&lt;/code&gt;，保证后续的reroute()调用能够执行，此时也标志着当前这次reroute调用的执行已结束，最后检查当前是否还有pengding中的任务，有的话继续执行。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;if (peopleWaitingOnAppChange.length &amp;gt; 0) {
  /* While we were rerouting, someone else triggered another reroute that got queued.
    * So we need reroute again.
    */
  const nextPendingPromises = peopleWaitingOnAppChange;
  peopleWaitingOnAppChange = [];
  reroute(nextPendingPromises);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[使用 single-spa 实现微前端]]></title><description><![CDATA[背景 随着组织架构调整，目前来车服租车团队已经有一段时间了。虽然主要业务工作还是B端系统的开发，但是租车业务因其业务特点以及一些历史原因，我面对的是两个“巨无霸”型后台系统-Car系统和Car-mis系统。这两个系统历史悠久，经手多个团队，所有租车相关的业务模块诸如交易，商品，…]]></description><link>https://zhanglun.github.io/blogs/2020-11-05-使用Single-SPA实现微前端/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2020-11-05-使用Single-SPA实现微前端/</guid><pubDate>Thu, 05 Nov 2020 03:16:48 GMT</pubDate><content:encoded>&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;背景&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%83%8C%E6%99%AF&quot; aria-label=&quot;背景 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;背景&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;随着组织架构调整，目前来车服租车团队已经有一段时间了。虽然主要业务工作还是B端系统的开发，但是租车业务因其业务特点以及一些历史原因，我面对的是两个“巨无霸”型后台系统-Car系统和Car-mis系统。这两个系统历史悠久，经手多个团队，所有租车相关的业务模块诸如交易，商品，履约，车险，商户，车辆库存和权限等，都集成在这两个系统中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d395d96fc572b3d38849be77acb900dd/cda19/1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 73.93617021276594%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACN0lEQVQoz11Ti27bMAzM/3/XtrZLtmVtmnRdmkZ2EjsW9Zb1ljXYadNtBCEceHcgQUKzMsUwDKWUpmlSSuU9mqYJIVzZtm2dc+WvmF1RSgmhylp7VXddF2O8srvdTkp5Zf8xl1IoIeldXUoRguecy/tshID3/v/OMQ3G594lwpW20bjUu2RcAiZV743PxicbMhW9cdGG7GP+MGsbsYygEqhEVAKZ8JSo5Z0IE45YRCxH6iwi03EaZTLnXEIqMY2vj0OYQEgFqLA+TcXiwuAvgkk5WodhNr7JeQNWY6dxctT12BvwBrQ4WnV2PYx1T5zurB5lOerLGsbOyTMtzoxRzqlida8IAVCS96I2PQMCnAGHFylI13WcdZai0rSDVjPGueuppDU+I9wiI2pJK4Jr3L4aUXNSMTiQbm9ExaCicKAYBdmUqiqCz4RUtgctOgyAARSvjSIYAAALeJUcTqdGCCYp0kpgDIx1nh/LelMwnhYWpBVVL2rFkNcHzZGilea1k6gXI1AUWbnXbG/VyUoULb5cfpZzHoZchlAGX0ooQ5xwKCUoSVM0YzH7N0Geckgfd/bJE02xop0AogmWY4IiJ9JgSYimVFGiGdGMGyGdtMG8mQEDlbA9Huf36+XzdtceF5vN7cPDcvv7V10vHjerl/1TjeaPj/P1eteemKHSinHqMsx6bYjqlvvvN+u7r8+L1WE1f/52u7lbvt4/oNXdZr7Y/ljul5/XN59WX36i5VP7sxGHy/f4A3qFVA42C0K9AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;业务架构图&quot;
        title=&quot;业务架构图&quot;
        src=&quot;/static/d395d96fc572b3d38849be77acb900dd/1d69c/1.png&quot;
        srcset=&quot;/static/d395d96fc572b3d38849be77acb900dd/4dcb9/1.png 188w,
/static/d395d96fc572b3d38849be77acb900dd/5ff7e/1.png 375w,
/static/d395d96fc572b3d38849be77acb900dd/1d69c/1.png 750w,
/static/d395d96fc572b3d38849be77acb900dd/cda19/1.png 785w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;随着业务迭代，两个系统日渐臃肿，高达90+的模块数使得无论是本地开发还是上线，很多时间都浪费在编译打包阶段；随着应用框架和技术方案等升级和迁移，多框架多版本共存的问题无法避免；两个系统的基本业务逻辑一致，UI上存在一些差异，各自独立开发和维护，无法充分复用相同业务逻辑的代码。微前端可能是目前解决这类问题的最佳方案。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;微前端将微服务的理念应用于浏览器端，将 Web 应用由单一的单体应用转变为多个小型前端应用聚合为一的应用。各个前端应用还可以独立运行、独立开发、独立部署。由此也能看出，微前端不是单纯的框架或者工具，是一套完整的体系。对于其价值，目前业界比较认可的观点有以下几个：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;无技术栈限制&lt;/li&gt;
&lt;li&gt;应用单独开发，解耦&lt;/li&gt;
&lt;li&gt;多应用整合，复用&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;而这三个特点，似乎能够解决当前租车B端系统的问题。结合现有工程的项目，我们对我们的需求进行分析，并确定了预期的收益&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;拆分应用：按照业务拆分成不同的仓库进行维护，独立开发，独立维护&lt;/li&gt;
&lt;li&gt;加速体验：开发模块提速；上线部署提速&lt;/li&gt;
&lt;li&gt;侵入性低：改动尽可能小，允许渐进迁移&lt;/li&gt;
&lt;li&gt;学习成本低：保持现有开发模式，没有学习成本&lt;/li&gt;
&lt;li&gt;统一技术栈：约定统一使用React技术栈，渐进迁移到16.8以后的版本&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;针对微前端方案，社区已经有了总结和对比，我们决定采用“基座模式”来实现我们租车业务线的微前端方案。基座模式是由一个主应用和一系列业务子应用构成的系统，并由这个主应用来管理其他子应用，包括从子应用的生命周期管理到应用间的通信机制。作为系统的统一入口，负责将对应的请求指向对应的服务。子应用，则是负责各个子模块的业务实现。更多微前端相关的介绍可以去看看这些文章：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://micro-frontends.org/&quot; class=&quot;link-underline&quot;&gt;What are Micro Frontends&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://microfrontends.cn/&quot; class=&quot;link-underline&quot;&gt;Thinking in Microfrontend (微前端的那些事儿)&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;按照预期，使用微前端方案之后，B端系统的架构也会发生响应的变化&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 681px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ed01d29655defbb0cde89cafaff7d78d/8ce52/2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 69.14893617021278%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACR0lEQVQoz0WS567rIBCE8/7PdnVKEttJ3G0wzR1jmoErn/zICqEV6NNodvYSQvDehxA4X1vQEsoYrtxeewmcbIKCQUOvu7NRrVdtUCCoNhisp99L+KNDCIKPBJUIZASmfGqdRN7QfQXbDPcVbVOzze3OO7GAZWzEiji7X97Kx+G9XTWvqyKOo98k+lG8O3bICHg+HxA2dflq26Yqc9DkANSvNMfgccLzPOdFYdVkRVsXSRx952mkOLQCgDaPonscXbNXVJZ5lqWky/el4ROYye2t7LwP3nIr2rZ+xvevIjthJztGqrp6dSCnuGSk7SmQHAWDgp/N9vrzHE7P3i6al0UWR7ev7BUrDsJBvMbBkmCZNzQYEgz2GoXzcVTz/Q3/lVPhWK2atoXofbBq1IIZOSjRG9nr/X0GI88vb/mh2Ac2xkzjgDHe+LLvfBx6COG8LHLnnHOM8ThOcudCCELpvKzWyMsn53VB3TnRZWi3pcOoq6uSEbCvcBxHCBpK4DoUyzxCCAmlpPn+wHqfKMp7Us2sMAJTnA8MzH1pJetJQbqiR5lcW7FAMcNDMTk9L2VZJkkSRQlFOaiT2+0X1InXhKH0dv2uy8RKtk31I7k+H/d1rIOh58K5yYriopTSWilllOhB9YjvVwxTJwnt0p/vf1Uem53KFVZF0laPfQVO00N2h6J2Kz5RHXomMC2LlHSZU2SkRZm/EMiNIE4hJ9F5K+Z0fyrb0fL0AzuzOgmMwE6hQw9OdWcvsVPM/6k5hZ0+4TPnYzLL4z+OZQ0UHAGfTAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;架构变化&quot;
        title=&quot;架构变化&quot;
        src=&quot;/static/ed01d29655defbb0cde89cafaff7d78d/8ce52/2.png&quot;
        srcset=&quot;/static/ed01d29655defbb0cde89cafaff7d78d/4dcb9/2.png 188w,
/static/ed01d29655defbb0cde89cafaff7d78d/5ff7e/2.png 375w,
/static/ed01d29655defbb0cde89cafaff7d78d/8ce52/2.png 681w&quot;
        sizes=&quot;(max-width: 681px) 100vw, 681px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;基座模式的代表&lt;a href=&quot;https://github.com/single-spa/single-spa&quot; class=&quot;link-underline&quot;&gt;single-spa&lt;/a&gt;, &lt;a href=&quot;https://qiankun.umijs.org/zh/guide&quot; class=&quot;link-underline&quot;&gt;qiankun&lt;/a&gt;亦是站在前者的肩膀之上诞生的国产的微前端实现库。处于“科研”的考虑，先从single-spa开始入手，了解其原理，学习其思想&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;single-spa-的使用&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#single-spa-%E7%9A%84%E4%BD%BF%E7%94%A8&quot; aria-label=&quot;single spa 的使用 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;single-spa 的使用&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;single-spa的灵感来自现代组建框架的生命周期，抽象了整个应用程序的生命周期。现在是一个能够启用前端微服务架构的稳定库，这个架构就是我们说的微前端，microfrontend。一个single-spa的应用包含以下部分：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;一个 root config。渲染HTML页面和执行应用注册的JavaScript。每个应用注册时需要：&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;应用名&lt;/li&gt;
&lt;li&gt;一个加载应用代码的函数&lt;/li&gt;
&lt;li&gt;一个确定应用何时处于活跃\非活跃状态的函数&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;其他应用。 每个应用需要知道如何将自己从DOM中引导，挂载和卸载。和传统的单页应用的主要区别在于，这些程序能够共存吗，因为他们不包含彼此的HTML页面。就像你的React或者Vue应用一样。当活跃时，监听url的路由事件，将内容放进DOM。当不活跃时，不再监听变化，同时将内容从DOM中移除。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;官方发布的脚手架&lt;a href=&quot;https://single-spa.js.org/docs/create-single-spa/&quot; class=&quot;link-underline&quot;&gt;create-single-spa&lt;/a&gt;能够帮助我们快速上手&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;创建一个root-config&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAroot-config&quot; aria-label=&quot;创建一个root config permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建一个root config&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;使用脚手架可以快速创建root config&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;npx create-single-spa --moduleType root-config&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;创建之后，进入目录&lt;code&gt;start&lt;/code&gt;启动，访问页面可以看到：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4a3a5a09c122f270b965a90d7d6743b4/196aa/Xnip2021-05-04_13-51-59.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 167.5531914893617%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAiABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAECAwQF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAfX0pB0MhWa60XRhAag//8QAHBAAAQQDAQAAAAAAAAAAAAAAAQACEBEhMTJC/9oACAEBAAEFAjkgQcmlSPUerh203X//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AV//xAAWEQADAAAAAAAAAAAAAAAAAAAQESD/2gAIAQIBAT8BCj//xAAaEAACAgMAAAAAAAAAAAAAAAAAIRExIDBR/9oACAEBAAY/AmoL0cLx/8QAHxAAAwABAwUAAAAAAAAAAAAAAAERITFRYSBBgaGx/9oACAEBAAE/IXl3G46YC5IYxU8P2XsQ2ySbCk0NG+hcr8dKf//aAAwDAQACAAMAAAAQyMMMiA//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EF//xAAYEQEAAwEAAAAAAAAAAAAAAAABECAhMf/aAAgBAgEBPxDWh4R//8QAIRABAAICAQQDAQAAAAAAAAAAAQARITFBUWFx4YGxwfD/2gAIAQEAAT8QQSbCUgeKa3BZ9Pl+5ashexKixw21+yoLHoe0A4/3zDa0Fw2QooadL9y7IL2qK0EpraAmxynpAoy33m2dJu8z/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Xnip2021-05-04_13-51-59.jpg&quot;
        title=&quot;Xnip2021-05-04_13-51-59.jpg&quot;
        src=&quot;/static/4a3a5a09c122f270b965a90d7d6743b4/acb04/Xnip2021-05-04_13-51-59.jpg&quot;
        srcset=&quot;/static/4a3a5a09c122f270b965a90d7d6743b4/bc01b/Xnip2021-05-04_13-51-59.jpg 188w,
/static/4a3a5a09c122f270b965a90d7d6743b4/bf173/Xnip2021-05-04_13-51-59.jpg 375w,
/static/4a3a5a09c122f270b965a90d7d6743b4/acb04/Xnip2021-05-04_13-51-59.jpg 750w,
/static/4a3a5a09c122f270b965a90d7d6743b4/ec605/Xnip2021-05-04_13-51-59.jpg 1125w,
/static/4a3a5a09c122f270b965a90d7d6743b4/196aa/Xnip2021-05-04_13-51-59.jpg 1130w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;创建子应用&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA%E5%AD%90%E5%BA%94%E7%94%A8&quot; aria-label=&quot;创建子应用 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建子应用&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;接下来创建一个子应用，同样使用脚手架提供的命令&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;npx create-single-spa --moduleType app-parcel&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;同样启动之后访问对应的页面，但是此时你会发现，无法通过url正常访问子应用。子应用默认是集成模式，&lt;code&gt;standalone-single-spa-webpack-plugin&lt;/code&gt;是关闭的，在不修改配置之前，是无法以独立应用的方式来访问的。那如何开始开发调试呢？如果你不需要启动基座应用，可以通过官方提供的&lt;a href=&quot;http://single-spa-playground.org/playground&quot; class=&quot;link-underline&quot;&gt;playground&lt;/a&gt;访问。访问的格式是 &lt;code&gt;http://single-spa-playground.org/playground/instant-test?name=@[orgName]/[&amp;#x26;url=[port]&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;另外一种方式是本地启动主应用，然后再将子应用注入。访问主应用页面的 console, 设置 localStorage，&lt;code&gt;localStorage.setItem(&apos;devtools&apos;, true)&lt;/code&gt;。刷新之后右下角会出现一个小部件，展开之后找到子应用的模块名，填入子应用的地址，然后再刷新一次，如果没有找到对应的模块名，可以手动添加。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;接下来将子应用注入到主应用，编辑&lt;code&gt;src/index.ejs&lt;/code&gt;，在import Map中添加子应用的地址和其他需要共享的依赖。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;{
  &amp;quot;imports&amp;quot;: {
    &amp;quot;@zhang/root-config&amp;quot;: &amp;quot;//localhost:9000/zhang-root-config.js&amp;quot;,
    &amp;quot;@zhang/app1&amp;quot;: &amp;quot;//localhost:8500/zhang-app1.js&amp;quot;,
    &amp;quot;react&amp;quot;: &amp;quot;https://cdn.jsdelivr.net/npm/react@16.13.1/umd/react.production.min.js&amp;quot;,
    &amp;quot;react-dom&amp;quot;: &amp;quot;https://cdn.jsdelivr.net/npm/react-dom@16.13.1/umd/react-dom.production.min.js&amp;quot;
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;编辑&lt;code&gt;root-config.js&lt;/code&gt;，将子应用注册。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// root-config.js
import { registerApplication, start } from &amp;quot;single-spa&amp;quot;;

registerApplication({
  name: &amp;quot;@zhang/app1&amp;quot;,
  app: () =&amp;gt; System.import(&amp;quot;@zhang/app1&amp;quot;),
  activeWhen: [&amp;quot;/&amp;quot;]
});

start({
  urlRerouteOnly: true,
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;接下来访问主应用时子应用也能够正常渲染。这种方式特别适合子应用依赖主应用上下文的情况。如果你的子应用非常独立，可以使用&lt;code&gt;npm run start:standalone&lt;/code&gt;启用standalone模式。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;按照官方的文档体验下来感受还是挺不错的，通过功能健全的脚手架，项目初始化的过程十分轻松。接下来再来聊聊 single-spa提出的一些其他概念，以帮助更好理解和使用这个框架。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;三种类型&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%89%E7%A7%8D%E7%B1%BB%E5%9E%8B&quot; aria-label=&quot;三种类型 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;三种类型&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在 &lt;code&gt;single-spa&lt;/code&gt; 的上下文中，有三种微前端（microfrontend):&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;single-spa applications: 为具体的路由渲染组建&lt;/li&gt;
&lt;li&gt;single-spa parcels: 渲染不控制路由的组件&lt;/li&gt;
&lt;li&gt;utility modules: 共享的代码逻辑，不渲染组件&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;一个Web应用可能会包含一个或者多个不同类型的微前端，三者具体的对比如下：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;Application&lt;/th&gt;
&lt;th&gt;Parcel&lt;/th&gt;
&lt;th&gt;Utility&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;路由&lt;/td&gt;
&lt;td&gt;多路由&lt;/td&gt;
&lt;td&gt;无路由&lt;/td&gt;
&lt;td&gt;无路由&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;API类型&lt;/td&gt;
&lt;td&gt;声明式 API&lt;/td&gt;
&lt;td&gt;命令式 API&lt;/td&gt;
&lt;td&gt;导出一个公共接口&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;是否渲染UI&lt;/td&gt;
&lt;td&gt;是&lt;/td&gt;
&lt;td&gt;是&lt;/td&gt;
&lt;td&gt;maybe&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;生命周期&lt;/td&gt;
&lt;td&gt;single-spa管理&lt;/td&gt;
&lt;td&gt;自己管理&lt;/td&gt;
&lt;td&gt;外部模块，不管理生命周期&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;何时使用&lt;/td&gt;
&lt;td&gt;核心&lt;/td&gt;
&lt;td&gt;需要支持多框架时&lt;/td&gt;
&lt;td&gt;共享逻辑或者创建一个service&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;## 应用的生命周期&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;要添加一个应用，首先需要注册该应用。一旦应用被注册后，必须在其入口文件(entry point)实现下面提到的各个生命周期函数。注册的应用会经过下载(loaded)、初始化(initialized)、被挂载(mounted)、卸载(unmounted)和unloaded（被移除）等过程。single-spa会通过“生命周期”为这些过程提供钩子函数。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;生命周期函数是在各应用的主文件中注册， single-spa 查找对应的函数名并进行调用。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;ol&gt;
&lt;li&gt;bootstrap, mount, and unmount的实现是必须的，unload则是可选的&lt;/li&gt;
&lt;li&gt;生命周期函数必须有返回值，可以是Promise或者async函数&lt;/li&gt;
&lt;li&gt;如果导出的是函数数组而不是单个函数，这些函数会被依次调用，对于promise函数，会等到resolve之后再调用下一个函数&lt;/li&gt;
&lt;li&gt;如果 single-spa 未启动，各个应用会被下载，但不会被初始化、挂载或卸载。&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;生命周期函数使用 &lt;code&gt;props&lt;/code&gt; 传参，这个对象包含&lt;code&gt;single-spa&lt;/code&gt;相关信息和其他的自定义属性。以&lt;code&gt;bootstrap&lt;/code&gt;为例&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function bootstrap(props) {
  const {
    name,        // 注册到 single-spa 的应用名称
    singleSpa,   // 对singleSpa 实例的引用
    mountParcel, // 手动挂载的函数
    customProps  // 自定义属性
  } = props;     // Props 会传给每个生命周期函数
  return Promise.resolve();
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;customProps&lt;/code&gt;允许在使用时将自定义属性传递给各个周期，&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// root-config.js
singleSpa.registerApplication({
  name: &amp;#39;app1&amp;#39;,
  activeWhen,
  app,
  customProps: { authToken: &amp;quot;d83jD63UdZ6RS6f70D0&amp;quot; }
});
singleSpa.registerApplication({
  name: &amp;#39;app1&amp;#39;,
  activeWhen,
  app,
  customProps: (name, location) =&amp;gt; {
    return { authToken: &amp;quot;d83jD63UdZ6RS6f70D0&amp;quot; };
  }
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在注册的回调方法中可以获取到传入的自定义属性&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;export function mount(props) {
  console.log(props.authToken); // 可以在 app1 中获取到authToken参数
  return reactLifecycles.mount(props);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;single-spa-生态系统&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#single-spa-%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F&quot; aria-label=&quot;single spa 生态系统 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;single-spa 生态系统&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;single-spa是一个与框架无关的微前端框架，整个体积压缩之后只有5kb左右，它所做的事情就是应用的注册和启动，以及提供生命周期。好在它的生态系统正在蓬勃发展，正在尽可能多地支持更多框架和构建工具，帮助开发者用自己喜欢的框架编写Web程序。这其实印证了前面所提到的： 微前端不是单纯的框架或者工具，是一套完整的体系。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;下一篇文章将对single-spa和single-spa-react的源码进行一次分析，来看看其背后到底是怎么运作的&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;参考&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/phodal/microfrontends#%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91%E5%BC%8F%E5%BE%AE%E5%89%8D%E7%AB%AF&quot; class=&quot;link-underline&quot;&gt;Thinking in Microfrontend (微前端的那些事儿)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://single-spa.js.org/docs/getting-started-overview#documentation&quot; class=&quot;link-underline&quot;&gt;getting-started-overview&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[在滴滴的这几年：基于Git的平台文档解决方案]]></title><description><![CDATA[背景 所在团队承接了架构部所有的底层服务的用户系统的建设，包括面向业务方的自助服务系统和面向运维同学的后台系统。随着各系统的不断迭代，系统提供的自助化能力越来越强大。在滴滴，业务方在业务中通常是同时使用多个基础服务来支撑业务需求。比方说，使用MySQL服务存储数据，使用Redi…]]></description><link>https://zhanglun.github.io/blogs/2020-10-14-在滴滴的这几年：基于Git的平台文档解决方案/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2020-10-14-在滴滴的这几年：基于Git的平台文档解决方案/</guid><pubDate>Wed, 14 Oct 2020 02:28:34 GMT</pubDate><content:encoded>&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;背景&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%83%8C%E6%99%AF&quot; aria-label=&quot;背景 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;背景&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;所在团队承接了架构部所有的底层服务的用户系统的建设，包括面向业务方的自助服务系统和面向运维同学的后台系统。随着各系统的不断迭代，系统提供的自助化能力越来越强大。在滴滴，业务方在业务中通常是同时使用多个基础服务来支撑业务需求。比方说，使用MySQL服务存储数据，使用Redis服务缓存数据，使用ES服务做数据检索。但是这些服务的用户系统最初都是独立的域名，彼此之间没有联系，除了输入域名访问，没有其他入口。导致当时系统访问方式都是口口相传。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了提升用户使用的体验，同时打造部门影响力，在统一了系统的UI风格之后，逐渐往平台化的方向走，成立了基础服务平台，将这些服务相关的信息收拢在一个平台，以统一的用户界面提供给业务方。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;入口收敛了，服务和部门对外宣传和推广的口子也有了。运行了一段时间之后，其他部门提供基础通用能力的团队也将自家服务或者应用接入到了平台。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;但是服务的一些文档还处于“信息孤岛”的状态。不同服务团队各自维护和管理自家文档的方式大不相同。即使是在架构部内部，由于历史原因，文档管理方式也是五花八门，更别提其他部门了。通过对一些团队的走访和调研，发现主要有一下几种管理文档的方式：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;使用内部的wiki系统维护&lt;/li&gt;
&lt;li&gt;通过开源工具自己部署维护&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;内部wiki系统有大量的文档数据，通过搜索往往不能找到自己想要的东西。虽然有空间搜索，但是前提是你要知道对应的入口链接。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;使用开源工具自己维护文档单独部署，需要有同学专门维护。除了要解决入口的问题之外，还存在功能不完善的问题，比如：不支持搜索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;而我们想做的事情，说白了就是：在平台的基础上，为服务提供统一的文档管理和展示的窗口。降低维护成本，提升文档的可用性。（同时提升平台的用户粘性。狗头&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;文档格式化&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%96%87%E6%A1%A3%E6%A0%BC%E5%BC%8F%E5%8C%96&quot; aria-label=&quot;文档格式化 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;文档格式化&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;说到程序员写文档，不由自主地想到markdown。Markdown 是一种轻量级的标记语言，常用与文章排版，通过markdown parser能markdown转换成我们想要的内容，甚至还能自定义解析器来实现自定义语法的转换。markdown的有很多好处：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;语法简单，专注写作内容&lt;/li&gt;
&lt;li&gt;支持自定义语法拓充&lt;/li&gt;
&lt;li&gt;轻松导出html，pdf 或者json等数据&lt;/li&gt;
&lt;li&gt;纯文本内容，可读，直观，学习成本低&lt;/li&gt;
&lt;li&gt;Vistual Stdio Code 和 Gitlab等支持高亮和预览&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;静态站点生成&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%9D%99%E6%80%81%E7%AB%99%E7%82%B9%E7%94%9F%E6%88%90&quot; aria-label=&quot;静态站点生成 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;静态站点生成&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;类似 Hexo, Hugo之类的静态站点生成工具种类非常多，除了 Hexo，Hugo这种主要用在静态博客场景的，还有类似 Gastby，Docusaurus 等定位是面向开源文档的书写。尤其是 Gastby，基于React，Node.js 和 GrapQL的功能强大的工具。静态站点生成有很多优点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;可靠安全稳定&lt;/li&gt;
&lt;li&gt;版本可控制&lt;/li&gt;
&lt;li&gt;易于部署，提交即上线&lt;/li&gt;
&lt;li&gt;灵活，易于定制&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;回顾一下原始诉求&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;降低维护成本。开发人员只要写文档就行，不用关心部署和展示之类的&lt;/li&gt;
&lt;li&gt;提升可用性。文档最多的就是搜索，使用全文搜索，提高搜索效率。建立反馈机制，帮助提升文档质量。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;往简单了来看，我们的诉求似乎就是编写 Markdown 原文件然后转换成页面，这些工具可以帮助我们轻松实现。但是，轻量级的类似 Hexo，Hugo 定制性太差，重量级的 Gastby 虽功能强大，但是对我们的场景来说有点大材小用，引入了 GraphQL，整合到我们现有技术体系有点困难。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;那怎么办呢？仔细想想，如果将 Markdown 原文件转换成页面这个过程拆分成 Markdown 原文件转换成数据，使用数据渲染出页面呢？这是不是就变成了一个简单的日常web开发？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 521px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d8e695a4ca05ac7b0642332a85312358/bb9c5/1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAC7klEQVQozzWSa0hTcRjGn+PMTEst8xZoYkGQhSDlB0sp6IKXljqvaQp+KMLwkjpN6aaWXSholRT0obszssx5m8vUnLPpkc68beY2t6Ym6tlNW0XkibP0hYfn/+d53xd+8EL0eSZeqrRyP41Zo7qGjfGt5Fw4/pd/fnWdo0g+e7iDmo/tHjHFScdMcRKFZS/h5LYegF//AOlIUVSmTqd7pdfry0iS3I0vk7YLH2SjhcLGrgqFxljeO2ZKBOAKwGPbzj1eg2rrGfXs72KJbLRSRzN50lFj5pZtIRsBrBMIBIdsNhuzWiqVSgTx4FyGuP9bQpNUfaJneJ7XLJ+JBODAK61HbEahcxs5m9g5RPPquzWxvUpzUrN8+iA2BnOo8WkU8/kearX66sLCgpKm6eGBgYGs/3AxZoJpA+BTQzAMA3ffHeAAYN+0joSopT1U2td/hGHmcLaq1iEsMtqeFRQU2D0sLMwJAIemaXabN+CiYMcBtNkbPIP2YdeuYIyrVBytzgAFRRVotZrHlsWfbM7JySux99UIBKw7hqekIjAwEBaLhWMPWJlWnFXRST9s9nQnGGaZw/6VKtVtjUYjWckJLjcGIAhcSkuD9v5dKLJOQNEuttPZF2AFb1V3ioPhtckZb1KALtkEhC8e+T1/8nCHXMmgKBnEyhXgakIcqIqL7nL+OZcvly9AUXUFsOrq4i36hijz5LvkJUNjypK+NiI7du0aZyeHoLeP0l1s0++P/frexDVrhNE/pppSbYa6SJ8NhBsAX3Fujj8tbs2dbxGdIstKvKmKS8CyWZY/Rjbwez88uWE0SM//mWtLf1Pt7RpzYKvbUEu271+686xlpo8v63hWtWxVFP+clWSGBLm6s2fz9Fx+qLGzo3Cxpzt/5GZ1wNcH94BF/evjFl1DwsKEkLs01cQ1q5/uZ7Fz0raDHq7kWCeFR39MNyeaJ+t5S4Z3PKv2ZQSLW52RBOWt6wHmro+5pg7JabK8dPPQtUr8AziUpTnNqohzAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;1.png&quot;
        title=&quot;1.png&quot;
        src=&quot;/static/d8e695a4ca05ac7b0642332a85312358/bb9c5/1.png&quot;
        srcset=&quot;/static/d8e695a4ca05ac7b0642332a85312358/4dcb9/1.png 188w,
/static/d8e695a4ca05ac7b0642332a85312358/5ff7e/1.png 375w,
/static/d8e695a4ca05ac7b0642332a85312358/bb9c5/1.png 521w&quot;
        sizes=&quot;(max-width: 521px) 100vw, 521px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;对于文档维护者来说，一次文档部署的过程应该是如下图所示：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 540px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d736640c9b0f2becf756d85ae746842f/07484/2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 15.425531914893616%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkElEQVQI12VPQQrEIAzs/79V8Cx49WClUttqpagUbcssCexeNjBkJpkkZJBS4rourOuKbduQUoL3nvV5nsydc8ypRpo8x3HAGMN8WRbuKaUw0JKcM0opqLVimiZorRlk2vcdIQTM88w9yjFGXkiz1tqffxxHDEIIvkLxvi+jtcboveMbz/Owpnzf91+dQJ9+ADwO4jx5h2FQAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;2.png&quot;
        title=&quot;2.png&quot;
        src=&quot;/static/d736640c9b0f2becf756d85ae746842f/07484/2.png&quot;
        srcset=&quot;/static/d736640c9b0f2becf756d85ae746842f/4dcb9/2.png 188w,
/static/d736640c9b0f2becf756d85ae746842f/5ff7e/2.png 375w,
/static/d736640c9b0f2becf756d85ae746842f/07484/2.png 540w&quot;
        sizes=&quot;(max-width: 540px) 100vw, 540px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在目前的场景中，三个简单的步骤还不足以支撑完备的业务需求。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;平台包含的服务数量过百。如果所有内容放在一个仓库中，仓库体积会越来越大，每次构建的时间也会越来越长。&lt;/li&gt;
&lt;li&gt;需要支持搜索。如果直接编译成HTML，全文搜索只能使用前端方案，不利于后续拓展，同时文档数据的使用场景也将受限与前端场景。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;于是乎，在上述的流程中补充一点细节。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;流程设计&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1&quot; aria-label=&quot;流程设计 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;流程设计&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;创建一个Git repo 组，每个服务都是单独的一个仓库。通过约定的持续集成流水线配置，可以实现每个仓库的单独构建和部署。 负责编辑的同学只需要关注自己的仓库即可。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;构建过程中，将仓库中每一个文档都转换成JSON数据，存入MySQL中。再使用定时任务，采集bingLog 日志，导入到ElasticSearch中。使用MySQL中的数据用于页面的渲染，使用ElasticSearch的数据实现全局搜索。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 517px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1c6d9b3ef30da56d80b3ab9f1f3bd587/fa2f5/3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 73.93617021276594%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACUElEQVQ4y32Ti3KbQAxF+f+fSzNO29TGxrxhee2CeYNPR+t0knaaaObORWK5SFrJ2fcdsXVdLYu/bTtpluOePU7uhboxLOvONK9/Y3nwvGwWy7ri9H1PlmVWTGvNMAyYYSOremLVkhQdkTKkb35a3h5c9STljbTsSMvWctPNOFVVcblcEGHf91FKEeeao+sRBgGvP3+gjSFMFHL25XBA5RnXMKNqDGf3hHs6UtWaWBkcYwxJkrBtm81SuDSzFQ3iDNcLSfKaWGnirMSPMqK0IEhrksLgx7n1E6VtVU4QBDw9PTHPsxWTXkrqze1RdlK0FGaiahcKM1O2C0rPFObhC0us0DPmtuDIJdzvdyv2ByIqmOcRrWsC32Mce7hv7NvCfV/ZLIu/Wmxv3zi82UfRdVQst4g6P6Li7wz6ytrHDNpnbAP65srSx/Taw5Rn2sqj1z7rVOFI/+RSpJciuiwL25iiq5goiu27slC4v76RpSmn4xFVFHjuC2ni2zOCplb0OsRp25amaRjH0c6gpL1PBTedkKcBSXShKROq/ExdJqgspCwSiuyMaVKKPCKJr+gqYupiHMnqfaDfSp4Ny6CYbhlzn1nexsLyI54ztCljl9IUHl0Tsg4522JwPl7GO/Z37H+eH/F9v9v2SCuqurYVyUKUZUnbdQ/Bj9l9BTkn43W9Xu0iiOjr6ysyel3X4XneZxl+LjhNk90YsTzPcV3XZicm/FeGH/mrmJQolymliwlLTH7kSAkyKv/y/2LCIir7/vz8bMuW6TidThwOB8Iw5DeZAnyxukX1YgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;3.png&quot;
        title=&quot;3.png&quot;
        src=&quot;/static/1c6d9b3ef30da56d80b3ab9f1f3bd587/fa2f5/3.png&quot;
        srcset=&quot;/static/1c6d9b3ef30da56d80b3ab9f1f3bd587/4dcb9/3.png 188w,
/static/1c6d9b3ef30da56d80b3ab9f1f3bd587/5ff7e/3.png 375w,
/static/1c6d9b3ef30da56d80b3ab9f1f3bd587/fa2f5/3.png 517w&quot;
        sizes=&quot;(max-width: 517px) 100vw, 517px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;DocBuilder&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#DocBuilder&quot; aria-label=&quot;DocBuilder permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;DocBuilder&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;借鉴GitBook的思路，开发了一个DocBuilder，下面是架构图：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4af7a1df9bca66fe0b83e513fec67b2f/ccf0c/image2020-7-16_17-37-33.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 82.97872340425533%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAD+UlEQVQ4y1WU61MTVxiH8/91pv1S29rWttOpduwXpzO9fGltYYkoNAa02EEbAwUCAmNF6yXBEA3hooBAwiUqkEC4ZLPZ3WTP7mYTxaeTBa398M57+81zzjvznuOpVqvUTVVVtuVNtuUMuXyGnJxht7DNXmGbbTnr1uq+rskXdt/UXmvzyh62bePJbmYpKiqra0nOhD+lKfIh/tgJTt99lz/jP9GTOMNPd96hJfoFUvgIZ0ePMTzdQWP4fVqin+OLfeX2bzzuxLFqeIQQLjkv51lYm2VxY4ZU5glP1h6xmk2Rzq7wZG2aVGaOhfUZFtdneb6VZn7tMYsbswfa59Os5Z5h2xU8juNQcWoohXWEeIyuz6Cqj7DMGYqFFTQ1iWnOoijTGMYMRnmeQn4VU8xRKr3WzqIWlzFNG0+lYmPb+yj5CfaLEvq6RCH9K/uKhJofxJCDvMhL7Cz9jLUlUVXakfdu8lJpwchKKM8a2C80UZIHMUTlEOjso2SnEF0NiO4LiL6LiD8aKS4Po40HEZeaMQc6EFdaKQ/7KWzdwQg2I7r8mKHfMToktMUhhOPUgRa28wolO4nZ14jR7cfo8WMGJIorQ2gTQcTlZoxQGyLYSvlGHXgb0XMW46/zGL1+RGcTWnIIow7c2amvhk5xaxpzQEKE2hH9bVjdXuSlQZTxq5jBs4jBdkSPj/KIn92NW4j+c65OXGtHBLxoqUPgm5E3pxChBvdEY+ACZqARZWX44IZXvIihi4iuFhcob93G6G3G6PG5QOOKhJYafhv4CmUzgT3wC2afD7OvFburAXX1GqWpANbVJqwBH1Z3M+KWDyV3E6vfi9XXihlqxQo0oqcGDoG2jV15SX5zDi12GTUWQh3rRR8NsPf0LvLCdbRIEO1hCPV+N8WJXnayUbRYF1qsDzXWixoOIKfvIep7WKvVqNWqaFoJrWyiGyZa2UAtl9E0A710UCuWdHRDoJcttGK9b6CWyuhlgS4sVK2EbVl4ZFlG18osr8/RNnaS82PH6Xh4isuJH+iIn8I3dpy22EkmkxE64z/yW/RLLo1/S2fiOzoT39P+4BvO3f+MePIfHOsFHl3XMQzB5u4G0aVr3F/u58Hqdcaf3nR9PY8uD5LOJImvjjC6FOJh+m/i6RHGn44wtjJEZKmXlcw8FcvBU3/HjlNlV86xuDHBYmaShczbfoJkZoqtnSyp7CM3/6+fcP38xji5vSxOpYont51DLWjMP5tEuncUKfwR3sjH7ijeyCc0hj+gefQYiYUIvugJGsJH3L4/9rVb90aOcvrue8STd3hR2cdz8B/WKJVLKFqB4qEV1PybuG66rv0vV9Q8iiYfxJqMXtKpVBz+BY0og/u3Xj/bAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image2020-7-16_17-37-33.png&quot;
        title=&quot;image2020-7-16_17-37-33.png&quot;
        src=&quot;/static/4af7a1df9bca66fe0b83e513fec67b2f/1d69c/image2020-7-16_17-37-33.png&quot;
        srcset=&quot;/static/4af7a1df9bca66fe0b83e513fec67b2f/4dcb9/image2020-7-16_17-37-33.png 188w,
/static/4af7a1df9bca66fe0b83e513fec67b2f/5ff7e/image2020-7-16_17-37-33.png 375w,
/static/4af7a1df9bca66fe0b83e513fec67b2f/1d69c/image2020-7-16_17-37-33.png 750w,
/static/4af7a1df9bca66fe0b83e513fec67b2f/78797/image2020-7-16_17-37-33.png 1125w,
/static/4af7a1df9bca66fe0b83e513fec67b2f/ccf0c/image2020-7-16_17-37-33.png 1428w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;除了最核心的扫描目录，解析 Markdown，生成JSON之外，针对 Markdown 做了一些语法上的拓展。比如输入
&lt;code&gt;@dchat张伦(zhanglun)&lt;/code&gt;会解析成一个&lt;strong&gt;内容为“张伦”，点击打开公司 IM 的 a 标签&lt;/strong&gt;；输入&lt;code&gt;:::info  :::&lt;/code&gt;可以创建一个info类型的提示区域等等。未来还会支持PDF, PPT文件的预览。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;提升开发体验&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E4%BD%93%E9%AA%8C&quot; aria-label=&quot;提升开发体验 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;提升开发体验&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;为了让编辑人员在写文档的时候能有写代码的感受。通过工程化的角度，对整个流程做了一下小小的优化。docbuilder除了核心的构建能力之外，还提供了快速初始化，语法检查和本地预览启动的功能。使用也很简单，安装之后通过几个命令就使用。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;# 安装
npm i -g docbuilder

# 初始化文档项目。包含约定的目录结构和ci配置
docbuilder init

# 本地启动预览
docbuilder serve&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当编辑完成之后，只需要将代码推送到远端master分支，触发持续集成之后，开始构建和打包。最后将数据导入数据库，实现自动更新。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;增加内容反馈帮助提升文档质量&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A2%9E%E5%8A%A0%E5%86%85%E5%AE%B9%E5%8F%8D%E9%A6%88%E5%B8%AE%E5%8A%A9%E6%8F%90%E5%8D%87%E6%96%87%E6%A1%A3%E8%B4%A8%E9%87%8F&quot; aria-label=&quot;增加内容反馈帮助提升文档质量 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;增加内容反馈，帮助提升文档质量&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;为了让用户和文档中心形成一个较好的沟通体系，在每一篇文档中的最底部都增加了针对这篇文档的反馈入口，效果如图下所示：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/22fc59914d58a7aa282622ca7f5212e9/cc6fe/Xnip2021-06-13_15-11-20.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 48.93617021276595%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/UlEQVQoz5VS20pDMRDM//+db76IFnoUbI85ud8zMqkR9GBtF4bswu5kMlmRcoU2DkopKO1gjEUpBb13tN7HeQ9EtCcsh0e8vr3j+PKA5XhAiBEMNtwbovsFQT6jNADxCVadEGK6KGxEu+CPeqcwlw7rArTmkz18iAgh3KxoR9hqxXo+w1oHKT+wbdt4spQSOWdorUceY4T3Aeu6jh7W8+IfhLW1MeScg7UWxpiRcyiljFwKUkqotaKUOvKU86iJvcLpSa3f/tSv/JZPmUQzF9eGrq3H75hCBH2iL977f0kmOEhfN6WGRbSMf0BfBZeYZCS+dXmphv0E54np6SfDARLm9wWadQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Xnip2021-06-13_15-11-20.png&quot;
        title=&quot;Xnip2021-06-13_15-11-20.png&quot;
        src=&quot;/static/22fc59914d58a7aa282622ca7f5212e9/1d69c/Xnip2021-06-13_15-11-20.png&quot;
        srcset=&quot;/static/22fc59914d58a7aa282622ca7f5212e9/4dcb9/Xnip2021-06-13_15-11-20.png 188w,
/static/22fc59914d58a7aa282622ca7f5212e9/5ff7e/Xnip2021-06-13_15-11-20.png 375w,
/static/22fc59914d58a7aa282622ca7f5212e9/1d69c/Xnip2021-06-13_15-11-20.png 750w,
/static/22fc59914d58a7aa282622ca7f5212e9/78797/Xnip2021-06-13_15-11-20.png 1125w,
/static/22fc59914d58a7aa282622ca7f5212e9/aa440/Xnip2021-06-13_15-11-20.png 1500w,
/static/22fc59914d58a7aa282622ca7f5212e9/cc6fe/Xnip2021-06-13_15-11-20.png 1860w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在数据库的设计中，增加了一张feedback表，用于统计信息。用户每反馈一次便增加一条数据。同时在后台按照每个服务的维度做了数据统计，包括总数，每日新增，已回复，未处理等。服务团队可以按需派人针对收集到的问题对文档内容进行改进。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;其实整个系统在设计和落地过程中远比上文描述的要复杂。更多的细节就不在文中细说。从技术难度的角度上来说，当我完成并落地之后，并不认为难度有多高。相反我认为实现需要一定的创造力和想象力，熟悉工具及其背后原理，才能将不同的环节串联在一起。在第一版上线之后，还化身“客服”的角色，推动服务方接入，这是从未有过的经历，虽然前期很痛苦，但是好在坚持下来，接入文档的服务方慢慢的增加。我自己也一直是以接入方的视角来思考如何推动更多服务的接入，比如提供了预览环境支持上线前的预览，提供接入指南，创建客服群增进沟通等等，后续还有跟多的想法希望在接下来的工作中能够逐步完善。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Zen Reborn 计划]]></title><description><![CDATA[背景 作为业务组件库，zen在多个租车B端系统中被广泛使用。 zen在提高租车B端的研发效率的同时，保证B端系统的UI和交互的一致性。 但是当初的维护人员已离职或者转岗，没有专人(团队)维护 最新版本为v1.3.12，发布时间2020-12-04 11:15:24，发布人在职。…]]></description><link>https://zhanglun.github.io/blogs/2020-09-20-Zen Reborn 计划/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2020-09-20-Zen Reborn 计划/</guid><pubDate>Sun, 20 Sep 2020 10:20:51 GMT</pubDate><content:encoded>&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;背景&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%83%8C%E6%99%AF&quot; aria-label=&quot;背景 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;背景&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;作为业务组件库，zen在多个租车B端系统中被广泛使用。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;zen在提高租车B端的研发效率的同时，保证B端系统的UI和交互的一致性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;但是当初的维护人员已离职或者转岗，没有专人(团队)维护&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;最新版本为v1.3.12，发布时间2020-12-04 11:15:24，发布人在职。小修补&lt;/li&gt;
&lt;li&gt;最大版本号v2.2.98，发布时间2019-08-28 11:21:43，发布人已离职。找不到该版本的信息&lt;/li&gt;
&lt;li&gt;v1.3.5 发布时间 2019-11-19 11:13:56 ，v1.3.6发布时间 2020-08-25 19:38:05。间隔了将近一年。同样找不到v1.3.5的记录&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/321231bb5b0e95a37cf08553555ac963/fe720/Untitled.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.765957446808514%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXElEQVQoz4WRy0vDQBDG82d78ubFgx4ET1IQiiIKWltPhSKoB9EqHpqbTSFJ82qzebRN9pF+Mtuaqj04MLuzu7O/+XbHcNqvcO76GHc/oEoBsuVy+a9/5/01o7/TxPvuOcz9FmRerHa3837ZT+gWsJgvkLIESioopSClRFVV+gKtKZZC1Hu1OqU2XlV1IYMLgTAK4fkeppMJXMdBHMcakjAGxhgc2waLYwjOwcsSlVLbqtdQg5ccURTB9zxMogjeeiZgmiTIs0yfZWkKJaUG5rM54l4X03YL4cUZ0qeHGmpwzhEEAcIwXCmKY4xdVwPICUqqR6ORfoEuNJshvL5CcNqAe3SIaed2A6R/IkW2bdcqreEQlmVpQOD7OjYHA12IgCzLMb9pYNE8QHF5jPnJHhad5urJNBCUlNIf0QWKy7LUDRLrdVEUOqbmCKnAzT74yz342yP4cw/y09TAL72OX+eOu7pPAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/Untitled.png&quot;
        title=&quot;./images/Untitled.png&quot;
        src=&quot;/static/321231bb5b0e95a37cf08553555ac963/1d69c/Untitled.png&quot;
        srcset=&quot;/static/321231bb5b0e95a37cf08553555ac963/4dcb9/Untitled.png 188w,
/static/321231bb5b0e95a37cf08553555ac963/5ff7e/Untitled.png 375w,
/static/321231bb5b0e95a37cf08553555ac963/1d69c/Untitled.png 750w,
/static/321231bb5b0e95a37cf08553555ac963/78797/Untitled.png 1125w,
/static/321231bb5b0e95a37cf08553555ac963/fe720/Untitled.png 1448w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;当前现状&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%BD%93%E5%89%8D%E7%8E%B0%E7%8A%B6&quot; aria-label=&quot;当前现状 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;当前现状&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;&lt;img src=&quot;./images/Untitled%201.png&quot; alt=&quot;./images/Untitled%201.png&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;组件使用情况&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;img src=&quot;./images/Untitled%202.png&quot; alt=&quot;./images/Untitled%202.png&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;所以，这件事情是有必要做的&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;改进计划&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%94%B9%E8%BF%9B%E8%AE%A1%E5%88%92&quot; aria-label=&quot;改进计划 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;改进计划&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;&lt;img src=&quot;./images/Untitled%203.png&quot; alt=&quot;./images/Untitled%203.png&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;上图是第一次分析时得出的初步计划，在仔细研读zen现有的代码和设计的时候遇到了下面几个比较头疼的点&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;React版本16.3.0和Antd3.x，有很多API提示将要废弃。在此基础上改造收益不高&lt;/li&gt;
&lt;li&gt;工程化相关的配置比较老旧和冗余，改造成当前流行的最佳实践成本较大&lt;/li&gt;
&lt;li&gt;新增业务组件必须使用老版本的react和antd，开发人员积极性不高&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;&lt;img src=&quot;./images/Untitled%202.png&quot; alt=&quot;./images/Untitled%202.png&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;所以决定&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;原有版本继续维护，只做bugfix&lt;/li&gt;
&lt;li&gt;开启新项目zen-next(zen2.0)&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;&lt;em&gt;&lt;strong&gt;新老项目并存必然会带来一些问题&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;老项目新旧版本如何共存？&lt;/li&gt;
&lt;li&gt;新老版本依赖了不同版本的react和antD，是否会存在冲突或者冗余，如何解决？&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;首先明确一点，新老版本共存这个事实将会客观存在，并且将存在一段时间。子应用中可以使用新版本，老系统可以暂时不用care。随着子应用的逐个拆分，老系统最后将会边成一个架子。当不在有项目依赖老版本zen时，zen就可以退出历史舞台。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;关于依赖的问题，对于组件库来说，第三方依赖不应该被包含在产出物中，尤其是React,antd之类的超级依赖，(一些小体积的辅助工具可忽略，比如按需引入的lodash函数)。所以zen-next的产出物会将不包含react antd。目前老系统和zen-pc-bc 都是将二者打包在产出物中，所以不会存在冲突。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;img src=&quot;./images/Untitled%204.png&quot; alt=&quot;./images/Untitled%204.png&quot;&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Zen-next&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Zen-next&quot; aria-label=&quot;Zen next permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Zen-next&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;首先对zen-next的提出几个要求：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;详细的使用文档&lt;/li&gt;
&lt;li&gt;兼容的API设计&lt;/li&gt;
&lt;li&gt;标准的协作共建&lt;/li&gt;
&lt;li&gt;舒适的研发体验&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;接下来按照下面几个步骤来一步步开始和完善zen-next&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;制定规范&lt;/li&gt;
&lt;li&gt;确定需要改造和迁移的组件&lt;/li&gt;
&lt;li&gt;确定API&lt;/li&gt;
&lt;li&gt;评审&lt;/li&gt;
&lt;li&gt;开始开发&lt;/li&gt;
&lt;li&gt;重复步骤2&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;项目规范&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%A1%B9%E7%9B%AE%E8%A7%84%E8%8C%83&quot; aria-label=&quot;项目规范 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;项目规范&lt;/h2&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;项目目录&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95&quot; aria-label=&quot;项目目录 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;项目目录&lt;/h3&gt;
&lt;deckgo-highlight-code language=&quot;jsx&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;|-- docs 项目文档
|-- scripts 工程化相关脚本
|----| webpack webpack配置目录
|----| commander 项目命令集合
|-- src 组件库源码
|----| _style 公共样式目录
|----| _hepler 工具类函数
|----| components 组件目录
|----| components 组件目录
|------| Component1 
|--------| demo demo目录，一个文件为一个demo用例
|----------| start.mdx
|----------| ...
|--------| index.tsx 组件入口
|--------| index.css 组件样式
|--------| index.mdx 文档页面
|--------| ... (其他按需添加)
|-- lib 输出产出物目录
|-- site 组件库文档&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;组件规范&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%84%E4%BB%B6%E8%A7%84%E8%8C%83&quot; aria-label=&quot;组件规范 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;组件规范&lt;/h3&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;| Component1 
|--| demo demo目录，一个文件为一个demo用例
|----| start.mdx
|----| ...
|--| index.tsx 组件入口
|--| index.css 组件样式
|--| index.mdx 文档页面
|--| ... (其他按需添加)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;具体细节可查询项目 &lt;code&gt;docs&lt;/code&gt; 目录&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;代码规范&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83&quot; aria-label=&quot;代码规范 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;代码规范&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;ESLint 和 PrettierJS&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了减少对某些约束的无意义的讨论，采用社区推荐的规范。项目使用 React 和 TypeScript开发，所以使用 &lt;strong&gt;&lt;a href=&quot;https://www.npmjs.com/package/@typescript-eslint/parser&quot; class=&quot;link-underline&quot;&gt;@typescript/parser&lt;/a&gt;&lt;/strong&gt; 作为parser，配合 &lt;strong&gt;&lt;a href=&quot;https://www.npmjs.com/package/@typescript-eslint/parser&quot; class=&quot;link-underline&quot;&gt;eslint-plugin-react&lt;/a&gt;&lt;/strong&gt; ，再加上少许定制。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;而在代码格式方面则使用&lt;strong&gt;PrettierJS&lt;/strong&gt;推荐的配置。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;提交规范&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83&quot; aria-label=&quot;提交规范 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;提交规范&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;毫无疑问，采用推荐的 &lt;strong&gt;约定式提交。&lt;/strong&gt; 为提交信息增加人机可读含义的规范。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;为什么使用约定式提交&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E7%BA%A6%E5%AE%9A%E5%BC%8F%E6%8F%90%E4%BA%A4&quot; aria-label=&quot;为什么使用约定式提交 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;为什么使用约定式提交&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;自动化生成 CHANGELOG。&lt;/li&gt;
&lt;li&gt;基于提交的类型，自动决定语义化的版本变更。&lt;/li&gt;
&lt;li&gt;向其他人传达变化的性质。&lt;/li&gt;
&lt;li&gt;触发构建和部署流程。&lt;/li&gt;
&lt;li&gt;让人们探索一个更加结构化的提交历史，以便降低对你的项目做出贡献的难度。&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;具体细节可查询 &lt;a href=&quot;https://www.conventionalcommits.org/zh-hans/v1.0.0-beta.4/&quot; class=&quot;link-underline&quot;&gt;约定式提交&lt;/a&gt; 。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在约定式提交的基础上，使用 &lt;a href=&quot;https://github.com/conventional-changelog/standard-version&quot; class=&quot;link-underline&quot;&gt;standard-version&lt;/a&gt; 可以按照 &lt;code&gt;semver&lt;/code&gt;标准来实现自动更新版本号和更新 &lt;code&gt;ChangeLog.md&lt;/code&gt;。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;工程化&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B7%A5%E7%A8%8B%E5%8C%96&quot; aria-label=&quot;工程化 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;工程化&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;&lt;img src=&quot;./images/Untitled%205.png&quot; alt=&quot;./images/Untitled%205.png&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;完善的工程化设计，能够很好的帮助开发。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;高优迁移的组件&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%AB%98%E4%BC%98%E8%BF%81%E7%A7%BB%E7%9A%84%E7%BB%84%E4%BB%B6&quot; aria-label=&quot;高优迁移的组件 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;高优迁移的组件&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;使用工具 &lt;a href=&quot;https://www.npmjs.com/package/madge&quot; class=&quot;link-underline&quot;&gt;madge&lt;/a&gt; 分析zen的代码依赖，得到下图&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7010dead7e3b32e01ad96706211e070b/eff5b/graph.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.808510638297875%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSklEQVQoz12S6W4DIQyE9xE4fQGbQ1WUqu//fFPZu0mV/hiBEP6wZ9hKKfiv1jp6J4ho7FtrqLWBRcDMyDkj5xRrSin02m9++SiobznMzxxOTNgvO1gYYgY1O+91lFxOeH5DNyL6gDnIOwtowDvUFJ06uHVQbRhj4PH8jo5zSvFwQHPCJiJR7IVzLdgwEAuYGEsNUxWXYTBmKPfQugw8f+5Q4+jsAJZjZFUFs4KIoSYQ5bjgnvmZP6g641FiBomgus8OOcd0MRM6taNDZovi69eOudvbD5db4r75ajYwxjz9FNRWzyAPq0ot2Dy1WsvhYakffpZawUS4rQVlxmUZrruhdU+czrrjB7zS3v4n/AH0lImw1g0ihjEn5tqjGx/Pfd/3K2zMv5RbqzGqTUFKGbnk97iu17/0Lo7wONJ1uFtwvz9wvX2FDcQdv/OE4NFL0ilHAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/graph.png&quot;
        title=&quot;./images/graph.png&quot;
        src=&quot;/static/7010dead7e3b32e01ad96706211e070b/1d69c/graph.png&quot;
        srcset=&quot;/static/7010dead7e3b32e01ad96706211e070b/4dcb9/graph.png 188w,
/static/7010dead7e3b32e01ad96706211e070b/5ff7e/graph.png 375w,
/static/7010dead7e3b32e01ad96706211e070b/1d69c/graph.png 750w,
/static/7010dead7e3b32e01ad96706211e070b/78797/graph.png 1125w,
/static/7010dead7e3b32e01ad96706211e070b/aa440/graph.png 1500w,
/static/7010dead7e3b32e01ad96706211e070b/eff5b/graph.png 4530w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;结合前面提到的组件使用情况统计&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;img src=&quot;./images/Untitled%202.png&quot; alt=&quot;./images/Untitled%202.png&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;同时对每个组件单独进行依赖分析可以发现最为复杂的是：BaseForm&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;img src=&quot;./images/Untitled%206.png&quot; alt=&quot;./images/Untitled%206.png&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;BaseForm是ListFilter、FormModal、EditForm的下层依赖，而BaseForm又依赖了以下这些组件&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;SmartSelect&lt;/li&gt;
&lt;li&gt;BankCardInput&lt;/li&gt;
&lt;li&gt;VerificationCode&lt;/li&gt;
&lt;li&gt;CitySelect&lt;/li&gt;
&lt;li&gt;CompanySelect&lt;/li&gt;
&lt;li&gt;SearchInput&lt;/li&gt;
&lt;li&gt;EditTable&lt;/li&gt;
&lt;li&gt;BetweenTextInput&lt;/li&gt;
&lt;li&gt;CarVariantMultiSelect&lt;/li&gt;
&lt;li&gt;CarVariantSelect&lt;/li&gt;
&lt;li&gt;CityPanelSelect&lt;/li&gt;
&lt;li&gt;PhotoBox&lt;/li&gt;
&lt;li&gt;Card&lt;/li&gt;
&lt;li&gt;SmartInput&lt;/li&gt;
&lt;li&gt;AsyncButton&lt;/li&gt;
&lt;li&gt;EditTag&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;所以重构迁移过程中首先以这些为主&lt;/p&gt;</content:encoded></item><item><title><![CDATA[在滴滴的这几年：基于 Node.js 的私有云 Web 管控系统]]></title><description><![CDATA[在大概18年上半年，有幸被抽调到一个FT，参与云平台私有云项目的开发中。这个项目是一个产品化的IaaS解决方案，为企业提供管理包括计算，网络，存储在内的数据中心资源的能力。 私有云和IaaS 私有云(Private Clouds)是为一个客户单独使用而构建的，因而提供对数据、安…]]></description><link>https://zhanglun.github.io/blogs/2020-06-14-在滴滴的这几年：基于 Node.js 的私有云 Web 管控系统/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2020-06-14-在滴滴的这几年：基于 Node.js 的私有云 Web 管控系统/</guid><pubDate>Sun, 14 Jun 2020 12:20:01 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;在大概18年上半年，有幸被抽调到一个FT，参与云平台私有云项目的开发中。这个项目是一个产品化的IaaS解决方案，为企业提供管理包括计算，网络，存储在内的数据中心资源的能力。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;私有云和IaaS&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%A7%81%E6%9C%89%E4%BA%91%E5%92%8CIaaS&quot; aria-label=&quot;私有云和IaaS permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;私有云和IaaS&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;私有云(Private Clouds)是为一个客户单独使用而构建的，因而提供对数据、安全性和服务质量的最有效控制。该公司拥有基础设施，并可以控制在此基础设施上部署应用程序的方式。可由公司自己的 IT 机构，也可由云提供商进行构建。云计算提供商可以安装、配置和运营基础设施，以支持一个公司企业数据中心内的专用云。有时候也会称之为“内部云”&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;核心点在于：利用虚拟化技术将源自物理硬件的资源组合到共享池中，使用时从共享池中按需获取所需资源。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在云计算服务中，有下面三类，自下往上依次是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;IaaS：基础设施即服务 (Infrastructure as a Service)把计算基础(服务器、网络技术、存储和数据中心空间)作为一项服务提供给客户。它也包括提供操作系统和虚拟化技术、来管理资源。消费者通过Internet可以从完善的计算机基础设施获得服务。&lt;/li&gt;
&lt;li&gt;PaaS：平台即服务(Platform as a Service）PaaS实际上是指将软件研发的平台作为一种服务，供应商提供超过基础设施的服务，一个作为软件开发和运行环境的整套解决方案，即以SaaS的模式提交给用户。因此，PaaS也是SaaS模式的一种应用。&lt;/li&gt;
&lt;li&gt;SaaS：软件即服务 (Software as a Service)SaaS是一种交付模式，主要还是面向企业的服务，国外比较有名的比如CRM起家的Salesforce等等，国内比较有名的比如做企业通讯的钉钉和企业销售管理的纷享销客等等&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cc1ac5b52c9e90e38da245de98a081be/d48f1/visual-uaas.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 61.702127659574465%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAACeUlEQVQoz3WR/UtTURjH9wf1kxKYtpovhcst0yzqh6HQHEb0BpEkFZaBpBkaURiUIc2X7c5lOLpJDafTu7S5oVv3nvui7U2tzbm3O+/Z7u6JuxQj6MvhgefwfPh+z3kU3q240R+wgjC2fyz0hoXZkCu7eXAJQhNr0UkAIok4QqggSQghRTi1W291lhkdlaOzqtGZyvE55RBe8eqDcggvf2k9/s6uGptVjcxUjc+W9ltv9lzZDroRQpJUkGGIMr30cJPpswab12BO7XvXyTdT5feeVnQOlHX01A7jWiuhtTjV5qWO26WWu8pvHt+vWDydTsswl4/62LHIoL7JZD+FLWowos68oB5x1Bod6hFHnXlBaybUE8QZk33pmYp43kIy61CQJcM5hDy2W1/x9qvknWZKZwCtelpvWDO0BdsMa4ZWoNez+ovelvHwJMrks5lsXhTRvhSIj29Ody3u+FfT7muRRt2W6oKrQmMuOec4ojGV6Ohjl3zVmLk5u83xUEwkExDCA7jAx3MeTCo27h27DhxuAjV1M8oaS5n649F6trybfjj/tjm48ppkQs45B00zfzkjBIPLUi4rf5/X9onsekQ39lINPUxDHzjbtVLtSX7xRgg6uiyJSBAECKFU1B5c2E2lWEKEPAy587FwcvA87K/KvdCknpwQ8MtCuBv9RwpU3Bgf9gdtffTwjaWOUuf9Gry90tZ2CO+s58H13R8teX6ZBOssSwMAKJKkKCoWi+05IyRnyGeTCcaVZFzZTCLktQcGTlP+1cfTKw9w42KQjEejLMsFAgGGYTiO21vVnwDyGyTpIFBBRPxPoYC+b4tTXIKKZYoz/8b+DWxILMD1so1HAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;visual-uaas.png&quot;
        title=&quot;visual-uaas.png&quot;
        src=&quot;/static/cc1ac5b52c9e90e38da245de98a081be/1d69c/visual-uaas.png&quot;
        srcset=&quot;/static/cc1ac5b52c9e90e38da245de98a081be/4dcb9/visual-uaas.png 188w,
/static/cc1ac5b52c9e90e38da245de98a081be/5ff7e/visual-uaas.png 375w,
/static/cc1ac5b52c9e90e38da245de98a081be/1d69c/visual-uaas.png 750w,
/static/cc1ac5b52c9e90e38da245de98a081be/d48f1/visual-uaas.png 796w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;三件小事&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%89%E4%BB%B6%E5%B0%8F%E4%BA%8B&quot; aria-label=&quot;三件小事 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;三件小事&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;对于私有云项目，简而言之就是我们自己做产品，然后买给企业，帮助部署。交付形式是实施的同学大家背后的实体物理机器，然后将整个软件部署在机子上(通过U盘复制项目代码，进入企业机房，拷贝安装，然后部署。后续的运维和管理操作，则在配套的Web管控系统中完成。我主要负责了Web管控系统从0到1的所有工作，期间有几个比较有意思的点，可以和大家分享一下。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7fa16fe598d5fa0b2943864b8cb4f26c/0a344/picture1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 52.659574468085104%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAC+0lEQVQozzWK209bdQDHzx+h/4KXREOyRRN9ND6qMT4YDerGTGYCeMmCwfngEmI0youEDZ7cWM18YFgKLb3QwmnPtXda2tLCYL2c3mgPg0zcIMf8PgYWHz7JJ9/PV5qci/476VIcNd9zekc4Vt9xWn3H6RycON0zHp06tfbfTnG76ZR2Wud+tp21jn3itO1n3j88dZLlA0cadG/ysXsLV7FIcT9Jbj9Nvp9Ha9aJ1qoYrRpGc5tAZYtgpYzRrKC3/m9V4p095OpDdKvOwnYF6RXzES/ox2KmsSR2u+Ni7/GE2PtnSngeJoQrrwpfXRfRjl/cK+jiXkETStcvlqqGuJtTRcBShNwNizsbMXG/Ehd/WBEhverO8+L9kvi9tkzL/oH28S+0n86wbsVZLMrEWhoZO4R/N06wmiRrB4g2DXw7JnpHIdUL4SnFCD5QWLAiSAPhGi+H2uJ2Y5lGe5zu8Y/sn0yz1jBYLKwj12U2DkJ4yyr+Bya5gwDrNQX3pozejpLcjzCfU/CVdf5qriENxLq8JB+KOw0PfXsc+8kE9ulvxBoK3uIqSj1M4dCPv7zO6q5C8XCFaG2NxVwQsx1h+2geZc9NylrE1/EivWH0uageiTlrhZZ9g86TX2mfzBKxUrhLGtFWnIwdwVM2WN5JsHEQJlzTWSiqyJbGkfMzj8VPPGWCqD2HdNG3wOshj/jQXGPUjDCaWOdKOsrVtMJwXOaLlMKVrMpIIsZIMnbuw1mNkfizz9WCyWhG5cuszqW8jvSc5y7P+/4Ub6VkPs9qDGVU3s/pDG6aDCVkPivEeW9D5VM9zKAW4p2swic5nUtGhI82VD4opricNhjKmry7mUC6vXoN19qYWElP4kvMsmzeJJCewp+6ide8hTc+TSAzhT85e86ZBzMzLOnTBNIzBOM38MnjeKPfETC/R8q7BtiZvyBs7TLbkTFKwW/oaMNU5a/YWr1GJTRCzxilpl6nrl2nb45gaWMUg19jad+yH36byvwFyvOv0Qu9yX9h88EDsZngagAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;项目整体架构图&quot;
        title=&quot;项目整体架构图&quot;
        src=&quot;/static/7fa16fe598d5fa0b2943864b8cb4f26c/1d69c/picture1.png&quot;
        srcset=&quot;/static/7fa16fe598d5fa0b2943864b8cb4f26c/4dcb9/picture1.png 188w,
/static/7fa16fe598d5fa0b2943864b8cb4f26c/5ff7e/picture1.png 375w,
/static/7fa16fe598d5fa0b2943864b8cb4f26c/1d69c/picture1.png 750w,
/static/7fa16fe598d5fa0b2943864b8cb4f26c/78797/picture1.png 1125w,
/static/7fa16fe598d5fa0b2943864b8cb4f26c/aa440/picture1.png 1500w,
/static/7fa16fe598d5fa0b2943864b8cb4f26c/0a344/picture1.png 1741w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;一BFF架构的全栈开发&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%80BFF%E6%9E%B6%E6%9E%84%E7%9A%84%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91&quot; aria-label=&quot;一BFF架构的全栈开发 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;一、BFF架构的全栈开发&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;当时的需求中要求管控系统要维护用户登录状态之外，还需要对写入操作进行操作记录。FT中没有可分配的人力来提供这些后端能力，而我有使用Node做Web开发的经验，于是果断采用了Node作为中间层来满足这些需求。事实证明这个选择没有错。操作日志模块后续还增加了批量导出为excel的能力。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9fd7eea657a8f8fe7fbe74eeff5c59d8/373e5/bff.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 39.8936170212766%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAACV0lEQVQoz1XRX0hTcRQH8J+LZQmZVjoKtIxUsliBthKZ5063Vu1eN5tFbfkHXGFQZI899K4IXRzUKhAp0821TTFrzrxCDp9ida1NQpY5MwtaY5fMdHdxYmVCDx/4cr4v53CI2EmfEztp8/90ZtF2xizeqfubreudSeykGxNWRst2OyWjY5xUXV21HQD2r8kjyDICskwCWWYFWWZ13d36FbSZVvEWvYpszb/5MrIMIqufuGcf2Pyot09WW0NnK5XKfIqicgAgnbgd1Em3g6LdDkrncVA6lx1oV3/FKZv1UN3DrjK9016hc9spXapfo/c4Ksv7eu+Tnp4HZG9BTppard5gMpkIABBi4RTfLZwiaeEUiWbuiHhpvFy87j8htk5ok9cmNGKr/3jCwh0VLZwiZcXCKfAid8zv7B7McPY/zmUMdJZSqdypUqk2AkAaaRguZBqGio1N3mJDk7dI3/SkxNjiKzVcHi3VtzwrM14ZUxgah4trz7sLTjf7SvT1g0VnLwztqxxxvZAMeAalVdVVuQBwAAAOAkAmQUQZfsQCRMxExC0YxTxE3PXHIuYjYgYi7sAlLETEdPyEuzGJsg8zEdLe1p46UwYAhwGgEAAkhJ96nRjxeXH63fTL97PhqVR+G3yTDLwK/BrjnmN4NuyPxqLh+fkI/vi55Pn8ZTEZ/fZ1hhCSWoZoNJptqe8CwB4AyCKhUGh8cnISFxYWbkcikZuBQMDD8/xyMBiM8jzvmpubuyEIQnssFnsqCMLVeDzeFY/H2+RyOeno6CBarXYTAGwFgGwAkP4GEYNXoATsB4wAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;bff&quot;
        title=&quot;bff&quot;
        src=&quot;/static/9fd7eea657a8f8fe7fbe74eeff5c59d8/1d69c/bff.png&quot;
        srcset=&quot;/static/9fd7eea657a8f8fe7fbe74eeff5c59d8/4dcb9/bff.png 188w,
/static/9fd7eea657a8f8fe7fbe74eeff5c59d8/5ff7e/bff.png 375w,
/static/9fd7eea657a8f8fe7fbe74eeff5c59d8/1d69c/bff.png 750w,
/static/9fd7eea657a8f8fe7fbe74eeff5c59d8/78797/bff.png 1125w,
/static/9fd7eea657a8f8fe7fbe74eeff5c59d8/aa440/bff.png 1500w,
/static/9fd7eea657a8f8fe7fbe74eeff5c59d8/373e5/bff.png 3432w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当时参考了一些社区解决方案和当前项目现状(主要是不能用公司内部代码)，决定采用Koa作为框架，利用Koa的生态来打造一个功能健全的Web服务。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c7f81cfa8e5197c12dafe5c6fd84bc80/7e11a/koa.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 72.3404255319149%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADcUlEQVQ4y3WQW0zbZRjGv0QTufHKq8W4i92ZGBNvTDzEi3lhdDJNtsmqOGY5yEFogY0CE8scsAJtKactKpNTBy0UCk07xkBogToiAoMB64FyNqIzMV79L+D//UyLFxr14pf3eZ73zfu9+cRzXpMiuvMRdj1P9JdzbLiKZ4auIpwGxO1CRPunZM+7qVsLIL7ORHTqEd1FHHdX8+xgFUmOckRHwRE9BkTX3LJimvges/++tAV+kFqPR37mG0noeFY1Ni0D0W259PtvsmZ5TppXF6VtbUmWLU7JzFmfbFh7IM2rC7J+ZUHeDD+Uwl6+pzR8tEFT2qZsy9+hq3iP7st7fJWzTdPFTeo+iBHsfIxnF94eBO09OOOF4gB0rMC7w0dZig8+vgui/eqWUpsRwpwdlrb8KC3F6wksuRHMORGuXXjEVM8+rm141XlIyojKW0Mq2nEV66LKGy6Vsz6Vd4ZV3veqiPYvtpTaT8KYMyPSlhvlRnGMG0UxrNlRLFkRqlJDTHTts/wHNMxLWpagcRF6w5LJXZnQzQ+OaFuRiG8rthRTWhhzRkTWacM069ax5UWp1SYe4UtNiGn7Pu1ROH5L8nq/5PluSbIHjLNwokNyckDyUo/kZQeIDuOWEl9kyYrI+EWthTFa9LHEsviV1akh/PZ9Zh6Dzi+puC+5PC2xLsDgOhRNSYyzkrKgpHIWxDcVG0pV2iNM6SFpSg/RVBilURflujZE/G+NmjW+6/oZ/y+QNX5IaVClIKBSM6fSG1bJmVQpmVHRB1QMQRXReWlXMZ+NYT2/IZvTtmjL3UnQmLpJg2aDmtPrBG/9in0DXuiE08PwigM+vAPWeXjRDqeG4DUnnHSB+Px2QLnQ6CG9xSu1rV7Sb3rRxmnxktHqI8XixuF/iGfnJ970+XnvXpBTd2fQTM6QHZxO6OTRIMmjM2gmZhHHxm2KGDAgBsul8FTy9Gg9SSMmxHAFwn0F4dSTuTpGXexHRGc+wlmGcBgQrkqS3DUIZ+mR7y1BuIyIjpHrSl1vHhanTlqdOhr7CrH16eOeuK/uyWNyzMR8oIFrjjws/Xrq+3RY+/XYXIWY+3SYE1kBTW4DAusJhUsCSoXEIPgHpX/VyiQwPsW/+n+fKxFgfBJxeKdYOeg5w4HjvDxwpPBfqE5Ngv/rJ+g9x8HARf4EkRUabq5okwIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;koa&quot;
        title=&quot;koa&quot;
        src=&quot;/static/c7f81cfa8e5197c12dafe5c6fd84bc80/1d69c/koa.png&quot;
        srcset=&quot;/static/c7f81cfa8e5197c12dafe5c6fd84bc80/4dcb9/koa.png 188w,
/static/c7f81cfa8e5197c12dafe5c6fd84bc80/5ff7e/koa.png 375w,
/static/c7f81cfa8e5197c12dafe5c6fd84bc80/1d69c/koa.png 750w,
/static/c7f81cfa8e5197c12dafe5c6fd84bc80/78797/koa.png 1125w,
/static/c7f81cfa8e5197c12dafe5c6fd84bc80/7e11a/koa.png 1235w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;二构建和打包&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BA%8C%E6%9E%84%E5%BB%BA%E5%92%8C%E6%89%93%E5%8C%85&quot; aria-label=&quot;二构建和打包 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;二、构建和打包&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;因为私有化部署的关系，我们最终交付的软件包是通过U盘拷贝的形式来部署代码的，部署和运行的过程不能依赖外部网络。这意味着我需要我所有的运行时依赖都打包在一起，能到达到解压即可运行的程度。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在我最终产出的压缩包中有一个 &lt;code&gt;control.sh&lt;/code&gt; 脚本，提供了 &lt;code&gt;start&lt;/code&gt;，&lt;code&gt;stop&lt;/code&gt; 之类的几个命令，后端同学只要能调用这个脚本，就能在项目部署阶段将管控系统给部署起来。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在具体构建过程中，前端通过 &lt;code&gt;Webpack&lt;/code&gt; 已经全部构建好输出到指定目录了，浏览器端的代码很好解决。Node 中间层这边稍稍不一样，运行除了依赖 &lt;code&gt;node_modules&lt;/code&gt; 中的包，还依赖 &lt;code&gt;Node&lt;/code&gt;的可执行文件。、在构建阶段我把 &lt;code&gt;node_modules&lt;/code&gt; 下载好，将 &lt;code&gt;node&lt;/code&gt; 可执行文件也放入其中，随代码一起打包输出。最后交付的压缩包就包含了所有的运行依赖。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这个是构建过程。具体过程大概是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;获取 &lt;code&gt;package.json&lt;/code&gt; 里面设置的 `version 和指定的操作系统&lt;/li&gt;
&lt;li&gt;构建完成之后从镜像网站下载对应的node文件，放到临时目录。如果临时目录已经有存在的版本，跳过下载，已提高打包速度&lt;/li&gt;
&lt;li&gt;完成之后将 &lt;code&gt;node&lt;/code&gt; 文件复制到 &lt;code&gt;node_modules&lt;/code&gt; 中&lt;/li&gt;
&lt;li&gt;在 &lt;code&gt;control.sh&lt;/code&gt; 启动脚本中指定node程序的目录&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e72467ce31f8db7747c075aba06b08a8/a4f52/flow.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 65.42553191489361%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAABwgAAAcIAHND5ueAAAB7UlEQVQoz41SW2sTQRTe/yrou+9SClZIG0shBKISsZA8iOCDl5B0C8UmbVITq8U2SlNzqWTN7uay29nbzM45R3bHBoVSPAzDzDfnzPedj6MRESISkcGmd/XsPf3xndr60J0s8VtCWyZ5gVc90ivNWrW14/pXCkeAPyvN+RtJixVqW1efjlv57aP8i8PNp749+z/mNAMuel6nc1bb+/L67dc3Vd9NmHkYjlrHw8POsNkJHJeIFpfjQaM9OPg4PjmDf2Rb071c8eDJdiNfnBsmELn2fD9XqOcKjXzRHoyIqFdv7m5kP2wV2qVXIpaaEqAEnk5Cw5HXtyR4MI6iUHVGRL4wK937QuDSMFQPRCQlj/1TIQJVnewogdV5OEsNSoAo7ILXETEQoXbNodIDmm4wZkpYIoIWz5g75DESpT8En6VVmi9YWgwxSI5EcRRZ5327N7bP+9wPJGIYhPbF0Pwxtfs/A+ZJQCmlRISUDQC07+13J/svicgxJrW1TT2z9X4lY6b2ONastprVH65XHjya9AZAxIUQggsRJYc41n4Z48vRAFRPAqUvKCaQyVQgImee73DOAiX5hgmDVMgiYuXubvl0p/xNd7iX+JcUAERdwRkA3jaepjdfrT/PNEsr9aLpzZVjCJyMNcfqRvwG5t+UFNEh6j12HQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;flow.png&quot;
        title=&quot;flow.png&quot;
        src=&quot;/static/e72467ce31f8db7747c075aba06b08a8/1d69c/flow.png&quot;
        srcset=&quot;/static/e72467ce31f8db7747c075aba06b08a8/4dcb9/flow.png 188w,
/static/e72467ce31f8db7747c075aba06b08a8/5ff7e/flow.png 375w,
/static/e72467ce31f8db7747c075aba06b08a8/1d69c/flow.png 750w,
/static/e72467ce31f8db7747c075aba06b08a8/78797/flow.png 1125w,
/static/e72467ce31f8db7747c075aba06b08a8/aa440/flow.png 1500w,
/static/e72467ce31f8db7747c075aba06b08a8/a4f52/flow.png 2024w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;三异步API的处理&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%89%E5%BC%82%E6%AD%A5API%E7%9A%84%E5%A4%84%E7%90%86&quot; aria-label=&quot;三异步API的处理 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;三、异步API的处理&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;这里面还有一个比较有意思的是后端接口异步API的请求。底层API基于分为同步API和异步API两种：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;同步API&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;所有使用GET方法的API都是同步API，调用方收到的HTTP Response中直接包含了API的结果。例如：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;GET zstack/v1/zones/f3fa7671894a40f6a73f5bfc7d90c126 { &amp;quot;inventory&amp;quot;: { &amp;quot;uuid&amp;quot;: &amp;quot;f3fa7671894a40f6a73f5bfc7d90c126&amp;quot;, &amp;quot;name&amp;quot;: &amp;quot;zone1&amp;quot;, &amp;quot;description&amp;quot;: &amp;quot;test&amp;quot;, &amp;quot;state&amp;quot;: &amp;quot;Enabled&amp;quot;, &amp;quot;type&amp;quot;: &amp;quot;zstack&amp;quot;, &amp;quot;createDate&amp;quot;: &amp;quot;Jan 6, 2017 3:51:16 AM&amp;quot;, &amp;quot;lastOpDate&amp;quot;: &amp;quot;Jan 6, 2017 3:51:16 AM&amp;quot; } }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;异步API&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;除了登录相关的API外，所有不使用GET方法的API都为异步API。用户调用一个异步API成功后会收到202返回码以及 Body中包含的一个轮询地址（location字段），用户需要周期性的GET该轮询地址以获得API的执行结果。例如:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Status Code: 202 Body: { &amp;quot;location&amp;quot;: &amp;quot;http://localhost:8080/v1/api-jobs/967a26b7431c49c0b1d50d709ef1aef3&amp;quot; }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;为什么说有意思呢？那如果按照浏览器轮询Node层，Node层再去轮询后端，一来二去这个消耗就大了，接口请求慢不说，在一定程度上可以说增加了服务器的压力。那怎么办呢？首先每次创建一个异步任务，我就在redis这边保存一份job相关的数据，每次浏览器轮询的时候，通过jobUuid直接查redis，速度快。然后在Node层提供一个webhook接口，每次任务执行完成时，后端调用这个接口，将任务执行返回的结果同步更新到redis中。这样当异步任务完成之后，浏览器端的轮询也能很快地得到返回的结果。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/74edeb2980782f1b9b4408b96d49e9b4/7e318/loop.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 54.255319148936174%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABwgAAAcIAHND5ueAAAB5ElEQVQoz6WSXW8SURCG+ZXGG1lrUq0mICZ61xiVrVpDjbFYSxeQIgWL0W7YxQqxSlPFi1KIoU2w6UVNFEUWlv04+8mZMYvEkt76Zi7OPMnkPJOMD/8jPgTA4j1MMJiewdWLkBoXpqZxLYDZIKamYZKnZzA5ha9n0TG9YVpaGK5eGq4FIXsVcyF8cQ1yIZoJ0PUbXmUCNBuEEcdcyM0EaPoKLYTRsXz/HEzN1PoKUXRdVomqT+pZuqH2FEWSyUCzLedEGxDEoyrXKHB1gasXVvb4WG0jVuNTzc3MQTlzUE41N+MNIVbjl3c9Hq8LyS/iq1bFoa6PAtzaSZzZmGVE9pwQ9ovh88U5RmQvFO8Gyg8vv41MFef8QpgRWUZk/SLLCOxZ/ub191HTtT1t4pgDU+sTVTa0b532j15H0geyoUpE6aj9vqHKhqraRHMM1SI9XfHetgEA450BYOhSQOz+7valnkcoEI3omk50YluOY7l0SBHRtid3Bqjn+a1IdHuR+7j87NPTZHUp+SES/dk67Mpyu92WepLrui7gcWu/tDJfef7kHRc5bu6Nh3fT6+U7kcrC0s4it/0otnX/cen2g87Xo9H/9K8XIsq/vlfz8cab/OeXifbh/uhIJgKjnGonyakL+wOwjyrDjBnprgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;loop.png&quot;
        title=&quot;loop.png&quot;
        src=&quot;/static/74edeb2980782f1b9b4408b96d49e9b4/1d69c/loop.png&quot;
        srcset=&quot;/static/74edeb2980782f1b9b4408b96d49e9b4/4dcb9/loop.png 188w,
/static/74edeb2980782f1b9b4408b96d49e9b4/5ff7e/loop.png 375w,
/static/74edeb2980782f1b9b4408b96d49e9b4/1d69c/loop.png 750w,
/static/74edeb2980782f1b9b4408b96d49e9b4/78797/loop.png 1125w,
/static/74edeb2980782f1b9b4408b96d49e9b4/aa440/loop.png 1500w,
/static/74edeb2980782f1b9b4408b96d49e9b4/7e318/loop.png 1892w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;其他&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%85%B6%E4%BB%96&quot; aria-label=&quot;其他 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;其他&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;除了上面的“三件小事”之外，针对项目的优化也做了不少。开发测试和项目打包巨慢，浏览器端代码的体积巨大。针对这些问题，在构建流程上做了一些优化，总结下来无非就是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;优化Webpack的编译速度。优化 Loader 配置，合理设置文件路径，增加 Cache 之类的&lt;/li&gt;
&lt;li&gt;打包拆分模块，按需加载。结合Vue的异步组件和 Webpack 的 Code Split 功能，实现路由组件的懒加载&lt;/li&gt;
&lt;li&gt;抽离公共组件，适当减低源码体积。&lt;/li&gt;
&lt;li&gt;优化压缩输出文件的体积。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F&quot; aria-label=&quot;结束 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;从18年5月开始到19年6月，差不多一年的时间一直全职在跟这个项目。上面提到的一些技术点，大方向是一开始就明确的，但是具体实现的细节是在整个项目过程中不断演进和优化的。合作过程中也认识了不少人，算是一个还不错的回忆吧&lt;/p&gt;</content:encoded></item><item><title><![CDATA[在滴滴的这几年：组件库的设计和开发]]></title><description><![CDATA[入职的时候团队加上老板就三个人，需要对接5+个公共服务团队，为公共服务开发控制台，每个团队两个控制台系统。在之前，有一些团队有一些正在运行的系统，技术栈有React, Angular和Vue，UI库有内部的 CubeUI 和外部的 AntD，场面一度十分混乱。 好在当时组织架构…]]></description><link>https://zhanglun.github.io/blogs/2020-05-05-在滴滴的这几年：组件库的设计和开发/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2020-05-05-在滴滴的这几年：组件库的设计和开发/</guid><pubDate>Tue, 05 May 2020 03:14:37 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;入职的时候团队加上老板就三个人，需要对接5+个公共服务团队，为公共服务开发控制台，每个团队两个控制台系统。在之前，有一些团队有一些正在运行的系统，技术栈有React, Angular和Vue，UI库有内部的 CubeUI 和外部的 AntD，场面一度十分混乱。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;好在当时组织架构处于建设阶段，现有的系统功能都还没有太多。乘着这个机会，团队统一了技术栈用vue。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为什么？人少，没有React专家，Angular不好招人，Vue简单，上手快，Vue招人容易。前端的技术选型确定了，后端采用自研的Nodejs的Web框架。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;前端UI也需要一个框架？为什么不用外部的，主要考虑到以下几个问题：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;开源项目有风险，出问题不能立马响应，可能会不在维护。比如公司内部的 CubeUI 和外面的 ElementUI&lt;/li&gt;
&lt;li&gt;开源的UI库往往提供的都是通用性和功能性比较强的组件，风格上比较统一。再者，设计师可能有自己的想法&lt;/li&gt;
&lt;li&gt;开源的定制性差点，可能会出现无法满足产品需求的情况，需要在这个基础上改造，有一定成本&lt;/li&gt;
&lt;li&gt;锻炼团队能力&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;刚开始我也没搞过组件库，之前只看过 BootStrap的一点代码，他们是基于 jQuery 的。我来的时候Vue也不太熟练。所以当时只能一边做一个新的系统，一边开发组件库，一边写一边用。
两个星期做出了第一版的Codis控制台系统，和第一版本的ui框架 Core 我具体是怎么做的呢？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;首先先捋了一波需求，我们要做的这个组件库到底要有什么样的能力。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;提供基础组件库，不对标 AntD或者 ElementUI，提供基础能力，能够当前系统的开发&lt;/li&gt;
&lt;li&gt;和社区的组件库一样，支持 &lt;code&gt;import&lt;/code&gt;、&lt;code&gt;require&lt;/code&gt; 和 &lt;code&gt;script&lt;/code&gt; 标签的引用&lt;/li&gt;
&lt;li&gt;支持主题色&lt;/li&gt;
&lt;li&gt;后续拓展业务组件&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;下面说一下几个比较关键的点&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Webpack的构建打包&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Webpack%E7%9A%84%E6%9E%84%E5%BB%BA%E6%89%93%E5%8C%85&quot; aria-label=&quot;Webpack的构建打包 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Webpack的构建打包&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;简单来说构建这块使用webpack来构建打包输出，约定好开发规范，包括代码风格，目录结构每个组件通过文件夹来划分，提供一个总入口文件，最后作为index.js 将组件对象引入，最后一起输出。在此基础上，利用Webpack的entry支持数组的能力，构建阶段扫描每一个组件目录，拿到index.js 单独在构建一份。这样使用的时候既可以一次性引入完整的包，也可以单个引入。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;里面有几个关键点需要注意，除了组件库最后需要暴露入使用的入口之外，我们还需要将依赖外部化。假设组件库名字叫做 &lt;code&gt;my-component&lt;/code&gt;，需要至少能提供如下使用的使用能力：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;import MyComponent from &amp;#39;my-component&amp;#39;;
Vue.use(MyComponent)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;同时在&lt;code&gt;my-component&lt;/code&gt;中不包含Vue的依赖。Webpack提供了这样的能力，总结如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用 &lt;code&gt;externals&lt;/code&gt; 选项，避免将依赖打包到应用程序，而使用者会去加载它。&lt;/li&gt;
&lt;li&gt;将 &lt;code&gt;library&lt;/code&gt; 的名称设置为 &lt;code&gt;MyComponent&lt;/code&gt; 组件名&lt;/li&gt;
&lt;li&gt;将 &lt;code&gt;library&lt;/code&gt; 暴露为一个名为 &lt;code&gt;MyComponent&lt;/code&gt; 的变量。&lt;/li&gt;
&lt;li&gt;能够访问其他 Node.js 中的 library。&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;除此之外，组件的使用还要能支持&lt;code&gt;CommonJS&lt;/code&gt;，&lt;code&gt;ES6模块&lt;/code&gt;，甚至通过&lt;code&gt;script&lt;/code&gt;标签引入。具体细节可以参考：&lt;a href=&quot;https://webpack.js.org/guides/author-libraries/&quot; class=&quot;link-underline&quot;&gt;Authoring Libraries&lt;/a&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;文档自动化&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%96%87%E6%A1%A3%E8%87%AA%E5%8A%A8%E5%8C%96&quot; aria-label=&quot;文档自动化 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;文档自动化&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;第一步算是完成了。接下来是组件文档的问题。组件的文档需要包括组件的一些基本信息，接口说明，和一些demo。第一版本中，我参考了AntD的设计，在每个组件的目录下面有一个README.md文件，文件头部使用YAML语法设置基本信息，来标记组件的一些信息，比如分类、标题和名称之类的，文件内容作为文档的内容。最后通过自己开发的一个 &lt;code&gt;vue-md-loader&lt;/code&gt;，在文档构建过程中，将md文件转换成vue组件，最后输出一个可访问的单页面应用。构建过程接入了Gitlab CI，利用持续集成的思路将文档的更新发布自动化。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;但是这个方案有一个小问题：在markdown文件中编写代码内容确实不方便，缩进不只能，IDE无法帮助识别基本的错误。随后作了一个改进：依然使用&lt;code&gt;README.md&lt;/code&gt;作为组件文档的入口，但是只保留顶部基本信息和API参数信息，正文部分增加一个插槽&lt;code&gt;&amp;#x3C;!-- demo --&gt;&lt;/code&gt;。所有的使用DEMO都放置在新增的&lt;code&gt;demo&lt;/code&gt;文件夹，在&lt;code&gt;demo&lt;/code&gt;文件夹按照demo0, demo1的顺序放置demo组件。同时对&lt;code&gt;vue-md-loader&lt;/code&gt;进行一些改造。编译文档时，将demo文件夹中的demo按照文件名顺序，插入插槽，再将md内容转换成一个vue组件。最后在页面中显示出来。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/985e863d47185ffb77dc6ad9539f2a5e/e7370/1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 47.340425531914896%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACNUlEQVQoz2WSS2sUQRSFKxrRhSD+Bjdi8A+IiiJuNK5ciAQFF+Im/yAiCBoQIgFXblxm58KVMCYkTuaRNjAQYSCJmUkG0zPT04/0TE8/qm511ZFqTTYeOItDVX33cm8xx3EYgMKlUonV63W2sWGxtbU1VqvVWGV9nS0tLTHbthnn/B2RQJIkCRGR1vo/M9d1bwK4A+Di6urqlGVZsz82N69Xq7VnlmU9rNdrNyqVyovl5W+3BMlFQRKjlORRqmCU5wpKKWiNwszzPLiuC875k1KpNNVoNOar1eq15ZWVR+X1yvROqz3bbDY/lcvfH5CU7zNOkFKSeQ9ACyF1lnKd56rILAxDsm0bcZw8tbvd+47jvAJw+eB373bXH9099EeHzmDgATgrpZyXkpBlGWVZZsAgkpD/rLUuOqQoikBEj3d3f810Op3FYRS/3tnbzfc7+2Gr1Xb2Wu3DVte/JIRYJCIIIYhzXgC5MJlAgqCUhukQvV4P8Xj8fBgM2MD13rq+/zmM4ulef/DRD8I5ABfM0qSUCwailCalddGRmZ+Rxt/MgiCo2LbdSNP0XrfnsX4Q1/32wfaw+fMKtrZZZ2tzElsfmD4G5jlULglmGRpIMwGeiWI5BdBUDgL/5Ou4R/GXo773FaPwqgo9pjOa0MAZc0ZSLuRSYDDOaT8ZQwwPkCcJZK6hlT4BToRhODH38g2z7f5pgM4DOCWVOmcgoygydyaPgZIIw1SSyzPkqQ8Rp8hSXszR6A9b2GI9O6YRJwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;component.png&quot;
        title=&quot;component.png&quot;
        src=&quot;/static/985e863d47185ffb77dc6ad9539f2a5e/1d69c/1.png&quot;
        srcset=&quot;/static/985e863d47185ffb77dc6ad9539f2a5e/4dcb9/1.png 188w,
/static/985e863d47185ffb77dc6ad9539f2a5e/5ff7e/1.png 375w,
/static/985e863d47185ffb77dc6ad9539f2a5e/1d69c/1.png 750w,
/static/985e863d47185ffb77dc6ad9539f2a5e/78797/1.png 1125w,
/static/985e863d47185ffb77dc6ad9539f2a5e/aa440/1.png 1500w,
/static/985e863d47185ffb77dc6ad9539f2a5e/e7370/1.png 3310w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;主题色&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BB%E9%A2%98%E8%89%B2&quot; aria-label=&quot;主题色 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;主题色&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;我们当时做这个组件库是为了支持团队工作的，每个 PaaS 服务会有两个系统，一个面向用户，一个面向服务方。两种系统采用了两种颜色风格，用户侧黑色，服务方侧绿色。这里我采用的比较简单直接的方案，定了一两个变量，通过不同命令打包构建。就两个颜色，这样挺快&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;自动化&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%8A%A8%E5%8C%96&quot; aria-label=&quot;自动化 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自动化&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;提供了几个命令来简化开发流程和提高协作效率。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ea2266727153ca43a249eb41b62e2cb1/37f12/2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 35.1063829787234%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAACQklEQVQozwE3Asj9APDv7wDu6egG8fT1KObs8Vns7fdT86FqG++gcBjo8/oc6ejnNufn5x/m5uYA5+fkAvj58QDX29Qb4OTcMzlASZY6QEnFNz1HuywzPXsvLzsAAGNjYwXU09My6Onpqdzc35Pi5/SV7IpMa+mHS1zk7fOL5+blyObm5ivq6ekA5+noBAU5RgG7xb4Y2NrUJv///wA6PkhSPUFLpDQ4QpQsLzuBAOfn53Hj5ORf6+joX51bRhjY4PFH56R6YOzGrpLs9Pli7ezra83OzgDx8fEAusfIANvh4ACtt60M1dbRLP///xZER1CCNDZB/y0uOfIsLjn/ANra2gnOzc8U3+HeKejo+Cbt9v8g69nOhe3i28Hw9fg07u3tK+rq6i7m5uYex9HRPMXQ0Gy/ycZC2d3XRNTa1Dy/xMRXys7Qkc/T1IeJkZUvAOfn5wD///8F5OTjO+Pd5SLo/P8W6oFAMN6GUCTg6/FO5OLhS9fX10fh4eFAxtHRLcfR0V2IoKIVxs/KAODi3wDt7Ox78/P0//////////8vAObm5mbe3t5R6enpS9LRzRv///8AmGZICel/PUTjvaUk6OvtWu3s7DTl5eUAr8DBAODl4wC7xL4e1tvXUs/X0TfZ29t44+Xn6fT29tXc4eEvAOzs7Dbp6ekt7e3tMOLh4RL///8A1odVB/OJSCHs1MQR7/HyOPDw7yX///8A6OrlBP//9gDQ1c5X29/Z0Nvf2cLU2dFKED0+C0VnZhEWQUAKc5lokf/mgzUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;2.png&quot;
        title=&quot;2.png&quot;
        src=&quot;/static/ea2266727153ca43a249eb41b62e2cb1/1d69c/2.png&quot;
        srcset=&quot;/static/ea2266727153ca43a249eb41b62e2cb1/4dcb9/2.png 188w,
/static/ea2266727153ca43a249eb41b62e2cb1/5ff7e/2.png 375w,
/static/ea2266727153ca43a249eb41b62e2cb1/1d69c/2.png 750w,
/static/ea2266727153ca43a249eb41b62e2cb1/78797/2.png 1125w,
/static/ea2266727153ca43a249eb41b62e2cb1/aa440/2.png 1500w,
/static/ea2266727153ca43a249eb41b62e2cb1/37f12/2.png 3750w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1b1d412ed962a881c9538c118584d027/37a83/3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.765957446808514%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB0UlEQVQoz22Sz0tUURTHDwy0dhcSBILie6NSjcyMNCUqhEJE/0WUI0G5E6JFi2oVJEMugpwWERW6lWjRooJ+WClKBEFgvpl5w7OZ61zffTPvnnvkvPdEFx743ns258P3e+6FCxenwsLoVJjNT4TnhkdDeyAfWHaW7HTuHgAAEcHO/8a1RlNQoymECgJpjJGIeFQtRGwj4l8oXLpK2YkrdDY3TumhEbIG82Slc2TZ2UcAqQjYbIribktSGGpENGQMkTEmUdJTdNfhzNjk/FBhvGQPny/1Z/LzVmbkcf9g7mlvX+YywIkI6Cs1rYKAB8J4Lq6DnoiQT0RT44FZMmaWiG6iDu8Q0QwR3RZCzDmVyl3P8+5LKR/6viKMy7BLRCStNXFprTFxXIO1jc3u1Z9r3d++/zj5/sPH05++fD318tWbntKThd7F8vO+10vLXXu+P8cOtUbNjhjGYkjSY9LXwNvxoF53wXVdqDhOFPHP71/w7u0K3CpeByEESLlXZCAiRpF5WuuIbWKWOYwcgapV2HYccGvVCLi++hlelJ/Bv62t1G5LMnA6iawPHoDjsjs6XCov0uWfAQ8WysdKKZUKgoDvG+1OhyEKETvHqB3vFLf3AXkU7bZ2MV1bAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;3.png&quot;
        title=&quot;3.png&quot;
        src=&quot;/static/1b1d412ed962a881c9538c118584d027/1d69c/3.png&quot;
        srcset=&quot;/static/1b1d412ed962a881c9538c118584d027/4dcb9/3.png 188w,
/static/1b1d412ed962a881c9538c118584d027/5ff7e/3.png 375w,
/static/1b1d412ed962a881c9538c118584d027/1d69c/3.png 750w,
/static/1b1d412ed962a881c9538c118584d027/78797/3.png 1125w,
/static/1b1d412ed962a881c9538c118584d027/aa440/3.png 1500w,
/static/1b1d412ed962a881c9538c118584d027/37a83/3.png 3466w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[使用 CSS variables 实现主题色切换]]></title><description><![CDATA[最近在写自己的小项目时，想试试 CSS variables，于是便有了此文。 之前也使用过 Sass，Less 之类的预处理器。因为 node-sass 的安装和编译频繁出现失败的问题，所以一直都是 Less 用的比较多。当我回想日常使用Less的经历时，却发现似乎除了变量，嵌…]]></description><link>https://zhanglun.github.io/blogs/2020-03-21-使用 CSS Variable 实现主题色切换/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2020-03-21-使用 CSS Variable 实现主题色切换/</guid><pubDate>Sat, 21 Mar 2020 02:33:56 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;最近在写自己的小项目时，想试试 CSS variables，于是便有了此文。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;之前也使用过 Sass，Less 之类的预处理器。因为 node-sass 的安装和编译频繁出现失败的问题，所以一直都是 Less 用的比较多。当我回想日常使用Less的经历时，却发现似乎除了变量，嵌套和函数这三个特性，其他功能基本上没有太多使用。这不由得让我陷入了思考：我在自己的项目中是否还需要使用预处理器？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在我的日常使用习惯中，变量主要是为了解决重复地显式书写变量名或者值，降低设计修改带来的维护成本。而嵌套和函数的使用则主要是为了服务 &lt;a href=&quot;http://getbem.com/introduction/&quot; class=&quot;link-underline&quot;&gt;BEM&lt;/a&gt; 规范的，自动编译出长长的 ClassName。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;使用 &lt;code&gt;CSS Module&lt;/code&gt; 的方案，可以实现类似BEM规范的精髓，使用 &lt;code&gt;CSS custom properties&lt;/code&gt; 提供变量的能力。二者结合使用原生CSS就能满足我的需求，无需额外的工具。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;CSS Module&lt;/code&gt; 也具备类似预处理器的声明变量的能力，但是它的语法在 &lt;code&gt;.css&lt;/code&gt; 文件中是不支持的，在我看来算是一种侵入式拓展，至于预处理器提供的 loop、condition 等能力，我相信未来的 CSS 也会支持。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;CSS 变量(CSS variables)&lt;/strong&gt; 是 &lt;strong&gt;CSS自定义属性的(CSS custom properties)&lt;strong&gt;的别称，有时候也会称之为&lt;/strong&gt;级联变量(cascading variabels)&lt;/strong&gt;。使用规定的语法定义和获取变量的值&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;基本用法&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95&quot; aria-label=&quot;基本用法 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;基本用法&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;使用&lt;code&gt;--&lt;/code&gt;作为属性名的前缀，属性值可以是任何有效的CSS值。比如&lt;code&gt;--main-bg-color&lt;/code&gt;，然后通过&lt;code&gt;var()&lt;/code&gt;来获取对应的属性值。不过要注意的是，自定义属性名是大小写敏感的。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;element {
  --main-bg-color: brown;
  background-color: var(--main-bg-color);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;同时要清楚的明白：自定义属性也只是属性，仅用于匹配当前选择器及其子孙，这和通常的CSS是一样的。所以我觉得叫做&lt;code&gt;CSS变量&lt;/code&gt;还是没有&lt;code&gt;CSS自定义属性&lt;/code&gt;更加贴切。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;作用域&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%9C%E7%94%A8%E5%9F%9F&quot; aria-label=&quot;作用域 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;作用域&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;JavaScript 中变量是有作用域的，要么是全局作用域，要么就是局部作用域。CSS 变量亦是如此。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在CSS变量中，&lt;code&gt;:root&lt;/code&gt; 选择器允许你定位到 DOM 中的最顶级元素或文档树。这种方式声明的变量就属于具有全局作用域的变量。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;:root {
  --main-color: red;
}

.a {
  color: var(--main-color);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;可以在选择器中，声明相同的自定义属性&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;:root {
  --main-color: red;
}

.a {
  --main-color: green;
  color: var(--main-color);  //最后是 color: green;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;继承&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%A7%E6%89%BF&quot; aria-label=&quot;继承 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;继承&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;同普通的 CSS 属性一样，自定义属性也会被继承，如果在一个给定的元素上，没有为这个自定义属性设置值，在其父元素上的值会被使用。看一下下面的例子&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;div {
  --color: red;
}

div.test {
  color: var(--color)
}

div.ew {
  color: var(--color)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;.test&lt;/code&gt;和&lt;code&gt;.ew&lt;/code&gt; 都会继承来自&lt;code&gt;div&lt;/code&gt;的&lt;code&gt;--color&lt;/code&gt;。甚至可以在HTML的style标签来设置。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;!--HTML--&amp;gt;
&amp;lt;html style=&amp;quot;--color: red&amp;quot;&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;body {
  color: var(--color)；
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;有效值&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9C%89%E6%95%88%E5%80%BC&quot; aria-label=&quot;有效值 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;有效值&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在普通的 CSS 属性中，如果属性值是非法值，将会被忽略，如果有继承值，则使用继承值。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 614px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a22b5370a77c5f9a37c177348af51ccc/9453e/Xnip2020-10-05_12-48-44.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 44.148936170212764%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAQACBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe3pQmP/xAAVEAEBAAAAAAAAAAAAAAAAAAAQQf/aAAgBAQABBQJp/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhABAQEAAAAAAAAAAAAAAAAAMRAg/9oACAEBAAY/AmGP/8QAGRAAAgMBAAAAAAAAAAAAAAAAABEBICFR/9oACAEBAAE/IVDGcZlD/9oADAMBAAIAAwAAABBUz//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/EGf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAABBAMBAAAAAAAAAAAAAAARAAEhURAxQZH/2gAIAQEAAT8QaFvTNKFpdCFni4z/AP/Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Xnip2020-10-05_12-48-44.jpg&quot;
        title=&quot;Xnip2020-10-05_12-48-44.jpg&quot;
        src=&quot;/static/a22b5370a77c5f9a37c177348af51ccc/9453e/Xnip2020-10-05_12-48-44.jpg&quot;
        srcset=&quot;/static/a22b5370a77c5f9a37c177348af51ccc/bc01b/Xnip2020-10-05_12-48-44.jpg 188w,
/static/a22b5370a77c5f9a37c177348af51ccc/bf173/Xnip2020-10-05_12-48-44.jpg 375w,
/static/a22b5370a77c5f9a37c177348af51ccc/9453e/Xnip2020-10-05_12-48-44.jpg 614w&quot;
        sizes=&quot;(max-width: 614px) 100vw, 614px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当自定义属性值被解析，浏览器不知道它们什么时候会被使用，所以必须认为这些值都是有效的。但是无效的var()会使用继承值或者初始值代替。在Chrome的调试工具中可以看到，即使是无效的var(), 也不会出现被划去的横线&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 612px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b1478f267e2644ee982de2ecfbe05f07/a18e1/Xnip2020-10-05_12-54-59.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 28.191489361702125%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3aFB/8QAFRABAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQEAAQUCj//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABgQAAMBAQAAAAAAAAAAAAAAAAABEVEx/9oACAEBAAE/IaXCaiLD/9oADAMBAAIAAwAAABBwD//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/EGf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEAAQUAAAAAAAAAAAAAAAABACFBYYGx/9oACAEBAAE/ECwG2BSh2Yk//9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Xnip2020-10-05_12-54-59.jpg&quot;
        title=&quot;Xnip2020-10-05_12-54-59.jpg&quot;
        src=&quot;/static/b1478f267e2644ee982de2ecfbe05f07/a18e1/Xnip2020-10-05_12-54-59.jpg&quot;
        srcset=&quot;/static/b1478f267e2644ee982de2ecfbe05f07/bc01b/Xnip2020-10-05_12-54-59.jpg 188w,
/static/b1478f267e2644ee982de2ecfbe05f07/bf173/Xnip2020-10-05_12-54-59.jpg 375w,
/static/b1478f267e2644ee982de2ecfbe05f07/a18e1/Xnip2020-10-05_12-54-59.jpg 612w&quot;
        sizes=&quot;(max-width: 612px) 100vw, 612px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;来看一下下面这个例子&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;:root { --text-color: 16px; } 
p { color: blue; } 
p { color: var(--text-color); }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;浏览器将 &lt;code&gt;--text-color&lt;/code&gt; 的值替换给了 &lt;code&gt;var(--text-color)&lt;/code&gt;，但是 &lt;code&gt;16px&lt;/code&gt; 并不是 &lt;code&gt;color&lt;/code&gt; 的合法属性值。代换之后，该属性不会产生任何作用。浏览器会执行如下两个步骤：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;检查属性 &lt;code&gt;color&lt;/code&gt; 是否为继承属性。是，但是 &lt;p&gt; 没有任何父元素定义了 color 属性。转到2。&lt;/li&gt;
&lt;li&gt;将该值设置为它的默认初始值，浏览器中 &lt;code&gt;color&lt;/code&gt;的默认值是 &lt;code&gt;black&lt;/code&gt;。&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;从这里也可以看出来区别于预处理器的编译，&lt;code&gt;CSS custom properties&lt;/code&gt; 属于运行时。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;通过-JavaScript-操作自定义属性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%80%9A%E8%BF%87-JavaScript-%E6%93%8D%E4%BD%9C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B1%9E%E6%80%A7&quot; aria-label=&quot;通过 JavaScript 操作自定义属性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;通过 JavaScript 操作自定义属性&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在这里你会发现，通过JavaScript操作自定义属性和操作CSS样式根本就是一回事。这样再次表名，这的确就是“自定义CSS属性”。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// 获取一个 Dom 节点上的 CSS 变量
element.style.getPropertyValue(&amp;quot;--my-var&amp;quot;);

// 获取任意 Dom 节点上的 CSS 变量
getComputedStyle(element).getPropertyValue(&amp;quot;--my-var&amp;quot;);

// 修改一个 Dom 节点上的 CSS 变量
element.style.setProperty(&amp;quot;--my-var&amp;quot;, jsVar + 4);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;实现主题色&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%9E%E7%8E%B0%E4%B8%BB%E9%A2%98%E8%89%B2&quot; aria-label=&quot;实现主题色 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;实现主题色&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;通过简单的代码实例来阐述说明主题色实现的方式。demo来自&lt;a href=&quot;https://www.sitepoint.com/css-theming-custom-properties-javascript/&quot; class=&quot;link-underline&quot;&gt;Advanced CSS Theming with Custom Properties and JavaScript&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;首先在全局下定义自定义属性&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;:root {
  --main-hue: 350;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;然后定义页面样式&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;nav{
  background: hsl(var(--main-hue) , 50%, 50%);
  padding: 1.3rem;
  color: hsl(var(--main-hue), 50%, 10%);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果要指定除红色以外的其他颜色，则只需将相应的值指定给 —main-hue 即可。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;:root{
  --red-hue: 360;
  --blue-hue: 240;
  --green-hue: 120;
  --main-hue : var(--red-hue);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;为红色，蓝色和绿色定义了三个自定义属性，然后将 &lt;code&gt;--red-hue&lt;/code&gt; 变量分配给 &lt;code&gt;--main-hue&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/10b850ec6128d6e2c08992b164ce38e0/90712/1535599018different-themes.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 57.97872340425532%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAB3UlEQVQoz2XO626iQBTAcR6savum4htU94OXSivaVRtuwzQCIoiAXGZUrnLbfthQa9d0k19OTk7yzwzRGjYfqPtbd81RozG+b01uDe8ao0brpflwiyCNDml02rv2P6ROdrZtUr9h6CT5P0LeSfbBQpV/hT0nVCTLtg4YZ98CxzVX8sGycoy/EYPpgFo+L+CCZmnV03CJNdXv96djajmfv08mrKb6B5R5G50eDJbUGCyW7GTqbfQCHQnq99OMf8Xl8Vh8sXfxeDSfTgFGFUbVARUHVATWfv404uhZgXGFcIGOdQwjEUaiEILL4ub+zshFEEExBkIoiBGAsevmZ8OKAIzgeygIoQhDEZau9xVfejVR/RJZZgbFGMIQwpAH4VpNPD9LTTMUQQTApU/UdeEigg8EPuT4QPiOjW3GCYHAR58zUJQYoTzdbgNeuOJiRSl9n2ACljuxfCAwAXv99vmNObFMXbJMIILIcbKzYZwY5sQwEcfVE8Bi7xJSvJITWU1UOZG18xYVaG+XkhQrSrpWE1lONlqKvTKz9vFqlSpKoq4TSUo1vX7ZKu0fbPPjqvpUL7llleZPRNfp9tzHl5Sa/ZldDPvH3qPzq+c9j9NX+uPiOOjb9bWbUlQ1oy/+An+DTrPcVCdLAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;1535599018different-themes.png&quot;
        title=&quot;1535599018different-themes.png&quot;
        src=&quot;/static/10b850ec6128d6e2c08992b164ce38e0/1d69c/1535599018different-themes.png&quot;
        srcset=&quot;/static/10b850ec6128d6e2c08992b164ce38e0/4dcb9/1535599018different-themes.png 188w,
/static/10b850ec6128d6e2c08992b164ce38e0/5ff7e/1535599018different-themes.png 375w,
/static/10b850ec6128d6e2c08992b164ce38e0/1d69c/1535599018different-themes.png 750w,
/static/10b850ec6128d6e2c08992b164ce38e0/90712/1535599018different-themes.png 882w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;只需要通过一小段代码就可以动态修改主题色&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;document.documentElement.style.setProperty(&amp;#39;--main-hue&amp;#39;, 240);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;实现暗黑模式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%9E%E7%8E%B0%E6%9A%97%E9%BB%91%E6%A8%A1%E5%BC%8F&quot; aria-label=&quot;实现暗黑模式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;实现暗黑模式&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;通过这种方式，可以很方便实现现在很流行的暗黑模式。利用作用域特性，定义全局变量和局部变量，默认是浅色模式&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;:root {
  --links: #ee9ca7;
  --text: #333;
  --background-color: #fff;
}

.darkmode {
  --text: #fff;
  --links: #66e387;
  --background-color: #333;
}

body {
  font-size: 1.2rem;
  background: var(--background-color);
  color: var(--text);
}

a {
  color: var(--links);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;通过 JavaSctipt 来控制 ClassName，下面是伪代码，假设有一个触发操作的按钮&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;ts&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const button: HTMLButtonElement = document.querySelector(&amp;quot;.color-switch&amp;quot;);
button.addEventListener(&amp;quot;click&amp;quot;, function() {
  const body: HTMLBodyElement = document.querySelector(&amp;quot;body&amp;quot;);
  
  body.classList.toggle(&amp;quot;darkmode&amp;quot;);
  if (button) {
    button.innerText = body.classList.contains(&amp;quot;lightmode&amp;quot;) ? &amp;quot;Dark&amp;quot; : &amp;quot;Light&amp;quot;;
  }
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;兼容性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%85%BC%E5%AE%B9%E6%80%A7&quot; aria-label=&quot;兼容性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;兼容性&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;浏览器支持性非常好，基本所有的现代浏览器都支持良好（本文写作时已超过 95.29%）&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/78d14d5d372cdef2d1cfa0e9343c04a7/5f298/Xnip2020-10-05_13-09-19.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 30.851063829787233%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIDBP/EABYBAQEBAAAAAAAAAAAAAAAAAAEAA//aAAwDAQACEAMQAAAB23GbIN//xAAXEAADAQAAAAAAAAAAAAAAAAAAARIT/9oACAEBAAEFAtHVlH//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAVEAEBAAAAAAAAAAAAAAAAAAAREP/aAAgBAQAGPwIL/8QAGRAAAgMBAAAAAAAAAAAAAAAAAAERIUGR/9oACAEBAAE/IWqBem6FPD//2gAMAwEAAgADAAAAEIAP/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARIf/aAAgBAwEBPxDXsuN//8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAECAQE/EBbb/8QAGhABAAMAAwAAAAAAAAAAAAAAAQARITFhof/aAAgBAQABPxC1Q3iv3JdKbOO4QuP/2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Xnip2020-10-05_13-09-19.jpg&quot;
        title=&quot;Xnip2020-10-05_13-09-19.jpg&quot;
        src=&quot;/static/78d14d5d372cdef2d1cfa0e9343c04a7/acb04/Xnip2020-10-05_13-09-19.jpg&quot;
        srcset=&quot;/static/78d14d5d372cdef2d1cfa0e9343c04a7/bc01b/Xnip2020-10-05_13-09-19.jpg 188w,
/static/78d14d5d372cdef2d1cfa0e9343c04a7/bf173/Xnip2020-10-05_13-09-19.jpg 375w,
/static/78d14d5d372cdef2d1cfa0e9343c04a7/acb04/Xnip2020-10-05_13-09-19.jpg 750w,
/static/78d14d5d372cdef2d1cfa0e9343c04a7/ec605/Xnip2020-10-05_13-09-19.jpg 1125w,
/static/78d14d5d372cdef2d1cfa0e9343c04a7/c58a3/Xnip2020-10-05_13-09-19.jpg 1500w,
/static/78d14d5d372cdef2d1cfa0e9343c04a7/5f298/Xnip2020-10-05_13-09-19.jpg 2742w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;总结&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%80%BB%E7%BB%93&quot; aria-label=&quot;总结 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;总结&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;下面开始技术总结&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;CSS custom properties&lt;/code&gt; 允许开发人员自定义CSS属性及对应的属性值&lt;/li&gt;
&lt;li&gt;自定义属性有作用域之分，&lt;code&gt;：root&lt;/code&gt;可以定义全局范围的自定义属性，在选择器内部的自定义属性只能子元素下作用&lt;/li&gt;
&lt;li&gt;自定义属性也遵循CSS属性的继承和级联规则&lt;/li&gt;
&lt;li&gt;如果自定义属性的值无效，将会使用继承值或者默认值&lt;/li&gt;
&lt;li&gt;可以用JavaSctript操作自定义属性，就像操作CSS原生属性一样&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[为Promise增加abort方法]]></title><description><![CDATA[对于Promise而言只有三个状态： Pending， Resolve 和 Reject。在任意时刻，一个Promise只能是处于这三个状态中的任意一个，且一旦状态变为Resolve或者Reject之后，状态不能再修改。
有时候我们需要在Promsie从Pending状态变成R…]]></description><link>https://zhanglun.github.io/blogs/2020-01-16-为Promise增加abort方法/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2020-01-16-为Promise增加abort方法/</guid><pubDate>Thu, 16 Jan 2020 11:50:24 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;对于Promise而言只有三个状态： &lt;code&gt;Pending&lt;/code&gt;， &lt;code&gt;Resolve&lt;/code&gt; 和 &lt;code&gt;Reject&lt;/code&gt;。在任意时刻，一个Promise只能是处于这三个状态中的任意一个，且一旦状态变为&lt;code&gt;Resolve&lt;/code&gt;或者&lt;code&gt;Reject&lt;/code&gt;之后，状态不能再修改。
有时候我们需要在Promsie从Pending状态变成&lt;code&gt;Resolve&lt;/code&gt;或者&lt;code&gt;Reject&lt;/code&gt;之前，停止执行对应的Promsie。就像是将Promise的状态修改为&lt;code&gt;Stop&lt;/code&gt;或者&lt;code&gt;Abort&lt;/code&gt;。常见的例子：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;发送异步请求时，在请求返回之前直接结束当前任务的逻辑&lt;/li&gt;
&lt;li&gt;多个任务并发时，停止执行未处理完成的任务&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;既然Promise不支持，那我们能否通过其提供的接口来实现一个&lt;code&gt;Abort&lt;/code&gt;方法呢？可以使用&lt;code&gt;Promise.race&lt;/code&gt;方法的特点来模拟实现。&lt;code&gt;Promise.race(iterable)&lt;/code&gt; 方法返回一个 promise，一旦迭代器中的某个promise解决或拒绝，返回的 promise就会解决或拒绝。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const promise1 = new Promise((resolve, reject) =&amp;gt; {
  setTimeout(resolve, 500, &amp;#39;one&amp;#39;);
});

const promise2 = new Promise((resolve, reject) =&amp;gt; {
  setTimeout(resolve, 100, &amp;#39;two&amp;#39;);
});

Promise.race([promise1, promise2]).then((value) =&amp;gt; {
  console.log(value);
  // Both resolve, but promise2 is faster
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;可以使用&lt;code&gt;Promise.race()&lt;/code&gt;来构造一个“竞争关系”，将想abort的Promise和一个内置的Promise，放在race中执行，而内置的Promsie立马返回 &lt;code&gt;Resovled&lt;/code&gt; 或者 &lt;code&gt;Reject&lt;/code&gt; ，从而将另外一个Pomise的执行停止。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let PromiseWithAbort = function(promise){
  let _abort = null;
  let Pabort = new Promise((resolved, reject)=&amp;gt;{
    _abort = function(reason =&amp;#39;abort !&amp;#39;){
      console.warn(reason);
      reject(reason);
    }
  });

  let race = Promise.race([promise, Pabort]);
  
  race.abort = _abort;
  console.log(promise, Pabort);

  return race;
}

let p1= new Promise(res=&amp;gt;{
  setTimeout(()=&amp;gt;{
    res(&amp;#39;p1 success&amp;#39;);
  },2000)
})

let testP = PromiseWithAbort(p1);

testP.then(res=&amp;gt;{
  console.log(&amp;#39;success:&amp;#39;, res);
},error=&amp;gt;{
  console.log(&amp;#39;error:&amp;#39;, error);
})

testP.abort();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;或者重新包装一个新的Promise&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;class PromiseWithAbort {
  constructor(fn){
    let _abort = null;
    let _p = new Promise((resolved, reject)=&amp;gt;{
      fn.call(null,resolved, reject);
      _abort = function(error = &amp;#39;abort&amp;#39;){ 
        reject(error); 
      }
    })

    _p.abort = _abort;

    return _p;
  }
}

let testP = new PromiseWithAbort((resolved, reject)=&amp;gt;{
  setTimeout(() =&amp;gt; {
    res(1);
  },1000);
});

testP.then( (resolved)=&amp;gt;{
  console.log(&amp;#39;resolved:&amp;#39;, resolved);
}, (reject) =&amp;gt;{
  console.log(&amp;#39;reject:&amp;#39;, reject);
});

testP.abort();
//结果： rej: abort&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[浅谈TreeShaking在前端中的应用 - Rollup VS Webpack]]></title><description><![CDATA[前言 Tree Shaking是一种死码清除(dead code elimination)技术，通常用于在ECMAScript方言比如Dart，JavaScript或者TypeScript打包成一个文件时，移除未使用的代码以此来优化代码。 在动态语言中实现 Dead code …]]></description><link>https://zhanglun.github.io/blogs/浅谈TreeShaking在前端中的应用/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/浅谈TreeShaking在前端中的应用/</guid><pubDate>Thu, 14 Nov 2019 13:50:12 GMT</pubDate><content:encoded>&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;前言&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%89%8D%E8%A8%80&quot; aria-label=&quot;前言 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;前言&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;Tree Shaking&lt;/code&gt;是一种死码清除(dead code elimination)技术，通常用于在ECMAScript方言比如Dart，JavaScript或者TypeScript打包成一个文件时，移除未使用的代码以此来优化代码。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在动态语言中实现 &lt;code&gt;Dead code elimination&lt;/code&gt; 要比在静态语言中实现难的多。&lt;code&gt;treeshaker&lt;/code&gt; 这个概念最早在起源于1990年，来自LISP语言。这个技术主要核心点是，将程序中所有可能执行到的流用一个树形结构的函数调用来表示，这样那些从来不会调用的函数就可以清理&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在2012年的时候，Google 的 Bob Nystrom 开发的 closure compiler 就实现了这个算法，并应用在 Dart 的 dart2js compiler中。在Dart代码编译成JavaScript的过程中，编译器会做&lt;code&gt;tree shaking&lt;/code&gt;。在JavaScript中，有时候就算你只使用了库中的一个函数，你也不得不将整个库引入到项目中，最后输出的文件会包含很多用不上的代码，体积大很多。而&lt;code&gt;tree shaking&lt;/code&gt;技术就可以让输出的代码只包含你需要的函数。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;2015年的时候 Rollup推出了 &lt;code&gt;Tree Shaking&lt;/code&gt; 功能，将这个概念真正带到了前端圈子中，随后 Webpack2 跟进也实现了 &lt;code&gt;Tree Shaking&lt;/code&gt;，并在Webpack4中升级改进了方案&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;TreeShaking-的基本原理&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#TreeShaking-%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86&quot; aria-label=&quot;TreeShaking 的基本原理 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;TreeShaking 的基本原理&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在编译器原理中，死码消除（Dead code elimination）是一种编译最佳化（Optimizing compiler）技术，它的用途是移除对程序执行结果没有任何影响的代码。移除这类代码可以减少程序的大小，避免执行过程中出现程序出现不相关的运算行为。无法执行的代码(unreachable code)， 执行结果不会被使用的代码和只会影响死变量（只写不读）的代码都属于 &lt;code&gt;Dead code&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;对于JavaScript这种动态语言来说，TreeShaking的实现原本是一件相对较困难的事情。为何从Rollup开始能把这种技术带去前端圈子呢？因为ES6的模块特性。较早提出的CommonJS, AMD等规范都是动态的，模块的导入导出可以在运行时动态的变化。同时对于模块来说都是一个个对象，无论他们导出什么，都可以通过属性的方式来访问，比如:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const a = require(`./${file}.js/`) // 可以动态加载模块
const { stat, exists, readFile } = require(&amp;#39;fs&amp;#39;) // 解构导出的对象
var my_lib;
if (Math.random()) {
    my_lib = require(&amp;#39;foo&amp;#39;);
} else {
    my_lib = require(&amp;#39;bar&amp;#39;);
}

if (Math.random()) {
    exports.baz = ···;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;而ES6中的模块特性不同，它实现静态模块结构。在编译时就要确定导入和导出的内容，不允许在运行时发生变化。而正是这静态类型的特性，与 &lt;code&gt;Treeshaking&lt;/code&gt; 无比契合。传统编译型的语言中，都是由编译器将 &lt;code&gt;Dead Code&lt;/code&gt; 从 AST（抽象语法树）中删除。而在JavaScript中使用 &lt;code&gt;Rollup&lt;/code&gt; 和 &lt;code&gt;Webpack&lt;/code&gt; 都可以完成了这个任务。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Rollup&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Rollup&quot; aria-label=&quot;Rollup permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Rollup&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在 Rollup 中默认是启用treeshaking的。配置项中的 &lt;code&gt;treeshake&lt;/code&gt; 默认为 &lt;code&gt;true&lt;/code&gt;。包含其他一些选项，可按需配置。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;ts&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// src/rollup/typed.d.ts
export interface NormalizedInputOptions {
  acorn: Object;
  acornInjectPlugins: Function[];
  cache: false | undefined | RollupCache;
  context: string;
  experimentalCacheExpiry: number;
  external: IsExternal;
  /** @deprecated Use the &amp;quot;inlineDynamicImports&amp;quot; output option instead. */
  inlineDynamicImports: boolean | undefined;
  input: string[] | { [entryAlias: string]: string };
  /** @deprecated Use the &amp;quot;manualChunks&amp;quot; output option instead. */
  manualChunks: ManualChunksOption | undefined;
  moduleContext: (id: string) =&amp;gt; string;
  onwarn: WarningHandler;
  perf: boolean;
  plugins: Plugin[];
  preserveEntrySignatures: PreserveEntrySignaturesOption;
  /** @deprecated Use the &amp;quot;preserveModules&amp;quot; output option instead. */
  preserveModules: boolean | undefined;
  preserveSymlinks: boolean;
  shimMissingExports: boolean;
  strictDeprecations: boolean;
  treeshake: false | NormalizedTreeshakingOptions;
}

export interface NormalizedTreeshakingOptions {
  annotations: boolean;
  moduleSideEffects: HasModuleSideEffects;
  propertyReadSideEffects: boolean;
  tryCatchDeoptimization: boolean;
  unknownGlobalSideEffects: boolean;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;tresshake&lt;/code&gt;这个参数主要影响两个地方：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;编译启动阶段&lt;code&gt;Graph&lt;/code&gt;执行&lt;code&gt;build&lt;/code&gt;方法时，过滤掉相应的Module，为剩余的Module创建AST的上下文&lt;/li&gt;
&lt;li&gt;编译过程会将&lt;code&gt;Module&lt;/code&gt;中&lt;code&gt;getDependenciesToBeIncluded&lt;/code&gt;方法返回的模块用作后续的chunk&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;在Rollup的源码：&lt;code&gt;src/Graph.ts&lt;/code&gt;中有一个&lt;code&gt;includeStatements&lt;/code&gt;方法。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;src/Graph.ts&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;ts&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;export default class Graph {
  ...
  async build(): Promise&amp;lt;void&amp;gt; {
    timeStart(&amp;#39;generate module graph&amp;#39;, 2);
    await this.generateModuleGraph();
    timeEnd(&amp;#39;generate module graph&amp;#39;, 2);

    timeStart(&amp;#39;sort modules&amp;#39;, 2);
    this.phase = BuildPhase.ANALYSE;
    this.sortModules();
    timeEnd(&amp;#39;sort modules&amp;#39;, 2);

    timeStart(&amp;#39;mark included statements&amp;#39;, 2);
    this.includeStatements();
    timeEnd(&amp;#39;mark included statements&amp;#39;, 2);

    this.phase = BuildPhase.GENERATE;
  }
  ...
  private includeStatements() {
    for (const module of [...this.entryModules, ...this.implicitEntryModules]) {
      if (module.preserveSignature !== false) {
        module.includeAllExports();
      } else {
        markModuleAndImpureDependenciesAsExecuted(module);
      }
    }
    if (this.options.treeshake) {
      let treeshakingPass = 1;
      do {
        timeStart(`treeshaking pass ${treeshakingPass}`, 3);
        this.needsTreeshakingPass = false;
        for (const module of this.modules) {
          if (module.isExecuted) module.include();
        }
        timeEnd(`treeshaking pass ${treeshakingPass++}`, 3);
      } while (this.needsTreeshakingPass);
    } else {
      for (const module of this.modules) module.includeAllInBundle();
    }
    for (const externalModule of this.externalModules) externalModule.warnUnusedImports();
    for (const module of this.implicitEntryModules) {
      for (const dependant of module.implicitlyLoadedAfter) {
        if (!(dependant.isEntryPoint || dependant.isIncluded())) {
          error(errImplicitDependantIsNotIncluded(dependant));
        }
      }
    }
  }
  ...
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在 &lt;code&gt;if&lt;/code&gt; 代码块中的 &lt;code&gt;module.include()&lt;/code&gt; 和 &lt;code&gt;module.includeAllInBundle()&lt;/code&gt; 做的事情很简单，就是&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;ts&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;export default class Module {
  ...
  includeAllInBundle() {
  this.ast.include(createInclusionContext(), true);
  }
  ...
  include(): void {
  const context = createInclusionContext();
  if (this.ast.shouldBeIncluded(context)) this.ast.include(context, false);
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在Rollup的源码：&lt;code&gt;src/Module.ts&lt;/code&gt;中有一个&lt;code&gt;getDependenciesToBeIncluded&lt;/code&gt;方法，这个方法返回最后code split 时需要使用的 module。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;src/Module.ts&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;ts&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;export default class Module {
  ...
  getDependenciesToBeIncluded(): Set&amp;lt;Module | ExternalModule&amp;gt; {
    if (this.relevantDependencies) return this.relevantDependencies;
    const relevantDependencies = new Set&amp;lt;Module | ExternalModule&amp;gt;();
    const additionalSideEffectModules = new Set&amp;lt;Module&amp;gt;();
    const possibleDependencies = new Set(this.dependencies);
    let dependencyVariables = this.imports;
    if (this.isEntryPoint || this.includedDynamicImporters.length &amp;gt; 0 || this.namespace.included) {
      dependencyVariables = new Set(dependencyVariables);
      for (const exportName of [...this.getReexports(), ...this.getExports()]) {
        dependencyVariables.add(this.getVariableForExportName(exportName));
      }
    }
    for (let variable of dependencyVariables) {
      if (variable instanceof SyntheticNamedExportVariable) {
        variable = variable.getBaseVariable();
      } else if (variable instanceof ExportDefaultVariable) {
        const { modules, original } = variable.getOriginalVariableAndDeclarationModules();
        variable = original;
        for (const module of modules) {
          additionalSideEffectModules.add(module);
          possibleDependencies.add(module);
        }
      }
      relevantDependencies.add(variable.module!);
    }
    if (this.options.treeshake) {
      for (const dependency of possibleDependencies) {
        if (
          !(
            dependency.moduleSideEffects || additionalSideEffectModules.has(dependency as Module)
          ) ||
          relevantDependencies.has(dependency)
        ) {
          continue;
        }
        if (dependency instanceof ExternalModule || dependency.hasEffects()) {
          relevantDependencies.add(dependency);
        } else {
          for (const transitiveDependency of dependency.dependencies) {
            possibleDependencies.add(transitiveDependency);
          }
        }
      }
    } else {
      for (const dependency of this.dependencies) {
        relevantDependencies.add(dependency);
      }
    }
    return (this.relevantDependencies = relevantDependencies);
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Webpack&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Webpack&quot; aria-label=&quot;Webpack permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Webpack&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;如果在Webpack想要对代码进行 tree-shaking，需要满足以下几项：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;你必须处于生产模式。Webpack 只有在压缩代码的时候会 tree-shaking&lt;/li&gt;
&lt;li&gt;必须将优化选项 &lt;code&gt;usedExports&lt;/code&gt; 设置为 &lt;code&gt;true&lt;/code&gt;。告诉 Webpack 识别出它认为没有被使用的代码，并在最初的打包步骤中给它做标记。&lt;/li&gt;
&lt;li&gt;最后使用一个支持删除死代码的压缩器。这种压缩器将识别出 Webpack 是如何标记它认为没有被使用的代码，并将其剥离。&lt;code&gt;TerserPlugin&lt;/code&gt; 支持这个功能&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;下面是 Webpack 开启  tree-shaking 的基本配置：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Base Webpack Config for Tree Shaking
const config = {
  mode: &amp;#39;production&amp;#39;,
  optimization: {
    usedExports: true,
    minimizer: [
      new TerserPlugin({...})
    ]
  }
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;以webpack官网文档中的demo为例，当开始生产环境模式时，打包输出的内容会包含&lt;code&gt;unused harmony export&lt;/code&gt;，以此来标记没有被使用的代码&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;src/index.js&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;import _ from &amp;#39;lodash&amp;#39;;
import { cube } from &amp;#39;./math.js&amp;#39;;

function component() {
  const element = document.createElement(&amp;#39;div&amp;#39;);
  const element = document.createElement(&amp;#39;pre&amp;#39;);

  // Lodash, now imported by this script
  element.innerHTML = _.join([&amp;#39;Hello&amp;#39;, &amp;#39;webpack&amp;#39;], &amp;#39; &amp;#39;);
  element.innerHTML = [
    &amp;#39;Hello webpack!&amp;#39;,
    &amp;#39;5 cubed is equal to &amp;#39; + cube(5)
  ].join(&amp;#39;\n\n&amp;#39;);

  return element;
}

document.body.appendChild(component());&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;dist/bundle.js&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;/* 1 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {
  &amp;#39;use strict&amp;#39;;
  /* unused harmony export square */
  /* harmony export (immutable) */ __webpack_exports__[&amp;#39;a&amp;#39;] = cube;
  function square(x) {
    return x * x;
  }

  function cube(x) {
    return x * x * x;
  }
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;然后再通过 &lt;code&gt;Terser-Webpack-Plugin&lt;/code&gt; 压缩代码，将标记为未使用的代码删除。接下来我们看看这两个过程具体的代码实现。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在源码的 &lt;code&gt;lib/optimize.js&lt;/code&gt;中，会先定义一个Set，保存所有暴露出来的未使用的exports&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Set with all root exposed unused exports
/** @type {Set&amp;lt;string&amp;gt;} */
const unusedExports = new Set();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;接下来遍历保存在&lt;code&gt;rootModule&lt;/code&gt;中的所有&lt;code&gt;HarmonyExportSpecifierDependency&lt;/code&gt;依赖，将没有使用的依赖名称保存到 &lt;code&gt;unusedExports&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;for (const dep of this.rootModule.dependencies) {
  if (dep instanceof HarmonyExportSpecifierDependency) {
    const used = /** @type {string | false } */ (this.rootModule.getUsedName(
      moduleGraph,
      dep.name
    ));
    if (used) {
      const info = moduleToInfoMap.get(this.rootModule);
      if (!exportsMap.has(used)) {
        exportsMap.set(
          used,
          () =&amp;gt; `/* binding */ ${info.internalNames.get(dep.id)}`
        );
      }
    } else {
      unusedExports.add(dep.name || &amp;quot;namespace&amp;quot;);
    }
  } else if (dep instanceof HarmonyExportExpressionDependency) {
    const used = /** @type {string | false } */ (this.rootModule.getUsedName(
      moduleGraph,
      &amp;quot;default&amp;quot;
    ));
    if (used) {
      const info = moduleToInfoMap.get(this.rootModule);
      if (!exportsMap.has(used)) {
        exportsMap.set(
          used,
          () =&amp;gt;
            `/* default */ ${info.internalNames.get(
              typeof dep.declarationId === &amp;quot;string&amp;quot;
                ? dep.declarationId
                : &amp;quot;__WEBPACK_MODULE_DEFAULT_EXPORT__&amp;quot;
            )}`
        );
      }
    } else {
      unusedExports.add(&amp;quot;default&amp;quot;);
    }
  } else if (dep instanceof HarmonyExportImportedSpecifierDependency) {
    const exportDefs = getHarmonyExportImportedSpecifierDependencyExports(
      dep,
      moduleGraph
    );
    for (const def of exportDefs) {
      const importedModule = moduleGraph.getModule(dep);
      const info = moduleToInfoMap.get(importedModule);
      const used = /** @type {string | false } */ (this.rootModule.getUsedName(
        moduleGraph,
        def.name
      ));
      if (used) {
        if (!exportsMap.has(used)) {
          exportsMap.set(used, requestShortener =&amp;gt; {
            const finalName = getFinalName(
              moduleGraph,
              info,
              def.ids,
              moduleToInfoMap,
              requestShortener,
              runtimeTemplate,
              false,
              false,
              this.rootModule.buildMeta.strictHarmonyModule,
              true
            );
            return `/* reexport */ ${finalName}`;
          });
        }
      } else {
        unusedExports.add(def.name);
      }
    }
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在 &lt;code&gt;lib/dependencies/HarmonyExportInitFragment.js&lt;/code&gt; 和 &lt;code&gt;lib/dependencies/HarmonyExportExpressionDependency.js&lt;/code&gt; 都有打标记的操作&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;lib/dependencies/HarmonyExportInitFragment.js&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;/**
 * @param {GenerateContext} generateContext context for generate
 * @returns {string|Source} the source code that will be included as initialization code
 */
getContent({ runtimeTemplate, runtimeRequirements }) {
  runtimeRequirements.add(RuntimeGlobals.exports);
  runtimeRequirements.add(RuntimeGlobals.definePropertyGetters);

  const unusedPart =
    this.unusedExports.size &amp;gt; 1
      ? `/* unused harmony exports ${joinIterableWithComma(
        this.unusedExports
      )} */\n`
      : this.unusedExports.size &amp;gt; 0
        ? `/* unused harmony export ${
        this.unusedExports.values().next().value
        } */\n`
        : &amp;quot;&amp;quot;;
  const definitions = [];
  for (const [key, value] of this.exportMap) {
    definitions.push(
      `\n/* harmony export */   ${JSON.stringify(
        key
      )}: ${runtimeTemplate.returningFunction(value)}`
    );
  }
  const definePart =
    this.exportMap.size &amp;gt; 0
      ? `/* harmony export */ ${RuntimeGlobals.definePropertyGetters}(${
      this.exportsArgument
      }, {${definitions.join(&amp;quot;,&amp;quot;)}\n/* harmony export */ });\n`
      : &amp;quot;&amp;quot;;
  return `${definePart}${unusedPart}`;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;lib/dependencies/HarmonyExportExpressionDependency.js&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;
HarmonyExportExpressionDependency.Template = class HarmonyExportDependencyTemplate extends NullDependency.Template {
  /**
   * @param {Dependency} dependency the dependency for which the template should be applied
   * @param {ReplaceSource} source the current replace source which can be modified
   * @param {DependencyTemplateContext} templateContext the context object
   * @returns {void}
   */
  apply(
    dependency,
    source,
    { module, moduleGraph, runtimeTemplate, runtimeRequirements, initFragments }
  ) {
    const dep = /** @type {HarmonyExportExpressionDependency} */ (dependency);
    const used = module.getUsedName(moduleGraph, &amp;quot;default&amp;quot;);
    const { declarationId } = dep;
    const exportsName = module.exportsArgument;
    if (declarationId) {
      let name;
      if (typeof declarationId === &amp;quot;string&amp;quot;) {
        name = declarationId;
      } else {
        name = &amp;quot;__WEBPACK_DEFAULT_EXPORT__&amp;quot;;
        source.replace(
          declarationId.range[0],
          declarationId.range[1] - 1,
          `${declarationId.prefix}${name}${declarationId.suffix}`
        );
      }

      if (used) {
        const map = new Map();
        map.set(used, `/* export default binding */ ${name}`);
        initFragments.push(new HarmonyExportInitFragment(exportsName, map));
      }

      source.replace(
        dep.rangeStatement[0],
        dep.range[0] - 1,
        `/* harmony default export */ ${dep.prefix}`
      );
    } else {
      let content;
      if (used) {
        runtimeRequirements.add(RuntimeGlobals.exports);
        if (runtimeTemplate.supportsConst()) {
          const name = &amp;quot;__WEBPACK_DEFAULT_EXPORT__&amp;quot;;
          content = `/* harmony default export */ const ${name} = `;
          const map = new Map();
          map.set(used, name);
          initFragments.push(new HarmonyExportInitFragment(exportsName, map));
        } else {
          // This is a little bit incorrect as TDZ is not correct, but we can&amp;#39;t use const.
          content = `/* harmony default export */ ${exportsName}[${JSON.stringify(
            used
          )}] = `;
        }
      } else {
        content =
          &amp;quot;/* unused harmony default export */ var _unused_webpack_default_export = &amp;quot;;
      }

      if (dep.range) {
        source.replace(
          dep.rangeStatement[0],
          dep.range[0] - 1,
          content + &amp;quot;(&amp;quot; + dep.prefix
        );
        source.replace(dep.range[1], dep.rangeStatement[1] - 0.5, &amp;quot;);&amp;quot;);
        return;
      }

      source.replace(dep.rangeStatement[0], dep.rangeStatement[1] - 1, content);
    }
  }
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;Terser-Webpack-plugin&lt;/code&gt; 和 &lt;code&gt;Terser&lt;/code&gt; 还未找到相关剔除代码的标记&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;总结&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%80%BB%E7%BB%93&quot; aria-label=&quot;总结 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;总结&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;虽然还没有完全理清楚Webpack中treeshaking在代码层面的具体逻辑，但是对比可以看到。Rollup采用的是先分析，然后找到需要的代码，最后再打包。而webpack则是先打标记，最后再剔除，比较符合标准的DCE的操作&lt;/p&gt;</content:encoded></item><item><title><![CDATA[JavaScript异步编程方案回顾]]></title><description><![CDATA[如标题所述，本文主要是重新梳理JavaScript的异步编程方案，部分内容来自网络 同步 在开始之前，先简单说说JavaScript中的同步。先来个两个简单的例子： 这段代码, 一行一行的顺序执行： 先取得一个在DOM里面的 <button> 引用。 点击按钮的时候，添加一个 …]]></description><link>https://zhanglun.github.io/blogs/2019-10-09-JavaScript异步编程方案回顾/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2019-10-09-JavaScript异步编程方案回顾/</guid><pubDate>Wed, 09 Oct 2019 02:16:54 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;如标题所述，本文主要是重新梳理JavaScript的异步编程方案，部分内容来自网络&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;同步&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%90%8C%E6%AD%A5&quot; aria-label=&quot;同步 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;同步&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在开始之前，先简单说说JavaScript中的同步。先来个两个简单的例子：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const btn = document.querySelector(&amp;#39;button&amp;#39;);
btn.addEventListener(&amp;#39;click&amp;#39;, () =&amp;gt; {
  alert(&amp;#39;危!&amp;#39;);

  let pElem = document.createElement(&amp;#39;p&amp;#39;);
  pElem.textContent = &amp;#39;哈哈哈&amp;#39;;
  document.body.appendChild(pElem);
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这段代码, 一行一行的顺序执行：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;先取得一个在DOM里面的 &amp;#x3C;button&gt; 引用。&lt;/li&gt;
&lt;li&gt;点击按钮的时候，添加一个 click 事件监听器:&lt;/li&gt;
&lt;li&gt;alert() 消息出现。&lt;/li&gt;
&lt;li&gt;一旦alert 结束，创建一个 &amp;#x3C;p&gt; 元素。&lt;/li&gt;
&lt;li&gt;给它的文本内容赋值。&lt;/li&gt;
&lt;li&gt;最后，把这个段落放进网页。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;再比如，模拟一个现实中网页可能遇到的情况：因为渲染UI而阻塞用户的互动，这个例子有2个按钮:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function expensiveOperation() {
  for(let i = 0; i &amp;lt; 1000000; i++) {
    ctx.fillStyle = &amp;#39;rgba(0,0,255, 0.2)&amp;#39;;
    ctx.beginPath();
    ctx.arc(random(0, canvas.width), random(0, canvas.height), 10, degToRad(0), degToRad(360), false);
    ctx.fill()
  }
}

fillBtn.addEventListener(&amp;#39;click&amp;#39;, expensiveOperation);

alertBtn.addEventListener(&amp;#39;click&amp;#39;, () =&amp;gt;
  alert(&amp;#39;You clicked me!&amp;#39;)
);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ol&gt;
&lt;li&gt;点击的时候用1百万个蓝色的圆填满整个&amp;#x3C;canvas&gt;&lt;/li&gt;
&lt;li&gt;点击显示 alert 消息&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;在浏览器中只有一个主线程(main thread)能够任务，也就是我们常说的&lt;code&gt;JavaScript是单线程的（single threaded）&lt;/code&gt;。在一个线程中，任务只能one by one 执行，这也就是所谓的“同步阻塞”。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;但是在实际场景中，只是同步无法满足日常需求，比如用户代理(User Agent)提供了一些API特性，特别是从外部的设备上获取资源，譬如，从网络获取文件，访问数据库，从网络摄像头获得视频流等等，这些都是耗时操作。同步则一定导致阻塞，在用户使用的角度上来说，感受不够友好。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;接下来回顾一下JavaScript中异步解决方案&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;老派Callback&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%80%81%E6%B4%BECallback&quot; aria-label=&quot;老派Callback permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;老派Callback&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;以DOM事件和XMLHttpRequest为代表&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;btn.addEventListener(&amp;#39;click&amp;#39;, () =&amp;gt; {
  alert(&amp;#39;You clicked me!&amp;#39;);

  let pElem = document.createElement(&amp;#39;p&amp;#39;);
  pElem.textContent = &amp;#39;This is a newly-added paragraph.&amp;#39;;
  document.body.appendChild(pElem);
});
&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function loadAsset(url, type, callback) {
  let xhr = new XMLHttpRequest();
  xhr.open(&amp;#39;GET&amp;#39;, url);
  xhr.responseType = type;

  xhr.onload = function() {
    callback(xhr.response);
  };

  xhr.send();
}

function displayImage(blob) {
  let objectURL = URL.createObjectURL(blob);

  let image = document.createElement(&amp;#39;img&amp;#39;);
  image.src = objectURL;
  document.body.appendChild(image);
}

loadAsset(&amp;#39;coffee.jpg&amp;#39;, &amp;#39;blob&amp;#39;, displayImage);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;上述两个例子中，都会将callback注册到EventLoop的任务队列中，这两类都属于宏任务。在 &lt;code&gt;main thread&lt;/code&gt; 空闲时执行。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;传统的callback处理方式容易陷入&lt;code&gt;回调地域&lt;/code&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a9f3a15f626aa58191c6ac45c4b149db/1982c/5d5b4b180001a9f311761290.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 109.57446808510637%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAWABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAH3NZHRBAUH/8QAFxAAAwEAAAAAAAAAAAAAAAAAARARAP/aAAgBAQABBQJzAuL/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAUEAEAAAAAAAAAAAAAAAAAAAAw/9oACAEBAAY/Ah//xAAaEAACAwEBAAAAAAAAAAAAAAABEQAQITGx/9oACAEBAAE/ISGc9ga2jhjtg5Er/9oADAMBAAIAAwAAABBwzzz/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAfEAEAAgEDBQAAAAAAAAAAAAABABEhEEFhMVFxkbH/2gAIAQEAAT8Qplg7x2m+NLiWB7lWNvmjseJYuOvMCif/2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;5d5b4b180001a9f311761290.jpeg&quot;
        title=&quot;5d5b4b180001a9f311761290.jpeg&quot;
        src=&quot;/static/a9f3a15f626aa58191c6ac45c4b149db/acb04/5d5b4b180001a9f311761290.jpg&quot;
        srcset=&quot;/static/a9f3a15f626aa58191c6ac45c4b149db/bc01b/5d5b4b180001a9f311761290.jpg 188w,
/static/a9f3a15f626aa58191c6ac45c4b149db/bf173/5d5b4b180001a9f311761290.jpg 375w,
/static/a9f3a15f626aa58191c6ac45c4b149db/acb04/5d5b4b180001a9f311761290.jpg 750w,
/static/a9f3a15f626aa58191c6ac45c4b149db/ec605/5d5b4b180001a9f311761290.jpg 1125w,
/static/a9f3a15f626aa58191c6ac45c4b149db/1982c/5d5b4b180001a9f311761290.jpg 1176w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Promise&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Promise&quot; aria-label=&quot;Promise permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Promise&lt;/h2&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;A Promise is an object that is used as a placeholder for the eventual results of a deferred (and possibly asynchronous) computation&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;Promise 对象本质上表示的是一系列操作的中间状态，或者说是未来某时刻一个操作完成或失败后返回的结果。Promise并不保证操作在何时完成并返回结果，但是保证在当前操作成功后执行您对操作结果的处理代码，或在操作失败后，优雅地处理操作失败的情况。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;早在 1980 年代，早期的 promise 和 future（类似/相关概念） 实现开始出现。单词 “promise” 的使用由 Barbara Liskov 和 Liuba Shrira 在 1988 年创造 &lt;a href=&quot;https://en.wikipedia.org/wiki/Futures_and_promises&quot; class=&quot;link-underline&quot;&gt;wiki：Future and promises&lt;/a&gt;。Liuba的&lt;a href=&quot;https://heather.miller.am/teaching/cs7680/pdfs/liskov1988.pdf&quot; class=&quot;link-underline&quot;&gt;论文pdf版本&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;CommonJS组织提出了 &lt;a href=&quot;http://wiki.commonjs.org/wiki/Promises/A&quot; class=&quot;link-underline&quot;&gt;Promises/A&lt;/a&gt; 制定异步模式编程规范，最早的时间可以追溯到2010年。比较出名的实现有： &lt;a href=&quot;https://github.com/kriskowal/q&quot; class=&quot;link-underline&quot;&gt;Q&lt;/a&gt;， &lt;a href=&quot;https://api.jquery.com/category/deferred-object/&quot; class=&quot;link-underline&quot;&gt;jQuery&lt;/a&gt; 。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我第一次在 JavaScript 中听说 promise 时，在2015年实习阶段使用Angular的时候。在此之前也稍微接触了jQuery的&lt;code&gt;Defferd对象&lt;/code&gt;。典型的案例就是使用jQuery提供的ajax方法，举个例子：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var jqxhr = $.ajax( &amp;quot;example.php&amp;quot; )
  .done(function() {
    alert( &amp;quot;success&amp;quot; );
  })
  .fail(function() {
    alert( &amp;quot;error&amp;quot; );
  })
  .always(function() {
    alert( &amp;quot;complete&amp;quot; );
  });
 
jqxhr.always(function() {
  alert( &amp;quot;second complete&amp;quot; );
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;由于在那段时间 jQuery 极其流行，它迅速成为了使用最广泛的 promise 实现。jQuery 正式使得 JavaScript promise 成为主流。一些更好的独立 promise 库如 Q、When、Bulebird 开始流行。jQuery 的一些不一致的实现驱使 Promise 标准做了一些重要的阐明，重写并更名为 &lt;a href=&quot;https://promisesaplus.com/&quot; class=&quot;link-underline&quot;&gt;Promises/A+&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;历史在发展，时代在进步。经过一段时间各种Libary的锤炼，ES6
中也新增了&lt;a href=&quot;https://tc39.es/ecma262/#sec-promise-objects&quot; class=&quot;link-underline&quot;&gt;Promise&lt;/a&gt;。不过要注意一点。ES6中的Promise规范完全覆盖了的Promise/A+规范。Promise/A+规范设计成最小规范。ES6的Promise规范完全兼容A+，同时又包含诸如&lt;code&gt;catch&lt;/code&gt;,&lt;code&gt;finially&lt;/code&gt;等特性&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;关于Promise的使用本文不再赘述，网上已经有很丰富的资料内容了。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Generator&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Generator&quot; aria-label=&quot;Generator permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Generator&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;类似的，&lt;code&gt;Generator&lt;/code&gt;的概念也是计算机科学中普遍存在的概念之一&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;In computer science, a generator is a routine that can be used to control the iteration behaviour of a loop.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;其本质是一个可以控制一个循环迭代行为的子程序(routine)。可以理解就是函数。可以简单的认为它是一个返回数组的函数。在ES6中，也把它翻译成&lt;code&gt;生成器函数&lt;/code&gt;。讨论Generator必然离不开&lt;code&gt;协程&lt;/code&gt;。协程又称微线程，纤程，英文名 &lt;code&gt;Coroutine&lt;/code&gt;。协程的作用，是在执行函数A时，可以随时中断，去执行函数B，然后中断继续执行函数A（可以自由切换）。但这一过程并不是函数调用（没有调用语句），这一整个过程看似像多线程，然而协程只有一个线程执行.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;协程由于由程序主动控制切换，没有线程切换的开销，所以执行效率极高。对于IO密集型任务非常适用。我们也正是利用协程随时切换的特性来实现异步编程。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在真正使用Generator来实现异步编程时，你还得先搞清楚什么是&lt;code&gt;Iterator Protocal&lt;/code&gt;，什么是&lt;code&gt;Iteratable Protocal&lt;/code&gt;。同样本文也不再赘述。虽然从根本上来说&lt;code&gt;Generator&lt;/code&gt;诞生之初并不是为了解决异步任务，但是不妨碍广大前端朋友的机智创新。举个简单例子：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let fs = require(&amp;#39;fs&amp;#39;)
function read(file) {
  return new Promise(function(resolve, reject) {
    fs.readFile(file, &amp;#39;utf8&amp;#39;, function(err, data) {
      if (err) reject(err)
      resolve(data)
    })
  })
}
function* r() {
  let r1 = yield read(&amp;#39;./1.txt&amp;#39;)
  let r2 = yield read(r1)
  let r3 = yield read(r2)
  console.log(r1)
  console.log(r2)
  console.log(r3)
}
let it = r()
let { value, done } = it.next()
value.then(function(data) { // value是个promise
  console.log(data) //data=&amp;gt;2.txt
  let { value, done } = it.next(data)
  value.then(function(data) {
    console.log(data) //data=&amp;gt;3.txt
    let { value, done } = it.next(data)
    value.then(function(data) {
      console.log(data) //data=&amp;gt;结束
    })
  })
})

// 2.txt=&amp;gt;3.txt=&amp;gt;结束&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;可以看到手动迭代 Generator 函数很麻烦。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;AsyncAwait&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#AsyncAwait&quot; aria-label=&quot;AsyncAwait permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Async/Await&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;简单的说async函数就相当于自执行的Generator函数，在await的部分等待返回，返回后自动执行下一步。而且相较于Promise，async的优越性就是把每次异步返回的结果从then中拿到最外层的方法中，不需要链式调用，只要用同步的写法就可以了。更加直观而且，更适合处理并发调用的问题。但是async必须以一个Promise对象开始 ，所以async通常是和Promise结合使用的。babel和typescript的&lt;code&gt;async/await&lt;/code&gt;是用&lt;code&gt;yield/generator&lt;/code&gt;实现的
如下所示同样的代码中&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;async function a () {
	return 1
}
async function b () {
	await a()
}

b()&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在[babel repl]中设置&lt;code&gt;presets&lt;/code&gt;中勾选&lt;code&gt;es2016&lt;/code&gt;和&lt;code&gt;es2017&lt;/code&gt;时，编译后的结果中使用了 &lt;code&gt;Promise&lt;/code&gt; 和 &lt;code&gt;Generaotr&lt;/code&gt;。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { 
  try { 
    var info = gen[key](arg); 
    var value = info.value; 
  } catch (error) { 
    reject(error); return; 
  } 
  
  if (info.done) {
    resolve(value); 
  } else { 
    Promise.resolve(value).then(_next, _throw);
  }
}

function _asyncToGenerator(fn) { 
  return function () { 
    var self = this, 
    args = arguments; 
    return new Promise(function (resolve, reject) { 
      var gen = fn.apply(self, args); 
      function _next(value) { 
        asyncGeneratorStep(gen, resolve, reject, _next, _throw, &amp;quot;next&amp;quot;, value); 
      } 
      function _throw(err) {
        asyncGeneratorStep(gen, resolve, reject, _next, _throw, &amp;quot;throw&amp;quot;, err); 
      } 
      
      _next(undefined);
    }); 
  }; 
}

function a() {
  return _a.apply(this, arguments);
}

function _a() {
  _a = _asyncToGenerator(function* () {
    return 1;
  });
  return _a.apply(this, arguments);
}

function b() {
  return _b.apply(this, arguments);
}

function _b() {
  _b = _asyncToGenerator(function* () {
    yield a();
  });
  return _b.apply(this, arguments);
}

b();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当输出的js版本修改为更低版本时，编译后的代码将会包含使用&lt;a href=&quot;https://github.com/facebook/regenerator&quot; class=&quot;link-underline&quot;&gt;regenerator&lt;/a&gt;提供的&lt;code&gt;regeneratorRuntime&lt;/code&gt;来实现 generator 函数&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在&lt;a href=&quot;https://www.typescriptlang.org/play?target=2#code/IYZwngdgxgBAZgV2gFwJYHsI2DAFAShgG8AoASACcBTZBCrARhIF8TRJZEUMsAjPQqTLAA7sFTJsBFiRK9pJIA&quot; class=&quot;link-underline&quot;&gt;Typescript Repl&lt;/a&gt;中将&lt;code&gt;Target&lt;/code&gt;设置为&lt;code&gt;es2015&lt;/code&gt;，可以看到编译结果中同样也以后&lt;code&gt;Promise&lt;/code&gt;和&lt;code&gt;Generator&lt;/code&gt;的身影&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;quot;use strict&amp;quot;;
var __awaiter = (this &amp;amp;&amp;amp; this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator[&amp;quot;throw&amp;quot;](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
function a() {
    return __awaiter(this, void 0, void 0, function* () {
        return 1;
    });
}
function b() {
    return __awaiter(this, void 0, void 0, function* () {
        yield a();
    });
}
b();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;将输出版本修改为&lt;code&gt;ES5&lt;/code&gt;时，可以看到些许差别。Typesciprt编译的结果中包含generator的实现&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;quot;use strict&amp;quot;;
var __awaiter = (this &amp;amp;&amp;amp; this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator[&amp;quot;throw&amp;quot;](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this &amp;amp;&amp;amp; this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] &amp;amp; 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), &amp;quot;throw&amp;quot;: verb(1), &amp;quot;return&amp;quot;: verb(2) }, typeof Symbol === &amp;quot;function&amp;quot; &amp;amp;&amp;amp; (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError(&amp;quot;Generator is already executing.&amp;quot;);
        while (_) try {
            if (f = 1, y &amp;amp;&amp;amp; (t = op[0] &amp;amp; 2 ? y[&amp;quot;return&amp;quot;] : op[0] ? y[&amp;quot;throw&amp;quot;] || ((t = y[&amp;quot;return&amp;quot;]) &amp;amp;&amp;amp; t.call(y), 0) : y.next) &amp;amp;&amp;amp; !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] &amp;amp; 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length &amp;gt; 0 &amp;amp;&amp;amp; t[t.length - 1]) &amp;amp;&amp;amp; (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 &amp;amp;&amp;amp; (!t || (op[1] &amp;gt; t[0] &amp;amp;&amp;amp; op[1] &amp;lt; t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 &amp;amp;&amp;amp; _.label &amp;lt; t[1]) { _.label = t[1]; t = op; break; }
                    if (t &amp;amp;&amp;amp; _.label &amp;lt; t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] &amp;amp; 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
function a() {
    return __awaiter(this, void 0, void 0, function () {
        return __generator(this, function (_a) {
            return [2 /*return*/, 1];
        });
    });
}
function b() {
    return __awaiter(this, void 0, void 0, function () {
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0: return [4 /*yield*/, a()];
                case 1:
                    _a.sent();
                    return [2 /*return*/];
            }
        });
    });
}
b();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;所以现阶段可以这么认为：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Async/Await = Generaotr + Promise&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[再谈EventLoop]]></title><description><![CDATA[首先明确一点，事件循环这个概念并非JavaScript语言中的。在计算机科学中，事件循环作为编程结构或者设计模式，在程序中等待和发送消息或者事件。 EventLoop 也不属于 ECMAscript 规范中的一部分。ECMAscript只规定了JavaScript这门语言的特性…]]></description><link>https://zhanglun.github.io/blogs/再谈EventLoop/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/再谈EventLoop/</guid><pubDate>Tue, 20 Aug 2019 08:56:04 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;首先明确一点，事件循环这个概念并非JavaScript语言中的。在计算机科学中，事件循环作为编程结构或者设计模式，在程序中等待和发送消息或者事件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;EventLoop 也不属于 ECMAscript 规范中的一部分。ECMAscript只规定了JavaScript这门语言的特性。
就JavaScript语言本身而言，众所周知的单线程语言。但是其宿主环境可以是多线程的。在浏览器中除了JavaScript引擎线程之外，还有GUI渲染线程，事件触发线程等，在 Node.js 中有 &lt;code&gt;Libuv&lt;/code&gt;提供线程池来模拟不同操作系统的异步调用。我们常说的 Javascript 的 EventLoop 依赖 JavaScript 依赖宿主环境的实现。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;浏览器中的EventLoop&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84EventLoop&quot; aria-label=&quot;浏览器中的EventLoop permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;浏览器中的EventLoop&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在&lt;a href=&quot;https://html.spec.whatwg.org/multipage/webappapis.html#event-loops&quot; class=&quot;link-underline&quot;&gt;HTML规范&lt;/a&gt;中有这么一段话：&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;To coordinate events, user interaction, scripts, rendering, networking, and so forth, user agents must use event loops as described in this section. There are two kinds of event loops: those for browsing contexts, and those for workers.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;为了协调事件、用户交互、脚本、UI 渲染和网络处理等行为，用户代理(浏览器)必须使用 &lt;code&gt;event loops&lt;/code&gt;。而Event Loop 又可以通过&lt;a href=&quot;https://tc39.es/ecma262/#sec-agents&quot; class=&quot;link-underline&quot;&gt;Agent&lt;/a&gt;的类别分为三类。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;所谓&lt;code&gt;Agent&lt;/code&gt;，是一个包含执行上下文(exection contexts)，一个执行上下文栈(exection context stack)，一个运行时上下文(running execution context)，一个代理记录(Agent Record)和一个&lt;strong&gt;执行线程(executing thread)&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;浏览器中目前有包含三类：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;similar-origin window agent：对应用户代理(浏览器)的主线程，执行上下文是全局执行上下文，其对应的事件循环称之为 &lt;code&gt;window event loop&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;dedicated worker agent, shared worker agent 和 service worker agent：这三个worker agent对应各自的执行线程和执行上下文，对应的事件循环称之为 &lt;code&gt;worker event loop&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;worklet agent：类似，事件循环称之为 &lt;code&gt;worklet event loop&lt;/code&gt;。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Task-Queues&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Task-Queues&quot; aria-label=&quot;Task Queues permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Task Queues&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;每个事件循环会有一个或者多个&lt;code&gt;任务队列(task queues)&lt;/code&gt;。任务队列是一系列&lt;code&gt;任务(task)&lt;/code&gt;的&lt;code&gt;集合(sets)&lt;/code&gt;。注意这里说的&lt;code&gt;任务队列(task queues)&lt;/code&gt;是&lt;a href=&quot;https://infra.spec.whatwg.org/#sets&quot; class=&quot;link-underline&quot;&gt; Sets&lt;/a&gt; 不是 &lt;a href=&quot;https://infra.spec.whatwg.org/#queues&quot; class=&quot;link-underline&quot;&gt;Queues&lt;/a&gt;。
每一个事件循环都有一个 &lt;code&gt;当前执行中的任务(currently running task)&lt;/code&gt;，这个任务可以为null，事件循环初始化时这个任务就是null。这个任务是可以重新载入。
每一个事件循环都有一个 &lt;code&gt;微任务队列(microtask queue)&lt;/code&gt;，微任务队列是一个 &lt;code&gt;Queue&lt;/code&gt;。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Task&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Task&quot; aria-label=&quot;Task permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Task&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;任务(task)是一个结构体，包含以下数据：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;Steps&lt;/strong&gt;：一系列任务需要做的事情
&lt;strong&gt;source&lt;/strong&gt;：任务的来源，用来组织和序列化任务。每一个事件来源在任务队列中都有一个特有的任务队列与之相关。任务来源分以下几类：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;DOM操作&lt;/li&gt;
&lt;li&gt;用户交互&lt;/li&gt;
&lt;li&gt;网络请求&lt;/li&gt;
&lt;li&gt;历史回溯。调用 &lt;code&gt;history.back()&lt;/code&gt; 等相关API&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;document&lt;/strong&gt;：一个与task相关的&lt;a href=&quot;https://html.spec.whatwg.org/multipage/dom.html#document&quot; class=&quot;link-underline&quot;&gt;&lt;code&gt;Document&lt;/code&gt;实例&lt;/a&gt;。如果这个任务不在&lt;code&gt;window event loop&lt;/code&gt;中，则&lt;code&gt;document&lt;/code&gt;为&lt;code&gt;null&lt;/code&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;script evaluation environment settings object set&lt;/strong&gt;：环境配置对象集合，包含一个执行上下文&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;处理模型Processing-model&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A4%84%E7%90%86%E6%A8%A1%E5%9E%8BProcessing-model&quot; aria-label=&quot;处理模型Processing model permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;处理模型(Processing model)&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;当调用栈(call stack)是空栈时，按照下面的步骤来处理：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;选择任务队列中最早的那个任务(task A)。&lt;/li&gt;
&lt;li&gt;如果 task A 为 null(意味着任务队列为空)，跳到第6步&lt;/li&gt;
&lt;li&gt;将task A 设置为 &lt;code&gt;currently running task&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;执行 task A(task对应的回调函数)&lt;/li&gt;
&lt;li&gt;设置 &lt;code&gt;currently running task&lt;/code&gt; 为 null, 移除 task A&lt;/li&gt;
&lt;li&gt;执行微任务队列
&lt;ul&gt;
&lt;li&gt;a. 从微任务队列中选择最早的任务 task X&lt;/li&gt;
&lt;li&gt;b. 如果 task X 为 null (意味着微任务队列为空)，跳到第g步&lt;/li&gt;
&lt;li&gt;c. 将 task X 设置为 &lt;code&gt;currently running task&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;d. 执行 task X&lt;/li&gt;
&lt;li&gt;e. 设置 &lt;code&gt;currently running task&lt;/code&gt; 为 null, 移除 task A&lt;/li&gt;
&lt;li&gt;f: 选择下一个队列中下一个任务，跳到第b步&lt;/li&gt;
&lt;li&gt;g: 结束微任务队列&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;跳到第1步&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;简单来说就是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;先执行任务队列中最早加入的任务，然后移除这个任务&lt;/li&gt;
&lt;li&gt;执行微任务队列中所有的任务，然后移除这个任务&lt;/li&gt;
&lt;li&gt;下一轮：继续执行下一个任务队列中的任务(重复第二步)。直到没有可执行的任务。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;关于处理模型的具体细节可参考 &lt;a href=&quot;https://html.spec.whatwg.org/multipage/webappapis.html#event-loop-processing-model&quot; class=&quot;link-underline&quot;&gt;Processing Model&lt;/a&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;宏任务和微任务&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%8F%E4%BB%BB%E5%8A%A1%E5%92%8C%E5%BE%AE%E4%BB%BB%E5%8A%A1&quot; aria-label=&quot;宏任务和微任务 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;“宏任务”和微任务&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;什么是&lt;code&gt;微任务&lt;/code&gt;，在规范中是这么定义的：&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;A microtask is a colloquial way of referring to a task that was created via the queue a microtask algorithm&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;在规范中其实并没有提到“MarcoTask”这样的概念，只有 &lt;code&gt;Task&lt;/code&gt; 和 &lt;code&gt;MircoTask&lt;/code&gt; 之分，我们暂且就将不是微任务的任务称之为宏任务，具体来看二者入列逻辑步骤。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/43b606da19097abbb712aeb03d47e0ed/ecc9d/Xnip2020-06-14_13-27-06.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 93.08510638297872%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAATABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHt3pckGWoSD//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEAAQUCH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEABj8CH//EABsQAAMAAgMAAAAAAAAAAAAAAAABERAhMUFR/9oACAEBAAE/IVz4KEN3QrjsWP/aAAwDAQACAAMAAAAQ4MiA/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFREBAQAAAAAAAAAAAAAAAAAAEAH/2gAIAQIBAT8QKf/EABsQAAMAAwEBAAAAAAAAAAAAAAABETFBYRBx/9oACAEBAAE/EITKxdIRlm9IEq9CxWlRXY8/ph5//9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Xnip2020-06-14_13-27-06.jpg&quot;
        title=&quot;Xnip2020-06-14_13-27-06.jpg&quot;
        src=&quot;/static/43b606da19097abbb712aeb03d47e0ed/acb04/Xnip2020-06-14_13-27-06.jpg&quot;
        srcset=&quot;/static/43b606da19097abbb712aeb03d47e0ed/bc01b/Xnip2020-06-14_13-27-06.jpg 188w,
/static/43b606da19097abbb712aeb03d47e0ed/bf173/Xnip2020-06-14_13-27-06.jpg 375w,
/static/43b606da19097abbb712aeb03d47e0ed/acb04/Xnip2020-06-14_13-27-06.jpg 750w,
/static/43b606da19097abbb712aeb03d47e0ed/ec605/Xnip2020-06-14_13-27-06.jpg 1125w,
/static/43b606da19097abbb712aeb03d47e0ed/c58a3/Xnip2020-06-14_13-27-06.jpg 1500w,
/static/43b606da19097abbb712aeb03d47e0ed/ecc9d/Xnip2020-06-14_13-27-06.jpg 2112w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;可以看到在这两类任务在前7步都是一样的，微任务在第八步是直接将任务入列至事件循环的微任务队列。注意这里是 &lt;code&gt;Queue&lt;/code&gt;。而宏任务则是先找到一个任务源(task source)与事件循环相关连的任务队列，然后将这个任务入列至任务队列。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这么看来，二者的区别在于入列时的算法，并没有明确规定某一个任务到底采用何种规则入列。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在浏览器这个上下文中，macrotask有以下的种类：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;当外部或内部&lt;code&gt;&amp;#x3C;script&gt;&lt;/code&gt;标签所对应的脚本加载完成之后，执行这些脚本就是一个macrotask；&lt;/li&gt;
&lt;li&gt;当用户点击页面上的按钮，那么分发click事件后的对handler的执行就是一个macrotask；&lt;/li&gt;
&lt;li&gt;调用setTimeout或者setInterval时传入的callback的执行，就是一个macrotask;&lt;/li&gt;
&lt;li&gt;非标准全局方法setImmediate()调用时传入的callback的执行，就是一个macrotask;&lt;/li&gt;
&lt;li&gt;requestAnimationFrame调用时传入的callback的执行，就是一个macrotask;&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;…&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;microtask的种类有以下几种：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;在promise对象调用then/catch/finally的时候传入的callback的执行，就是一个microtask；&lt;/li&gt;
&lt;li&gt;显式地调用queueMicrotask(fn)来入队一个microtask时候，那么对这个fn函数的执行就是一个microtask;&lt;/li&gt;
&lt;li&gt;new MutationObserver()传入callback的执行就是一个microtask;&lt;/li&gt;
&lt;li&gt;Object.observe()传入callback的执行就是一个microtask。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;参考&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%82%E8%80%83&quot; aria-label=&quot;参考 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;参考&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/25915634/difference-between-microtask-and-macrotask-within-an-event-loop-context#&quot; class=&quot;link-underline&quot;&gt;difference-between-microtask-and-macrotask-within-an-event-loop-context&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/HTML_DOM_API/Microtask_guide&quot; class=&quot;link-underline&quot;&gt;Using microtasks in JavaScript with queueMicrotask()&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://my.oschina.net/u/4357381/blog/4267179&quot; class=&quot;link-underline&quot;&gt;深入Event Loop&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[IntersectionObserver、MutationObserver和ResizeObserver]]></title><description><![CDATA[在之前的从getboundingclientrect到intersection-observer中提到了Intersection Observer API，今天趁热打铁，将现有的其他几个Observer API 一并整理，方便查阅 IntersectionObserver 字面…]]></description><link>https://zhanglun.github.io/blogs/MutationObserver、IntersectionObserver和ResizeObserver/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/MutationObserver、IntersectionObserver和ResizeObserver/</guid><pubDate>Sat, 13 Jul 2019 14:31:06 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;在之前的&lt;a href=&quot;../%E4%BB%8Egetboundingclientrect%E5%88%B0intersection-observer/index.md&quot; class=&quot;link-underline&quot;&gt;从getboundingclientrect到intersection-observer&lt;/a&gt;中提到了&lt;code&gt;Intersection Observer API&lt;/code&gt;，今天趁热打铁，将现有的其他几个Observer API 一并整理，方便查阅&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;IntersectionObserver&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#IntersectionObserver&quot; aria-label=&quot;IntersectionObserver permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;IntersectionObserver&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;字面翻译：交叉的观察者。即观察两个元素之间的交叉情况&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Web的传统位置计算机制依赖于显式查询DOM的状态。 其中一些会导致样式重新计算和布局(比如前文提到的&lt;code&gt;offsetHeight&lt;/code&gt;, &lt;code&gt;offsetWidth&lt;/code&gt; 和 &lt;code&gt;getBoundingClientRect()&lt;/code&gt;)，并且经常需要JavaScript脚本需要轮询此信息，因此经常会让浏览器触发多余的重新计算和布局。在实际工作中，追踪或者判断DOM是否出现在客户端视图窗口中是一个很常见的操作。比如图片懒加载，滚动时元素进入的动画等等。一般来说可以通过监听滚动事件，使用&lt;code&gt;getBoundingClientRect()&lt;/code&gt;来计算元素的位置。但正如前文所言，这存在性能问题。
&lt;code&gt;Intersection Observer API&lt;/code&gt; 就是为这而&lt;a href=&quot;https://github.com/w3c/IntersectionObserver/blob/master/explainer.md&quot; class=&quot;link-underline&quot;&gt;设计&lt;/a&gt;的，显着降低其CPU，GPU和能源消耗。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;创建一个-IntersectionObserver&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-IntersectionObserver&quot; aria-label=&quot;创建一个 IntersectionObserver permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建一个 IntersectionObserver&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;IntersectionObserver 的 API 非常简洁&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const observer = new IntersectionObserver(changes =&amp;gt; {
  for (const change of changes) {
    console.log(change)
  }
}, {});

// 观察目标元素的可见性变化
observer.observe(target);

// 停止对一个元素的观察
observer.unobserve(target);

// 停止对所有目标元素可见性变化的观察
observer.disconnect();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;callback&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#callback&quot; aria-label=&quot;callback permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;callback&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;回调接收 IntersectionObserverEntry 对象和观察者的列表：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;ts&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const callback = function(entries: IntersectionObserverEntry[], observer: IntersectionObserver) { 
  entries.forEach(entry =&amp;gt; {
    // Each entry describes an intersection change for one observed
    // target element:
    //   entry.boundingClientRect
    //   entry.intersectionRatio
    //   entry.intersectionRect
    //   entry.isIntersecting
    //   entry.rootBounds
    //   entry.target
    //   entry.time
  });
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;entries&lt;/code&gt;是一个数组，和&lt;code&gt;threshold&lt;/code&gt;对应。即使&lt;code&gt;threshold&lt;/code&gt;输入的是一个数字，&lt;code&gt;entries&lt;/code&gt;也会返回数组。下图是&lt;code&gt;IntersectionObserverEntry&lt;/code&gt;的结构&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2d9e4db5e60c060aa6af53a7319481c0/8b936/intersection-observer-api.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 94.14893617021278%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/UlEQVQ4y5WS607jMBCFef93QkICAYW2QuJWlTaEpElz8yUXO47j8awGCltWXbo7GkX+4eOc+c6cGGOSKIneomAVBOvXIAjykltrYRgQAI3Brtu1Uugc7tUJIva1YSvGoqaXRnLBWMU5t0LQ1ZcXvLjAyQTnc7y+xqcnTBLcbDCOMYpIDBZEVKexsRb/LAB6AgC9p6+15OWzSeyME3GdbwfTg0cP4D+KBF+1f9637R2UG1VLwP8sEo+Dbcq+r02e5tu0ShOuOm+0I5MAqDWh0pqsKkXktMa6RudIrIQWa87WgsfiLcyWi224KtqYoRC4WOBshjc3OJ3i7S3e3xOz6ZTgcf4+8+D4q8g25j2Ij9n87gBwxDZYJ6M6SwatYIfGoz94/QP7J7+duAgbIdxPOf0VmB3rQutm4Fzwindd5/seT0/x4QEfH2m8szMaeDYjBGX5TayEZkteRSII8iwpuu0Wq4oWaz7Huzu8usLzc3prMsHLS3x+/jJCYtMObMnSsGG8UVqptqOQvEfGMMtQSspGCMrpEDDgoajyAY6uyfe1260nC2VVWDf635cAdqj2+8CfARpmrPUjuNGNo3P+39dTN1qmbVt2ZRjzvGirihIqChr4uFhqvmnzjcpjKXndSNFI2QtBnH4WA4CWfS+GTrWMV3YcB2vHcQR/3PsvrBRMEro/rEYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;intersection-observer-api.png&quot;
        title=&quot;intersection-observer-api.png&quot;
        src=&quot;/static/2d9e4db5e60c060aa6af53a7319481c0/1d69c/intersection-observer-api.png&quot;
        srcset=&quot;/static/2d9e4db5e60c060aa6af53a7319481c0/4dcb9/intersection-observer-api.png 188w,
/static/2d9e4db5e60c060aa6af53a7319481c0/5ff7e/intersection-observer-api.png 375w,
/static/2d9e4db5e60c060aa6af53a7319481c0/1d69c/intersection-observer-api.png 750w,
/static/2d9e4db5e60c060aa6af53a7319481c0/78797/intersection-observer-api.png 1125w,
/static/2d9e4db5e60c060aa6af53a7319481c0/8b936/intersection-observer-api.png 1368w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;下图可以清晰的看出&lt;code&gt;intersectionRadio&lt;/code&gt;的意义&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9bc316a320eafbfc56bd4b26454cab96/cc155/intersectratio.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 98.93617021276596%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEr0lEQVQ4y42Ua08TaRiGR7rxi9mP/IT9B6u7RrPxEAJyKqX0RIEoSlRQQDCFCkqhWBtaSEgsXcgWbIusca3Qw5QeKEVoS2em7ZSKa4if/Eb8C2PfezODEk02m53kyv3cM5N7njfPOy9FURS1l07LSrkcxefzjtyrV2CWlgTW4yGsxwMJt/sIjwfMN7WE10uYxcVygabBv3+vFvOogt8vK21tUXsM43hz5w5iDQ1CvLmZxJubEVcqsdHSgg2VCnGFAgm1WvJiLaFUkmh1dTltNuPdp09fAoNBGR+NUnwm42AePwY7PCxwJhNhR0fBPnwIzmRCwWJBZnAQjNGIVG8v4hoNNlpbsaHXk1hTUzljtWL/8FBNOZ1OqrC6KttLJqliNuvY6u5GtLZWEL983EVT03FHMbn8iMbGI5qayPrly+XU+PhRh2JgKZ2WvcvnqRLPP82/eAF2YUHgXC7CuVz4TxYXRQg7P1/mg0GUPnxQSYF/ZzKy4u4uxXOcM+f1gnn6VGCdTsI6nfiOuTkwc3PHKuF0kuzsbLng84E/ONBSNpvtxIDFQtlmZn6JhELrL3t78Uyp/OzRaolHq4Vbq4WoHo0GHp0Oy3o9vK2tki63tWG5o4O4W1qI32xGIBZzUgCkwVjt9l8LmYwz/OAB1m7eFPx375K17m4EenoQ7O8HPTgI3/Xr8HV1IdDXh+ctLfAqFFhWKslSTQ2JmM1IF4sPqbNnz1aIgU/s9tNcOr0QuHcPL/V64fWNG8R37Rp8nZ14dfUqVru68Fd7O/5Uq/FS7Ewuh6euDt7GRrJ46RIJj40hVSw+omQy2U9SoNV6mi8U5nPRKLKrq0LW7ydZvx/HrK2BCQTABIOSsqEQWJoWIUwgQPZ2dpDc3n5EVVRU/PbjqVOnTCbTr3vF4vwblwtRq1WIT0+TuN2O2DfEp6ch3bPZJJX8zAyJWq0kvbKCrVRKCjx3UiarHDIaz+/x/O+vb9+Gu6pK8DY0EG99PUSWGxsl3LW10jKfKxRSvVRVhWc1NeSP8+dJ0GDADsdJgWfEJU/Z7T/nWXYhNjmJ8MCAEBkZIetDQ4gYjYiOjGBjfBzBvj6Ig0pMTMDf3S0OBCtqNfHU15N1kwnbLPuIqqysPCkGTlosZ/h8fsF36xZcFy8K7tpa4r5yBc9EamokdX+tq6ulWqKujrguXCCh4eGjQPESt87k5OTp/bdvHXwyiVw4LOQiEZKLRPA/IBxNk1IqhTc7Ow8og8FwQtPZSU1NTZ3bSiZ9sfl5BJ88+UzbbISemsK/EfrW22wkaLGQhNuNUCQyK/16Xzb3iZ3t7ZXYwAACCsXnkFZLQhoNROjWVoR0OgRFr9OB1usRVKulZ+J7Abm8vDE2hiTD3JUCmUjkh93NTWqf52dZ8fi6f1/IjY4SbngYnNGI3MgICuPj2O3vR7qnB+zQEDbFo0ulQkKrJfGGhnJmYgIHh4cKKXA/mZQdlErU22LRkTIYkFCphGRHB0m2tSHZ3o5NvV5S0YtBok9otUhoNEjodCQul5czZjP2P37USEPhsllZjuMohmEcTDyOLE0L2XCYZMNhscZ3+pX1dTBHkCxNl9nNTewyjPofpgrvWq7q9LwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;intersectratio.png&quot;
        title=&quot;intersectratio.png&quot;
        src=&quot;/static/9bc316a320eafbfc56bd4b26454cab96/1d69c/intersectratio.png&quot;
        srcset=&quot;/static/9bc316a320eafbfc56bd4b26454cab96/4dcb9/intersectratio.png 188w,
/static/9bc316a320eafbfc56bd4b26454cab96/5ff7e/intersectratio.png 375w,
/static/9bc316a320eafbfc56bd4b26454cab96/1d69c/intersectratio.png 750w,
/static/9bc316a320eafbfc56bd4b26454cab96/cc155/intersectratio.png 886w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;IntersectionObservers&lt;/code&gt; 是异步传递数据，回调函数中的代码将在主线程中运行。 规范中提到&lt;code&gt;IntersectionObserver&lt;/code&gt;实现应使用&lt;code&gt;requestIdleCallback（）&lt;/code&gt;。 这意味着对回调函数的执行是低优先级的，将在客户端空闲时间进行。 这是有意为之。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;options&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#options&quot; aria-label=&quot;options permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;options&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;传递到IntersectionObserver()构造函数的 options 对象包含以下字段：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;root&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;指定根(root)元素，用于检查目标的可见性。必须是目标元素的父级元素。&lt;/li&gt;
&lt;li&gt;如果未指定或者为null，则默认为浏览器视窗。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;rootMargin&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;根元素的外边距。类似于css中的 margin 属性，比如 “10px 20px 30px 40px” (top, right, bottom, left)。&lt;/li&gt;
&lt;li&gt;如果有指定root参数，则rootMargin也可以使用百分比来取值。该属性值是用作root元素和target发生交集时候的计算交集的区域范围，使用该属性可以控制root元素每一边的收缩或者扩张。&lt;/li&gt;
&lt;li&gt;默认值为0。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;threshold&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;可以是一个数字也可以是一个数字数组。目标元素和根元素相交程度达到该值的时候IntersectionObserver注册的回调函数将会被执行。&lt;/li&gt;
&lt;li&gt;如果你只是想要探测当target元素的在root元素中的可见性超过50%的时候，你可以指定该属性值为0.5。&lt;/li&gt;
&lt;li&gt;如果你想要target元素在root元素的可见程度每多25%就执行一次回调，那么你可以指定一个数组[0, 0.25, 0.5, 0.75, 1]。&lt;/li&gt;
&lt;li&gt;默认值是0(意味着只要有一个target像素出现在root元素中，回调函数将会被执行)。&lt;/li&gt;
&lt;li&gt;该值为1.0含义是当target完全出现在root元素中时候 回调才会被执行。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;注意：&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;如果使用默认的&lt;code&gt;options&lt;/code&gt;，目标元素部分进入视图窗口和完全离开视图窗口时，都会触发一次回调函数&lt;/li&gt;
&lt;li&gt;如果你想同时观察多个元素，尽可能地在一个&lt;code&gt;IntersectionObserver&lt;/code&gt;的实例上调用多次&lt;code&gt;observer&lt;/code&gt;方法&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;常用场景&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B8%B8%E7%94%A8%E5%9C%BA%E6%99%AF&quot; aria-label=&quot;常用场景 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;常用场景&lt;/h3&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;元素的可见性监听&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%85%83%E7%B4%A0%E7%9A%84%E5%8F%AF%E8%A7%81%E6%80%A7%E7%9B%91%E5%90%AC&quot; aria-label=&quot;元素的可见性监听 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;元素的可见性监听&lt;/h4&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;!-- 网页中嵌入的广告 --&amp;gt;
&amp;lt;iframe id=&amp;quot;theAd&amp;quot;&amp;gt;&amp;lt;/iframe&amp;gt;
&amp;lt;!-- 嵌入的脚本 --&amp;gt;
&amp;lt;script src=&amp;quot;//cdn.example.com/ads.js&amp;quot; async&amp;gt;&amp;lt;/script&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// ads.js

// 上报信息
function logImpressionToServer() { /* ... */ }

// 判断是否可见
function isVisible(boundingClientRect, intersectionRect) {
  return ((intersectionRect.width * intersectionRect.height) /
          (boundingClientRect.width * boundingClientRect.height) &amp;gt;= 0.5);
}

function visibleTimerCallback(element, observer) {
  delete element.visibleTimeout;

  processChanges(observer.takeRecords());

  if (&amp;#39;isVisible&amp;#39; in element) {
    delete element.isVisible;
    logImpressionToServer();
    observer.unobserve(element);
  }
}

// 交叉时的回调函数
function processChanges(changes) {
  changes.forEach(function(changeRecord) {
    const element = changeRecord.target;
    element.isVisible = isVisible(changeRecord.boundingClientRect, changeRecord.intersectionRect);
    if (&amp;#39;isVisible&amp;#39; in element) {
      // 显示
      element.visibleTimeout = setTimeout(visibleTimerCallback, 1000, element, observer);
    } else {
      // 隐藏
      if (&amp;#39;visibleTimeout&amp;#39; in element) {
        clearTimeout(element.visibleTimeout);
        delete element.visibleTimeout;
      }
    }
  });
}

const observer = new IntersectionObserver(
  processChanges,
  { threshold: [0.5] } 
);

const theAd = document.querySelector(&amp;#39;#theAd&amp;#39;);
observer.observe(theAd);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;乍看之下好像需要编写更多复杂代码，但是对比传统的方式，这种方式有其优点&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;无需监听scroll事件&lt;/li&gt;
&lt;li&gt;没有频繁的同步计算布局，没有插件依赖，只使用了一个定时器来记录状态&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;数据滚动&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%95%B0%E6%8D%AE%E6%BB%9A%E5%8A%A8&quot; aria-label=&quot;数据滚动 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;数据滚动&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;许多系统使用数据绑定列表来管理其视图内内容，可以通过回收DOM的方式保持内存和布局效。率。通常我们在渲染分页加载的列表数据的时候，为了避免滚动的时候出现卡顿感，会一次加载好几页的数据，但是实际上需要渲染的数据是总数据的子集。并且随着页码的加大，这个列表中的DOM会越来越多。我们可以在列表元素上使用 &lt;code&gt;IntersectionObserver&lt;/code&gt;，来通知系统何时加载数据，何时回收DOM&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;style&amp;gt;
  .container {
    overflow: auto;
    width: 10em;
    height: 30em;
    position: relative;
  }

  .inner-scroll-surface {
    position: absolute;
    left: 0px;
    top: 0px;
    width: 100%;
    /* proportional to the # of expected items in the list */
    height: 1000px;
  }

  .scroll-item {
    position: absolute;
    height: 2em;
    left: 0px;
    right: 0px;
  }
&amp;lt;/style&amp;gt;

&amp;lt;div class=&amp;quot;container&amp;quot;&amp;gt;
  &amp;lt;div class=&amp;quot;inner-scroll-surface&amp;quot;&amp;gt;
    &amp;lt;div class=&amp;quot;scroll-item&amp;quot; style=&amp;quot;top: 0em;&amp;quot;&amp;gt;item 1&amp;lt;/div&amp;gt;
    &amp;lt;div class=&amp;quot;scroll-item&amp;quot; style=&amp;quot;top: 2em;&amp;quot;&amp;gt;item 2&amp;lt;/div&amp;gt;
    &amp;lt;div class=&amp;quot;scroll-item&amp;quot; style=&amp;quot;top: 4em;&amp;quot;&amp;gt;item 3&amp;lt;/div&amp;gt;
    &amp;lt;!-- ... --&amp;gt;
  &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;As the user moves the container, the children can be observed and as they cross the threshold of the scrollable area, a manager can recycle them and fill them with new data instead of needing to re-create the items from scratch.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当用户滚动列表时，列表元素经过预先设定的阈值时，可以执行对应的处理逻辑&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function query(selector) {
  return Array.from(document.querySelectorAll(selector));
}

function init() {
  const opts = { 
    root: document.querySelector(&amp;quot;.container&amp;quot;),
    rootMargin: &amp;quot;500px 0px&amp;quot; 
  };
  const observer = new IntersectionObserver(manageItemPositionChanges, opts);

  query(&amp;quot;.inner-scroll-surface &amp;gt; .scroll-item&amp;quot;)
    .forEach(function(scrollItem) {
      observer.observe(scrollItem);
    });
}

function manageItemPositionChanges(changes) {
  // ...
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;延迟加载&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD&quot; aria-label=&quot;延迟加载 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;延迟加载&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;使用&lt;code&gt;IntersectionObserver&lt;/code&gt;轻松实现懒加载&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;div class=&amp;quot;lazy-loaded&amp;quot;&amp;gt;
  &amp;lt;template&amp;gt;
    ...
  &amp;lt;/template&amp;gt;
&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function query(selector) {
  return Array.from(document.querySelectorAll(selector));
}

var observer = new IntersectionObserver(
  // 预先加载在视窗可见区域高度两倍以内的元素
  function(changes) {
    changes.forEach(function(change) {
      var container = change.target;
      var content = container.querySelector(&amp;quot;template&amp;quot;).content;
      container.appendChild(content);
      observer.unobserve(container);
    });
  },
  { rootMargin: &amp;quot;200% 0%&amp;quot; }
);

query(&amp;quot;.lazy-loaded&amp;quot;).forEach(function(item) {
  observer.observe(item);
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;MutationObserver&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#MutationObserver&quot; aria-label=&quot;MutationObserver permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;MutationObserver&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在web应用中，DOM操作是相当频繁的。在过去有一段时间，公认有效的一种方式是使用&lt;code&gt;Mutation Events&lt;/code&gt;，不过这个特性在API的设计中有缺陷，为DOM添加 mutation 监听器反而会进一步降低修改DOM文档的性能（慢1.5 - 7倍）。而且 移除监听器不会减少性能的消耗。目前已经被废弃了。具体原因可以查看&lt;a href=&quot;https://lists.w3.org/Archives/Public/public-webapps/2011JulSep/0779.html&quot; class=&quot;link-underline&quot;&gt;DOM Mutation Events Replacement: The Story So Far / Existing Points of Consensus&lt;/a&gt;。简单来说以下三点原因：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;冗余。因为经常触发&lt;/li&gt;
&lt;li&gt;慢。因为事件传播所以慢，同时还阻止了一些UA的自我优化&lt;/li&gt;
&lt;li&gt;容易crash。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;W3C提出了&lt;code&gt;MutationObserver&lt;/code&gt;来代替&lt;code&gt;Mutation Events&lt;/code&gt;。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;创建一个-MutationObserver&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-MutationObserver&quot; aria-label=&quot;创建一个 MutationObserver permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建一个 MutationObserver&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;MutationObserver&lt;/code&gt; 可以监听DOM节点的变化，属性的变化，它最基本的语法如下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;ts&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const targetNode = document.querySelector(&amp;quot;#someElement&amp;quot;)
const observerOptions = {
  childList: true,  // 观察目标子节点的变化，是否有添加或者删除
  attributes: true, // 观察属性变动
  subtree: true     // 观察后代节点，默认为 false
}

const observer = new MutationObserver(callback)

function callback(records: mutationRecord[], observer: MutationObserver) {
  // ...
}
observer.observe(targetNode, observerOptions)

// ...

observer.disconnect() // 停止观察变动。 可以重用观察者。所有已经检测到但是尚未向观察者报告的变动都会被丢弃&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;使用选择器来获取目标节点树。 &lt;code&gt;observerOptions&lt;/code&gt; 中设定了观察者的选项，通过设定 childList 和 attributes 为 true 来获取所需信息，表示同时观察目标节点树的childList和attributes的变化。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;callback-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#callback-1&quot; aria-label=&quot;callback 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;callback&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;每当被指定的节点或子树以及配置项有 DOM 变动时，callback会被异步调用。这个函数有两个参数：一个是描述所有被触发改动的 &lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/API/MutationRecord&quot; class=&quot;link-underline&quot;&gt;&lt;code&gt;MutationRecord&lt;/code&gt;&lt;/a&gt; 对象数组，另一个是调用该函数的MutationObserver 对象。比如：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function callback(mutationRecords, observer) {
  mutationRecords.forEach((mutation) =&amp;gt; {
    switch(mutation.type) {
      case &amp;#39;childList&amp;#39;:
        /* 从树上添加或移除一个或更多的子节点；参见 mutation.addedNodes 与
           mutation.removedNodes */
        break;
      case &amp;#39;attributes&amp;#39;:
        /* mutation.target 中某节点的一个属性值被更改；该属性名称在 mutation.attributeName 中，
           该属性之前的值为 mutation.oldValue */
        break;
    }
  });
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;:::info
callback 的函数签名和 &lt;code&gt;IntersectionObserver&lt;/code&gt; 很相似。其实这些 Observer 的callback 的函数签名都是相似的
:::&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;之后指定目标节点与记录选项，我们开始观察使用 &lt;code&gt;observe()&lt;/code&gt; 指定的 DOM 节点。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;从现在开始直到调用 &lt;code&gt;disconnect()&lt;/code&gt; ，每次以 targetNode 为根节点的 DOM 树添加或移除元素时，以及这些元素的任意属性改变时，&lt;code&gt;callback()&lt;/code&gt; 都会被调用。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;options-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#options-1&quot; aria-label=&quot;options 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;options&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;observer(target, options)&lt;/code&gt; 中的 &lt;code&gt;options&lt;/code&gt; 是一个&lt;code&gt;MutationObserverInit&lt;/code&gt;对象，描述了 MutationObserver 的配置。当调用 &lt;code&gt;observe()&lt;/code&gt; 方法时，&lt;code&gt;childList&lt;/code&gt;，&lt;code&gt;attributes&lt;/code&gt; 或者 &lt;code&gt;characterData&lt;/code&gt; 三个属性之中，至少有一个必须为 &lt;code&gt;true&lt;/code&gt;，否则会抛出 &lt;code&gt;TypeError&lt;/code&gt; 异常。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;参数名&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;th&gt;是否可选&lt;/th&gt;
&lt;th&gt;默认值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;childList&lt;/td&gt;
&lt;td&gt;设为 &lt;code&gt;true&lt;/code&gt; 时，监视目标节点（如果 subtree 为 true，则包含子孙节点）添加或删除新的子节点。&lt;/td&gt;
&lt;td&gt;可选&lt;/td&gt;
&lt;td&gt;false&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;attributes&lt;/td&gt;
&lt;td&gt;设为 &lt;code&gt;true&lt;/code&gt; 时，观察受监视元素的属性值变更&lt;/td&gt;
&lt;td&gt;可选&lt;/td&gt;
&lt;td&gt;false&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;characterData&lt;/td&gt;
&lt;td&gt;设为 &lt;code&gt;true&lt;/code&gt; 时，监视指定目标节点或子节点树中节点所包含的字符数据的变化&lt;/td&gt;
&lt;td&gt;可选&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;attributeFilter&lt;/td&gt;
&lt;td&gt;要监视的特定属性名称的数组。如果未包含此属性，则对所有属性的更改都会触发变动通知&lt;/td&gt;
&lt;td&gt;可选&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;attributeOldValue&lt;/td&gt;
&lt;td&gt;当监视节点的属性改动时，将此属性设为 true 将记录任何有改动的属性的上一个值&lt;/td&gt;
&lt;td&gt;可选&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;characterDataOldValue&lt;/td&gt;
&lt;td&gt;设为 &lt;code&gt;true&lt;/code&gt;时， 受监视节点的文本(text)发生更改时记录节点文本的先前值&lt;/td&gt;
&lt;td&gt;可选&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;subtree&lt;/td&gt;
&lt;td&gt;设为 &lt;code&gt;true&lt;/code&gt; 时将监视范围扩展至目标节点整个节点树中的所有节点。MutationObserverInit 的其他值也会作用于此子树下的所有节点，而不仅仅只作用于目标节点。&lt;/td&gt;
&lt;td&gt;可选&lt;/td&gt;
&lt;td&gt;false&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;takeRecords&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#takeRecords&quot; aria-label=&quot;takeRecords permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;takeRecords()&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;返回&lt;strong&gt;已检测到但尚未由观察者的回调函数处理的所有匹配DOM更改的列表，使变更队列保持为空&lt;/strong&gt;。 最常见的使用场景是：在断开观察者之前立即获取所有未处理的更改记录，以便在停止观察者时可以处理任何未处理的更改。比如：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;diff&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var targetNode = document.querySelector(&amp;quot;#someElement&amp;quot;);
var observerOptions = {
  childList: true,
  attributes: true
}

var observer = new MutationObserver(callback);
observer.observe(targetNode, observerOptions);

// 这里做了一些事情
// ...
+// 开始处理尚未结束的变更
+var mutations = observer.takeRecords();

+if (mutations) {
+  callback(mutations);
+}

observer.disconnect();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Resize-Observer&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Resize-Observer&quot; aria-label=&quot;Resize Observer permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Resize Observer&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;这个API和其他的Observer类似，他可以用来观察元素大小的变化。onresize事件则只能有window来触发。大部分使用场景可能是在视窗大小发生变化，或者在移动设备上屏幕旋转时，监听页面元素尺寸的变化。在resizeObserver出现之前，只能使用 &lt;code&gt;window.resize&lt;/code&gt; 事件来见视窗的大小变化。这种方式稍不留神就容易因为频繁触发resize事件而出现性能问题，从另一个层面来说，&lt;code&gt;resize&lt;/code&gt;有点“浪费资源”，因为我们只能通过视窗的变化来计算目标元素的变化。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;现如今重Web端的SPA页面中，经常需要动态地添加或者删除DOM，频繁修改父元素的尺寸，这种case只有Resize Observer API能够帮我们。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;除了监听元素大小变化之外，还有几个有意思的特性：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;目标元素被插入或者从DOM中移除时会触发观察&lt;/li&gt;
&lt;li&gt;目标元素display修改为&lt;code&gt;none&lt;/code&gt;时会触发观察&lt;/li&gt;
&lt;li&gt;非替换元素(&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/CSS/Replaced_element&quot; class=&quot;link-underline&quot;&gt;link&lt;/a&gt;)不会触发观察&lt;/li&gt;
&lt;li&gt;tranforms不会触发观察&lt;/li&gt;
&lt;li&gt;如果元素被渲染了时尺寸不是0，0，也会触发观察&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;创建一个-ResizeObserver&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-ResizeObserver&quot; aria-label=&quot;创建一个 ResizeObserver permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建一个 ResizeObserver&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;与&lt;code&gt;intersectionObserver&lt;/code&gt;和&lt;code&gt;MutationObserver&lt;/code&gt;不同，ResizeObserver的构造函数只需要一个&lt;code&gt;callback&lt;/code&gt;参数。但是监听和取消监听的方法类似&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function callbacl(entries) {
  // ...
}

const myObserver = new ResizeObserver(callback);
const someEl = document.querySelector(&amp;#39;.some-element&amp;#39;)
const someOtherEl = document.querySelector(&amp;#39;.some-other-element&amp;#39;)

myObserver.observe(someEl)
myObserver.observe(someOtherEl)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;callback-2&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#callback-2&quot; aria-label=&quot;callback 2 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;callback&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;当观察的目标元素尺寸发生变化时触发回调函数，参数是一个&lt;code&gt;ResizeObserverEntry&lt;/code&gt;对象数组。ResizeObserverEntry的接口如下&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;ts&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;interface ResizeObserverEntry {
    readonly attribute Element target;
    readonly attribute DOMRectReadOnly contentRect;
    readonly attribute sequence&amp;lt;ResizeObserverSize&amp;gt; borderBoxSize;
    readonly attribute sequence&amp;lt;ResizeObserverSize&amp;gt; contentBoxSize;
    readonly attribute sequence&amp;lt;ResizeObserverSize&amp;gt; devicePixelContentBoxSize;
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;contentRect&lt;/code&gt; 是 ResizeObserver API 孵化阶段时的产物，考虑到兼容性问题暂时保留，在未来可能会被废弃。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当观察的目标元素尺寸发生变化时触发回调函数，参数是一个&lt;code&gt;ResizeObserverEntry&lt;/code&gt;对象数组。&lt;code&gt;ResizeObserverEntry&lt;/code&gt;对象包含两个属性：&lt;code&gt;contentRect&lt;/code&gt;，&lt;code&gt;target&lt;/code&gt;。&lt;strong&gt;target&lt;/strong&gt;是被观察的目标对象。&lt;strong&gt;contentRect&lt;/strong&gt;是&lt;code&gt;DOMRectReadOnly&lt;/code&gt;的引用，包含 &lt;code&gt;width&lt;/code&gt;, &lt;code&gt;height&lt;/code&gt;, &lt;code&gt;x&lt;/code&gt;, &lt;code&gt;y&lt;/code&gt;, &lt;code&gt;top&lt;/code&gt;, &lt;code&gt;right&lt;/code&gt;, &lt;code&gt;bottom&lt;/code&gt; 和 &lt;code&gt;left&lt;/code&gt;。和&lt;code&gt;Element.getBoundingClientRect()&lt;/code&gt;返回的数据不同，&lt;code&gt;contentRect&lt;/code&gt;的&lt;code&gt;width&lt;/code&gt;和&lt;code&gt;height&lt;/code&gt;不包含&lt;code&gt;padding&lt;/code&gt;，&lt;code&gt;contentRect.top&lt;/code&gt;是元素的&lt;code&gt;padding-top&lt;/code&gt;，&lt;code&gt;contentRect.left&lt;/code&gt;是元素的&lt;code&gt;padding-left&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;比如在元素调整大小时，其内部文本显示为尺寸大小，代码如下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const resizeObserver = new ResizeObserver(entries =&amp;gt; {
  for (let entry of entries) {
    const boxEl = entry.target
    const dimensions = entry.contentRect

    boxEl.textContent = `${dimensions.width} x ${dimensions.height}`
  }
})

resizeObserver.observe(document.querySelector(&amp;#39;.box:nth-child(2)&amp;#39;))&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;observetarget-options&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#observetarget-options&quot; aria-label=&quot;observetarget options permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;observe(target, options)&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;ResizeObserver实例的observe方法还有第二个参数&lt;code&gt;options&lt;/code&gt;。不过暂时处于草案阶段，浏览器还不支持第二个参数。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;ts&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;enum ResizeObserverBoxOptions {
  &amp;quot;border-box&amp;quot;, 
  &amp;quot;content-box&amp;quot;, 
  &amp;quot;device-pixel-content-box&amp;quot;
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;可以控制Observer观察不同的CSS尺寸：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;border-box&lt;/strong&gt; : box-border。返回的尺寸包含padding和border&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;content-box&lt;/strong&gt; : content-boder。返回的尺寸不包含padding和border。默认值&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;device-pixel-content-box&lt;/strong&gt; : 返回的尺寸是未经缩放的，和设备像素相关的大小，一定是一个整数。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;常用场景-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B8%B8%E7%94%A8%E5%9C%BA%E6%99%AF-1&quot; aria-label=&quot;常用场景 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;常用场景&lt;/h3&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;iframe的大小变化&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#iframe%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%8F%98%E5%8C%96&quot; aria-label=&quot;iframe的大小变化 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;iframe的大小变化&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;iframe 可以检测到大小的变化然后通知给父窗口&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let ro = new ResizeObserver(entries =&amp;gt; {
  let idealSize = computeIdealSize();

  window.parent.postMessage({
    name: &amp;quot;iframeResize&amp;quot;,
    width: idealSize.width,
    height: idealSize.height
  }, &amp;#39;*&amp;#39;);
});

ro.observe(document.body);

// window上监听message事件
window.addEventListener(&amp;quot;message&amp;quot;, ev =&amp;gt; {
  if (ev.data &amp;amp;&amp;amp; ev.data.name == &amp;quot;iframeResize&amp;quot;) {
    let iframe = findEventSourceIframe(ev.source);
    if (iframe) {
      iframe.style.width = ev.data.width + &amp;quot;px&amp;quot;;
      iframe.style.height = ev.data.height + &amp;quot;px&amp;quot;;
    }
  }
}, false);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;聊天窗口自动滚动到底部&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%81%8A%E5%A4%A9%E7%AA%97%E5%8F%A3%E8%87%AA%E5%8A%A8%E6%BB%9A%E5%8A%A8%E5%88%B0%E5%BA%95%E9%83%A8&quot; aria-label=&quot;聊天窗口自动滚动到底部 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;聊天窗口自动滚动到底部&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;在聊天窗口中，最新的消息在底部。为了防止浏览器自动滚动到顶部，当收到新消息时需要将滚动的位置保持在最底部。当窗口自动变化的时候也要保证能够&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.chat {
  overflow: scroll;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;div class=&amp;quot;chat&amp;quot;&amp;gt;  &amp;lt;!-- chat has the scrollbar --&amp;gt;
  &amp;lt;div class=&amp;quot;chat-text&amp;quot;&amp;gt; &amp;lt;!-- chat-text contains chat text --&amp;gt;
    &amp;lt;div&amp;gt;jack: hi &amp;lt;/div&amp;gt;
    &amp;lt;div&amp;gt;jill: hi &amp;lt;/div&amp;gt;
  &amp;lt;/div&amp;gt;
&amp;lt;/div&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let ro = new ResizeObserver( entries =&amp;gt; {
  for (let e of entries) {
    let chat = e.target.parentNode;
    chat.scrollTop = chat.scrollHeight - chat.clientHeight;
  }
});
ro.observe(document.querySelector(&amp;#39;.chat-text&amp;#39;))&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;ResizeObserver 观察 &lt;code&gt;chat-text&lt;/code&gt; 的大小，每次检测到变化时，将 &lt;code&gt;chat&lt;/code&gt; 滚动到底部。新消息插入时也会触发到resize的检测。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当用户向上滚动滚动条阅读历史消息时，新消息插入时自动滚动到底部，这会让用户丢掉之前阅读的信息。所以在这里引出一个新问题，如何保留用户的滚动位置？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们可以监听scroll事件来判断是否滚动，但是没有API可以区分是scroll事件是用户行为触发还是程序触发，这里hack的方式是使用flag来区分。代码如下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let ro = new ResizeObserver()

function initScrollPositionChat(chat) {
  let chatText = chat.firstElementChild

  chatText.resizeHandler = entry =&amp;gt; {
    let chat = entry.target.parentNode;

    // 判断flag
    if (!chat.saveUserScroll) {
      chat.isResizeScrollEvent = true;
      chat.scrollTop = chat.scrollHeight - chat.clientHeight;
    }
  }

  ro.observe(chatText)

  chat.addEventListener(&amp;#39;scroll&amp;#39;, ev =&amp;gt; {
    // Ignore scrolls generated by ResizeObserver
    if (chat.isResizeScrollEvent) {
      delete chat.isResizeScrollEvent;
      return;
    }

    // 保存用户的位置，除非已经滚动到底部了
    if (chat.scrollTop != chat.scrollHeight - chat.clientHeight) {
      chat.saveUserScroll = true;
    } else {
      chat.saveUserScroll = false;
    }
  });
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;Resize Observer API目前还有很多特性处于草稿阶段，有兴趣的朋友可以前往&lt;a href=&quot;https://www.w3.org/TR/resize-observer/#intro&quot; class=&quot;link-underline&quot;&gt;w3.org&lt;/a&gt;查阅&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;三个Observer的对比&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%89%E4%B8%AAObserver%E7%9A%84%E5%AF%B9%E6%AF%94&quot; aria-label=&quot;三个Observer的对比 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;三个Observer的对比&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3fde7b6b445b8eb5a773e0f1e520c79b/8ad1b/observers.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 204.2553191489362%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAApCAYAAAA1bQl+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAE0ElEQVRIx41XaXfiOgzt//9178xWYIDsceJ9i0MLM/cdi6W0UKYfdByIuZaurmTxNE2veGjxBTG+0HM8PV9bSq+Xd3l9+ifg9P4HKe0vpriBGA1CBj/tefoK0BnM2QlSOkjpEbSHHhXqikFyc9n79NGDe2Hl0yc/E4jPZgImYeAGibHjCHb6AHgFdn5OVzalPSaXMIUZaT7QATlMySRYx+Hyu2vAeO1hDs3NsBdLcH6HmD00ESHMMMqDdQLeJeLyNinnsMKMKC04k+C9wNgJjL2AYBJxEHDKIWoPxzVYMxBg/n0Iu3uAOawJk/bHLF6HnT9rBzMocG4wdBx12WPsJWLYYbf7Q/J5xyF5mAFtJPCbpLgEyzUkt2hqhufnDaqiQ1X2WK4bcOHo4FtAExAzL6cEXWfZKk9cikGjrges1zWaeiDZWBPvcPgB8MjL2Y6gOQIrLPHaFB34oLDbHW5l8xHwTZdHC34C5wLa+Pe6/SD+fwJ662CUgDcCZdlACEO6PL+/1m/8Z8gUpsUUsw4DjFJQUiHG3U1ZfslD2hQCUjpgSgfMu7+wSkJwcQN4tgeA+fsJ0TlY48mCNXBqQFl1UOook4+g72qZ6tWcdJiFHicEw6GlhlYGXo8IugcfR3ibk7O/9fBNvLlSIoJkGNgA1g+wokUKBvMOmOc/FLKRAkVRUxu7152ejk3zlXhKMVISjpWSa9vDKYa+52BsxDAICM7JQ2f9RfRnaZGH87wHYwOapoUPFiGcQiEqEoLVsMZRIqqyQlM3aJuWDuG5FKWBVg5aO2oSFw/ntIePCSZn9QI4YwrxmF1tUFUtNpsSv9cFFsvfWK02WK7WKMsaWuljyJcsxVe4ML0BnvXl3en+GLH6XWG1rlBWPbZFh9W6xrbssNm26HrxluVItbq/C+ithVMjjBiwXBV4XqyxLWoILtG1md8RXTdAcHUFGO8DHgnfIQUHLRgWyy2Wqw2+/1jg2/cFlWIGzFQIoamJPAQ8dpyjArTkxNtyucZmUxBvfcfQNh3quqWkvd0pn3l4ucz3VClV3aPtBlRVByk0nAvQ2sJoB2fDFzy8Eq7UHh0TEMqRcWlpzfxfX1R3AacLhy8Q2kIYg1EptIzDhxlzOtwMAu+6zT1AynBM8CGRpJTxYFxhzEK2EfcGhAeAx80uJjApCWjgCtoFcGVQNgxKB/iwewf2AfAobBviaRg6ELgJHvN8oGpyfoJQBsZFcGlg3XTTF2881N7R5OD9DOUtBiUxCgNhHJRWqJse3SjBRk1ePgDM88oMYQ26QaAfBVrdw/hInmQutfeou5GynQ/Makgnvj+dvmhT2lMmc/ijVhDKYhAaDRtRtB1Z2WVPBb3LXSac+Hz6bJTLmaXu4wNJpR04VkWNn6stlpsK67JF2TIyriyUCZ9PsJfGEBLRkBPS9CO2VY+iZrT+92OFb7/W+PG8wWJdQWn/BcDsoYtwccK26fBzUeD78xpVO6JsBqy2Da2bsqPKeZtt7gHG10uljFaiZgN58nO5xaZsUbUDGsapeup+pIMfDu2XxjAdEKYZVcfwa1ng16qgUJ9XJTom0TKBtueX6nkY8tuN+IKqGyjc7OFyXaEfFVn2NIM+TMq9fwDZg9xdpPK0upDIskadT6SEDPg/96M+qYoH5U8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Observer.png&quot;
        title=&quot;Observer.png&quot;
        src=&quot;/static/3fde7b6b445b8eb5a773e0f1e520c79b/1d69c/observers.png&quot;
        srcset=&quot;/static/3fde7b6b445b8eb5a773e0f1e520c79b/4dcb9/observers.png 188w,
/static/3fde7b6b445b8eb5a773e0f1e520c79b/5ff7e/observers.png 375w,
/static/3fde7b6b445b8eb5a773e0f1e520c79b/1d69c/observers.png 750w,
/static/3fde7b6b445b8eb5a773e0f1e520c79b/78797/observers.png 1125w,
/static/3fde7b6b445b8eb5a773e0f1e520c79b/aa440/observers.png 1500w,
/static/3fde7b6b445b8eb5a773e0f1e520c79b/8ad1b/observers.png 2320w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;参考&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%82%E8%80%83&quot; aria-label=&quot;参考 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;参考&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://developers.google.com/web/updates/2016/04/intersectionobserver&quot; class=&quot;link-underline&quot;&gt;IntersectionObserver’s Coming into View&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/w3c/IntersectionObserver/blob/master/explainer.md&quot; class=&quot;link-underline&quot;&gt;IntersectionObserver explainer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://web.dev/resize-observer/&quot; class=&quot;link-underline&quot;&gt;ResizeObserver: it’s like document.onresize for elements&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[从getBoundingClientRect到Intersection Observer]]></title><description><![CDATA[平时在写页面交互的时候经常使用兼容性不错的 getBoundindClientReact 方法，以快速获取元素大小和元素位置。最近无意中看到getBoundingClientRect方法会导致 Reflow的说法，但是并没有提及为什么，很是好奇，遂研究了一番。 我按照以下顺序，…]]></description><link>https://zhanglun.github.io/blogs/从getBoundingClientRect到Intersection Observer/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/从getBoundingClientRect到Intersection Observer/</guid><pubDate>Thu, 23 May 2019 12:54:17 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;平时在写页面交互的时候经常使用兼容性不错的 getBoundindClientReact 方法，以快速获取元素大小和元素位置。最近无意中看到getBoundingClientRect方法会导致 Reflow的说法，但是并没有提及为什么，很是好奇，遂研究了一番。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p class=&quot;para&quot;&gt;我按照以下顺序，一一介绍相关内容&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;常见的几种获取元素大小和位置的方法&lt;/li&gt;
&lt;li&gt;getBoundingClientRect()的用法&lt;/li&gt;
&lt;li&gt;Repaint 和 Reflow&lt;/li&gt;
&lt;li&gt;为什么 getBoundingClientRect() 会触发 Reflow&lt;/li&gt;
&lt;li&gt;使用IntersectionObserver监听元素位置&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;常见的几种获取元素大小和位置的方法&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%87%A0%E7%A7%8D%E8%8E%B7%E5%8F%96%E5%85%83%E7%B4%A0%E5%A4%A7%E5%B0%8F%E5%92%8C%E4%BD%8D%E7%BD%AE%E7%9A%84%E6%96%B9%E6%B3%95&quot; aria-label=&quot;常见的几种获取元素大小和位置的方法 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;常见的几种获取元素大小和位置的方法&lt;/h2&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;获取元素大小&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%8E%B7%E5%8F%96%E5%85%83%E7%B4%A0%E5%A4%A7%E5%B0%8F&quot; aria-label=&quot;获取元素大小 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;获取元素大小&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在DOM中提供了多个与元素宽高相关的方法，想要确认元素的宽高时有几种属性可以选择。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;offsetWidth和offsetHeight&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#offsetWidth%E5%92%8CoffsetHeight&quot; aria-label=&quot;offsetWidth和offsetHeight permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;strong&gt;offsetWidth和offsetHeight&lt;/strong&gt;&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;分别返回元素包含边框以内的宽和高&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e996fa32a4e72dfd40f6e5076405c788/c7a90/Xnip2020-05-23_22-35-05.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 71.27659574468085%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAQQA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAbCghszrP//EABgQAAIDAAAAAAAAAAAAAAAAAAECABET/9oACAEBAAEFAhbM4KLMTeBYT//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EAB0QAAIBBAMAAAAAAAAAAAAAAAECEQADECEjMWH/2gAIAQEABj8CfkcQ0aqRcfsYYi4wndbuMfMf/8QAGxABAQEAAgMAAAAAAAAAAAAAAREAECExcYH/2gAIAQEAAT8hD7QARPBr2kKKTt9YclZegkyAHUak6+cf/9oADAMBAAIAAwAAABCPz//EABcRAAMBAAAAAAAAAAAAAAAAABARITH/2gAIAQMBAT8Qr0f/xAAXEQADAQAAAAAAAAAAAAAAAAABEBEx/9oACAECAQE/EIJi/8QAGhABAAIDAQAAAAAAAAAAAAAAAQARITFBUf/aAAgBAQABPxAUQJ0AnResCOhKoEdW0+zBpxjUIKKnkoOl8OwIdulihPWz2BRP/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;1&quot;
        title=&quot;1&quot;
        src=&quot;/static/e996fa32a4e72dfd40f6e5076405c788/acb04/Xnip2020-05-23_22-35-05.jpg&quot;
        srcset=&quot;/static/e996fa32a4e72dfd40f6e5076405c788/bc01b/Xnip2020-05-23_22-35-05.jpg 188w,
/static/e996fa32a4e72dfd40f6e5076405c788/bf173/Xnip2020-05-23_22-35-05.jpg 375w,
/static/e996fa32a4e72dfd40f6e5076405c788/acb04/Xnip2020-05-23_22-35-05.jpg 750w,
/static/e996fa32a4e72dfd40f6e5076405c788/ec605/Xnip2020-05-23_22-35-05.jpg 1125w,
/static/e996fa32a4e72dfd40f6e5076405c788/c58a3/Xnip2020-05-23_22-35-05.jpg 1500w,
/static/e996fa32a4e72dfd40f6e5076405c788/c7a90/Xnip2020-05-23_22-35-05.jpg 2056w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;clientWidth和clientHeight&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#clientWidth%E5%92%8CclientHeight&quot; aria-label=&quot;clientWidth和clientHeight permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;strong&gt;clientWidth和clientHeight&lt;/strong&gt;&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;分别返回元素包含内边距以内的宽和高&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6425644b152f8b0fbf9f3b31be7c4372/28062/Xnip2020-05-23_22-47-03.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 70.2127659574468%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEEA//EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAGxbqG4Cz//xAAZEAEBAAMBAAAAAAAAAAAAAAACAQAQExL/2gAIAQEAAQUCnpVxA5xsvFLX/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAEEH/2gAIAQIBAT8Bh//EAB0QAAIBBAMAAAAAAAAAAAAAAAERAgADECEjMVH/2gAIAQEABj8CnySCktUxcl2MSVwhlqt3ZEeY/8QAGhABAQEBAAMAAAAAAAAAAAAAAREAIRBBgf/aAAgBAQABPyErIkBEwRuFGTrhyoPsAaQLAeD188f/2gAMAwEAAgADAAAAEMzP/8QAFhEAAwAAAAAAAAAAAAAAAAAAEBEh/9oACAEDAQE/EKx//8QAFxEAAwEAAAAAAAAAAAAAAAAAARARQf/aAAgBAgEBPxCDC//EABoQAQACAwEAAAAAAAAAAAAAAAEAESExQVH/2gAIAQEAAT8QDTm9QB6X2MV0juBHRfZYdxjUXvBjLavKXz2IdhqMVCZLbPYFE//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;2&quot;
        title=&quot;2&quot;
        src=&quot;/static/6425644b152f8b0fbf9f3b31be7c4372/acb04/Xnip2020-05-23_22-47-03.jpg&quot;
        srcset=&quot;/static/6425644b152f8b0fbf9f3b31be7c4372/bc01b/Xnip2020-05-23_22-47-03.jpg 188w,
/static/6425644b152f8b0fbf9f3b31be7c4372/bf173/Xnip2020-05-23_22-47-03.jpg 375w,
/static/6425644b152f8b0fbf9f3b31be7c4372/acb04/Xnip2020-05-23_22-47-03.jpg 750w,
/static/6425644b152f8b0fbf9f3b31be7c4372/ec605/Xnip2020-05-23_22-47-03.jpg 1125w,
/static/6425644b152f8b0fbf9f3b31be7c4372/c58a3/Xnip2020-05-23_22-47-03.jpg 1500w,
/static/6425644b152f8b0fbf9f3b31be7c4372/28062/Xnip2020-05-23_22-47-03.jpg 2044w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;scorllHeight&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#scorllHeight&quot; aria-label=&quot;scorllHeight permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;strong&gt;scorllHeight&lt;/strong&gt;&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;分别返回元素内容的宽和高，包括由于溢出导致的视图中不可见内容。测量方式与clientWidth(clientHeight)相同，包含元素的内边距，但不包括边框，外边距或垂直滚动条&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/64b79265fa4bc21cb9ac8e292aa7ba9c/2b327/Xnip2020-05-23_23-06-40.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 88.82978723404256%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAIBBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAv/aAAwDAQACEAMQAAAB6duJeqKZIWD/xAAbEAADAAIDAAAAAAAAAAAAAAAAAQIDEBESIf/aAAgBAQABBQJc0exZeKVaxrsMWv/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAECAQE/ASP/xAAfEAABAwMFAAAAAAAAAAAAAAABAiEiABAxIDJBQlH/2gAIAQEABj8CVJe44NIkvPJt2d2VQM29On//xAAZEAEAAwEBAAAAAAAAAAAAAAABABExIUH/2gAIAQEAAT8hCJzMALmWg1Sy+MuOKfZYdgegrlrDJhmIZP/aAAwDAQACAAMAAAAQnABA/8QAFhEBAQEAAAAAAAAAAAAAAAAAAREg/9oACAEDAQE/EFbj/8QAFxEBAAMAAAAAAAAAAAAAAAAAAREgIf/aAAgBAgEBPxAEaU//xAAaEAEBAQEBAQEAAAAAAAAAAAABEQAxIUFh/9oACAEBAAE/ED9kCTCAk1TTU8FuQ+mKvjkU9IAU+sHItqIUZLH8XOhOPuA0Nz3Df//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;3&quot;
        title=&quot;3&quot;
        src=&quot;/static/64b79265fa4bc21cb9ac8e292aa7ba9c/acb04/Xnip2020-05-23_23-06-40.jpg&quot;
        srcset=&quot;/static/64b79265fa4bc21cb9ac8e292aa7ba9c/bc01b/Xnip2020-05-23_23-06-40.jpg 188w,
/static/64b79265fa4bc21cb9ac8e292aa7ba9c/bf173/Xnip2020-05-23_23-06-40.jpg 375w,
/static/64b79265fa4bc21cb9ac8e292aa7ba9c/acb04/Xnip2020-05-23_23-06-40.jpg 750w,
/static/64b79265fa4bc21cb9ac8e292aa7ba9c/ec605/Xnip2020-05-23_23-06-40.jpg 1125w,
/static/64b79265fa4bc21cb9ac8e292aa7ba9c/c58a3/Xnip2020-05-23_23-06-40.jpg 1500w,
/static/64b79265fa4bc21cb9ac8e292aa7ba9c/2b327/Xnip2020-05-23_23-06-40.jpg 2202w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;获取元素位置&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%8E%B7%E5%8F%96%E5%85%83%E7%B4%A0%E4%BD%8D%E7%BD%AE&quot; aria-label=&quot;获取元素位置 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;获取元素位置&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在实际应用中，获取元素位置主要是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;获取元素相对视图窗口(viewport)上右下左的具体数值&lt;/li&gt;
&lt;li&gt;获取元素相对父元素上右下左的具体数值&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;这里将用到&lt;code&gt;offsetTop&lt;/code&gt;、&lt;code&gt;offsetLeft&lt;/code&gt; 和 &lt;code&gt;offsetParent&lt;/code&gt; 三个属性&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;offsetParent&lt;/code&gt;返回一个指向最近的（指包含层级上的最近）包含该元素的定位元素或者最近的 table,td,th,body元素。当元素的 &lt;code&gt;style.display&lt;/code&gt; 设置为 “none” 时，&lt;code&gt;offsetParent&lt;/code&gt; 返回 &lt;code&gt;null&lt;/code&gt;。如果元素没有设置了定位属性的父元素，也会返回 &lt;code&gt;null&lt;/code&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;offsetTop/offsetLeft&lt;/code&gt;用来获取当前元素（不包括上边框） 相对于 &lt;code&gt;offsetParent&lt;/code&gt; 的位置。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;也就是说:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果所有祖先元素都是静态定位 &lt;code&gt;position:static;&lt;/code&gt;（默认情况），&lt;code&gt;offsetTop&lt;/code&gt; 表示与 &lt;code&gt;Document&lt;/code&gt; 最上方的高度差（文档最上方可能已经滚出视口，这个高度可能大于视口高度）。&lt;/li&gt;
&lt;li&gt;如果存在绝对定位的祖先元素 &lt;code&gt;position:absolute/fixed&lt;/code&gt;，&lt;code&gt;offsetTop&lt;/code&gt; 就会相对于这个元素。&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;因此为了获取相对于 &lt;code&gt;Document&lt;/code&gt; 最上方的高度差，需要递归地调用：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;ts&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function getOffsetPosition(el:HTMLElement): number {
  return el.offsetParent
    ? el.offsetTop + getOffsetTop(el.offsetParent)
    : el.offsetTop
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;按照上面的说法，使用offset三兄弟来获取元素到父元素的距离时，必须得实现将目标父元素设置为定位元素。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果想要获取任意两个元素之间的距离，该怎么办呢？这时候可以使用&lt;code&gt;getBoundingClientReact()&lt;/code&gt;了&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;getBoundingClientRect&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#getBoundingClientRect&quot; aria-label=&quot;getBoundingClientRect permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;getBoundingClientRect()&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;该方法返回元素的大小和当前相对视窗(viewport)的位置，通常大家都用这个方法来判断元素是否出现在可视窗口中。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;ts&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const reactObject: DOMRect = $Element.getBoudingClientRect()&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;举个例子&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;div id=&amp;quot;foo&amp;quot;&amp;gt;Hello World&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;调用id为foo的div的&lt;code&gt;getBoundingClientRect()&lt;/code&gt;方法：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;ts&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;document.getElementById(&amp;#39;foo&amp;#39;).getBoundingClientRect();
// =&amp;gt;  {
//       top: Number,
//       left: Number,
//       right: Number,
//       bottom: Number,
//       x: Number,
//       y: Number,
//       width: Number,
//       height: Number,
//     }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/662231386295b75c0fbff01bd90a13a6/3f513/Xnip2020-05-24_10-25-34.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 33.51063829787234%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3LAD/8QAFRABAQAAAAAAAAAAAAAAAAAAARD/2gAIAQEAAQUCL//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABcQAAMBAAAAAAAAAAAAAAAAAAABEBH/2gAIAQEAAT8hQyf/2gAMAwEAAgADAAAAEIPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRABAAIDAAAAAAAAAAAAAAAAAQAREEHw/9oACAEBAAE/ECFEL1Kc4//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Xnip2020-05-24_10-25-34.jpg&quot;
        title=&quot;Xnip2020-05-24_10-25-34.jpg&quot;
        src=&quot;/static/662231386295b75c0fbff01bd90a13a6/acb04/Xnip2020-05-24_10-25-34.jpg&quot;
        srcset=&quot;/static/662231386295b75c0fbff01bd90a13a6/bc01b/Xnip2020-05-24_10-25-34.jpg 188w,
/static/662231386295b75c0fbff01bd90a13a6/bf173/Xnip2020-05-24_10-25-34.jpg 375w,
/static/662231386295b75c0fbff01bd90a13a6/acb04/Xnip2020-05-24_10-25-34.jpg 750w,
/static/662231386295b75c0fbff01bd90a13a6/3f513/Xnip2020-05-24_10-25-34.jpg 1096w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;每一个字段返回的意义如下图所示：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5e9fcfbd4b75a15e9715480809e3f957/6af66/getBoundingClientRect-1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 140.95744680851067%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFrElEQVRIx41VaXPbVBTVDwD+Al/4E/yQzjAFhmWG6RQY9qEtMzApUxKHLI6hoWni1FntxFksy7scp/G+SZZtSV4kOY5LWyh84Lvd+DD3xQmhwwc0c+a8J713dHTv1X3czMyMfWFhARsbG/3VtTXMzc1hdnaWYWZm5mJ8eW6321/EYMQuzmaz2ZeWluB2u/tutxvT09OYmJhgCx0OB6amppgI8d27dxmPj4/DZrOxdcQ2m20wYhe3vb1t39zchMfj6Xs8HmxtbWF3dxfBYAiiKCKRSODhw4c4ODhAMplk82AwCJ7n4ff74ffzEPz+gSAIEATBxcmybKdFoVCoXywWUS6X0W63EY1EsLi4iGWnk/HWthdOpxPrGxuQFQXP/vwTjx4/weOnT9F79OvgpNfDycmJiysWi3Z6887OTj8WiyGVSqFarSKXL4AXBGx6tnBv4R4iQR5rqyuYm5yA4NlEWowidxhHRoxCq5YHraZGRlxcIZ93HB0dIRKJ9IkzmQxz+cez30GX0XsMh30SC9O38d5bb+CDq1ewfPNjLH/2DtbufALnh2/i8P74oFFNodVqr3BytT4higf0/X1JklAqlaBWFaiPfsNfAA4yBdz/ZRr3x2/h9ddexcsvvYJvr7+Lxu48wou3Idy8hsLKzOC4VULvpLfAxXbdiVBoB5tuz/NQKIRwOIKEGIP/KItwWcWadw8bq04kA9t48N2XuHrlCsbGbmP5wQP4eC/C9+2IrC8+TyfjiMfjOW57xQn3pvOUgr6/v8+y5/P54Pftg9/bRUAQEAwEsO/jEYzGWLbD4TAEIQAhEIAQCkMIBOHz8UOv1wtOCARPDw4SFMMhlQeB4lipVlHXGwiGw3Asb8EbTUEqlVAslyBLdWwubmNxaR4/rexj1Rcb1iplcnjKxWKxIcUtm80yLhQKUCoVKgU8+f0ZwpEIHCt7+IXPQlU1tAwDmm5h4d4uHPN38cPPG9jmo8NHXQPpdGbIRaNR5PN5VrTZbBa5XA6yLKPT7aLeaCEo8DjM5DHmiuIoJ6GuNZDL1MCv+1ErR5GOhCBF/eh2mkglU2CC5Irqjz6VRBVFgabryOaLSKeSzPF6KINUWUXTMCDndRSEGAwtCV0uo5J6iI7ZYhoXDtPpNHNHqCgKWs0mNLUOTVWh1uto6hp0TYWq1qApKhp5BbpaRF3VoaoqTMtiGkyQnKVTaZQKZeRzeSgVBY1mGzW9ibZloWWYDJ2THjq9Ho7NHrqKCctQYFnHaLda6Ha7Zw4ThyKazQZKSg5JKQG5Wka3Y2Jlx4u3b93G+zfHcG1sEl/PP8DVT2/gowk7rn3zI65//j3E0D4qFQWGYeD4+PhMkD8KomLWkNWLCNWOkNdLqFp1uIJefDVjxxfjE7g5O4fJdQ++nJjEjelZ3HL8jFtTNqQzCTSbTdZMLgST6Qw6x120DROW1WFsWBZUTUdZllCpKlBqVYhxkdUgjSVZhiRLbEzxpSSapnkWw3Q6fUrfbxjG0DQN9sCyTDQbDVSVKus8BFmS2cYazRWFPatVL54PO50OCZ5yVH+dTue01Wox6+doNBqo1+v/AmXzxTmBRE3THJIWJ4pim8omm82eUg0SaE7dem9vD4FAAL7RP04dmpj3nf3vNKbufnh4eEq1LIriMWcYxtTIVZ+YnFqWxYqdWj01XSot6kTE0UiUNQdCJBJhidB1fUB7DcNwcqZpzlHcTNPsj5iBSoFwORQ0v8wEip1lWYPRPhcJ2kcCfVp4Lkgu/w9G6/8RpEOqVqtB07S+pmksk5VKhTUI6uCXx8Q0/w8MRnwmSEfg/Px8/86dOyzwtDkej7NmSichMcXvPGHn//wlDEbs4iRJstMGOuhXV1dZEsgJsZ/nWXJIjDJKCaAXkCjdv4TBiF1cPp+30yJJkvokdL6B3khN4/KYHNJGuveC6IXg39up/CJemXX+AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;getBoundingClientRect-1.png&quot;
        title=&quot;getBoundingClientRect-1.png&quot;
        src=&quot;/static/5e9fcfbd4b75a15e9715480809e3f957/6af66/getBoundingClientRect-1.png&quot;
        srcset=&quot;/static/5e9fcfbd4b75a15e9715480809e3f957/4dcb9/getBoundingClientRect-1.png 188w,
/static/5e9fcfbd4b75a15e9715480809e3f957/5ff7e/getBoundingClientRect-1.png 375w,
/static/5e9fcfbd4b75a15e9715480809e3f957/6af66/getBoundingClientRect-1.png 640w&quot;
        sizes=&quot;(max-width: 640px) 100vw, 640px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;因为&lt;code&gt;getBoundingClientRect&lt;/code&gt;是相对viewport计算的，所以可以使用&lt;code&gt;window.scrollY&lt;/code&gt;和&lt;code&gt;window.scrollX&lt;/code&gt;和返回的&lt;code&gt;x&lt;/code&gt;,&lt;code&gt;y&lt;/code&gt;做计算，得出元素相对整个页面的距离。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;ts&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const offsetLeft = window.scrollX + $0.getBoundingClientRect().left
const offsetTop = window.scrollY + $0.getBoundingClientRect().top&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;可以使用这种方法来计算任意两个元素之间的记录，按照上述方式分别计算两个元素的结果再做差值即可&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Repaint和Reflow&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Repaint%E5%92%8CReflow&quot; aria-label=&quot;Repaint和Reflow permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Repaint和Reflow&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;为什么要谈谈 Repaint 和 Reflow？如果搜索相关关键字，会发现几乎所有的将 Repaint 和 Reflow的文章，都会提到前面所提及的那些属性和方法，但没有明说到底是为什么。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;再说 Repaint 和 Reflow 之前先简单介绍一下浏览器如何渲染网页的。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;从服务器接受数据&lt;/li&gt;
&lt;li&gt;将文档解析成Tokens&amp;#x3C;, TagName, Attribute, AttributeValue, &gt;)&lt;/li&gt;
&lt;li&gt;将Tokens转换成Node节点&lt;/li&gt;
&lt;li&gt;利用Node节点生成DOM树&lt;/li&gt;
&lt;li&gt;解析CSS,创建CSSOM&lt;/li&gt;
&lt;li&gt;CSSOM和DOM树合并成一个RenderTree&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;RenderTree只包含渲染网页所需的节点&lt;/li&gt;
&lt;li&gt;从DOM树的根节点开始，计算那些显示的元素和对应的计算属性。不显示的元素(meta, script, link标签和display: none)将会忽略&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;7&quot;&gt;
&lt;li&gt;Reflow：计算每一个可见元素的布局，精确的位置和大小(Layout tree)&lt;/li&gt;
&lt;li&gt;Repaint：将像素渲染到屏幕中&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/523e1ddab75f068dba44bfc41d2f1d8c/1ffbd/dom-tree.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 24.468085106382976%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHUlEQVQY03WQW0vCAACF98eD/kJEhGAQ1Jt0MxIlDUEryTajB02nzevUOZ27tWv7QqEXo+/pnKdz+IQr8ZSD/B59XWbDcNnlsLBP5iVNGAf8YpoWX563zUmS8B/Cu9ag1M8zt+Z4tsdIH1Idl3mbi5i2Reh7lFsLUoUm6ZKMagaIlRGX5xK5TJP10mVQFJHOCnSyTwiaVEMp3hKs9O1CbK3p3WdR69XNFRzbpjUyeJTX1BWL6cqm97FAeh7TqKmsdBPlQeL16Ib2RQXBuMuhHqdwFAU7ijA6HUbpE7TrLK5lEQQBKydE1jwGSx8/SjB0j9nYYT5xiMIYsz9jWm+jtwYI4WyK35WJXJf4OyG0bQLlk1CdEEfRH0e7/nb7DxDEb/T3/781AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;dom-tree.png&quot;
        title=&quot;dom-tree.png&quot;
        src=&quot;/static/523e1ddab75f068dba44bfc41d2f1d8c/1d69c/dom-tree.png&quot;
        srcset=&quot;/static/523e1ddab75f068dba44bfc41d2f1d8c/4dcb9/dom-tree.png 188w,
/static/523e1ddab75f068dba44bfc41d2f1d8c/5ff7e/dom-tree.png 375w,
/static/523e1ddab75f068dba44bfc41d2f1d8c/1d69c/dom-tree.png 750w,
/static/523e1ddab75f068dba44bfc41d2f1d8c/78797/dom-tree.png 1125w,
/static/523e1ddab75f068dba44bfc41d2f1d8c/aa440/dom-tree.png 1500w,
/static/523e1ddab75f068dba44bfc41d2f1d8c/1ffbd/dom-tree.png 2108w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;为什么-getBoundingClientRect-会触发-Reflow&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BA%E4%BB%80%E4%B9%88-getBoundingClientRect-%E4%BC%9A%E8%A7%A6%E5%8F%91-Reflow&quot; aria-label=&quot;为什么 getBoundingClientRect 会触发 Reflow permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;为什么 getBoundingClientRect() 会触发 Reflow&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;offsetTop&lt;/code&gt;、&lt;code&gt;offsetLeft&lt;/code&gt;和&lt;code&gt;getBoundingClientRect&lt;/code&gt;皆需要重新计算元素在布局中的精确位置或者大小，这必然会触发Reflow。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在 chromium 的源码中可以找到代码：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;offsetTop/offsetLeft&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/frame/visual_viewport.cc;l=435-461;drc=a3c165458e524bdc55db15d2a5714bb9a0c69c70?originalUrl=https:%2F%2Fcs.chromium.org%2F&quot; class=&quot;link-underline&quot;&gt;source&lt;/a&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;c++&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;double VisualViewport::OffsetLeft() const {
  if (!MainFrame())
    return 0;

  UpdateStyleAndLayout(DocumentUpdateReason::kJavaScript);

  return VisibleRect().X() / MainFrame()-&amp;gt;PageZoomFactor();
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;其中&lt;code&gt;UpdateStyleAndLayout&lt;/code&gt;方法调用之后将会触发LayoutTree的重新渲染，也就是我们说的Reflow&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;再比如&lt;code&gt;element.innerText&lt;/code&gt;中调用的&lt;code&gt;UpdateStyleAndLayoutForNode&lt;/code&gt;，最后也是通过调用&lt;code&gt;UpdateStyleAndLayout&lt;/code&gt;触发Reflow。&lt;a href=&quot;https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/dom/document.cc;l=2786-2794;drc=7f2a66319b71e1cd3be556aeaa50cd18d1be70c1&quot; class=&quot;link-underline&quot;&gt;source&lt;/a&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;c++&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;String Element::innerText() {
  // We need to update layout, since |ElementInnerTextCollector()| uses line
  // boxes in the layout tree.
  GetDocument().UpdateStyleAndLayoutForNode(this,
                                            DocumentUpdateReason::kJavaScript);
  return ElementInnerTextCollector().RunOn(*this);
}

// document.cc
void Document::UpdateStyleAndLayoutForNode(const Node* node,
                                           DocumentUpdateReason reason) {
  DCHECK(node);
  if (!node-&amp;gt;InActiveDocument())
    return;

  DisplayLockUtilities::ScopedForcedUpdate scoped_update_forced(node);
  UpdateStyleAndLayout(reason);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;搜索&lt;code&gt;getBoundingClientRect&lt;/code&gt;可以在&lt;code&gt;rang.cc&lt;/code&gt;中找到对应的代码 &lt;a href=&quot;https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/dom/range.cc;l=1620-1622;drc=7f2a66319b71e1cd3be556aeaa50cd18d1be70c1;bpv=1;bpt=1?q=getBoundingClientRect&amp;#x26;ss=chromium%2Fchromium%2Fsrc&amp;#x26;originalUrl=https:%2F%2Fcs.chromium.org%2F&quot; class=&quot;link-underline&quot;&gt;source&lt;/a&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;c++&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;DOMRect* Range::getBoundingClientRect() const {
  return DOMRect::FromFloatRect(BoundingRect());
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;BoundingRect()&lt;/code&gt;中调用了&lt;code&gt;UpdateStyleAndLayout()&lt;/code&gt; &lt;a href=&quot;https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/dom/range.cc;l=1732-1747;drc=7f2a66319b71e1cd3be556aeaa50cd18d1be70c1;bpv=1;bpt=1?q=getBoundingClientRect&amp;#x26;ss=chromium%2Fchromium%2Fsrc&amp;#x26;originalUrl=https:%2F%2Fcs.chromium.org%2F&quot; class=&quot;link-underline&quot;&gt;source&lt;/a&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;c++&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;FloatRect Range::BoundingRect() const {
  owner_document_-&amp;gt;UpdateStyleAndLayout(DocumentUpdateReason::kJavaScript);

  Vector&amp;lt;FloatQuad&amp;gt; quads;
  GetBorderAndTextQuads(quads);

  FloatRect result;
  for (const FloatQuad&amp;amp; quad : quads)
    result.Unite(quad.BoundingBox());  // Skips empty rects.

  // If all rects are empty, return the first rect.
  if (result.IsEmpty() &amp;amp;&amp;amp; !quads.IsEmpty())
    return quads.front().BoundingBox();

  return result;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;好吧 说了半天，都是因为代码就这么写的&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Intersection-Observer-API&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Intersection-Observer-API&quot; aria-label=&quot;Intersection Observer API permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Intersection Observer API&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;一直以来，检测元素的可视状态或者两个元素的相对可视状态都得使用前文中提到的几个属性，但是不幸的是，这些属性都会触发 Reflow。Reflow有GUI渲染线程管理，而GUI渲染线程与JS引擎线程互斥，在一定程度上来说容易拖慢网页的性能(抛开计量谈毒性都是耍流氓)。但是有些情况都需要能都检测到元素可视状态的变化，比如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;当页面滚动时，懒加载图片或其他内容。&lt;/li&gt;
&lt;li&gt;实现“可无限滚动”网站，也就是当用户滚动网页时直接加载更多内容，无需翻页。&lt;/li&gt;
&lt;li&gt;为计算广告收益，检测其广告元素的曝光情况。&lt;/li&gt;
&lt;li&gt;根据用户是否已滚动到相应区域来灵活开始执行任务或动画。&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;Intersection Observer API 会注册一个回调方法，每当期望被监视的元素进入或者退出另外一个元素的时候(或者浏览器的视口)该回调方法将会被执行，或者两个元素的交集部分大小发生变化的时候回调方法也会被执行。通过这种方式，网站将不需要为了监听两个元素的交集变化而在主线程(GUI渲染线程)里面做任何操作，并且浏览器可以帮助我们优化和管理两个元素的交集变化。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;通过 Intersection Observer API 获取到两个元素重叠部分的准确值(这可能也是他不需要重新计算的原因吧)。最常用的使用方式是：如果两个元素发生的交集部分在 N% 左右时，需要做处理一些事情(执行回调)”&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;创建一个-intersection-observer&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-intersection-observer&quot; aria-label=&quot;创建一个 intersection observer permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建一个 intersection observer&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;它的API非常简单。构造函数有两个参数。callback是触发时调用的回调函数，在目标(target)元素和根(root)元素的交集大小超过阈值(threshold)规定的大小时候被执行。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const options = {
    root: document.querySelector(&amp;#39;#scrollArea&amp;#39;), 
    rootMargin: &amp;#39;0px&amp;#39;, 
    threshold: 1.0
}
const observer = new IntersectionObserver(callback, option)
const target = document.querySelector(&amp;#39;#listItem&amp;#39;)

observer.observe(target)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;Intersection-observer-options&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Intersection-observer-options&quot; aria-label=&quot;Intersection observer options permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;strong&gt;Intersection observer options&lt;/strong&gt;&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;传递到IntersectionObserver()构造函数的 options 对象包含以下字段：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;root&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;指定根(root)元素，用于检查目标的可见性。必须是目标元素的父级元素。&lt;/li&gt;
&lt;li&gt;如果未指定或者为null，则默认为浏览器视窗。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;rootMargin&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;根元素的外边距。类似于css中的 margin 属性，比如 “10px 20px 30px 40px” (top, right, bottom, left)。&lt;/li&gt;
&lt;li&gt;如果有指定root参数，则rootMargin也可以使用百分比来取值。该属性值是用作root元素和target发生交集时候的计算交集的区域范围，使用该属性可以控制root元素每一边的收缩或者扩张。&lt;/li&gt;
&lt;li&gt;默认值为0。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;threshold&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;可以是一个数字也可以是一个数字数组。目标元素和根元素相交程度达到该值的时候IntersectionObserver注册的回调函数将会被执行。&lt;/li&gt;
&lt;li&gt;如果你只是想要探测当target元素的在root元素中的可见性超过50%的时候，你可以指定该属性值为0.5。&lt;/li&gt;
&lt;li&gt;如果你想要target元素在root元素的可见程度每多25%就执行一次回调，那么你可以指定一个数组[0, 0.25, 0.5, 0.75, 1]。&lt;/li&gt;
&lt;li&gt;默认值是0(意味着只要有一个target像素出现在root元素中，回调函数将会被执行)。&lt;/li&gt;
&lt;li&gt;该值为1.0含义是当target完全出现在root元素中时候 回调才会被执行。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;callback&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#callback&quot; aria-label=&quot;callback permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;strong&gt;callback&lt;/strong&gt;&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;回调接收 IntersectionObserverEntry 对象和观察者的列表：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;ts&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var callback = function(entries: IntersectionObserverEntry[], observer: IntersectionObserver) { 
  entries.forEach(entry =&amp;gt; {
    // Each entry describes an intersection change for one observed
    // target element:
    //   entry.boundingClientRect
    //   entry.intersectionRatio
    //   entry.intersectionRect
    //   entry.isIntersecting
    //   entry.rootBounds
    //   entry.target
    //   entry.time
  });
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;entries&lt;/code&gt;是一个数组，和&lt;code&gt;threshold&lt;/code&gt;对应。即使&lt;code&gt;threshold&lt;/code&gt;输入的是一个数字，&lt;code&gt;entries&lt;/code&gt;也会返回数组。下图是&lt;code&gt;IntersectionObserverEntry&lt;/code&gt;的结构&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2d9e4db5e60c060aa6af53a7319481c0/8b936/intersection-observer-api.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 94.14893617021278%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/UlEQVQ4y5WS607jMBCFef93QkICAYW2QuJWlTaEpElz8yUXO47j8awGCltWXbo7GkX+4eOc+c6cGGOSKIneomAVBOvXIAjykltrYRgQAI3Brtu1Uugc7tUJIva1YSvGoqaXRnLBWMU5t0LQ1ZcXvLjAyQTnc7y+xqcnTBLcbDCOMYpIDBZEVKexsRb/LAB6AgC9p6+15OWzSeyME3GdbwfTg0cP4D+KBF+1f9637R2UG1VLwP8sEo+Dbcq+r02e5tu0ShOuOm+0I5MAqDWh0pqsKkXktMa6RudIrIQWa87WgsfiLcyWi224KtqYoRC4WOBshjc3OJ3i7S3e3xOz6ZTgcf4+8+D4q8g25j2Ij9n87gBwxDZYJ6M6SwatYIfGoz94/QP7J7+duAgbIdxPOf0VmB3rQutm4Fzwindd5/seT0/x4QEfH2m8szMaeDYjBGX5TayEZkteRSII8iwpuu0Wq4oWaz7Huzu8usLzc3prMsHLS3x+/jJCYtMObMnSsGG8UVqptqOQvEfGMMtQSspGCMrpEDDgoajyAY6uyfe1260nC2VVWDf635cAdqj2+8CfARpmrPUjuNGNo3P+39dTN1qmbVt2ZRjzvGirihIqChr4uFhqvmnzjcpjKXndSNFI2QtBnH4WA4CWfS+GTrWMV3YcB2vHcQR/3PsvrBRMEro/rEYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;intersection-observer-api.png&quot;
        title=&quot;intersection-observer-api.png&quot;
        src=&quot;/static/2d9e4db5e60c060aa6af53a7319481c0/1d69c/intersection-observer-api.png&quot;
        srcset=&quot;/static/2d9e4db5e60c060aa6af53a7319481c0/4dcb9/intersection-observer-api.png 188w,
/static/2d9e4db5e60c060aa6af53a7319481c0/5ff7e/intersection-observer-api.png 375w,
/static/2d9e4db5e60c060aa6af53a7319481c0/1d69c/intersection-observer-api.png 750w,
/static/2d9e4db5e60c060aa6af53a7319481c0/78797/intersection-observer-api.png 1125w,
/static/2d9e4db5e60c060aa6af53a7319481c0/8b936/intersection-observer-api.png 1368w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;注意：注册的回调函数将会在主线程中被执行。所以该函数执行速度要尽可能的快。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;参考资料&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99&quot; aria-label=&quot;参考资料 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;参考资料&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://gist.github.com/paulirish/5d52fb081b3570c81e3a&quot; class=&quot;link-underline&quot;&gt;what-forces-layout.md&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.digitalocean.com/community/tutorials/&quot; class=&quot;link-underline&quot;&gt;js-getboundingclientrect&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction?hl=zh-cn&quot; class=&quot;link-underline&quot;&gt;渲染树构建、布局及绘制&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://gist.github.com/faressoft/36cdd64faae21ed22948b458e6bf04d5&quot; class=&quot;link-underline&quot;&gt;dom_performance_Reflow_repaint.md&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API&quot; class=&quot;link-underline&quot;&gt;Intersection Observer API&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[浅谈 HTTP 缓存]]></title><description><![CDATA[说到缓存大家可能觉得很简单。“不就是检查资源是否有缓存，如果有就加以利用”，“可以节约服务器资源呗”。如果再深入一点，有的cache-control, last-modified, etag 之类的名词，但如果真的考究一下这些字段的细节，恐怕大多数人也说不清楚。遂做了一番整理，…]]></description><link>https://zhanglun.github.io/blogs/2019-03-09-浅谈-HTTP-缓存/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2019-03-09-浅谈-HTTP-缓存/</guid><pubDate>Sat, 09 Mar 2019 15:41:38 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;说到缓存大家可能觉得很简单。“不就是检查资源是否有缓存，如果有就加以利用”，“可以节约服务器资源呗”。如果再深入一点，有的cache-control, last-modified, etag 之类的名词，但如果真的考究一下这些字段的细节，恐怕大多数人也说不清楚。遂做了一番整理，希望对大家有所帮助&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;HTTP-缓存&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#HTTP-%E7%BC%93%E5%AD%98&quot; aria-label=&quot;HTTP 缓存 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;HTTP 缓存&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;HTTP 缓存是一种保存资源副本并在下次请求时直接使用该副本的技术。最为常见的是，浏览器在本地缓存 HTML 页面、图片等静态资源文件静态文件。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;A HTTP cache is an information technology for the temporary storage (caching) of web documents, such as HTML pages and images, to reduce server lag. A web cache system stores copies of documents passing through it; subsequent requests may be satisfied from the cache if certain conditions are met. A web cache system can refer either to an appliance, or to a computer program.
摘自 Wiki百科 &lt;a href=&quot;https://www.wikiwand.com/en/Web_cache&quot; class=&quot;link-underline&quot;&gt;Web cache - Wikiwand&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;合理利用缓存可以实现：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;减少冗余数据的传输，节约网络费用&lt;/li&gt;
&lt;li&gt;缓解了网络瓶颈的问题，节约带宽&lt;/li&gt;
&lt;li&gt;降低服务器压力，服务器可以更快的响应&lt;/li&gt;
&lt;li&gt;减少网络延迟，提升站点的访问速度&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 508px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cc0bd3461d2bf5d74d186b9346754f15/2fd48/1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.72340425531915%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzklEQVQoz31Sy47TQBD0RyNx5IYQH8Bt4cCNExJ7Qoq0HFbhwkIikjireMkmtuPHzPgdJ3HiQtXsRJFAjNSye7q7pqq7HWMMfN+H53lIkgRlWaJtW2y32/9aXddQSiGKIriui81mA2I5DBJwNBqhqipkWYaiKJDnuRj9S7P3cRwLIEGGwyG01nLvEMSe4/GIMAwlmYk0gtgvjYUEohLeXx5hSOo8fd9jv99LEYFpu91OWNtv0zTnGO2fgGeGfY9d2+KSMaWnSYLvd3fIjBFmp9PpHGfP2fvJZIIgCMR3mm17TuhOEElkxMHwn+V5tZW4HVjXdTgcDtKe2WyGwWCA1WolA3Li0Ed0/w2b2VeEv1wobaSQ0oMgROp76PQSZbyU3pI1Y2RDQD5Kn+zTNIXz+OMGyacXePzwHOGXt1iFMTKjpV9MuP/4Cj/fP4N//RLL+RhKczhGVocyF4sFptOpSOcDTuSNYW7fIRi8gRp/RpRoVE/S+Gpwc4Xl9WsUt1fwH1wUZSV9ZpwA6/Ua8/lcwLmLjlJ/AKoyh9L6r6FkRmFf52jrUh7gNthj18uuFn2naWrUTSMSCcZm2yLKMlz0skKeF9JbxmycLLl21uj/BtKHPafmUCEGAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;59818e08.png&quot;
        title=&quot;59818e08.png&quot;
        src=&quot;/static/cc0bd3461d2bf5d74d186b9346754f15/2fd48/1.png&quot;
        srcset=&quot;/static/cc0bd3461d2bf5d74d186b9346754f15/4dcb9/1.png 188w,
/static/cc0bd3461d2bf5d74d186b9346754f15/5ff7e/1.png 375w,
/static/cc0bd3461d2bf5d74d186b9346754f15/2fd48/1.png 508w&quot;
        sizes=&quot;(max-width: 508px) 100vw, 508px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如图所示HTTP缓存存在于浏览器和Web代理中。当然在服务器内部，也存在着各种缓存，比如本地缓存GuavaCache/Ehcache，分布式缓存Memcached/Redis等，但这不是本文要讨论的HTTP缓存。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;为了方便描述，下文将用“缓存”代替“HTTP 缓存”&lt;/strong&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;缓存的分类&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BC%93%E5%AD%98%E7%9A%84%E5%88%86%E7%B1%BB&quot; aria-label=&quot;缓存的分类 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;缓存的分类&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在我看来，无论按照什么场景或者维度来划分，HTTP缓存本质上就是两类：客户端缓存和服务端缓存。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为什么这么说呢？因为在两台计算机之间使用HTTP协议通信时，在一条通信线路上，必定一端是客户端，一端是服务端。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;HTTP协议规定，请求从客户端发出，最后服务端响应。换言之，HTTP协议是能够明显区分哪一端是客户端，哪一段是服务端的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;像 &lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching_FAQ#%E5%90%84%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%BC%93%E5%AD%98&quot; class=&quot;link-underline&quot;&gt;MDN文章：HTTP 缓存 - HTTP | MDN&lt;/a&gt; 中提到的私有缓存和共享缓存是从网络的拓扑结构层面来解释。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;至于网上大部分博文中提到的“强缓存”， “协商缓存”，我没有在任何文档中找到这两个关键词的定义，如果有知道的同学，欢迎留言。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;由于前端开发人员多与浏览器打交道，所以日常工作中大多时候会用 “浏览器缓存”来代替“客户端缓存”，这一点无伤大雅。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;HTTP-的简单介绍&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#HTTP-%E7%9A%84%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D&quot; aria-label=&quot;HTTP 的简单介绍 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;HTTP 的简单介绍&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在具体解释HTTP首部字段对缓存的控制规则之前，简单介绍一些与 HTTP 协议有关的内容，作为后续内容的铺垫。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;HTTP-协议&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#HTTP-%E5%8D%8F%E8%AE%AE&quot; aria-label=&quot;HTTP 协议 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;HTTP 协议&lt;/h3&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;HTTP协议是 Hyper Text Transfer Protocol（超文本传输协议）的缩写,是用于从万维网（WWW:World Wide Web ）服务器传输超文本到客户端的传送协议。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;HTTP-报文&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#HTTP-%E6%8A%A5%E6%96%87&quot; aria-label=&quot;HTTP 报文 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;HTTP 报文&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;HTTP 报文是HTTP协议传输的数据单元，即一次请求或者一次响应时，发送给对方的数据块。HTPP报文包含了将要发送的完整的数据信息。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a1c4fb0278b91555593ca4111766ee21/bb051/2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 34.57446808510639%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABQklEQVQoz31QW8uCUBD0//8FK4iwB7OoEH1IehApumA3NDLQikAxjbILvdjELhjxPXwLw549nJmzM4LjOFitVozZbIbFYgHXdfnseR622y3oTRAEuN1uuF6v3Avc73c8Hg9kWcZdmE6nGI/HME0T3W4Xuq6D7gaDAebzOfb7PQsfj0ecTqdvD8MQURQhSRKkacpzHMcQ2u02JEmCKIoolUool8uo1+uoVqvo9/sscDgcmEBbvF4vnM9nPJ9PnkmMtqaZSjAMA6qqotPpQFEUtFotaJqGZrOJ4XCIy+XCYrQp2SbQ7Ps+x0GfkW0SfL/fEHq9Hos1Gg1UKhXUajW2Lssyx7Db7ZhMRNqOSFR5njN+iwWXyyVvMhqNOLvJZMKwLAubzeabIYEyKoh/hYo7Af9UYY9yXK/XsG2bbf6KFELF+QMkn/giAtxpzwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;57450782.png&quot;
        title=&quot;57450782.png&quot;
        src=&quot;/static/a1c4fb0278b91555593ca4111766ee21/1d69c/2.png&quot;
        srcset=&quot;/static/a1c4fb0278b91555593ca4111766ee21/4dcb9/2.png 188w,
/static/a1c4fb0278b91555593ca4111766ee21/5ff7e/2.png 375w,
/static/a1c4fb0278b91555593ca4111766ee21/1d69c/2.png 750w,
/static/a1c4fb0278b91555593ca4111766ee21/78797/2.png 1125w,
/static/a1c4fb0278b91555593ca4111766ee21/bb051/2.png 1212w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;HTTP 报文分为&lt;strong&gt;请求报文&lt;/strong&gt;和&lt;strong&gt;响应报文&lt;/strong&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 709px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d1a8fdbc16d69a472daa174b0f9c73f8/4d08a/3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 34.57446808510639%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABJ0lEQVQoz02R6a6CUAyEz/u/BD+MIXE3GlRccAV3g0oA8V3m5muCuT8mp03bmU6PW61WCoJA4/FYYRjqfD7rcrkYrter5eB+vxsej8cPz+dTr9dLt9tNs9lMp9NJbr1eGyFkkJIfj0dtNhuLkyTRdrvV4XAwYmq73c5yCMiJEWcJR7HX62mxWKjb7RopGAwGGg6Hmk6nFk8mE+tBKIoi4YxZCOM4/gk4iv1+35ohWC6Xtu18Pjfi/X5vjdjCXpZlhjzPVRSFPp+PyrK0OE1TOZjZADWscQtsciOG3u+3vfVQTUT+/X7tBVVVmaDDkud5arVa8n3/Z3U0GpkIFhFiU8QBFhHlpizAbLvdtr9w2Go0Gmo2m1bAPjcFxDXIO52Ooa797+Plzn9OwceVoWL1yAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;2a108fe1.png&quot;
        title=&quot;2a108fe1.png&quot;
        src=&quot;/static/d1a8fdbc16d69a472daa174b0f9c73f8/4d08a/3.png&quot;
        srcset=&quot;/static/d1a8fdbc16d69a472daa174b0f9c73f8/4dcb9/3.png 188w,
/static/d1a8fdbc16d69a472daa174b0f9c73f8/5ff7e/3.png 375w,
/static/d1a8fdbc16d69a472daa174b0f9c73f8/4d08a/3.png 709w&quot;
        sizes=&quot;(max-width: 709px) 100vw, 709px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 713px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9f360c29e6f47acdcf40fb50785b67ed/01267/4.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 57.446808510638306%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkklEQVQoz1WSx8oCQAyE9/3PHjyIKGLvvSv2ir2LzzI/X2DF/zBkSzKZya4bDodqtVrq9/tqNBqaTCZaLpeG9Xr9XR8OBx2PR51Op288n8+6Xq/abDZWz941m01Vq1UjJXIxHo81Go00GAxsDyAHu93uHzkkvgnnrt1uG1GpVFKxWFSn01Gv1xONiKvVyhQuFgvNZjPt93tTdbvdDPf73faXy8WIHSogq9VqRohSSL0KEr01T/B4PPR6vfR8PvX5fPR+v21PrsMehBB1u12hGLso8d1/iSChGEA0n89tNNRst1u5RCKhUCikcDisaDSqTCYjzlKplAqFgrLZrNLptEX2uEBAuVxWpVKxfO4BI3IkRCIRu8jn81ZIBLlczohBMpk0MmaLG4AbXHnwQxzdUEcBykA8HrcGEKIKsIaQRv4RvWKUQs6jmcJgMPhV4AmwxL+s1+umivWvMh+B/xnT6VSO4kAg8LXs54UimgBvnehBHgL4HZ6QB3bI51GwgBISAOd+DVCKSj/D31nSNBaL2aP8AdzBvQX8L8RiAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;20394b00.png&quot;
        title=&quot;20394b00.png&quot;
        src=&quot;/static/9f360c29e6f47acdcf40fb50785b67ed/01267/4.png&quot;
        srcset=&quot;/static/9f360c29e6f47acdcf40fb50785b67ed/4dcb9/4.png 188w,
/static/9f360c29e6f47acdcf40fb50785b67ed/5ff7e/4.png 375w,
/static/9f360c29e6f47acdcf40fb50785b67ed/01267/4.png 713w&quot;
        sizes=&quot;(max-width: 713px) 100vw, 713px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;请求报文和响应报文中必定包含 HTTP 首部，为客户端和服务端分别处理请求和响应提供所需要的信息。首部字段类型按照实际用途分为四种：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;通用首部字段 (General Heaer Fields) - 请求报文和响应报文双方都会使用的首部&lt;/li&gt;
&lt;li&gt;请求首部字段 (Request Header Fields) - 发送请求报文时使用的首部&lt;/li&gt;
&lt;li&gt;响应首部字段 (Resposne Header Fields) - 返回响应报文时使用的首部&lt;/li&gt;
&lt;li&gt;实体首部字段 (Entity Header Fields) - 报文实体部分使用的首部&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 714px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4676810d19234646bd9dc3cb6489543d/d67ca/5.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.191489361702125%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0UlEQVQoz01Sh6pqMRDM//+FvYu9i4qCvaFib2BBRRTFrsxjFnJ5geHsSTa7szNRy+US8/kcw+EQk8kEi8UC3GN8vV7xeDzwer1wOBwwnU4xm83kvN1uo16vSz7vE6vVCqrZbKJSqSASiSAcDqNWq6Hb7aJYLOJ+v0OvzWaDcrmMRqOBXC4Hl8slSCaTYA2C95TH44HBYIDZbIbNZoPdbgf3vF4vTqcTPp/PX0E2YcFoNAqLxQKn0wmfzydMNREVCoUQDAYlwWQySUymfr8ft9sN7/dbwJEHg4GMzXFTqRTi8Tiq1arIoKFisZjQ5peFmEik0+m/kanh5XKRf60p/3e7ncTcez6fQkDRDKLX66Hf72M8HgsLxjSFFzj28XiUfYIGkCV104aQHQ1S2i2OToZMYgPqxY567fd7GY8a5vN5uN1uOBwOJBIJudNqteSrqBUNoX5Wq1WEpuOBQADn8xnf71cKcrxSqSQFWYT5LEjzaAhBYoqHZGc0GsVtmkJN2Yg6aY3+N4Vuat21Kfotq0KhACKTySCbzcqo7EQ2dFcv7TaLkzUN2m63YoY2i5orCq7fGhM6nY40YHHqxj3GfMw8W6/XGI1GwpAxF+//fj/BP7IT/+BdI/jvAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;7c478d42.png&quot;
        title=&quot;7c478d42.png&quot;
        src=&quot;/static/4676810d19234646bd9dc3cb6489543d/d67ca/5.png&quot;
        srcset=&quot;/static/4676810d19234646bd9dc3cb6489543d/4dcb9/5.png 188w,
/static/4676810d19234646bd9dc3cb6489543d/5ff7e/5.png 375w,
/static/4676810d19234646bd9dc3cb6489543d/d67ca/5.png 714w&quot;
        sizes=&quot;(max-width: 714px) 100vw, 714px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;开发者工具中的 Network选项中，可以查看请求的具体信息
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d5274665bfce38ddb61b1bdbd5993694/0eb6d/6.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 82.97872340425533%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAABfElEQVQ4y52S627jIBCFef/325+b1ImN8RUbzG0AnyqkrRJ1t6oz0idGoBkd5gz786ZQNwNEK9C2HZqGo6k5Wi7AuUBVXVDXvORSLlhXBec8vA//hFVvZ1x5jWmUmCcJpTSsddg2W05jbOF+Z0r+v2al4ak+4684YZEr5lliWVZotWFdNUKgJ4giiOjb/SOs4QOGTsJsFjEmxFtRjIjxXnwUVnUeV2Eheg+jApAy9n1/GTZOhGVL2HRE9hG3uD28GqzuA4bWIkv79PCywnny8NcVoVYIXIF6gz3lb81/rbATDqZaQEKDOo3QakRpkS0hbQF7zIeaMje5r+9+Fu15f+LICNilCxiFRdK+qCo4QjKhcNQg1s4Jc++RRgMaDaJ0haRDmeVhUxo+YzoJqMsE1yp4aUGbBxkPsqEseFn4r/Nn2Lnz4K2BvS6gXpddfOSwQjFEeO6Qeo/s0see3I3Bgym/nuGyRpAi5E9cQt7iPdcRu0/HXP4Q9GMcWex3DvE1O6W7dQ4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;a4104786.png&quot;
        title=&quot;a4104786.png&quot;
        src=&quot;/static/d5274665bfce38ddb61b1bdbd5993694/1d69c/6.png&quot;
        srcset=&quot;/static/d5274665bfce38ddb61b1bdbd5993694/4dcb9/6.png 188w,
/static/d5274665bfce38ddb61b1bdbd5993694/5ff7e/6.png 375w,
/static/d5274665bfce38ddb61b1bdbd5993694/1d69c/6.png 750w,
/static/d5274665bfce38ddb61b1bdbd5993694/0eb6d/6.png 913w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;缓存的工作机制&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BC%93%E5%AD%98%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6&quot; aria-label=&quot;缓存的工作机制 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;缓存的工作机制&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;对于一条GET请求的基本缓存处理过程包括七个步骤。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;发送 – 缓存从网络中读取即将的请求报文&lt;/li&gt;
&lt;li&gt;解析 – 缓存对报文进行解析，提取出URL和各种首部&lt;/li&gt;
&lt;li&gt;查询 – 缓存查看是否有本地副本可用，如果没有，就获取一份副本，并保存在本地&lt;/li&gt;
&lt;li&gt;新鲜度检测 – 缓存查看已缓存副本是否足够新鲜，如果不是，就询问服务器是否有任何更新&lt;/li&gt;
&lt;li&gt;创建响应 – 缓存会用新的首部和已缓存主体来构建一条响应报文&lt;/li&gt;
&lt;li&gt;返回 – 服务器通过网络将响应发回给客户端&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;这里的缓存可以是本地客户端缓存，也可以是代理缓存之类的缓存服务器。服务器可能是源服务器也可能是缓存服务器、客户端可以能是浏览器也可能是缓存服务器&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;新鲜度检测和服务器再验证&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%96%B0%E9%B2%9C%E5%BA%A6%E6%A3%80%E6%B5%8B%E5%92%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%86%8D%E9%AA%8C%E8%AF%81&quot; aria-label=&quot;新鲜度检测和服务器再验证 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;新鲜度检测和服务器再验证&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;什么是新鲜度检测？要知道，不是所有的缓存副本都与服务器上的文档一致。毕竟，不同场景下，文档都有其变化的原则。比如说，一份报告可能每个月更新一次，在线报纸每天都有新的内容，而金融类的数据可能每过几秒钟就发生变化，如果缓存总是提供老的数据，反而变得毫无用处。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;文档副本在被缓存的一段时间内，都认为文档是“新鲜的”，缓存可以在不联系服务器的情况下，直接提供文档的副本，在客户端的体现为:&lt;code&gt;from cache&lt;/code&gt;。当缓存的保留的时间过长，超过了限值，就认为文档“过时了”。在使用这个文档之前，缓存需要与服务端确认，文档是否发生变化，而这就是服务端再验证。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;HTTP 提供称之为&lt;code&gt;文档过期(document expiration)&lt;/code&gt; 和 &lt;code&gt;服务器再验证(server revalidation)&lt;/code&gt;的机制。可以在不要求服务器记住哪些文档拥有缓存的情况下，还能够了保证缓存与服务器之间的充分一致，&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;下图是一个GET请求的缓存流程图&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9e5694846c71c77ee5ec10277f629443/668c6/7.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 59.57446808510638%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3klEQVQoz52TUW8SQRSF99f6C3zwQRNN+qC8mTSxMYKJCab1oRJCTZP6UIxlweKCtVqgBYy1ICJQujsLM7Ozn9kFQkiMTb3JmZ25mT1z75kz1jRQPHWybHx8zYaTwZU+UYRhGOOmYU20JFHaIlHa5qG9yXjqrRDeBDFhPCqXSdeB6TheBkHA/0REagVeF1Faw317C1F8wGTQ4tIVKKWQUiHVAhop5XK9MlfoqIhwXqF72eeqncfI8d9PJsQYE+3HzBHOK2I+1+GsKytULuI0i+usM23l0P6A8dijvF3lIH2I/bKMO5jpKn86iMo6ovoE1f+CNJqzD232kwX2UwWapW9YZjJENrbw7PtMTtJo8QvXnVBIH5JPFsinbEa9MdoE6F4J4SSYHj1G96toDI1ii3cpm/xzm7Nie9ayL8H3xbWi+1dQd1r8qPXw3VlODAUXtS7nJx28gcAiDAkCHYtuTCTsqg2ib6RfFJXcEblHe2TWdjne+xrnqjvHbN7O8OpOlkr2M9bix+hWrzOy91vQOe3Ra/YRo9kDECPBeb3L99oF3lAsCadSxlCRPdSqXRY5gyF6WQEGZXR8vW+aRe4dJLn7/hm5lr0kXLT2TwQmNn0EPTd/pdvgxafdGOVOnT+bjIxtutvhswAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;65a807b1.png&quot;
        title=&quot;65a807b1.png&quot;
        src=&quot;/static/9e5694846c71c77ee5ec10277f629443/1d69c/7.png&quot;
        srcset=&quot;/static/9e5694846c71c77ee5ec10277f629443/4dcb9/7.png 188w,
/static/9e5694846c71c77ee5ec10277f629443/5ff7e/7.png 375w,
/static/9e5694846c71c77ee5ec10277f629443/1d69c/7.png 750w,
/static/9e5694846c71c77ee5ec10277f629443/78797/7.png 1125w,
/static/9e5694846c71c77ee5ec10277f629443/aa440/7.png 1500w,
/static/9e5694846c71c77ee5ec10277f629443/668c6/7.png 1692w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;接下来解释该图中几个关键点的具体工作机制。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;文档过期&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%96%87%E6%A1%A3%E8%BF%87%E6%9C%9F&quot; aria-label=&quot;文档过期 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;文档过期&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;通过通用首部 &lt;code&gt;Cache-Control&lt;/code&gt; 和 &lt;code&gt;Expires&lt;/code&gt;，HTTP 让服务器对每个文档附加一个“过期时间”，这些首部表示在多长的时间内可以将这些内容视为新鲜的。就像是给食物加上过期时间一样。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/40e0e068bfa048ccb14eda7fe7dcc6be/d9199/8.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 52.659574468085104%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABV0lEQVQoz3WSiY6DMAxE+///uIGScCVAgSbcZFY2Wwqla8kyQfA8Y+cWhiGiKML9focQAl3X4RXee05QxTv8umzv/745xi2OY1ASNE1T5FqjaRosy/wGbBT4toU3Gt65c8MjkJRJKVnhSyk1CIIAj7rGNM9AEsOHAr4w8NN0cvAZO5BgSZqiKEvkec5VxjHqqgKaGn5dr6PYDlcgzVFJiR8hoJRCUZT4Fvs8D8Cr5ShiYCAEzzDNMrY6zzPGccQ4jZin6Svgq+WQZ6bYLi1EG4Nc53zeMuH6skwIvyycR9Uny3Vd88xIXZZlkErBOoeu6+Gcg7V2+5lAjwq+Ks/Ao0LaptYaxhhk+aaMqrUOwzBwdlSbBkhj4Nnud/KrZbrMtOEokjCmQFVVbD1OEp4pNYiUhM4yPNsWywfsopBgtFnaMFnr+57t9sPAZ3p+Wrvnuqz/XmoC/gIU/VGT10qXRgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;9ef1d5bc.png&quot;
        title=&quot;9ef1d5bc.png&quot;
        src=&quot;/static/40e0e068bfa048ccb14eda7fe7dcc6be/1d69c/8.png&quot;
        srcset=&quot;/static/40e0e068bfa048ccb14eda7fe7dcc6be/4dcb9/8.png 188w,
/static/40e0e068bfa048ccb14eda7fe7dcc6be/5ff7e/8.png 375w,
/static/40e0e068bfa048ccb14eda7fe7dcc6be/1d69c/8.png 750w,
/static/40e0e068bfa048ccb14eda7fe7dcc6be/d9199/8.png 960w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;Expires&lt;/code&gt; 和 &lt;code&gt;Cache-Control: max-age&lt;/code&gt; 所做的事情本质上都是过期日期。但前者使用的是绝对时间，定义的是过期的时间，超过这个时间，文档将被视为“过时了”。后者使用的是相对时间，定义的是缓存的使用时间，从第一次生成文档到文档不再新鲜，无法使用位置的最大合法生存时间，单位为秒。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;比如你在2019年3月1日买了一瓶牛奶，&lt;code&gt;Expires&lt;/code&gt; 告诉你在3月15日后过期，而&lt;code&gt;Cache-Control:max-age&lt;/code&gt; 告诉你是1209600秒 (14 * 24 * 60 * 60) 后过期。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;&lt;code&gt;Expires&lt;/code&gt; 是来自HTTP/1.0版本的首部，目前存在的意义主要是向下兼容。&lt;/strong&gt;&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;服务器再验证&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%86%8D%E9%AA%8C%E8%AF%81&quot; aria-label=&quot;服务器再验证 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;服务器再验证&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;当缓存的新鲜度不再，意味着到了核对的时间了，缓存需要询问服务器原始文档是否发生了变化。这个过程只有两种结果：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;内容发生了变化，缓存将会获取一份新的文档副本，代替原来的副本，然后文档发给客户端&lt;/li&gt;
&lt;li&gt;内容没有发生变化，缓存获取新的首部，首部中包含新的过期时间，然后更新缓存中的首部&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;这种机制的好处在于：按需校验，在保证缓存自动更新的前提下还能够节约服务器资源。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;HTTP提供了一些特殊的条件首部，当一个GET请求在请求首部中带上条件首部时，只有当条件为True时，服务器才会返回对象。&lt;/p&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;If-Modified-Since-Date&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#If-Modified-Since-Date&quot; aria-label=&quot;If Modified Since Date permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;If-Modified-Since: [Date]&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;如果再指定日期后文档被修改了，条件判定为 True，请求成功后，新的文档将会被缓存，新首部会包含一个新的过期日期。反之响应报文的状态码 &lt;code&gt;304 Not Mofified&lt;/code&gt;，不返回文档的主体。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;与响应首部中的&lt;code&gt;Last-Modified&lt;/code&gt;配合使用。文档请求成功返回时，服务器将文档的的最后修改日期以&lt;code&gt;Last-Modified&lt;/code&gt;加在响应报文中。当缓存进行验证时，将用这个值作为&lt;code&gt;If-Modified-Since&lt;/code&gt;首部的字段值：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;If-Modified-Since: &amp;lt;cached last-modified date&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果此时文档内容被修改，修改日期就会有所不同，条件判定为True。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9a46e2fe4fb20e4d4d39107fc064f5ad/913a1/9.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 88.29787234042553%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACPUlEQVQ4y4WTV2tyQRCG/c0SzL8RDCh6I4LeJHhhIgYRC2KLJabZa6KxxDbhGVhZNXzfwngO65nZt63jcDgIxdput7LZbOSvZb6za7/fa9l7Dntgs9mUfD4v7+/v0u/3ZTAYaH1/f8vPz48eaMr02AeyTgZ2Oh0dysC3tzetRqMh9XpdSqWSFAoFSaVSkkgkJJlMyuvrq+RyOVmtVsehDjNsPB7rAD6az+eyXC5lMplIr9fTQxiYTqfl4eFB7u7uJBwJi9frFZfLpSxY0Hfww6LR5/NpeTwerVAopM3xeFyl4LDZbCamJxaLidPp1N7jQNuQaDQq2WxW1uu1FItFqdVqWtVqVelCHzToy+CPjw+5v79XRkfKtqD26na7WsPhUAeAAo2NLOhqBl2YYuzf7XaK1MBHR5pAg9Ofn58yGo0UJXtEjB47Oicut9tteXl5ka+vL3WOgj6HmKZzROc5PaEMpaenJymXy/qEFvpBE70oHEdLaC8WC5lOp4ryIjb82Wq1tNgDFbTQDmOIDK6Gw2Hx+/1yc3MjgUBArq+vVeOL2EA3EolIMBjUD3niOgEmMqCCAYhMkDng6urq79hwtTj59vZWhz8+Pkomk9G4QBvkmEHYMQaa/Od2u/VS/Dc2lUpFdTRagpBhuI0U5m7/GRuzYZzkdHOXMQJ0PE02YcB9twN9YYr9B4Ofn58VJY2g5J09XCYFvNsDT3Job5p3XEcbbgramXcOIDKgx6B/DjzX09wecxt4op2t3zmgXxZqRkEIqL+jAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;209f1f80.png&quot;
        title=&quot;209f1f80.png&quot;
        src=&quot;/static/9a46e2fe4fb20e4d4d39107fc064f5ad/1d69c/9.png&quot;
        srcset=&quot;/static/9a46e2fe4fb20e4d4d39107fc064f5ad/4dcb9/9.png 188w,
/static/9a46e2fe4fb20e4d4d39107fc064f5ad/5ff7e/9.png 375w,
/static/9a46e2fe4fb20e4d4d39107fc064f5ad/1d69c/9.png 750w,
/static/9a46e2fe4fb20e4d4d39107fc064f5ad/78797/9.png 1125w,
/static/9a46e2fe4fb20e4d4d39107fc064f5ad/913a1/9.png 1476w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;用 Node.js 来简单实现这个过程：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const http = require(&amp;quot;http&amp;quot;);
const url = require(&amp;quot;url&amp;quot;);
const fs = require(&amp;quot;fs&amp;quot;);
const path = require(&amp;quot;path&amp;quot;);

const mimeList = {
  css: &amp;quot;text/css&amp;quot;,
  gif: &amp;quot;image/gif&amp;quot;,
  html: &amp;quot;text/html&amp;quot;,
  ico: &amp;quot;image/x-icon&amp;quot;,
  jpeg: &amp;quot;image/jpeg&amp;quot;,
  jpg: &amp;quot;image/jpeg&amp;quot;,
  js: &amp;quot;text/javascript&amp;quot;,
  json: &amp;quot;application/json&amp;quot;,
  pdf: &amp;quot;application/pdf&amp;quot;,
  png: &amp;quot;image/png&amp;quot;,
  svg: &amp;quot;image/svg+xml&amp;quot;,
  swf: &amp;quot;application/x-shockwave-flash&amp;quot;,
  tiff: &amp;quot;image/tiff&amp;quot;,
  txt: &amp;quot;text/plain&amp;quot;,
  wav: &amp;quot;audio/x-wav&amp;quot;,
  wma: &amp;quot;audio/x-ms-wma&amp;quot;,
  wmv: &amp;quot;video/x-ms-wmv&amp;quot;,
  xml: &amp;quot;text/xml&amp;quot;
};

const Expires = {
  maxAge: 60 * 60 * 24 * 365
};

const server = http.createServer((req, res) =&amp;gt; {
  const pathname = url.parse(req.url).pathname; //解析路径
  const resourcePath = path.join(__dirname , pathname);
  const suffix = path.extname(pathname).slice(1); //获取后缀
  const contentType = mimeList[suffix];

  if (fs.existsSync(resourcePath)) {
    //判断资源是否存在，存在则读取
    fs.stat(resourcePath, function(err, stat) {

      // stat.mtime 返回 文件最后修改的时间
      const lastModified = stat.mtime.toUTCString();
      const ifModifiedSince = &amp;quot;If-Modified-Since&amp;quot;.toLowerCase();
      const expires = new Date();

      res.setHeader(&amp;quot;Last-Modified&amp;quot;, lastModified);
      res.setHeader(&amp;quot;Content-Type&amp;quot;, contentType);
      res.setHeader(&amp;quot;Expires&amp;quot;, expires.toUTCString());
      res.setHeader(&amp;quot;Cache-Control&amp;quot;, &amp;quot;max-age=&amp;quot; + Expires.maxAge);

      expires.setTime(expires.getTime() + Expires.maxAge * 1000);

      // 服务端的lastModified 与请求中携带的 “If-Modified-Since”的字段值对比
      if (req.headers[ifModifiedSince] &amp;amp;&amp;amp; lastModified == req.headers[ifModifiedSince]) {
        //实现304逻辑
        res.writeHead(304, &amp;quot;Not Modified&amp;quot;);

        // 注意：此处没有返回资源
        res.end();
      } else {
        const resource = fs.createReadStream(resourcePath);

        res.writeHead(200, &amp;quot;Ok&amp;quot;);
        resource.pipe(res);
      }
    });
  } else {
    res.writeHead(404, { &amp;quot;Content-Type&amp;quot;: contentType });
    res.write(&amp;quot;No Found&amp;quot;);
    res.end();
  }
});

server.listen(8080, function() {
  console.log(&amp;quot;Server Listen: http://localhost:8080&amp;quot;);
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ol&gt;
&lt;li&gt;在第一次请求时，因为本地没有缓存，node server 返回状态码 200和实体文件，响应首部增加 &lt;code&gt;Last-Modified&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;command+R 刷新页面(此时浏览器会给请求加上一个Cache-Control: max-age=0)。在第二次请求时，请求报文增加 &lt;code&gt;If-Modified-Since&lt;/code&gt;，值为第一次请求时返回的&lt;code&gt;Last-Modified&lt;/code&gt;。因为文件的最后修改时间没有发生变化，server 返回 304。&lt;/li&gt;
&lt;li&gt;重新编辑资源文件，再次刷新访问，请求报文依旧增加 &lt;code&gt;If-Modified-Since&lt;/code&gt;，值为第一次请求时返回的 &lt;code&gt;Last-Modified&lt;/code&gt;。此时 server 判定缓存失效，返回状态码 200和资源内容&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;If-None-Match-ETag&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#If-None-Match-ETag&quot; aria-label=&quot;If None Match ETag permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;If-None-Match: [ETag]&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;有些情况下，仅使用最后修改时间来做验证是不够的：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;有时候文档被重写，内容没有变化，但是修改时间变化&lt;/li&gt;
&lt;li&gt;有时候文档修改的内容不重要，对使用也没有影响&lt;/li&gt;
&lt;li&gt;有的服务器无法准确判断最后修改时间&lt;/li&gt;
&lt;li&gt;有的场景下文档的数据需要精确亚秒级别，比如实时监控。而 Last-Modified 只能精确到秒&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;为了解决这个问题，引入了ETag(实体标签)作为版本标识符。ETag 是根据资源本身的特征经过计算得到的一个值，用来标识一个资源。并不像 Last-Modified 那样直接依赖修改时间而是依赖资源，所以要更加可靠和灵活。ETag在响应返回的时候附加在报文中，当文档发生了修改之后，可以修改对应的ETag来表名这是一个新的版本。缓存可以通过&lt;code&gt;If-None-Match&lt;/code&gt;的校验结果来判断使用缓存还是重新获取文档。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3af287e681685457d124639ed4f23eef/1134b/10.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 34.04255319148936%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABFElEQVQoz22R3aqCUBCFe/9X8N4X6E666KKgiwxEDAWxtChD0dLS8m8d1sDuHPEMDLNxO2u+tWc2DAMYbdsiiiLEcYymafB+vyWrqpK7/4K9ql/VmTpQxPd9OI4D13URBAEOhwNutxuKohgJMPu+Hwmr+hUkzeVyESJ+I1We5zidTtjv99jtdlgul5jP59B1HZqmiZssy/D5fH4F1YFCTFItFgtsNhtJ0zRh27bQH49HnM9noeag+/0uSXcTQtKkaSo/r1YrGIYhdb1eY7vdwrIshGGIsizFTdd1QsghdV1PBTnl+Xx+7dMmBUiSJInU6/UqScrH44HX6yUg6j1Hlv8GJ5KU78NGLoVVWeSd53mTjXPLPzZgEkFFo+t2AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;054048af.png&quot;
        title=&quot;054048af.png&quot;
        src=&quot;/static/3af287e681685457d124639ed4f23eef/1d69c/10.png&quot;
        srcset=&quot;/static/3af287e681685457d124639ed4f23eef/4dcb9/10.png 188w,
/static/3af287e681685457d124639ed4f23eef/5ff7e/10.png 375w,
/static/3af287e681685457d124639ed4f23eef/1d69c/10.png 750w,
/static/3af287e681685457d124639ed4f23eef/78797/10.png 1125w,
/static/3af287e681685457d124639ed4f23eef/1134b/10.png 1470w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;ETag的生成规则没有严格规定包括，文档内容的hash值，对最后修改时间的hash值，甚至是约定的版本号。作为服务器再验证机制中的一环，有强弱之分&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;强校验的ETag匹配要求两个资源内容的每个字节需完全相同，包括所有其他实体字段（如Content-Language）不发生变化。一个强校验ETag校验符的表示形式：“22FAA065-2664-4197-9C5E-C92EA03D0A16”。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;弱校验的ETag匹配要求两个资源在语义上相等，不需要每个字节相同。一个弱校验ETag校验符的表现形式：w/”22FAA065-2664-4197-9C5E-C92EA03D0A16”。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;同样用Node.js 来简单实现：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const server = http.createServer((req, res) =&amp;gt; {
  const pathname = url.parse(req.url).pathname; //解析路径
  const resourcePath = path.join(__dirname, pathname);
  const suffix = path.extname(pathname).slice(1); //获取后缀
  const contentType = mimeList[suffix];

  if (fs.existsSync(resourcePath)) {
    //判断资源是否存在，存在则读取
    fs.stat(resourcePath, function(err, stat) {
      const resource = fs.readFileSync(resourcePath);

      let hash = crypto.createHash(&amp;quot;sha1&amp;quot;);
      let tag = hash.update(resource).digest(&amp;quot;base64&amp;quot;);

      console.log(tag);

      res.setHeader(&amp;#39;ETag&amp;#39;, tag);

      if (req.headers[&amp;quot;if-none-match&amp;quot;] === tag) {
        res.writeHead(304);
        res.end();

        return;
      }

      res.writeHead(200);
      res.end(resource);
      // res.writeHead(200, &amp;quot;Ok&amp;quot;);
    });
  } else {
    res.writeHead(404, { &amp;quot;Content-Type&amp;quot;: contentType });
    res.write(&amp;quot;No Found&amp;quot;);
    res.end();
  }
});

server.listen(8080, function() {
  console.log(&amp;quot;Server Listen: http://localhost:8080&amp;quot;);
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ol&gt;
&lt;li&gt;在第一次请求时，因为本地没有缓存，node server 返回状态码 200和实体文件，响应首部增加 &lt;code&gt;ETag&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;command+R 刷新页面(此时浏览器会给请求加上一个Cache-Control: max-age=0)。在第二次请求时，请求报文增加 &lt;code&gt;If-None-Match&lt;/code&gt;，值为第一次请求时返回的&lt;code&gt;ETag&lt;/code&gt;。因为文件的内容没有发生变化，server 返回 304。&lt;/li&gt;
&lt;li&gt;重新编辑资源文件，再次刷新访问，请求报文依旧增加 &lt;code&gt;ETag&lt;/code&gt;，值为第一次请求时返回的 &lt;code&gt;ETag&lt;/code&gt;。此时server获取到的ETag值已经发生了变化，判定缓存失效，返回状态码 200和资源内容&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;If-Unmodified-Since-Date&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#If-Unmodified-Since-Date&quot; aria-label=&quot;If Unmodified Since Date permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;If-Unmodified-Since: Date&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;类似于If-Modified-Since，意义相反。区别是当服务器资源条件不满足时，不是返回 304 Not Modified，而是返回 412 Precondition Failed。&lt;/p&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;If-Match-ETag&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#If-Match-ETag&quot; aria-label=&quot;If Match ETag permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;If-Match: ETag&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;和If-None-Match 相反&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;说了这么多，再回到之前 GET 请求的缓存流程，结合刚才的解释，可以重新绘制一个流程图：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c7af3968afa863754291287db3746718/6cb28/11.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 64.8936170212766%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACFUlEQVQ4y52T7UsUURTG/WfrL+hbXwqKosAvgoR/QAVqQkKEmpRZuqaZ0Qq+rW+o67obuzN7Z+499+UXc2fSdP3UgQMz5555eO7zPDN0ml4wsjrBy/os1luKCiH8Vxc11JWc93s1Fo/ruGp4vQIEf8tscLcAHUI1oT4GjSnyLMU6jw8e5z3WOawHB1gfcM7H8zgLxOdy5nDOlQwlT0j23qHPVwnBY63D5IJoi/cOl10gnU28KIwxeCc41cL2DvBWI2Kw1iJiK8BmjbT2EPV9GKeOOdxsMv1khqXXP/C6iVp7RjJ/h3zrFUbnyPka/W+P6X2+R74zjuQ9pCAhUgLiLdJtIOlp1MZZR5bkGGXiglG/0d0jQmWYN0kETRuzSHpWMvYesRXDuFT1beUkR6etKLgvPjxbQq09RdUeYHbHMaqDERvluAQUY9A6v4qML+GdapJvDNP/dBe9O0GWqWhGrrpkaTsa4QqzCgO9uwIsDqwdzGDBu986or2zgsvTMi4EtLFocdW+RytDr51ita2u7Ev7rwH6Mmcrb34x9Wiew59n8b1wU0Twzl2Guf5hm+nnc+ws7w8CDmhoLFma4e0VwM3a+3rIwotljtdPqitXLv0V/t8OBMTZS+bWWC4OOrT2O4guo7KxscXk5Bzb2wcVwxAiYPwzbnaVsULjAj7p9JkbXWRmZIFuO4mAbxtfuL88xseTdf4A1XTkpNKbS54AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;704be86d.png&quot;
        title=&quot;704be86d.png&quot;
        src=&quot;/static/c7af3968afa863754291287db3746718/1d69c/11.png&quot;
        srcset=&quot;/static/c7af3968afa863754291287db3746718/4dcb9/11.png 188w,
/static/c7af3968afa863754291287db3746718/5ff7e/11.png 375w,
/static/c7af3968afa863754291287db3746718/1d69c/11.png 750w,
/static/c7af3968afa863754291287db3746718/78797/11.png 1125w,
/static/c7af3968afa863754291287db3746718/aa440/11.png 1500w,
/static/c7af3968afa863754291287db3746718/6cb28/11.png 2430w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;与缓存相关的首部&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%8E%E7%BC%93%E5%AD%98%E7%9B%B8%E5%85%B3%E7%9A%84%E9%A6%96%E9%83%A8&quot; aria-label=&quot;与缓存相关的首部 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;与缓存相关的首部&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;总结一下目前涉及到的一些与缓存相关的首部字段，方便大家理解和体会：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/12989c5f854e258b1a9d8cbc9bfaada2/71ba4/12.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.319148936170215%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABuklEQVQoz22TaarcMBCEfd+QG4TcJAfIz0B+BXKHECZhBmbxMuNVXiVblmWpQrefIW8YgZCNrdLXVa0AALz3L+fz0FpjsRZSSmRZhqqqIIRAURao6xrOOQT7xlcC1losy8LrOE1o2xZSKhY7Ho+I4xi38IY4iVlYzzOCZzE1TWj6HrMxMMZgmiZeh2FA07bouh5FWeJ8PiOKIuR5zoftYyP0Hm510HpGVlU4Xi5Q44TVWqzOMeE8z8iLAnGS4PF44BaG/Nx2HZNTuZvg7o8xWNf1XclER76RGG2iSaTjuFHTNzqMxPYqA6Lz1kIT0bqiEALnMIRUIyohcL1emSzNMhz+HPidhJ7HHmSAL1/hP3yC+/gZ7nCC8o69IoP7fkBZlqjrBuM4svGULBG+Gpvgr7/w339i/vYDJi2gV4t+GLg9KGESuj/unGxyT7hkmkpJdF0HpRT6vuf1nYcjgMV7lELgEkWctjEL/0wtEoYh0jRlwrqp0TQNJ8x9WGx9yISe0nEORs9sPvlIhpPR5q11hKh4E1FQUERN82XJ/9+KZbFIshy/TycOhUoSomYq6jkiHKRkK8xbVzzfrH+DQE24lFaLoAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;24cb815b.png&quot;
        title=&quot;24cb815b.png&quot;
        src=&quot;/static/12989c5f854e258b1a9d8cbc9bfaada2/1d69c/12.png&quot;
        srcset=&quot;/static/12989c5f854e258b1a9d8cbc9bfaada2/4dcb9/12.png 188w,
/static/12989c5f854e258b1a9d8cbc9bfaada2/5ff7e/12.png 375w,
/static/12989c5f854e258b1a9d8cbc9bfaada2/1d69c/12.png 750w,
/static/12989c5f854e258b1a9d8cbc9bfaada2/78797/12.png 1125w,
/static/12989c5f854e258b1a9d8cbc9bfaada2/aa440/12.png 1500w,
/static/12989c5f854e258b1a9d8cbc9bfaada2/71ba4/12.png 1870w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;内容有些许枯燥，但还是希望能够帮助大家理解&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;参考资料&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching_FAQ#%E5%90%84%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%BC%93%E5%AD%98&quot; class=&quot;link-underline&quot;&gt;HTTP 缓存 - HTTP | MDN&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.fundebug.com/2019/01/08/browser-cache-mechanism/&quot; class=&quot;link-underline&quot;&gt;浏览器缓存机制 | Fundebug博客&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://swiftcachelite.swiftserve.com/different-types-of-caching-and-their-differences/&quot; class=&quot;link-underline&quot;&gt;Different Types of Caching and Their Differences - SwiftCache Lite&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/49547/how-to-control-web-page-caching-across-all-browsers&quot; class=&quot;link-underline&quot;&gt;http - How to control web page caching, across all browsers? - Stack Overflow&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching&quot; class=&quot;link-underline&quot;&gt;HTTP Caching  |  Web Fundamentals  |  Google Developers&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.wikiwand.com/en/HTTP_ETag&quot; class=&quot;link-underline&quot;&gt;HTTP ETag - Wikiwand&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[巧用 webpack loader 实现项目的定制化]]></title><description><![CDATA[背景 有这样的需求：项目交付的版本要求支持针对客户定制产品的LOGO、登录界面的背景。 简单分析 手动替换文件再编译这种蠢到极点的方法肯定是无法接受的。如果你说采用分支的方式来对付这种需求，我觉得也是不太现实。分支虽然好用，但是不要瞎用。项目在交付时需要避免交付的代码中包含其他…]]></description><link>https://zhanglun.github.io/blogs/2019-01-26-巧用-webpack-loader-实现项目的定制化/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2019-01-26-巧用-webpack-loader-实现项目的定制化/</guid><pubDate>Sat, 26 Jan 2019 12:39:22 GMT</pubDate><content:encoded>&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;背景&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%83%8C%E6%99%AF&quot; aria-label=&quot;背景 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;背景&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;有这样的需求：项目交付的版本要求支持针对客户定制产品的LOGO、登录界面的背景。&lt;/p&gt;
&lt;!--more--&gt; 
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;简单分析&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90&quot; aria-label=&quot;简单分析 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;简单分析&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;手动替换文件再编译这种蠢到极点的方法肯定是无法接受的。如果你说采用分支的方式来对付这种需求，我觉得也是不太现实。分支虽然好用，但是不要瞎用。项目在交付时需要避免交付的代码中包含其他客户的资源和信息。这意味着，通过配置文件等在运行时加载的形式是行不通。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;想来想去，问题的本质无非就是解决项目编译输出时CSS可以使用我们指定的图片文件，而我们需要将这个过程自动化。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;粗暴的方案&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%B2%97%E6%9A%B4%E7%9A%84%E6%96%B9%E6%A1%88&quot; aria-label=&quot;粗暴的方案 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;粗暴的方案&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;先来一种简单而又直接的方案：直接替换。其步骤如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;将图片资源放入指定的目录中，按项目(客户)区分&lt;/li&gt;
&lt;li&gt;执行替换图片资源的脚本，使用指定的资源替换&lt;/li&gt;
&lt;li&gt;执行项目的编译命令&lt;/li&gt;
&lt;/ol&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// node ./pre-packaging.js it

const path = require(&amp;quot;path&amp;quot;);
const fs = require(&amp;quot;fs&amp;quot;);
const project = process.argv[2];
const distPath = path.resolve(&amp;quot;./src/static/images&amp;quot;); // 源代码目录
const resourcePath = path.resolve(&amp;quot;./resources&amp;quot;, project); // 项目静态文件目录

function copyDir(src, dist) {
  try {
    fs.accessSync(dist, fs.constants.R_OK | fs.constants.W_OK);
  } catch (err) {
    fs.mkdirSync(dist);
  }

  const copyFile = (src, dist) =&amp;gt; {
    fs.createReadStream(src).pipe(fs.createWriteStream(dist));
  };

  const dirList = fs.readdirSync(src);

  dirList.forEach(item =&amp;gt; {
    const currentPath = path.resolve(src, item);
    const currentDistPath = path.resolve(dist, item);

    if (fs.statSync(currentPath).isDirectory()) {
      copyDir(currentPath, currentDistPath);
    } else {
      const src = currentPath;
      const dist = currentDistPath;

      copyFile(src, dist);
    }
  });
}

copyDir(resourcePath, distPath);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;看起来我们的问题已经得到解决。但是你仔细想想，便会发现，这种简单粗暴的方案存在多个不足之处。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;侵入性强。每次自定义版本构建之后都修改项目中的图片资源，这些修改很容易被同步到远端。&lt;/li&gt;
&lt;li&gt;拓展性差。自定义的图片资源必须严格按照源码中的约定，比如图片格式，图片尺寸。每一张图片都需要在代码中提供相应的插槽。&lt;/li&gt;
&lt;li&gt;功能单一。只能修改图片的引用，当其他的样式需要调整时便无能为力。&lt;/li&gt;
&lt;li&gt;体验性差。将构建过程拆分为准备静态资源和编译两个过程。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;我们需要优雅&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E4%BC%98%E9%9B%85&quot; aria-label=&quot;我们需要优雅 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;我们需要优雅&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;如此丑陋的方案是无法接受的，是否有更好的方案？此时我们回到问题：如何实现同一个项目针对不同客户定制界面的Logo和登录背景？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们需要修改的是什么？CSS!&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;既想修改CSS样式，又想不对源码进行修改，那只有采用CSS样式具有的覆盖规则来实现。源文件中设置默认样式，约定使用的 CSS 选择器，通过编译将新的样式文件和源文件合并，所有的样式打包输出。这种方式有诸多好处：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;侵入性弱。只需要在项目仓库中维护对应的资源，不影响源代码，交付时也不会包含多余的资源。&lt;/li&gt;
&lt;li&gt;拓展性强。自定义的图片资源不在依赖源码，可以使用任意的图片格式。&lt;/li&gt;
&lt;li&gt;功能丰富。可以额外增加自定义样式，不限于需求中的Logo和背景。&lt;/li&gt;
&lt;li&gt;体验好。在编译阶段加载指定的样式，一步到位。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;说到前端的编译打包，自然想到Webpack。可以从 Webpack Loader入手，实现上述过程。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Webpack-Loader&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Webpack-Loader&quot; aria-label=&quot;Webpack Loader permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Webpack Loader&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在 Webpack 的生态中，Loader 用于对模块的源代码进行转换。Loader 可以使你在 import 或”加载”模块时预处理文件。因此，Loader 类似于其他构建工具中“任务(task)”，并提供了处理前端构建步骤的强大方法。Loader 可以将文件从不同的语言（如 TypeScript）转换为 JavaScript，或将内联图像转换为 data URL。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Webpack Loader的编写可参考&lt;a href=&quot;https://webpack.docschina.org/contribute/writing-a-loader/&quot; class=&quot;link-underline&quot;&gt;官方文档&lt;/a&gt;，有非常详细的说明。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;以常见的一段 Webpack 配置为例：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports = {
  entry: [...],
  output: {...},
  module: {
    rules: [
      ...,
      {
        test: /\.less$/,
        use: [
          {
            loader: &amp;#39;style-loader&amp;#39;,
          },
          {
            loader: &amp;#39;css-loader&amp;#39;,
          },
          {
            loader: &amp;#39;less-loader&amp;#39;,
          }
        ];
      }
      ...,
    ],
  },
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;上述配置在执行过程中，less文件的编译会按照如下顺序 (&lt;a href=&quot;https://webpack.docschina.org/contribute/writing-a-loader/#%E5%A4%8D%E6%9D%82%E7%94%A8%E6%B3%95&quot; class=&quot;link-underline&quot;&gt;Webpack Loader 执行顺序&lt;/a&gt;)：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 664px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/95c0e8c459b471e82c5a05cef9bf673b/31493/1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 12.765957446808512%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/klEQVQI1wHzAAz/AJzMXWd4zpcAPry0W2HQxZpi0caHXc7Ekj69tkkAAAACUce/jWLQxplj0ceVT8a+mQCMggg9vLZBXM3EpGLQxphgz8WrQL62bXTOnQCdzV5TAJ3MXOQALP8GVcbDmorQv/+HzLz/gMy9/13LxYwAmOAcetLE/43SwP+Jy7r/etHD/wCx3h5Pw8V/hM29/4rPvv+Kzr3/YMnApwAA/wKXymDfAJrKXYO33HIAP7y3cGjKvtJoyb25Yca8x0TAvFAAlr0NVsW8v2jKvsppyb3OWca91garvBY7u7lMX8a7xmbIvbdlyL3JQby2ervZZgCWxl55ML2MMRnMH9gAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;IMAGE&quot;
        title=&quot;IMAGE&quot;
        src=&quot;/static/95c0e8c459b471e82c5a05cef9bf673b/31493/1.png&quot;
        srcset=&quot;/static/95c0e8c459b471e82c5a05cef9bf673b/4dcb9/1.png 188w,
/static/95c0e8c459b471e82c5a05cef9bf673b/5ff7e/1.png 375w,
/static/95c0e8c459b471e82c5a05cef9bf673b/31493/1.png 664w&quot;
        sizes=&quot;(max-width: 664px) 100vw, 664px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在整个编译过程中，我们可以在每一个loader的开始前和结束后合并我们自定义样式，如下图所示：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 735px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f979da3bd447384b9ffb01db20e93b14/7608e/2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 25.531914893617024%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoElEQVQY0wGVAWr+ADu+tx5rzsLuds7A63bPwvNky8C6RsG7VnjWyNV20sXGd9XI2VXHv2tcysGDd9XI13bTxcd01cjNMbezSXHUx7J41cfSetXH1WbPw8AJoqENAD7FxhNw0MTSe87A3HzPweJqy7+mWMnAYoXczf57z8Hsg9nK+2HNwntq0MWYg9nK/3jPxPiB28z9OLm1WoDbzNGC1cf1gtTF9XLVytkDo60PAFu4gQVCsW8QAKb/CwCiqwcAX4sFAJKmCwCIlA0Gt9oVAImVCwCHnQkAmKYNAKCmDxW82hgApKYTAKa0DQCWmw0Er8cWALD/CEq0gxZfuYgGAKDOWrqj0FnfRrGeHjC6yjp10MLXftLD12fMwKsAQ/8IX8rEfXzTxN970cPdW8nBbgBp/Q1rzMG4f9PE4XLOwNwguNgzZbeCIKTQWOOgzlqsAJvIV86cy1nxXbeIFjC7zDtuyLz3dsi69mLHvb3//xAAV8bAl3XKvP10ybz/VsbAiwAA/wNjxbzJd8m68WjFufAnvNgsbLt/I5vJWP2dyli21TPm4Z6jEAYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;IMAGE&quot;
        title=&quot;IMAGE&quot;
        src=&quot;/static/f979da3bd447384b9ffb01db20e93b14/7608e/2.png&quot;
        srcset=&quot;/static/f979da3bd447384b9ffb01db20e93b14/4dcb9/2.png 188w,
/static/f979da3bd447384b9ffb01db20e93b14/5ff7e/2.png 375w,
/static/f979da3bd447384b9ffb01db20e93b14/7608e/2.png 735w&quot;
        sizes=&quot;(max-width: 735px) 100vw, 735px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在less-loader之前加入自定义的CSS样式是最好的时机，为什么呢？有两点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;同时支持原生 CSS 和 Less 两种文件。&lt;/li&gt;
&lt;li&gt;在整个编译开始之前加入，对编译的整个过程没有影响。新增的样式同样享受完整编译过程。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;编译过程修改为如下图所示：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e7cbc41db84c64824a6fd351eb1e7592/6a6e9/3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 10.106382978723403%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAArUlEQVQI1wGiAF3/AKDOWqmiz1nBE6q+EWfMwbV80sTZYsi+kiq4wiZtzMDTec/B2VTEvmxKxMJKedLE1nfRw889vrxAW8fAcXrSxNJtzsHABazaGKLPWI+gz1rMAJrIWLydylfLGLjRGGLCubp3x7ngX8G4mSW6yyZtyb3Resy+2FXEv2JHwcFXeMy+53bLveg8v8FOWsK9f3rKu+1rx7rYB7TrHZrHV62dy1jqwINhtpg5mDIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;IMAGE&quot;
        title=&quot;IMAGE&quot;
        src=&quot;/static/e7cbc41db84c64824a6fd351eb1e7592/1d69c/3.png&quot;
        srcset=&quot;/static/e7cbc41db84c64824a6fd351eb1e7592/4dcb9/3.png 188w,
/static/e7cbc41db84c64824a6fd351eb1e7592/5ff7e/3.png 375w,
/static/e7cbc41db84c64824a6fd351eb1e7592/1d69c/3.png 750w,
/static/e7cbc41db84c64824a6fd351eb1e7592/6a6e9/3.png 826w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;开发一个-merge-loader&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA-merge-loader&quot; aria-label=&quot;开发一个 merge loader permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;开发一个 merge-loader&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在目前的场景中，merge-loader 只需要一个参数：自定义样式的文件路径。所以 Webpack 配置文件可以修改为：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports = {
  entry: [...],
  output: {...},
  module: {
    rules: [
      ...,
      {
        test: /\.less$/,
        use: [
          {
            loader: &amp;#39;style-loader&amp;#39;,
          },
          {
            loader: &amp;#39;css-loader&amp;#39;,
          },
          {
            loader: &amp;#39;less-loader&amp;#39;,
          }，
          {
            loader: path.resolve(__dirname, &amp;#39;./loader/merge-less.js&amp;#39;), // 自定义loader文件的路径
            options: {
              style: path.resolve(root, &amp;#39;client/statics/projects/it/style.less&amp;#39;),
            },
          }
        ];
      }
      ...,
    ],
  },
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;merge-loader中的逻辑如下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const { getOptions } = require(&amp;#39;loader-utils&amp;#39;);

module.exports = function (source) {
  const options = getOptions(this);
  const { style } = options;
  
  // 读取样式文件，返回字符串
  const string = fs.readFileSync(style);

  // 合并到原始文件，返回给下一个loader
  source += string;

  return source;
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;你以为这样就结束了？不，上述逻辑有两个问题还需优化：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;当样式中存在图片的引用时，以字符串形式拼接在源码样式中会遇到图片路径错误的问题&lt;/li&gt;
&lt;li&gt;只要文件通过了规则&lt;code&gt;/\.less&amp;#x26;/&lt;/code&gt;的匹配，就会执行一次merge操作。含有&lt;code&gt;&amp;#x3C;style lang=&quot;less&quot;&gt;&amp;#x3C;/style&gt;&lt;/code&gt; 的vue文件也会触发这个规则(虽然重复引用不会增加代码量)。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;这两个问题的解法如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;使用 &lt;code&gt;@import &quot;path/of/style&quot;&lt;/code&gt; 方式 merge 样式文件。其他的处理交给后面的loader，保证文件和图片路径引用正确。&lt;/li&gt;
&lt;li&gt;增加一个参数&lt;code&gt;target&lt;/code&gt;，指定一个文件作为 merge 的对象。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;这样一来，loader的逻辑修改如下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const { getOptions } = require(&amp;#39;loader-utils&amp;#39;);

module.exports = function (source， meta) {
  const options = getOptions(this);
  const { style, target } = options;

  if (meta) {
    // file: &amp;#39;test.vue&amp;#39;
    // sourceRoot: &amp;#39;client&amp;#39;
    const { file, sourceRoot } = meta;

    if (target === path.join(sourceRoot, file)) {
      const string = `\n@import &amp;quot;${style}&amp;quot;;\n`;
      
      source += string;
    }
  }

  return source;
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;Webpack 配置文件中loader部分修改如下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports = {
  entry: [...],
  output: {...},
  module: {
    rules: [
      ...,
      {
        test: /\.less$/,
        use: [
          {
            loader: &amp;#39;style-loader&amp;#39;,
          },
          {
            loader: &amp;#39;css-loader&amp;#39;,
          },
          {
            loader: &amp;#39;less-loader&amp;#39;,
          }，
          {
            loader: path.resolve(__dirname, &amp;#39;./loader/merge-less.js&amp;#39;), // 自定义loader文件的路径
            options: {
              style: path.resolve(root, &amp;#39;client/statics/projects/it/style.less&amp;#39;),
            },
          }
        ];
      }
      ...,
    ],
  },
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;优化-Loader&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BC%98%E5%8C%96-Loader&quot; aria-label=&quot;优化 Loader permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;优化 Loader&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;最后利用 &lt;a href=&quot;https://webpack.docschina.org/contribute/writing-a-loader/#loader-%E5%B7%A5%E5%85%B7%E5%BA%93-loader-utilities-&quot; class=&quot;link-underline&quot;&gt;Loader 工具库&lt;/a&gt;来优化代码&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const fs = require(&amp;#39;fs&amp;#39;);
const path = require(&amp;#39;path&amp;#39;);
const loaderUtils = require(&amp;#39;loader-utils&amp;#39;);
const validateOptions = require(&amp;#39;schema-utils&amp;#39;);

const schema = {
  type: &amp;#39;object&amp;#39;,
  properties: {
    style: {
      type: &amp;#39;string&amp;#39;,
    },
    target: {
      type: &amp;#39;string&amp;#39;,
    },
  },
  required: [ &amp;#39;style&amp;#39;, &amp;#39;target&amp;#39; ],
};


module.exports = function (source, meta) {
  const options = loaderUtils.getOptions(this);

  // 验证 options 参数
  validateOptions(schema, options, &amp;#39;Loader options&amp;#39;);

  let { style, target } = options;

  /*
   * Loader 原则之一：不要在模块代码中插入绝对路径，因为当项目根路径变化时，文件绝对路径也会变化
   * 使用 stringifyReques 将绝对路径转换成相对路径
   */
  style = loaderUtils.stringifyRequest(this, style);

  if (meta) {
    const { file, sourceRoot } = meta;

    if (target === path.join(sourceRoot, file)) {
      const string = `\n @import ${style};\n`;

      source += string;
    }
  }

  return source;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;结束&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F&quot; aria-label=&quot;结束 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;至此，已经用一种比较优雅的方式实现了项目Logo等样式的定制化，其优势在于：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;侵入性弱。只需要在项目仓库中维护对应的资源，不影响源代码，交付时也不会包含多余的资源。&lt;/li&gt;
&lt;li&gt;拓展性强。自定义的图片资源不在依赖源码，可以使用任意的图片格式。&lt;/li&gt;
&lt;li&gt;功能丰富。可以额外增加自定义样式，不限于需求中的Logo和背景。&lt;/li&gt;
&lt;li&gt;体验好。在编译阶段加载指定的样式，一步到位。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;如果同学们有其他的实现方式，欢迎讨论~~&lt;/p&gt;</content:encoded></item><item><title><![CDATA[在 CentOS 上部署 pyspider 爬虫项目]]></title><description><![CDATA[前言 之前在腾讯云的云主机中，部署了一个pyspider爬虫项目，专门爬链家上的二手房信息。前段时间云主机被我玩坏了，重装了一次，需要重新在部署一次。之前没有记录下具体的过程，无奈只能搜索资料重来一次。乘着这次机会，在此记录下 CentOS 上 Pyspider 爬虫项目的部署…]]></description><link>https://zhanglun.github.io/blogs/2018-10-08-在CentOS上部署Pyspider爬虫项目/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2018-10-08-在CentOS上部署Pyspider爬虫项目/</guid><pubDate>Mon, 08 Oct 2018 23:12:03 GMT</pubDate><content:encoded>&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;前言&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%89%8D%E8%A8%80&quot; aria-label=&quot;前言 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;前言&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;之前在腾讯云的云主机中，部署了一个pyspider爬虫项目，专门爬链家上的二手房信息。前段时间云主机被我玩坏了，重装了一次，需要重新在部署一次。之前没有记录下具体的过程，无奈只能搜索资料重来一次。乘着这次机会，在此记录下 CentOS 上 Pyspider 爬虫项目的部署过程。以后还是需要多做笔记，整理学习&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;安装-Python3&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-Python3&quot; aria-label=&quot;安装 Python3 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 Python3&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在部署pyspider项目之前，需要安装Python，虽然系统自带Python2.7.5，但是我选择使用Python3。Python3的安装过程十分简单，在我之前的文章：&lt;a href=&quot;https://zhanglun.github.io/2018/03/09/%E4%B8%AA%E4%BA%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B8%B8%E7%94%A8%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/&quot; class=&quot;link-underline&quot;&gt;个人服务器常用基础配置&lt;/a&gt; 中提到过。在这里重新记录一次&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;源码安装&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85&quot; aria-label=&quot;源码安装 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;源码安装&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在安装之前，有几个依赖工具需要提前装好。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ yum install gcc zlib-devel&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;接下来时下载源码、编译安装。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ wget https://www.python.org/ftp/python/3.7.0/Python-3.7.0.tar.xz -O python3.7.0.tar.xz
$ tar xJf python3.7.0tar.xz
$ cd python3.7.0tar.xz
$ ./configure

// 因为我使用的是 fish-shell。其实就是 bash 中的 `make &amp;amp;&amp;amp; make install`
$ make; and  make install

// 检查安装结果。输出 `/usr/local/bin/python3`
$ which python3&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;使用-pyenv-安装&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8-pyenv-%E5%AE%89%E8%A3%85&quot; aria-label=&quot;使用 pyenv 安装 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用 pyenv 安装&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;有时多个python版本还是希望用pyenv隔离下，避免不同版本库间的影响干扰。有时为了避免固有bug的影响，希望从零开始安装一个纯净的环境，pyenv就可以发挥作用了。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;安装依赖的库文件&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E7%9A%84%E5%BA%93%E6%96%87%E4%BB%B6&quot; aria-label=&quot;安装依赖的库文件 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装依赖的库文件&lt;/h4&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;yum install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;安装-pyenv&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-pyenv&quot; aria-label=&quot;安装 pyenv permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 pyenv&lt;/h4&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;git clone git://github.com/yyuu/pyenv.git ~/.pyenv
echo &amp;#39;export PYENV_ROOT=&amp;quot;$HOME/.pyenv&amp;quot;&amp;#39; &amp;gt;&amp;gt; ~/.bashrc
echo &amp;#39;export PATH=&amp;quot;$PYENV_ROOT/bin:$PATH&amp;quot;&amp;#39; &amp;gt;&amp;gt; ~/.bashrc
echo &amp;#39;eval &amp;quot;$(pyenv init -)&amp;quot;&amp;#39; &amp;gt;&amp;gt; ~/.bashrc
exec $SHELL -l&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;简单使用&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8&quot; aria-label=&quot;简单使用 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;简单使用&lt;/h4&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;#查看当前版本
pyenv version

# 查看所有版本
pyenv versions

# 查看所有可安装的版本
pyenv install --list

# 安装指定版本
pyenv install 3.6.5
# 安装新版本后rehash一下
pyenv rehash

# 删除指定版本
pyenv uninstall 3.5.2

# 指定全局版本
pyenv global 3.6.5

# 指定多个全局版本, 3版本优先
pyenv global 3.6.5 2.7.14

# 实际上当你切换版本后, 相应的pip和包仓库都是会自动切换过去的&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;使用Pyenv安装python&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8Pyenv%E5%AE%89%E8%A3%85python&quot; aria-label=&quot;使用Pyenv安装python permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用Pyenv安装python&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;如果你试图通过pyenv安装python版本，不出意外的话一定会失败。解决方案很简单：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;pyenv搜狐镜像源加速：&lt;a href=&quot;http://mirrors.sohu.com/python/&quot; class=&quot;link-underline&quot;&gt;http://mirrors.sohu.com/python/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;下载需要的版本放到~/.pyenv/cache文件夹下面&lt;/li&gt;
&lt;li&gt;然后执行 pyenv install 版本号 安装对应的python版本&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;简化为一条命令：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;v=3.6.5;wget http://mirrors.sohu.com/python/$v/Python-$v.tar.xz -P ~/.pyenv/cache/;pyenv install $v  &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;然后通过 &lt;code&gt;pyenv global 3.6.5&lt;/code&gt; 设置当前python版本，再 &lt;code&gt;pyenv rehash&lt;/code&gt; 即可。此时&lt;code&gt;python&lt;/code&gt;和&lt;code&gt;pip&lt;/code&gt;都是python3对应的版本&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;通过修改pip的镜像源加速python包的下载。创建或者修改以下文件 ~/.pip/pip.conf 写入以下文件内容&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;[global]
index-url = http://mirrors.aliyun.com/pypi/simple
[install]
trusted-host = mirrors.aliyun.com&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这样在使用pip来安装时，会默认调用该镜像。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;安装-pyspider&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-pyspider&quot; aria-label=&quot;安装 pyspider permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 pyspider&lt;/h2&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;pip install pyspider&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;关于 pyspider的使用在此不在复述，网上有很多教程。个人在使用过程中，增加了一个配置文件，最终通过一下命令启动&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;nohup pyspider -c config.json&amp;amp;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[TypeScript学习笔记-在Webpack中配置TypeScript]]></title><description><![CDATA[上篇说到TypeScript简单的基本知识，包括什么是TypeScript、TypeScript的安装以及TypeScript中的基本类型。今天来了解一下如何在Webpack中配置TypeScript。 tsconfig.json 首先，先来认识一下 TypeScript 中的…]]></description><link>https://zhanglun.github.io/blogs/2018-07-15-TypeScript学习笔记-在Webpack中配置TypeScript/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2018-07-15-TypeScript学习笔记-在Webpack中配置TypeScript/</guid><pubDate>Sun, 15 Jul 2018 11:26:49 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;上篇说到TypeScript简单的基本知识，包括什么是TypeScript、TypeScript的安装以及TypeScript中的基本类型。今天来了解一下如何在Webpack中配置TypeScript。&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;tsconfigjson&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#tsconfigjson&quot; aria-label=&quot;tsconfigjson permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;tsconfig.json&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;首先，先来认识一下 TypeScript 中的配置文件&lt;code&gt;tsconfig.json&lt;/code&gt;。之前提到过，TypeScript 在全局安装之后，便可以通过 &lt;code&gt;tsc&lt;/code&gt; 命令来执行.ts文件的编译。&lt;code&gt;tsconfig.json&lt;/code&gt; 可以指定编译时的各种参数。如果一个目录下存在一个 &lt;code&gt;tsconfig.json&lt;/code&gt; 文件，那么它意味着这个目录是TypeScript项目的根目录。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;使用&lt;code&gt;tsc&lt;/code&gt;命令时，在不带任何输入文件的情况下，编译器会从当前目录开始去查找 &lt;code&gt;tsconfig.json&lt;/code&gt; 文件，逐级向上搜索父目录。如果带上命令行参数—project（或-p），则指定一个包含 &lt;code&gt;tsconfig.json&lt;/code&gt;。在命令行上指定的编译选项会覆盖在 &lt;code&gt;tsconfig.json&lt;/code&gt; 文件里的相应选项。文件的目录。如果命令行指定了配置文件，将会采用指定的文件作为配置输入，即使当前目录中已经存在 &lt;code&gt;tsconfig.json&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;来看一个简单的&lt;code&gt;tsconfig.json&lt;/code&gt;配置：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;json&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;{
   &amp;quot;compilerOptions&amp;quot;: {
    &amp;quot;module&amp;quot;: &amp;quot;system&amp;quot;,  // 指定生成哪个模块系统代码： &amp;quot;None&amp;quot;， &amp;quot;CommonJS&amp;quot;， &amp;quot;AMD&amp;quot;， &amp;quot;System&amp;quot;， &amp;quot;UMD&amp;quot;， &amp;quot;ES6&amp;quot;或 &amp;quot;ES2015&amp;quot;。 只有 &amp;quot;AMD&amp;quot;和 &amp;quot;System&amp;quot;能和 --outFile一起使用。 &amp;quot;ES6&amp;quot;和 &amp;quot;ES2015&amp;quot;可使用在目标输出为 &amp;quot;ES5&amp;quot;或更低的情况下。
    &amp;quot;noImplicitAny&amp;quot;: true,
    &amp;quot;removeComments&amp;quot;: true,
    &amp;quot;preserveConstEnums&amp;quot;: true,
    &amp;quot;outFile&amp;quot;: &amp;quot;./dist/&amp;quot;,
    &amp;quot;sourceMap&amp;quot;: true
  },
  &amp;quot;include&amp;quot;: [
    &amp;quot;src/**/*&amp;quot;
  ],
  &amp;quot;exclude&amp;quot;: [
    &amp;quot;node_modules&amp;quot;,
    &amp;quot;**/*.spec.ts&amp;quot;
  ]
}
&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;compilerOptions&lt;/code&gt; 可以为空，此时编译器会使用默认值。这里有完整的&lt;a href=&quot;https://www.typescriptlang.org/docs/handbook/compiler-options.html&quot; class=&quot;link-underline&quot;&gt;compilerOptions&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;files&lt;/code&gt; 指定一个包含相对或绝对文件路径的列表。 &lt;code&gt;include&lt;/code&gt; 和 &lt;code&gt;exclude&lt;/code&gt; 属性指定一个文件glob匹配模式列表。 支持的glob通配符有：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;* 匹配0或多个字符（不包括目录分隔符）&lt;/li&gt;
&lt;li&gt;? 匹配一个任意字符（不包括目录分隔符）&lt;/li&gt;
&lt;li&gt;**/ 递归匹配任意子目录&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;如果一个glob模式里的某部分只包含 * 或 .*，那么仅有支持的文件扩展名类型被包含在内（比如默认.ts，.tsx，和.d.ts， 如果 allowJs设置能true还包含.js和.jsx）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果 &lt;code&gt;files&lt;/code&gt; 和 &lt;code&gt;include&lt;/code&gt; 都没有被指定，&lt;strong&gt;编译器默认包含当前目录和子目录下所有的 TypeScript 文件（.ts, .d.ts 和 .tsx）&lt;/strong&gt;，排除在”exclude”里指定的文件。JS文件（.js和.jsx）也被包含进来如果allowJs被设置成true。 如果指定了 “files”或”include”，编译器会将它们结合一并包含进来。 使用 “outDir”指定的目录下的文件永远会被编译器排除，除非你明确地使用”files”将其包含进来（这时就算用exclude指定也没用）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;使用 &lt;code&gt;include&lt;/code&gt; 引入的文件可以使用 &lt;code&gt;exclude&lt;/code&gt; 属性过滤。 然而，通过 &lt;code&gt;files&lt;/code&gt; 属性明确指定的文件却总是会被包含在内，不管 &lt;code&gt;exclude&lt;/code&gt; 如何设置。 如果没有特殊指定， &lt;code&gt;exclude&lt;/code&gt; 默认情况下会排除 &lt;code&gt;node_modules&lt;/code&gt;，&lt;code&gt;bower_components&lt;/code&gt;，&lt;code&gt;jspm_packages&lt;/code&gt;和&lt;code&gt;&amp;#x3C;outDir&gt;&lt;/code&gt;目录。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;任何被 &lt;code&gt;files&lt;/code&gt; 或 &lt;code&gt;include&lt;/code&gt; 指定的文件所引用的文件也会被包含进来。 A.ts引用了B.ts，因此B.ts不能被排除，除非引用它的A.ts在 &lt;code&gt;exclude&lt;/code&gt; 列表中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;需要注意编译器不会去引入那些可能做为输出的文件；比如，假设我们包含了index.ts，那么index.d.ts和index.js会被排除在外。 通常来讲，不推荐只有扩展名的不同来区分同目录下的文件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;tsconfig.json&lt;/code&gt; 文件可以是个空文件，那么所有默认的文件（如上面所述）都会以默认配置选项编译。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;与Webpack集成&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%8EWebpack%E9%9B%86%E6%88%90&quot; aria-label=&quot;与Webpack集成 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;与Webpack集成&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;如果你已经有webpack的使用经验的话，这一步将会非常简单。设置好 &lt;code&gt;tsconfig.json&lt;/code&gt; 之后，只需要针对 &lt;code&gt;ts&lt;/code&gt; 文件配置对应的Loader即可。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;1、首先需要安装必备的几个package:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;npm install --save-dev typescript ts-loader&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;2、 设置基本的 &lt;code&gt;tsconfig.json&lt;/code&gt; 配置，来支持 JSX，并将 TypeScript 编译到 ES5……&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;tsconfig.json&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;json&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;{
  &amp;quot;compilerOptions&amp;quot;: {
    &amp;quot;outDir&amp;quot;: &amp;quot;./dist/&amp;quot;,
    &amp;quot;noImplicitAny&amp;quot;: true,
    &amp;quot;module&amp;quot;: &amp;quot;commonjs&amp;quot;,
    &amp;quot;target&amp;quot;: &amp;quot;es6&amp;quot;,
    &amp;quot;jsx&amp;quot;: &amp;quot;react&amp;quot;,
    &amp;quot;allowJs&amp;quot;: true,
    &amp;quot;sourceMap&amp;quot;: true   
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;3、在 webpack 配置中处理 TypeScript：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;webpack.config.js&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const path = require(&amp;#39;path&amp;#39;);

module.exports = {
  entry: &amp;#39;./src/index.ts&amp;#39;,
  devtool: &amp;#39;inline-source-map&amp;#39;,
  module: {
    rules: [
      {
        test: /\.ts|.tsx$/,
        exclude: [
          path.resolve(__dirname, &amp;#39;node_modules&amp;#39;),
        ],
        use: () =&amp;gt; {
          return [
            {
              loader: [&amp;#39;ts-loader&amp;#39;],
            },
          ];
        },
      },
    ]
  },
  resolve: {
    extensions: [ &amp;#39;.tsx&amp;#39;, &amp;#39;.ts&amp;#39;, &amp;#39;.js&amp;#39; ]
  },
  output: {
    filename: &amp;#39;bundle.js&amp;#39;,
    path: path.resolve(__dirname, &amp;#39;dist&amp;#39;)
  }
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这会直接将 webpack 的入口起点指定为 ./index.ts，然后通过 ts-loader _加载所有的 .ts 和 .tsx 文件，并且在当前目录输出_一个 bundle.js 文件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;以上，是在webpack中集成TypeScript的一种基本模式，后续根据项目需要修改相关配置。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[TypeScript学习笔记-入门:安装与基础知识]]></title><description><![CDATA[TypeScript 是由微软推出的开源编程语言，官网的定义如下： TypeScript is a typed superset of JavaScript that compiles to plain JavaScript. Any browser. Any host. An…]]></description><link>https://zhanglun.github.io/blogs/2018-07-08-TypeScript学习笔记-入门:安装与基础知识/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2018-07-08-TypeScript学习笔记-入门:安装与基础知识/</guid><pubDate>Sun, 08 Jul 2018 21:08:03 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;TypeScript 是由微软推出的开源编程语言，官网的定义如下：&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;TypeScript is a typed superset of JavaScript that compiles to plain JavaScript. Any browser. Any host. Any OS. Open source.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;TypeScript 是 JavaScript 的类型的超集，它可以编译成纯 JavaScript。编译出来的 JavaScript 可以运行在任何浏览器上。TypeScript 编译工具可以运行在任何服务器和任何系统上。TypeScript 是开源的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--more--&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;安装-TypeScript&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-TypeScript&quot; aria-label=&quot;安装 TypeScript permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 TypeScript&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;使用 npm 安装 typescript。一步到位，可通过 &lt;code&gt;tsc --help&lt;/code&gt; 查看帮助。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;npm install -g typescript&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;简单的例子&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AE%80%E5%8D%95%E7%9A%84%E4%BE%8B%E5%AD%90&quot; aria-label=&quot;简单的例子 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;简单的例子&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;前面说到，TypeScript 是 JavaScript 的超集。何谓超集？来回顾一下初中数学：&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;如果一个集合S2中的每一个元素都在集合S1中，且集合S1中可能包含S2中没有的元素，则集合S1就是S2的一个超集，反过来，S2是S1的子集。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;而这也体现在TypeScript的语言上，TypeScript 包含 JavaSscript 的所有。也就是说，即使是按照 JavaScript 编写的代码，也能够被视作 TypeScript 来编译执行。举一个简单的例子：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// hello.ts

function sayHello(name) {
  return `Hello, ${name}`;
}

sayHeloo(&amp;#39;zhanglun`&amp;#39;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;上述代码在TypeScript编译器会中会被编译输出如下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// hello.js
function sayHello(name) {
  return &amp;quot;Hello, &amp;quot; + name;
}
sayHello(&amp;#39;zhanglun&amp;#39;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;加入类型检查&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8A%A0%E5%85%A5%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5&quot; aria-label=&quot;加入类型检查 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;加入类型检查&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;上面的例子只是提到了 TypeScript代码 转换为 JavaScript 代码。接下来说一说 TypeScript 区别于 JavaScript 的精髓所在：类型检查。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;众所周知，JavaScript 是一门弱类型语言的，在代码执行的过程中，时常会执行一些隐身类型转换，而这往往会产生一些难以预料的问题，同时难以排查出存在问题的代码。而 TypeScript 加入了编译的过程，在编译过程中进行静态类型检查。如果发现有错误，编译的时候就会报错。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;TypeScript 中，使用 : 指定变量的类型，: 的前后有没有空格都可以。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;举一个简单的例子：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function sayHello(person: string) {
  return &amp;#39;Hello, &amp;#39; + person;
}

let user = [0, 1, 2];

console.log(sayHello(user));&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这段代码的编译会出错。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;hello.ts:7:22 - error TS2345: Argument of type &amp;#39;number[]&amp;#39; is not assignable to parameter of type &amp;#39;string&amp;#39;.

7 console.log(sayHello(user));&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;TypeScript 编译过程即使报错了，还是会生成编译结果，我们仍然可以使用这个编译之后的文件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果要在报错的时候终止 JavaScript 文件的生成，可以在 tsconfig.json 中配置 noEmitOnError 即可。更新 config 相关配置请移步&lt;a href=&quot;http://www.typescriptlang.org/docs/handbook/tsconfig-json.html&quot; class=&quot;link-underline&quot;&gt;官方手册&lt;/a&gt;。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;类型声明&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%B1%BB%E5%9E%8B%E5%A3%B0%E6%98%8E&quot; aria-label=&quot;类型声明 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;类型声明&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;JavaScript 的类型分为两种：原始数据类型（Primitive data types）和对象类型（Object types）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;原始数据类型包括：布尔值、数值、字符串、null、undefined 以及 ES6 中的新类型 Symbol。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在 TypeScript 中，声明上述各种变量稍有不同。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;Boolean&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Boolean&quot; aria-label=&quot;Boolean permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Boolean&lt;/h4&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let isDone:boolean = false; // 声明一个变量，这个变量是一个boolen
let createdByNewBoolean: boolean = new Boolean(1); // index.ts(1,5): error TS2322: Type &amp;#39;Boolean&amp;#39; is not assignable to type &amp;#39;boolean&amp;#39;。 new Boolean() 返回的是一个 Boolean 对象。
let createdByBoolean: boolean = Boolean(1); // 直接调用 Boolean 也可以返回一个 boolean 类型：&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;Number&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Number&quot; aria-label=&quot;Number permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Number&lt;/h4&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let decLiteral: number = 6;
let hexLiteral: number = 0xf00d;

// ES6 中的二进制表示法
let binaryLiteral: number = 0b1010;

// ES6 中的八进制表示法
let octalLiteral: number = 0o744;
let notANumber: number = NaN;
let infinityNumber: number = Infinity;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;String&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#String&quot; aria-label=&quot;String permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;String&lt;/h4&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let myName: string = &amp;#39;Tom&amp;#39;;
let myAge: number = 25;

// 模板字符串
let sentence: string = `Hello, my name is ${myName}.
I&amp;#39;ll be ${myAge + 1} years old next month.`;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;Void&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Void&quot; aria-label=&quot;Void permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Void&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;JavaScript 没有空值（Void）的概念，在 TypeScirpt 中，可以用 void 表示没有任何返回值的函数：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function alertName(): void {
    alert(&amp;#39;My name is Tom&amp;#39;);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;声明一个 void 类型的变量没有什么用，因为你只能将它赋值为 undefined 和 null：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let unusable: void = undefined;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;Null-和-Undefined&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Null-%E5%92%8C-Undefined&quot; aria-label=&quot;Null 和 Undefined permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Null 和 Undefined&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;在 TypeScript 中，可以使用 null 和 undefined 来定义这两个原始数据类型：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let u: undefined = undefined;
let n: null = null;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;undefined 类型的变量只能被赋值为 undefined，null 类型的变量只能被赋值为 null。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;与 void 的区别是，undefined 和 null 是所有类型的子类型。也就是说 undefined 类型的变量，可以赋值给 number 类型的变量：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// 这样不会报错
let num: number = undefined;
// 这样也不会报错
let u: undefined;
let num: number = u;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;而 void 类型的变量不能赋值给 number 类型的变量：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let u: void;
let num: number = u;

// index.ts(2,5): error TS2322: Type &amp;#39;void&amp;#39; is not assignable to type &amp;#39;number&amp;#39;.&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;任意值&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%BB%E6%84%8F%E5%80%BC&quot; aria-label=&quot;任意值 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;任意值&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;TypeScript 提供了一个 any 类型，表示允许赋值为任意类。声明一个变量为任意值之后，对它的任何操作，返回的内容的类型都是任意值。要注意的是： 变量如果在声明的时候，未指定其类型，那么它会被识别为任意值类型。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果是一个普通类型，在赋值过程中改变类型是不被允许的：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let myFavoriteNumber: string = &amp;#39;seven&amp;#39;;

myFavoriteNumber = 7;

// index.ts(2,1): error TS2322: Type &amp;#39;number&amp;#39; is not assignable to type &amp;#39;string&amp;#39;.&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;但如果是 any 类型，则允许被赋值为任意类型。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let myFavoriteNumber: any = &amp;#39;seven&amp;#39;;

myFavoriteNumber = 7;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;聪明的类型推导&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%81%AA%E6%98%8E%E7%9A%84%E7%B1%BB%E5%9E%8B%E6%8E%A8%E5%AF%BC&quot; aria-label=&quot;聪明的类型推导 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;聪明的类型推导&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;如果没有明确的指定类型，那么 TypeScript 会依照类型推论（Type Inference）的规则推断出一个类型。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;以下代码虽然没有指定类型，但是会在编译的时候报错：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let myFavoriteNumber = &amp;#39;seven&amp;#39;;

myFavoriteNumber = 7;

// index.ts(2,1): error TS2322: Type &amp;#39;number&amp;#39; is not assignable to type &amp;#39;string&amp;#39;.&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;事实上，它等价于：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let myFavoriteNumber: string = &amp;#39;seven&amp;#39;;

myFavoriteNumber = 7;

// index.ts(2,1): error TS2322: Type &amp;#39;number&amp;#39; is not assignable to type &amp;#39;string&amp;#39;.&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;TypeScript 会在没有明确的指定类型的时候推测出一个类型，这就是类型推论。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果定义的时候没有赋值，不管之后有没有赋值，都会被推断成 any 类型而完全不被类型检查：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let myFavoriteNumber;

myFavoriteNumber = &amp;#39;seven&amp;#39;;
myFavoriteNumber = 7;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[个人服务器常用基础配置]]></title><description><![CDATA[买了一个服务器，系统是CentOS7.2 .做了一番基础设置，在此记录一下。 更新 yum 源仓库 安装 Git yum 源仓库里最新版本的 Git 是 1.8.3.1，但是官方最新版本已经到了 2.9.2。想要安装最新版本的的 Git，只有下载源码进行安装。 可以通过info…]]></description><link>https://zhanglun.github.io/blogs/2018-02-04-个人服务器常用基础配置/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2018-02-04-个人服务器常用基础配置/</guid><pubDate>Fri, 09 Mar 2018 21:05:12 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;买了一个服务器，系统是CentOS7.2 .做了一番基础设置，在此记录一下。&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;更新-yum-源仓库&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9B%B4%E6%96%B0-yum-%E6%BA%90%E4%BB%93%E5%BA%93&quot; aria-label=&quot;更新 yum 源仓库 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;更新 yum 源仓库&lt;/h2&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;yum update&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;安装-Git&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-Git&quot; aria-label=&quot;安装 Git permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 Git&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;yum 源仓库里最新版本的 Git 是 1.8.3.1，但是官方最新版本已经到了 2.9.2。想要安装最新版本的的 Git，只有下载源码进行安装。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;可以通过info命令查看源仓库中git的信息&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ yum info git&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在开始编译安装git之前，需要安装一些依赖&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel
$ yum install gcc perl-ExtUtils-MakeMaker&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;下载源码压缩包，解压之后编译和安装&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ wget https://www.kernel.org/pub/software/scm/git/git-2.9.5.tar.gz -O git.tar.gz
$ tar -zxf git.tar.gz
$ cd git.tar.gz
$ make prefix=/usr/local all
$ sudo make prefix=/usr/local install&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;可以在&lt;a href=&quot;https://www.kernel.org/pub/software/scm/git/&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;找到所有的版本。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;安装-fish-shell&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-fish-shell&quot; aria-label=&quot;安装 fish shell permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 fish-shell&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;CentOS 6和CentOS 7使用的源不同，需要注意一下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// CentOS 7
$ cd /etc/yum.repos.d/
$ wget https://download.opensuse.org/repositories/shells:fish:release:2/CentOS_7/shells:fish:release:2.repo
$ yum install fish

// CentOS 6
$ cd /etc/yum.repos.d/
$ wget https://download.opensuse.org/repositories/shells:fish:release:2/CentOS_6/shells:fish:release:2.repo
$ yum install fish&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;安装&lt;a href=&quot;https://github.com/oh-my-fish/oh-my-fish&quot; class=&quot;link-underline&quot;&gt;oh-my-fish&lt;/a&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;curl -L https://get.oh-my.fish | fish&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;安装oh-my-fish的主题&lt;a href=&quot;https://github.com/oh-my-fish/theme-clearance&quot; class=&quot;link-underline&quot;&gt;clearance&lt;/a&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ omf install clearance&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;安装Nodejs&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85Nodejs&quot; aria-label=&quot;安装Nodejs permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装Node.js&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;安装Node.js方式有多种：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;更新yum源，使用yum安装&lt;/li&gt;
&lt;li&gt;下载源代码编译安装&lt;/li&gt;
&lt;li&gt;使用&lt;a href=&quot;https://github.com/creationix/nvm&quot; class=&quot;link-underline&quot;&gt;nvm&lt;/a&gt;安装&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;我选择使用nvm安装和管理服务器上的Node。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;wget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.33.8/install.sh | bash&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;nvm在fish-shell下无法使用，需要做一些其他的工作。可以通过&lt;a href=&quot;https://github.com/edc/bass&quot; class=&quot;link-underline&quot;&gt;bass&lt;/a&gt;让 fish-shell 可以使用 bash 环境下的工具。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// 先安装fisherman
curl -Lo ~/.config/fish/functions/fisher.fish --create-dirs https://git.io/fisher

// 安装 bass
fisher edc/bass&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;编辑fish的配置文件&lt;code&gt;~/.config/fish/config.fish&lt;/code&gt;(如果文件不存在就创建一个)，增加一段 bass 命令的封装代码&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function nvm
  bass source ~/.nvm/nvm.sh &amp;#39;;&amp;#39; nvm $argv
end&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;现在就可以在fish-shell中使用nvm了。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// 安装 nodev8.10.0
nvm install 8.10.0

// 设置 npm 的 Taobao 源
npm config set registry https://registry.npm.taobao.org --global
npm config set disturl https://npm.taobao.org/dist --global
&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;安装-Python3&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-Python3&quot; aria-label=&quot;安装 Python3 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 Python3&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;CentOS 7系统自带 Python2.7.5。我需要在安装最新的Python v3.x版本。
在安装之前，有几个依赖工具需要提前装好。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ yum install gcc zlib-devel&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;之前安装git时已经安装过。所以接下来时下载源码、编译安装。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ wget https://www.python.org/ftp/python/3.6.0/Python-3.6.0.tar.xz -O python3.6.tar.xz
$ tar xJf python3.6.tar.xz
$ cd python3.6.tar.xz
$ ./configure

// 因为我使用的是 fish-shell。其实就是 bash 中的 `make &amp;amp;&amp;amp; make install`
$ make; and  make install

// 检查安装结果。输出 `/usr/local/bin/python3`
$ which python3&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;安装-MySQL&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-MySQL&quot; aria-label=&quot;安装 MySQL permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 MySQL&lt;/h2&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;MySQL 被 Oracle 收购后，有将MySQL闭源的潜在风险，因此社区采用分支的方式来避开这个风险。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;MariaDB的目的是完全兼容MySQL，包括API和命令行，使之能轻松成为MySQL的代替品。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;更多详情可访问&lt;a href=&quot;https://www.wikiwand.com/zh/MariaDB&quot; class=&quot;link-underline&quot;&gt;Wiki-MariaDB&lt;/a&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;MySQL 被 Oracle 收购后，CentOS 的镜像仓库中提供的默认的数据库也变为了 MariaDB。所以从官网安装。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ wget http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm
$ rpm -ivh mysql-community-release-el7-5.noarch.rpm
$ yum install mysql-community-server

// 安装成功后重启mysql服务。
$ service mysql restart&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;设置编码&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%AE%BE%E7%BD%AE%E7%BC%96%E7%A0%81&quot; aria-label=&quot;设置编码 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;设置编码&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在 /etc/my.cnf 中设置默认的编码&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;vim&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;[client]
default-character-set = utf8

[mysqld]
default-storage-engine = INNODB
character-set-server = utf8
collation-server = utf8_general_ci #不区分大小写
collation-server =  utf8_bin #区分大小写
collation-server = utf8_unicode_ci #比 utf8_general_ci 更准确&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;安装-Nginx&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-Nginx&quot; aria-label=&quot;安装 Nginx permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 Nginx&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;yum 在线安装会将 nginx 的安装文件放在系统的不同位置，可以通过命令 rpm -ql nginx 来查看安装路径&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;gt; $ rpm -ql nginx
/etc/logrotate.d/nginx
/etc/nginx
/etc/nginx/conf.d
/etc/nginx/conf.d/default.conf
/etc/nginx/conf.d/ssl.conf
/etc/nginx/conf.d/virtual.conf
/etc/nginx/fastcgi.conf
/etc/nginx/fastcgi.conf.default
/etc/nginx/fastcgi_params
/etc/nginx/fastcgi_params.default
/etc/nginx/koi-utf
/etc/nginx/koi-win
/etc/nginx/mime.types
/etc/nginx/mime.types.default
/etc/nginx/nginx.conf
/etc/nginx/nginx.conf.default
/etc/nginx/scgi_params
/etc/nginx/scgi_params.default
/etc/nginx/uwsgi_params
/etc/nginx/uwsgi_params.default
/etc/nginx/win-utf
/etc/rc.d/init.d/nginx
/etc/sysconfig/nginx
/usr/lib/perl5/vendor_perl/auto/nginx
/usr/lib/perl5/vendor_perl/auto/nginx/nginx.so
/usr/lib/perl5/vendor_perl/nginx.pm
/usr/sbin/nginx
/usr/share/doc/nginx-1.0.15
/usr/share/doc/nginx-1.0.15/CHANGES
/usr/share/doc/nginx-1.0.15/LICENSE
/usr/share/doc/nginx-1.0.15/README
/usr/share/man/man3/nginx.3pm.gz
/usr/share/man/man8/nginx.8.gz
/usr/share/nginx/html/404.html
/usr/share/nginx/html/50x.html
/usr/share/nginx/html/index.html
/usr/share/nginx/html/nginx-logo.png
/usr/share/nginx/html/poweredby.png
/usr/share/vim/vimfiles/ftdetect/nginx.vim
/usr/share/vim/vimfiles/indent/nginx.vim
/usr/share/vim/vimfiles/syntax/nginx.vim
/var/lib/nginx
/var/lib/nginx/tmp
/var/log/nginx&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;源码包 安装他的所有文件（包括配置文件，库文件，资源文件等）都在同一个目录下，我们想卸载的时候，直接将这个文件删除就可以，不会有任何垃圾文件存在。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我采用源码编译的方式安装&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ yum -y install gcc gcc-c++ make libtool zlib zlib-devel openssl openssl-devel pcre pcre-devel
$ wget http://nginx.org/download/nginx-1.12.2.tar.gz
$ tar -zxvf nginx-1.12.2.tar.gz

// 默认安装到 /usr/local/nginx，可以通过--prefix指定安装目录。我这边显式声明一次。
$ ./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module
$ make; and make install&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;nginx 几个常用的命令&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;/usr/local/nginx/sbin/nginx # 启动
/usr/local/nginx/sbin/nginx -s stop # 停止&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[最近几次面试的小总结]]></title><description><![CDATA[前几天离职了，离职前几天开始物色合适的下家。在疯狂的简历投递之后，陆续接到了几个面试邀请，已经面了四家。这四次面试风格迥异，期间遇到了一些比较有意思的问题，在此整理总结一番。 基本上所有的面试都涉及到自我介绍和前一份工作的项目介绍，这里不做讲解。本文主要是记录面试中遇到的面试题…]]></description><link>https://zhanglun.github.io/blogs/2017-02-16-最近几次面试的小小总结/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2017-02-16-最近几次面试的小小总结/</guid><pubDate>Thu, 16 Feb 2017 20:23:13 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;前几天离职了，离职前几天开始物色合适的下家。在疯狂的简历投递之后，陆续接到了几个面试邀请，已经面了四家。这四次面试风格迥异，期间遇到了一些比较有意思的问题，在此整理总结一番。&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;基本上所有的面试都涉及到自我介绍和前一份工作的项目介绍，这里不做讲解。本文主要是记录面试中遇到的面试题。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;部分基础知识&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%83%A8%E5%88%86%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86&quot; aria-label=&quot;部分基础知识 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;部分基础知识&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;每一次面试都涉及到了前端的一些基础知识，虽然有的问题交叉重复出现，但是基本上都是一些不同角度的面试题。比如：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;gulp中的流程控制，如何控制顺序执行和并行执行？&lt;/li&gt;
&lt;li&gt;gulp与webpack的区别？&lt;/li&gt;
&lt;li&gt;Less如何中实现继承？&lt;/li&gt;
&lt;li&gt;原生JavaScript如何发送Ajax请求？Ajax请求结果的状态处理（考察XMLHttpRequest的方法）。&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;不只是简单的XMLHttpRequest对象的使用，包含该对象的其他不太常见的方法。考察对这个对象的了解深度。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol start=&quot;5&quot;&gt;
&lt;li&gt;JavaScript数组中常用的一些方法的解释，比如: filter，some，every，map，forEach等&lt;/li&gt;
&lt;li&gt;说一说JavaScript中的作用域。&lt;/li&gt;
&lt;li&gt;CSS布局的实现：左右固定宽度，中间自适应。&lt;/li&gt;
&lt;li&gt;CSS中实现水平垂直居中的方法。&lt;/li&gt;
&lt;li&gt;解释CSS选择器的权重。&lt;/li&gt;
&lt;li&gt;讲一讲你听过的HTTP请求类型；GET和POST的区别。&lt;/li&gt;
&lt;li&gt;HTTP如何处理缓存？&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;这个问题我根本答不上来。涉及到HTTP Header 中的值。具体的内容可以参考：
&lt;a href=&quot;http://www.alloyteam.com/2012/03/web-cache-2-browser-cache/&quot; class=&quot;link-underline&quot;&gt;http://www.alloyteam.com/2012/03/web-cache-2-browser-cache/&lt;/a&gt;
&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching_FAQ&quot; class=&quot;link-underline&quot;&gt;https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching_FAQ&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol start=&quot;10&quot;&gt;
&lt;li&gt;git的一些操作（rebase等）&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;开放性问题&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%BC%80%E6%94%BE%E6%80%A7%E9%97%AE%E9%A2%98&quot; aria-label=&quot;开放性问题 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;开放性问题&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;自我介绍。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;为什么做前端？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;讲一讲最近的一份工作主要做了什么。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;期待加入什么样的公司或者团队？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;未来的职业规划。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;React的使用过程中性能优化的尝试。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;如果解决模块之间的循环依赖？&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;在回答这个问题的时候，我过于纠结字面的“解决”，试图从编码角度来解决，突然就有点慌了。其实只要讲一下如何避免出现循环依赖即可。比如：模块重新划分，公共的方法变量抽出等。不知是面试官没有表述清楚还是故意为之。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;如果将你简历中的信息输出到页面上呈现：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;你会如何设计信息的数据结构？&lt;/li&gt;
&lt;li&gt;在上一步的基础上如何处理你设计的数据？&lt;/li&gt;
&lt;li&gt;如何将处理过的数据输出？&lt;/li&gt;
&lt;li&gt;输出选择HTML标签集合还是字符串？为什么？&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;这个问题我觉得挺有意思。我觉得实现思路的难度不大，我认为最关键的点在于数据结构的定义，因为这会影响到后续两步的实际编码。具体实现可以参考markdown转成html的实现思路。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;还有一些问题比较细，比较杂，暂时想起来，想到了再补充。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[整理Object的一些方法]]></title><description><![CDATA[ES5 和 ES6 中 Object 添加了很多新的方法，现在很多开源代码中有用到了这些，今天来整理一番。 Object.assign() 这是ES6新添加的方法，Object.assign()用来复制源对象的所有可枚举属性复制到目标对象中，方法返回目标对象。语法如下： sou…]]></description><link>https://zhanglun.github.io/blogs/2017-01-19-整理Object的一些方法/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2017-01-19-整理Object的一些方法/</guid><pubDate>Thu, 19 Jan 2017 19:32:31 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;ES5 和 ES6 中 Object 添加了很多新的方法，现在很多开源代码中有用到了这些，今天来整理一番。&lt;/p&gt;
&lt;!--more--&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Objectassign&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Objectassign&quot; aria-label=&quot;Objectassign permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Object.assign()&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;这是ES6新添加的方法，&lt;code&gt;Object.assign()&lt;/code&gt;用来复制源对象的所有可枚举属性复制到目标对象中，方法返回目标对象。语法如下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Object.assign(target, ...source);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;source对象可以有很多个，比如：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let target = {name: &amp;#39;target&amp;#39;};
let source1 = {age: 23};
let source2 = {email: &amp;#39;zhanglun1410@gmail.com&amp;#39;};
// ...
// let sourceN ={.....};
traget = Object.assign(target, source1, source2);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果源对象和目标对象的属性的key相同，目标对象的属性将会被源对象中的属性覆盖。对于多个源对象来说，如果有相同的key，右边的属性将覆盖左边的属性。这个方法只能将源对象的可枚举对象和自己的属性复制给目标对象。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;什么是可枚举对象（）？
可枚举属性是指那些内部 “可枚举” 标志设置为true的属性，对于通过直接的赋值和属性初始化的属性，该标识值默认为即为true，对于通过Object.defineProperty等定义的属性，该标识值默认为false。可枚举的属性可以通过 for…in 循环进行遍历（除非该属性名是一个 Symbol）。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;对于源对象，Object.assign使用[[Get]]，而在目标对象上使用[[Set]]，也就是说，使用这个方法会源对象的getter和目标对象的setters。所以其本质就是定义或者复制一个新的属性。如果等待合并的源对象包含了getters，那就不太适合用来将源对象合并到原型中。假如复制的属性到原型里，包括它们的可枚举属性，那么应该使用 Object.getOwnPropertyDescriptor() 和 Object.defineProperty() 。String 和 Symbol 属性都是会被复制的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果遇到了一个错误，比如目标对象的某个属性是不可修改的，会抛出一个TypeError的错误吗，目标对象保持不变&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var foo = {}
Object.defineProperty(foo, &amp;#39;name&amp;#39;, {
  writable: false,
  value: &amp;#39;zhanglun&amp;#39;
});
Object.assign(foo, {name: &amp;#39;zhangxiaolun&amp;#39;}); // TypeError: Cannot assign to read only property &amp;#39;1&amp;#39; of object &amp;#39;#&amp;lt;Object&amp;gt;&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果源对象是null或者undefined，Object.assign()不会抛出错误：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var foo = {name: &amp;#39;zhanglun&amp;#39;};
Object.assign(foo, null, undefined);
console.log(foo); // foo: {name: &amp;#39;zhanglun&amp;#39;}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Objectcreate&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Objectcreate&quot; aria-label=&quot;Objectcreate permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Object.create()&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;通过指定的原型对象和属性，创建一个新的对象。语法如下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Object.create(proto, [,. propertiesObject]);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;第一个参数是一个对象，可以是一个普通的对象，比如：&lt;code&gt;{name: &apos;zhanglun&apos;}&lt;/code&gt;，也可以是一个新创建的对象的原型（prototype），比如：new Array().prototype。无论是那种，都是 JavaScript 中的 Object，其属性都被添加到返回的对象原型中；第二个参数是可选的，但是不能是&lt;code&gt;undefined&lt;/code&gt;，该对象自身拥有的可枚举属性会被添加到新创建的对象上，其原型链上的属性是无效的。如果第一个参数不是null或者一个对象值，将会抛出TypeError异常。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Object.create()最直接的作用是基于一个对象创建新的对象，更多时候用在了原型链继承上，先来看看 JavaScript
中创建对象的几种方法：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;对象字面量&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var o = {a: 1};

// o这个对象继承了Object.prototype上面的所有属性
// 所以可以这样使用 o.hasOwnProperty(&amp;#39;a&amp;#39;).
// hasOwnProperty 是Object.prototype的自身属性。
// Object.prototype的原型为null。
// 原型链如下:
// o ---&amp;gt; Object.prototype ---&amp;gt; null

var a = [&amp;quot;yo&amp;quot;, &amp;quot;whadup&amp;quot;, &amp;quot;?&amp;quot;];

// 数组都继承于Array.prototype 
// (indexOf, forEach等方法都是从它继承而来).
// 原型链如下:
// a ---&amp;gt; Array.prototype ---&amp;gt; Object.prototype ---&amp;gt; null

function f(){
  return 2;
}

// 函数都继承于Function.prototype
// (call, bind等方法都是从它继承而来):
// f ---&amp;gt; Function.prototype ---&amp;gt; Object.prototype ---&amp;gt; null&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;构造函数&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;在 JavaScript 中，构造器其实就是一个普通的函数。当使用 new 操作符 来作用这个函数时，它就可以被称为构造方法（构造函数）。如果没有 new 关键字而是直接调用的话，相当于是在当前作用域上调用，此时函数中如果有 this 的话，this 指向的是当前作用域。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function Graph() {
  this.vertexes = [];
  this.edges = [];
}

Graph.prototype = {
  addVertex: function(v){
    this.vertexes.push(v);
  }
};

var g = new Graph();
// g是生成的对象,他的自身属性有&amp;#39;vertices&amp;#39;和&amp;#39;edges&amp;#39;.
// 在g被实例化时,g.[[Prototype]]指向了Graph.prototype.
Graph();
console.log(window.vertexes); // 在全局作用域中调用，意外地增加了全局变量&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;使用 Object.create()&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var a = {a: 1}; 
// a ---&amp;gt; Object.prototype ---&amp;gt; null

var b = Object.create(a);
// b ---&amp;gt; a ---&amp;gt; Object.prototype ---&amp;gt; null
console.log(b.a); // 1 (继承而来)

var c = Object.create(b);
// c ---&amp;gt; b ---&amp;gt; a ---&amp;gt; Object.prototype ---&amp;gt; null

var d = Object.create(null);
// d ---&amp;gt; null
console.log(d.hasOwnProperty); // undefined, 因为d没有继承Object.prototype&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;ES6 中的 Class 关键字&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;ES6 引入了一套新的关键字用来实现 class。这是一个语法糖，其本质还是基于原型的。这些新的关键字包括 class, constructor, static, extends, 和 super。关于 Class的使用，回头再开一篇文章深入学习。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;quot;use strict&amp;quot;;

class Polygon {
  constructor(height, width) {
    this.height = height;
    this.width = width;
  }
}

class Square extends Polygon {
  constructor(sideLength) {
    super(sideLength, sideLength);
  }
  get area() {
    return this.height * this.width;
  }
  set sideLength(newLength) {
    this.height = newLength;
    this.width = newLength;
  }
}

var square = new Square(2);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;使用-Objectcreate-实现继承&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8-Objectcreate-%E5%AE%9E%E7%8E%B0%E7%BB%A7%E6%89%BF&quot; aria-label=&quot;使用 Objectcreate 实现继承 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用 Object.create() 实现继承&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;下面是一个使用 Object.create()实现类的继承的例子。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function Shape() {
  this.x = 0;
  this.y = 0;
}

// 父类的原型方法
Shape.prototype.move = function(x, y) {
  this.x += x;
  this.y += y;
  console.info(&amp;#39;Shape moved.&amp;#39;);
};

// 子类
function Rectangle() {
  Shape.call(this); // 调用构造函数
}

// 子类继承父类
Rectangle.prototype = Object.create(Shape.prototype);
Rectangle.prototype.constructor = Rectangle;

var rect = new Rectangle();

console.log(&amp;#39;Is rect an instance of Rectangle?&amp;#39;, rect instanceof Rectangle);// true
console.log(&amp;#39;Is rect an instance of Shape?&amp;#39;, rect instanceof Shape);// true
rect.move(1, 1); // Outputs, &amp;#39;Shape moved.&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;Objectcreate-VS-new&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Objectcreate-VS-new&quot; aria-label=&quot;Objectcreate VS new permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Object.create VS new&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;前面说到的，Object.create实际上是将第一个参数（无论是原型对象还是普通对象）的属性添加到新创建对象的原型中，这也就意味着，通过&lt;code&gt;new Function()&lt;/code&gt;中定义的属性和方法是无法通过 create()方法添加到新创建对象中的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Object.create创建一个新的对象，这个对象“继承”了第一个参数。构造函数新创建的对象“继承”构造函数的prototype。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let o = new SomeConstructor();  // o 直接继承自`SomeConstructor.prototype`。&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;两者的最明显的不同之处在于：如果 Object.create()的第一个参数是&lt;code&gt;null&lt;/code&gt;，新创建的对象不会“继承”自任何地方，没有原型，也没有往上追溯的原型；在使用构造函数时，如果将其原型设置为 null，&lt;code&gt;SomeConstructor.prototype = null;&lt;/code&gt;，新创建的对象将会“继承”自 Object 的 prototype。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Objectfreeze&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Objectfreeze&quot; aria-label=&quot;Objectfreeze permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Object.freeze()&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;字面意思就是将一个 object“冻住”：不能添加新的属性；不能删除现有的属性；不能修改现有属性，包括属性的enumerability, configurability和 writability。这个方法返回一个不可修改的对象，使用语法：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Object.freeze(obj)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;任何尝试修改该对象的操作都会失败，可能是静默失败，也可能会抛出异常。在严格模式中会抛出异常（本地测试下来严格模式也不会报错）。数据属性的值不可更改，访问器属性（有getter和setter）也同样，但由于是函数调用，给人一种修改了这个属性的错觉。如果一个属性的值是个对象，则这个对象中的属性是可以修改的，除非它也是个冻结对象。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let foo = {
  name: &amp;#39;zhanglun&amp;#39;,
  age: 23,
}

console.log(foo.name); // &amp;#39;zhanglun&amp;#39;
console.log(foo.age); // 23

foo.name = &amp;#39;zhanglun1410&amp;#39;;
foo.age = 24;

console.log(foo.name); // &amp;#39;zhanglun1410&amp;#39;
console.log(foo.age); // 24

Object.freeze(foo);

foo.name = &amp;#39;zzzz&amp;#39;; // 静默失败
console.log(foo.name); // &amp;#39;zhanglun1410&amp;#39;

&amp;#39;use strict&amp;#39;;
foo.name = &amp;#39;zzzz&amp;#39;; // TypeError 或者 静默失败
console.log(foo.name); // &amp;#39;zhanglun1410&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;Objectfreeze-VS-const&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Objectfreeze-VS-const&quot; aria-label=&quot;Objectfreeze VS const permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Object.freeze VS const&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;被冻结的对象是不可改变的。但是它不一定是常量。对常量而言，它的所有引用，无论是直接的还是间接的都是引用的不可改变的对象。string，number，和 boolean 总是不可变的（当你把一个变量从字符串 A 修改到字符串 B时，A 和 B 都是不可变的，A 还是 A，B 也还是 B，只不过变量的之前指向的是 A,修改之后指向了 B）。通常来说，一般不会创建一个对象常量，也不存在freezeAll()这样的方法。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;const 用于声明常量，将变量绑定到一个不可修改的对象，常量最终指向的是一个不可修改的对象，比如一个被冻结的对象，而 Object.freeze 作用在对象的值上，将一个对象变成不可修改的对象。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;深度冻结对象&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%B7%B1%E5%BA%A6%E5%86%BB%E7%BB%93%E5%AF%B9%E8%B1%A1&quot; aria-label=&quot;深度冻结对象 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;深度冻结对象&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;前面提到的，Object.freeze作用在对象的属性上，使对象的属性不可修改。而如果属性值也是一个对象的话，依然能够修改，除非这个对象也被冻结了。因此，可以把 Object.freeze 理解成是“浅冻结”。可以编写额外的代码来实现“深冻结”：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;obj1 = {
  internal: {}
};

Object.freeze(obj1);
obj1.internal.a = &amp;#39;aValue&amp;#39;;

obj1.internal.a // &amp;#39;aValue&amp;#39;

// 深度冻结
function deepFreeze(obj) {

  // 获取到对象的属性的名字
  var propNames = Object.getOwnPropertyNames(obj);

  // 先冻结内部的对象
  propNames.forEach(function(name) {
    var prop = obj[name];

    // Freeze prop if it is an object
    if (typeof prop == &amp;#39;object&amp;#39; &amp;amp;&amp;amp; prop !== null)
      deepFreeze(prop);
  });

  // 冻结 obj
  return Object.freeze(obj);
}

obj2 = {
  internal: {}
};

deepFreeze(obj2);
obj2.internal.a = &amp;#39;anotherValue&amp;#39;;
obj2.internal.a; // undefined&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;Objectfreeze-的注意事项&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Objectfreeze-%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9&quot; aria-label=&quot;Objectfreeze 的注意事项 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Object.freeze 的注意事项&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;在 ES5 中，如果参数不是一个对象，是一个原始数据类型，会抛出 TypeError。在 ES6 中，不是对象的参数的会被当做是一个已经被冻结的普通对象，只是返回这个参数。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;ObjectdefineProperty&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ObjectdefineProperty&quot; aria-label=&quot;ObjectdefineProperty permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Object.defineProperty()&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;Object.defineProperty是ES5新增的一个方法，可以给对象的属性增加更多的控制。语法如下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Object.defineProperty(obj, prop, descriptor)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;前面两个参数很简单，修改的对象和修改或者新增的属性，着重介绍一下第三个参数：属性描述符。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;ES5 中定义了一个名叫“属性描述符”的对象，用于描述了的各种特征，它本身是一个 Object。属性描述符对象有4个属性：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;configurable：可配置性，控制着其描述的属性的修改，表示能否修改属性的特性，能否把属性修改为访问器属性，或者能否通过delete删除属性从而重新定义属性。默认值为true。&lt;/li&gt;
&lt;li&gt;enumerable：可枚举性，表示能否通过for-in遍历得到属性。默认值为true。&lt;/li&gt;
&lt;li&gt;writable：可写性，表示能否修改属性的值。默认值为true。&lt;/li&gt;
&lt;li&gt;value：数据属性，表示属性的值。默认值为undefined。&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;和两个存取器属性，分别是get和set，可以代替value和writable。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;get：在读取属性时调用的函数。只指定get则表示属性为只读属性。默认值为undefined。&lt;/li&gt;
&lt;li&gt;set：在写入属性时调用的函数。只指定set则表示属性为只写属性。默认值为undefined。&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;属性描述符只能在&lt;code&gt;Object.defineProperty&lt;/code&gt;或&lt;code&gt;Object.defineProperties&lt;/code&gt;中使用。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var o = {}; // Creates a new object

// Example of an object property added with defineProperty with a data property descriptor
// 添加属性 a,值为37，并设置属性描述符
Object.defineProperty(o, &amp;#39;a&amp;#39;, {
  value: 37,
  writable: true,
  enumerable: true,
  configurable: true
});


var bValue = 38;
Object.defineProperty(o, &amp;#39;b&amp;#39;, {
  get: function() { return bValue; },
  set: function(newValue) { bValue = newValue; },
  enumerable: true,
  configurable: true
});
o.b; // 38
// o 对象中存在属性 b，他的值为38；
// 只要 o.b没有重新定义，它的值永远都是38

// 访问器不能和 value或者 writable混在一起用
Object.defineProperty(o, &amp;#39;conflict&amp;#39;, {
  value: 0x9f91102,
  get: function() { return 0xdeadbeef; }
});
// 抛出一个错误 Uncaught TypeError: Invalid property descriptor. Cannot both specify accessors and a value or writable attribute, #&amp;lt;Object&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;ObjectdefineProperties&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ObjectdefineProperties&quot; aria-label=&quot;ObjectdefineProperties permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Object.defineProperties()&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;相比 Object.defineProperty， Object.defineProperties可以说是前者的升级版，可以一次同时定义多个属性，语法略有不同：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let obj = {};
Object.defineProperties(obj, {
  &amp;quot;property1&amp;quot;: {
    value: true,
    writable: true
  },
  &amp;quot;property2&amp;quot;: {
    value: &amp;quot;Hello&amp;quot;,
    writable: false
  },
  &amp;quot;property3&amp;quot;: {
    get: function() {
      return &amp;#39;Hello, Object.defineProperties&amp;#39;;
    },
    set:function() {
      this.property2 = &amp;#39;xxxxxx&amp;#39;;
    }
  }
  // etc. etc.
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;参考资料：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign&quot; class=&quot;link-underline&quot;&gt;https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty&quot; class=&quot;link-underline&quot;&gt;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperties&quot; class=&quot;link-underline&quot;&gt;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperties&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create&quot; class=&quot;link-underline&quot;&gt;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze&quot; class=&quot;link-underline&quot;&gt;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://stackoverflow.com/a/17952160&quot; class=&quot;link-underline&quot;&gt;http://stackoverflow.com/a/17952160&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[JavaScrip模块系统详解]]></title><description><![CDATA[在这几天的工作中，我需要调用同事编写的兼容jQuery和React的通用组件。他为了兼容jQuery风格的调用和React的组件化，分别export了一个default和几个方法函数。在调用的过程中，出现了一些小插曲：React代码和老的jQuery老代码调用时应该怎么正确的i…]]></description><link>https://zhanglun.github.io/blogs/2017-01-11-JavaScrip-模块系统详解/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2017-01-11-JavaScrip-模块系统详解/</guid><pubDate>Wed, 11 Jan 2017 19:45:09 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;在这几天的工作中，我需要调用同事编写的兼容jQuery和React的通用组件。他为了兼容jQuery风格的调用和React的组件化，分别export了一个default和几个方法函数。在调用的过程中，出现了一些小插曲：React代码和老的jQuery老代码调用时应该怎么正确的import？虽然是很低级的问题，但是引发了我一些思考：&lt;strong&gt;export 和 import 与 module.exports 和 exports 之间的关系&lt;/strong&gt;以及&lt;strong&gt;JavaScript模块系统的发展历程&lt;/strong&gt;。&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;JavScript这门语言，在设计之初是没有自己的模块系统的。但是在 ES6 正式发布之前，社区已经中已经出现了一些库，实现了简单的模块风格，并且这种风格在 ES6 中也是适用的：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;每个模块都是一段代码，加载之后只会解析过程只会执行一次；&lt;/li&gt;
&lt;li&gt;在模块中可以声明变量，函数，类等；
&lt;ul&gt;
&lt;li&gt;默认情况下，这些声明都是这个模块的局部声明；&lt;/li&gt;
&lt;li&gt;可以将一些声明导出，让其他模块引用；&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;一个模块可以通过模块标识符或者文件路径引入其他模块；&lt;/li&gt;
&lt;li&gt;模块都是单例的，即使多次引用，也只有一个实例;&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;有一点要注意，避免通过&lt;code&gt;global&lt;/code&gt;作为来引用自己的模块，因为&lt;code&gt;global&lt;/code&gt;本身也是一个模块。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;ES5中的模块系统&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ES5%E4%B8%AD%E7%9A%84%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F&quot; aria-label=&quot;ES5中的模块系统 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ES5中的模块系统&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;前面说到的，在 ES6 之前，JavaScript 是没有模块系统这一说的。在社区的模块风格出现之前，编写 JavaScript常常会遇到这种情况：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;所有的代码写在一个文件里面，按照依赖顺序，被依赖的方法必须写在前面。 简单粗暴，但是问题很多
&lt;ul&gt;
&lt;li&gt;通用的代码无法重复利用。&lt;/li&gt;
&lt;li&gt;单个文件会越来越大，后期的命名也会越来越艰难。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;按照功能将代码拆分成不同文件，按照依赖顺序加载，被依赖的方法必须先加载。通用代码可以复用，但是问题还是很多
&lt;ul&gt;
&lt;li&gt;过多全局变量，容易冲突。&lt;/li&gt;
&lt;li&gt;过多 JavaScript 脚本加载导致页面阻塞（虽然 HTML5中的 defer和 async可以适当的减轻这个问题）。&lt;/li&gt;
&lt;li&gt;过多依赖不方便管理和开发。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;随着 JavaScript 的地位慢慢提高，为了满足日常开发的需要，社区中慢慢出现了相对比较同意的模块标准，主要有两种：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;CommonJS Modules:&lt;/strong&gt; 这个标准主要在 Node.js 中实现（Node.js的模块比 CommonJS 好稍微多一些特性）。其特点是：&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;简单的语法&lt;/li&gt;
&lt;li&gt;为同步加载和服务端而设计&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Asynchronous Module Definition (AMD):&lt;/strong&gt; 这个标准最受欢迎的实现实在 RequireJS 中。其特点是：&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;稍微复杂一点点的语法，使得AMD的运行不需要编译&lt;/li&gt;
&lt;li&gt;为异步加载和浏览器而设计&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;上述只是 ES5 模块系统的简单介绍，如果有兴趣可以去看看&lt;a href=&quot;https://addyosmani.com/writing-modular-js/&quot; class=&quot;link-underline&quot;&gt;Writing Modular JavaScript With AMD, CommonJS &amp;#x26; ES Harmony&lt;/a&gt;。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;CommonJS-Modules-在-Nodejs-中的实现&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#CommonJS-Modules-%E5%9C%A8-Nodejs-%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0&quot; aria-label=&quot;CommonJS Modules 在 Nodejs 中的实现 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CommonJS Modules 在 Node.js 中的实现&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;根据CommonJS规范，一个单独的文件就是一个模块。每一个模块都是一个单独的作用域，在该模块内部定义的变量，无法被其他模块读取，除非定义为global对象的属性，或者将属性暴露出来。在 Nodejs就是如此。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;比如：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const circle = require(&amp;#39;./circle.js&amp;#39;); // 使用 require 加载模块 circle
console.log(`The area of a circle of radius 4 is ${circle.area(4)}`);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在 circle.js 中:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const PI = Math.PI;
exports.area = (r) =&amp;gt; PI * r * r;
exports.circumference = (r) =&amp;gt; 2 * PI * r;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;circle.js 模块导出了 area()和 circumffference()两个方法，变量 PI是这个模块的私有变量。如果想为自定义的模块添加属性或者方法，将它们添加到 exports 这个特殊的对象上就可以达到目的。
如果希望模块提供的接口是一个构造函数，或者输出的是一个完整的对象而不是一个属性，那么可以使用 module.exports 代替 exports。但是注意，exports 是 module.exports 的一个引用，只是为了用起来方便，只要没有重写 module.exports对象，那么&lt;code&gt;module.exports.xxx&lt;/code&gt;就等价于&lt;code&gt;exports.xxx&lt;/code&gt;。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const square = require(&amp;#39;./square.js&amp;#39;);
var mySquare = square(2);
console.log(`The area of my square is ${mySquare.area()}`);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;square.js:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports = (width) =&amp;gt; {
  return {
    area: () =&amp;gt; width * width
  };
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;AMD规范&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#AMD%E8%A7%84%E8%8C%83&quot; aria-label=&quot;AMD规范 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;AMD规范&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;AMD是“Asynchronous Module Definition”的缩写。通过异步方式加载模块，模块的加载不影响后续语句的执行，所有依赖加载中的模块的语句，都会放在一个回调函数中，等到该模块加载完成后，这个回调函数才运行。注意，在 AMD 中模块名是全局作用域，可以在全局引用。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;AMD规范的API非常简单：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;define(id?, dependencies?, factory);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;规范定义了一个define函数，它用来定义一个模块。它包含三个参数，前两个参数都是可选的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;id：是一个string字符串，它表示模块的标识。通常用来定义这个模块的名字，一般不用&lt;/li&gt;
&lt;li&gt;dependencies：是一个数组，依赖的模块的标识。也是可选的参数，每个依赖的模块的输出将作为参数一次传入 factory 中。如果没有指定 dependencies，那么它的默认值是 [“require”, “exports”, “module”]。&lt;/li&gt;
&lt;li&gt;factory：一个函数或者对象。如果是函数，在依赖的模块加载成功后，会执行这个回调函数，它的返回值就是模块的输出接口或值。它的参数是所有依赖模块的引用。&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;定义一个名为 myModule 的模块，它依赖 jQuery 模块：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;define(&amp;#39;myModule&amp;#39;, [&amp;#39;jquery&amp;#39;], function($) {
    // $ 是 jquery 模块的输出
    $(&amp;#39;body&amp;#39;).text(&amp;#39;hello world&amp;#39;);
});
// 使用
define([&amp;#39;myModule&amp;#39;], function(myModule) {});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;ES6中的模块系统&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ES6%E4%B8%AD%E7%9A%84%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F&quot; aria-label=&quot;ES6中的模块系统 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ES6中的模块系统&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;ES6 模块系统的目标就是创建一个统一的模块格式，让 CommonJS 和 AMD的使用者都满意：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;和CommonJS类似，但是更加简洁的语法，循环引用的支持更好。&lt;/li&gt;
&lt;li&gt;和AMD类似，直接支持异步加载和可配置的模块加载。&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;模块标准主要有两部分：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;声明语法：import 和 export&lt;/li&gt;
&lt;li&gt;可编程的加载 API：配置模块如何以及有条件地加载模块&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;ES6模块的基础&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ES6%E6%A8%A1%E5%9D%97%E7%9A%84%E5%9F%BA%E7%A1%80&quot; aria-label=&quot;ES6模块的基础 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ES6模块的基础&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;在 ES6的模块系统中，有两种 export：命名的 export 和默认的 export。在一个文件中，命名的 export 可以有多个，而默认的 default export 只能有一个。可以同时使用，但最好还是分开使用。&lt;/p&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;命名的export&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%91%BD%E5%90%8D%E7%9A%84export&quot; aria-label=&quot;命名的export permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;命名的export&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;也可以在声明表达式前面加上 export 关键字可以直接导出将声明的对象导出：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//------ lib.js ------
export const sqrt = Math.sqrt;
export function square(x) {
    return x * x;
}
export function diag(x, y) {
    return sqrt(square(x) + square(y));
}

//------ main.js ------
import { square, diag } from &amp;#39;lib&amp;#39;;
console.log(square(11)); // 121
console.log(diag(4, 3)); // 5&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果要导出一个已经存在的变量，需要加上&lt;code&gt;{}&lt;/code&gt;:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const random = Math.random;
export random;  // SyntaxError: Unexpected token, expected {
export { random };&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;使用 CommonJS 语法实现相同目的：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//------ lib.js ------
var sqrt = Math.sqrt;
function square(x) {
    return x * x;
}
function diag(x, y) {
    return sqrt(square(x) + square(y));
}
module.exports = {
    sqrt: sqrt,
    square: square,
    diag: diag,
};

//------ main.js ------
var square = require(&amp;#39;lib&amp;#39;).square;
var diag = require(&amp;#39;lib&amp;#39;).diag;
console.log(square(11)); // 121
console.log(diag(4, 3)); // 5&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;下面是来自 &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export&quot; class=&quot;link-underline&quot;&gt;MDN&lt;/a&gt; 的更加完整的export 语法：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;export { name1, name2, …, nameN };
export { variable1 as name1, variable2 as name2, …, nameN };
export let name1, name2, …, nameN; // also var
export let name1 = …, name2 = …, …, nameN; // also var, const

export expression;
export default expression;
export default function (…) { … } // also class, function*
export default function name1(…) { … } // also class, function*
export { name1 as default, … };

export * from …;
export { name1, name2, …, nameN } from …;
export { import1 as name1, import2 as name2, …, nameN } from …;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;默认导出&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%BB%98%E8%AE%A4%E5%AF%BC%E5%87%BA&quot; aria-label=&quot;默认导出 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;默认导出&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;每个模块只有一个默认导出的值， default export 可以是一个函数，一个类，一个对象或者其他任意值。有两种形式的 default export:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;被标记的声明。导出一个函数或者类&lt;/li&gt;
&lt;li&gt;直接导出值。导出表达式的运行结果&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;导出一个函数：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//------ myFunc.js ------
export default function () {} // 没有分号 函数名可有可无

//------ main1.js ------
import myFunc from &amp;#39;myFunc&amp;#39;;
myFunc();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;导出一个类：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//------ MyClass.js ------
export default class {} // 没有分号 类名可有可无

//------ main2.js ------
import MyClass from &amp;#39;MyClass&amp;#39;;
const inst = new MyClass();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;导出表达式运行结果：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;export default &amp;#39;abc&amp;#39;;
export default foo();
export default /^xyz$/;
export default 5 * 7;
export default { no: false, yes: true };&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;前面说的到的导出匿名函数和类，可以将其视为导出表达式的运行结果：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;export default (function () {});
export default (class {});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;每一个 default export 都是这种结构：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;export default &amp;lt;&amp;lt;expression&amp;gt;&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;相当于：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const __default__  = &amp;lt;&amp;lt;expression&amp;gt;&amp;gt;;
export { __default__ as default }; // (A)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;export后面是不能接变量声明的，因为一个变量声明表达式中可以一次生命多个变量。考虑下面这种情况：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;export default const foo = 1, bar = 2, baz = 3; // not legal JavaScript!&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;应该导出 foo，bar，还是 baz 呢？&lt;/p&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;必须在模块的最顶层使用import和export&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%BF%85%E9%A1%BB%E5%9C%A8%E6%A8%A1%E5%9D%97%E7%9A%84%E6%9C%80%E9%A1%B6%E5%B1%82%E4%BD%BF%E7%94%A8import%E5%92%8Cexport&quot; aria-label=&quot;必须在模块的最顶层使用import和export permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;必须在模块的最顶层使用import和export&lt;/h5&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;if (Math.random()) {
    import &amp;#39;foo&amp;#39;; // SyntaxError
}

// You can’t even nest `import` and `export`
// inside a simple block:
{
    import &amp;#39;foo&amp;#39;; // SyntaxError
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;import-会被提升到当前作用域的顶部&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#import-%E4%BC%9A%E8%A2%AB%E6%8F%90%E5%8D%87%E5%88%B0%E5%BD%93%E5%89%8D%E4%BD%9C%E7%94%A8%E5%9F%9F%E7%9A%84%E9%A1%B6%E9%83%A8&quot; aria-label=&quot;import 会被提升到当前作用域的顶部 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;import 会被提升到当前作用域的顶部&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;模块的 import 会被提升到当前作用域的顶部。所以下面这种情况是可行的：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;foo();

import { foo } from &amp;#39;my_module&amp;#39;;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;import-的一些细节&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#import-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%BB%86%E8%8A%82&quot; aria-label=&quot;import 的一些细节 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;import 的一些细节&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;import的基本语法：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;import defaultMember from &amp;quot;module-name&amp;quot;;
import * as name from &amp;quot;module-name&amp;quot;;
import { member } from &amp;quot;module-name&amp;quot;;
import { member as alias } from &amp;quot;module-name&amp;quot;;
import { member1 , member2 } from &amp;quot;module-name&amp;quot;;
import { member1 , member2 as alias2 , [...] } from &amp;quot;module-name&amp;quot;;
import defaultMember, { member [ , [...] ] } from &amp;quot;module-name&amp;quot;;
import defaultMember, * as name from &amp;quot;module-name&amp;quot;;
import &amp;quot;module-name&amp;quot;;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;对循环引用的支持&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AF%B9%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E7%9A%84%E6%94%AF%E6%8C%81&quot; aria-label=&quot;对循环引用的支持 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;对循环引用的支持&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;什么是循环引用？模块A 引用了模块 B，模块 B 又引用了模块 A。如果可能的话，应该避免这种情况出现，这会使得模块之间过度的耦合。但是这种有时候又是无法避免的。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;CommonJS-中的循环引用&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#CommonJS-%E4%B8%AD%E7%9A%84%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8&quot; aria-label=&quot;CommonJS 中的循环引用 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CommonJS 中的循环引用&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;a.js 中的内容：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;console.log(&amp;#39;模块 a 开始了！&amp;#39;);
exports.done = false;
var b = require(&amp;#39;./b.js&amp;#39;);
console.log(&amp;#39;在 a 中, b.done = %j&amp;#39;, b.done);
exports.done = true;
console.log(&amp;#39;模块 a 结束了！&amp;#39;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;b.js 中的内容：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;console.log(&amp;#39;模块 b 开始了！&amp;#39;);
exports.done = false;
var a = require(&amp;#39;./a.js&amp;#39;);
console.log(&amp;#39;在 b 中, a.done = %j&amp;#39;, a.done);
exports.done = true;
console.log(&amp;#39;模块 b 结束了！&amp;#39;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;main.js 中的内容：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;console.log(&amp;#39;main 开始了！&amp;#39;);
var a = require(&amp;#39;./a.js&amp;#39;);
var b = require(&amp;#39;./b.js&amp;#39;);
console.log(&amp;#39;在 main 中, a.done=%j, b.done=%j&amp;#39;, a.done, b.done);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当 main.js 加载 a.js 时，a.js 又加载 b.js。这个时候，b.js 又会尝试去加载 a.js 。为了防止出现无限循环的加载，a.js 中的 exports 对象会返回一个 unfinished copy 给 b.js 模块。然后模块 b 完成加载，同时将提供模块 a 的接口。当 main.js 加载完 a，b 两个模块之后，输出如下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;main 开始了！
模块 a 开始了！
模块 b 开始了！
在 b 中, a.done = false
模块 b 结束了！
在 a 中, b.done = true
模块 a 结束了！
在 main 中, a.done=true, b.done=true&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这种方式有其局限性：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;Nodejs风格的单个值的导出无法工作。当a使用 module.exports 导出一个值时，那么 b 模块中引用的变量 a 在声明之后就不会再更新&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;  module.exports = function(){};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;无法直接命名你的引用&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var foo = require(&amp;#39;a&amp;#39;).foo; // foo  is undefined&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;ES6中的循环引用&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ES6%E4%B8%AD%E7%9A%84%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8&quot; aria-label=&quot;ES6中的循环引用 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ES6中的循环引用&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;ES6中，imports 是 exprts 的只读视图，直白一点就是，imports 都指向 exports 原本的数据，比如：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//------ lib.js ------
export let counter = 3;
export function incCounter() {
    counter++;
}

//------ main.js ------
import { counter, incCounter } from &amp;#39;./lib&amp;#39;;

// The imported value `counter` is live
console.log(counter); // 3
incCounter();
console.log(counter); // 4
// The imported value can’t be changed
counter++; // TypeError&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;因此在 ES6中处理循环引用特别简单，看下面这段代码：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//------ a.js ------
import {bar} from &amp;#39;b&amp;#39;; // (i)
export function foo() {
  bar(); // (ii)
}

//------ b.js ------
import {foo} from &amp;#39;a&amp;#39;; // (iii)
export function bar() {
  if (Math.random()) {
    foo(); // (iv)
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;假设先加载模块 a，在模块 a 加载完成之后，bar 间接性地指向的是模块 b 中的 bar。无论是加载命令的 imports 还是未完成的 imports，imports 和 exports 之间都有一个间接的联系，所以总是可以正常工作。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;ES6-模块加载器-API&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ES6-%E6%A8%A1%E5%9D%97%E5%8A%A0%E8%BD%BD%E5%99%A8-API&quot; aria-label=&quot;ES6 模块加载器 API permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ES6 模块加载器 API&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;除了声明式加载模块，ES6还提供了一个可编程的 API：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;以编程的方式使用模块&lt;/li&gt;
&lt;li&gt;配置模块的加载&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;要注意，这个 API 并不是ES6标准中的一部分，在“JavaScript Loader Standrad”中，并且具体的标准还在制定中，所以下面讲到的内容都是试验性的。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;Loaders-的简单使用&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Loaders-%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8&quot; aria-label=&quot;Loaders 的简单使用 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Loaders 的简单使用&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;Loader 用于处理模块标识符和加载模块等。它的 construct 是&lt;code&gt;Reflect.Loader&lt;/code&gt;。每个平台在全局作用域中都有一个全局变量&lt;code&gt;System&lt;/code&gt;的实例来实现 loader 的一些特性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你可以通过 API 提供的 Promise，以编码的方式 import 一个模块：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;System.import(&amp;#39;some_module&amp;#39;)
.then(some_module =&amp;gt; {
    // Use some_module
})
.catch(error =&amp;gt; {
    ···
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;System.import() 可以：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可以在 script 标签中使用模块&lt;/li&gt;
&lt;li&gt;有条件地加载模块&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;System.import() 返回一个模块, 可以用 Promise.all() 来导入多个模块:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Promise.all(
    [&amp;#39;module1&amp;#39;, &amp;#39;module2&amp;#39;, &amp;#39;module3&amp;#39;]
    .map(x =&amp;gt; System.import(x)))
.then(([module1, module2, module3]) =&amp;gt; {
    // Use module1, module2, module3
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;Loader的其他方法&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Loader%E7%9A%84%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95&quot; aria-label=&quot;Loader的其他方法 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Loader的其他方法&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;Loader 还有一些其他方法，最重要的三个是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;System.module(source, [options])
将 source 中的 JavaScript 代码当做一个模块执行，返回一个 Promise&lt;/li&gt;
&lt;li&gt;System.set(name, modules)
注册一个模块，比如用 System.module 创建的模块&lt;/li&gt;
&lt;li&gt;System.define(name, source, [options])
执行 source 中的代码，将返回的结果注册为一个模块&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;目前 Loader API 还处于试验阶段，更多的细节不想在深入。有兴趣的话可以去看看&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;模块导入的细节&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%85%A5%E7%9A%84%E7%BB%86%E8%8A%82&quot; aria-label=&quot;模块导入的细节 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;模块导入的细节&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在 CommonJS 和 ES6中，两种模块导入方式有一些不同：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在 CommonJS 中，导入的内容是模块导出的内容的拷贝。&lt;/li&gt;
&lt;li&gt;在 ES6 中，导出值得实时只读视图，类似于引用。&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;在 CommonJS 中，如果你将一个导入的值保存到一个变量中，这个值会被复制两次：第一次是这个值所属模块导出时（行 A），第二次是这个值被引用时（行 B）。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//------ lib.js ------
var counter = 3;
function incCounter() {
    counter++;
}
module.exports = {
    counter: counter, // (A)
    incCounter: incCounter,
};

//------ main1.js ------
var counter = require(&amp;#39;./lib&amp;#39;).counter; // (B)
var incCounter = require(&amp;#39;./lib&amp;#39;).incCounter;

// The imported value is a (disconnected) copy of a copy
console.log(counter); // 3
incCounter();
console.log(counter); // 3

// The imported value can be changed
counter++;
console.log(counter); // 4&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果通过 exports对象来访问这个值，这个值还是会再复制一次：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//------ main2.js ------
var lib = require(&amp;#39;./lib&amp;#39;);

// The imported value is a (disconnected) copy
console.log(lib.counter); // 3
lib.incCounter();
console.log(lib.counter); // 3

// The imported value can be changed
lib.counter++;
console.log(lib.counter); // 4&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;和 CommonJS 不同的是，在 ES6中，所有的导入的数据都是导出值的视图，每一个导入的数据都和原始的数据有一个实时连接（并不是 JS 中Object引用的那种概念，因为导出的值可以是一个原始类型，primitive type，而且导入的数据是只读的）。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;无条件的引入 (import x from ‘foo’) 就是用 const 声明的变量&lt;/li&gt;
&lt;li&gt;模块的属性foo (import * as foo from ‘foo’) 则是创建一个 frozen object.&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//------ lib.js ------
export let counter = 3;
export function incCounter() {
    counter++;
}

//------ main1.js ------
import { counter, incCounter } from &amp;#39;./lib&amp;#39;;

// The imported value `counter` is live
console.log(counter); // 3
incCounter();
console.log(counter); // 4

// The imported value can’t be changed
counter++; // TypeError&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果使用*引入模块，会得到相同的结果：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//------ main2.js ------
import * as lib from &amp;#39;./lib&amp;#39;;

// 导入的值 counter 是活动的
console.log(lib.counter); // 3
lib.incCounter();
console.log(lib.counter); // 4

// 导入的值是只读的不能被修改
lib.counter++; // TypeError&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;虽然不能修改导入的值，但是可以修改对象指向的内容，这个 const 常量的处理是一致的。例如：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//------ lib.js ------
export let obj = {};

//------ main.js ------
import { obj } from &amp;#39;./lib&amp;#39;;

obj.prop = 123; // OK
obj = {}; // TypeError&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;结束&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F&quot; aria-label=&quot;结束 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;关于更多 ES6 模块相关的内容，有兴趣的朋友可以去下面这些地方看看：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://exploringjs.com/es6/ch_modules.html&quot; class=&quot;link-underline&quot;&gt;http://exploringjs.com/es6/ch_modules.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.ecma-international.org/ecma-262/6.0/#sec-modules&quot; class=&quot;link-underline&quot;&gt;http://www.ecma-international.org/ecma-262/6.0/#sec-modules&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;参考资料：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;http://stackoverflow.com/a/40295288&quot; class=&quot;link-underline&quot;&gt;http://stackoverflow.com/a/40295288&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://exploringjs.com/es6/ch_modules.html&quot; class=&quot;link-underline&quot;&gt;http://exploringjs.com/es6/ch_modules.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://zhaoda.net/webpack-handbook/amd.html&quot; class=&quot;link-underline&quot;&gt;http://zhaoda.net/webpack-handbook/amd.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;[&lt;a href=&quot;https://nodejs.org/api/modules.html%5D)(&quot; class=&quot;link-underline&quot;&gt;https://nodejs.org/api/modules.html])(&lt;/a&gt;&lt;a href=&quot;https://nodejs.org/api/modules.html&quot; class=&quot;link-underline&quot;&gt;https://nodejs.org/api/modules.html&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://speakingjs.com/es5/ch17.html#freezing_objects&quot; class=&quot;link-underline&quot;&gt;http://speakingjs.com/es5/ch17.html#freezing_objects&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[深入理解 ES6 的解构赋值]]></title><description><![CDATA[解构赋值（destructuring assignment）语法是一个Javascript表达式，这种语法能够更方便的提取出 Object 或者 Array 中的数据。这种语法可以在接受提取的数据的地方使用，比如一个表达式的左边。有明确的语法模式来告诉我们如何使用这种语法提取需…]]></description><link>https://zhanglun.github.io/blogs/2017-01-05-深入理解 ES6 的解构赋值/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2017-01-05-深入理解 ES6 的解构赋值/</guid><pubDate>Thu, 05 Jan 2017 20:23:35 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;解构赋值（destructuring assignment）语法是一个Javascript表达式，这种语法能够更方便的提取出 Object 或者 Array 中的数据。这种语法可以在接受提取的数据的地方使用，比如一个表达式的左边。有明确的语法模式来告诉我们如何使用这种语法提取需要的数据值。&lt;/p&gt;
&lt;!--more--&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Object-的解构&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Object-%E7%9A%84%E8%A7%A3%E6%9E%84&quot; aria-label=&quot;Object 的解构 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Object 的解构&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;解构 Object:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const obj = { first: &amp;#39;Jane&amp;#39;, last: &amp;#39;Doe&amp;#39; };
const {first: f, last: l} = obj;
// f = &amp;#39;Jane&amp;#39;; l = &amp;#39;Doe&amp;#39;

// {prop} is short for {prop: prop}
const {first, last} = obj;
// first = &amp;#39;Jane&amp;#39;; last = &amp;#39;Doe&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;解构能帮助更好地处理方法返回的对象：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const obj = { foo: 123 };

const {writable, configurable} = Object.getOwnPropertyDescriptor(obj, &amp;#39;foo&amp;#39;);

console.log(writable, configurable); // true true&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Array-的解构&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Array-%E7%9A%84%E8%A7%A3%E6%9E%84&quot; aria-label=&quot;Array 的解构 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Array 的解构&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;解构数组，对所有可遍历的值有效。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let foo = [&amp;quot;one&amp;quot;, &amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;];

let [one, two, three] = foo;
console.log(one); // &amp;quot;one&amp;quot;
console.log(two); // &amp;quot;two&amp;quot;
console.log(three); // &amp;quot;three&amp;quot;

const iterable = [&amp;#39;a&amp;#39;, &amp;#39;b&amp;#39;];
const [x, y] = iterable;
// x = &amp;#39;a&amp;#39;; y = &amp;#39;b&amp;#39;

[x, y] = iterable;

// window.x = &amp;#39;a&amp;#39;; window.y = &amp;#39;b&amp;#39;;
&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;同样的，解构数组也能帮助我们更好地处理函数返回值:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const [all, year, month, day] =
    /^(\d\d\d\d)-(\d\d)-(\d\d)$/
    .exec(&amp;#39;2999-12-31&amp;#39;);
&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;而且，你也可以忽略你不感兴趣的返回值：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function f() {
  return [1, 2, 3];
}

let [a, , b] = f();
console.log(a); // 1
console.log(b); // 3&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;你也可以忽略全部返回值，不过似乎没啥用：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;[,,] = f();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当解构一个数组时，可以使用剩余模式（&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Spread_operator&quot; class=&quot;link-underline&quot;&gt;拓展语句，Spread operator&lt;/a&gt;），将数组剩余部分赋值给一个变量。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let [a, ...b] = [1, 2, 3];
console.log(a); // 1
console.log(b); // [2, 3]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;在什么地方可以使用解构&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9C%A8%E4%BB%80%E4%B9%88%E5%9C%B0%E6%96%B9%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E8%A7%A3%E6%9E%84&quot; aria-label=&quot;在什么地方可以使用解构 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;在什么地方可以使用解构&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;解构可以在下面这些情景中使用，只展现了数组模式的演示，对象模式也是如此。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// 变量声明:
const [x] = [&amp;#39;a&amp;#39;];
let [x] = [&amp;#39;a&amp;#39;];
var [x] = [&amp;#39;a&amp;#39;];

// 赋值: 下面这种情况将会在全局变量上添加一个 x 属性，值为‘a‘
[x] = [&amp;#39;a&amp;#39;]; 

// 参数的定义:
function userId({id}) {
  return id;
}

function whois({displayName: displayName, fullName: {firstName: name}}){
  console.log(displayName + &amp;quot; is &amp;quot; + name);
}

var user = { 
  id: 42, 
  displayName: &amp;quot;jdoe&amp;quot;,
  fullName: { 
      firstName: &amp;quot;John&amp;quot;,
      lastName: &amp;quot;Doe&amp;quot;
  }
};

console.log(&amp;quot;userId: &amp;quot; + userId(user)); // &amp;quot;userId: 42&amp;quot;
whois(user); // &amp;quot;jdoe is John&amp;quot;

function f([x]) { ··· }
f([&amp;#39;a&amp;#39;]);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;也可以在 for-of 循环中使用：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const arr = [&amp;#39;a&amp;#39;, &amp;#39;b&amp;#39;];
for (const [index, element] of arr.entries()) {
    console.log(index, element);
}
// Output:
// 0 a
// 1 b&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;解构赋值的模型-patterns&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC%E7%9A%84%E6%A8%A1%E5%9E%8B-patterns&quot; aria-label=&quot;解构赋值的模型 patterns permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;解构赋值的模型 patterns&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在解构中，有下面两部分参与：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Destructuring source:&lt;/strong&gt; 解构的源，将要被解构的数据，比如解构赋值表达式的右边部分。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Destructuring target:&lt;/strong&gt; 解构的目标，比如解构复制表达式的左边部分。&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;解构的目标可以是下面三个的任意一个：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;赋值对象，Assigment Patterns。例如 x
&lt;ul&gt;
&lt;li&gt;赋值对象通常来说是一个变量。但是在解构赋值中，你有更多的选择，稍后会讲到。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;对象模型，Object Patterns。比如：&lt;code&gt;{ first: «pattern», last: «pattern» }&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;数组模型，Object Patterns。比如：&lt;code&gt;[ «pattern», «pattern» ]&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;可以任意嵌套模型，而且是可以非常任性的嵌套。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const obj = { a: [{ foo: 123, bar: &amp;#39;abc&amp;#39; }, {}], b: true };
const { a: [{foo: f}] } = obj; // f = 123&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;解构的-patterns-如何访问到值的内部结构&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%A7%A3%E6%9E%84%E7%9A%84-patterns-%E5%A6%82%E4%BD%95%E8%AE%BF%E9%97%AE%E5%88%B0%E5%80%BC%E7%9A%84%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84&quot; aria-label=&quot;解构的 patterns 如何访问到值的内部结构 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;解构的 patterns 如何访问到值的内部结构？&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在一个表达式&lt;code&gt;pattern = someValue&lt;/code&gt;中，&lt;code&gt;pattern&lt;/code&gt;是如何访问&lt;code&gt;someValue&lt;/code&gt;的呢？&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Object-patterns-将-value-转换成-Object&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Object-patterns-%E5%B0%86-value-%E8%BD%AC%E6%8D%A2%E6%88%90-Object&quot; aria-label=&quot;Object patterns 将 value 转换成 Object permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Object patterns 将 value 转换成 Object&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在访问属性之前，object pattern 将解构的源数据（destructuing source）转换成对象。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const {length : len} = &amp;#39;abc&amp;#39;; // len = 3
const {toString: s} = 123; // s = Number.prototype.toString&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;使用对象解构的缺点&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8%E5%AF%B9%E8%B1%A1%E8%A7%A3%E6%9E%84%E7%9A%84%E7%BC%BA%E7%82%B9&quot; aria-label=&quot;使用对象解构的缺点 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用“对象解构”的缺点&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;在这个过程中，强制转换成对象的过程不是通过&lt;code&gt;Object()&lt;/code&gt;方法，而是通过内置的操作方法&lt;a href=&quot;http://www.ecma-international.org/ecma-262/6.0/#sec-toobject&quot; class=&quot;link-underline&quot;&gt;toObject()&lt;/a&gt;。这两个操作处理&lt;code&gt;undefined&lt;/code&gt;和&lt;code&gt;null&lt;/code&gt;的方式不太一样。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Object()方法将原始类型值转换成包装类型对象（wrapper object），原来的值原封不动。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;gt; typeof Object(&amp;#39;abc&amp;#39;)
&amp;#39;object&amp;#39;

&amp;gt; var obj = {};
&amp;gt; Object(obj) === obj
true&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;也会将&lt;code&gt;undefined&lt;/code&gt; 和 &lt;code&gt;null&lt;/code&gt; 转换成一个空的对象。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;gt; Object(undefined)
{}
&amp;gt; Object(null)
{}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;对比之下，当遇到&lt;code&gt;undefined&lt;/code&gt;和&lt;code&gt;null&lt;/code&gt;的时候，toObject()方法则会抛出一个错误。所以下面的解构是失败的：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const { prop: x } = undefined; // TypeError
const { prop: y } = null; // TypeError&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;因此，你可以使用空对象模型{}来检查一个值是否被强制转换成了一个对象。正如前面提到的规则，&lt;code&gt;undefined&lt;/code&gt;和&lt;code&gt;null&lt;/code&gt;将会抛出错误&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;({} = [true, false]); // OK, Arrays are coercible to objects
({} = &amp;#39;abc&amp;#39;); // OK, strings are coercible to objects

({} = undefined); // TypeError
({} = null); // TypeError&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;表达式两边的括号是必须的，因为在 JavaScript 中，声明不能以花括号开始。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;在可遍历的量中使用数组模型&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9C%A8%E5%8F%AF%E9%81%8D%E5%8E%86%E7%9A%84%E9%87%8F%E4%B8%AD%E4%BD%BF%E7%94%A8%E6%95%B0%E7%BB%84%E6%A8%A1%E5%9E%8B&quot; aria-label=&quot;在可遍历的量中使用数组模型 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;在可遍历的量中使用数组模型&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;数组解构使用一个迭代器来获取数据源中的元素。因此，你可以对任何可以遍历的值使用数组解构。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;字符串是可遍历的：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const [x, ...y] = &amp;#39;abc&amp;#39;; // x=&amp;#39;a&amp;#39;; y=[&amp;#39;b&amp;#39;, &amp;#39;c&amp;#39;]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;我们无法通过索引访问 Set中的元素，但是可以通过迭代器。所以，数组解构能够在 Sets上工作：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const [x,y] = new Set([&amp;#39;a&amp;#39;, &amp;#39;b&amp;#39;]); // x=&amp;#39;a&amp;#39;; y=&amp;#39;b’;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;Set&lt;/code&gt;的迭代器总是按照元素插入的顺序将元素返回，所以上述的解构返回的结果总是相同的。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;使用数组解构的缺点&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8%E6%95%B0%E7%BB%84%E8%A7%A3%E6%9E%84%E7%9A%84%E7%BC%BA%E7%82%B9&quot; aria-label=&quot;使用数组解构的缺点 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用“数组解构”的缺点&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;如果一个值有一个 key 为&lt;code&gt;Symbol.iterator&lt;/code&gt;的方法，这个方法返回的是一个对象，那么这个值是可以遍历的。如果被解构的值不能遍历的，那么“数组解构”会抛出一个&lt;code&gt;TypeError&lt;/code&gt;错误。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let x;
[x] = [true, false]; // OK, Arrays are iterable
[x] = &amp;#39;abc&amp;#39;; // OK, strings are iterable
[x] = { * [Symbol.iterator]() { yield 1 } }; // OK, iterable

[x] = {}; // TypeError, empty objects are not iterable
[x] = undefined; // TypeError, not iterable
[x] = null; // TypeError, not iterable&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;可以用一个空的数组模型[]来检查值是不是可遍历的:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;[] = {}; // TypeError, empty objects are not iterable
[] = undefined; // TypeError, not iterable
[] = null; // TypeError, not iterable&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;默认值&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%BB%98%E8%AE%A4%E5%80%BC&quot; aria-label=&quot;默认值 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;默认值&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;默认值是可选的，在数据源中找不到对应的值时，如果设置了默认值，则匹配这个默认值作为匹配结果，否则返回 undefined。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const [x=3, y] = []; // x = 3; y = undefined。
const {foo: x=3, bar: y} = {}; // x = 3; y = undefined&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;undefined-也会触发默认值&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#undefined-%E4%B9%9F%E4%BC%9A%E8%A7%A6%E5%8F%91%E9%BB%98%E8%AE%A4%E5%80%BC&quot; aria-label=&quot;undefined 也会触发默认值 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;undefined 也会触发默认值&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;当解构模式有匹配结果，且匹配结果是 undefined 时，也会使用默认值作为返回结果：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const [x=1] = [undefined]; // x = 1
const {prop: y=2} = {prop: undefined}; // y = 2&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;默认值是根据需要计算出来的&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%BB%98%E8%AE%A4%E5%80%BC%E6%98%AF%E6%A0%B9%E6%8D%AE%E9%9C%80%E8%A6%81%E8%AE%A1%E7%AE%97%E5%87%BA%E6%9D%A5%E7%9A%84&quot; aria-label=&quot;默认值是根据需要计算出来的 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;默认值是根据需要计算出来的&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;也就是说下面的解构：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const {prop: y=someFunc()} = someValue;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;相当于：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let y;
if (someValue.prop === undefined) {
    y = someFunc();
} else {
    y = someValue.prop;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;使用&lt;code&gt;console.log()&lt;/code&gt;可以观察到：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;gt; function log(x) { console.log(x); return &amp;#39;YES&amp;#39; }
&amp;gt; const [a=log(&amp;#39;hello&amp;#39;)] = [];
&amp;gt; a
&amp;#39;YES&amp;#39;
&amp;gt; const [b=log(&amp;#39;hello&amp;#39;)] = [123];
&amp;gt; b
123&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在第二个解构中，默认值没有触发，并且&lt;code&gt;log()&lt;/code&gt;没有被调用。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;默认值可以引用模式中的其他变量&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%BB%98%E8%AE%A4%E5%80%BC%E5%8F%AF%E4%BB%A5%E5%BC%95%E7%94%A8%E6%A8%A1%E5%BC%8F%E4%B8%AD%E7%9A%84%E5%85%B6%E4%BB%96%E5%8F%98%E9%87%8F&quot; aria-label=&quot;默认值可以引用模式中的其他变量 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;默认值可以引用模式中的其他变量&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;默认值可以引用模式中的任何变量，包括相同模式中的其他变量：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const [x=3, y=x] = [];     // x=3; y=3
const [x=3, y=x] = [7];    // x=7; y=7
const [x=3, y=x] = [7, 2]; // x=7; y=2&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;但是，变量的顺序很关键，从左到右，先声明的变量不能引用后声明的变量，也就是左边的不能引用右边的。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const [x=y, y=3] = []; // ReferenceError&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;patterns-的默认值&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#patterns-%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC&quot; aria-label=&quot;patterns 的默认值 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;patterns 的默认值&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;到目前为止，我们所看到的都是模式中变量的默认值，我们也可以为模式设置默认值。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const [{prop: x} = {}] = [];&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果整个模式没有匹配结果，则使用&lt;code&gt;{}&lt;/code&gt;作为数据源来匹配。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const { prop: x } = {}; // x = undefined&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;上面的例子中，x 为 undefined 可能还是不够直观。看下面这个例子：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const [{prop: x} = {props: &amp;#39;abc&amp;#39;}] = []; // x=abc&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;对象解构的更多特性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AF%B9%E8%B1%A1%E8%A7%A3%E6%9E%84%E7%9A%84%E6%9B%B4%E5%A4%9A%E7%89%B9%E6%80%A7&quot; aria-label=&quot;对象解构的更多特性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;对象解构的更多特性&lt;/h3&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;属性属性值的简写&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B1%9E%E6%80%A7%E5%B1%9E%E6%80%A7%E5%80%BC%E7%9A%84%E7%AE%80%E5%86%99&quot; aria-label=&quot;属性属性值的简写 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;属性，属性值的简写&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;如果属性值是一个变量，和属性的 key相同，就可以忽略这个 key:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const { x, y } = { x: 11, y: 8 }; // x = 11; y = 8

// 等价于
const { x: x, y: y } = { x: 11, y: 8 };&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;计算后的属性的键&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%AE%A1%E7%AE%97%E5%90%8E%E7%9A%84%E5%B1%9E%E6%80%A7%E7%9A%84%E9%94%AE&quot; aria-label=&quot;计算后的属性的键 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;计算后的属性的键&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;如果把表达式放入方括号中，可以用这个表达式声明属性的键：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const FOO = &amp;#39;foo&amp;#39;;
const { [FOO]: f} = {fooL 123}; // f = 123&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这也使得可以使用 symbols 来做属性的键：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// Create and destructure a property whose key is a symbol
const KEY = Symbol();
const obj = { [KEY]: &amp;#39;abc&amp;#39; };
const { [KEY]: x } = obj; // x = &amp;#39;abc&amp;#39;

// Extract Array.prototype[Symbol.iterator]
const { [Symbol.iterator]: func } = [];
console.log(typeof func); // function&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;数组解构的更多特性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%95%B0%E7%BB%84%E8%A7%A3%E6%9E%84%E7%9A%84%E6%9B%B4%E5%A4%9A%E7%89%B9%E6%80%A7&quot; aria-label=&quot;数组解构的更多特性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;数组解构的更多特性&lt;/h3&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;省略&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%9C%81%E7%95%A5&quot; aria-label=&quot;省略 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;省略&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;在解构的过程中可以跳过一些元素：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const [,,x,y] = [1,2,3,4]; // x= 3 y = 4;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;剩余运算符-Rest-operator-&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%89%A9%E4%BD%99%E8%BF%90%E7%AE%97%E7%AC%A6-Rest-operator-&quot; aria-label=&quot;剩余运算符 Rest operator  permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;剩余运算符 Rest operator (…)&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;剩余运算符可以将一个可遍历对象中剩余的元素提取到一个数组中。如果这个运算符在数组模式中使用，运算符必须放在最后：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const [x, ...y] = [1,2,3,4]; // x=1; y=[2,3,4];&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;要注意的时，拓展运算符（spread operator）与剩余操作符有着相同的语法-三个点。但是它们之间有区别：前者将数组变成多个元素；后者则用来解构和提取数据，多个元素压缩成一个元素。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果运算符找不到任何元素，将会匹配一个空的数组，永远不会返回undefined 或者 null。例如：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const [x, y, ...z] = [&amp;#39;a&amp;#39;]; // x=&amp;#39;a&amp;#39;; y=undefined; z&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;操作符不一定非要是一个变量，也可以使用模式：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const [x, ...[y, z]] = [&amp;#39;a&amp;#39;, &amp;#39;b&amp;#39;, &amp;#39;c&amp;#39;]; // x = &amp;#39;a&amp;#39;; y = &amp;#39;b&amp;#39;; z = &amp;#39;c&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;解构的陷阱&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%A7%A3%E6%9E%84%E7%9A%84%E9%99%B7%E9%98%B1&quot; aria-label=&quot;解构的陷阱 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;解构的陷阱&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在使用解构的时候，有两点要考虑清楚：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;不能使用大括号作为声明语句的开头；&lt;/li&gt;
&lt;li&gt;在解构的过程中，可以申明变量或者分配给变量，但是不能同时这么做；&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;解构的几个例子&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%A7%A3%E6%9E%84%E7%9A%84%E5%87%A0%E4%B8%AA%E4%BE%8B%E5%AD%90&quot; aria-label=&quot;解构的几个例子 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;解构的几个例子&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在 for-of 中使用解构：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const map = new Map().set(false, &amp;#39;no&amp;#39;).set(true, &amp;#39;yes&amp;#39;);
for (const [key, value] of map) {
  console.log(key + &amp;#39; is &amp;#39; + value);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;使用解构交换两个变量的值：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;[a, b] = [b, a];&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;或者：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;[a, b, c] = [c, a, b];&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;还可以分割数据：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const [first, ...rest] = [&amp;#39;a&amp;#39;, &amp;#39;b&amp;#39;, &amp;#39;c&amp;#39;]; // first = &amp;#39;a&amp;#39;; rest = [&amp;#39;b&amp;#39;, &amp;#39;c&amp;#39;]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;处理方法返回的数组更加方便：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const [all, year, month, day] = /^(\d\d\d\d)-(\d\d)-(\d\d)$/.exec(&amp;#39;2999-12-31&amp;#39;);

const cells = &amp;#39;Jane\tDoe\tCTO&amp;#39;
const [firstName, lastName, title] = cells.split(&amp;#39;\t&amp;#39;);
console.log(firstName, lastName, title);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;要注意的一点是：exec等一些方法可能会返回 null，导致程序抛出错误&lt;code&gt;TypeError&lt;/code&gt;，此时需要添加一个默认值：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const [, year, month, day] = /^(\d\d\d\d)-(\d\d)-(\d\d)$/.exec(someStr) || [];&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;参考资料：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;http://exploringjs.com/es6/ch_destructuring.html&quot; class=&quot;link-underline&quot;&gt;Exploringjs Destructuring&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment&quot; class=&quot;link-underline&quot;&gt;MDN Destructing assignment&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[使用Firebase构建云端应用-数据库的管理]]></title><description><![CDATA[上回讲到Firebase 的创建项目和用户管理。今天来说说 Firebase 的数据库的使用。 Firebase Realtime Database 是一种云托管数据库。数据库将数据存储为 JSON，并以实时方式与每个连接的客户端同步。 当使用JavaScript SDK 构建…]]></description><link>https://zhanglun.github.io/blogs/2016-12-24-使用Firebase构建云端应用-数据库的管理/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2016-12-24-使用Firebase构建云端应用-数据库的管理/</guid><pubDate>Sat, 24 Dec 2016 17:32:43 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;上回讲到Firebase 的&lt;a href=&quot;&quot; class=&quot;link-underline&quot;&gt;创建项目和用户管理&lt;/a&gt;。今天来说说 Firebase 的数据库的使用。&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;Firebase Realtime Database 是一种云托管数据库。数据库将数据存储为 JSON，并以实时方式与每个连接的客户端同步。 当使用JavaScript SDK 构建跨平台应用时，所有客户端都会分享同一个 Realtime Database 实例，并自动接收更新的最新数据。数据实时跨所有客户端同步，当应用处于离线状态时仍可使用该数据。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Firebase Realtime Database 以 JSON 格式存储数据，在 Web 端使用 WebSocket 进行数据的传输，每当数据变化时，任何连接的设备都会以毫秒速度收到更新的数据。同时Firebase Realtime Database SDK 将您的数据保留在磁盘上。 一旦重新建立连接，客户端会立即接收没有接收的任何变化，同步当前服务器状态。而最关键的一点则是：Firebase Realtime Database 可以直接从移动设备或网络浏览器访问，需要应用服务器。 安全和数据验证均通过 Firebase Realtime Database安全规则进行。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;配置-Firebase-Database-Rules&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%85%8D%E7%BD%AE-Firebase-Database-Rules&quot; aria-label=&quot;配置 Firebase Database Rules permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;配置 Firebase Database Rules&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;Realtime Database 提供了声明性规则语言，可用于定义应该如何组织数据、如何将数据编入索引以及何时可以读取和写入数据。默认情况下，只有通过身份验证的用户才能拥有数据库的读写权限。可以在&lt;a href=&quot;https://firebase.google.com/docs/database/security/quickstart?hl=zh-cn&quot; class=&quot;link-underline&quot;&gt;配置规则说明&lt;/a&gt;中修改。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;初始化数据库&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93&quot; aria-label=&quot;初始化数据库 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;初始化数据库&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在应用创建完成之后，在“Database”选项卡中找到应用对应的实时数据库网址，一般都是&lt;code&gt;https://&amp;#x3C;db-id&gt;.firebaseio.com&lt;/code&gt;的形式。
然后替换config中的databaseURL&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;  // Set the configuration for your app
  // TODO: Replace with your project&amp;#39;s config object
  let config = {
    apiKey: &amp;#39;&amp;lt;your-api-key&amp;gt;&amp;#39;,
    authDomain: &amp;#39;&amp;lt;your-auth-domain&amp;gt;&amp;#39;,
    databaseURL: &amp;#39;&amp;lt;your-database-url&amp;gt;&amp;#39;,
    storageBucket: &amp;#39;&amp;lt;your-storage-bucket&amp;gt;&amp;#39;
  };
  firebase.initializeApp(config);

  // Get a reference to the database service
  let database = firebase.database();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;接下来就可以使用&lt;code&gt;database&lt;/code&gt;来操作数据库了。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;设计数据结构&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%AE%BE%E8%AE%A1%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84&quot; aria-label=&quot;设计数据结构 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;设计数据结构&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在操作数据库之前，需要先了解 Firebase 实时数据库的数据体系结构的主要概念。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;如何组织数据&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E7%BB%84%E7%BB%87%E6%95%B0%E6%8D%AE&quot; aria-label=&quot;如何组织数据 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何组织数据&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;构建一个结构合理的数据库需要思考的点很多。最重要的是，要对数据的保存和检索做好计划，尽可能简化这些过程。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;所有 Firebase Realtime Database 数据都被存储为 JSON 对象。您可将该数据库视为云托管 JSON 树。 该数据库与 SQL 数据库不同，没有任何表格或记录。 当您将数据添加至 JSON 树时，它变为现有 JSON 结构中的一个节点。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;例如，聊天应用允许用户存储基本个人资料和联系人列表。 通常用户个人资料位于一个诸如 /users/$uid 之类的路径中。 用户 alovelace 的数据库项看起来可能如下所示：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;{
  &amp;quot;users&amp;quot;: {
    &amp;quot;alovelace&amp;quot;: {
      &amp;quot;name&amp;quot;: &amp;quot;Ada Lovelace&amp;quot;,
      &amp;quot;contacts&amp;quot;: { &amp;quot;ghopper&amp;quot;: true },
    },
    &amp;quot;ghopper&amp;quot;: { ... },
    &amp;quot;eclarke&amp;quot;: { ... }
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;避免数据嵌套&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%81%BF%E5%85%8D%E6%95%B0%E6%8D%AE%E5%B5%8C%E5%A5%97&quot; aria-label=&quot;避免数据嵌套 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;避免数据嵌套&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;JSON类型的数据结构可以多层嵌套，同时也不需要考虑数据类型。但是需要避免过多的嵌套。在获取数据库中某个位置的数据时，数据库也会检索该位置的所有子节点。另外在授权方面，在授予用户正在数据库中某个节点的读写访问权时，也会将该节点下所有数据的访问权授予该用户。前者会导致很多不必要的数据检索和传输，后者则有可能导致安全问题。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;假设一个如下所示的多层嵌套结构：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;{
  // This is a poorly nested data architecture, because iterating the children
  // of the &amp;quot;chats&amp;quot; node to get a list of conversation titles requires
  // potentially downloading hundreds of megabytes of messages
  &amp;quot;chats&amp;quot;: {
    &amp;quot;one&amp;quot;: {
      &amp;quot;title&amp;quot;: &amp;quot;Historical Tech Pioneers&amp;quot;,
      &amp;quot;messages&amp;quot;: {
        &amp;quot;m1&amp;quot;: { &amp;quot;sender&amp;quot;: &amp;quot;ghopper&amp;quot;, &amp;quot;message&amp;quot;: &amp;quot;Relay malfunction found. Cause: moth.&amp;quot; },
        &amp;quot;m2&amp;quot;: { ... },
        // a very long list of messages
      }
    },
    &amp;quot;two&amp;quot;: { ... }
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;若采用这种嵌套设计，循环访问数据就会出现问题。例如，要列出聊天对话标题，就需要将整个 chats 树（包括所有成员和消息）都下载到客户端。
Firebase 推荐平展数据结构，被拆分到不同路径，按需下载。上面给出的多层嵌套平展思路如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;需要列出聊天的对话标题；&lt;/li&gt;
&lt;li&gt;进入聊天室需要列出聊天室成员；&lt;/li&gt;
&lt;li&gt;进入聊天室需要列出消息记录；&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;那么应该这么做：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Chats 节点只需要包含聊天室的基本信息，如：标题，创建时间等。&lt;/li&gt;
&lt;li&gt;Messages 节点的数据根据 Chats节点分成不同子节点，类似这种形式： ‘messages/:chatid/:messageid’。&lt;/li&gt;
&lt;li&gt;Members 节点的数据根据 Chats节点分成不同子节点，类似这种形式： ‘members/:chatid/:memberid’。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;参考如下代码：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;{
  // Chats contains only meta info about each conversation
  // stored under the chats&amp;#39;s unique ID
  &amp;quot;chats&amp;quot;: {
    &amp;quot;one&amp;quot;: {
      &amp;quot;title&amp;quot;: &amp;quot;Historical Tech Pioneers&amp;quot;,
      &amp;quot;lastMessage&amp;quot;: &amp;quot;ghopper: Relay malfunction found. Cause: moth.&amp;quot;,
      &amp;quot;timestamp&amp;quot;: 1459361875666
    },
    &amp;quot;two&amp;quot;: { ... },
    &amp;quot;three&amp;quot;: { ... }
  },

  // Conversation members are easily accessible
  // and stored by chat conversation ID
  &amp;quot;members&amp;quot;: {
    // we&amp;#39;ll talk about indices like this below
    &amp;quot;one&amp;quot;: {
      &amp;quot;ghopper&amp;quot;: true,
      &amp;quot;alovelace&amp;quot;: true,
      &amp;quot;eclarke&amp;quot;: true
    },
    &amp;quot;two&amp;quot;: { ... },
    &amp;quot;three&amp;quot;: { ... }
  },

  // Messages are separate from data we may want to iterate quickly
  // but still easily paginated and queried, and organized by chat
  // converation ID
  &amp;quot;messages&amp;quot;: {
    &amp;quot;one&amp;quot;: {
      &amp;quot;m1&amp;quot;: {
        &amp;quot;name&amp;quot;: &amp;quot;eclarke&amp;quot;,
        &amp;quot;message&amp;quot;: &amp;quot;The relay seems to be malfunctioning.&amp;quot;,
        &amp;quot;timestamp&amp;quot;: 1459361875337
      },
      &amp;quot;m2&amp;quot;: { ... },
      &amp;quot;m3&amp;quot;: { ... }
    },
    &amp;quot;two&amp;quot;: { ... },
    &amp;quot;three&amp;quot;: { ... }
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;现在每个对话只需下载几个字节即可循环访问房间列表，快速在 UI 中列出或显示房间。在消息到达时，可单独提取和显示，确保 UI 的及时响应和速度。似乎一切都很好，但是还是存在问题：假设用户与群组之间存在双向关系。 用户可属于一个群组，且群组包含一个用户列表。 当需要决定用户属于哪些群组时，情况就会比较复杂。文档中给出了一个称之为“索引”的方式：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// An index to track Ada&amp;#39;s memberships
{
  &amp;quot;users&amp;quot;: {
    &amp;quot;alovelace&amp;quot;: {
      &amp;quot;name&amp;quot;: &amp;quot;Ada Lovelace&amp;quot;,
      // Index Ada&amp;#39;s groups in her profile
      &amp;quot;groups&amp;quot;: {
         // the value here doesn&amp;#39;t matter, just that the key exists
         &amp;quot;techpioneers&amp;quot;: true,
         &amp;quot;womentechmakers&amp;quot;: true
      }
    },
    ...
  },
  &amp;quot;groups&amp;quot;: {
    &amp;quot;techpioneers&amp;quot;: {
      &amp;quot;name&amp;quot;: &amp;quot;Historical Tech Pioneers&amp;quot;,
      &amp;quot;members&amp;quot;: {
        &amp;quot;alovelace&amp;quot;: true,
        &amp;quot;ghopper&amp;quot;: true,
        &amp;quot;eclarke&amp;quot;: true
      }
    },
    ...
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;通过存储 Ada 记录及该群组下的关系来重复某些数据的。 现在，alovelace 在一个群组下进行索引，而 techpioneers 则列在 Ada 的个人资料中。 所以要从该群组删除 Ada，则必须在两个地方更新。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;存在双向关系的两个元组，将对方的元素作为”索引“来使用，这样可以快速、高效地提取 Ada 的成员身份，将 ID 列为密钥并将值设为 true 来颠倒数据，使密钥检查变得像读取 /users/$uid/groups/$group_id 和检查是否 null 一样简单。与查询或扫描数据相比，索引的速度更快，效率更高。
虽然数据有点冗余。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;数据的保存操作&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%95%B0%E6%8D%AE%E7%9A%84%E4%BF%9D%E5%AD%98%E6%93%8D%E4%BD%9C&quot; aria-label=&quot;数据的保存操作 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;数据的保存操作&lt;/h3&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;基本写入操作&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9F%BA%E6%9C%AC%E5%86%99%E5%85%A5%E6%93%8D%E4%BD%9C&quot; aria-label=&quot;基本写入操作 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;基本写入操作&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;使用 set() 将数据保存至特定引用，替换该路径的任何现有数据，注意是&lt;strong&gt;替换&lt;/strong&gt;。 例如，社交博客应用可以使用 set() 添加用户，如下所示：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;function writeUserData(userId, name, email, imageUrl) {
firebase.database().ref(‘users/’ + userId).set({
username: name,
email: email,
profile_picture : imageUrl
});
}&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;使用 set() 覆盖位于指定位置的数据，包括所有子节点。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;追加到数据列表&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%BF%BD%E5%8A%A0%E5%88%B0%E6%95%B0%E6%8D%AE%E5%88%97%E8%A1%A8&quot; aria-label=&quot;追加到数据列表 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;追加到数据列表&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;使用 push() 方法可将数据追加到节点的列表。每次调用push方法时，push 方法均会生成唯一 ID。通过使用自动生成的键，多个客户端可以同时向同一位置添加子节点，而不存在写入冲突。push() 生成的唯一 ID 基于时间戳，因此列表项目会自动按时间顺序排列。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你可以 push() 方法返回的引用的键作为子节点来设置数据。 push() 引用的 .key 属性包含自动生成的键的值。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;更新特定字段&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9B%B4%E6%96%B0%E7%89%B9%E5%AE%9A%E5%AD%97%E6%AE%B5&quot; aria-label=&quot;更新特定字段 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;更新特定字段&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;使用 update() 方法，同时向一个节点的特定子节点写入数据，而不覆盖其他子节点。
调用 update() 时，可以通过为键指定路径来更新较低级别的子值。 如果将数据存储在多个位置中以便更好地进行缩放，则可使用数据扇出更新这些数据的所有实例。例如，社交博客应用可使用如下所示的代码，创建一篇博文，同时将其更新至最新的 Activity 源和发布用户的 Activity 源：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function writeNewPost(uid, username, picture, title, body) {
  // A post entry.
  var postData = {
    author: username,
    uid: uid,
    body: body,
    title: title,
    starCount: 0,
    authorPic: picture
  };

  // Get a key for a new Post.
  var newPostKey = firebase.database().ref().child(&amp;#39;posts&amp;#39;).push().key;

  // Write the new post&amp;#39;s data simultaneously in the posts list and the user&amp;#39;s post list.
  var updates = {};
  updates[&amp;#39;/posts/&amp;#39; + newPostKey] = postData;
  updates[&amp;#39;/user-posts/&amp;#39; + uid + &amp;#39;/&amp;#39; + newPostKey] = postData;

  return firebase.database().ref().update(updates);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在这个例子中，使用 push() 在节点（其中包含 /posts/$postid 内所有用户博文）中创建一篇博文，同时检索相应键。 然后，可以使用该键在用户博文（位于 /user-posts/$userid/$postid 内）中创建第二个条目。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;通过使用这些路径，只需调用 update() 一次即可同步更新 JSON 树中的多个位置。通过这种方式同步更新具有原子性：要么所有更新全部成功，要么全部失败。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;删除数据&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE&quot; aria-label=&quot;删除数据 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;删除数据&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;删除数据最简单的方法是在引用上对这些数据所处的位置调用 remove()。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;此外，还可以通过将 null 指定为另一个写入操作（例如，set() 或 update()）的值来删除数据。 可以结合使用此方法与 update()，在单一 API 调用中删除多个子节点。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;接收-Promise&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%8E%A5%E6%94%B6-Promise&quot; aria-label=&quot;接收 Promise permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;接收 Promise&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;要知道将数据提交到 Firebase Realtime Database 服务器的时间，您可以使用 Promise。set() 和 update() 均能够返回 Promise，可以使用它了解将写入的数据提交到数据库的时间。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;数据的检索&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%95%B0%E6%8D%AE%E7%9A%84%E6%A3%80%E7%B4%A2&quot; aria-label=&quot;数据的检索 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;数据的检索&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;检索数据的基础知识以及如何对 Firebase 数据进行排序和过滤。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;添加事件监听器&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%B7%BB%E5%8A%A0%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8&quot; aria-label=&quot;添加事件监听器 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;添加事件监听器&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;firabase的数据检索不需要主动发出请求，只需要监听事件即可。调用firebase.database.Reference 提供的on()将监听器绑定在对应的数据节点上，收到不同事件时做出对应的处理即可。可以监听的事件如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;value	读取和监听对路径的全部内容所做的更改。&lt;/li&gt;
&lt;li&gt;child_added	检索项目列表，或监听项目列表中是否添加了新项目。 建议与 child_changed 和 child_removed 配合使用，从而监控对列表所做的更改。&lt;/li&gt;
&lt;li&gt;child_changed	监听对列表中的项目所做的更改。与 child_added 和 child_removed 结合使用，从而监控对列表所做的更改。&lt;/li&gt;
&lt;li&gt;child_removed	监听正从列表中删除的项目。与 child_added 和 child_changed 结合使用， 从而监控对列表所做的更改。&lt;/li&gt;
&lt;li&gt;child_moved	与经过排序的数据配合使用，从而监听对项目优先级所做的更改。&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;value-事件&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#value-%E4%BA%8B%E4%BB%B6&quot; aria-label=&quot;value 事件 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;value 事件&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;使用 value 事件来读取事件发生时某个给定路径下存在的内容的静态快照。此方法将在绑定监听器时触发一次，并在数据（包括子节点）发生任何更改时再次触发。系统将为事件回调传递一个包含该位置中所有数据（包括子节点数据）的快照。如果没有任何数据，则返回的快照为 null。
每当指定的数据库引用中的数据发生更改（包括对子数据进行更改）时，系统就会调用 value 事件，为了限制快照的大小，应该尽可能在最低级别的节点上绑定侦听器。例如，建议不要在数据库的根目录附加侦听器。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;下面的示例演示了一个社交博客应用如何从数据库中检索某篇博文的星级数：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var starCountRef = firebase.database().ref(&amp;#39;posts/&amp;#39; + postId + &amp;#39;/starCount&amp;#39;);
starCountRef.on(&amp;#39;value&amp;#39;, function(snapshot) {
  updateStarCount(postElement, snapshot.val());
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;回调函数的参数是一个 snapshot，其中包含事件发生时数据库中指定位置的数据。 通过&lt;code&gt;snapshot.val()&lt;/code&gt; 获取该 snapshot 中的数据。&lt;/p&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;Child-事件&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Child-%E4%BA%8B%E4%BB%B6&quot; aria-label=&quot;Child 事件 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Child 事件&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;当某个节点的子节点发生更改时，就会触发子事件，例如通过 push() 方法添加新的子节点，或通过 update() 方法更新子节点。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;child_added 事件通常用于在 Firebase 数据库中检索项目列表。child_added 事件将针对每个现有的子节点触发一次，并在每次向指定的路径添加新的子节点时再次触发。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;每次修改子节点或者子节点的后代时，均会触发 child_changed 事件。通常与 child_added 和 child_removed 事件一起使用。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;删除直接子节点时，会触发 child_removed 事件。该事件通常与 child_added 和 child_changed 事件一起使用。传递给事件侦听器的快照中包含被移除的子节点的数据。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;每当因更新（导致子节点重新排序）而触发 child_changed 事件时，系统就会触发 child_moved 事件。该事件用于通过 orderByChild、orderByValue 或 orderByPriority 中的任何一种进行排序的数据。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;同时使用所有这些事件对于侦听数据库中某个特定节点的更改将会非常有用。 例如，社交博客应用可以结合使用这些方法来监控博文评论中的活动，如下所示：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var commentsRef = firebase.database().ref(&amp;#39;post-comments/&amp;#39; + postId);
commentsRef.on(&amp;#39;child_added&amp;#39;, function(data) {
  addCommentElement(postElement, data.key, data.val().text, data.val().author);
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;取消事件监听器&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%96%E6%B6%88%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8&quot; aria-label=&quot;取消事件监听器 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;取消事件监听器&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;调用 Firebase 数据库引用的 off() 方法即可删除回调。可以将单个监听器作为参数传递给 off()，移除单个该侦听器。如果在不带任何参数的情况下在该节点位置调用 off()，则将移除该节点位置的所有侦听器。
在父监听器上上调用 off() 时不会自动删除在其子节点上注册的侦听器；还必须在任何子侦听器上调用 off() 才能删除回调。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;commentsRef.on(&amp;#39;child_changed&amp;#39;, function(data) {
  setCommentValues(postElement, data.key, data.val().text, data.val().author);
});

commentsRef.on(&amp;#39;child_removed&amp;#39;, function(data) {
  deleteComment(postElement, data.key);
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;绑定一次&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%91%E5%AE%9A%E4%B8%80%E6%AC%A1&quot; aria-label=&quot;绑定一次 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;绑定一次&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;在某些情况下，你可能希望获得数据的快照，但不需要监听其变化，可以使用 once() 方法来简化这一场景：它只会触发一次，以后就再也不会触发。对于只需加载一次且预计不会频繁变化或需要主动监听的数据，这非常有用。 例如，上述示例中的博客应用使用此方法在用户开始撰写新博文时加载其个人资料：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var userId = firebase.auth().currentUser.uid;
return firebase.database().ref(&amp;#39;/users/&amp;#39; + userId).once(&amp;#39;value&amp;#39;).then(function(snapshot) {
  var username = snapshot.val().username;
  // ...
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;结束语&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F%E8%AF%AD&quot; aria-label=&quot;结束语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束语&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;上述简单的阐明了Firebase 实时数据库的基本使用。所有的点都围绕在数据节点上展开。确定了节点路径之后，通过节点路径获取对应节点的引用，在引用上进行一系列的操作，说明白之后其实很简单。可能稍微复杂一点点的就是数据结构扁平化的处理。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;结合上回讲到的Firebase 项目的创建和用户管理，现在已经可以很轻松的构建出一个简单的应用逻辑了。下回：Firebase中的Storage，敬请期待&lt;/p&gt;</content:encoded></item><item><title><![CDATA[使用Firebase构建云端应用:创建项目和用户管理]]></title><description><![CDATA[在构建自己的在线云工具应用时，我使用 Firebase 为自己的“无后端项目”提供服务，把在开发期间接触到的一些内容整理在一起，制成系列笔记。这个过程有两个好处：巩固知识点，整理开发过程的思路。因为前端开发是自己所熟悉的领域，所以先从 Firebase 入手，将后端的一些知识点…]]></description><link>https://zhanglun.github.io/blogs/2016-12-14-使用Firebase构建云端应用-创建项目和用户管理/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2016-12-14-使用Firebase构建云端应用-创建项目和用户管理/</guid><pubDate>Wed, 14 Dec 2016 21:06:12 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;在构建自己的在线云工具应用时，我使用 Firebase 为自己的“无后端项目”提供服务，把在开发期间接触到的一些内容整理在一起，制成系列笔记。这个过程有两个好处：巩固知识点，整理开发过程的思路。因为前端开发是自己所熟悉的领域，所以先从 Firebase 入手，将后端的一些知识点提前梳理理顺，避免后续的学习过程中的卡壳而导致无法坚持。今天第一期：创建项目和用户管理。&lt;/p&gt;
&lt;!--more--&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;什么是-Firebase&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%80%E4%B9%88%E6%98%AF-Firebase&quot; aria-label=&quot;什么是 Firebase permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;什么是 Firebase&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;Firebase 原本是一家实时后端数据库创业公司，为提供一个实时响应的数据服务。后被 Google 收购，该平台适用在IOS、Android、web前端等各种跨平台上，对于没有数据库处理经验的开发者，只需使用自己熟悉的语言将数据放在Firebase上，再通过Firebase提供的API即可实现实时数据同步。同时 Google 在新版的 Firebase 中包含开发、成长与营收三阶段，并整合分析工具，不过分析工具目前只针对移动 App，网页的话可以继续使用 Google Analytics。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;何谓“实时数据库”？简单粗暴的理解就是，数据库中数据的变动会互动通知到客户端。同一账号在客户端 A出操作，客户端 B 会收到相应的通知。根据我在浏览器中的调试，发现在 Web 端 原来是用的 WebSocket。考虑到写数据时遇到的无网络连接问题，Firebase的数据库API使用了本地缓存，使得在离线状态下也能保持读写不失败，并且会在网络恢复连接时和服务器进行同步。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Firebase 提供了四种 SDK: Android，IOS, Web 和 C++。我将使用 Web 端 SDK 开发一个无后端的笔记应用。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;关联应用&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%85%B3%E8%81%94%E5%BA%94%E7%94%A8&quot; aria-label=&quot;关联应用 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;关联应用&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在使用 Firebase 作为后端数据库之前，需要登录 &lt;a href=&quot;https://console.firebase.google.com/&quot; class=&quot;link-underline&quot;&gt;Firebase 的控制台&lt;/a&gt;，添加一个 Firebase 的网络应用。你可选择新建一个应用，或者导入一个现有的 Google 项目。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;创建完应用之后，进入应用的控制面板，在 ‘&lt;a href=&quot;https://console.firebase.google.com/project/your-app-id/overview%E2%80%99&quot; class=&quot;link-underline&quot;&gt;https://console.firebase.google.com/project/your-app-id/overview’&lt;/a&gt; 中可以看到硕大的绑定入口“将 Firebase 添加到您的网页应用”，点击之后，将给处的 JavaScript 添加到 HTML 文件中。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt; &amp;lt;script src=&amp;quot;https://www.gstatic.com/firebasejs/3.4.0/firebase.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
  &amp;lt;script&amp;gt;
    // Initialize Firebase
    let config = {
      apiKey: &amp;#39;&amp;lt;your-api-key&amp;gt;&amp;#39;,
      authDomain: &amp;#39;&amp;lt;your-auth-domain&amp;gt;&amp;#39;,
      databaseURL: &amp;#39;&amp;lt;your-database-url&amp;gt;&amp;#39;,
      storageBucket: &amp;#39;&amp;lt;your-storage-bucket&amp;gt;&amp;#39;
    };
    firebase.initializeApp(config);
  &amp;lt;/script&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当然也可通过 npm 安装 Firebase 的 SDK &lt;a href=&quot;https://www.npmjs.com/package/firebase&quot; class=&quot;link-underline&quot;&gt;npm link&lt;/a&gt;，然后通过 Webpack 等工具打包。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;npm install --save firebase&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;引入 Firebase&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let firebase = require(&amp;#39;firebase&amp;#39;);
let app = firebase.initializeApp({ ... });&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;完整的 Firebase 客户端包包含了Firebase 的 Authentication, Realtime Database, Storage 和 Cloud Messaging。上面的代码将会把这些功能全部引入。可以将这些功能以独立组件的形式引入，减少代码量。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;firebase-app 核心代码（必需）&lt;/li&gt;
&lt;li&gt;firebase-auth Authentication（可选）&lt;/li&gt;
&lt;li&gt;firebase-database Realtime Database（可选）&lt;/li&gt;
&lt;li&gt;firebase-storage Storage（可选）&lt;/li&gt;
&lt;li&gt;firebase-messaging Cloud Messagin（可选）&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;在这个案例中 Cloud Messaging 针对的是移动端，所以不引入。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let firebase = require(&amp;#39;firebase/app&amp;#39;);
require(&amp;#39;firebase/auth&amp;#39;);
require(&amp;#39;firebase/database&amp;#39;);
 
let app = firebase.initializeApp({ ... });
// ...&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;完成上述步骤之后，你已经可以在环境中使用 firebase 提供的各种接口了。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;用户&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%94%A8%E6%88%B7&quot; aria-label=&quot;用户 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;用户&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;大多数应用都需要了解用户的身份。知道用户的身份可以让应用将用户数据安全地保存在云中并跨所有用户设备提供相同的个性化体验。
Firebase Authentication 提供后端服务、易用 SDK 和现成 UI 库来向应用验证用户的身份。它支持使用密码、深受欢迎的联合用户身份提供商（如 Google、Facebook 和 Twitter）等方法进行身份验证。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;本次案例使用第三方登录，不使用 Firebase 提供的 UI库，有兴趣的朋友可以自己去试试 &lt;a href=&quot;https://github.com/firebase/FirebaseUI-Web&quot; class=&quot;link-underline&quot;&gt;https://github.com/firebase/FirebaseUI-Web&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在添加了 Firebase应用之后，打开console的 Authentication，在登录方法中开启需要的登录提供商。这里我选择了“电子邮件地址/密码”和“Github“两种方式。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;创建基于密码的帐户&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA%E5%9F%BA%E4%BA%8E%E5%AF%86%E7%A0%81%E7%9A%84%E5%B8%90%E6%88%B7&quot; aria-label=&quot;创建基于密码的帐户 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建基于密码的帐户&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;在用户填写表单注册时，完成所需的任何新帐户验证步骤，例如验证新帐号密码键入正确，或者检查账号是否已经存在。然后
将邮件地址和密码传递到 createUserWithEmailAndPassword 方法中来创建新帐户：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;firebase.auth().signInWithEmailAndPassword(email, password).catch((error) =&amp;gt; {
  // Handle Errors here.
  let errorCode = error.code;
  let errorMessage = error.message;
  // ...
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;用户首次登录后，便会建立一个新用户帐户并链接至该用户登录时使用的凭据，即用户名和密码，或身份验证提供程序信息。此新帐户存储在 Firebase 项目中，可用于跨项目中的每个应用识别用户，无论该用户如何登录。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;使用-Github-账号登录&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8-Github-%E8%B4%A6%E5%8F%B7%E7%99%BB%E5%BD%95&quot; aria-label=&quot;使用 Github 账号登录 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用 Github 账号登录&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;在console 中的登录方式中启用 github 登录之后，需要添加从 GitHub 获得的 OAuth 2.0 客户端 ID 和客户端密钥。同时将你的 Github 应用的授权回调地址设置为 Firebase OAuth 重定向 URI（例如 my-app-12345.firebaseapp.com/__/auth/handler）。&lt;a href=&quot;https://github.com/settings/developers&quot; class=&quot;link-underline&quot;&gt;Github 的应用配置&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;上述前期工作准备就绪之后，可以开始使用 Firebase SDK 来使用登录流程。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;先创建一个 GitHub 提供程序对象的实例：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let provider = new firebase.auth.GithubAuthProvider();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;然后是一个可选的步骤：从身份验证提供程序中指定您想请求的其他 OAuth 2.0 范围。调用 Provider 实例的 addScope方法来添加范围。例如：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;provider.addScope(&amp;#39;repo&amp;#39;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;详细参数可以参考&lt;a href=&quot;https://developer.github.com/v3/oauth/#scopes&quot; class=&quot;link-underline&quot;&gt;身份验证提供程序文档&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;接下来，使用 GitHub 提供程序对象进行 Firebase 身份验证。可以提示用户，让其通过打开弹出式窗口或重定向登录页面的方法以自己的 GitHub account 登录。移动设备最好使用重定向方法。要用弹出式窗口的方法登录，调用 signInWithPopup：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;firebase.auth().signInWithPopup(provider).then(function(result) {
  // This gives you a GitHub Access Token. You can use it to access the GitHub API.
  let token = result.credential.accessToken;
  // The signed-in user info.
  let user = result.user;
  // ...
}).catch(function(error) {
  // Handle Errors here.
  let errorCode = error.code;
  let errorMessage = error.message;
  // The email of the user&amp;#39;s account used.
  let email = error.email;
  // The firebase.auth.AuthCredential type that was used.
  let credential = error.credential;
  // ...
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;你可以检索 GitHub 提供程序的 OAuth 令牌，使用该令牌可通过 GitHub API 提取额外数据。
还可以通过这种方法捕获并处理错误。&lt;a href=&quot;https://firebase.google.com/docs/reference/js/firebase.auth.Auth?hl=zh-cn#signInWithPopup&quot; class=&quot;link-underline&quot;&gt;获取错误代码列表&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果要用重定向登录页面的方法登录，则调用 signInWithRedirect：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;firebase.auth().signInWithRedirect(provider);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;不仅如此，你还可以在页面加载时通过调用 getRedirectResult 检索 GitHub 提供程序的 OAuth 令牌：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;firebase.auth().getRedirectResult().then(function(result) {
  if (result.credential) {
    // This gives you a GitHub Access Token. You can use it to access the GitHub API.
    let token = result.credential.accessToken;
    // ...
  }
  // The signed-in user info.
  let user = result.user;
}).catch(function(error) {
  // Handle Errors here.
  let errorCode = error.code;
  let errorMessage = error.message;
  // The email of the user&amp;#39;s account used.
  let email = error.email;
  // The firebase.auth.AuthCredential type that was used.
  let credential = error.credential;
  // ...
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当然，你也可以手动处理登录流程。 在 GitHub 登录流程结束后，你会收到一个 OAuth 2.0 访问令牌。在用户使用 GitHub 成功登录之后，先使用 OAuth 2.0 访问令牌换取 Firebase 凭据：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let credential = firebase.auth.GithubAuthProvider.credential(token);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;然后使用 Firebase 凭据进行 Firebase 身份验证：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;firebase.auth().signInWithCredential(credential).catch(function(error) {
  // Handle Errors here.
  let errorCode = error.code;
  let errorMessage = error.message;
  // The email of the user&amp;#39;s account used.
  let email = error.email;
  // The firebase.auth.AuthCredential type that was used.
  let credential = error.credential;
  // ...
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;除了前面提到的邮箱密码验证，第三方 OAuth 验证之外，Firebase 还支持自定义身份认证系统和匿名身份验证，这里不讲，有兴趣和需求的朋友可以自己去了解。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;其他用户管理操作的支持&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%85%B6%E4%BB%96%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E6%93%8D%E4%BD%9C%E7%9A%84%E6%94%AF%E6%8C%81&quot; aria-label=&quot;其他用户管理操作的支持 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;其他用户管理操作的支持&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;要注销用户，调用 signOut：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;firebase.auth().signOut().then(() =&amp;gt; {
  // Sign-out successful.
}, function(error) {
  // An error happened.
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;除此之外，SDK 还提供了一系列用户管理的方法。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;获取当前登录的用户&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;获取当前用户的推荐方法是在 Auth 对象上调用&lt;code&gt;onAuthStateChanged&lt;/code&gt;方法，这可确保在您获取当前用户时，Auth 对象不会处于中间状态，例如初始化。既要么未登录，要么已登录。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;firebase.auth().onAuthStateChanged((user) =&amp;gt; {
  if (user) {
    // User is signed in.
  } else {
    // No user is signed in.
  }
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;也可以使用 currentUser 属性获取当前已登录的用户。 如果用户没有登录，currentUser 则为 null：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let user = firebase.auth().currentUser;

if (user) {
  // User is signed in.
} else {
  // No user is signed in.
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;不过有一点要注意，currentUser 还可能由于 auth 对象尚未完成初始化而为 null。 如果使用观察程序跟踪用户登录状态，则无需处理该情况。
当获取到用户对象的实例之后，可以访问实例上的一些属性，以及调用实例上的一些方法对用户进行一些操作，比如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;要获取用户的个人资料信息：&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let user = firebase.auth().currentUser;
let name, email, photoUrl, uid;

if (user != null) {
  name = user.displayName;
  email = user.email;
  photoUrl = user.photoURL;
  uid = user.uid;  // The user&amp;#39;s ID, unique to the Firebase project. Do NOT use
                   // this value to authenticate with your backend server, if
                   // you have one. Use User.getToken() instead.
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;获取用户的特定于提供程序的个人资料信息(登录提供程序中获取检索到的个人资料信息)&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let user = firebase.auth().currentUser;

if (user != null) {
  user.providerData.forEach(function (profile) {
    console.log(&amp;quot;Sign-in provider: &amp;quot;+profile.providerId);
    console.log(&amp;quot;  Provider-specific UID: &amp;quot;+profile.uid);
    console.log(&amp;quot;  Name: &amp;quot;+profile.displayName);
    console.log(&amp;quot;  Email: &amp;quot;+profile.email);
    console.log(&amp;quot;  Photo URL: &amp;quot;+profile.photoURL);
  });
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;更新用户个人资料(显示名称和头像地址)&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let user = firebase.auth().currentUser;

user.updateProfile({
  displayName: &amp;quot;Jane Q. User&amp;quot;,
  photoURL: &amp;quot;https://example.com/jane-q-user/profile.jpg&amp;quot;
}).then(function() {
  // Update successful.
}, function(error) {
  // An error happened.
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;设置电子邮件地址&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let user = firebase.auth().currentUser;

user.updateEmail(&amp;quot;user@example.com&amp;quot;).then(function() {
  // Update successful.
}, function(error) {
  // An error happened.
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;要设置用户的电子邮件地址，该用户必须最近登录过&lt;/strong&gt;。在 Firebase 控制台的”Authentication”的”Email Templates”页面中允许自定义使用的电子邮件模板。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;设置用户密码&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let user = firebase.auth().currentUser;
let newPassword = getASecureRandomPassword();

user.updatePassword(newPassword).then(function() {
  // Update successful.
}, function(error) {
  // An error happened.
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;删除用户&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;也可以在控制台中手动删除用户&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let user = firebase.auth().currentUser;

user.delete().then(function() {
  // User deleted.
}, function(error) {
  // An error happened.
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;有些安全敏感性操作，比如删除帐户、设置主电子邮件地址和更改密码，需要用户最近登录过才能执行。如果要执行这些操作中的某一项，而用户只是在很久以前登录过，操作便出错。发生这种错误时，需要从用户获取新登录凭据，将该凭据传给 reauthenticate ，对该用户重新进行身份验证。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let user = firebase.auth().currentUser;
let credential;

// Prompt the user to re-provide their sign-in credentials

user.reauthenticate(credential).then(function() {
  // User re-authenticated.
}, function(error) {
  // An error happened.
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;结束&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E6%9D%9F&quot; aria-label=&quot;结束 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结束&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;如此一来，我的应用已经可以支持邮箱密码登录，github 账号登录。而且用户的管理操作也有很直接明了的方法。当用户添加之后，接下来就可以围绕用户设计出需要的数据结构了。下回：数据结构的定义及数据的操作，敬请期待&lt;/p&gt;</content:encoded></item><item><title><![CDATA[【译】CSS Grid, Flexbox 和 Box Alignment:网页布局的新系统]]></title><description><![CDATA[原文标题：CSS Grid, Flexbox And Box Alignment: Our New System For Web Layout 原文链接：https://www.smashingmagazine.com/2016/11/css-grids-flexbox-and…]]></description><link>https://zhanglun.github.io/blogs/2016-11-11-译-CSS-Grid-Flexbox-和-Box-Alignment-网页布局的新系统/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2016-11-11-译-CSS-Grid-Flexbox-和-Box-Alignment-网页布局的新系统/</guid><pubDate>Fri, 11 Nov 2016 22:50:35 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;原文标题：CSS Grid, Flexbox And Box Alignment: Our New System For Web Layout&lt;br&gt;
原文链接：&lt;a href=&quot;https://www.smashingmagazine.com/2016/11/css-grids-flexbox-and-box-alignment-our-new-system-for-web-layout/&quot; class=&quot;link-underline&quot;&gt;https://www.smashingmagazine.com/2016/11/css-grids-flexbox-and-box-alignment-our-new-system-for-web-layout/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;Layout on the web is hard. The reason it is so hard is that the layout methods we’ve relied on ever since using CSS for layout became possible were not really designed for complex layout. While we were able to achieve quite a lot in a fixed-width world with hacks such as faux columns, these methods fell apart with responsive design. Thankfully, we have hope, in the form of flexbox — which many readers will already be using — CSS grid layout and the box alignment module.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;**在网页上布局是很费劲的。**布局如此艰难的原因是因为，自从使用 CSS 进行布局成为可能之后，我们所依赖的那些布局方法并不是真正为复杂布局而设计的。尽管我们能够通过一些 hack 来实现很多固定宽度的世界，比如仿制的栏。但是这些方法在响应式的设计中要崩溃了。谢天谢地，我们还是有希望的。，CSS Grid, Flexbox 和 Box Alignment就是我们的希望。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;In this article, I’m going to explain how these fit together, and you’ll discover that by understanding flexbox you are very close to understanding much of grid layout.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在这篇文章中，我将要阐明如何将这些组合在一起，同时你将会发现，理解了 flexbox 之后，更加明白网格布局。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;A-Note-On-Browser-Support-浏览器支持的一个注记&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#A-Note-On-Browser-Support-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%94%AF%E6%8C%81%E7%9A%84%E4%B8%80%E4%B8%AA%E6%B3%A8%E8%AE%B0&quot; aria-label=&quot;A Note On Browser Support 浏览器支持的一个注记 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A Note On Browser Support 浏览器支持的一个注记&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;CSS grid layout is currently behind a flag or available in the developer and nightly builds of Firefox, Safari, Chrome and Opera. Everything you see here can be seen to be working if you use a developer or nightly browser or enable the flag in a mainstream browser that has flagged support. I am trying to keep an up-to-date list of support for grid layouts.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;CSS 网格布局目前在 Firefox 的开发者版本和 nightly 版，Safari，Chrome 和 Opera中支持，或者在一个标志之后（。。。。）。如果使用的是你开发者版本或者 nightly版的浏览器或者激活了支持标记的主流浏览器（比如Chrome），你在这所看到的一切都能生效。 我尽量保持一个最新的&lt;a href=&quot;http://gridbyexample.com/browsers/&quot; class=&quot;link-underline&quot;&gt; list of support for grid layouts&lt;/a&gt;。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;New-Values-For-Display--Display-的新值&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#New-Values-For-Display--Display-%E7%9A%84%E6%96%B0%E5%80%BC&quot; aria-label=&quot;New Values For Display  Display 的新值 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;New Values For Display  Display 的新值&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;Both grid and flexbox are new values for the display property. To make an element a flex container, we use display: flex; to make it a grid container, we use display: grid.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;grid 和 flexbox 都是 display 属性的新值。我们可以使用&lt;code&gt;display: flex&lt;/code&gt; 将一个元素变成 flex 容器；可以使用&lt;code&gt;display: grid&lt;/code&gt;将一个元素变成 grid 容器。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;As soon as we do so, the immediate children of our flex or grid container become flex or grid items. Those immediate children take on the initial values of flex or grid items.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;一旦我们这么做之后， flex 或者 grid 容器当前的子元素变成 flex 或者 grid 项。这些子元素拥有 flex 或者 grid 项的初始值。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;DISPLAY-FLEX-LINK&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#DISPLAY-FLEX-LINK&quot; aria-label=&quot;DISPLAY FLEX LINK permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;DISPLAY: FLEX LINK&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;In the first example, we have three elements in a wrapper element set to display: flex. That’s all we need to do to start using flexbox.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在第一个例子中，在一个设置了&lt;code&gt;dispaly: flex&lt;/code&gt;的包装元素中有三个子元素。这就是我们开始使用 flexbox 所需要做的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Unless we add the following properties with different values, the initial values for the flex container are:&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果我们不添加下面这些不同值的属性，flex 容器的初始值是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;flex-direction: row&lt;/li&gt;
&lt;li&gt;flex-wrap: no-wrap&lt;/li&gt;
&lt;li&gt;align-items: stretch&lt;/li&gt;
&lt;li&gt;justify-content: flex-start&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;The initial values for our flex items are:&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;flex 项的初始值是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;flex-grow: 0&lt;/li&gt;
&lt;li&gt;flex-shrink: 1&lt;/li&gt;
&lt;li&gt;flex-basis: auto&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;We’ll look at how these properties and values work later in this article. For now, all you need to do is set display: flex on a parent, and flexbox will begin to work.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;稍后在文章我们将看看这些属性值是如何工作的。目前，你所要做的是在父元素上设置&lt;code&gt;display: flex&lt;/code&gt;，flexbox 将会开始生效。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;ZOpOqB&quot; data-default-tab=&quot;css,result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Flexbox Defaults&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/ZOpOqB/&quot;&gt;Flexbox Defaults&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;DISPLAY-GRID-LINK&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#DISPLAY-GRID-LINK&quot; aria-label=&quot;DISPLAY GRID LINK permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;DISPLAY: GRID LINK&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;To lay out items on a grid, we use display: grid. In order that we can see the grid’s behavior, this example has five cards to lay out.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了在网格中布置项，我们使用&lt;code&gt;display: grid&lt;/code&gt;。这个例子有五个卡片来布局，以便我们能够看到网格的行为。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Adding display: grid won’t make a dramatic change; however, our child items are all now grid items. They have fallen into a single-column track grid, displaying one below the other, the grid creating implicit row tracks to hold each item.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;添加&lt;code&gt;display: flex&lt;/code&gt;不会制造一个戏剧性的变化；然而，所有的子元素现在都是 grid 项。它们都在一个单列的通道网格中，一个接一个的往下排列，网格创建了一个隐式的行轨道保持它们。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;QEKGNm&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Grid Defaults&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/QEKGNm/&quot;&gt;Grid Defaults&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;Once again, we have some default behavior in evidence. We haven’t positioned any of these grid items, but they are placing themselves onto our grid, one per cell of the grid. The initial values of the grid container are:&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;再一次，很明显地看到，（布局）有一些默认的行为。我们没有摆放任何 grid 项，但它们都把自己放到我们的网格之中，每一个 grid 项占据一个网格单元。grid 容器的初始值是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;grid-auto-flow: row&lt;/li&gt;
&lt;li&gt;grid-auto-rows: auto&lt;/li&gt;
&lt;li&gt;align-items: stretch&lt;/li&gt;
&lt;li&gt;justify-items: stretch&lt;/li&gt;
&lt;li&gt;grid-gap: 0&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;These initial values mean that our grid items are placed one into each cell of the grid, working across the rows. Because we have a three-column track grid, after filling the grid cell of the third column, a new row is created for the rest of the items. This row is auto-sized, so will expand to fit the content. Items stretch in both directions, horizontal and vertical, filling the grid area.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这些初始值表示的意思是：在每一行中，每一个 grid 项都被放在网格中的一个单元格中。因为我们有一个三栏的通道网格，所以在第三栏填满之后，剩下的 grid 项会创建新的一行。这个新行是大小是自适应的，所以将会拓展以适应内容。网格中的元素在水平和垂直两个方向上伸展填充网格区域。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Box-Alignment&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Box-Alignment&quot; aria-label=&quot;Box Alignment permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Box Alignment&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;In both of these simple examples, we are already seeing values defined in the box alignment module in use. “Box Alignment Module Level 3” essentially takes all of the alignment and space distribution defined in flexbox and makes it available to other modules. So, if you already use flexbox, then you are already using box alignment.
Let’s look at how box alignment works in flexbox and grid, and the problems that it helps us solve.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在这些简单的例子中，我们已经使用了一些在 box alignment 模块中定义的值。“Box Alignment Module Level 3”基本上拥有所有 flexbox 中定义的的对齐和空白分配能力，并且让它能够在其他模块中使用。所以，如果你已经使用了 flexbox，那么你已经在使用 box alignment。让我们来看看 box alignment 是如何在 flexbox 和 grid 中工作的，和一些 box alignment 可以帮我们解决的难题。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;EQUAL-HEIGHT-COLUMNS-等高列&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#EQUAL-HEIGHT-COLUMNS-%E7%AD%89%E9%AB%98%E5%88%97&quot; aria-label=&quot;EQUAL HEIGHT COLUMNS 等高列 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;EQUAL-HEIGHT COLUMNS 等高列&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;Something that was very easy to create with old-school table-based layouts, yet fiendishly difficult using positioning and floats, is equal-height columns. In the floated example below, our cards contain unequal amounts of content. We have no way of indicating to the other cards that they should visually take on the same height as the first card — they have no relationship to each other.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;有一种布局使用老式的表单布局来创建是非常简单的，但是使用定位和浮动确实极其困难，这就是等高列布局。在下面的浮动例子中，我们的卡片包含不相同的内容。我们无法告知其他的卡片在视觉上和第一个卡片保持高度一致——他们彼此之间没有关联。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;YWGrPy&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Floated Columns&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/YWGrPy/&quot;&gt;Floated Columns&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;As soon as we set the display property to grid or flex on a parent, we give the children a relationship to each other. That relationship enables the box-alignment properties to work, making equal-height columns simple.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;一旦我们为父元素设置display属性为 &lt;code&gt;grid&lt;/code&gt; 或者 &lt;code&gt;flex&lt;/code&gt;，便给子元素彼此之间赋予了关联性。这种关联性使得box-alignment 属性能够生效，让登高栏的实现变得简单。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;In the flex example below, our items have unequal amounts of content. While the background on each lines up, it doesn’t sit behind the content as it would for floated elements. Because these items are displayed in a row, the property that controls this behavior is align-items. Creating equal-height columns requires that the value be stretch — the initial value for this property.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在下面的 flex 例子中，flex 子项有不同数量的内容。当每一项都加上背景色时，背景色不像在浮动元素中一样在内容区域的后面。因为这些项都是在一行中显示。控制这个行为的属性是&lt;code&gt;align-items&lt;/code&gt;。创建等高列需要将&lt;code&gt;align-items&lt;/code&gt;的值设置成&lt;code&gt;stretch&lt;/code&gt;——它的初始值。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;ZOpXEM&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Flexbox Equal Height Columns&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/ZOpXEM/&quot;&gt;Flexbox Equal Height Columns&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;We see the same with grid layouts. Below is the simplest of grid layouts, two columns with a sidebar and main content. I’m using those fraction units again; the sidebar has 1 fraction of the available space, and the main content 3 fractions. The background color on the sidebar runs to the bottom of the content. Once again, the default value of &lt;code&gt;align-items&lt;/code&gt; is &lt;code&gt;stretch&lt;/code&gt;.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在网格布局中我们可以看到相同的效果。下面是最简单的网格布局例子，两列，一列侧边栏，一列主要内容。我再次使用这些分数单位；侧边栏是可用空间中的1份，主体内容是可用空间中的3份。侧边栏的背景色跑到了内容的底部（对齐在底部）。再说一次，&lt;code&gt;align-items&lt;/code&gt;的默认值是&lt;code&gt;stretch&lt;/code&gt;。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;GqjMJj&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Grid Equal Height Columns&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/GqjMJj/&quot;&gt;Grid Equal Height Columns&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;ALIGNMENT-IN-FLEXBOX-Flexbox-中的对齐&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ALIGNMENT-IN-FLEXBOX-Flexbox-%E4%B8%AD%E7%9A%84%E5%AF%B9%E9%BD%90&quot; aria-label=&quot;ALIGNMENT IN FLEXBOX Flexbox 中的对齐 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ALIGNMENT IN FLEXBOX Flexbox 中的对齐&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;We’ve seen how the default value of &lt;code&gt;align-items&lt;/code&gt; for both &lt;code&gt;grid&lt;/code&gt; and &lt;code&gt;flexbox&lt;/code&gt; is &lt;code&gt;stretch&lt;/code&gt;.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们已经看到了 &lt;code&gt;align-items&lt;/code&gt;在 flex 和 grid 中的默认值都是&lt;code&gt;stretch&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;For flexbox, when we use &lt;code&gt;align-items&lt;/code&gt;, we are aligning them inside the flex container, on the cross axis. The main axis is the one defined by the &lt;code&gt;flex-direction&lt;/code&gt; property. In this first example, the main axis is the row; we are then stretching the items on the cross axis to the height of the flex container. The height of the flex container is, in this case, determined by the item with the most content.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;对于 flexbox，当我们使用&lt;code&gt;align-itmes&lt;/code&gt;时，我们是将它们在 flex 容器中的十字轴上对齐。主轴由 &lt;code&gt;flex-direction&lt;/code&gt;属性定义。在这个例子中，主轴是 row；然后我们十字轴上的项目延伸到容器的高度。在这种情况下，flex 容器的高度由 flex 项的最大高度决定。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 10.106382978723403%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdklEQVQI12MwBgETQ0MDG88kM78KI89CC79SC99SXZf81v4FZ8+cPHjw0GEwOHjw4JkzZ/r6+nR1dU1MTIyNjRlAWk1MDA307f0yXWM7dN1K9DzKDbwqlO0Ku6auun/31oWLFy+DwcWLF+/evTtjxgwdHR2IZgAGAjYuvvkcvAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/01-flex-row-opt.png&quot;
        title=&quot;./images/01-flex-row-opt.png&quot;
        src=&quot;/static/cb7958c5e86ed672d9d3eeabdf0f17a3/1d69c/01-flex-row-opt.png&quot;
        srcset=&quot;/static/cb7958c5e86ed672d9d3eeabdf0f17a3/4dcb9/01-flex-row-opt.png 188w,
/static/cb7958c5e86ed672d9d3eeabdf0f17a3/5ff7e/01-flex-row-opt.png 375w,
/static/cb7958c5e86ed672d9d3eeabdf0f17a3/1d69c/01-flex-row-opt.png 750w,
/static/cb7958c5e86ed672d9d3eeabdf0f17a3/78797/01-flex-row-opt.png 1125w,
/static/cb7958c5e86ed672d9d3eeabdf0f17a3/c1b63/01-flex-row-opt.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;I could give the wrapper a height, and in this case the height of the flex container would be defined by that height.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我可以给包装器添加一个高度，在这种情况下，这个高度将定义flex 容器的高度。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 22.872340425531917%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8klEQVQY02MwNjYxNjIwtXK28CnUdc6y9Cmw9Cm08ivSc84qb5x86OC+bdu274CBrVu3Hjp0KCcnR1NT09TUlAGk2VDfyNrLJ3OeZeRkDa9Obd9uvYBeSbvGyUsO//////efv/9h4Pfv3////+/q6lJRUTEzMwNpNjHSN7Bw1/Bo1vRsVnNrVHNr1PJqEbOo6Jm7+////58+f/kGA58+ffr//397e7uqqiqyZg81j3Y1j3Z1z3Y1z3Ytn05Rq9qJiw4RttnYyMDQ3EnLuUAbhvTcCuUsMytaZ1+9fP7o0WMnYODo0aNXrlwpLi7W0NAA+hkAJVeZGgBp0RcAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/02-flex-row-height-opt.png&quot;
        title=&quot;./images/02-flex-row-height-opt.png&quot;
        src=&quot;/static/363fe81f67994c2ee167524d3a3a25cc/1d69c/02-flex-row-height-opt.png&quot;
        srcset=&quot;/static/363fe81f67994c2ee167524d3a3a25cc/4dcb9/02-flex-row-height-opt.png 188w,
/static/363fe81f67994c2ee167524d3a3a25cc/5ff7e/02-flex-row-height-opt.png 375w,
/static/363fe81f67994c2ee167524d3a3a25cc/1d69c/02-flex-row-height-opt.png 750w,
/static/363fe81f67994c2ee167524d3a3a25cc/78797/02-flex-row-height-opt.png 1125w,
/static/363fe81f67994c2ee167524d3a3a25cc/c1b63/02-flex-row-height-opt.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;We can use other values, instead of the default &lt;code&gt;stretch&lt;/code&gt;:&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们可以设置其他的值来取代默认的&lt;code&gt;stretch&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;flex-start&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;flex-end&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;baseline&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;stretch&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;To control the alignment on the main axis, use the &lt;code&gt;justify-content&lt;/code&gt;property. The default value is &lt;code&gt;flex-start&lt;/code&gt;, which is why our items are all aligned against the left margin. We could instead use any of the following values:&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;要控制在主轴上的对齐，使用 &lt;code&gt;justify-content&lt;/code&gt;。默认值是&lt;code&gt;flex-start&lt;/code&gt;，这就是为什么 flex 项全部对齐做外边距的原因。我们可以使用下面的任意值来替代：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;flex-start&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;flex-end&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;center&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;space-around&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;space-between&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;The &lt;code&gt;space-between&lt;/code&gt; and &lt;code&gt;space-around&lt;/code&gt; keywords are especially interesting. With &lt;code&gt;space-between&lt;/code&gt;, the space left over after the flex items have been displayed is distributed evenly between the items.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;space-between&lt;/code&gt;和&lt;code&gt;space-around&lt;/code&gt;关键字尤其有趣。使用&lt;code&gt;space-between&lt;/code&gt;，flex 容器中剩余的空白位置会平均分布在 flex 项之间。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 21.27659574468085%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA4klEQVQI12MwBgETY0N9C3sfk5D+WauOP3nxoWbi9q/ff3lnzP7+41dF75a7j97MWHF019Ebe0/cUTf2NDXWNzYxMTY2ZoBoNjEyMLbyELGo6J23+/aD58Uda9++++gUP/Hd+48Frauv3HzcP3/Ppr3nt+y/rGroZmpsALIPSbO+iY2XqHXd5KVHn736VNm/7dv3X67JM7//+F3aveXu47dTlx3deeTmrmN3VI2QbDaCAkMjU0tNE3ff4Ji09Cw3n4jsnFwLB/+cnFxX7/CU1Az/kJjImKSouGQ9IwtjI0OIHgC7IGuNy8hEVgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/03-flex-space-between-opt.png&quot;
        title=&quot;./images/03-flex-space-between-opt.png&quot;
        src=&quot;/static/cf5a602ad08e198b566162deeb47d30e/1d69c/03-flex-space-between-opt.png&quot;
        srcset=&quot;/static/cf5a602ad08e198b566162deeb47d30e/4dcb9/03-flex-space-between-opt.png 188w,
/static/cf5a602ad08e198b566162deeb47d30e/5ff7e/03-flex-space-between-opt.png 375w,
/static/cf5a602ad08e198b566162deeb47d30e/1d69c/03-flex-space-between-opt.png 750w,
/static/cf5a602ad08e198b566162deeb47d30e/78797/03-flex-space-between-opt.png 1125w,
/static/cf5a602ad08e198b566162deeb47d30e/c1b63/03-flex-space-between-opt.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Using &lt;code&gt;space-around&lt;/code&gt; is similar except that the space left over is distributed on both sides of the items. You get a half-sized gap on each end.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;使用&lt;code&gt;space-around&lt;/code&gt;，flex 容器中剩余的空白位置会平均分布在 flex 项两边。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 21.808510638297875%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA40lEQVQI12MwNjY2NTXV1NTKykzvmL3PImLinYevayZse/TsfULl8juP3uS3rr/3+G1V/9bbD193ztmfm5OtqalpampqbGzMgKQ5raB1jax97ZVbT0o61t68+yy8YO7lm4/Sa5devfWkuH3NpRuPGqZszcrKRNesoamZl5tV3rtVzqnl3pN3lX1bHzx9F1269O7jt9nN6+49flveu/XW/Vfts/fn5+VqIGs2MTExMDBwcXZy84nQNfdKTs1w841IScuwcwtOTkl39gxLTs1w94lISkn3Doh2dnY2MDAwMTEBagYAuYdrgl51RusAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/04-flex-space-around-opt.png&quot;
        title=&quot;./images/04-flex-space-around-opt.png&quot;
        src=&quot;/static/9c45994c6dcf8ed4febe59c053cd52b1/1d69c/04-flex-space-around-opt.png&quot;
        srcset=&quot;/static/9c45994c6dcf8ed4febe59c053cd52b1/4dcb9/04-flex-space-around-opt.png 188w,
/static/9c45994c6dcf8ed4febe59c053cd52b1/5ff7e/04-flex-space-around-opt.png 375w,
/static/9c45994c6dcf8ed4febe59c053cd52b1/1d69c/04-flex-space-around-opt.png 750w,
/static/9c45994c6dcf8ed4febe59c053cd52b1/78797/04-flex-space-around-opt.png 1125w,
/static/9c45994c6dcf8ed4febe59c053cd52b1/c1b63/04-flex-space-around-opt.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;You can see these properties and values in the CodePen below.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你可以在下面的 CodePen中看到这些属性和值。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;PzGJzm&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Flexbox Alignment flex-direction: row&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/PzGJzm/&quot;&gt;Flexbox Alignment flex-direction: row&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;We can display flex items as a column rather than a row. If we change the value of &lt;code&gt;flex-direction&lt;/code&gt; to &lt;code&gt;column&lt;/code&gt;, then the main axis becomes the column, and the cross axis is along the row — &lt;code&gt;align-items&lt;/code&gt; is still &lt;code&gt;stretch&lt;/code&gt; by default, and so stretches the items across row-wise.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们可以将 flex 项按照列摆放而不是行。如果我们将&lt;code&gt;flex-direction&lt;/code&gt;的值设置成&lt;code&gt;column&lt;/code&gt;，然后主轴变成column，横轴沿着 row——&lt;code&gt;align-items&lt;/code&gt;依旧是默认值&lt;code&gt;stretch&lt;/code&gt;，所以在每一行上拓展 flex 项。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 27.659574468085108%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAnklEQVQY02MwNjYxNjIwsXS09C3Rcc7VdsrBi7K1nAsMLL1MjPSNjU0YQJoN9Y2tPXwz51pGTlJxb1Pz7MCN2lS9+/RsQk0MdaGajQz1TW08jIO61N2b1T3wo0Y1r059mxATI1TNluG9auRpNrP1NAnpU3VvU/dsV8OHWlW9e/VtkZxtbGRgauVs7FWi6ZSn5ZyPF+VpuhQbWHlDAgwAeeBlU/TlGAgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/05-flex-column-opt.png&quot;
        title=&quot;./images/05-flex-column-opt.png&quot;
        src=&quot;/static/d84aa5009d3616bb2cd99a8f25940efe/1d69c/05-flex-column-opt.png&quot;
        srcset=&quot;/static/d84aa5009d3616bb2cd99a8f25940efe/4dcb9/05-flex-column-opt.png 188w,
/static/d84aa5009d3616bb2cd99a8f25940efe/5ff7e/05-flex-column-opt.png 375w,
/static/d84aa5009d3616bb2cd99a8f25940efe/1d69c/05-flex-column-opt.png 750w,
/static/d84aa5009d3616bb2cd99a8f25940efe/78797/05-flex-column-opt.png 1125w,
/static/d84aa5009d3616bb2cd99a8f25940efe/c1b63/05-flex-column-opt.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;If instead we want them to align to the start of the flex container, we use &lt;code&gt;flex-start&lt;/code&gt;.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果我们想要 flex 项在 flex容器的开始位置对齐，我们使用&lt;code&gt;flex-start&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 36.702127659574465%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzUlEQVQY05XQIW/CQBiHcT5Psx7cvdcMO4NAQUK/wZHdEhSZ3EfYB8HXtBUNAgWK4DBg0aT3Hk3Zf4JkyeAm9vifeTpEpLXudeOXyXs6X6y3RwDX6xceatsWQFVVQgitNRF1blhJ0R/O8tW+aTwz+1DOOQBFUdxjUl0avC03BwDsL00oZgZQluU9lj3xPJzt9ieg9Zf/4SSOn+Yfn+e68ewch6vrGkCe579wkiRRFGVZ9nMlWHgYEUkpR+Pxq7XGmOkfGWOstWmaKqVu6huXWg2K8f6PvwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/06-flex-column-start-opt.png&quot;
        title=&quot;./images/06-flex-column-start-opt.png&quot;
        src=&quot;/static/d474dafaec29a02ab7167d65127b1e93/1d69c/06-flex-column-start-opt.png&quot;
        srcset=&quot;/static/d474dafaec29a02ab7167d65127b1e93/4dcb9/06-flex-column-start-opt.png 188w,
/static/d474dafaec29a02ab7167d65127b1e93/5ff7e/06-flex-column-start-opt.png 375w,
/static/d474dafaec29a02ab7167d65127b1e93/1d69c/06-flex-column-start-opt.png 750w,
/static/d474dafaec29a02ab7167d65127b1e93/78797/06-flex-column-start-opt.png 1125w,
/static/d474dafaec29a02ab7167d65127b1e93/c1b63/06-flex-column-start-opt.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;We can use &lt;code&gt;justify-items&lt;/code&gt;, too, including &lt;code&gt;space-between&lt;/code&gt; and &lt;code&gt;space-around&lt;/code&gt;. The container needs to have enough height for you to see each in action, though!&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们也可以使用&lt;code&gt;justify-items&lt;/code&gt;，包括&lt;code&gt;space-between&lt;/code&gt;和&lt;code&gt;space-around&lt;/code&gt;。但是要看到这些效果，容器需要足够的高度！&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 42.5531914893617%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJUlEQVQoz2MwNjYxNtI3sg3UcsxUNE9QskjEjRIULVK0zHxMjA1AuoyNGUxMTPV1tYISymum7IsuXRJauCisaDF2VLgoomyVW2i+ob62iYkpSLOpqam2tmZeafOC9aenLtk/belBXGjq4v1z1pzMKGzQ0dY0NQVrNjE11dHWTMuvn7DocOv07e0zd+JCbTO298w/mJhVo6ujZYKsOaOgYfLSo63TdrTP2IULtU3f0TPvELpmXW3NtLz6CYuOtE7f0T5zFy7UNmNHz3xsmlPz6voXHW6Zvr1t5k5cqHXG9m40Z4MCTEszv6x1wYbzU5YcmrbsCC40dcmhOWvPZhQ2IgWYiamBno5vRE500ezQnElhuVNwopzJEYWz3IMzDPV1TExA8QwA1jvyPtzH8kQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/07-flex-column-space-between-opt.png&quot;
        title=&quot;./images/07-flex-column-space-between-opt.png&quot;
        src=&quot;/static/feab158b3fe494f659a9ae0904bd7723/1d69c/07-flex-column-space-between-opt.png&quot;
        srcset=&quot;/static/feab158b3fe494f659a9ae0904bd7723/4dcb9/07-flex-column-space-between-opt.png 188w,
/static/feab158b3fe494f659a9ae0904bd7723/5ff7e/07-flex-column-space-between-opt.png 375w,
/static/feab158b3fe494f659a9ae0904bd7723/1d69c/07-flex-column-space-between-opt.png 750w,
/static/feab158b3fe494f659a9ae0904bd7723/78797/07-flex-column-space-between-opt.png 1125w,
/static/feab158b3fe494f659a9ae0904bd7723/c1b63/07-flex-column-space-between-opt.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;JKRrvY&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Flexbox Alignment flex-direction: column&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/JKRrvY/&quot;&gt;Flexbox Alignment flex-direction: column&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;ALIGNMENT-IN-GRID-LAYOUT-网格布局中的对齐&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ALIGNMENT-IN-GRID-LAYOUT-%E7%BD%91%E6%A0%BC%E5%B8%83%E5%B1%80%E4%B8%AD%E7%9A%84%E5%AF%B9%E9%BD%90&quot; aria-label=&quot;ALIGNMENT IN GRID LAYOUT 网格布局中的对齐 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ALIGNMENT IN GRID LAYOUT 网格布局中的对齐&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;In a grid layout, the behavior is similar, except that we are aligning items within the defined grid area. In flexbox, we talk about the main and cross axis; with grids, we use the terms “block” or “column axis” to describe the axis defining our columns, and “inline” or “row axis” to describe the axis defining our rows, as &lt;a href=&quot;https://www.w3.org/TR/css-grid-1/#grid-concepts&quot; class=&quot;link-underline&quot;&gt;defined in the specification&lt;/a&gt;.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在网格布局中，对齐的行为是相似的，除了在定义的网格区域对去 grid 项。在 flexbox 中，我们讨论的是主轴和横轴；在网格中，我们用“block”或者“column axis（列轴）”的说法来描述列中定义的轴，用“inline”和“row axis（横轴）”的说法来描述行中定义的轴，比如&lt;a href=&quot;https://www.w3.org/TR/css-grid-1/#grid-concepts&quot; class=&quot;link-underline&quot;&gt;defined in the specification&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;We can align content inside a grid area using the properties and values described in the box alignment specification.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们可以使用 box alignment 中定义的属性和值来对齐一个网格区域中的内容。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;A grid area is one or more grid cells. In the example below, we have a four-column and four-row track grid. The tracks are separated by a grid gap of 10 pixels, and I have created three grid areas using line-based positioning. We’ll look at this positioning properly later in this guide, but the value before the &lt;code&gt;/&lt;/code&gt; is the line that the content starts on, and the value after where it ends.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;一个网格区域可以是一个或者更多网络单元格。在下面的例子中，我们有四行四列的通道网格。这些轨道之间有一个10像素的分割间隙，同时以线为基础创建了是三个网格区域，并放在合适的位置。稍后我们会在这个指南中看看这个正确的位置。&lt;code&gt;/&lt;/code&gt;前面的数字表示的是内容在这一行的起点，后面的数字表示的是内容在何处结束（译者注：千万别当做五分之一来看待，这里的意思是，内容从第一列开始，到第五列结束）。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;EygpMv&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Grid Alignment: align-items and justify-items&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/EygpMv/&quot;&gt;Grid Alignment: align-items and justify-items&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;The dotted border is on a background image, to help us see the defined areas. So, in the first example, each area uses the defaults of &lt;code&gt;stretch&lt;/code&gt; for both &lt;code&gt;align-items&lt;/code&gt; on the column axis and &lt;code&gt;justify-items&lt;/code&gt;on the row axis. This means that the content stretches to completely fill the defined area.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;虚线边框是背景图中的，帮助我们看到定义的区域。那么，在第一个例子中，每个区域在列轴上使用&lt;code&gt;stretch&lt;/code&gt;作为&lt;code&gt;align-items&lt;/code&gt;的默认值，在行轴上使用&lt;code&gt;justify-items&lt;/code&gt;。这意味着内容会延伸到完全填充定义的区域。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.319148936170215%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdklEQVQoz23SyU7CUBSAYV6ItqZ9Hd2IK5U5IEUgIi6UQidaBrEXaOklUAhEXDFPbVE0+EbGoLFCky9n9+ec3FwHjuMEQWAYeuLyhW7yvmvGH+MDcX43rfwxLpQsHrv8RxiGEwSO445djCJOX5QpNjecvBBUQ4Q2hPqq3NkGEwKGIsRefBl+EKFJS0OmMrZFg6Gg6l4yaxO7I1S+sWbAmK1OD3HVKQPGIjR9UcYmvginBWhmpRFdmfwBPzMLJllplFMND0nvxwjijCQ5+PIptVagbf5nVDom7G+Apqv9LZkS0MPNXpISVJ2pjHPy3IqvzQpwqfTWtDQoNMxgjLU52xOhSs1XvjbJKXMrXp4VG0vQNtKPA0E1vFG7s8kkV3/+KDeXQNMlTQe/pNZK6ZpKb515GuahXfz92leZXN2kwYSTF1ZsbS7CVa37xlZnpdZ7IMbtxxiKnJ5H77h2glISlGoVT9dv6UZa1K7v5RSrnbkTGIbuftgXkgxE0Xc+Y/0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/08-grid-default-align-opt.png&quot;
        title=&quot;./images/08-grid-default-align-opt.png&quot;
        src=&quot;/static/f9a02f37e17d75b843a5dd9ce2704659/1d69c/08-grid-default-align-opt.png&quot;
        srcset=&quot;/static/f9a02f37e17d75b843a5dd9ce2704659/4dcb9/08-grid-default-align-opt.png 188w,
/static/f9a02f37e17d75b843a5dd9ce2704659/5ff7e/08-grid-default-align-opt.png 375w,
/static/f9a02f37e17d75b843a5dd9ce2704659/1d69c/08-grid-default-align-opt.png 750w,
/static/f9a02f37e17d75b843a5dd9ce2704659/78797/08-grid-default-align-opt.png 1125w,
/static/f9a02f37e17d75b843a5dd9ce2704659/c1b63/08-grid-default-align-opt.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;In the second example, I have changed the value of &lt;code&gt;align-items&lt;/code&gt; on the grid container to &lt;code&gt;center&lt;/code&gt;. We can also change this value on an individual grid item using the &lt;code&gt;align-self&lt;/code&gt; property. In this case, I have set all items to &lt;code&gt;center&lt;/code&gt;, but item two to &lt;code&gt;stretch&lt;/code&gt;.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在第二个例子中，我将 grid 容器的&lt;code&gt;align-items&lt;/code&gt;的值修改成&lt;code&gt;center&lt;/code&gt;。我们也可以修改一个单独的 gird 项上的&lt;code&gt;align-self&lt;/code&gt;属性的值。此时，我把所有的项都设置成&lt;code&gt;center&lt;/code&gt;，但是第二个项设置成 &lt;code&gt;stretch&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.319148936170215%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABh0lEQVQoz4WQ2U7CUBCGfZ3S7eIcHsobb7zxATBqRFFckUIUJSZqIr0hKbTVCoalgAuWpS4stuyaKMGYSDxGTTQtGCdf5mbyZf6ZEQAAhJAkSduk7ViSOI4L8/xQuFAoEo3OOxw0TUMIAQAjAACr1WqxYCzLIoT6/T76o75HoihSFGmQcRxfXPFcFJsRuXiavhlKRFbTudqK20/TlEm2rLu3yrXnbOFeua4NkrupK6pe1p+2/AcUZZQxDGMDgf9ivyGEeD5MkgOxV12bavkhdVk6UyomMlflRuux1+shhILBoEGGENIUOTo+ZfdKMy7OzgizX9i/8QjTrnA2X3196X5uDofMMkURYxOzG/vyku9oeUda3pZ++47k9B0nzu+qervR6e3uHZpvxnGc8fqane5dtV7RWhWtXdHbP12rdxRVE2OF+EXVubZt/jaB43NOJn6pizH1JFWKpA1I8m3zoYvQO0JIEATzwwiCWFhYzCr5WDyZSKbiRmIJWU6lM5lMoVBkGOYn9gfu5Zu8+fbV3wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/09-grid-align-items-opt.png&quot;
        title=&quot;./images/09-grid-align-items-opt.png&quot;
        src=&quot;/static/d3e4524e1592f7b553f999633c835d20/1d69c/09-grid-align-items-opt.png&quot;
        srcset=&quot;/static/d3e4524e1592f7b553f999633c835d20/4dcb9/09-grid-align-items-opt.png 188w,
/static/d3e4524e1592f7b553f999633c835d20/5ff7e/09-grid-align-items-opt.png 375w,
/static/d3e4524e1592f7b553f999633c835d20/1d69c/09-grid-align-items-opt.png 750w,
/static/d3e4524e1592f7b553f999633c835d20/78797/09-grid-align-items-opt.png 1125w,
/static/d3e4524e1592f7b553f999633c835d20/c1b63/09-grid-align-items-opt.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;In the third example, I have changed the value of &lt;code&gt;justify-items&lt;/code&gt; and &lt;code&gt;justify-self&lt;/code&gt; again, setting these to &lt;code&gt;center&lt;/code&gt; and &lt;code&gt;stretch&lt;/code&gt;.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在第三个例子中，我再次修改了&lt;code&gt;justify-items&lt;/code&gt;和&lt;code&gt;justify-self&lt;/code&gt;的值，将这些设置成&lt;code&gt;center&lt;/code&gt;和&lt;code&gt;stretch&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.319148936170215%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB8klEQVQoz23R32/SUBQH8P097QUeevtn6aPxfS8yxQQXoxCZYziiMQG1pYZ2lF8D0cmQrfzcKOuGNch+JAR6C7Q9hpEZIX5zXk5OPjkn964xDIMxdrvd6+vrkiRxHJeYR5DEZCAUfRmKSmJy3gsCz/OyLHu9Xo/HgzFmGGaNYRiWZSma4jkeACzLAgDbcQCg0tArdf1vuxiJoogQWsI0TcdiMQAYj8eEkLFhgGMVDzuF8ik41tgwCCGj0QgAeJ5fxRRFxeNxADAMYzKZENMEcEo/ul8qKoBDTHM6nRJCAEAQhP9g7tPH29umALbtzC/8dnT2tdoFAMexrNlsOjEBIJFILGHMsgjRwVBE7d1U65rS6h03e82OLu03pP16s6NXG+fXN0O9f3U9ND+vbMYYezyuew82nm7nNoKib0v2heQnr2R/OOPfyfi25EcB6UTV00Ule9BN7Yk0vYLdrvsPH794W/Jvy892MpuR7PM3OX847Q+nNyNZXyjVvfhdLJ/mvp/dYvpfzCKEXod3+5dDVft1oV/W2j0hc6z1BvP6OVDP+xOT5A/a+bKW2ksu4cU/Lx5sNpsBwOBqxKXrcBfbtgGgcKiWjvRsJkUtb8YIoWAwqGmaoijtdqtQKgciicZdlFqtc9J69yH1nstHdyMIuRb4D3VUo21K+GNzAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/10-grid-justify-items-opt.png&quot;
        title=&quot;./images/10-grid-justify-items-opt.png&quot;
        src=&quot;/static/c7edf2a9086bee77270e1bcb37427df9/1d69c/10-grid-justify-items-opt.png&quot;
        srcset=&quot;/static/c7edf2a9086bee77270e1bcb37427df9/4dcb9/10-grid-justify-items-opt.png 188w,
/static/c7edf2a9086bee77270e1bcb37427df9/5ff7e/10-grid-justify-items-opt.png 375w,
/static/c7edf2a9086bee77270e1bcb37427df9/1d69c/10-grid-justify-items-opt.png 750w,
/static/c7edf2a9086bee77270e1bcb37427df9/78797/10-grid-justify-items-opt.png 1125w,
/static/c7edf2a9086bee77270e1bcb37427df9/c1b63/10-grid-justify-items-opt.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;In all of the examples above, I have aligned the content of the grid areas, the areas defined by the start and end grid lines.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;上面的所有例子，我将网格区域中的内容对齐，这些网格区域由起点网格线和终点网格线定义。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;We can also align the entire grid inside the container, if our grid tracks are sized so that they take up less space than the container that has been set to &lt;code&gt;display: grid&lt;/code&gt;. In this case, we use the &lt;code&gt;align-content&lt;/code&gt;and &lt;code&gt;justify-content&lt;/code&gt; properties, as with flexbox.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们也可以将容器中的网格整个对齐，如果我们的网格轨道是有固定大小的，那么它们将会比设置了&lt;code&gt;display: grid&lt;/code&gt;的容器占据更小的空间。此时，我们使用 &lt;code&gt;align-content&lt;/code&gt; 和 &lt;code&gt;justify-content&lt;/code&gt;，就像 flexbox。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;aZBozX&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Grid Alignment: aligning the grid&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/aZBozX/&quot;&gt;Grid Alignment: aligning the grid&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;In the first example, we see the default alignment of a grid where the columns and rows have been defined in absolute units and take up less space than the fixed-sized wrapper allows for. The default values for both are &lt;code&gt;start&lt;/code&gt;.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在第一个例子中，我们可以看到网格的默认布局，行和列都被定义在绝对大小单位中，占据的空间比固定大小的包装器允许的空间更小。&lt;code&gt;align-content&lt;/code&gt;和&lt;code&gt;justify-content&lt;/code&gt;的默认值都是&lt;code&gt;start&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 69.14893617021278%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzklEQVQoz32TXW/SYBiG92MgKe08gJeW/h9PjBo1JhqGHhhI5phZ6Vx0A5oWApttN6BSnDL5CvIxi5sK1QT+gyJKhQPgWZzJxIbuyXV65X6eO++7hBByk+SVZeLqdW+AlXyr/MO1mAnfYyHAJOuNY13XFUWhKMrlcrnd7iWEEEmSyzh2e2WDS3/eSr57ttcwsZWsC+nW8PcYALrdLk3T/8uE48a9tW3xPcMX2VjZBMOXwmLtW38AAJ1Ox+PxmOWb94M7khYSSpvxiomQUI5I9f6PXwCg6/oC+TxZY/gSG6vMEzpPjoiWMoXjmM/PHhx9jaebCUWbJ5X/lFA0+fB08HNomXzLu74jaQxfMB38Qv3wNF6JXrI2gWN3Vp7ElI/be9WwWLsgItV2s60NvnSJTBE45n3Eiq87nFzjD5oXCKlj8dVJSChzcqM/WCT/eSSE49rdVTbRCIaP1qOFefhUMxh9+3y3+t2yMAf2ILCpVrpiriUfns7zpvpFzJ28LLQXF0ZRlN1u39+XAcAwhuPxaAGjkWEYs9ms3W6bZZvNlslkAGAymYDFTKdTAOj1ejRNO53Of23jOO73+4vFYjabzVmMqqr5fJ7juL8fAyF0Bm/R4rgf846xAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/11-grid-align-start-opt.png&quot;
        title=&quot;./images/11-grid-align-start-opt.png&quot;
        src=&quot;/static/ff12759b72f9a6f55de5434a0500cc00/1d69c/11-grid-align-start-opt.png&quot;
        srcset=&quot;/static/ff12759b72f9a6f55de5434a0500cc00/4dcb9/11-grid-align-start-opt.png 188w,
/static/ff12759b72f9a6f55de5434a0500cc00/5ff7e/11-grid-align-start-opt.png 375w,
/static/ff12759b72f9a6f55de5434a0500cc00/1d69c/11-grid-align-start-opt.png 750w,
/static/ff12759b72f9a6f55de5434a0500cc00/78797/11-grid-align-start-opt.png 1125w,
/static/ff12759b72f9a6f55de5434a0500cc00/c1b63/11-grid-align-start-opt.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;To move the tracks to the bottom right, we change the values to &lt;code&gt;end&lt;/code&gt;.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了将轨道移动到右下角，我们可以把值变成&lt;code&gt;end&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 69.68085106382979%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABp0lEQVQoz4WTXUvCYBiG/TMeeDz1D3UaQR8HYVgioVLmx7RVzmXTd5tT0ezbLaduti2DWlFQ9DOaQxN9g1ZpoXZznV7czwPPY0EQxOFw2Gw2r9cryzLHcZcTwvO8KIo4jiPfsSAI4nQ6rVYry7IQwl6vByek3+9DCDVNM0273T6UAQAQQl3XDcNot4228Zc3Xe8PBoqqjpFpmoYQdjsd8eaVLF3TxzfU0S9A+Tp3/rARZ8aMbcrv3U7h4s6/y4f2a1uEMEowWY2mm8vrxDS5xGlBohrLNNB0fZQoKWCMvOJP/SNvJqtouhEl66NEDoRt+j+5yGnB5JjmcOpTDkyWu91OTX1JFRRQbmUOh4Byq8jdZc/uAyg9fez7QIIPH9RCKcFka1+IkDVQbsUp2eWb2nxWf8QoKZlTcFY2SWRlIq+QJTUGrsbvbB6JYbQr0hMGRJxtJrJf7DFNIndFFhU0I7l8xMTzhHBw0ngOkRLGqNu0YhKnlJ2sSp9qe/nbtSD1SzYfw+PxiJJUqVz4Q8ScK7K4ii64v5h3o0urMbdvZ2kNm5ld+ZE/ANU/3pceeqRAAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/12-grid-align-end-opt.png&quot;
        title=&quot;./images/12-grid-align-end-opt.png&quot;
        src=&quot;/static/555650eee23cb7b00eb1f8ee500e7334/1d69c/12-grid-align-end-opt.png&quot;
        srcset=&quot;/static/555650eee23cb7b00eb1f8ee500e7334/4dcb9/12-grid-align-end-opt.png 188w,
/static/555650eee23cb7b00eb1f8ee500e7334/5ff7e/12-grid-align-end-opt.png 375w,
/static/555650eee23cb7b00eb1f8ee500e7334/1d69c/12-grid-align-end-opt.png 750w,
/static/555650eee23cb7b00eb1f8ee500e7334/78797/12-grid-align-end-opt.png 1125w,
/static/555650eee23cb7b00eb1f8ee500e7334/c1b63/12-grid-align-end-opt.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Just as with flexbox, we can use &lt;code&gt;space-around&lt;/code&gt; and &lt;code&gt;space-between&lt;/code&gt;. This might cause some behavior that we don’t want as the grid gaps essentially become wider. However, as you can see from the image below and in the third example in the CodePen, we get the same space between or around the tracks as we see with flexbox.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;就像 flexbox 一样，我们可以使用&lt;code&gt;space-around&lt;/code&gt;和&lt;code&gt;sapce-between&lt;/code&gt;。这可能会引发一些我们不希望看到的行为，我们不想网格间隙变得更宽。然而，正如下图和 CodePen 中的第三个例子中你看到的一样，在轨道之间或者周围有相同的空间，就像在 flexbox 中一样。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 69.68085106382979%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB20lEQVQoz23TW2/SUADA8X0ZubQ+0dIvpDEaJ2YuZmqcm+CggzEKtZSC9Bqgq85tdYlzKxUGrpUOHYuLzk5nTCSg2Uy8BB6NJJpw6Mnv9Z9zH0MQxO/3wzAUmJgS5XU6LzOc4ijDLuWllVCEQFEUGYyxQYzBkDswhfPqG6r4gpZNR+mSkVt+FUzIf2Of73/sPwt7L1y9my6Z8byW4HRHi2yZlOq3cX4w81DsuTgRzCxZCa6cFCqOCP45VdiZjgqOcYhRdgleT4lVR0mhki4ad2LiaOw9H5hNSjs4sxnNaaNiD7T57Facq96YY4diDMM8blc4Su7b3+q7tvH646hty65ZdvPgS2n5GYqiPt9wHImRe++/VhuH9eYRYNuyf/d69nHHbH0uPHw6FKODZZ+7Mhvn6/eojTC9CQje32h3TtVyC8/qN8McsGcM8ronb+GPtbfSqllQLYC48vLk+891fZ8QajMLErhnl+sMSWW7p713H9r2py7g8LjT6/fXtFZCqDmcNgx5Lk+GGKWxyG4RvA6I57V290TV9hbYyvQ8eM8YDHnGr0eEJwe0bDBKA5AumT9+9TXjKKM051LK6POELo1fywmPkrRAMhIglRFX11RWlKlscSYY/fcvkD8k9r2WNu2WkgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/13-grid-align-space-opt.png&quot;
        title=&quot;./images/13-grid-align-space-opt.png&quot;
        src=&quot;/static/d754374680e5b355dce2245b16276470/1d69c/13-grid-align-space-opt.png&quot;
        srcset=&quot;/static/d754374680e5b355dce2245b16276470/4dcb9/13-grid-align-space-opt.png 188w,
/static/d754374680e5b355dce2245b16276470/5ff7e/13-grid-align-space-opt.png 375w,
/static/d754374680e5b355dce2245b16276470/1d69c/13-grid-align-space-opt.png 750w,
/static/d754374680e5b355dce2245b16276470/78797/13-grid-align-space-opt.png 1125w,
/static/d754374680e5b355dce2245b16276470/c1b63/13-grid-align-space-opt.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;The fixed-sized tracks will gain additional space if they span more than one track. Element two and four in our example are wider and three is taller because they are given the extra space assigned to the gap they span over.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果固定大小的轨道跨度超过一个轨道的宽度，它将会获得额外的空间。在我们例子中的例子二和四更宽，例子三更高，因为他们有额外的空间分配给他们跨过的间隙。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;We can completely center the grid by setting both values to &lt;code&gt;center&lt;/code&gt;, as shown in the last example.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们可以通过将两个值设置成&lt;code&gt;center&lt;/code&gt;来完全地将网格居中，就像最后一个例子中展示的一样。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 69.68085106382979%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjklEQVQoz52TSU/CUBRG/S+4YSkv8OM0rIyKohgVgU5CC1Gshh1DJ6BIERMZSkKicUyciuAQFGT0GSWaWtuNN2d78t3cYQwAYLVazWaz3W6XJInnmFSS1yUpcBkxjaIo+K4xAIDNZjOZTMEgBSG8qTXv6q+6XCtNCGFFlgEAFotFLY+TZKDdHS7irBPjF3EtSwQ/44lXT5RyqTDxZWqTO324RPArZPovq1R6AeOOL+pyuaQnU2S3D10b/5O/kp0Yt+xP6RBIORD26KJekQ2Se0Po28zgdE4DsZMjdvY9oczZ1aNcLlr+yhRFDt4hTmex7V8mEs6GowU6VnQHxXMj+bPtHlxAWddGUo0T5zFa8m1lZ72MYdujZP9ujowcqPHv5uloAQtL8wh7fNkwnHZvAN3B9Hooo2aNEslIHt2WHMbyOEUGWp3hnC/hxHk1DpRFtvY8IXHaHaueKqXiof6qRudZe2irURqth+dO4+nt9v4FQihrznP0GJOTU6IoMok4xzIa2BFMQhAEr9f78xgfJLXfQTWO9VwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/14-grid-align-center-opt.png&quot;
        title=&quot;./images/14-grid-align-center-opt.png&quot;
        src=&quot;/static/ceb8faed964e3a8e22af3547d04230d9/1d69c/14-grid-align-center-opt.png&quot;
        srcset=&quot;/static/ceb8faed964e3a8e22af3547d04230d9/4dcb9/14-grid-align-center-opt.png 188w,
/static/ceb8faed964e3a8e22af3547d04230d9/5ff7e/14-grid-align-center-opt.png 375w,
/static/ceb8faed964e3a8e22af3547d04230d9/1d69c/14-grid-align-center-opt.png 750w,
/static/ceb8faed964e3a8e22af3547d04230d9/78797/14-grid-align-center-opt.png 1125w,
/static/ceb8faed964e3a8e22af3547d04230d9/c1b63/14-grid-align-center-opt.png 1200w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;We have very nice alignment abilities in both flexbox and grid, and they work in a generally consistent way. We can align individual items and groups of items in a way that is responsive and prevents overlap — something the web has lacked until now!&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在 flexbox 和 grid 中我们有非常完美的对齐能力，同时它们以一种普遍一直的方式工作。我们可以对齐单独的项也可以对齐一组项，这反应迅速，同时放置部分重叠——直到现在，web 一直都缺乏的东西。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Responsive-By-Default-默认反应&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Responsive-By-Default-%E9%BB%98%E8%AE%A4%E5%8F%8D%E5%BA%94&quot; aria-label=&quot;Responsive By Default 默认反应 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Responsive By Default 默认反应&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;In the last section, we looked at alignment. The box-alignment properties as used in grid and flexbox layouts are one area where we see how these specifications have emerged in a world where responsive design is just how things are done. Values such as &lt;code&gt;space-between&lt;/code&gt;, &lt;code&gt;space-around&lt;/code&gt; and &lt;code&gt;stretch&lt;/code&gt; allow for responsiveness, distributing content equally among or between items.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在最后一节中，我们看看 alignment。在 flexbox 和网格布局中使用的box-alignment 属性作用在一个区域，在这个区域我们看到了这些参数是如何形成一个世界的，而这个世界就是响应式设计需要做的。像&lt;code&gt;space-betweem&lt;/code&gt;，&lt;code&gt;space-around&lt;/code&gt;和&lt;code&gt;stretch&lt;/code&gt;这些值都允许响应，在项之间或者周围平均的分配内容。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;There is more, however. Responsive design is often about maintaining proportion. When we calculate columns for a responsive design using the &lt;code&gt;target ÷ context&lt;/code&gt; approach introduced in Ethan Marcotte’s original &lt;a href=&quot;http://alistapart.com/article/fluidgrids&quot; class=&quot;link-underline&quot;&gt;article on fluid grids&lt;/a&gt;, we maintain the proportions of the original absolute-width design. Flexbox and grid layouts give us far simpler ways to deal with proportions in our designs.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;但是，还有很多。响应式设计经常需要维护比例。当我们使用&lt;a href=&quot;http://alistapart.com/article/fluidgrids&quot; class=&quot;link-underline&quot;&gt;Ethan Marcotte’s 的文章&lt;/a&gt;中介绍的&lt;code&gt;target除以 context&lt;/code&gt;方法为响应式设计计算列时，我们维持原来绝对宽度设计的比例。Flexbox 和网格布局给了我们很简单的方法来处理设计中 的比例。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Flexbox gives us a &lt;strong&gt;content-out&lt;/strong&gt; approach to flexibility. We see this when we use a keyword value of &lt;code&gt;space-between&lt;/code&gt; to space our items evenly. First, the amount of space taken up by our items is calculated, and then the remaining space in the container is divided up and used evenly to space out the items. We can get more control of content distribution by way of properties that we apply to the flex items themselves:&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Flexbox给了我们一种从内容外部入手实现弹性的方法。当我们使用&lt;code&gt;space-between&lt;/code&gt;来平均分配空间时，我们可以看到这种方式。首先，一些空间呗计算过之后的项占据，然后容器中剩余的空间被分割开，平均地分配在项外面。我们可以通过在 flex 项自身上应用属性来得到更多的内容分配的控制权。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;flex-grow&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;flex-shrink&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;flex-basis&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;These three properties are more usually described by the shorthand &lt;code&gt;flex&lt;/code&gt; property. If we add &lt;code&gt;flex: 1 1 300px&lt;/code&gt; to an item, we are stating that &lt;code&gt;flex-grow&lt;/code&gt; should be &lt;code&gt;1&lt;/code&gt; so that items can grow, &lt;code&gt;flex-shrink&lt;/code&gt;should be &lt;code&gt;1&lt;/code&gt; so that items can shrink, and the &lt;code&gt;flex-basis&lt;/code&gt; should be 300 pixels. Applying this to our cards layout gives us the example below.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这些属性通常更多地是用简单的 flex 属性来描述。如果我们对一个项添加&lt;code&gt;flex: 1 1 300px&lt;/code&gt;，我们来陈述一遍，&lt;code&gt;flex-grow&lt;/code&gt;是1，项可以扩大，&lt;code&gt;flex-shrink&lt;/code&gt;是1，项可以收缩，并且&lt;code&gt;flex-basis&lt;/code&gt;是300像素。把这个应用到我们的卡片不居中，可以得到下面的这个例子。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;gMLrEG&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Flexbox: flex properties&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/gMLrEG/&quot;&gt;Flexbox: flex properties&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;Our &lt;code&gt;flex-basis&lt;/code&gt; here is 300 pixels, and we have three cards in a row. If the flex container is wider than 900 pixels, then the remaining space is divided into three and distributed between the items equally. This is because we have set &lt;code&gt;flex-grow&lt;/code&gt; to &lt;code&gt;1&lt;/code&gt; so that our items can grow from the &lt;code&gt;flex-basis&lt;/code&gt;. We have also set &lt;code&gt;flex-shrink&lt;/code&gt; to &lt;code&gt;1&lt;/code&gt;, which means that, where we don’t have space for three 300-pixel columns, space will be removed equally.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;flex-basis&lt;/code&gt;在这里是300像素，我们三个卡片是在一行的。如果 flex 容器比900像素宽，那么剩下的空间会平均分配三个卡片之。这是因为我们设置了&lt;code&gt;flex-grow&lt;/code&gt;为&lt;code&gt;1&lt;/code&gt;，所以项会在&lt;code&gt;flex-basis&lt;/code&gt;的基础上扩大。我们也设置了&lt;code&gt;flex-shrink&lt;/code&gt;为&lt;code&gt;1&lt;/code&gt;，这一位置如果三个300像素的列之间没有足够的空间，项之间的空间会被移除。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;If we want these items to grow in different proportions, then we can change the &lt;code&gt;flex-grow&lt;/code&gt; value on one or more items. If we would like the first item to get three times the available space distributed to it, we would set &lt;code&gt;flex-grow&lt;/code&gt; to &lt;code&gt;3&lt;/code&gt;.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果我们想这些项以不同的比例扩大，我们可以修改一个或者更多项的&lt;code&gt;flex-grow&lt;/code&gt;，如果我们想第一个项在空间足够时变成三倍，我们将设置 &lt;code&gt;flex-grow&lt;/code&gt;为&lt;code&gt;3&lt;/code&gt;。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;NrbNmz&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Flexbox: flex properties&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/NrbNmz/&quot;&gt;Flexbox: flex properties&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;The available space is distributed &lt;em&gt;after&lt;/em&gt; the amount needed for &lt;code&gt;flex-basis&lt;/code&gt; has been taken into account. This is why our first item is not three times the size of our other items, but instead gets a share of three parts of the remaining space. You will see a bigger change by setting the value for &lt;code&gt;flex-basis&lt;/code&gt; to &lt;code&gt;0&lt;/code&gt;, in which case we wouldn’t have a starting value to remove from the overall container. Then, the entire width of the container could be distributed in proportion to our items.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;可用空间是在&lt;code&gt;flex-basis&lt;/code&gt;被考虑需要的空间大小之后分配的。这就是为什么我们的第一项不是扩大原来的三倍，而是三个卡片的剩余空间。将 &lt;code&gt;flex-basis&lt;/code&gt;设置成&lt;code&gt;0&lt;/code&gt;你将看到一个更大的变化。在这种情况下，我们没有一个从整个容器中移除的初始值。然后整个容器的宽度都将按比例分配给各项。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;jrVqoQ&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Flexbox: flex properties&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/jrVqoQ/&quot;&gt;Flexbox: flex properties&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;A very useful tool to help you understand these values is &lt;a href=&quot;https://madebymike.com.au/demos/flexbox-tester/&quot; class=&quot;link-underline&quot;&gt;Flexbox Tester&lt;/a&gt;. Pop the different values into the tester, and it calculates the actual sizes at which your items will end up, and explains why they end up at that size.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Flexbox Tester 是一个帮助你理解这些值的非常好用的工具。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;If you use &lt;code&gt;auto&lt;/code&gt; as your &lt;code&gt;flex-basis&lt;/code&gt; value, it will use any size set on the flex item as the &lt;code&gt;flex-basis&lt;/code&gt; value. If there is no size, then it defaults to be the same as the value of &lt;code&gt;content&lt;/code&gt;, which is the content’s width. Using &lt;code&gt;auto&lt;/code&gt; is, therefore, very useful for reusable components that might need to have a set size on an item. You can use &lt;code&gt;auto&lt;/code&gt; and be sure that if the item needs to be around a size defined on it, flexbox will respect it.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果你使用&lt;code&gt;auto&lt;/code&gt;作为&lt;code&gt;flex-basis&lt;/code&gt;的值，这将会使用任何大小来设置 flex 项，就像&lt;code&gt;flex-basis&lt;/code&gt;的值。如果没有大小，那么默认值是内容的宽度。对于那些没有定义大小的可复用组件，使用&lt;code&gt;auto&lt;/code&gt;非常有用的。你可以使用&lt;code&gt;auto&lt;/code&gt;来确保项的大小是否和定义的差不多。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;In the next example, I have set the &lt;code&gt;flex-basis&lt;/code&gt; on all cards to &lt;code&gt;auto&lt;/code&gt;. I then gave the first card a width of 350 pixels. So, the &lt;code&gt;flex-basis&lt;/code&gt; of that first card is now 350 pixels, which is used to work out how to distribute space. The other two cards have a &lt;code&gt;flex-basis&lt;/code&gt; based on their content’s width.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在下一个例子中，我把所有的卡片的&lt;code&gt;flex-basis&lt;/code&gt;设置成&lt;code&gt;auto&lt;/code&gt;。然后我给第一个卡片设置宽度为350像素。那么第一个卡片的&lt;code&gt;flex-basis&lt;/code&gt;现在是350像素，用来解决如何分配空间。其他两个卡片的&lt;code&gt;flex-basis&lt;/code&gt;基于他们的内容的宽度。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;mEOPZM&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Flexbox: flex properties&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/mEOPZM/&quot;&gt;Flexbox: flex properties&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;If we go back to our original &lt;code&gt;flex: 1 1 300px&lt;/code&gt;, add more items to our example and set &lt;code&gt;flex-wrap: wrap&lt;/code&gt; on the container, the items will wrap in order to maintain as near as possible the &lt;code&gt;flex-basis&lt;/code&gt; value. If we have five images and three fit onto one row, then the next two will wrap onto a new row. As the items are allowed to grow, they both grow equally, and so we get two equal-sized items on the bottom row and three in the row above.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果我们回到&lt;code&gt;flex: 1 1 300px&lt;/code&gt;，在我们的例子中添加更多项，并且在容器上设置&lt;code&gt;flex-wrap: wrap&lt;/code&gt;，这些项为了尽可能地维持 &lt;code&gt;flex-basis&lt;/code&gt;的值而换行。如果我们有五个项，三个占据一行，那么接下来的两个将会换行到行的一行中。因为这些项都是允许扩大的，所以他们也会平均地扩大。所以在底部一行我们会有两个相同大小的项，上面一行有三个。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;QEGNeZ&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Flexbox: wrapping&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/QEGNeZ/&quot;&gt;Flexbox: wrapping&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;The question then asked is often, “How can I get the items on the bottom row to line up with the ones on the top, leaving a gap at the end?” The answer is that you don’t, not with flexbox. For that kind of behavior you need a grid layout.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;那么问题来了，“我怎么做才能让最后一行像顶部一样排列，在末尾留下空隙？”这个回答是，你别，别用 flexbox。对于这种行为，你需要网格布局（译者注：其实可以在后面加上n个看不见不占据空间的卡片，n为每行的卡片个数）。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;KEEPING-THINGS-IN-PROPORTION-WITH-GRID-LAYOUT&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#KEEPING-THINGS-IN-PROPORTION-WITH-GRID-LAYOUT&quot; aria-label=&quot;KEEPING THINGS IN PROPORTION WITH GRID LAYOUT permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;KEEPING THINGS IN PROPORTION WITH GRID LAYOUT&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;Grid layouts, as we have already seen, have a concept of creating column and row &lt;strong&gt;tracks&lt;/strong&gt; into which items can be positioned. When we create a flexible grid layout, we set the proportions when defining the tracks on the grid container — rather than on the items, as with flexbox. We encountered the &lt;code&gt;fr&lt;/code&gt; unit when we created our grids earlier. This unit works in a similar way to &lt;code&gt;flex-grow&lt;/code&gt; when you have a &lt;code&gt;flex-basis&lt;/code&gt;of &lt;code&gt;0&lt;/code&gt;. It assigns a fraction of the available space in the grid container.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;网格布局，正如我们所见，有这个概念：创建列和行轨道，项可以在里面定位。当我们创建一个弹性的网格布局时，我们在 grid 容器中定义轨道时设置比例——而不是在项上，就像 flexbox 一样。在我们之前创建网格时，遇到了&lt;code&gt;fr&lt;/code&gt;单位，这个单位以和 &lt;code&gt;flex-grow&lt;/code&gt;相似的方式工作，就像 &lt;code&gt;flex-basis: 0&lt;/code&gt;。它分配grid 容器中可用空间的一部分。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;In this code example, the first column track has been given &lt;code&gt;2fr&lt;/code&gt;, the other two &lt;code&gt;1fr&lt;/code&gt;. So, we divide the space into four and assign two parts to the first track and one part each to the remaining two.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在这个例子中，第一列轨道分配了&lt;code&gt;2fr&lt;/code&gt;，其他两个&lt;code&gt;1fr&lt;/code&gt;。所以，我们将空间分成四份，两份分配第一列轨道，其他的轨道每个分配一份。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;xOROVO&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Simple grid show fraction units&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/xOROVO/&quot;&gt;Simple grid show fraction units&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;Mixing absolute units and &lt;code&gt;fr&lt;/code&gt; units is valid. In this next example, we have a &lt;code&gt;2fr&lt;/code&gt; track, a &lt;code&gt;1fr&lt;/code&gt; track and a 300-pixel track. First, the absolute width is taken away, and then the remaining space is divided into three and assigned three parts to track 1 and one part to track 2.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;混合使用绝对单位和 &lt;code&gt;fr&lt;/code&gt;是有效的。在接下来的例子中，我们有一个&lt;code&gt;2fr&lt;/code&gt;的轨道，一个&lt;code&gt;1fr&lt;/code&gt;的轨道和一个300像素的轨道。首先，绝对宽度被占据，然后剩下的空间分成三份，两份给轨道1，一份给轨道2。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;rLWLLa&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Grid: Mixing absolute and  fraction units&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/rLWLLa/&quot;&gt;Grid: Mixing absolute and  fraction units&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;What you can also see from this example is that our items fit into the defined tracks — they don’t distribute across the row, as they do in the flexbox example. This is because, with grid layouts, we are creating a two-dimensional layout, then putting items into it. With flexbox, we get our content and work out how much will fit in a single dimension in a row or column, treating additional rows or columns as entirely new flex containers.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在这个例子中你还可以看到，我们的项刚好放入定义的轨道中——他们没有跨行分配，就像在 flexbox 的例子一样。这是因为，使用 grid 布局是，我们创建一个二维布局，然后将项放在里面。使用 flexbox 时，我们解决了在一维空间中的行和列中内容如何适应，对待额外的行或者列就像是一个完整的新的 flex 容器。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;What would be nice, however, is to still have a way to create &lt;strong&gt;as many columns of a certain size as will fit into the container&lt;/strong&gt;. We can do this with &lt;code&gt;grid&lt;/code&gt; and the &lt;code&gt;repeat&lt;/code&gt; syntax.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这很 nice，然而依然有方法来创建很多确定大小的列填满容器。我们可以使用 &lt;code&gt;grid&lt;/code&gt;和&lt;code&gt;repeat&lt;/code&gt;语法来做这个。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;In the next example, I will use the &lt;code&gt;repeat&lt;/code&gt; syntax to create as many 200-pixel columns as will fit in our container. I am using the &lt;code&gt;repeat&lt;/code&gt;syntax for the track listing, with a keyword value of &lt;code&gt;auto-fill&lt;/code&gt; and then the size that I want the repeated tracks to be.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在下面例子中，我将使用&lt;code&gt;repeat&lt;/code&gt;语法来创建很多200像素的列来填入我们的容器。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;(At the time of writing, this was not implemented in Chrome, but works in Firefox Developer Edition.)&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在写文章的时候 Chrome 不支持，但是在 Firefx 的开发者版本中有效。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;Pzbzze&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Grid: As many 200 pixel tracks as will fit&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/Pzbzze/&quot;&gt;Grid: As many 200 pixel tracks as will fit&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;We can go a step further than that and combine fraction units and an absolute width to tell the grid to create as many 200-pixel tracks as will fit in the container and to distribute the remainder equally.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们可以更远的一步，结合fr 单位和绝对宽度来告诉网格创建很多200像素的轨道填充容器同时平均分配剩下的空间。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;EyNyNK&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Grid: As many 200 pixel tracks as will fit, distribute remain space evenly&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/EyNyNK/&quot;&gt;Grid: As many 200 pixel tracks as will fit, distribute remain space evenly&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;In this way, we get the benefits of a two-dimensional layout but still have flexible quantities of tracks — all without using any media queries. What we also see here is the grid and flexbox specifications diverging. Where flexbox ends with distributing items in one dimension, grid is just getting started.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在这种方式下，我们既得到了二维布局的好处同时依旧拥有弹性的轨道——所有的这些都没有使用任何的媒体查询。同时我们还看到grid he flexbox 规格的区别。flexbox 在一维上以分配项目而结束，grid 则是刚刚开始。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;A-SEPARATION-OF-SOURCE-ORDER-AND-VISUAL-DISPLAY&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#A-SEPARATION-OF-SOURCE-ORDER-AND-VISUAL-DISPLAY&quot; aria-label=&quot;A SEPARATION OF SOURCE ORDER AND VISUAL DISPLAY permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A SEPARATION OF SOURCE ORDER AND VISUAL DISPLAY&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;With flexbox, we can’t do a lot in terms of positioning our flex items. We can choose the direction in which they flow, by setting &lt;code&gt;flex-direction&lt;/code&gt;to &lt;code&gt;row&lt;/code&gt;, &lt;code&gt;row-reverse&lt;/code&gt; or &lt;code&gt;column&lt;/code&gt;, &lt;code&gt;column-reverse&lt;/code&gt;, and we can set an order, which controls the visual order in which the items display.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在 flexbox 在 flex项的定位上不能做太多的声明。我们可以通过设置&lt;code&gt;flex-direction&lt;/code&gt;成&lt;code&gt;row&lt;/code&gt;，&lt;code&gt;row-reverse&lt;/code&gt;或者&lt;code&gt;column&lt;/code&gt;，&lt;code&gt;column-reverse&lt;/code&gt;，并且我们可以设置顺序，控制他们在视觉上的呈现顺序。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;YWpWVE&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Flexbox: order&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/YWpWVE/&quot;&gt;Flexbox: order&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;With grid layouts, we get to properly position child items onto the grid we have defined. In most of the examples above, we have been relying on grid auto-placement, the rules that define how items we have not positioned are laid out. In the example below, I am using line-based positioning to position the items on the grid.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在网格布局中，我们实现了网格中子项的正确定位。在上面大多数的例子中，我们依赖网格的自动布局，这个规则是如何定义我们没有定位的项的我们并没有展开。在下面的例子中，我使用基于行的定位来定位网格中的项。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;The &lt;code&gt;grid-column&lt;/code&gt; and &lt;code&gt;grid-row&lt;/code&gt; properties are a shorthand for &lt;code&gt;grid-column-start&lt;/code&gt;, &lt;code&gt;grid-row-start&lt;/code&gt;, &lt;code&gt;grid-column-end&lt;/code&gt; and &lt;code&gt;grid-row-end&lt;/code&gt;. The value before the &lt;code&gt;/&lt;/code&gt; is the line that the content starts on, while the value after is the line it ends on.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;grid-colum&lt;/code&gt; 和 &lt;code&gt;grid-row&lt;/code&gt; 属性是 &lt;code&gt;grid-column-start&lt;/code&gt;，&lt;code&gt;grid-row-start&lt;/code&gt;，&lt;code&gt;grid-column-end&lt;/code&gt; 和 &lt;code&gt;grid-row-end&lt;/code&gt; 的简写形式。&lt;code&gt;/&lt;/code&gt;前面的值是线中内容开始的地方，后面的值是线结束的地方。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;rLWLwO&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Grid: line-based positioning&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/rLWLwO/&quot;&gt;Grid: line-based positioning&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;You can also name your lines. This happens when you create your grid on the grid container. Name the lines in brackets, and then position the items as before but using the names instead of the line index.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你也可以命名你的线。当你在 gird 容器中创建你的网格时会发生。在方括号中给线命名，然后想之前一样定位项，但是使用名字而不是线的索引。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;aZBZEB&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Grid: line-based positioning, named lines&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/aZBZEB/&quot;&gt;Grid: line-based positioning, named lines&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;
&lt;p class=&quot;para&quot;&gt;You can have multiple lines with the same name, and then target them by line name and index.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你可以有很多重名的线，然后通过线的名字和索引指向它们。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;You can use a span keyword, spanning a number of lines or, for example, to the third line named col. This type of positioning is useful for creating components that sit in various places in the layout. In the example below, I want some elements to span six column tracks and others to span three. I am using auto-placement to lay out the items, but when the grid encounters an item with a class of wide, the start value will be auto and the end value will be span 2; so, it will start on the line it would normally start on based on the auto-placement rules, but span two lines.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你可以使用一个 &lt;code&gt;span&lt;/code&gt; 关键字，来跨过一定数量的线，比如，第三条线名字叫做 col，这种类型的定位用来创建在布局中不同地方的组件是十分有用的。在下面的例子中，我希望一些元素横跨六列轨道其他的元素横跨三列。我使用自动布局来放置项，但是当网格遇到一个带有 &lt;code&gt;wide&lt;/code&gt; 类的项时，开始的值将会变成自 &lt;code&gt;auto&lt;/code&gt;，并且结束值将会是 &lt;code&gt;span2&lt;/code&gt;。所以它会基于自动布局从线的起点开始，但是横跨两条线。&lt;/p&gt;
&lt;p data-height=&quot;265&quot; data-theme-id=&quot;light&quot; data-slug-hash=&quot;LZbZdj&quot; data-default-tab=&quot;result&quot; data-user=&quot;rachelandrew&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;Grid: multiple lines with the same name&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;http://codepen.io/rachelandrew/pen/LZbZdj/&quot;&gt;Grid: multiple lines with the same name&lt;/a&gt; by rachelandrew (&lt;a href=&quot;http://codepen.io/rachelandrew&quot;&gt;@rachelandrew&lt;/a&gt;) on &lt;a href=&quot;http://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&quot;https://production-assets.codepen.io/assets/embed/ei.js&quot;&gt;&lt;/script&gt;</content:encoded></item><item><title><![CDATA[使用 React-Router 创建单页应用]]></title><description><![CDATA[最近业余时间在学习 React，配合 Redux 和 React-Router 正在不紧不慢地开发一个小工具moviemaster，用于管理硬盘中的电影剧集。在单页应用开发中，redux 并不是必须的，所以今天只讲讲 前端的路由系统以及 React-Router的简单使用。 什…]]></description><link>https://zhanglun.github.io/blogs/2016-10-30-使用-React-Router-创建单页应用/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2016-10-30-使用-React-Router-创建单页应用/</guid><pubDate>Sun, 30 Oct 2016 10:55:34 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;最近业余时间在学习 React，配合 Redux 和 React-Router 正在不紧不慢地开发一个小工具&lt;a href=&quot;https://github.com/zhanglun/moviemaster&quot; class=&quot;link-underline&quot;&gt;moviemaster&lt;/a&gt;，用于管理硬盘中的电影剧集。在单页应用开发中，redux 并不是必须的，所以今天只讲讲 前端的路由系统以及 React-Router的简单使用。&lt;/p&gt;
&lt;!--more--&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;什么是路由&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%80%E4%B9%88%E6%98%AF%E8%B7%AF%E7%94%B1&quot; aria-label=&quot;什么是路由 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;什么是路由&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;以下来自维基百科：：&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;路由（routing）就是通过互联的网络把信息从源地址传输到目的地址的活动。路由发生在OSI网络参考模型中的第三层即网路层。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;路由引导分组转送，经过一些中间的节点后，到它们最后的目的地。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这是网络工程中的术语，对大家而言，最熟悉的应该就是家里的路由器。路由是指路由器从一个接口上收到数据包，根据数据包的目的地址进行定向并转发到另一个接口的过程。放在 Web 上来说，url 就像是路由器中的路由表，每个 url 对应不同的页面或者内容，就像路由表中的的 IP 对应不同的网络一样。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;先来看一下熟悉的套路：&lt;/p&gt;
&lt;!-- ![image_1b0a1gh7ge4u1g9l14mm7v41me9a.png](http://7xnrrd.com1.z0.glb.clouddn.com/e4199599d78057a8efacb848ab9b5927.png) --&gt;
&lt;p class=&quot;para&quot;&gt;在传统的网页应用架构中，客户端只是一个展示层，通过 url 访问服务端，服务端则根据自己的“路由表”将对应的页面分发给客户端。但是在这种模式下，ajax 异步加载的内容是无法通过url 记录的。无论你在页面上操作了多少，异步请求了多少数据，在每次重新访问同一个 url 时，服务端返回给客户端的内容都是一模一样。&lt;/p&gt;
&lt;!--![image_1b0a24tg94le1p03qa76br1apfg.png](http://7xnrrd.com1.z0.glb.clouddn.com/6ed2cf502e487c30c3640a2026071f87.png) --&gt;
&lt;p class=&quot;para&quot;&gt;如果前端有自己专属的“路由表”来分发页面上不同的状态，那不就行了？&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Hash-和-pushState&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Hash-%E5%92%8C-pushState&quot; aria-label=&quot;Hash 和 pushState permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Hash 和 pushState&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;据我所知，目前有两种方式可以构建出前端的路由系统：url 中的#和 HTML5中的 history API。其原理如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;阻止标签的默认跳转动作。&lt;/li&gt;
&lt;li&gt;ajax或者 Fetch 请求内容。&lt;/li&gt;
&lt;li&gt;将返回的内容添加到页面中。&lt;/li&gt;
&lt;li&gt;使用 hash 或者 pushState 修改 url。&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;经典的-Hash&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%8F%E5%85%B8%E7%9A%84-Hash&quot; aria-label=&quot;经典的 Hash permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;经典的 Hash&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;#代表网页中的一个位置。后面接着的字符，就是该位置的标识符。比如，&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;https://zhanglun.github.io/index.html#body&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;就代表网页 index.html 的 body 位置。浏览器读取这个 URL 后，会自动将body位置滚动至可视区域。标识符的指定有两个方法。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;使用锚点&lt;/li&gt;
&lt;/ol&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;a name=&amp;quot;body&amp;quot;&amp;gt;&amp;lt;/a&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;使用id属性&lt;/li&gt;
&lt;/ol&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;div id=&amp;quot;body&amp;quot; &amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;#是用来指向文档的内容，属于浏览器的行为，与服务端无关，在 HTTP请求中也不会携带 #及其后面的内容，对于服务端而言 &lt;a href=&quot;http://www.baidu.com&quot; class=&quot;link-underline&quot;&gt;http://www.baidu.com&lt;/a&gt; 和 &lt;a href=&quot;http://www.baidu.com#action=fuckbaidu&quot; class=&quot;link-underline&quot;&gt;http://www.baidu.com#action=fuckbaidu&lt;/a&gt; 返回给客户端的都是前者所分发的内容，但是在浏览器中可以通过 Window 对象上的 &lt;code&gt;location.hash&lt;/code&gt; 进行操作。因此，在浏览器中可以通过 hash 来记录页面的状态，构建“路由表”。当页面状态发生变化时，hash 相应变化，重新加载时又可以通过 url 中携带的 hash 直接将页面设置到对应的状态。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;比如：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;http://www.example.com/
http://www.examplt.com/#edit
http://www.examplt.com/#settings&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ol&gt;
&lt;li&gt;访问&lt;code&gt;/&lt;/code&gt;时，呈现主页。&lt;/li&gt;
&lt;li&gt;点击页面上的&lt;code&gt;Edit&lt;/code&gt;按钮，页面呈现编辑对应的内容。通过 url 直接访问时，检查 hash 是否和 &lt;code&gt;edit&lt;/code&gt; 匹配，如果匹配执行加载编辑内容的代码&lt;/li&gt;
&lt;li&gt;点击页面上的&lt;code&gt;Settings&lt;/code&gt;按钮，页面呈现设置对应的内容。通过 url 直接访问时，检查 hash 是否和 &lt;code&gt;settings&lt;/code&gt; 匹配，如果匹配执行加载编辑内容的代码。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;以下是伪代码：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;  function hashHandler () {
    let key = location.hash.slice(1);
    switch(key) {
      case &amp;#39;edit&amp;#39;:
        renderEditPanel();
        break;
      case &amp;#39;settings&amp;#39;:
        renderSettings();
        break;
       default:
        break;
    }
  }
  window.onload = () =&amp;gt; {
    hashHandler();
  }
  window.onhashchange = () =&amp;gt; {
    hashHandler();
  }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;HTML5-中的-pushState&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#HTML5-%E4%B8%AD%E7%9A%84-pushState&quot; aria-label=&quot;HTML5 中的 pushState permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;HTML5 中的 pushState&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;pushState是 History API中的一个方法，其文档可以看这里 &lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/DOM/Manipulating_the_browser_history&quot; class=&quot;link-underline&quot;&gt;MDN History&lt;/a&gt;。它的功能简单的说就是：修改 url，添加历史记录。比如&lt;code&gt;/blogs&lt;/code&gt;和&lt;code&gt;settings&lt;/code&gt;对应的是两个页面，如果只是在页面上点击标签切换，需要做的操作只有：发送请求修改页面内容和调用 pushState 方法修改 url。问题来了，对于前端而言需要将其视为同一个页面，但实际上这两个 url 对于服务端来说是两个不同的请求，所以这里需要服务端的配合。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我的做法是：对应的url 返回的都是同一个页面，然后浏览器接受之后检查前端定义路由系统，执行响应的代码。这个方法可能会造成页面平白添加一个短暂的延迟，不过影响不是很大。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;React-Router的使用&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#React-Router%E7%9A%84%E4%BD%BF%E7%94%A8&quot; aria-label=&quot;React Router的使用 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;React-Router的使用&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;目前来说，任何一个路由系统库或者框架，虽说是写法不一，但是都是在上述两种方式的基础上实现的。让我觉得耳目一新的是：使用路由嵌套的概念来定义 view 的嵌套集合，当一个给定的 URL 被调用时，整个集合中（命中的部分）都会被渲染。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;import React from &amp;#39;react&amp;#39;;
import { render } from &amp;#39;react-dom&amp;#39;;
import { Router, Route, IndexRoute, hashHistory } from &amp;#39;react-router&amp;#39;;

import App from &amp;#39;./containers/App&amp;#39;;
import MovieContainer from &amp;#39;./containers/Movies&amp;#39;;
import Detail from &amp;#39;./containers/Detail&amp;#39;;


let rootElement = document.getElementById(&amp;#39;app&amp;#39;);
render(
  &amp;lt;Router&amp;gt;
    &amp;lt;Route path=&amp;quot;/&amp;quot; component={App}&amp;gt;
      &amp;lt;Route path=&amp;quot;about&amp;quot; component={About} /&amp;gt;
      &amp;lt;Route path=&amp;quot;inbox&amp;quot; component={Inbox}&amp;gt;
        &amp;lt;Route path=&amp;quot;messages/:id&amp;quot; component={Message} /&amp;gt;
      &amp;lt;/Route&amp;gt;
    &amp;lt;/Route&amp;gt;
  &amp;lt;/Router&amp;gt;,
rootElement);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在入口文件中，引入 React-Router，以组件的形式在 render 中使用，上述代码配置结果如下：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;URL&lt;/th&gt;
&lt;th&gt;组件&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;/&lt;/td&gt;
&lt;td&gt;App&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/about&lt;/td&gt;
&lt;td&gt;App -&gt; About&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/inbox&lt;/td&gt;
&lt;td&gt;App -&gt; Inbox&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/inbox/messages/:id&lt;/td&gt;
&lt;td&gt;App -&gt; Inbox -&gt; Message&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;在路由中，组件对应设置的子组件可以通过 &lt;code&gt;this.props.children&lt;/code&gt; 渲染在父组件中&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;class App extend Component {
  constructor(props) {
    super(props)
  }
  render() {
    &amp;lt;div id=&amp;quot;app&amp;quot;&amp;gt;
      &amp;lt;h1&amp;gt;Hello, world!&amp;lt;/h1&amp;gt;
      {this.props.children}
    &amp;lt;/div&amp;gt;
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当 URL 为 / 时， App 中并没有渲染任何的组件，render 中的 this.props.children 还是 undefined。此时可以使用 &lt;code&gt;IndexRoute&lt;/code&gt; 来设置一个默认页面。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;render(
  &amp;lt;Router&amp;gt;
    &amp;lt;Route path=&amp;quot;/&amp;quot; component={App}&amp;gt;
      {/* 当 url 为/时渲染 Welcome */}
      &amp;lt;IndexRoute component={Welcome} /&amp;gt;
      &amp;lt;Route path=&amp;quot;about&amp;quot; component={About} /&amp;gt;
      &amp;lt;Route path=&amp;quot;inbox&amp;quot; component={Inbox}&amp;gt;
        &amp;lt;Route path=&amp;quot;messages/:id&amp;quot; component={Message} /&amp;gt;
      &amp;lt;/Route&amp;gt;
    &amp;lt;/Route&amp;gt;
  &amp;lt;/Router&amp;gt;,
rootElement);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;URL&lt;/th&gt;
&lt;th&gt;组件&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;/&lt;/td&gt;
&lt;td&gt;App -&gt; Welcome&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/about&lt;/td&gt;
&lt;td&gt;App -&gt; About&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/inbox&lt;/td&gt;
&lt;td&gt;App -&gt; Inbox&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/inbox/messages/:id&lt;/td&gt;
&lt;td&gt;App -&gt; Inbox -&gt; Message&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;看一下这一段代码&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;Route path=&amp;quot;posts&amp;quot; component={Post}&amp;gt;
  &amp;lt;Route path=&amp;quot;users/:userid&amp;quot; component={User}&amp;gt;
    &amp;lt;Route path=&amp;quot;messages/:messageid&amp;quot; component={Message} /&amp;gt;
  &amp;lt;/Route&amp;gt;
&amp;lt;/Route&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;此时匹配的路由分别是：&lt;code&gt;/posts&lt;/code&gt;，&lt;code&gt;/posts/usres/:userid&lt;/code&gt; 和&lt;code&gt;/posts/users/:userid/messages/:messageid&lt;/code&gt;，可以看出，嵌套的&lt;code&gt;&amp;#x3C;Route&gt;&lt;/code&gt;所匹配的 url是包裹着它的 &lt;code&gt;&amp;#x3C;Route&gt;&lt;/code&gt;的 path “之和”。但是问题又来了，嵌套的好处在于路由之间结构清晰直观，但是也会导致 url 的不美观，试想&lt;code&gt;/posts/users/:userid/messages/:messageid&lt;/code&gt;这么长的路由也是着实让人心累。React-Router 的配置提供了一个选择：将 Route 的 path 设置成绝对路径。同时可以使用&lt;code&gt;&amp;#x3C;Redirect/&gt;&lt;/code&gt; 将修改为绝对路径的路由重定向到之前的设置&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;Route path=&amp;quot;posts&amp;quot; component={Inbox}&amp;gt;
  &amp;lt;Route path=&amp;quot;/users/:userid&amp;quot; component={Message}&amp;gt;
    &amp;lt;Route path=&amp;quot;/messages/:messageid&amp;quot; component={Message} /&amp;gt;
  &amp;lt;/Route&amp;gt;
&amp;lt;/Route&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;URL&lt;/th&gt;
&lt;th&gt;组件&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;/posts&lt;/td&gt;
&lt;td&gt;App -&gt; Post&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/user/:userid&lt;/td&gt;
&lt;td&gt;App -&gt; Post -&gt; User&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/messages/:messageid&lt;/td&gt;
&lt;td&gt;App -&gt; Post -&gt; User -&gt;Message&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;基础的配置完成之后，通过 &lt;code&gt;&amp;#x3C;Link&gt;&lt;/code&gt;自动或者通过&lt;code&gt;browserHistory&lt;/code&gt;和&lt;code&gt;hashHistory&lt;/code&gt;手动执行路由的跳转。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[实现一个稍微复杂的simplelist]]></title><description><![CDATA[使用过一些清单类的应用程序，像 WunderList, Google Keep等，用来记录一些计划和安排，也试着将自己的计划安排同笔记一起整理在 Evernote 中，但是无论哪种方式用起来总觉得少了点什么，如果两者的一些功能能够结合起来，就很完美了。 “todo”和“note…]]></description><link>https://zhanglun.github.io/blogs/2016-09-25-实现一个稍微复杂的simplelist/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2016-09-25-实现一个稍微复杂的simplelist/</guid><pubDate>Sun, 25 Sep 2016 18:40:45 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;使用过一些清单类的应用程序，像 WunderList, Google Keep等，用来记录一些计划和安排，也试着将自己的计划安排同笔记一起整理在 Evernote 中，但是无论哪种方式用起来总觉得少了点什么，如果两者的一些功能能够结合起来，就很完美了。&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;“todo”和“note”之间的关系本来就很微妙，一个“todo”写得详细点不就成了“note”吗？于是自己写了一个稍微复杂一点的清单程序，今天将项目总结整理在此。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我试着将 todo和 note 结合，可以像 WunderList 一样记录计划，又可以 Evernote 一样管理笔记。在开发过程中，反复调整和修改，最终发现：其实我只是做了一个支持 markdown 的 简易版WunderList :(。不管怎么样，能坚持下来就是值得鼓励的。整个工程前后端分离，后端实现不在此介绍&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://github.com/zhanglun/bluerobin&quot; class=&quot;link-underline&quot;&gt;前端代码地址&lt;/a&gt;，
&lt;a href=&quot;https://github.com/zhanglun/dockersite&quot; class=&quot;link-underline&quot;&gt;后端代码地址&lt;/a&gt;，
&lt;a href=&quot;http://zhanglun.github.io/bluerobin/&quot; class=&quot;link-underline&quot;&gt;在线预览&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;接下来，我简单介绍一下 simplelist 的前端实现过程。&lt;strong&gt;注意，下面介绍的一些过程不是一蹴而就，是反复修改和整理得出的，比如技术选择和组件的划分。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;编写代码的前期准备工作&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81%E7%9A%84%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C&quot; aria-label=&quot;编写代码的前期准备工作 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;编写代码的前期准备工作&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;有三点&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;确定需要实现的功能&lt;/li&gt;
&lt;li&gt;确定界面&lt;/li&gt;
&lt;li&gt;确定技术实现的方案&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;功能和界面先放一边，介绍一下采用的技术方案。其实也没啥可介绍的，前端老司机花样多，但是主流的套路也就那么几种，我选择“套路のVue”。Vue+ Vuex+ Vue-Router，其他配件像 Less，Webpack等大家也应该都清楚。用户登陆注册及接口的实现不在本文章的讨论中，下次再讲。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;组件划分很关键&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%84%E4%BB%B6%E5%88%92%E5%88%86%E5%BE%88%E5%85%B3%E9%94%AE&quot; aria-label=&quot;组件划分很关键 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;组件划分很关键&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在 React 的组件化的划分方式中，将组件分成两种：Container Components和Presentational Components，容器组件和 UI组件。&lt;strong&gt;容器组件负责数据和业务逻辑的处理，携带相关的内部状态，与数据有频繁的交互， UI组件只负责 UI 的呈现，没有任何的数据和逻辑的处理，组件的数据从容器组件传递进来（在 React中数据由 this.props 提供）&lt;/strong&gt;。如果一个组件既有 UI 又有业务逻辑，可以试着将它拆分成两个：一个容器组件，包着一个UI 组件。前者负责与外部的通信，将数据传给后者，由后者渲染出视图。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;个人比较喜欢这种方式，组件变得纯粹。不过似乎在 Vue 生态圈中没有设计这方面的介绍，在后面我打算尝试使用这种方式，不过现在还是使用相对粗暴一点的方式来划分。&lt;/p&gt;
&lt;!--![clipboard.png](http://7xnrrd.com1.z0.glb.clouddn.com/69e6d8817e6736eca54a1c4de7605c6a.png) --&gt;
&lt;p class=&quot;para&quot;&gt;这是 WunderList 的界面，简单的分析之后，可以将其划分成如下形式，再详细一点的话可以看下图，如果坚持容器组件和 UI组件的形式开发的话，相对较复杂一点，而我选择先从简单的入手。想必你应该看过&lt;a href=&quot;http://todomvc.com/&quot; class=&quot;link-underline&quot;&gt;TodoMVC&lt;/a&gt;，而这样也是simplelist 的最简单也是最核心的功能。所以在实际操作过程中，我先将输入框和单个任务这两个组件实现。&lt;/p&gt;
&lt;!--![clipboard.png](http://7xnrrd.com1.z0.glb.clouddn.com/523fa36927e62c3405235fec5e256b2b.png) --&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Vuex&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Vuex&quot; aria-label=&quot;Vuex permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Vuex&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;Vuex 是一个专门为 Vue.js 应用所设计的集中式状态管理架构。它借鉴了 Flux 和 Redux 的设计思想，但简化了概念，并且采用了一种为能更好发挥 Vue.js 数据响应机制而专门设计的实现。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在单独使用 Vue.js 的时候，通常会把状态储存在组件的内部。整个应用的数据和状态都是散落在各个组件。这样并没有有什么问题，组件的数据组建自己管理。有时候状态的一部分需要共享给其他的组件，此时使用事件系统，让一个组件把一些状态“发送”到其他组件，但是当项目一步步扩大时，事件流将变得繁杂，不利于调试和维护。此时 Vuex 可以帮助我们实现状态的管理。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Vuex 的四个核心概念分别是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The state tree：Vuex 使用单一状态树，用一个对象就包含了全部的应用层级状态，作为一个『唯一数据源(SSOT)』而存在。每个应用将仅仅包含一个 store 实例。单状态树让我们能够直接地定位任一特定的状态片段，在调试的过程中也能轻易地取得整个当前应用状态的快照。数据流都是单向的。&lt;/li&gt;
&lt;li&gt;Getters：用来从 store 获取 Vue 组件数据。&lt;/li&gt;
&lt;li&gt;Mutators：事件处理器用来驱动状态的变化，只有 mutation 可以改变状态。&lt;/li&gt;
&lt;li&gt;Actions：可以给组件使用的函数，用来派发 Mutation。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;Vuex 规定，属于应用层级的状态只能通过 Mutation 中的方法来修改，而派发 Mutation 中的事件只能通过 action。从组件出发，组件中调用 action，在 action 这一层级我们可以和后台数据交互，比如获取初始化的数据源，或者中间数据的过滤等。然后在 action 中去派发 Mutation。Mutation 去触发状态的改变，状态的改变，将触发视图的更新。&lt;/p&gt;
&lt;!--![clipboard.png](http://7xnrrd.com1.z0.glb.clouddn.com/6c8f34ec28ec5c0492af7c23fafe7b58.png) --&gt;
&lt;p class=&quot;para&quot;&gt;配合 Vuex 这样的数据管理架构，我只需要关心组件的状态变化，数据的变化和流通全部交给 Vuex。我需要维护一个数组，数组中每一个元素代表一个任务，输入框和任务上的编辑删除等操作，本质上都是对一个数组的操作。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;给任务加上分类&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%99%E4%BB%BB%E5%8A%A1%E5%8A%A0%E4%B8%8A%E5%88%86%E7%B1%BB&quot; aria-label=&quot;给任务加上分类 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;给任务加上分类&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;我已经说过了，我要做的是复杂的 simplelist。所以，在完成了最简单的增删改的功能之后，要加上任务的自己的归属了。每个任务都归属于一个清单，有唯一的清单 id（list_id）。就像 WunderList 一样，左侧清单列表，右侧任务列表。这时候需要用到单页引用中必不可少的路由装置了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;从简单的开始，除了登录和注册（目前整合在应用中，更好的做法应该是登录注册作为两个单独的页面，这里只是个人 demo，暂不考虑），暂且只有一种路由状态，用来指向对应的清单，例如：&lt;code&gt;/lists/:id&lt;/code&gt;。&lt;strong&gt;下面是伪代码&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;div id=&amp;quot;app&amp;quot;&amp;gt;
  &amp;lt;router-view&amp;gt;&amp;lt;/router-view&amp;gt;
&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;const ListItem =  {
  template: `&amp;lt;div class=&amp;quot;item&amp;quot;&amp;gt;{{item.title}}&amp;lt;/div&amp;gt;`,
	props: [&amp;#39;item&amp;#39;],
}
const ListContainer = {
  template: `&amp;lt;div class=&amp;quot;list&amp;quot;&amp;gt;
      &amp;lt;h2&amp;gt;List {{ $route.params.id }}&amp;lt;/h2&amp;gt;
		&amp;lt;div class=&amp;quot;item-list&amp;quot;&amp;gt;
			&amp;lt;list-item v-for=&amp;quot;item in list&amp;quot; :item=&amp;#39;item&amp;#39;&amp;gt;&amp;lt;/list-item&amp;gt; 
		&amp;lt;/div&amp;gt;
    &amp;lt;/div&amp;gt;`,
	components: {
		&amp;#39;list-item&amp;#39;: ListItem,
	},
}

const router = new VueRouter({
  routes: [
    { path: &amp;#39;/lists/:id&amp;#39;, component: ListContainer }
  ]
})&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;然后绑定好 &lt;code&gt;&amp;#x3C;router-link&gt;&lt;/code&gt;，路由切换就算完成了。但是光这样还不行，最关键的清单数据管理还没有加上。其实清单的数据状态管理与任务的管理大同小异，就不在此复述，你可以试着捋一捋。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;弹层组件的管理&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%BC%B9%E5%B1%82%E7%BB%84%E4%BB%B6%E7%9A%84%E7%AE%A1%E7%90%86&quot; aria-label=&quot;弹层组件的管理 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;弹层组件的管理&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在创建和编辑清单的时候，需要弹出一个 modal 来方便操作（参照 WunderList）。这个时候就涉及到一个问题：这种定位不是很清晰的模块，该怎么来管理？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在我看来，这种类型模块大致有两类，一类是全局共享，可能在很多不同的组件中都需要调用，这种全局的我认为可以单独拿出来放在同一个地方供应用调用。另一类是只属于某一个组件，只会在固定的组件中被调用，这类模块推荐直接写在组件中，方便管理，最好是写在顶级组件中，避免一些全七八糟的样式冲突（目前我遇到的主要还是层叠顺序的问题）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;思路清晰之后，可以很顺利的完成清单的创建和编辑功能。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;说到这，一个复杂的 simplelist 的基本结构和功能已经出现了。那么问题来了，你学到了吗？&lt;/p&gt;</content:encoded></item><item><title><![CDATA[输入框插入表情的实现]]></title><description><![CDATA[在普通的 textarea 中，只能显示普通的文本。如果简单的输入文本，textarea 便足以胜任。但是实际情况往往要复杂得多。 简单版本的插入表情 常见的版本一般都是使用 textarea，然后表情使用某种约定的文本格式代替，比如“你好啊[微笑]”。在呈现的时候，通过固定的…]]></description><link>https://zhanglun.github.io/blogs/2016-08-13-输入框插入表情的实现/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2016-08-13-输入框插入表情的实现/</guid><pubDate>Sat, 13 Aug 2016 14:50:06 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;在普通的 textarea 中，只能显示普通的文本。如果简单的输入文本，textarea 便足以胜任。但是实际情况往往要复杂得多。&lt;/p&gt;
&lt;!--more--&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;简单版本的插入表情&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AE%80%E5%8D%95%E7%89%88%E6%9C%AC%E7%9A%84%E6%8F%92%E5%85%A5%E8%A1%A8%E6%83%85&quot; aria-label=&quot;简单版本的插入表情 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;简单版本的插入表情&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;常见的版本一般都是使用 textarea，然后表情使用某种约定的文本格式代替，比如“你好啊[微笑]”。在呈现的时候，通过固定的文本解析方法将内容中的表情文本替换成图片。新浪微博中发微博的输入框就是如此。但是，在这有一点需要注意，如果只是简单的在文本的最后插入表情之类的预定好的文本格式，只需获取到到 textarea 的 value 然后做加法即可。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let editor = document.querySelect(&amp;#39;#editor&amp;#39;);
editor.value += &amp;#39;[微笑]&amp;#39;;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;没你想的这么简单&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%B2%A1%E4%BD%A0%E6%83%B3%E7%9A%84%E8%BF%99%E4%B9%88%E7%AE%80%E5%8D%95&quot; aria-label=&quot;没你想的这么简单 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;没你想的这么简单&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;但实际情况却没有这么简单，因为用户可以自己选择光标的位置。当用户在某一段文本中间插入光标之后，可不是简单的加法了。在这种情况下，需要获取到光标所在位置，在这个位置上插入用来代替表情的文本，然后将光标设置到表情文本的后面。在这需要两个额外的方法：&lt;code&gt;getCaretPosition&lt;/code&gt;和 &lt;code&gt;setCaretPosition&lt;/code&gt; 。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;getCaretPositionsetCaretPosition&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#getCaretPositionsetCaretPosition&quot; aria-label=&quot;getCaretPositionsetCaretPosition permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;getCaretPosition/setCaretPosition&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;浏览器并没有提供直接获取光标位置的方法，需要我们变通的处理。浏览器基本上都支持文本框的&lt;code&gt;select()&lt;/code&gt;方法，这个方法用于选中文本框中所有的文本，但是只能乖乖的拿到返回的所有文本。HTML5 添加了两个属性：selectionStart 和 selectionEnd 帮助我们更加顺利地获取选择的文本。这两个属性中保存的是基于0的数值，表示所选择的文本的范围，分别表示文本选区（选中的文本）开头和结尾相对整个文本内容的偏移量（在整个文本内容中的位置）。例如：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let editor = document.querySelector(&amp;#39;#editor&amp;#39;);
// 从第一个字符开始，选中三个字符
editor.selectionStart = 0;
editor.selectionEnd = 1;

// 从第三个字符开始选中三个字符
editor.selectionStart = 2;
editor.selectionEnd = 5;
&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;说到这你可能要问了，这个光标有啥关系啊？别急，听我慢慢说。既然上述两个设置不同数字可以选择文本，那如果两个值设置成相同的数字，会怎么样呢？&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// 从第三个字符开始选中零个字符
editor.selectionStart = 2;
editor.selectionEnd = 2;
&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;起点和终点重合了！那么换个角度来描述就是：当我们在获取光标位置的时候，其实就是选中的文本范围起点和重点重合，相当于文本范围的起点偏移量其实就是光标所在的位置偏移量，所以此时&lt;code&gt;selectionStart&lt;/code&gt;的返回值就是我们需要的结果。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;更关键的是，当 End 和 Start 设置成相同值时，选区也是空的，起点和重点充电，就好像是设置了光标的位置。其实有一个简便的方法 &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/setSelectionRange&quot; class=&quot;link-underline&quot;&gt;setSelectionRange(start, end)&lt;/a&gt;，原理相同。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当然有兴趣你也可以试试 End小于 Start的情况。上述这些在现代浏览器和 IE9+ 上都支持。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;前端向来麻烦的还是浏览器的兼容问题。在低版本的 IE 中只能使用 &lt;code&gt;document.selection&lt;/code&gt; 对象来模拟光标定位了。&lt;code&gt;document.selection&lt;/code&gt; 只存在于 IE8 及更早的版本（可以使用 &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Window/getSelection&quot; class=&quot;link-underline&quot;&gt;window.getSelection&lt;/a&gt; 代替），保存着用户在整个文档范围内选择的文本信息，但是无法确定用户选择的是页面中哪个部位的文本。要想取得选择的文本，首先需要创建一个范围（Range，IE9+ 支持 DOM Range API，但是 IE8及之前的版本不支持，但是有类似的概念，text range。这是 IE 专有的特性）。可使用 &lt;code&gt;document.selection.createTextRange&lt;/code&gt; 来创建我们所需要的 text range。然后利用&lt;a href=&quot;https://msdn.microsoft.com/en-us/library/ms536623(v=vs.85).aspx&quot; class=&quot;link-underline&quot;&gt;moveStart()&lt;/a&gt;将文本的范围的起点从当前位置（当前位置起点和重点是重合的）移动到文本的开头，然后计算选中文本的长度，这个长度值可以用来代替当前光标的位置。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let range = document.selection.createRange();
range.moveStart(&amp;quot;character&amp;quot;, editor.value.length);
cursurPosition = range.text.length;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;设置光标位置思路类似，但是代码稍有不同：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;let range = editor.createTextRange();
range.collapse(true);
range.moveEnd(&amp;#39;character&amp;#39;, pos);
range.moveStart(&amp;#39;character&amp;#39;, pos);
range.select();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;总的来说，在 textarea 中获取和设置光标位置还是蛮简单的。讲到这里了，我想插入表情应该是很轻松的一件事情了&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;获取光标位置（文本范围前后重叠） -&amp;gt; 修改文本范围（或者手动拼接） -&amp;gt; 重新设置光标位置 &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;至此，表情插入功能的基本实现。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;还没结束&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%BF%98%E6%B2%A1%E7%BB%93%E6%9D%9F&quot; aria-label=&quot;还没结束 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;还没结束&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;上述例子中，在输入框中表情只能以文本的形式呈现。如果想在输入框中呈现输入的表情，该怎么办呢？使用 contenteditable 属性为 true 的容器代替 textarea 是必须的，因为 textarea 中只能显示文本。但是这就足够了吗？不，显然不够。没有了 textarea 则以为这没有了 setSelectionRange, selectionStart 和 selectionEnd。但是好在原理也是类似，依旧使用 Range API 或者 Text Range(IE8及其更低版本)。具体的可以参考这篇：&lt;a href=&quot;https://segmentfault.com/a/1190000005869372&quot; class=&quot;link-underline&quot;&gt;html元素contenteditable属性如何定位光标和设置光标&lt;/a&gt;和这篇&lt;a href=&quot;http://www.xiaomlove.com/2015/10/14/%E5%9C%A8%E5%8F%AF%E7%BC%96%E8%BE%91%E7%9A%84div%E4%B8%AD%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87/&quot; class=&quot;link-underline&quot;&gt;在可编辑的div中插入图片&lt;/a&gt;。 具体实现代码我就不贴了，大家可以自己思考捋一捋。举一反三，如果你真真正正地知道如何正确插入图片，那么插入复杂的 DOM 结构对你来说也是轻而易举。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Electron 开发的 gulp 配置]]></title><description><![CDATA[源自 Atom-shell 的 Electron 目前是一个很火的项目。已经有很多开发者基于 Electron 开发出了各种各样的桌面程序。在我看来，对于广大前端开发者来说，最为耳熟能详的应该是 Atom 和 VS Code。在 Electron 的官网上能够看到更多有意思的项…]]></description><link>https://zhanglun.github.io/blogs/2016-08-05-Electron 开发的 gulp 配置/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2016-08-05-Electron 开发的 gulp 配置/</guid><pubDate>Fri, 05 Aug 2016 16:30:38 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;源自 Atom-shell 的 Electron 目前是一个很火的项目。已经有很多开发者基于 Electron 开发出了各种各样的桌面程序。在我看来，对于广大前端开发者来说，最为耳熟能详的应该是 Atom 和 VS Code。在 &lt;a href=&quot;http://electron.atom.io/apps/&quot; class=&quot;link-underline&quot;&gt;Electron 的官网&lt;/a&gt;上能够看到更多有意思的项目。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;之前提到过，我的计划之一就是玩一下 Electron，打造一个桌面工具。上个星期经过几次摸索和调研确定了这个项目的可行性之后，开始着手打造。近几天慢慢的构建出基础的项目前端结构。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;对于前端的技术选型已经没有之前那么纠结了，思考过后决定了：React。原因很简单，之前的一个小项目用的是 Vuejs 的一套体系，这次想换换口味。虽然之前我一直很不喜欢 React 那种模板和逻辑混合在一起的方式，但是很喜欢 Redux 的处理方式，所以忍不住试试看，到底是用 React 爽还是 Vue 爽。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;了解过 Electron 的应该都知道它的 main process 和 renderer process。main process 使用 BroswerWindow 实例创建 web page，每个 BroswerWindow 实例在它自己的 renderer process 中运行 web page，每当 BroswerWindow 实例被销毁时，其对应的 renderer process 也会被终止。main process 管理所有的 web  page 及其对应的 renderer process 。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我觉得可以这么简单地理解的：如果将 renderer process 负责管理渲染的 web 页面所做的事情和浏览器类似，那么 main process 则是包裹着这个“浏览器”的外壳，将“浏览器”中的代码与系统底层联系在一起。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在实践过程中，我发现 main process 的文件不能使用 import（应该说是无法使用 ES6 语法），可以使用 babel 将使用 ES6 语法的代码编译成可执行的版本代码。而 renderer process 的代码则通过 webpack 打包 React 代码。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;gulp-babel-编译-main-process-代码&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#gulp-babel-%E7%BC%96%E8%AF%91-main-process-%E4%BB%A3%E7%A0%81&quot; aria-label=&quot;gulp babel 编译 main process 代码 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;gulp-babel 编译 main process 代码&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;通过 gulp 和 babel 可以很轻松地完成&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var path = require(&amp;#39;path&amp;#39;);
var gulp = require(&amp;#39;gulp&amp;#39;);
var babel = require(&amp;quot;gulp-babel&amp;quot;);

var ROOT_PATH = path.resolve(__dirname);
var APP_PATH = path.resolve(ROOT_PATH, &amp;#39;app&amp;#39;);

// main process 的编译
gulp.task(&amp;#39;babel:electron-main&amp;#39;, function () {
  return gulp.src([APP_PATH + &amp;#39;/main.js&amp;#39;, APP_PATH + &amp;#39;/main/**/*.js&amp;#39;], { base: APP_PATH })
    .pipe(babel())
    .pipe(gulp.dest(&amp;#39;dist&amp;#39;));
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;gulp 与 babel 的配合使用的更多细节可以参考 &lt;a href=&quot;https://babeljs.io/docs/setup/&quot; class=&quot;link-underline&quot;&gt;babel&lt;/a&gt; 和 &lt;a href=&quot;https://github.com/babel/gulp-babel&quot; class=&quot;link-underline&quot;&gt;gulp-babel&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;React 的 webpack 配置在这里我就不重复了，到处都能找到。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;process-的重启和刷新&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#process-%E7%9A%84%E9%87%8D%E5%90%AF%E5%92%8C%E5%88%B7%E6%96%B0&quot; aria-label=&quot;process 的重启和刷新 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;process 的重启和刷新&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;我发现在目前市面上Electron 的相关基础教程中，简单的介绍都是如此：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// 安装 
npm install -g electron-prebuilt
// 启动
electron .

//更好一点的是按照官方给出的 quick start
npm start&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;但是这样有一个很直接的问题：每次修改 main process 相关代码之后需要重启，修改了 renderer process 相关代码之后需要手动刷新，这很影响开发体验。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;renderer process 的 hot load 很好处理，和前端开发类似，react 和 vue 都有类似的工具，直接将前端开发中使用的配置挪过来就好。而 main process 的自动化则需要另寻办法，当然，也不难。使用 &lt;a href=&quot;https://github.com/Quramy/electron-connect&quot; class=&quot;link-underline&quot;&gt;electron-connect&lt;/a&gt; 可以很好的帮助我们解决这个问题，在 gulp 中设置好task 之后然后在 renderer process 和 main process 中的插入一段代码即可。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;gulpfile.js&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var gulp = require(&amp;#39;gulp&amp;#39;);
var gutil = require(&amp;#39;gulp-util&amp;#39;);
var electron = require(&amp;#39;electron-connect&amp;#39;).server.create();

gulp.task(&amp;#39;watch:electron&amp;#39;, function () {
  electron.start();
  gulp.watch([&amp;#39;./app/src/main.js&amp;#39;, &amp;#39;./app/src/main/**/*.js&amp;#39;], electron.restart);
  gulp.watch([&amp;#39;./app/dist/**/*.{html,js,css}&amp;#39;], electron.reload);
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;RendererProcess&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
    &amp;lt;meta charset=&amp;quot;UTF-8&amp;quot;&amp;gt;
    &amp;lt;title&amp;gt;Hello World!&amp;lt;/title&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;

&amp;lt;!-- All of the Node.js APIs are available in this renderer process. --&amp;gt;
&amp;lt;!--We are using node &amp;lt;script&amp;gt;document.write(process.versions.node)&amp;lt;/script&amp;gt;,--&amp;gt;
Chromium &amp;lt;script&amp;gt;document.write(process.versions.chrome)&amp;lt;/script&amp;gt;,
and Electron &amp;lt;script&amp;gt;document.write(process.versions.electron)&amp;lt;/script&amp;gt;.
and Node &amp;lt;script&amp;gt;document.write(process.version)&amp;lt;/script&amp;gt;.
&amp;lt;div id=&amp;quot;example&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;script&amp;gt;
  	//创建 client
    require(&amp;#39;electron-connect&amp;#39;).client.create();
&amp;lt;/script&amp;gt;
&amp;lt;/html&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;MainProcess&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;#39;use strict&amp;#39;;

var app = require(&amp;#39;app&amp;#39;);
var BrowserWindow = require(&amp;#39;browser-window&amp;#39;);
var client = require(&amp;#39;electron-connect&amp;#39;).client;

app.on(&amp;#39;ready&amp;#39;, function () {
  var mainWindow = new BrowserWindow({
    width: 400,
    height: 300
  });
  mainWindow.loadUrl(&amp;#39;file://&amp;#39; + __dirname + &amp;#39;/index.html&amp;#39;);

  // Connect to server process
  client.create(mainWindow);
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;细心的同学可能会发现，在 watch 的 task 中，同时对 main process 和 renderer process 的代码监听，对应的操作是 restart 和 reload。reload 会刷新当前的页面，在这里 React 的 hot load 都可以不需要了。印象中好像 hot load 是不会整个刷新页面的，回头可以试试。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;至此，只需要在终端中执行&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;gulp watch:electron &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;就能达到开发过程中 electron 自动 restart 和 reload 的目的了。如果想看详细文档可以前往 &lt;a href=&quot;https://github.com/Quramy/electron-connect&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;上述只是简单的例子，更多时候需要根据项目的规划做调整，一下是我的 gulpfile.js&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var path = require(&amp;#39;path&amp;#39;);
var gulp = require(&amp;#39;gulp&amp;#39;);
var babel = require(&amp;quot;gulp-babel&amp;quot;);
var gutil = require(&amp;#39;gulp-util&amp;#39;);
var webpack = require(&amp;#39;webpack&amp;#39;);
var webpackConfig = require(&amp;#39;./webpack.config.js&amp;#39;);
var electron = require(&amp;#39;electron-connect&amp;#39;).server.create();

var ROOT_PATH = path.resolve(__dirname);
var APP_PATH = path.resolve(ROOT_PATH, &amp;#39;app&amp;#39;);

// 开发
var webpackConfigDev = Object.create(webpackConfig);
webpackConfigDev.devtool = &amp;#39;eval-source-map&amp;#39;;
webpackConfigDev.debug = true;

var devCompiler = webpack(webpackConfigDev);

// renderer process 的 webpack 编译
gulp.task(&amp;#39;webpack:build-dev&amp;#39;, function () {
  devCompiler.run(function (err, status) {
    if (err) {
      throw new gutil.PluginError(&amp;#39;webpack:build-dev&amp;#39;, err);
    }
    gutil.log(&amp;#39;[webpack:build-dev]&amp;#39;, status.toString({
      colors: true
    }));
  });
});

// main process 的编译
gulp.task(&amp;#39;babel:electron-main&amp;#39;, function () {
  return gulp.src([APP_PATH + &amp;#39;/main.js&amp;#39;, APP_PATH + &amp;#39;/main/**/*.js&amp;#39;, APP_PATH + &amp;#39;/constant/*.js&amp;#39;], { base: APP_PATH })
    .pipe(babel())
    .pipe(gulp.dest(&amp;#39;dist&amp;#39;));
});


gulp.task(&amp;#39;watch&amp;#39;, [&amp;#39;babel:electron-main&amp;#39;, &amp;#39;webpack:build-dev&amp;#39;], function () {

  electron.start();

  gulp.watch([&amp;#39;./app/main.js&amp;#39;, &amp;#39;./app/main/**/*.js&amp;#39;], [&amp;#39;babel:electron-main&amp;#39;]);
  gulp.watch([APP_PATH + &amp;#39;/constant/*.js&amp;#39;, &amp;#39;./app/src/**/*.{html,js,css}&amp;#39;], [&amp;#39;webpack:build-dev&amp;#39;]);

  gulp.watch([&amp;#39;./dist/main.js&amp;#39;, &amp;#39;./dist/main/**/*.js&amp;#39;], electron.restart);
  gulp.watch([&amp;#39;./dist/renderer/*.{html,js,css}&amp;#39;, &amp;#39;./dist/renderer/**/*.{html,js,css}&amp;#39;], electron.reload);

});

gulp.task(&amp;#39;dev&amp;#39;, [&amp;#39;watch&amp;#39;]);
&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[真的是好久没写博客了]]></title><description><![CDATA[记录可查，自从毕业之后就没怎么写过博客。期间写了翻译了两篇老外的文章，不过好像似乎也是烂尾了。 仔细想想，没有坚持下去的原因有很多，但是无论有多少原因，归根到底问题还是出在自己身上。什么工作之后好累啊，平时没时间啊种种，其实都是借口。 其实就是懒了，以前的激情慢慢消退了。无论你…]]></description><link>https://zhanglun.github.io/blogs/2016-08-04-真的是好久没写博客了/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2016-08-04-真的是好久没写博客了/</guid><pubDate>Thu, 04 Aug 2016 14:53:02 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;记录可查，自从毕业之后就没怎么写过博客。期间写了翻译了两篇老外的文章，不过好像似乎也是烂尾了。&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;仔细想想，没有坚持下去的原因有很多，但是无论有多少原因，归根到底问题还是出在自己身上。什么工作之后好累啊，平时没时间啊种种，其实都是借口。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;其实就是懒了，以前的激情慢慢消退了。无论你说是生活的压力，还是工作的忙碌，都是借口。时间总是用的，但是没激情没有动力，即使是双休日，哪怕是三休日也是不会提笔。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;真是只是懒了，没激情了吗？我想并不是，在我看来目前自己更多的是思想上的懒惰。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;毕业和入职&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%AF%95%E4%B8%9A%E5%92%8C%E5%85%A5%E8%81%8C&quot; aria-label=&quot;毕业和入职 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;毕业和入职&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;以前在学校时，毕业面临着就业。当时各种学习新技术，钻研，什么 Angular 、Node.js，mongo啊，然后毕设基于这些做了一个聊天室。麻雀虽小，五脏俱全。也是得益于此才有幸加入现在的公司负责 IM 模块的前端工作。好的，从这时开始，心态出问题了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;毕业之后顺利入职，起初写了一点 node 相关的后台代码，操作 mongo，加几个接口啊之类的。后来开始负责公司内部的工具系统的前端开发，期间原 IM的负责人离职，我便接手。到现在，一人负责 IM 模块的前端，偶尔在负责 node 的同学忙时 debug 一下 node 的代码。后端相关技术得以见长。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;可能说到这你会感觉，喔不错喔。然而事实却是：我虽想走向全栈工程师，但是目前主要还是提高前端的技能，先成为一名优秀的前端工程师。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;公司数据规模还算大，负责的模块功能也算比较复杂，在开发工程中，业务能力得到了很明显的提升。但是，公司的前端架构和前端氛围是硬伤，尤其是在我刚刚入职的时候。入职之初，公司甚至没有专门的前端组，前端开发人员只是附属于后端，一切都是后端牵着走。开发工具和流程都是古老的，包括但不限于seajs ，前端模板，git 使用规范等。入职时间为2015年7月，这时候的前端圈子已经是百家争鸣的时代，具体什么样子我想不需要我再细说了，但是公司内部的前端整体还停留在几年前。对于这些，起初我不以为然，但当我在开发的时候，我才真正意识到工具是多么的重要。&lt;/p&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;无力吐槽的-seajs&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%97%A0%E5%8A%9B%E5%90%90%E6%A7%BD%E7%9A%84-seajs&quot; aria-label=&quot;无力吐槽的 seajs permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;无力吐槽的 seajs&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;不可否认，能够做出 seajs 是蛮厉害的，或许它在阿里内部配合一系列内部工具，使用起来如虎添翼。但是放在外面，对于其他的使用者来说，有多大的利弊我无从知晓。我只能从我自身的角度吐槽。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;以下都是我的个人观点。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;乱七八糟的文档。什么五分钟上手，我看了大半天还是没搞清楚到底怎么搞，而且还在 issues 里面写文档。&lt;/li&gt;
&lt;li&gt;乱加新概念。什么懒加载我不知道，我也不想知道。因为在我看来这简直无理取闹。&lt;/li&gt;
&lt;li&gt;中文社区小圈子，很多问题都知道怎么办。或许配合阿里系的构建工具很爽，但是配合 grunt 啊 gulp 啊什么的简直是要哭死。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;半天都没入门，可能我是真菜吧。&lt;/p&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;前端模板系统&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%89%8D%E7%AB%AF%E6%A8%A1%E6%9D%BF%E7%B3%BB%E7%BB%9F&quot; aria-label=&quot;前端模板系统 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;前端模板系统&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;jQuery + 前端模板引擎的思路是我13年实习的时候使用，在15年另一家公司实习时，已经是 Angular 了。所以对我而言，感觉像是在倒车。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我并不是说这种模式是多么的不好，而是公司使用这种模式与我的预期出现了偏差。&lt;/p&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;Git-的使用&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Git-%E7%9A%84%E4%BD%BF%E7%94%A8&quot; aria-label=&quot;Git 的使用 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Git 的使用&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;且不说我 git 玩得多么的溜，但是基本的操作和规范什么的都还是心里有数的，不懂就查乃程序猿基本素质。但是公司内部大部分或者可以说所有的使用方式 都只有是粗暴的 push pull，毫无艺术可言。初来乍到的我简直被震惊了-大部分时候前后端的人都在一个分支上开发。我尝试在小组推一推 git flow，但是无奈习惯的可怕。好在我依然按照 git flow 要求自己。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;以上，我内心吐槽比较多的，包括但不限于这些，毕竟本文并不是来吐槽自己可爱公司的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;然而，事实证明，这一切的背后都是有其内在原因，在不展开说。&lt;/p&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;自己的尝试&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%B7%B1%E7%9A%84%E5%B0%9D%E8%AF%95&quot; aria-label=&quot;自己的尝试 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自己的尝试&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;工作一段时间之后，发现使用 seajs 导致的很多问题（狗屁懒加载，还不如打包成一个文件），于是开始在自己的模块中尝试使用 webpack，配合之前的“前端架构”，同时以组件化的形式对 IM 的模块进行优化。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;首先，保留模块 seajs 的 js 入口文件，将其他的 js 文件和小模块按需整理打包成一个或者多个文件，从入口文件引入这些文件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;其次，重新梳理了 IM 的代码，根据界面划分组件。原本打算参考 flux 的思路将数据在一个 store 中，但是考虑到目前还是 jQuery 配合前端模板的开发模式，担心出现无法掌控的性能问题，最终还是将组件的数据分离散落组件内部。 每个组件有自己专属的 Model，View 和 Controller。Controller 控制 Model，Model 变化之后修改 View，组件内部 Model 和 View 的通信以及个逐渐之间都是 通过&lt;strong&gt;订阅发布者模式&lt;/strong&gt;通信。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;到这一步之后，模块的稳定性有了明显提升，数据的“单向流动”和数据驱动页面的思路也使得代码结构较之前简单清晰。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;组件化的优势在于：分治。在我的代码中，组件内部只需要处理自己 Model 和 View 的事情，在 Controller 中暴露出对外的订阅和发布。而组件之间的“交流”只通过彼此的 Controller。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;	|-------------------------------------|
	| Controller =====&amp;gt; Model =====&amp;gt; View |
	|-------------------------------------|
	|			|
	|-------------------------------------|
	| Controller =====&amp;gt; Model =====&amp;gt; View |
	|-------------------------------------|
	|			|
	|-------------------------------------|
	| Controller =====&amp;gt; Model =====&amp;gt; View |
	|-------------------------------------|&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当然，上述过程不是一蹴而就，而是一点点的尝试和修改，最后总结如此。&lt;/p&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;好消息来了有消息好过没消息&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A5%BD%E6%B6%88%E6%81%AF%E6%9D%A5%E4%BA%86%E6%9C%89%E6%B6%88%E6%81%AF%E5%A5%BD%E8%BF%87%E6%B2%A1%E6%B6%88%E6%81%AF&quot; aria-label=&quot;好消息来了有消息好过没消息 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;好消息来了？有消息好过没消息&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;期间有一个好消息就是，公司终于成立了前端小组。在以为老员工的带领下和大家的努力下，前端开发规范和流程定下来了。然后小组分工对目前的一些比较重大的问题进行处理。比如 z-index 的规范，公用组件的清理和维护。我负责表情键盘的公共组件，目前已经完工，回头有空放 github 上供大家拍砖。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;现实是残酷的&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%8E%B0%E5%AE%9E%E6%98%AF%E6%AE%8B%E9%85%B7%E7%9A%84&quot; aria-label=&quot;现实是残酷的 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;现实是残酷的&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;技术发展如此迅速，要想在当前站稳脚跟，还是要有一手绝活，提高自身的竞争力才是硬道理。工作上老技术加新思想得过且过，但是业余时间也是不能松懈的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;毕业到现在，业余时间的学习状态也是起起伏伏。一会看看 React，一会搞搞 node……一会想做一个绑定七牛云的 markdown 编辑器，一会又想写 python 爬爬网站……说的好听叫“德智体美劳全面发展”，说的不好听就是“浮躁”。东一榔头西一棒子，demo 都是半成品，简直毫无作为。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;好在意识到业界竞争，及时刹车，给自己稍微定了计划和目标。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;用现在的新技术做一个相对完整的作品&lt;/li&gt;
&lt;li&gt;影片管理工具&lt;/li&gt;
&lt;li&gt;学 Python，好好学，好好用&lt;/li&gt;
&lt;li&gt;继续写博客&lt;/li&gt;
&lt;li&gt;等等其他的事情&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;目前正在进行第一项：利用 Vuejs 及其生态圈做一个自己的 &lt;a href=&quot;https://github.com/zhanglun/bluerobin&quot; class=&quot;link-underline&quot;&gt;任务清单管理&lt;/a&gt;，欢迎大家送星鼓励迷途羔羊。
前后几个月的时间，断断续续。有时候大半个月不写，有时候周末狂写两天，现在每天坚持提交代码，时间少就稍微改改样式，时间多就加加功能。&lt;a href=&quot;https://github.com/zhanglun/dockersite&quot; class=&quot;link-underline&quot;&gt;后端代码在这&lt;/a&gt;，本是以前在 daocloud 上搭着玩的，现在想慢慢把它打造成我的个人 API 接口仓库，同样也欢迎大家的鼓励。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;自己的硬盘装满了各种电影，但是名字和信息乱七八糟，希望有一个管理软件，但是没有找到，于是乎想自己用 electron 搞一个，取名“MovieMaster”，还可以跨平台呢。加载文件夹中的影片文件显示影片的信息是它的基本功能，同时可以编辑影片的信息。更多好用功能以后再想。目前爬了6000多条电影数据，等有空开发前后端，&lt;a href=&quot;&quot; class=&quot;link-underline&quot;&gt;仓库&lt;/a&gt;都建好了呢&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Python 作为兴趣爱好，拓展自己的技术面，不想局限于 JavaScript。把之前的 &lt;a href=&quot;https://github.com/zhanglun/pureloser&quot; class=&quot;link-underline&quot;&gt;python demo 仓库&lt;/a&gt;删了个干净，重新复习了基本的语法和数据接口，等有空了，重新拾起 Flask 撸起来。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;继续写博客，本文不就是一个很好的开头吗？以前的博客用 githubpage 搭建，目前来说保持不变吧，同时应该会在其他平台同步博文。
主要是贴图片有点麻烦，虽然现在有很多工具，但是还是想自己撸一个，粘贴上传到七牛云，demo 都写好了。现阶段还是多写写字吧。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;其实我还是挺想自己做一个单页博客，想想工作量有点大，我的 MovieMaster 优先。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;demo 很多，可惜都没成型，遗憾。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;后记&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%90%8E%E8%AE%B0&quot; aria-label=&quot;后记 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;后记&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;大半夜说了这么多，不是心血来潮，是一直以来想写点什么但是却不知道写点什么。今天能够提笔写下这篇，无论流水还是感悟，也算是一个进步。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;毕业之时，曾想三五年后成为一名优秀工程师，一个打五个的那种。不论这个目标是否能够实现，但是依然要朝着这个方向前进。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;与君共勉&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Chrome内存分析工具概述]]></title><description><![CDATA[原文标题：4 Types of Memory Leaks in JavaScript and How to Get Rid Of Them 原文链接：https://auth0.com/blog/2016/01/26/four-types-of-leaks-in-your-ja…]]></description><link>https://zhanglun.github.io/blogs/2016-04-10-Chrome内存分析工具概述/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2016-04-10-Chrome内存分析工具概述/</guid><pubDate>Sun, 10 Apr 2016 18:00:18 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;原文标题：4 Types of Memory Leaks in JavaScript and How to Get Rid Of Them&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;原文链接：&lt;a href=&quot;https://auth0.com/blog/2016/01/26/four-types-of-leaks-in-your-javascript-code-and-how-to-get-rid-of-them/&quot; class=&quot;link-underline&quot;&gt;https://auth0.com/blog/2016/01/26/four-types-of-leaks-in-your-javascript-code-and-how-to-get-rid-of-them/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--more--&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;紧接着上一篇文章，沿着有关 JavaScript 内存泄漏的话题，接着来讲解 Chrome 开发者工具关于内存分析的使用。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;Chrome provides a nice set of tools to profile memory usage of JavaScript code. There two essential views related to memory: the timeline view and the profiles view.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Chrome 提供了一系列优秀的工具来分析 JavaScript 代码中内存的使用。有两个和内存相关的重要面板：timeline 和 profile。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Timeline-面板&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Timeline-%E9%9D%A2%E6%9D%BF&quot; aria-label=&quot;Timeline 面板 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Timeline 面板&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/89a48fe3660826373b938c36d0e17604/ad00e/timeline.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.38297872340425%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoklEQVQoz52Sy46kMAxF+f8PbM2MqkcqUlC8iryAJCRwRgnV6t0senF07evISuxUbdvS9T1dP9D3Pc9nRy0aaiGo65qu6xnHkWEY6Yfh0n7g9ZpRSiMLqsTzPFN57wjB4b1n33c2Z0se/Mq+B2L0nGcipUvPIwJnyWPaOVLgOBIpemLcqXzYcd6Xhlfs8CHg3Ib3gc1tOOfYto3NebbNsbnAsm7Y1WOXrAFjV6xdqMSjIT/7Ie5vBEII2se9aNPUCFHTiDtt+6Su7zweLU0jaNpnqWe/bfKIBJW1FmvUG4nRssRGT1ijMWq6fDVeZ7Jv9XeuRharWfSInF9UHx+/uN0+udeC5yAZ+hcyL0nmwXcoOaO1eaOLKq1R2iCV5KUk0zwzzhKpFdWf229un3/LhjlPzvMsQ8+cJNIZiUdkP/aCTx6fQiGknT1d9RBjiaumacjkhtM0oZRisZbFGoxVaKOQWqK0wpjrltaYUs/n1uWbXK/8e8Nfm4wxchwHKeWvchSON5f3f8pSpJSs60oIoWhunuOfUBrmD/11q2xmzflP+AeAe04Bv+OOnAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/timeline.png&quot;
        title=&quot;./images/timeline.png&quot;
        src=&quot;/static/89a48fe3660826373b938c36d0e17604/1d69c/timeline.png&quot;
        srcset=&quot;/static/89a48fe3660826373b938c36d0e17604/4dcb9/timeline.png 188w,
/static/89a48fe3660826373b938c36d0e17604/5ff7e/timeline.png 375w,
/static/89a48fe3660826373b938c36d0e17604/1d69c/timeline.png 750w,
/static/89a48fe3660826373b938c36d0e17604/78797/timeline.png 1125w,
/static/89a48fe3660826373b938c36d0e17604/ad00e/timeline.png 1366w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;The timeline view is essential in discovering unusual memory patterns in our code. In case we are looking for big leaks, periodic jumps that do not shrink as much as they grew after a collection are a red flag. In this screenshot we can see what a steady growth of leaked objects can look like. Even after the big collection at the end, the total amount of memory used is higher than at the beginning. Node counts are also higher. These are all signs of leaked DOM nodes somewhere in the code.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;timeline面板时发现代码中不寻常内存模式必不可少的工具。假设我们正在寻找严重泄漏，红色标记的周期性猛涨不会随着他们的增长而收缩。在这个截图中我们可以看到泄露对象稳定增长是什么样子的。即使在最后的一次大回收之后，整个使用的内存量也比刚开始的时候高。节点的数量也更高。这些都标志着在代码的某处存在泄露的DOM节点。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Profiles-view-性能视图&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Profiles-view-%E6%80%A7%E8%83%BD%E8%A7%86%E5%9B%BE&quot; aria-label=&quot;Profiles view 性能视图 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Profiles view 性能视图&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/68449cb10e53ef7b3e28d82c8fc42f45/ad00e/profiles.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.38297872340425%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABi0lEQVQoz4WSSY7cMAxFff9L5ATJAbLLIgfoXYZF0h4kW/IoUYOn+gFZ7S4ESFACnilD0qc+xaKuG3SdQdt2qKoKWitUdYPfrxXK8hVlWUK3LZTSUEpBaY2madC2Lay1MMag73uZM0VTl3DLiBgcyqpCCAH7vuM8T2zbhpyzxIt1XQUigu17GGsxDAOMsULx6ct3fPhc4uNXDd0abPsmYvt+4DhPmf9rcFJPBO9J4rwsQvHy7Rdefnb4UY6oG41hHLEsDkThfoAIKWXkdUXOK1LOIsbEGO+khGme4bxHkSNhTYRITurECxQCQohvMYg9Fr6SsOXjOBBjQohR9vDtnHMo+OOcxzzPcjO2yjwbx3G+15QdXIlF0HuPaZrQKAWiRRauDf/jfmaWEo3TBGt7eZx3QY682A8ai2vhvAFRDyKLGAnbtv/12gzXTh7FE4ZhxMKWWewS5LpN0yKZuV2ejdvtJolSSm9kFNyUXddhHEexycJsiQWf8RB6UPBhbgHOdjUzx+v/GbzvwYk/mL5Pp1ihot8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/profiles.png&quot;
        title=&quot;./images/profiles.png&quot;
        src=&quot;/static/68449cb10e53ef7b3e28d82c8fc42f45/1d69c/profiles.png&quot;
        srcset=&quot;/static/68449cb10e53ef7b3e28d82c8fc42f45/4dcb9/profiles.png 188w,
/static/68449cb10e53ef7b3e28d82c8fc42f45/5ff7e/profiles.png 375w,
/static/68449cb10e53ef7b3e28d82c8fc42f45/1d69c/profiles.png 750w,
/static/68449cb10e53ef7b3e28d82c8fc42f45/78797/profiles.png 1125w,
/static/68449cb10e53ef7b3e28d82c8fc42f45/ad00e/profiles.png 1366w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;This is the view you will spend most of the time looking at. The profiles view allows you to get a snapshot and compare snapshots of the memory use of your JavaScript code. It also allows you to record allocations along time. In every result view different types of lists are available, but the most relevant ones for our task are the summary list and the comparison list.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这就是那个将花费你大部分时间的视图。它允许你获得一个快照，并且可以比较那些你的js代码内存使用情况的快照。 还可以随着时间记录内存的分配。在每一个结果视图中，可以获得不同类型的列表，但是对我们的任务来说最有用的几个是&lt;code&gt;summary list&lt;/code&gt;和 &lt;code&gt;comparison list&lt;/code&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;The summary view gives us an overview of the different types of objects allocated and their aggregated size: shallow size (the sum of all objects of a specific type) and retained size (the shallow size plus the size of other objects retained due to this object). It also gives us a notion of how far an object is in relation to its GC root (the distance).&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;summary视图向我们呈现了不同类型对象的分配和他们合计大小的概览：shallow size（所有对象中特殊类型的总和）和retained size（shadllow size加上retained size就是这个对象），这也给了我们一个概念：一个对象离GC的root有多远（距离）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;The comparison list gives us the same information but allows us to compare different snapshots. This is specially useful to find leaks.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;comparison list 呈现相同的内容但是允许我们比较不同的快照。对于寻找内存泄漏来说这特别又有。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Example-Finding-Leaks-Using-Chrome&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Example-Finding-Leaks-Using-Chrome&quot; aria-label=&quot;Example Finding Leaks Using Chrome permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Example: Finding Leaks Using Chrome&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;本质上来说有两种类型的内存泄漏：一种是周期性地增加内存的使用，另一种是只发生一次，不会进一步增加内存的使用。很明显，当内存泄漏周期性增长时是很容易发现的。这也是最麻烦的一个地方：如果内存随着时间增加，这种类型的泄漏最终将导致浏览器变得缓慢或者停止执行脚本。非周期性增长的内存泄漏在它们足够大以至于在所有的分配中很明显时很容易被发现。通常来说这都不是问题，所以他们经常被忽视。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;For our example we will use one of the examples in Chrome’s docs. The full code is pasted below:&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在我们的例子中。我们将使用 &lt;a href=&quot;https://developer.chrome.com/devtools/docs/demos/memory/example1&quot; class=&quot;link-underline&quot;&gt;Chrome 文档中的一个例子&lt;/a&gt;。完整的代码如下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var x = [];

function createSomeNodes() {
    var div,
        i = 100,
        frag = document.createDocumentFragment();
    for (;i &amp;gt; 0; i--) {
        div = document.createElement(&amp;quot;div&amp;quot;);
        div.appendChild(document.createTextNode(i + &amp;quot; - &amp;quot;+ new Date().toTimeString()));
        frag.appendChild(div);
    }
    document.getElementById(&amp;quot;nodes&amp;quot;).appendChild(frag);
}
function grow() {
    x.push(new Array(1000000).join(&amp;#39;x&amp;#39;));
    createSomeNodes();
    setTimeout(grow,1000);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;When grow is invoked it will start creating div nodes and appending them to the DOM. It will also allocate a big array and append it to an array referenced by a global variable. This will cause a steady increase in memory that can be found using the tools mentioned above.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当&lt;code&gt;grow&lt;/code&gt;被调用时，它会开始创建 div 节点，然后将它们插入到 DOM 中。同时也会分配一个大数组将这个数组插入到被一个全局变量引用的数组中。这会导致内存使用的稳定增长，使用上面提到的工具可以发现这个增长。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;Garbage collected languages usually show a pattern of oscillating memory use. This is expected if code is running in a loop performing allocations, which is the usual case. We will be looking for periodic increases in memory that do not fall back to previous levels after a collection.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;垃圾回收语言通常会呈现一个振荡内存使用的模式。如果代码在一个执行分配的循环中运行，这是预料之中的，这是一个常见的问题。我们将寻找内存中的周期增长，这些增长不会在执行一次收集之后下降到之前的水平。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;Find-out-if-memory-is-periodically-increasing&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Find-out-if-memory-is-periodically-increasing&quot; aria-label=&quot;Find out if memory is periodically increasing permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Find out if memory is periodically increasing&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;The timeline view is great for this. Open the example in Chrome, open the Dev Tools, go to timeline, select memory and click the record button. Then go to the page and click The Button to start leaking memory. After a while stop the recording and take a look at the results:&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;打开 &lt;a href=&quot;https://developer.chrome.com/devtools/docs/demos/memory/example1&quot; class=&quot;link-underline&quot;&gt;Chrome 中的例子&lt;/a&gt;，打开开发者工具，切换到&lt;code&gt;timeline&lt;/code&gt;面板，选择&lt;code&gt;memory&lt;/code&gt;，点击&lt;code&gt;record&lt;/code&gt;按钮。然后点击&lt;code&gt;The Button&lt;/code&gt;开始泄漏内存。过了一会停止记录，查看结果：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/241e69a7cd65b7f7abecf33eb3596c9e/ad00e/example-timeline.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.38297872340425%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlElEQVQoz52S2Y7bMAxF9f+fV7RAl2SSkRVJduBNu+TYtxDtTIPBPPXhmKtImCSTUkJrDd12aNsOSmlwIcGbBk3TQIgbuq574Y6269D3A+Z5xjRNHwzDAJZzRikZuRSUUpCSJ3tZCnJJwLYBeIFsYF0XPNYF27ZiW1eSj2UBy+WBnBckoiDljFxlKoddEFNGjBk+Zlj/JCGQr8CFTDnGerBG3KB0B/5+wfv1DVIqCCFwkxJSaSiloLRGzRNC0kiUaimH3qoWUmpI1YJzAeasgbUWzk7wrmIPDNxT959xcG4+Yo4IwWEYerA/pxPO5zMu1ystgnMOzveFVH2XO83h/xfjH/bTx759/4Gfv36TI8aIlBIRY0I8dLJTnVmAC34neszOwQaH2TuM1sIEB3a5nPB2udJJ7AUzcqrDDjDBwvj90Y5HSIEK++hJ1sb5aFolaxqB+/1ONzSNPcZxwDiOdGOfMYR54SVmDPq+B6ufYRjhnMOyZCglaYPVX5O+KvxlM2P2w27blq68/m6d0ziNtHWy/4O//g1Gj74/z5YAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/example-timeline.png&quot;
        title=&quot;./images/example-timeline.png&quot;
        src=&quot;/static/241e69a7cd65b7f7abecf33eb3596c9e/1d69c/example-timeline.png&quot;
        srcset=&quot;/static/241e69a7cd65b7f7abecf33eb3596c9e/4dcb9/example-timeline.png 188w,
/static/241e69a7cd65b7f7abecf33eb3596c9e/5ff7e/example-timeline.png 375w,
/static/241e69a7cd65b7f7abecf33eb3596c9e/1d69c/example-timeline.png 750w,
/static/241e69a7cd65b7f7abecf33eb3596c9e/78797/example-timeline.png 1125w,
/static/241e69a7cd65b7f7abecf33eb3596c9e/ad00e/example-timeline.png 1366w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;This example will continue leaking memory each second. After stopping the recording, set a breakpoint in the grow function to stop the script from forcing Chrome to close the page.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;这个例子每一秒钟都将会继续泄漏内存。暂停记录之后，在 grow 函数中设置一个断点来停止脚本强制 Chrome 关闭页面。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;There are two big signs in this image that show we are leaking memory. The graphs for nodes (green line) and JS heap (blue line). Nodes are steadily increasing and never decrease. This is a big warning sign.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在上图中有两个大信号告诉我们内存正在泄漏。绿线表示 DOM 节点，蓝线表示js内存堆。节点正在稳定地增长并且从来没有下降。这是一个大的警告标志。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;The JS heap also shows a steady increase in memory use. This is harder to see due to the effect of the garbage collector. You can see a pattern of initial memory growth, followed by a big decrease, followed by an increase and then a spike, continued by another drop in memory. The key in this case lies in the fact that after each drop in memory use, the size of the heap remains bigger than in the previous drop. In other words, although the garbage collector is succeeding in collecting a lot of memory, some of it is periodically being leaked.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;JS 内存堆也表现出内存使用的稳定地增长。由于垃圾回收的影响更难看到这个增长。你可以看到一个初始内存增长的模式。后面接着一个大的下降，接着一个增长形成一个突刺，接着又是一个下降。这个案例的关键在于每次内存使用量的下跌，内存堆的剩余大小都比之前的下跌之后的内存堆多。换句话说，虽然垃圾回收器成功地回收了很多内存，但是一些内存还是周期性地泄漏了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;We are now certain we have a leak. Let’s find it.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;现在我们确定了我们存在内存泄漏，让我们来解决它&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;Get-two-snapshots&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Get-two-snapshots&quot; aria-label=&quot;Get two snapshots permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Get two snapshots&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;To find a leak we will now go to the profiles section of Chrome’s Dev Tools. To keep memory use in a manageable levels, reload the page before doing this step. We will use the Take Heap Snapshot function.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了找到泄漏，我们将切换到开发者中的 profiles 面板。为了将内存的使用保持在可操纵的水平，在动手之前重新加载页面。我们将使用获取内存堆快照的功能。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Reload the page and take a heap snapshot right after it finishes loading. We will use this snapshot as our baseline. After that, hit The Button again, wait a few seconds, and take a second snapshot. After the snapshot is taken, it is advisable to set a breakpoint in the script to stop the leak from using more memory.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;重新加载页面，并且在完成之后拍一张内存堆得快照。我们将使用这个快照作为我们的基线。在那之后，按下&lt;code&gt;The Button&lt;/code&gt;按钮，等待几秒钟，接着拍第二张快照。第二张快照完成之后，在代码中打一个断点阻止泄漏更多的内存是明智的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4ce4a07027c2c8a7fdb9c8dc3301c194/ad00e/example-snapshots-1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.38297872340425%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnUlEQVQoz5WS3W6bQBBGef+36AP0ovdVb+JUVerexJWqxK2tmODFNiywy9+C16eatWnSqLLUkY7mY5j5gFmiJEnY7Xak6Y44jkmV4jnZ8rSJieMN6/UKpdSFLWmq2G4lpxwOh7/Y7/dEyfMGU2pqa/g0X3Oz2DNfGr79stw9lnz5kfN1Wf1hvqy4eyj4/H3PTFik3C4UN/cpt/eK6MNsybuPMe9nCrXL8P6ExOl04qxEvwLw3tN2Pb1zGGupjKVtO3JdEK0TzWNc8vCUk2xT+r5/MfwHXPIwDDjnQn/dNHRdh61roq6x9K1F8s/VmizXVw0njsdjMBXarsMNA03TEhljMMZSVhXxc0KudWi4FpPhOI4M4xjedBhG+t6dDa21SJYnNE0TdiN7kqG3THUxC4bDlAfG8fhiWJYlhywLhnVdh9o1ZE4XBXmuw6x8WVVVRFYML4Sl/0ecvD8f/WUNEpGpayo5+rpm9B4PHGVHgujXvKlJ/9QbZr0nSlcrSqXosoxea6zoPMeVJU5rXFHg5Fq01ERLbbo3YeVvafkNMflNvPE7rIIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;./images/example-snapshots-1.png&quot;
        title=&quot;./images/example-snapshots-1.png&quot;
        src=&quot;/static/4ce4a07027c2c8a7fdb9c8dc3301c194/1d69c/example-snapshots-1.png&quot;
        srcset=&quot;/static/4ce4a07027c2c8a7fdb9c8dc3301c194/4dcb9/example-snapshots-1.png 188w,
/static/4ce4a07027c2c8a7fdb9c8dc3301c194/5ff7e/example-snapshots-1.png 375w,
/static/4ce4a07027c2c8a7fdb9c8dc3301c194/1d69c/example-snapshots-1.png 750w,
/static/4ce4a07027c2c8a7fdb9c8dc3301c194/78797/example-snapshots-1.png 1125w,
/static/4ce4a07027c2c8a7fdb9c8dc3301c194/ad00e/example-snapshots-1.png 1366w&quot;
        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[CSS 布局的未来：网格布局]]></title><description><![CDATA[原文链接： The future of layout with CSS: Grid Layouts The future of layout with CSS: Grid Layouts 在这片文章中，我们一起来探索 CSS 网格布局的美妙世界。网格布局是 W3C 规范中相对较…]]></description><link>https://zhanglun.github.io/blogs/2015-11-22-CSS布局的未来：网格布局/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2015-11-22-CSS布局的未来：网格布局/</guid><pubDate>Sun, 22 Nov 2015 06:39:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;原文链接： &lt;a href=&quot;https://medium.com/@patrickbrosset/css-grid-layout-6c9cba6e8a5a#.cz5qhhi87&quot; class=&quot;link-underline&quot;&gt;The future of layout with CSS: Grid Layouts&lt;/a&gt;&lt;/p&gt;
&lt;!--more--&gt;
&lt;h1 class=&quot;heading title heading&quot; id=&quot;The-future-of-layout-with-CSS-Grid-Layouts&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#The-future-of-layout-with-CSS-Grid-Layouts&quot; aria-label=&quot;The future of layout with CSS Grid Layouts permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The future of layout with CSS: Grid Layouts&lt;/h1&gt;
&lt;p class=&quot;para&quot;&gt;在这片文章中，我们一起来探索 CSS 网格布局的美妙世界。网格布局是 W3C 规范中相对较新的部分，已经在浏览器中开始绽放属于自己的光芒。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在我们深入研究这项新鲜的 CSS 技术之前，让我们先快速的复习 grid 原理的相关知识。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;网格布局的简短介绍&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BD%91%E6%A0%BC%E5%B8%83%E5%B1%80%E7%9A%84%E7%AE%80%E7%9F%AD%E4%BB%8B%E7%BB%8D&quot; aria-label=&quot;网格布局的简短介绍 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;网格布局的简短介绍&lt;/h2&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;原作者的几句废话被我忽略了&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;本质上说，网格是一系列看不见的水平的和垂直的线，web 页面、杂志或者报纸上的各种设计片段和内容片段的都定位在这之上。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;网格的目标就是充当各种内容块在页面上放置的基础来确保这些内容对齐，间隔均匀。网格即使看不见，也能形象化地为开发者提供一种驾驭内容的方式。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;So-what-has-CSS-got-to-do-with-it-和-CSS-有什么关系&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#So-what-has-CSS-got-to-do-with-it-%E5%92%8C-CSS-%E6%9C%89%E4%BB%80%E4%B9%88%E5%85%B3%E7%B3%BB&quot; aria-label=&quot;So what has CSS got to do with it 和 CSS 有什么关系 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;So what has CSS got to do with it? 和 CSS 有什么关系？&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;CSS 有一系列新的属性，结合这些新的属性可以为你的 web 内容定义网格。这些属性在&lt;a href=&quot;http://dev.w3.org/csswg/css-grid-1/&quot;&gt;CSS网格布局规范&lt;/a&gt;中定义。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;CSS 并非它那驾驭复杂布局的奇特能力而出名。虽然这在 CSS诞生之初已经不是问题了，但是现在它已经逐渐变得相当普通，各种各样的复杂布局已经无法轻松实施。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;但是劳动人民的智慧是无穷的，创造性地使用浮动或者定位以及一系列各式各样的框架开支持缺少的特性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;所以，该到了CSS 拥有它特有的布局解决方案来支持现今的使用需求的时间了。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Can-I-use-it-我能使用吗&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Can-I-use-it-%E6%88%91%E8%83%BD%E4%BD%BF%E7%94%A8%E5%90%97&quot; aria-label=&quot;Can I use it 我能使用吗 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Can I use it? 我能使用吗&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;Yes you can start using it today, but only Chrome has implemented the specification far enough to play with grids, and you need to turn the experimental Web Platform features flag on.
当然，现在就可以使用了。但是现在只有 Chrome 足够支持这一特性。需要开始试验性功能&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;IE has an early implementation (dating back to IE10) too but the spec has evolved since it was added and so it’s not entirely compatible with it anymore.
IE 之前有实现过这个功能，但是这个特性在后来修改过，导致在 IE 上不在兼容。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Firefox has started implementing it too so it shouldn’t be too long before you can use it in this browser.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Firefox 也开始实现支持这个特性，相信在不久的将来也能够在 Firefox 上使用网格布局。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Finally, a polyfill exists, so you have no excuses not to start experimenting (and I strongly encourage you do)!
另外，有一些第三方的补丁存在，可以很方便的支持这个特性。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;So-whats-a-CSS-Grid-Layout-那么什么是-CSS-网格布局&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#So-whats-a-CSS-Grid-Layout-%E9%82%A3%E4%B9%88%E4%BB%80%E4%B9%88%E6%98%AF-CSS-%E7%BD%91%E6%A0%BC%E5%B8%83%E5%B1%80&quot; aria-label=&quot;So whats a CSS Grid Layout 那么什么是 CSS 网格布局 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;So what’s a CSS Grid Layout? 那么什么是 CSS 网格布局？&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;它的本质你可以理解成，一系列的水平线和垂直线相互交叉，形成了一个个的小方格，页面上的内容按照这下方格井井有条的排列。乍看之下有点像透明的表格。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 376px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/69e73962620d898984f866067954a3cd/d38a6/1_zcOcwuBtMoBaUfHHAJPNyg.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 71.80851063829788%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8klEQVQoz62TzU4DMQyE+/6v16LyIwEnRAUcqDaJ43jGVdylzdIDFLEaRfo2nvXEyq7c3ekE/fTQ2Qb0wHHf6FG/6qVCJLCRGqrENGALrAMmUM5mIBmtbxw9mAa0QB0wGQVhjhhULGILFrEFi9iKnvxsrteY67+ZlSggSYSMyAMy0NzRRXov1jAT3TmPpIaE2H+hkM3bTuU2y305Cfk3A4u09q5lk2Sb+ydu+nq8CD+deTDXpyLPqXf+g1kesjxG87trzO1N83oqm1TWqa/bdBoYkM32hgpIqMA+B6xoH9pete1m6UtFtrnz9x/DL5AXGC8OZMw6OR5QyIQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;1 zcOcwuBtMoBaUfHHAJPNyg&quot;
        title=&quot;1 zcOcwuBtMoBaUfHHAJPNyg&quot;
        src=&quot;/static/69e73962620d898984f866067954a3cd/d38a6/1_zcOcwuBtMoBaUfHHAJPNyg.png&quot;
        srcset=&quot;/static/69e73962620d898984f866067954a3cd/4dcb9/1_zcOcwuBtMoBaUfHHAJPNyg.png 188w,
/static/69e73962620d898984f866067954a3cd/5ff7e/1_zcOcwuBtMoBaUfHHAJPNyg.png 375w,
/static/69e73962620d898984f866067954a3cd/d38a6/1_zcOcwuBtMoBaUfHHAJPNyg.png 376w&quot;
        sizes=&quot;(max-width: 376px) 100vw, 376px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;上面的图中展现了一个网格中的块&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;行（lines）：在这个例子中，有四条垂直的线，三条水平的线。线条数从1开始计算。垂直的线从左往右排列，但是这一来内容文字书写的方向（writing direction，可以通过 CSS 改变默认的书写的方向）。线条可以指定对应的名称，以便帮助我们在 CSS 中准确的映射它们，这个在后面会讲到。&lt;/li&gt;
&lt;li&gt;轨道（tracks）：轨道值得是两条平行线之间的空间。所以在上面的例子中，有三条垂直的轨道，两条水平的轨道。行的作用在于告诉内容的排列摆放从何处开始，到何处停止，而轨道的作用则是在根本上决定内容的位置。&lt;/li&gt;
&lt;li&gt;单元格（cells）：单元格是两条相互垂直的轨道交叉的地方。在上面的例子中，只有一个cell 被高亮标注，其实在上面的网格中有6个 cell。&lt;/li&gt;
&lt;li&gt;区域（areas）：区域指的是跨越任意数量 cell 的矩形区域。就像行一样，区域也是可以有名字的。在上面的网格中，我们可以示范性的定义三个区域：A，B和C，就像下面的图片中展现的一样:&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 366px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/bfeb856f434d43e43ca523fb9c4e6f82/8b153/1_LyY-gAwN4xdr8FmReEdMMw.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 70.2127659574468%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/ElEQVQoz42T626DMAyF+/7PNk1bWyhaVXVjfyatG3SQ2ImDPSWUS7hIREcoPuTjJFbYiQgTC0s/uGF2ozo4EtWPBTt27Apyv+SfQXSz9G1dOTj2y/Tzx+I7eVhEXEFwUJAMwiQq9XMFsdNUroNLwkTjaVWQKswiZzOcanMFfPOTJfhO3srC60xPQnzyYZZctzAz3Szsa0iVuQAcFRwVpiqCX+rJ51wZGsYdjCdlPnEZfl2BN217ltxte0vDcsDzWsNKGjL72FFpLgEemSO4INir9rSL0k/VxHF/AeaG6cfaD7R5p3fwygfHnKPS5uiKrmGzey8y+xEkHi3yDydCGtojhqPlAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;1 LyY gAwN4xdr8FmReEdMMw&quot;
        title=&quot;1 LyY gAwN4xdr8FmReEdMMw&quot;
        src=&quot;/static/bfeb856f434d43e43ca523fb9c4e6f82/8b153/1_LyY-gAwN4xdr8FmReEdMMw.png&quot;
        srcset=&quot;/static/bfeb856f434d43e43ca523fb9c4e6f82/4dcb9/1_LyY-gAwN4xdr8FmReEdMMw.png 188w,
/static/bfeb856f434d43e43ca523fb9c4e6f82/8b153/1_LyY-gAwN4xdr8FmReEdMMw.png 366w&quot;
        sizes=&quot;(max-width: 366px) 100vw, 366px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;现在我们已经明白了一些基本的定义，接下来让我们看看究竟是什么使得网格系统如此的流弊。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;对于 CSS 网格布局来说，一个最重要的优点就是能够真正地将布局与标签分离。&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;事实上，网格本身就是完全在 CSS 中定义的，也就是说除去应用网格系统的父标签以外，不需要使用任何其他的元素来定义行，列，单元格或者区域。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这的确是一个很有趣的属性。一方面，元素在视觉上的排列顺序与元素在标签上的顺序是不挂钩的。这一点很重要，它可以让你集中精力去优化你的标签提高可访问性而不用为了处理视觉上的结果而妥协。另一方面，标签将变得更加轻量也更容易理解，因此也更容易维护。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;但是，更重要的是，它提供了一个非常有用的工具，用来将内容从布局中分离。在某种程度上有效的将它们解耦，使得在修改某一处的时候不会影响到其他的地方。
作为设计师，只需要修改一点点 CSS 就可以很轻松地试验这样新的布局。只要你的新布局能够提供内容预期需要使用的行和区域就行。
作为开发者，你仅仅只需要在网格中使用编号过的或者命名过的行和区域来定位你的内容。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;想象一下如下图所示的网格布局：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 474px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/713e3150d0dbdb4e1fa74d0ccf3254f6/5595f/1_oB_sweiQByIMdVPXGZrw4Q.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 69.14893617021278%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACcklEQVQoz1VT2XLiMBDc//+V3QokxEk2gLkSMDZgfB/ygcHmSEgCBskWFtIWBFK1Xf3QpVHXjEYzvyiltDiyHxDK6FUf6YnfoOfQFfRwZJT9Yoy9LbAOMjM4UXeQ5kE1gEYAP1f55yI3QqT68HTo7LUAagEce3C1wIydzZNoWx/N2krSVOLeaKWNUmWc6kq6tnbvxk5XUkVOVXmrDLbqOFXHqTzcLiN0MUfLmHeFjjfgPcF0XWrmhQWJhXIdZjosbEQAIiYqtH1hwRP1PUl+Mq/mvCO9+DLvSboLsJsjF2UuyiyIzQyH+DDF2M6xmRUAFy4u7Jwsi7OZssksqRpC3RKfbcHQARFzLKGDlGERbfofX9L6S1x/Seu3/iKR4vkgjoXZNthcMofzuAvGIIrEia7LgJULWsrZDSb3WVgBbskEJcu/c4acxJfqrXKz9rs60cKreRmLnjb3l+PI1sYuuy/oI2bcgTxk0YPvc07w6IYckB+Hba7dfXptlZuREf1XNm9Lz45gDAC7x1iHRM1JBYW34H243Ogf07+hdCOYr/qn8y7XhoHsXxs2T+q22HHluicZMmCVA6nntIoJl0WcHz57UT0IH7wRN+g+vY74YeeuHWmT61etEt4VXrwBHwi2CthtQcs5K2FSyaIKCMpGUDanFUd5kJrlWueWb/6pTo3rm6PZR1P1XoywZfijUZLwKG7CuAE3PTjtLpXGTG3EWiMRG36nYXWbTqtmTp23izmO854GRfNEQd33zLRn77r2bjGFqwgJNuxbsG/u+9petJFko54B4/g8JPRIT1P+vQPfuqCnHSCUHCjBF83I9dqPpuwfAw3pDKNVpvEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;1 oB sweiQByIMdVPXGZrw4Q&quot;
        title=&quot;1 oB sweiQByIMdVPXGZrw4Q&quot;
        src=&quot;/static/713e3150d0dbdb4e1fa74d0ccf3254f6/5595f/1_oB_sweiQByIMdVPXGZrw4Q.png&quot;
        srcset=&quot;/static/713e3150d0dbdb4e1fa74d0ccf3254f6/4dcb9/1_oB_sweiQByIMdVPXGZrw4Q.png 188w,
/static/713e3150d0dbdb4e1fa74d0ccf3254f6/5ff7e/1_oB_sweiQByIMdVPXGZrw4Q.png 375w,
/static/713e3150d0dbdb4e1fa74d0ccf3254f6/5595f/1_oB_sweiQByIMdVPXGZrw4Q.png 474w&quot;
        sizes=&quot;(max-width: 474px) 100vw, 474px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在这个布局中，命名的区域已经定义，允许内容根据区域的名字来定位。这意味只要我们维护好命名的区域，在未来就能相对轻松地调整布局，同时媒体查询也能够动态地调整布局。记住，整个布局都是在 CSS 中定义的，所以媒体查询也能够很好地工作。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;例如，使用媒体查询，前面提到的布局可以在小屏幕中变成这个样子：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 365px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/03878400b566a7fd07c085054f993e6e/2e8d1/1_xr308r1kDYPKpkzVdYDglQ.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 98.40425531914893%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAACPUlEQVQ4y5WU2XKiUBRF+f9/6Sii0SSaji2TGiKgiEATTdRSgkRtpqvcoQvjAFZeQq2nvWtxzi2oSxGEU370QEwOBoUi9O9zv94kmzx7HyIfAh9eVet1ErhJ6hNCQR+ag1BRwr56YdAPt5MosQPXjq4qRQ7e9IggjAmhMEDAjMAwAnqOnRnv7HhnxFdVrIU7O06XxoTC++/kYQSsCExCYH4nv55lgFNZj8Aoj3HwR9fEw8xkFCDI7tFDghp56hDXIarnw8cE3Sewu0/Vw9oYP0BSQIQ+UUSEQYkEdlqMpCRXlRD5hRAHz2fGuIFJiZByhgohXURURDr5qkJIkWARndeG29/rz8pqXfWyeLTrFVyPdnN5zftkVr64PckA2XVLo/s6o10oa2/8eNadTlqvw9Igm2uF/ox/T12M0081rtt6UTNK+hFaN8ojT/7w9a3bc3IVo+s32lyYHmUUoPensXVr/K2ZF6qmdWdY94ZVy+d3plkeLcT5SQZIfuxxDCtU+CydartTa7erYjYUbwWWbpmicVn7pS79KTbZUusI3eLK7Ie+BG/BXJs1C0/nimPY5s3TiNczkxs9rsQKZT7LS0NSmrL08Mwz3DkUKwJbbJnCaTL0oappgtJtq9IXovL8rPWc4WIjezNjJqiXqq1KvNyxDJug9BejYADlgcspC0FdnuFVZzWNyHw3fQ/YTCWqS1ZemCPvIBMKhtBbJI4DPzI4SxhuExzst17iLK+rzSL5unyo9A0/vIUIPgr/Ac9kL1It0deMAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;media query&quot;
        title=&quot;media query&quot;
        src=&quot;/static/03878400b566a7fd07c085054f993e6e/2e8d1/1_xr308r1kDYPKpkzVdYDglQ.png&quot;
        srcset=&quot;/static/03878400b566a7fd07c085054f993e6e/4dcb9/1_xr308r1kDYPKpkzVdYDglQ.png 188w,
/static/03878400b566a7fd07c085054f993e6e/2e8d1/1_xr308r1kDYPKpkzVdYDglQ.png 365w&quot;
        sizes=&quot;(max-width: 365px) 100vw, 365px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;原理讲的差不多了，让我们看看如果使用 CSS 定义网格布局。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Creating-gird-with-CSS&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Creating-gird-with-CSS&quot; aria-label=&quot;Creating gird with CSS permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Creating gird with CSS&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;定义一个网格只需要一个 HTML 元素来制指定也就是包含网格的容器 - &lt;strong&gt;gird container&lt;/strong&gt; 。网格布局将作用于这个元素。该元素下的子元素都是网格单元（gird item）。将一个元素设置为网格容器就像下面一样简单：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.container{
  display: grid;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;仅如此还是不够的，我们还需要定义网格的规格，行数和列数及其大小。使用下面给出的&lt;code&gt;grid-template&lt;/code&gt;的例子，就可以轻松做到这些。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.container{
  display: grid;
  grid-template-rows: 200px 100px;
  grid-template-columns: repeat(4, 100px);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在上面的例子中，我们明确的定义了一个两行四列的网格。使用repeat()方法是为了避免重复书写轨道（track）的代码。
网格也可以含蓄的定义行数。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.container{
  display: grid;
  grid-template-row: auto;
  grid-template-columns: repeat(4, 100px);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这样一来，浏览器能够自动增加行数来适应内容。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;现在回到我们之前的例子，我们明确定义了一个两行四列的网格，现在来添加一点内容。正如我们之前所说的，我们只需要两种元素：容器和内容&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;div class=&amp;quot;container&amp;quot;&amp;gt;
  &amp;lt;div class=&amp;quot;item1&amp;quot;&amp;gt;item 1&amp;lt;/div&amp;gt;
  &amp;lt;div class=&amp;quot;item2&amp;quot;&amp;gt;item 2&amp;lt;/div&amp;gt;
  &amp;lt;div class=&amp;quot;item3&amp;quot;&amp;gt;item 3&amp;lt;/div&amp;gt;
  &amp;lt;div class=&amp;quot;item4&amp;quot;&amp;gt;item 4&amp;lt;/div&amp;gt;
  &amp;lt;div class=&amp;quot;item5&amp;quot;&amp;gt;item 5&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;没有特殊的CSS代码来定位这些内容，就能够得到下面的布局&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 455px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e65cf1032e0c502436c7b717ac358e49/379c3/1_jKRGeZkE48QTInEV5Tkg5g.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 78.72340425531915%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfElEQVQoz61T27KbMAzk/7+wT+1JQs5pjHUzN2Gw3LEJDXnow5mpYIykZVnZszTZsq2Wj7DNbHuVKaY3KB2QFaixZGuIIw33j3vP/RJ0CUv32bnWaT9H1oGGr49PwbCILkEr9JjDtPVrk3OewuScu1yurnOMxEBte7/dWg8gKJ3rrtfr78eDgQnp3pbLex+nWMkyAoCIIGF5wxMxMTMiipey7pBnhtIvEGAc41MZPGANRmZgPEJA9gQQGJiRniXAX+UTGZj9iexP5Kr8In9bGf6zciXv8Q3lY+wRECRIOWRkAgKE/RbPe+LRMxAB+b0EH8elySkrzviAXz9+ui83wKCsOqr2qoMq1bWvHVYNR9nrFnaT8NS57na5uYcLFPKaX5bUk3PjybmWTdPLJFydEEjeyemf5CU99+y93zcmLHk7kc8/xvpOjpU808TAQsIkPfZlVLO8WU6Wxi2nmpuZJlvSs9wsTVtj5ZHKSNHKtzXZnEpSO2cozamgJ+gPJAeT+wAyMBYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;1 jKRGeZkE48QTInEV5Tkg5g&quot;
        title=&quot;1 jKRGeZkE48QTInEV5Tkg5g&quot;
        src=&quot;/static/e65cf1032e0c502436c7b717ac358e49/379c3/1_jKRGeZkE48QTInEV5Tkg5g.png&quot;
        srcset=&quot;/static/e65cf1032e0c502436c7b717ac358e49/4dcb9/1_jKRGeZkE48QTInEV5Tkg5g.png 188w,
/static/e65cf1032e0c502436c7b717ac358e49/5ff7e/1_jKRGeZkE48QTInEV5Tkg5g.png 375w,
/static/e65cf1032e0c502436c7b717ac358e49/379c3/1_jKRGeZkE48QTInEV5Tkg5g.png 455w&quot;
        sizes=&quot;(max-width: 455px) 100vw, 455px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们并没有定义这些内容摆放的位置，浏览器自动把它们一个个放置的单元格中，一行满了就从下一行开始。该规范定义了一个算法，自动放置在网格上的items，如果他们没有得到一个位置的时候，比如，你有很多 items 或者items 的数目是动态的，有时候你不想或者无法全部逐个定义它们的位置。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;让我们看看 item 如何在网格中定位：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.item1 {
  grid-row-start: 1;
  grid-row-end: 2;
  grid-column-start: 1;
  grid-column-end: 3;
}
.item2 {
  grid-row-start: 1;
  grid-row-end: 2;
  grid-column-start: 3;
  grid-column-end: 5;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在这里我们提前定义了前两个 item 的位置，这意味着其他的将会被浏览器自动定位，就像下面这样：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 452px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5a5fba6c900c2d1d86b4ee97bf4f5227/fcb94/1_T9K3kTj703RsKij1Aa4d-Q.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 78.19148936170212%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkElEQVQoz81T2W7jMAz0//9fEWC7RTfZ2LUl8dLhxBddSEpbF8W+L0EIQw0HlCix0VV11f3T1i+4667zgdqKf0b3rdFJb3KLHEdJHuR8OjsDI6ckMUkacUwck8TI4fX0Z/hrRikUx8Uvzb7tnrwDBwDOue7cGmsqRkKyVJi80V26oRsAawjzODf7ugcOgIDFyCIRPTCROMZHgAyELoNqy08x9A9QxXwQowG08B+J6d9i+11sDuI0527XygBZBkNZi9WGVZzT7c/Kyx7QE5IXIUB8y4cQFiFmJDacKc4JMAD05d1c9jlMjd63kceh7Z+ffpPFYCSQfz29XF4ugXx0wXbm+emXGyBBmPx9ivcpTVO8r2HJd44cjDHXawvgxDExdW3b9z0zi2Nr7fXaWmejxOPn1Wmrd/b5D3DuTRYfrH6SSgUOWawPf4g9e4cu9wwhZxNWXJ+qUg5dFm/fK+ukESK7fEIB9oP3IFJCDxIGXzEDJxf1pjqpznndwtroUkZSy7jVGfzA+1bC7YNaVBc9Uu8Rh4twFtuTxgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;1 T9K3kTj703RsKij1Aa4d Q&quot;
        title=&quot;1 T9K3kTj703RsKij1Aa4d Q&quot;
        src=&quot;/static/5a5fba6c900c2d1d86b4ee97bf4f5227/fcb94/1_T9K3kTj703RsKij1Aa4d-Q.png&quot;
        srcset=&quot;/static/5a5fba6c900c2d1d86b4ee97bf4f5227/4dcb9/1_T9K3kTj703RsKij1Aa4d-Q.png 188w,
/static/5a5fba6c900c2d1d86b4ee97bf4f5227/5ff7e/1_T9K3kTj703RsKij1Aa4d-Q.png 375w,
/static/5a5fba6c900c2d1d86b4ee97bf4f5227/fcb94/1_T9K3kTj703RsKij1Aa4d-Q.png 452w&quot;
        sizes=&quot;(max-width: 452px) 100vw, 452px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;上面的例子使用了 &lt;strong&gt;基于行的放置（line-based placement）&lt;/strong&gt;，使用列的数组索引来放置 itmes。
item1和 item2被放置在水平的line1 和 line2中，垂直的line1，line3和 line3，line5中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果我们持续增加 item 的数量，会发生什么呢？但是我们并没有定义多余的网格来容纳它们。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 453px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/61b082b0e7532b230b3c3eacb6d5621e/2108e/1_iqlMwj0VrgJQtZfGf8boaA.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 86.17021276595744%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3klEQVQ4y62T2W7bMBBF/f//1ociaVLbsevUsS0us5HaxaWlJCMpULR96ICALnl1NDMUuUlTSn3MIS8jdiFNaZ1OOXXvVupCGu/WmGIXNznmXjpGFhQGennYX99ujpygOHLe+kWgge3nbfVWOXKM7NDNcM6tayxYQChDQYlZIyEbWtcJQAPYoi1aQozDCrfl/TlAFWoJIhLL9wmCBrTFAwRGimPc5DTDdwKqX2A2H2AFaEo5K/zXzPyHzP8Pht/B5l9gBGKaGysbSkxLLJlXa4aLLp9aNmxKHbaoUV80WaJrAezVmJsREKcdqtXiG7Emc9VWWTES6rDJIfe+t9psn3Zaaw/ixR13h9Px5EQ8enWtvj5vrbUeHQO/bPfn72dHLvYffhVRqYfNXCLhWvbcc7EIBZgsvpe99uxbuAfb0u6il0OyaMQVXi24H5LOt+UkChOT2PJgWYdYKYsiJCQohCROeDZL5jTEHnuq4PB4QIV15Wvwp+fj6/61tq5WtTmr3cMOK2y0pysevhwu3y5OSXChwAP16nR7/PSkLqrVdWimBuuG29CME4+D62vwYzNMMo4y1FB3rpvcEH3YpJBiH8MYpmEKU4hdKNc15pzmO9ynVcechlSuepqnU/5Z9g9Aeb9vYXBcCwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;1 iqlMwj0VrgJQtZfGf8boaA&quot;
        title=&quot;1 iqlMwj0VrgJQtZfGf8boaA&quot;
        src=&quot;/static/61b082b0e7532b230b3c3eacb6d5621e/2108e/1_iqlMwj0VrgJQtZfGf8boaA.png&quot;
        srcset=&quot;/static/61b082b0e7532b230b3c3eacb6d5621e/4dcb9/1_iqlMwj0VrgJQtZfGf8boaA.png 188w,
/static/61b082b0e7532b230b3c3eacb6d5621e/5ff7e/1_iqlMwj0VrgJQtZfGf8boaA.png 375w,
/static/61b082b0e7532b230b3c3eacb6d5621e/2108e/1_iqlMwj0VrgJQtZfGf8boaA.png 453w&quot;
        sizes=&quot;(max-width: 453px) 100vw, 453px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;网格不断根据需要添加的行和列。需要注意的是，这些新的轨道的大小依赖于内容的大小。到目前为止这一切都很好，但是在涉及到 CSS 网格的时候，真正有用的是我们之前看到的网格区域。接下来让我们看看如何在CSS中使用网格区域。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;首先你需要定义网格的容器，轨道和面积。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.container {
  display: grid;
  grid-template-rows: 100px auto 100px;
  grid-template-columns: 100px auto;
  grid-template-areas:
    &amp;quot;header  header&amp;quot;
    &amp;quot;sidebar content&amp;quot;
    &amp;quot;footer  footer&amp;quot;;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;我们定义了三行两列，顶部和底部的每一行高度设置为100px，中间部分高度自适应它的内容。左边一列的宽度设置为100px，第二列的宽度自适应它的内容。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;真的是翻不下去了，这个歪果仁好多废话。。。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;用ascii来表示：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;+---+---+
| . | . |
+---+---+
| . | . |
+---+---+
| . | . |
+---+---+&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;每一个点代表一个单元格，这些单元格可以定义区域。让我们针对一个典型的网站布局来定义网格区域。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;+--------+--------+
| header | header |
+--------+--------+
| sidebar| content|
+--------+--------+
| footer | footer |
+--------+--------+&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;我们想让 header 和 footer 横跨占据整个宽度，所以在两列中重复定义了它们。现在，如果我们将多余的 ascii风格的边框去掉，用双引号把每一行包起来，可以得到下面这样的：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;quot;header  header&amp;quot;
&amp;quot;sidebar content&amp;quot;
&amp;quot;footer  footer&amp;quot;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这就是如何在 CSS中使用grid-template-areas定义网格区域。你可以使用&lt;code&gt;.&lt;/code&gt;来表示特定单元格不被包含在区域中。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.container {
  display: grid;
  grid-template-rows: repeat(5, 100px);
  grid-template-columns: repeat(5, 100px);
  grid-template-areas:
    &amp;quot;. . . . .&amp;quot;
    &amp;quot;. . . . .&amp;quot;
    &amp;quot;. . a . .&amp;quot;
    &amp;quot;. . . . .&amp;quot;
    &amp;quot;. . . . .&amp;quot;;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在这个例子中，一共有25个单元格和一个只占据了最中间单元格的区域。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;现在回到之前的 header，sidebar，content，footer 的例子，让我们来增加一些标签：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;div class=&amp;quot;container&amp;quot;&amp;gt;
  &amp;lt;div class=&amp;quot;header&amp;quot;&amp;gt;header&amp;lt;/div&amp;gt;
  &amp;lt;div class=&amp;quot;sidebar&amp;quot;&amp;gt;sidebar&amp;lt;/div&amp;gt;
  &amp;lt;div class=&amp;quot;footer&amp;quot;&amp;gt;footer&amp;lt;/div&amp;gt;
  &amp;lt;div class=&amp;quot;content&amp;quot;&amp;gt;
    &amp;lt;p&amp;gt;Lorem ipsum dolor sit amet...&amp;lt;/p&amp;gt;
 &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;最后需要做的事情就是将每个网格项目定位到正确地命名的区域中（为了方便，我们使用了和区域名相同的 CSS类名）；&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.header { grid-area: header; }
.sidebar { grid-area: sidebar; }
.footer { grid-area: footer; }
.content { grid-area: content; }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这会形成像下面这样的布局：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d5e3bcdc3d00128b840592551640dfc6/0b533/1_3mqdeWGgegfStF9MZ9w0Bw.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 89.36170212765957%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzklEQVQ4y72TW5ObIBzF9/t/tbY7qzGCchFQo7PxFhMU5JLWddMmnfYhfeh5YP5cfswBDi/GGKWU1to9KWvti9aasays6uuTcs69eO+v/6QVds6tpf+ztpn71t9Wr7attcuil8VYaz/O4p3z3rtb13l/3Upj7coYux14hZdl4SwrDwfv/TxPCYiLvKjrGmE8nscEwqp+b9tGCMEy1nV9noskSRHGdrP906GUMoqCMAw5FwCAojiwjKcJqg4VgDAv8hQjjEkYhnEcG2sfLkzNM0aIM0oJJQhlhDXHI6GMEIIJ4YLlQqQw5UIopax7hPWi27btun7o+7brur47fej43nRrtx+GfhhOp2EYx/H3p5rnCcS7GMAkSWIAguANYyo4T9MUALiPIkwJBCCBCYRgMeYBPp9HhPGhLDElbdO8vr6VVZ0LHkRBxnhdVSyj+ygSRUloprV6gOU0EUx3uzDFKIZxvAc8YwBAQlAYBASTb1+/UJoRilKErH20LaUUgmGE99G+aZt5nudpGoZBKSXlZZLycrkopaZpklJ+hmSLzPrqxhizbHnYtruP123ks1hhpRTjvB/G+4z+Pa+/tMLOOa0Xa91//1VbxN3z+mH7O1HaB3zxaY+zAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;1 3mqdeWGgegfStF9MZ9w0Bw&quot;
        title=&quot;1 3mqdeWGgegfStF9MZ9w0Bw&quot;
        src=&quot;/static/d5e3bcdc3d00128b840592551640dfc6/0b533/1_3mqdeWGgegfStF9MZ9w0Bw.png&quot;
        srcset=&quot;/static/d5e3bcdc3d00128b840592551640dfc6/4dcb9/1_3mqdeWGgegfStF9MZ9w0Bw.png 188w,
/static/d5e3bcdc3d00128b840592551640dfc6/5ff7e/1_3mqdeWGgegfStF9MZ9w0Bw.png 375w,
/static/d5e3bcdc3d00128b840592551640dfc6/0b533/1_3mqdeWGgegfStF9MZ9w0Bw.png 500w&quot;
        sizes=&quot;(max-width: 500px) 100vw, 500px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果我们想修改布局或者让布局自适应屏幕的尺寸，我们只需要修改网格的申明，比如这样：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.container {
  display: grid;
  grid-template-rows: auto;
  grid-template-columns: 100%;
  grid-template-areas:
    &amp;quot;header&amp;quot;
    &amp;quot;sidebar&amp;quot;
    &amp;quot;content&amp;quot;
    &amp;quot;footer&amp;quot;;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;没有修改其他任何的 CSS和标签，就能够得到下面这样的布局：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 289px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/54a2b704aae8c2cf15f6c00f95b3b911/c969a/1_9L3FlV6ttO-5ZLM3cZNp1A.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 161.17021276595747%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAgCAIAAACdAM/hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEC0lEQVQ4y5VVZ7fiNhDl//+uTRZwlWRZttx7AVMMCy4qieE9lpzkZN/eDz5zZM9oyp3r1TzPQgj5Cf5lTNO0EkIeupZ6nkVwFCdvcX6BeZ5XnPPbjz6OkzCOyqqW8necx3F8T5t9GeM4rqZpYmy+3xaM08jY79Qspdy1jaast+oaAPNyG6SUX6l8SXue52eYJ7gQr9jiZX8a4s1Ybn6vWQgxz/PLZoy95scYfz8RQgzDsHT7+uNSFkWWpKfjcZqmPMuzLC3LmnOeplkeR7dhvFwueVFyzsM4SLKkP/ec85Xg4ng6OoTYCBV5UVelYYAwDLpdNwx3YBoIwu5wLIoiTlLGWJQEirqt6lpIuRJCdLs9QsCysQkQMDULk+v1LqXc71pd335XDI/6uqaGQSilnKbJ0M3ucBBcrISU+7axIcQOsbCVxImU0nWIYVkPw91slJmzPAna4/m4b3VDA7qeZznjfKn5cu4ppZ7vqlulKouu65AJbexQl55OfZYX5+PJoe65v0ZBqJsGQuhwOgkhljlXVaHr6laH2/XGIcRxHZsQCEwAoEe9NI5dl+q6FscJtrCq61EURmE4M74sxm7XWAiaADvERRCbEPihH4R+4PsY4ygIbEJCP9i1bV03TdP0/aU/naZ5fjRs3/mUUkIwJnlW+oEfxlFelL5HgygK4yxJknGc/oNhnzznr+l/vhUPeoj3PX8y7PnN4iylbHeNBQGECEFoQSTEEoiz2Qt8CM21ujEhGqdxORSiygsIYNU0fBmVkN2+NUwNYKiqJkIgisJhYr7vOdhWNL1qmizNLIQcL+CMt3X1/c/vcZIwxpeb67LQFMX1aV23tm37Lg3COC/yMAo9P+77PgzCqqwsbO/bJk0iZFl5UT67Lbr9Xllvoii63+/UcZSNgm37cumJ69RVe730QRC0bZOmqUMQtgiEZlm37Ol8Oh5URW2a+na72whZGN+Hcd/uEITDMJ77s7Xwz10I2zUmJNhCddssJBFCHA4HYmNoAEXRw8D3XDfJMo9SjG1tq2Z5ZdvYdx0IALChgwmyrKIo55kt3D60rY0QwkTTlCBKpZB5liqKcuzP5+MRAOAQh3p0mMYsS3QDqNt1VjaMPZy7pgG6purG0qQku90G20YGAIeuc13PNFRd0wFEt0vvufTbtz90TS2q+oPbTVkgw0AId12XpXlZlMgCxCZllm42qu871PM8Sst46f52vbVsfLleFjFYSNLWpgmo6ziOi5aFMKM4ydPE9ynEJM1ShzhBGPmuY2MbAJQV+XOxPzTsxb4PyI/Hk7D8IWDiQ1XFT+l9F8CH0P2O6D/2ucIYmQD3/fWfu/Er3WaM3W633a6tqmb41979D5a0F6Hn/PWjmr+Mv53/AhDN9R6gjQVPAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;1 9L3FlV6ttO 5ZLM3cZNp1A&quot;
        title=&quot;1 9L3FlV6ttO 5ZLM3cZNp1A&quot;
        src=&quot;/static/54a2b704aae8c2cf15f6c00f95b3b911/c969a/1_9L3FlV6ttO-5ZLM3cZNp1A.png&quot;
        srcset=&quot;/static/54a2b704aae8c2cf15f6c00f95b3b911/4dcb9/1_9L3FlV6ttO-5ZLM3cZNp1A.png 188w,
/static/54a2b704aae8c2cf15f6c00f95b3b911/c969a/1_9L3FlV6ttO-5ZLM3cZNp1A.png 289w&quot;
        sizes=&quot;(max-width: 289px) 100vw, 289px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;后续的内容将的是 dribbble 对这个属性的实际应用，大家可以移步原文链接阅读&lt;/p&gt;
&lt;/blockquote&gt;</content:encoded></item><item><title><![CDATA[JavaScript 中不使用 new 的构造函数（以及由此引发的联想）]]></title><description><![CDATA[在JavaScript 中，调用构造函数的方法很简单。 但是，要知道: new关键词的使用与否，产生的效果是不一样的。输出p1和p2可以很清楚的看到，
p1指向的是一个对象，这个对象的构造函数是Point()，而p2返回的是undefined。仔细一想其实也很好理解。不带ne…]]></description><link>https://zhanglun.github.io/blogs/JavaScript中不使用new的构造函数/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/JavaScript中不使用new的构造函数/</guid><pubDate>Wed, 28 Jan 2015 21:09:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;在JavaScript 中，调用构造函数的方法很简单。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function Point(x, y){
  this.x = x;
  this.y = y;
}

// 调用Point构造函数
// 使用new 关键字
var p1 = new Point(20, 30);
// 不使用new 关键字
var p2 = Point(20, 30);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;但是，要知道: new关键词的使用与否，产生的效果是不一样的。输出p1和p2可以很清楚的看到，
p1指向的是一个对象，这个对象的构造函数是Point()，而p2返回的是&lt;code&gt;undefined&lt;/code&gt;。仔细一想其实也很好理解。不带new关键字的调用，实质上与调用普通的方法函数无异，关键之处在于调用时，所处的作用域为全局作用域，this指向了window，也就是说，这次调用发生之后，平白无故的为window对象增添了两个属性x和y。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了解决这种问题，可以在构造函数中检查当前作用域，也就是this指向何处。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function Point(x,y) {
  if (this instanceof Point) {
    this.x = x;
    this.y = y
  } else {
    return new Point(x,y);
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这样一来，即使在不使用new的情况下，构造函数也会自动使用new关键字。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;说到这，让我有了探究new 操作符和this相关的知识点！！！&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;JavaScript中的new&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#JavaScript%E4%B8%AD%E7%9A%84new&quot; aria-label=&quot;JavaScript中的new permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;JavaScript中的new&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;new操作符用来创建对象类型的一个实例，无论是用户自定义的对象类型还是内建对象类型，前提是得要有对象的构造函数。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;基本语法如下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;new constructor[([arguments])]  //可以看到调用时，构造函数后面的括号和参数都可选的&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;使用new创建一个用户自定义对象的实例是有以下两个步骤：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;编写构造函数，定义对象类型&lt;/li&gt;
&lt;li&gt;使用new操作符创建该对象的一个实例&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;在自定义对象类型的时候，需要创建一个函数，指明对象的名字（也就是函数名）以及属性。要知道，一个对象的属性可以来自另外的一个对象。来看看下面的例子。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当语句&lt;code&gt;new foo(...)&lt;/code&gt;在执行的时候，会发生下面的事情：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;创建一个新的对象，继承自&lt;code&gt;foo.prototype&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;foo的constructor被调用，如果有指定的参数就传入参数；同时&lt;code&gt;this&lt;/code&gt;与新创建的对象绑定在一起。在没有指定参数的情况下，&lt;code&gt;new foo&lt;/code&gt; 和&lt;code&gt;new foo()&lt;/code&gt;是相等的。在Backbone的教程中经常看到不带括号的调用。&lt;/li&gt;
&lt;li&gt;新的对象通过contructor函数，作为整个表达式的结果返回。如果contructor函数没有明确指出返回特定的对象，那么返回在第一步中创建的对象。一般来说，constructor没有返回一个值，但是可以指定返回的值来覆盖原本的对象。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;###JavaScript中的this&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;关于this，水平有限，只是稍微了解一点js中的this。在大多数情况，this的值由函数的地阿英方式决定。this在执行期间不能被复制，每次函数调用的时候this的值也有可能会不同。它可以是全局的，当前对象或者任意对象，完全取决函数的调用方式。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;全局上下文&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%85%A8%E5%B1%80%E4%B8%8A%E4%B8%8B%E6%96%87&quot; aria-label=&quot;全局上下文 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;全局上下文&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;在全局上下文中，this指代的是全局对象。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;console.log(this.doucment === document);   //true
console.log(this === window);   // true
this.name = &amp;#39;window name&amp;#39;
console.log(window.name);  // window name &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;函数上下文&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%87%BD%E6%95%B0%E4%B8%8A%E4%B8%8B%E6%96%87&quot; aria-label=&quot;函数上下文 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;函数上下文&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;在函数内部，this的值取决于函数是如何调用的。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function fun(){
  return this;
}
fun() === window; // 全局对象&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;fun()调用时并不能决定this的值，因为代码不在严格模式下，this的值总是一个对象且默认为全局对象。而在严格模式下，this 的值根据运行时的上下文决定，如果没有定义this将是undefined。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们常看到类似这样的代码，声明一个全局的对象作为命名空间将一些属性方法什么的都绑定到这个对象上，借此来减少全局变量。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var o = {
  prop: 37,
  f: function() {
    return this.prop;
  }
};

console.log(o.f()); // logs 37&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当函数以对象中的方法的当时调用时，它们的this由调用该函数的对象进行设置。所以在上面的代码中，当f以对象o的方法调用时，this指向的便是o对象。在何处或者如何定义函数完全不会影响到this的行为。因为this的值去决定于调用函数的对象，这意味下面这么做this的行为也是一致的：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var o = {prop: 37};
function independent(){
  return this.prop;
}

o.f = independent;

console.log(o.f()); // 输出37&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;类似的，this的绑定只受最靠近的成员引用的影响。在下面的这个例子中，我们以对象o中的b对象中的g方法来调用independent方法。在这次执行期间，函数中的this将指向o.b。事实上，这与对象本身的成员没有多大关系，最靠近的引用才是最重要的。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;o.b = {g: independent, prop: 42};
console.log(o.b.g()); // logs 42&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;相同的概念在定义在原型链中的方法也是一致的。如果该方法存在于一个对象的原型链上，那么this指向的是调用这个方法的对象，表现得好像是这个方法就存在于这个对象上一样。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var o = {f:function(){ return this.a + this.b; }};
var p = Object.create(o);
p.a = 1;
p.b = 4;

console.log(p.f()); // 5&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在这个例子中，对象p没有属于它自己的f属性，它的f属性继承自它的原型。但是这对于最终在o中找到f属性的查找过程来说没有关系；查找过程首先从p.f的引用开始，所以函数中的this指向p。也就是说，因为f是作为p的方法调用的，所以它的this指向了p。这是JavaScript的原型继承中的一个有趣的特性。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;构造函数中的this&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E4%B8%AD%E7%9A%84this&quot; aria-label=&quot;构造函数中的this permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;构造函数中的this&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;当一个函数被作为一个构造函数来使用（使用new关键字），它的this与即将被创建的新对象绑定。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;注意：当构造器返回的默认值是一个this引用的对象时，可以手动设置返回其他的对象，如果返回值不是一个对象，返回this。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function A(){
  this.name = &amp;#39;zhanglun&amp;#39;;
}
var a = new A();

console.log(a);  // A {name: &amp;#39;zhanglun&amp;#39;}

// 手动设置返回一个1
function B(){
  this.name = &amp;#39;zhanglun&amp;#39;;
  return 1
}
var b = new B();

console.log(b);  // B {name: &amp;#39;zhanglun&amp;#39;}

function C(){
  this.name = &amp;#39;zhanglun&amp;#39;;
  return {}
}
var c = C();

console.log(c); // Object {}
&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;call-and-apply&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#call-and-apply&quot; aria-label=&quot;call and apply permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;call and apply&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;当一个函数的函数体中使用了this关键字时，通过所有函数都从Function对象的原型中继承的call()方法和apply()方法调用时，它的值可以绑定到一个指定的对象上。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function add(c, d){
  return this.a + this.b + c + d;
}

var o = {a:1, b:3};

add.call(o, 5, 7); // 1 + 3 + 5 + 7 = 16

add.apply(o, [10, 20]); // 1 + 3 + 10 + 20 = 34&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[规范之路-line-height的工作原理]]></title><description><![CDATA[有人问我，“line-height到底是怎么一回事？”，“元素高度到底是怎么计算出来的？”。我说不出个所以然…… 故有此文 首先有一点我们需要明白的是：在标准的盒模型中，height属性定义的是盒子中内容的高度。而line-height属性只能作用在行级的非替换元素上（什么是非…]]></description><link>https://zhanglun.github.io/blogs/规范之路-行高的工作原理/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/规范之路-行高的工作原理/</guid><pubDate>Thu, 20 Nov 2014 11:45:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;有人问我，“line-height到底是怎么一回事？”，“元素高度到底是怎么计算出来的？”。我说不出个所以然……&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;故有此文&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;首先有一点我们需要明白的是：在标准的盒模型中，height属性定义的是盒子中内容的高度。而line-height属性只能作用在行级的非替换元素上（&lt;a href=&quot;http://stackoverflow.com/questions/8012297/html5-non-replaced-vs-replaced-element&quot; class=&quot;link-underline&quot;&gt;什么是非替换元素&lt;/a&gt;），指定了元素形成的line box的最小高度。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;常见的例子就是大段的文本了，当你对一个段落设置了固定的高度时，要么内容不多底部出现了空白，要么内容太多溢出了容器，这也是显而易见的。但是在这种情况下，是无法直接影响到文本的排版。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;一个没有设置高度的段落，当包含文字的时候，它会自动获得一个恰好可以包裹着文本内容的高度。其本质是文本形成的line box具有高度而将段落撑开。此时，line box的潜在的高度的决定因素就是&lt;code&gt;line-height&lt;/code&gt;。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;那么到底line-height是如何工作的呢&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%82%A3%E4%B9%88%E5%88%B0%E5%BA%95line-height%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84%E5%91%A2&quot; aria-label=&quot;那么到底line height是如何工作的呢 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;那么到底line-height是如何工作的呢？&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;先来看看W3C官方给出的解释：&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;The height of a line box is determined as follows:&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;The height of each inline-level box in the line box is calculated. For replaced elements, inline-block elements, and inline-table elements, this is the height of their margin box; for inline boxes, this is their ‘line-height’. (See “Calculating heights and margins” and the height of inline boxes in “Leading and half-leading”.)&lt;/li&gt;
&lt;li&gt;The inline-level boxes are aligned vertically according to their ‘vertical-align’ property. In case they are aligned ‘top’ or ‘bottom’, they must be aligned so as to minimize the line box height. If such boxes are tall enough, there are multiple solutions and CSS 2.1 does not define the position of the line box’s baseline (i.e., the position of the strut, see below).&lt;/li&gt;
&lt;li&gt;The line box height is the distance between the uppermost box top and the lowermost box bottom. (This includes the strut, as explained under ‘line-height’ below.)&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;大致的意思是,一个line box的高度有下面列举的情况来决定：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;对于可替换元素，inline-block元素和inline-table元素，高度又它们的外边距盒子的高度来决定；而对于inline盒子来说，高度由&lt;code&gt;line-height&lt;/code&gt;决定&lt;/li&gt;
&lt;li&gt;行级盒子使用&lt;code&gt;vertical-align&lt;/code&gt;属性来对齐时，如果是顶部或者底部对齐，line box的高度会达到它的最小值。如果盒子的高度足够高，则存在多种情况，同时在CSS2.1中并没有定义line box基线的位置&lt;/li&gt;
&lt;li&gt;line box 的高度是最顶部的盒子顶部到最底下的盒子的底部&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;CSS假定每一种字体的字体规格，指定了一个在基线上方的高度和基线下方的depth（也就是两个值）。通俗的来说，就是字体占据高度，基线从所占据的高度穿过。假设用A代表基线上方的高度（指定大小的具体字体），D代表基线下方的depth，同时&lt;code&gt;AD = A + D&lt;/code&gt;代表从上到下的距离。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在非替代元素中，用户代理一定会将所有的图像字符基于他们的基线对齐。对于每一个文字形成的字符图形来说，决定了A和D。这里所说的字符图形（glyph）是一个单独的元素可能由不同的字体组成，他们的A和D不一定相同。如果一个行级盒子没有任何的字符图形（glyph），我们认为它将包含一个&lt;code&gt;strut&lt;/code&gt;(一个宽度为零，高度为AD的不可见的glyph)。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;每一个字符图形都定义了一个&lt;code&gt;leading L&lt;/code&gt;，其中 &lt;code&gt;L = &apos;line-height&apos; - AD&lt;/code&gt;。leading的一半添加到A的上面，另一半添加到D的下面。所以最终呢，在基线之上&lt;code&gt;A&apos; = A + L/2&lt;/code&gt;，在基线之下&lt;code&gt;D&apos; = D + L/2&lt;/code&gt;。说的直白一点，就是字体本身占据高地，当添加了line-height属性之后，L不能为负数。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;inline 盒子的高度将所有的字符图形和它们上下的 &lt;code&gt;hadf-leading&lt;/code&gt; 包裹在一起，这个高度就是我们说的“行高”（这一行的高度，不等同于line-height的值）。盒子的子元素不受这个高度的影响，&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;尽管margin，padding和border不会纳入inline box的高度的计算中，但是它们依旧会在盒子周围渲染。这意味这，如果指点高度的line-height的值比盒子的内容的高度小，那么padding和border的背景和颜色会流入到邻接的line box中。因为渲染顺序的关系，导致后面的line box 的boderh会覆盖前面line box的border和文本。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;line-height的值&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#line-height%E7%9A%84%E5%80%BC&quot; aria-label=&quot;line height的值 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;line-height的值&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;说了这么多，现在来看看line-height的使用&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;line-height呢有这么几个值&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;** normal**：告诉用户代理，在元素字体的基础上，将&lt;code&gt;used value&lt;/code&gt;设置为一个“合理的值”，这个值和’&amp;#x3C;\number&gt;‘，有相同的意义。我们建议将normal的&lt;code&gt;used value&lt;/code&gt;设置在1.0至1.2.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;length&lt;/strong&gt;：指定一个数值用于计算line box的高度，不能为负值&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;number&lt;/strong&gt;：属性的&lt;code&gt;used value&lt;/code&gt;是值与字体大小的乘积，不能为负值&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;percentage&lt;/strong&gt;：属性的&lt;code&gt;computed value&lt;/code&gt;是当前元素字体计算值的百分比，同样也不能使用负值&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;当一个元素中的文本包含不止一种字体时，用户代理可能会根据最大的字体大小来设置line-height的&lt;code&gt;normal&lt;/code&gt;值。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Specified-computed-and-actual-values的简单解释&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Specified-computed-and-actual-values%E7%9A%84%E7%AE%80%E5%8D%95%E8%A7%A3%E9%87%8A&quot; aria-label=&quot;Specified computed and actual values的简单解释 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Specified, computed, and actual values的简单解释&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;当用户代理解析一个文档，创建出一个DOM树时，针对当前的媒体设备，为每一个元素的每一个属性指定一个属性值。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;元素属性最终的值取决于一个“四步计算”的结果：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;浏览器对元素设置的默认样式（‘specified value’）&lt;/li&gt;
&lt;li&gt;使用继承自祖先元素的值（‘computed value’）&lt;/li&gt;
&lt;li&gt;如果有必要，转换成一个绝对的值（‘used value’）&lt;/li&gt;
&lt;li&gt;最后根据当时的环境转换属性值（‘actual value’）&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;参考：&lt;br&gt;
&lt;a href=&quot;http://www.w3.org/TR/CSS2/visudet.html#line-height&quot; class=&quot;link-underline&quot;&gt;W3C line-height&lt;/a&gt;
&lt;a href=&quot;http://www.w3.org/TR/CSS2/cascade.html#used-value&quot; class=&quot;link-underline&quot;&gt;W3C Assigning property values&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[定时将图片保存在SAE的Storage中]]></title><description><![CDATA[前几天一直在看Node相关的书，做了一些笔记，挂在自己的博客上。挺累的，毕竟看的是两本英文的书。而且疲了，一时间学的太猛，以至于晕头转向的。Node中我觉得有一个很麻烦的问题就是：包太多，更新速度也是参差不齐，有的一直在维护，有的已经很长时间不变化，太乱了。光一个MySQL的模…]]></description><link>https://zhanglun.github.io/blogs/定时将图片保存在SAE的Storage中/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/定时将图片保存在SAE的Storage中/</guid><pubDate>Mon, 10 Nov 2014 19:27:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;前几天一直在看Node相关的书，做了一些笔记，挂在自己的博客上。挺累的，毕竟看的是两本英文的书。而且疲了，一时间学的太猛，以至于晕头转向的。Node中我觉得有一个很麻烦的问题就是：包太多，更新速度也是参差不齐，有的一直在维护，有的已经很长时间不变化，太乱了。光一个MySQL的模块就好多好多好多个。怎么说呢，感觉模块什么的都不太需要太在意，重要的是理解Node的一些本质，虽然我现在还不清楚有些什么很重要的本质，总之慢慢来吧。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;反观python，虽然我只是也业余的python玩家，但是我也看出来了，python的很多套路都比较稳定，做起来的话踩的坑比较少，对于想我这种渴望从代码中找到成就感的屌丝来说还是很不错的。所以歇了两天之后能开始玩python&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;之前尝试用python来做一个网站，网站干嘛的我自己也不清楚，只想借机多了解一点后端的技术。然后我决定利用知乎日报的数据来给自己做一个“纸糊日报”。其他的什么就先不说了，之前做的时候，没有掌握Evernote的使用技巧，也就没有想着做笔记。不过现在不一样了，我有特殊的做笔记技巧。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;问题来了在本地开发保存图片的尴尬&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%97%AE%E9%A2%98%E6%9D%A5%E4%BA%86%E5%9C%A8%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E4%BF%9D%E5%AD%98%E5%9B%BE%E7%89%87%E7%9A%84%E5%B0%B4%E5%B0%AC&quot; aria-label=&quot;问题来了在本地开发保存图片的尴尬 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;问题来了：在本地开发，保存图片的尴尬&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;原本只是利用webpy自带的小小服务器在本地开发，但是遇到一个问题就是，抓到图片原始路径之后，没办法直接在页面上使用，因为没有权限在知乎以外的站点使用。然后我也不知道怎么解决这种问题啊，当时为了能早点看到效果，写了一个脚本把图片保存到一个指定的路径，再从这个地方引用。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;那么问题来了，每过一天，打开电脑之后，我都要单独地手动地执行一次脚本，我很蛋疼！！更重要的是，如果我放到线上之后，还要把所有的图片都传上去嘛！！&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;转机本地和SAE线上同步开发&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%BD%AC%E6%9C%BA%E6%9C%AC%E5%9C%B0%E5%92%8CSAE%E7%BA%BF%E4%B8%8A%E5%90%8C%E6%AD%A5%E5%BC%80%E5%8F%91&quot; aria-label=&quot;转机本地和SAE线上同步开发 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;转机：本地和SAE线上同步开发&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;然后我也没有什么好办法，就荒废下去了。昨天呢，突然意识到，发布到线上我也只有放在SAE啊，毕竟穷屌丝……。SAE支持Python开发，可以使用webpy这一小巧的框架；提供MySQL和Storage服务，Stroage最少都有10G的容量，这应该够了吧。
所以安排如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;将本地的代码，转移到SAE上&lt;/li&gt;
&lt;li&gt;将图片保存到Stroage中而不是代码目录里&lt;/li&gt;
&lt;li&gt;日后可能使用MySQL服务&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;构建SAE中webpy的本地开发&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9E%84%E5%BB%BASAE%E4%B8%ADwebpy%E7%9A%84%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91&quot; aria-label=&quot;构建SAE中webpy的本地开发 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;构建SAE中webpy的本地开发&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;webpy在本地运行和在SAE中运行有点不同，&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;# 本地
app = web.application(urls, globals())
if __name__ == &amp;quot;__main__&amp;quot;:
    app.run()


# SAE
app = web.application(urls, globals()).wsgifunc()
application = sae.create_wsgi_app(app)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;将两者合并，我们得到一个既可以直接在本地运行，又可以直接在SAE运行的代码：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;app = web.application(urls, globals())
if __name__ == &amp;quot;__main__&amp;quot;:
    app.run()
else:
    import sae
    application = sae.create_wsgi_app(app.wsgifunc())
&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;SAE上的Python应用的入口为 &lt;code&gt;index.wsgi:application&lt;/code&gt; ，也就是 &lt;code&gt;index.wsgi&lt;/code&gt; 这个文件中名为 &lt;code&gt;application&lt;/code&gt; 的对象。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在本地，我可以运用&lt;code&gt;code.py&lt;/code&gt;，但是在SAE上的入口是&lt;code&gt;index.wsgi&lt;/code&gt;。在&lt;a href=&quot;http://www.liaoxuefeng.com/article/00137389260145256f699d538ae4fd3910be06d2753b192000&quot; class=&quot;link-underline&quot;&gt;这篇博客&lt;/a&gt;上看到了解决方案，菜鸟表示，不太明白怎么回事，我还是先乖乖拷贝吧。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;将图片存至Storage&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B0%86%E5%9B%BE%E7%89%87%E5%AD%98%E8%87%B3Storage&quot; aria-label=&quot;将图片存至Storage permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;将图片存至Storage&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;图片的抓取就不多说了。假设已经拿到了图片的地址&lt;code&gt;http://pic4.zhimg.com/e80a34cf13d590dea72ad5e1dfb66bac.jpg&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;SAE提供了Storage的使用帮助文档，&lt;a href=&quot;http://sae.sina.com.cn/doc/python/storage.html#module-sae.storage&quot; class=&quot;link-underline&quot;&gt;这里是Python的文档&lt;/a&gt;，简单明了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;所以我的代码是酱紫的：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;def saveimagetostorage(url):
    # 去掉 ‘http://’
    file_path = url[6:]
    # 文件夹
    dir_path = re.match(r&amp;#39;/\w+(\.\w+){0,}\/&amp;#39;, file_path).group(0)
    # 获取文件名
    file_name = file_path[len(dir_path):]

    if &amp;#39;SERVER_SOFTWARE&amp;#39; in os.environ:
        # import sae
        from sae.storage import Bucket
        bucket = Bucket(&amp;quot;zhihudaily&amp;quot;)
        # 存取一个文件到bucket中
        fr = urllib.urlopen(url)
        stream = fr.read()
        bucket.put_object(dir_path[1:]+file_name, stream)
        return bucket

    else:
        mkdir(save_path)
        print file_path
        print &amp;#39;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;#39;
        print url
        urllib.urlretrieve(url, imagePath + file_path)
        return &amp;quot;LocalHost&amp;quot;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;核心代码就是这些：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;from sae.storage import Bucket
bucket = Bucket(&amp;quot;storage的名字&amp;quot;)
fr = urllib.urlopen(url)
stream = fr.read()
bucket.put_object(dir_path[1:]+file_name, stream)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;如何定时&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E5%AE%9A%E6%97%B6&quot; aria-label=&quot;如何定时 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何定时？&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;SAE提供了&lt;a href=&quot;http://zh.wikipedia.org/wiki/Cron&quot; class=&quot;link-underline&quot;&gt;Cron(wiki)&lt;/a&gt;服务，SAE的相关文档在&lt;a href=&quot;http://sae.sina.com.cn/doc/php/cron.html&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;。这个Cron就是用来设置周期性被执行的指令的。之前每次都是手动的执行脚本来保存图片，麻烦的要死，既然已经可以图片存到SAE上了，何不再利用SAE提供的便利服务来定时执行保存的操作呢？&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;Cron服务是SAE为开发者提供的分布式计划任务服务，用来定时触发开发者的特定动作，满足比如定时计算排行榜等需求。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;Cron的执行是以HTTP方式触发的，触发后真正执行的是用户在应用的HTTP的回调函数。Cron服务是分布式环境部署的，具有高可靠性，多点之间相互隔离且同时触发，并且通过分布式锁进行选举并最终由一个健康节点执行。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;Cron的应用场景主要是让用户可以在指定的时间执行一些计划任务。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;* 每隔一定时间执行，如每隔2个小时执行1次。
* 在某个特定时间点执行，如每周二晚上9:10执行。&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;我可以在应用的配置文件 &lt;code&gt;config.yaml&lt;/code&gt; 中来添加Cron。例如：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;name: crontest
version: 1
cron:
- description: cron_test
  url: /cron/make
  schedule: &amp;quot;*/5 * * * *&amp;quot;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;添加了一个Cron任务， 该任务每5分钟执行 &lt;a href=&quot;http://crontest.sinaapp.com/cron/make&quot; class=&quot;link-underline&quot;&gt;http://crontest.sinaapp.com/cron/make&lt;/a&gt; 一次。具体如何配置可以文档给出的&lt;a href=&quot;http://sae.sina.com.cn/doc/php/cron.html#id3&quot; class=&quot;link-underline&quot;&gt;例子&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在我的代码中，我设置的是每一个小时抓取一次图片，所以是酱紫的：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;name: daily
version: 1
cron:
- description: daily
  url: /api/save_image
  schedule: &amp;quot;0 */1 * * *&amp;quot;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;注意:Cron使用HTTP GET方式请求URL&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Node学习笔记-Wrangling the File System]]></title><description><![CDATA[在开发过程中，有时候会需要访问一些本地的文件，对文件进行一些操作。现在来对这方面的问题展开学习。下面是几个简单的例子，包括监听文件的变化和读取命令行中的参数 监听文件的变化 不急着动手，先想想如果做。首先，Node需要访问本地的文件，访问到文件后才有办法监听。Node自带fs模…]]></description><link>https://zhanglun.github.io/blogs/Node学习笔记-Wrangling the File System/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/Node学习笔记-Wrangling the File System/</guid><pubDate>Fri, 07 Nov 2014 17:29:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;在开发过程中，有时候会需要访问一些本地的文件，对文件进行一些操作。现在来对这方面的问题展开学习。下面是几个简单的例子，包括监听文件的变化和读取命令行中的参数&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;监听文件的变化&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%9B%91%E5%90%AC%E6%96%87%E4%BB%B6%E7%9A%84%E5%8F%98%E5%8C%96&quot; aria-label=&quot;监听文件的变化 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;监听文件的变化&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;不急着动手，先想想如果做。首先，Node需要访问本地的文件，访问到文件后才有办法监听。Node自带&lt;code&gt;fs&lt;/code&gt;模块可以帮助访问本地文件，更巧的是，fs模块本身就提供了&lt;a href=&quot;http://nodejs.org/api/fs.html#fs_fs_watch_filename_options_listener&quot; class=&quot;link-underline&quot;&gt;watch()&lt;/a&gt;这个方法。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var fs = require(&amp;#39;fs&amp;#39;);

fs.watch(&amp;#39;target.txt&amp;#39;, function() {
    console.log(&amp;quot;File &amp;#39;target.txt&amp;#39; just changed!&amp;quot;);
});

console.log(&amp;quot;Now watching target.txt for changes...&amp;quot;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;很简单的例子，自己的笔记就没有必要再解释了。无非就是，在引入fs模块之后，调用fs提供的watch方法对文件进行监听，监听时，每发生了修改就调用watch方法中的回调函数，打印出“File ‘target.txt’ just changed!”&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;现在来说说如何在Node中读取命令行中的参数&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%8E%B0%E5%9C%A8%E6%9D%A5%E8%AF%B4%E8%AF%B4%E5%A6%82%E4%BD%95%E5%9C%A8Node%E4%B8%AD%E8%AF%BB%E5%8F%96%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0&quot; aria-label=&quot;现在来说说如何在Node中读取命令行中的参数 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;现在来说说如何在Node中读取命令行中的参数&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在上面的例子上稍微修改。需要用到新的东西：Node中的一个全局对象&lt;a href=&quot;http://nodejs.org/api/process.html#process_process&quot; class=&quot;link-underline&quot;&gt;&lt;code&gt;process&lt;/code&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var fs = require(&amp;quot;fs&amp;quot;),
    filename = process.argv[2];

console.log(process.argv);

if(!filename){
    console.log(&amp;quot;A file to watch  must be specified&amp;quot;);
}

fs.watch(filename, function() {
    console.log(&amp;quot;File &amp;quot; + filename + &amp;quot; just changed!&amp;quot;);
});
console.log(&amp;quot;Now watching &amp;quot; + filename + &amp;quot; for changes...&amp;quot;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;保存文件之后，可以像这样启动它：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;node watcher-argv.js target.txt&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;效果看起来和上面一个例子简直是一模一样的，但是后者的代码更加灵活，因为监控的文件是以参数的形式传递给函数，而不是写死在源代码中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这个&lt;code&gt;process&lt;/code&gt;全局对象可以在Node的任何地方使用，它是 EventEmitter的一个实例。&lt;a href=&quot;http://nodejs.org/api/process.html#process_process_argv&quot; class=&quot;link-underline&quot;&gt;process.argv&lt;/a&gt;是一个数组，它包含了命令行中的参数。第一个元素一定是”node”，或者&lt;code&gt;node.exe&lt;/code&gt;的路径，第二个元素是当前执行的js文件的路径，第三个之后，包括第三个的元素都来自命令行参数。如果输出&lt;code&gt;process.aegv&lt;/code&gt;的话，在我的window下，如果是CMD中，第一个元素是一个字符串“node”，在powershell中第一个元素是&lt;code&gt;node.exe&lt;/code&gt;的路径。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Spawning-a-Child-Process&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Spawning-a-Child-Process&quot; aria-label=&quot;Spawning a Child Process permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Spawning a Child Process&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;现在利用Node中的&lt;a href=&quot;http://nodejs.org/api/child_process.html&quot; class=&quot;link-underline&quot;&gt;&lt;code&gt;child-process&lt;/code&gt;&lt;/a&gt;的模块，来增强我们的程序。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var fs = require(&amp;#39;fs&amp;#39;),
    spawn = require(&amp;#39;child_process&amp;#39;).spawn,
    filename = process.argv[2];
if (!filename) {
    throw Error(&amp;quot;A file to watch must be specified!&amp;quot;);
}
fs.watch(filename, function() {
    var ls = spawn(&amp;#39;ls&amp;#39;, [&amp;#39;-lh&amp;#39;, filename]);
    ls.stdout.pipe(process.stdout);
});
console.log(&amp;quot;Now watching &amp;quot; + filename + &amp;quot; for changes...&amp;quot;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;修改文件之后，你会发现在终端中会这样显示：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;-rw-r--r-- 1 CrispElite Admin 0B Dec 19 22:45 target.txt&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;关于&lt;code&gt;spawn&lt;/code&gt;的使用，官方给出的&lt;a href=&quot;http://nodejs.org/api/child_process.html#child_process_child_process_spawn_command_args_options&quot; class=&quot;link-underline&quot;&gt;文档&lt;/a&gt;很详细。
&lt;code&gt;spawn()&lt;/code&gt;的调用实质上运行给的命令指定的进程，数组中的元素是这条命令的参数。参数默认情况下是一个空数组。这个方法返回一个&lt;code&gt;ChildProcess&lt;/code&gt;对象，它的&lt;code&gt;stdin&lt;/code&gt;,&lt;code&gt;stdout&lt;/code&gt;,&lt;code&gt;stderr&lt;/code&gt; 都是可以访问的数据流。而&lt;code&gt;pipe&lt;/code&gt;的作用就是将子进程的数据直接发送到标准输出流中。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Capturing-Data-from-an-EventEmitter&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Capturing-Data-from-an-EventEmitter&quot; aria-label=&quot;Capturing Data from an EventEmitter permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Capturing Data from an EventEmitter&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;==！（未完……）&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;参考： &lt;strong&gt;Nodejs the right way&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Node学习笔记-Data Sources and Flow Control]]></title><description><![CDATA[额在之前的笔记中，提到了使用middleware，设置路由，发送数据，处理请求，渲染模板等。但是这些都不足以完成一个Web应用程序，动态数据交互需要和数据库联系在一起。当用户向服务器发送一个请求，响应的服务器可能就需要向数据库发送请求，此时，之后当数据库将数据返回给服务器，服务…]]></description><link>https://zhanglun.github.io/blogs/Node学习笔记-Data Sources and Flow Control/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/Node学习笔记-Data Sources and Flow Control/</guid><pubDate>Thu, 06 Nov 2014 21:17:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;额在之前的笔记中，提到了使用middleware，设置路由，发送数据，处理请求，渲染模板等。但是这些都不足以完成一个Web应用程序，动态数据交互需要和数据库联系在一起。当用户向服务器发送一个请求，响应的服务器可能就需要向数据库发送请求，此时，之后当数据库将数据返回给服务器，服务端才能够将响应给用户。好的，在这里就涉及到了服务端的流控制（server-side flow control）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Connecting-to-Database&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Connecting-to-Database&quot; aria-label=&quot;Connecting to Database permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Connecting to Database&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在Node中没有的提供默认的链接数据的方法，同时又有很多类型的数据库都支持在Node中使用。至于如何选择还是要看具体情况具体分析。书上用的例子是Redis，这是一个很轻量级的数据，具体的我也不太懂。这里是它的&lt;a href=&quot;http://redis.io/&quot; class=&quot;link-underline&quot;&gt;官网&lt;/a&gt;，由于没有官方的window版本，我决定先试试用SQLite。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;之前有过一个sqlite的数据文件，里面是在豆瓣电影上抓取的一点点东西，正好可以用上。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Node的包实在是太多了，往往有时候陷入选择困难症……。我选用的是叫做&lt;code&gt;sqlite3&lt;/code&gt;的modules，NPM上提供的详细资料在&lt;a href=&quot;https://www.npmjs.org/package/sqlite3&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;，&lt;a href=&quot;https://github.com/mapbox/node-sqlite3/wiki/&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;还有其API文档。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在server.js的目录下新建&lt;code&gt;db&lt;/code&gt;文件夹，里面放着待会儿要用的db文件。在Node中使用sqlite时，也要先引用它对应的module。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var sqlite3 = require(&amp;#39;sqlite3&amp;#39;).verbose();
var db = new sqlite3.Database(&amp;#39;./db/douban.rdb&amp;#39;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;路由的设置和之前的一样，采用&lt;code&gt;connect-route&lt;/code&gt;，从数据库读取到数据完成之后，调用回调函数，回调函数中的参数&lt;code&gt;row&lt;/code&gt;包含每一行的数据，&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;!--movie.html template--&amp;gt;
&amp;lt;h1&amp;gt;豆瓣电影&amp;lt;/h1&amp;gt;
&amp;lt;dl&amp;gt;
    &amp;lt;dt&amp;gt;{{name}}&amp;lt;/dt&amp;gt;
    &amp;lt;dd&amp;gt;&amp;lt;img src=&amp;quot;{{img}}&amp;quot; alt=&amp;quot;{{name}}&amp;quot;&amp;gt;&amp;lt;/dd&amp;gt;
    &amp;lt;dd&amp;gt;&amp;lt;a href=&amp;quot;{{href}}&amp;quot;&amp;gt;{{name}}&amp;lt;/a&amp;gt;&amp;lt;/dd&amp;gt;
    &amp;lt;dd&amp;gt;&amp;lt;span&amp;gt;{{type}}&amp;lt;/span&amp;gt; &amp;amp;nbsp;&amp;amp;nbsp;&amp;lt;span&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/dd&amp;gt;
&amp;lt;/dl&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// server.js
// 忽略外部函数，只显示核心代码
router.get(&amp;#39;/movie&amp;#39;, function(req, res, next){
    var search = db.each(&amp;quot;select * from MOVIE&amp;quot;, function(err, row){
        console.log(row);
        var movie={
            name:row.name,
            href:row.href,
            img:row.post_url,
            type:row.type
        };
        var readable = mu.compileAndRender(&amp;#39;movie.html&amp;#39;, movie);
        readable.pipe(res);
    });
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这应该算的上是Node中操作数据库最简单的例子，执行select语句读取数据，然后将数据渲染到模板中，呈现给用户。觉得还是有必要把sqlite3的API稍微翻译下做个笔记，不然每次都去查有点子麻烦。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Storing-Data-in-Files&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Storing-Data-in-Files&quot; aria-label=&quot;Storing Data in Files permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Storing Data in Files&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;上面讲的是从数据库中取数据，现在来说说如何存储数据。其实我觉得这些问题，只要搞明白了一个，其他的也就不怎么困难了。取数据的时候我们是先访问数据库，然后查找，找到自己需要的数据之后返回就行，大体上就是这么个过程，那么反过来存储数据就是 先准备好打算存储的数据，然后访问数据库，将要存储的数据存入数据库就行了。整个过程都依赖相应数据库modules的API，看懂了API结合着操作几次，差不多就熟练了。我觉得这也没什么好说的。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;node-sqlite3-简单的操作&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#node-sqlite3-%E7%AE%80%E5%8D%95%E7%9A%84%E6%93%8D%E4%BD%9C&quot; aria-label=&quot;node sqlite3 简单的操作 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;node-sqlite3 简单的操作&lt;/h2&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;来自&lt;a href=&quot;https://github.com/mapbox/node-sqlite3/wiki/API&quot; class=&quot;link-underline&quot;&gt;node sqlite3 wiki api&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;new-sqlite3Databasefilename-mode-callback&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#new-sqlite3Databasefilename-mode-callback&quot; aria-label=&quot;new sqlite3Databasefilename mode callback permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;new sqlite3.Database(filename, [mode], [callback])&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;返回一个新的Database对象，并且自动打开这个数据库。没有其他间接的方法来打开数据库。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;filename&lt;/code&gt;： 正确的值是文件名，如果是“:memory:”，则在内存中创建一个匿名的数据库，匿名数据库不持久，关闭数据库程序之后内容就会消失。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mode&lt;/code&gt;：可选参数，可以是&lt;code&gt;sqlite3.OPEN_READONLY&lt;/code&gt;, &lt;code&gt;sqlite3.OPEN_READWRITE&lt;/code&gt; 和 &lt;code&gt;sqlite3.OPEN_CREATE&lt;/code&gt;中的一个或者多个。默认值是 &lt;code&gt;OPEN_READWRITE | OPEN_CREATE&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;callback&lt;/code&gt;：可选参数，数据库成功打开或者打开时遇到错误调用，回调函数的第一个参数是一个err对象。当err对象为&lt;code&gt;null&lt;/code&gt;时，数据库打开成功，此时触发一个没有参数的&lt;code&gt;open&lt;/code&gt;事件，无论回调函数是否存在。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;sqlite3verbose&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#sqlite3verbose&quot; aria-label=&quot;sqlite3verbose permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;sqlite3.verbose()&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;设置执行模式。See the wiki page on &lt;a href=&quot;https://github.com/developmentseed/node-sqlite3/wiki/Debugging&quot; class=&quot;link-underline&quot;&gt;debugging&lt;/a&gt; for more information.&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Databaseclosecallback&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Databaseclosecallback&quot; aria-label=&quot;Databaseclosecallback permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Database#close([callback])&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;关闭数据库&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;callback&lt;/code&gt;：可选参数。当数据库成功关闭或者关闭时遇到错误调用。回调函数的第一个参数是一个err对象。当err对象为&lt;code&gt;null&lt;/code&gt;时，数据库关闭成功，此时触发一个没有参数的&lt;code&gt;open&lt;/code&gt;事件，无论回调函数是否存在。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Databaserunsql-param--callback&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Databaserunsql-param--callback&quot; aria-label=&quot;Databaserunsql param  callback permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Database#run(sql, [param, …], [callback])&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;执行SQL语句，然后调用回调函数。返回的是一个Database对象，可以链式调用。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;sql&lt;/code&gt;：执行的SQL语句。如果SQL语句无效，同时run方法有一个回调函数。回调函数将被调用，参数是一个包含错误信息的err对象。如果没有回调函数来处理错误，一个&lt;code&gt;error&lt;/code&gt;事件会在影响到后面的数据库相关语句，导致其无法正常工作。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;param, ...&lt;/code&gt;：可选参数。当SQL语句包含占位符的时候，可以将参数在这里写出。在执行前，参数会被添加到语句中。有三种方式传递参数：直接作为函数的参数列举出来；以数组的形式；或者一个json对象。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;      // Directly in the function arguments.
      db.run(&amp;quot;UPDATE tbl SET name = ? WHERE id = ?&amp;quot;, &amp;quot;bar&amp;quot;, 2);

      // As an array.
      db.run(&amp;quot;UPDATE tbl SET name = ? WHERE id = ?&amp;quot;, [ &amp;quot;bar&amp;quot;, 2 ]);

      // As an object with named parameters.
      db.run(&amp;quot;UPDATE tbl SET name = $name WHERE id = $id&amp;quot;, {
          $id: 2,
          $name: &amp;quot;bar&amp;quot;
      });&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;参数的键可以这么书写 &lt;code&gt;:name&lt;/code&gt;, &lt;code&gt;@name&lt;/code&gt; and &lt;code&gt;$name&lt;/code&gt;. 建议使用 &lt;code&gt;$name&lt;/code&gt;因为JS中允许使用$来声明变量。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;callback&lt;/code&gt; ：可选参数。在语句执行的任何一个步骤出错和查询执行后都会调用这个函数。遇到错误时，第一个（只有一个）参数是一个包含错误信息的err对象。如果执行成功，第一个参数是&lt;code&gt;null&lt;/code&gt;。函数的上下文（this）指向的是statement对象。在第一次运行之后无妨再次运行这个statement，因为在第一次运行之后它被自动销毁了。
如果执行成功，this对象将包含两个属性：&lt;code&gt;lastID&lt;/code&gt;和&lt;code&gt;changes&lt;/code&gt;，这两个属性包含这最后插入的行的ID和这条语句影响的行数（如果它们都不是undefined的话）。执行INSERT才会有lastID，执行UPDATE和DELETE才会有changes。其他情况下，这两个属性的都是不准确的，不应该被使用。
在查询方法总，只有&lt;code&gt;.run()&lt;/code&gt;的回调函数才有这两个值，其他的比如&lt;code&gt;.all()&lt;/code&gt;，&lt;code&gt;.get()&lt;/code&gt;等都没有这些值。&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;更多详情请戳&lt;a href=&quot;https://github.com/mapbox/node-sqlite3/wiki/API&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Bye~下次再来……&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Node学习笔记-Server-Side Templates]]></title><description><![CDATA[因为各种版本的更新，文中的例子可能失效无法运行。毕竟Node for Front-End Developer这本书已经出现很久了。 Creating a Dynamic Page 不像其他的服务端语言开发，Node没有暗示你需要使用任何的模板引擎来创建动态页面。有很多JS模板引…]]></description><link>https://zhanglun.github.io/blogs/Node学习笔记-Server-Side Templates/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/Node学习笔记-Server-Side Templates/</guid><pubDate>Mon, 03 Nov 2014 13:39:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;因为各种版本的更新，文中的例子可能失效无法运行。毕竟&lt;em&gt;&lt;strong&gt;Node for Front-End Developer&lt;/strong&gt;&lt;/em&gt;这本书已经出现很久了。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Creating-a-Dynamic-Page&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Creating-a-Dynamic-Page&quot; aria-label=&quot;Creating a Dynamic Page permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Creating a Dynamic Page&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;不像其他的服务端语言开发，Node没有暗示你需要使用任何的模板引擎来创建动态页面。有很多JS模板引擎，而且这个数量还在增加。所以有很多选择的对象。使用哪一个模板引擎并不重要，重要的是你需要什么样子的引擎，什么样子的引擎适合你。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当你在选择模板引擎的时候，你可能需要考虑吧下面的这几个问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;是否需要除了JavaScript之外其他的语言
&lt;ul&gt;
&lt;li&gt;如果是，你将没法在客户端上使用&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;是否依赖已经存在DOM结构
&lt;ul&gt;
&lt;li&gt;如果是，你需要在Node中预先编写一端DOM来使用它，这个很easy，但是多走了一步&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;在模板第一次渲染之前，是否允许模板一次编译完成并缓存
&lt;ul&gt;
&lt;li&gt;如果你想在前台解析所有的模板或者你渲染的模板会重复使用多次，你可能会比较关心这个&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;模板中可以使用多少逻辑
&lt;ul&gt;
&lt;li&gt;一些模板的提供少量的逻辑处理，有些允许在模板中编写JS代码块。不同模板的不同特性将影响到你的结构，值得去做点研究&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;为了简单化，我们使用Mustache模板引擎。如果你没有使用过任何的JS模板引擎，Mustache是一个好的开始，因为它站在逻辑与非逻辑中间，它提供了一系列方法，但是又能使用完整的JavaScript。再者，它的语法也用在其他的一些模板引擎中，对你来说是个好事。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我们的第一个服务端模板是这样一个包含表单的页面，用以编辑用户的相关信息 和一个接受提交的页面。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;!--edit.html--&amp;gt;

&amp;lt;h1&amp;gt;{{pageheader}}&amp;lt;/h1&amp;gt;
&amp;lt;form action=&amp;quot;/&amp;quot; method=&amp;quot;POST&amp;quot;&amp;gt;
    &amp;lt;label&amp;gt;First name:
        &amp;lt;input type=&amp;quot;text&amp;quot; name=&amp;quot;firstName&amp;quot; value=&amp;quot;{{firstName}}&amp;quot; /&amp;gt;
    &amp;lt;/label&amp;gt;
    &amp;lt;label&amp;gt;Last name:
        &amp;lt;input type=&amp;quot;text&amp;quot; name=&amp;quot;lastName&amp;quot; value=&amp;quot;{{lastName}}&amp;quot; /&amp;gt;
    &amp;lt;/label&amp;gt;
    &amp;lt;input type=&amp;quot;submit&amp;quot; value=&amp;quot;Save&amp;quot; /&amp;gt;
&amp;lt;/form&amp;gt;

&amp;lt;!--result.html--&amp;gt;
&amp;lt;h1&amp;gt;Edit finish!&amp;lt;/h1&amp;gt;
&amp;lt;p&amp;gt;Hello，Mr.{{firstname}}&amp;lt;/p&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;双花括号是模板的定义符号，告诉Mustache在页面渲染的时候在何处填充传递过来的数据。
使用Mustache之前，需要使用npm安装Mustache，具体的可以去&lt;a href=&quot;http://mustache.github.io/&quot; class=&quot;link-underline&quot;&gt;官网&lt;/a&gt;查看,然后修改代码去渲染一个模板文件。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var http = require(&amp;quot;http&amp;quot;),
    path = require(&amp;quot;path&amp;quot;),
    connect = require(&amp;quot;connect&amp;quot;);

var app = connect();

var bodyParser = require(&amp;quot;body-parser&amp;quot;);
app.use(bodyParser.urlencoded({ extended: false }))
app.use(bodyParser.json())


var mu = require(&amp;quot;mu2&amp;quot;);
mu.root = __dirname + &amp;quot;/public/&amp;quot;;

app.use(&amp;#39;/edit&amp;#39;, function(req, res){

    var view={
        pagetitle:&amp;quot;edit your profile&amp;quot;,
        pageheader:&amp;quot;This page is perpare for everyone!&amp;quot;,
    };
    var readable = mu.compileAndRender(&amp;#39;edit.html&amp;#39;, view);
    readable.pipe(res);
});

app.use(&amp;quot;/api/users/edit&amp;quot;, function(req, res){
    mu.clearCache(); // 暂时禁用模版缓存
    res.writeHead({
        &amp;quot;Content-Type&amp;quot;:&amp;quot;text/html&amp;quot;
    });
    if(req.method == &amp;quot;POST&amp;quot;){
        if (!req.body){
            res.writeHead(400);
            res.end(&amp;quot;Server is missing!&amp;quot;);
        }
        // POST 的数据
        var userName = {
            firstname: req.body.firstName,
            lastname: req.body.lastName
        };

        var readable = mu.compileAndRender(&amp;#39;result.html&amp;#39;, userName);

        readable.pipe(res); // 关于stream的更多用法，要找时间看看
    }

    if(req.method == &amp;quot;GET&amp;quot;){

        res.writeHead(200);
        res.end(&amp;quot;Hey! Don&amp;#39;t visit this page !&amp;quot;);   
    }
});

http.createServer(app).listen(3000);
&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;假设我们将 edit.html 文件保存在 public 目录中，上述的代码将会将内容转换为文本流保存到一个变量中，一旦模板完全加载，便将传递过来的信息渲染成HTML。然后再将最后的HTML输出。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;注意：&lt;/strong&gt; Mustache的具体使用方法请看官方给出的教程：&lt;a href=&quot;http://mustache.github.io/&quot; class=&quot;link-underline&quot;&gt;官网&lt;/a&gt;。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Partial-Templates&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Partial-Templates&quot; aria-label=&quot;Partial Templates permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Partial Templates&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在站点中，都会有很多相同的部分，比如导航，页脚或者其他的一些页面组件会在多个页面上出现。笨一点的话就是把HTML每个都复制粘贴一遍，但是将它们作为一个个简单的可共享的模板进行管理比起复制粘贴来说，更加的方便，有利于管理和维护。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;对于一些静态文件，如果我们不想重复的在每个模板中引用，我们可以为站点设置一个默认的模板，里面包含了静态文件的引用。对于页面上不同的内容，可以为其留下空间，在需要的时候利用它们。
不同模板的嵌套采用不同的处理方法，当然具体的用法还是参照官网最直接。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;不只是html模板，如果我们想动态生成CSS（比如修改主题）或者JavaScript，同样可以使用模板来操作，修改文件类型就可以了。因为读取文件的时候将其看到做是一些字符串，这对Node的解析来说没有什么区别。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;例如，我们想利用Mustache根据用户定义的值来修改CSS文件，实现的方法与前面描述的加载HTML模板简直是一模一样，只不过requirejs请求的文件变成了CSS文件而已。假设从一个POST请求中接收到了修改样式的参数，然后根据这些参数来请求不同的CSS。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Node里面的各种模块好蛋疼 ==!(未完……)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Node学习笔记-Serving the content]]></title><description><![CDATA[Node中的MiddleWare In the context of a web server, middleware is a layer between the guts of the server and the code you’re writing to run on…]]></description><link>https://zhanglun.github.io/blogs/Node学习笔记-Serving the content/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/Node学习笔记-Serving the content/</guid><pubDate>Tue, 28 Oct 2014 19:40:00 GMT</pubDate><content:encoded>&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Node中的MiddleWare&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Node%E4%B8%AD%E7%9A%84MiddleWare&quot; aria-label=&quot;Node中的MiddleWare permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Node中的MiddleWare&lt;/h2&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;In the context of a web server, middleware is a layer between the guts&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;of the server and the code you’re writing to run on it that provides a set
of abstractions anyone writing code for the platform will be likely to
need. It differs from other modules you might pull into your application
in that it exists as a buffer between Node and your app, not a utility used
within your app.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在一个Web服务器的上下文中，中间件是服务器和你写在其上运行的代码的中间一层，为那些编写代码的人提供一组抽象（a set of abstractions）。它不同于其他那些引入到你的应用中的模块，middleware作为一个缓存区存在于Node与你的应用之间，&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Connect 是最受欢迎的Node中间件框架，为其他的web 框架比如Express提供了基础。Connect提供的工具之一就是 static 模块，用于处理静态文件，如果我们添加了Connect，对静态文件的引用可以酱紫：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var connect = require(&amp;#39;connect&amp;#39;);
var app = connect();

app.use(function middleware1(req, res, next) {
  // middleware 1
  next();
});

app.use(function middleware2(req, res, next) {
  // middleware 2
  next();
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;https://github.com/senchalabs/connect&quot; class=&quot;link-underline&quot;&gt;Github:&lt;/a&gt;&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Receiving-Data-from-the-Querystring&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Receiving-Data-from-the-Querystring&quot; aria-label=&quot;Receiving Data from the Querystring permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Receiving Data from the Querystring&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;向服务端传送数据最简单的办法就是在url中添加querystring，这种方式不需要在客户端做太多操作。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Node官方提供了一个叫做&lt;code&gt;querystring&lt;/code&gt;的模块，我们不需要做太多的工作就能够很轻松的解析出querystring中的数据，我们要做的一件事请就是“trim the querystring”，因为querystring模块提供了解析querystring字段的方法&lt;code&gt;parse()&lt;/code&gt;,当时没有已经将querystring从URl中分离出来。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var http = require(&amp;quot;http&amp;quot;),
querystring = require(&amp;quot;querystring&amp;quot;);
http.createServer(function(req, res) {
    // parse everything after the &amp;quot;?&amp;quot; into key/value pairs
    var qs = querystring.parse(req.url.split(&amp;quot;?&amp;quot;)[1]),
    // property names are the same as in the querystring
    userName = qs.firstName + &amp;quot; &amp;quot; + qs.lastName,
    html = &amp;quot;&amp;lt;!doctype html&amp;gt;&amp;quot; +
    &amp;quot;&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;Hello &amp;quot; + userName + &amp;quot;&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&amp;quot; +
    &amp;quot;&amp;lt;body&amp;gt;&amp;lt;h1&amp;gt;Hello, &amp;quot; + userName + &amp;quot;!&amp;lt;/h1&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&amp;quot;;
    res.end(html);
}).listen(8000);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Routing-and-Receiving-Data-from-a-Path&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Routing-and-Receiving-Data-from-a-Path&quot; aria-label=&quot;Routing and Receiving Data from a Path permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Routing and Receiving Data from a Path&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;Routing&lt;/code&gt;是中间件提供的另一个功能，但是自己实现起来也不是很复杂。Routing可以让我们解析出除了querystring之外的URL路径中的数据。一个最简单的route包含三个部分：一个request方法；一个route匹配的模式（正则表达式）和一个请求匹配成功时调用的回调函数。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;要解析URL，必须引入URL模块&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var url = require(&amp;quot;url&amp;quot;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;前面讲到的使用querystring的例子，可以修改成Route版，通过检查URL来寻找信息。假设我们的路径是“sayhello/firstname/lastname”&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var http = require(&amp;quot;http&amp;quot;),
    url = require(&amp;quot;url&amp;quot;);
http.createServer(function(req, res) {
    // split out parts of the path
    var path = url.parse(req.url).pathname.split(&amp;quot;/&amp;quot;);
    // handle GET requests to /sayHello/

    if (req.method == &amp;quot;GET&amp;quot; &amp;amp;&amp;amp; path[1] == &amp;quot;sayHello&amp;quot;) {
        var userName = path[2] + &amp;quot; &amp;quot; + path[3],
        html = &amp;quot;&amp;lt;!doctype html&amp;gt;&amp;quot; +
        &amp;quot;&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;Hello &amp;quot; + userName + &amp;quot;&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&amp;quot; +
        &amp;quot;&amp;lt;body&amp;gt;&amp;lt;h1&amp;gt;Hello, &amp;quot; + userName + &amp;quot;!&amp;lt;/h1&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&amp;quot;;
        res.end(html);
    }
}).listen(8000);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;但是可以看到这样的代码是多么的不健壮，根本没有拓展性可言。我们可以使用Connect来提高代码的可用性。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;Receiving-Data-from-a-POST&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Receiving-Data-from-a-POST&quot; aria-label=&quot;Receiving Data from a POST permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Receiving Data from a POST&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;最传统的获取用户数据的方式就是接受来自表单的一个POST请求，这可能不是你使用Node时做的第一件事，但是这个还是一件很必要的事情。亲自尝试使用Node处理POST请求时，可以很好的感受到Node与其他服务端开发的不同之处。&lt;code&gt;ServerRequest&lt;/code&gt; 对象（回调函数中的req参数）的属性，没有包含POST传递过来的参数，但是它是一个&lt;code&gt;EventEmitter&lt;/code&gt;-事件发射器。它是Node中的一个基本的对象，其作用就像它的名字一样-发射事件。我们不是去检查req的属性是否含有传递过来的数据，而是添加一个事件监听器来监听请求。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;所有的事件发射器的监听器，包括&lt;code&gt;ServerRequest&lt;/code&gt;的监听器，都通过 on() 创建，这个方法至少需要一个事件的类型和一个回调函数作为参数（addListener()方法也是一样）。请求的数据将会出现在chunk中，我们不用等待接收完所有的数据就可执行后面的代码。现在，创建一个监听器，用于数据的接受，请求的结束和保存所有的数据块。但是只有在请求完成之后才能显示数据。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var http = require(&amp;quot;http&amp;quot;),
    fs = require(&amp;quot;fs&amp;quot;),
    querystring = require(&amp;quot;querystring&amp;quot;);
    http.createServer(function(req, res) {
    var data = &amp;quot;&amp;quot;;
    // serve static form
    if (req.method == &amp;quot;GET&amp;quot;) {
        getFile(__dirname + &amp;quot;/public/simpleForm.html&amp;quot;, res);
    }
    // handle form post
    if (req.method == &amp;quot;POST&amp;quot;) {
        req.on(&amp;quot;data&amp;quot;, function(chunk) {
            // append received data
            data += chunk;
        });
        req.on(&amp;quot;end&amp;quot;, function() {
            // get key/value pairs from received data
            var params = querystring.parse(data),
            userName = params.firstName + &amp;quot; &amp;quot; + params.lastName,
            html = &amp;quot;&amp;lt;!doctype html&amp;gt;&amp;quot; +
            &amp;quot;&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;Hello &amp;quot; + userName + &amp;quot;&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&amp;quot; +
            &amp;quot;&amp;lt;body&amp;gt;&amp;lt;h1&amp;gt;Hello, &amp;quot; + userName + &amp;quot;!&amp;lt;/h1&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&amp;quot;;
            res.end(html);
        });
    }
}).listen(8000);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;同样的我们也可以利用中间件来完成，可以使用 &lt;code&gt;bodyParse&lt;/code&gt;。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[规范之路-重新认识了Float]]></title><description><![CDATA[总是喜欢在阴雨绵绵的时候收拾自己的小窝，无论是在家还是在学校。也不知道这个癖好是怎么形成的，还是不错的。这几天一直在搞一个新的hexo的主题，暂时没什么进展了，想到之前坚持撸标准的事情已经搁置了好久，今天收拾完就重新开始吧。 今天看的是 Floats 什么是浮动 当一个元素的C…]]></description><link>https://zhanglun.github.io/blogs/规范之路-重新认识了Float/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/规范之路-重新认识了Float/</guid><pubDate>Wed, 15 Oct 2014 14:50:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;总是喜欢在阴雨绵绵的时候收拾自己的小窝，无论是在家还是在学校。也不知道这个癖好是怎么形成的，还是不错的。这几天一直在搞一个新的hexo的主题，暂时没什么进展了，想到之前坚持撸标准的事情已经搁置了好久，今天收拾完就重新开始吧。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;今天看的是 &lt;a href=&quot;http://www.w3.org/TR/CSS21/visuren.html#floats&quot; class=&quot;link-underline&quot;&gt;Floats&lt;/a&gt;&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;什么是浮动&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%80%E4%B9%88%E6%98%AF%E6%B5%AE%E5%8A%A8&quot; aria-label=&quot;什么是浮动 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;什么是浮动&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;当一个元素的CSS属性中添加了&lt;code&gt;float:left;&lt;/code&gt;或者&lt;code&gt;float:right;&lt;/code&gt;的时候，我们就可以把这个元素称之为“浮动元素”。当一个元素浮动之后，它会脱离文档流，也就是“out of flow”，然后尽可能地移动到当前行的左边或者右边。浮动最有意思的特性就是：内容沿着浮动元素的的边界流动。说直白一点就是，内容沿着向左浮动的元素的右边往下排（flows down），沿着向右浮动的元素的左边往下排。就像下面这样&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;img{
	float:left;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;div class=&amp;quot;container&amp;quot;&amp;gt;
	&amp;lt;img src=&amp;quot;http://placekitten.com/g/50/50&amp;quot; alt=&amp;quot;&amp;quot; style=&amp;quot;float:left&amp;quot;&amp;gt;
    &amp;lt;p&amp;gt;Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nostrum maxime tempore perferendis ullam, voluptatem repellat vero nihil sint. Quisquam repellat, minus distinctio quae sit, ea provident sed aliquid voluptate vitae.
  	&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;!--![](http://ncuey-crispelite.stor.sinaapp.com/W3CR-Floats/2014-10-31_155325.png) --&gt;
&lt;p class=&quot;para&quot;&gt;利用这个特性可以制作文字环绕图片的效果，据说float最初的作用就是这，直到有人发现可以用来“布局”。当然可以使用&lt;code&gt;clear&lt;/code&gt;属性来禁止这个效果。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;元素浮动之后如何表现&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%85%83%E7%B4%A0%E6%B5%AE%E5%8A%A8%E4%B9%8B%E5%90%8E%E5%A6%82%E4%BD%95%E8%A1%A8%E7%8E%B0&quot; aria-label=&quot;元素浮动之后如何表现 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;元素浮动之后如何表现&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;一个浮动的盒子会移动到左边或者右边，直到它的外边缘碰到包含块的边缘或者另一个浮动元素的外边缘。如果存在一个行盒子（以前记录过的关于line box的介绍 &lt;a href=&quot;/2014/10/02/%E8%A7%84%E8%8C%83%E4%B9%8B%E8%B7%AF-normal%20flow/#Inline_formatting_contexts&quot; class=&quot;link-underline&quot;&gt;link&lt;/a&gt;），通常情况下，浮动元素的顶部会和当前行盒子的顶部对齐。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.container{
    border:1px solid #343434;
}
.left{
    float:left;
    width:300px;
    background:#4de6e8;
}
.color3{
    background:#985ede;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;div class=&amp;quot;container&amp;quot;&amp;gt;
    &amp;lt;div class=&amp;quot;content&amp;quot;&amp;gt;我是一个乖乖的div，我形成了一个BFC&amp;lt;/div&amp;gt;
    &amp;lt;span&amp;gt;我是一个span标签，我形成了IFC，同时还有一个 line box&amp;lt;/span&amp;gt;
    &amp;lt;div class=&amp;quot;left&amp;quot;&amp;gt;我是一个向左浮动的盒子，我的左边碰到了父元素形成的containing block的左边缘&amp;lt;/div&amp;gt;
    &amp;lt;div class=&amp;quot;left color3&amp;quot;&amp;gt;我也是一个向左浮动的盒子，我的左边碰到了前面的浮动元素的右边缘&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;!--![](http://ncuey-crispelite.stor.sinaapp.com/W3CR-Floats/2014-10-31_175651.png) --&gt;
&lt;p class=&quot;para&quot;&gt;如果没有足够的横向空间，浮动元素会向下移动，可以理解成另起一行，直到能够容纳它的宽度或者不存在更多的浮动元素。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;因为浮动后的元素不在正常的流中，所以在浮动元素前后创建的非定位块级盒子（non-position block boxes）在垂直方向上表现得就好像浮动元素不存在一样。这意味着浮动元素在正常的流中将不会占据高度，如果一个容器没有固定高度，且里面只包含浮动元素，那么这个容器的高度将为0。但是在浮动元素之后（html结构上的先后）创建的行盒子在适当的时候会自动缩短以腾出空间放置浮动元素。如果缩短的盒子太小不能容纳任何内容，这个line box会向下移动（它的宽度重新计算）直到某些内容能够适应宽度或者没有更多的浮动元素。&lt;/p&gt;
&lt;!--![](http://ncuey-crispelite.stor.sinaapp.com/W3CR-Floats/2014-10-31_193922.png) --&gt;
&lt;p class=&quot;para&quot;&gt;在当前行中，任何在浮动元素之前的的内容都会在同一行中reflow到浮动元素的另一边。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果表格的边框盒子，块级可替换元素或者在正常流中的元素创建出一个BFC，那么，它们绝对不会和处在相同BFC中的浮动元素的外填充盒子（包含margin 的盒子）重叠。乍看之下好像元素浮动之后在页面上新叠了一层，但其实不是，只有定位元素才是真正意义上是的新层（new stack）。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.ovh{
    overflow:hidden;
}
.red{
    background:red;
	height:40px;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;div class=&amp;quot;container&amp;quot;&amp;gt;
    &amp;lt;div class=&amp;quot;left&amp;quot;&amp;gt;我是一个浮动的元素&amp;lt;/div&amp;gt;
    &amp;lt;div class=&amp;quot;&amp;quot;&amp;gt;
		&amp;lt;div class=&amp;quot;red&amp;quot;&amp;gt;我没有创建了一个BFC，所以有一部分与浮动元素重叠了&amp;lt;/div&amp;gt;
		&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
  &amp;lt;br&amp;gt;
&amp;lt;div class=&amp;quot;container&amp;quot;&amp;gt;
    &amp;lt;div class=&amp;quot;left&amp;quot;&amp;gt;我是一个浮动的元素&amp;lt;/div&amp;gt;
    &amp;lt;div class=&amp;quot;ovh&amp;quot;&amp;gt;
		&amp;lt;div class=&amp;quot;red&amp;quot;&amp;gt;我创建了一个BFC，不在重叠了！&amp;lt;/div&amp;gt;
	&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;!--![](http://ncuey-crispelite.stor.sinaapp.com/W3CR-Floats/2014-10-31_193115.png) --&gt;
&lt;p class=&quot;para&quot;&gt;来看看下面的代码：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;img{
	float:left;
}
p,img{
	margin:10px;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;p&amp;gt;
	&amp;lt;img src=&amp;quot;http://placekitten.com/g/50/50&amp;quot; alt=&amp;quot;&amp;quot;&amp;gt;Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ut, corporis nulla quis aliquid distinctio labore commodi fugiat eum architecto sunt sed vel animi illo aspernatur quae nam ducimus enim explicabo!
&amp;lt;/p&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;!--![](http://ncuey-crispelite.stor.sinaapp.com/W3CR-Floats/2014-10-31_202013.png) --&gt;
&lt;p class=&quot;para&quot;&gt;可以看到，图片向左浮动，在同一行上，紧跟着图片的内容的问题移到了右边。由于图片的原因，右侧的line box 被缩短了。但是在在图片之后的line box 恢复了它的宽度。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;再来看下面这个例子：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;p{
    border:1px solid red;
    margin:10px;
    padding:10px;
}
img{
    margin:10px;
    float:left;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;p&amp;gt;&amp;lt;img src=&amp;quot;http://placekitten.com/g/200/400&amp;quot; alt=&amp;quot;&amp;quot;&amp;gt;Lorem ipsum dolor sit amet, consectetur adipisicing elit. Tempore, iusto, eos, recusandae qui impedit blanditiis libero in accusamus necessitatibus repellendus porro quae inventore unde non voluptate iste nesciunt aut quis.&amp;lt;/p&amp;gt;

&amp;lt;p&amp;gt;Lorem ipsum dolor sit amet, consectetur adipisicing elit. Tempore, iusto, eos, recusandae qui impedit blanditiis libero in accusamus necessitatibus repellendus porro quae inventore unde non voluptate iste nesciunt aut quis.&amp;lt;/p&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;效果图如下：&lt;/p&gt;
&lt;!--![](http://ncuey-crispelite.stor.sinaapp.com/W3CR-Floats/2014-10-31_204351.png) --&gt;
&lt;p class=&quot;para&quot;&gt;图片浮动之后，在页面上不再占据高度，此时，没有设置高度的P元素的高度只能靠内容撑开。另一P元素就像图片不存在一样，紧接其后。可以使用&lt;code&gt;clear&lt;/code&gt;属性阻止第二个P元素的内容流向（围绕）到浮动的图片。添加新的属性&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;p{
	clear:left;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;!--![](http://ncuey-crispelite.stor.sinaapp.com/W3CR-Floats/2014-11-01_095746.png) --&gt;
&lt;p class=&quot;para&quot;&gt;当p元素添加了 “clear:left” 之后，导致第二个段落被“推”到浮动图片的下方。有一个叫做“clearence”的东西添加到第二个段落的上外边距，就是这个“clearence”完成了调整的工作。后面会说到“clearence”&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;floatleftrightnoneinherit&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#floatleftrightnoneinherit&quot; aria-label=&quot;floatleftrightnoneinherit permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;float:left|right|none|inherit;&lt;/h2&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;额好吧上面说了这么多感觉乱乱的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;可以为任何元素添加float属性，如果元素形成的盒子具有绝对定位属性（absolutely position：position的属性值是absolute或者fixed），浮动将不起作用。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;元素浮动之后，会形成 一个块级盒子。也就是说，通常情况下形成行级盒子的span元素，浮动之后也便会形成一个块级盒子。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在&lt;a href=&quot;http://www.w3.org/TR/CSS21/visuren.html#floats&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;官方给出了关于浮动更精确的规则，挑了几条比较个人感觉重要的&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;向左浮动的元素的左外填充边缘（outer edge）不一定是 containing block 的左边缘。向右的元素同理。&lt;/li&gt;
&lt;li&gt;假设当前的盒子是向左浮动的，在它的DOM树之前也存在向左浮动的盒子。那么对于这个盒子来说，要么它的左外填充边缘与前面的盒子的右外填充边缘接触，要么它的顶外填充边缘与前面的盒子的底外填充边缘接触。向右浮动的元素同理。&lt;/li&gt;
&lt;li&gt;一个浮动元素的上外填充可能不会比它的包含块高。当浮动在两个重叠的margin之间发生，这个浮动就好像它有一个处于正常流中的空的匿名块的父元素一样&lt;/li&gt;
&lt;li&gt;一个浮动元素的上外填充通常不会比DOM结构比其优先的元素形成的块盒子或者浮动和的上外填充高&lt;/li&gt;
&lt;li&gt;一个浮动元素的上外填充通常不会比DOM结构比其优先的元素形成的line box（这个盒子要包含另一盒子）上外填充高&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;我要控制浮动&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%88%91%E8%A6%81%E6%8E%A7%E5%88%B6%E6%B5%AE%E5%8A%A8&quot; aria-label=&quot;我要控制浮动 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;我要控制浮动！&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;CSS中提供了一个叫做&lt;code&gt;clear&lt;/code&gt;的属性方便我们控制浮动之后的流。应用在块级元素上，可以使用的值有：none|left|right|both|inherit。这个属性决定元素形成的盒子的哪一边（左边或者右边）不与前面的浮动元素相邻。同时，不会作用于应用该属性的元素内部的浮动和其他的BFC中的浮动。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;clear的属性值&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#clear%E7%9A%84%E5%B1%9E%E6%80%A7%E5%80%BC&quot; aria-label=&quot;clear的属性值 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;‘clear’的属性值&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;可以是将下面四个值应用在没有浮动的块级盒子上&lt;/p&gt;
&lt;dl&gt;
    &lt;dt&gt;
    	**left**
    &lt;/dt&gt;
    &lt;dd&gt;
        命令使用`clear:left`的盒子的上外边界要低于任何DOM结构中比自己优先的左浮动元素框的下外边界。（只关心html结构上在自己之前的浮动元素）
    &lt;/dd&gt;
    &lt;dt&gt;
    	**right**
    &lt;/dt&gt;
    &lt;dd&gt;
        命令使用`clear:right`的盒子的上外边界要低于任何DOM结构中比自己优先的左浮动元素框的下外边界。（只关心html结构上在自己之前的浮动元素）
    &lt;/dd&gt;
    &lt;dt&gt;
    **both**
    &lt;/dt&gt;
    &lt;dd&gt;
        命令使用`clear:both`的盒子的上外边界要低于任何DOM结构中比自己优先的左浮动或者右浮动元素框的下外边界。（只关心html结构上在自己之前的浮动元素）
    &lt;/dd&gt;
&lt;/dl&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;根据官方的定义，可以推断出，所谓“使用clear来清除浮动”这种说法是错误的。clear所起的作用不是针对浮动，它决定的是作用的元素与其前面的浮动元素的位置关系。假如A元素使用左浮动，B元素使用左清除浮动，其作用的结果是B元素的上外边界是紧跟随在A元素的下外边界，浮动依旧浮动，B元素只不过是让其本身左侧出现在A的下方（不是底下）。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;看下面的例子：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;div class=&amp;quot;container&amp;quot;&amp;gt;
    &amp;lt;p&amp;gt;
    	&amp;lt;img src=&amp;quot;http://placekitten.com/200/200?image=5&amp;quot; alt=&amp;quot;&amp;quot;&amp;gt;
        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Tempore, iusto, eos, recusandae qui impedit blanditiis libero in accusamus necessitatibus repellendus porro quae inventore unde non voluptate iste nesciunt aut quis.&amp;lt;/p&amp;gt;
	&amp;lt;p&amp;gt;&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;!--![](http://ncuey-crispelite.stor.sinaapp.com/W3CR-Floats/2014-11-02_152036.png) --&gt;
&lt;p class=&quot;para&quot;&gt;当clear的值不是none时，潜在地引入了一个叫做“clearence”的东西，clearence禁止margin的重叠，表现得好像元素margin-top上的空白间隔。用来将元素从浮动元素身边挤下去（push past）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在第一次确定元素上边框边缘的位置的时候，元素的“clearence”的计算已经完成。如果clear设置为none，那么这个位置就是元素真正的上边框边缘的位置，也就是没有“clearence”。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;例子说明如何计算这个clearence&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BE%8B%E5%AD%90%E8%AF%B4%E6%98%8E%E5%A6%82%E4%BD%95%E8%AE%A1%E7%AE%97%E8%BF%99%E4%B8%AAclearence&quot; aria-label=&quot;例子说明如何计算这个clearence permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;例子说明如何计算这个clearence&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;假设，有三个盒子，顺序是：B1，margin-botom:M1，没有padding，border和子元素；浮动的F，高度为H；B2，margin-top:M2，同样没有padding，border和子元素,B2设置&lt;code&gt;clear:both&lt;/code&gt;;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果暂时忽略B2的clear属性，我们会有下面的图片中的结果，B1和B2的margin重叠了，两者之间的间隔取大值也就是Max(M1, M2)。取B1的最底部在Y轴坐标为0，那么F的顶部的位置为y=M1，B2的顶部为y=Max(M1, M2)，F的底部为y=M1 + H。&lt;/p&gt;
&lt;!--![](http://ncuey-crispelite.stor.sinaapp.com/W3CR-Floats/2014-11-02_162630.png) --&gt;
&lt;p class=&quot;para&quot;&gt;考虑到B2的clear属性的作用，我们需要计算clearence，C1和C2，取Max(C1, C2)。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;B2的顶部会被挤到F的底部，坐标为y=M1 + H;这意味着它们自己空隙计算方式是：&lt;/li&gt;
&lt;/ol&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;	bottom of F = top border edge of B2
    ⇔
    M1 + H = M1 + C1 + M2
    ⇔
    C1 = M1 + H - M1 - M2 = H - M2&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;保持B2的顶部在原来的位置，坐标为y=Max(M1, M2);计算方式：&lt;/li&gt;
&lt;/ol&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;    Max(M1, M2) = M1 + C2 + M2
    ⇔
	C2 = Max(M1, M2) - M1 - M2
    
	假设 Max(M1, M2) &amp;lt; M1 + H，那么：
    
    C2 = Max(M1,M2) - M1 - M2&amp;lt; M1 + H - M1 - M2 = H - M2
    ⇒
	C2 &amp;lt; H - M2&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;所以&lt;/li&gt;
&lt;/ol&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;C1 = H - M2  &amp;gt;C2  ⇒ Max(C1, C2);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;再来说明一下负clearence的情况&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%86%8D%E6%9D%A5%E8%AF%B4%E6%98%8E%E4%B8%80%E4%B8%8B%E8%B4%9Fclearence%E7%9A%84%E6%83%85%E5%86%B5&quot; aria-label=&quot;再来说明一下负clearence的情况 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;再来说明一下“负clearence的情况”&lt;/h4&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;p style=&amp;quot;margin-bottom: 4em&amp;quot;&amp;gt;
  First paragraph.
&amp;lt;/p&amp;gt;
&amp;lt;p style=&amp;quot;float: left; height: 2em; margin: 0&amp;quot;&amp;gt;
  Floating paragraph.
&amp;lt;/p&amp;gt;
&amp;lt;p style=&amp;quot;clear: left; margin-top: 3em&amp;quot;&amp;gt;
  Last paragraph.
&amp;lt;/p&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果没有为最后一个段落添加clear属性，第一个和最后一个段落的margin会重叠，最后一个元素的顶部会与浮动元素的的顶部齐平。加上clear之后第三个段落会排列在第二个段落的下方比原来的位置低2em（浮动元素的高度），同时，margin也不在重叠。所以&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;clearence + margin-top = 2em ;
⇒
clearence = 2em -3em = -1em;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;完了，Bye~&lt;/p&gt;</content:encoded></item><item><title><![CDATA[我的响应式web开发实践笔记-Media Queries 初探]]></title><description><![CDATA[很久以前就接触到了响应式Web开发这回事，自己也玩弄过一阵。当时没有整理成笔记，现在在重构自己的在线简历以及hexo主题制作过程中涉及到，就顺手整理成一个系列吧。 响应式web设计并非新的技术，只不过将已有的开发技巧（弹性布局、弹性图片和媒体查询等）整合在了一起， 先来说说媒体…]]></description><link>https://zhanglun.github.io/blogs/我的响应式web开发实践笔记-media queries 初探/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/我的响应式web开发实践笔记-media queries 初探/</guid><pubDate>Fri, 10 Oct 2014 12:30:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;很久以前就接触到了响应式Web开发这回事，自己也玩弄过一阵。当时没有整理成笔记，现在在重构自己的在线简历以及hexo主题制作过程中涉及到，就顺手整理成一个系列吧。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;响应式web设计并非新的技术，只不过将已有的开发技巧（弹性布局、弹性图片和媒体查询等）整合在了一起，&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;先来说说媒体查询Media-Queries&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%85%88%E6%9D%A5%E8%AF%B4%E8%AF%B4%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2Media-Queries&quot; aria-label=&quot;先来说说媒体查询Media Queries permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;先来说说媒体查询（Media Queries）&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;早在 HTML4 和 CSS2 的时代，就已经支持采用不同的样式表来适配不同的媒体设备类型。比如，一个文档在屏幕上和打印时可能使用不同的样式表。在 HTML4中，可以这么写：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;link rel=&amp;quot;stylesheet&amp;quot; type=&amp;quot;text/css&amp;quot; media=&amp;quot;screen&amp;quot; href=&amp;quot;sans-serif.css&amp;quot;&amp;gt;
&amp;lt;link rel=&amp;quot;stylesheet&amp;quot; type=&amp;quot;text/css&amp;quot; media=&amp;quot;print&amp;quot; href=&amp;quot;serif.css&amp;quot;&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在内联的 CSS 样式中，可以像这样指定一部分CSS样式块应用在指定的媒体设备上：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;@media screen {
    * { font-family: sans-serif }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;媒体类型就不在此列举了。如果想让多个媒体设备采用同一套样式，只需在media属性中添加媒体类型的名称，用逗号分开就可以了：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;link rel=&amp;quot;stylesheet&amp;quot; type=&amp;quot;text/css&amp;quot; media=&amp;quot;screen, print, resolution &amp;gt; 90dpi&amp;quot; href=&amp;quot;serif.css&amp;quot;&amp;gt;
&amp;lt;style&amp;gt;
    @media screen {
      * { font-family: sans-serif }
    }
&amp;lt;/style&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;而CSS3 中的媒体查询（Media Queries）就是建立在 HTML4 的媒体查询的语法机制之上，其语法符合 HTML4 中保留的媒体类型语法。HTML4 中的 &lt;code&gt;media&lt;/code&gt; 属性同样存在于 XHTML 和 一般的 XML 中。但是，媒体查询的解析规则不兼容 HTML4 的解析规则，因此，适用于 CSS 中的媒体查询。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;CSS3 中的媒体查询一个媒体类型和零个或者多个检查特定媒体功能的状况的表达式组成。
这些表达式会被解析成真或假。如果媒体查询中的媒体类型与文档要展示的设备相符则查询结果为真，并且媒体查询中的所有表达式为真。媒体类型默认情况是 &lt;code&gt;all&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;link rel=&amp;quot;stylesheet&amp;quot; media=&amp;quot;screen and (max-width: 800px)&amp;quot; href=&amp;quot;example.css&amp;quot; /&amp;gt;

@import url(color.css) screen and (color);

&amp;lt;style&amp;gt;
    @media screen and (max-width: 600px) {
      .facet_sidebar {
        display: none;
      }
    }
&amp;lt;/style&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当媒体查询为真时，相关的样式表或样式规则就会按照正常的级联规则被应用。即使媒体查询返回假， &amp;#x3C;\link&gt; 标签上带有媒体查询的样式表 仍将被下载 （只不过不会被应用）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;可以这么理解：媒体查询无非就是检查当前用户代理是何种设备，设备的某些参数：媒体类型（media type） + CSS属性。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Media-Queries支持的属性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Media-Queries%E6%94%AF%E6%8C%81%E7%9A%84%E5%B1%9E%E6%80%A7&quot; aria-label=&quot;Media Queries支持的属性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Media Queries支持的属性&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;属性&lt;/th&gt;
&lt;th&gt;值&lt;/th&gt;
&lt;th&gt;MIN/MAX&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;color&lt;/td&gt;
&lt;td&gt;整数&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;每种色彩的字节数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;color-index&lt;/td&gt;
&lt;td&gt;整数&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;色彩表中的色彩数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;device-aspect-ratio&lt;/td&gt;
&lt;td&gt;整数/整数&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;宽高比例&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;device-height&lt;/td&gt;
&lt;td&gt;length&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;设备屏幕的输出高度&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;device-width&lt;/td&gt;
&lt;td&gt;length&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;设备屏幕的输出宽度&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;height&lt;/td&gt;
&lt;td&gt;length&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;渲染界面的高度&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;width&lt;/td&gt;
&lt;td&gt;length&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;渲染界面的宽度&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;grid&lt;/td&gt;
&lt;td&gt;整数&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;是否是基于格栅的设备&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;monochrome&lt;/td&gt;
&lt;td&gt;整数&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;单色帧缓冲器中每像素字节&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;resolution&lt;/td&gt;
&lt;td&gt;分辨率(“dpi/dpcm”)&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;分辨率&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;scan&lt;/td&gt;
&lt;td&gt;Progressive interlaced&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;tv媒体类型的扫描方式&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;orientation&lt;/td&gt;
&lt;td&gt;Portrait/landscape&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;横屏或竖屏&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;best-breakpoints&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#best-breakpoints&quot; aria-label=&quot;best breakpoints permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;best breakpoints&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;我现在需要解决的问题是：针对不同屏幕大小的设备的的代码块的媒体查询判断条件该如何书写，在 stackoverflow 上看到的&lt;a href=&quot;http://stackoverflow.com/questions/6370690/media-queries-how-to-target-desktop-tablet-and-mobile&quot; class=&quot;link-underline&quot;&gt;回答&lt;/a&gt;，the best breakpoints:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;style&amp;gt;
    @media (min-width:320px) { /* smartphones, iPhone, portrait 480x320 phones */ }
    @media (min-width:481px) { /* portrait e-readers (Nook/Kindle), smaller tablets @ 600 or @ 640 wide. */ }
    @media (min-width:641px) { /* portrait tablets, portrait iPad, landscape e-readers, landscape 800x480 or 854x480 phones */ }
    @media (min-width:961px) { /* tablet, landscape iPad, lo-res laptops ands desktops */ }
    @media (min-width:1025px) { /* big landscape tablets, laptops, and desktops */ }
    @media (min-width:1281px) { /* hi-res laptops and desktops */ }
&amp;lt;/style&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;如何在-sass-中使用编写媒体查询模块&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E5%9C%A8-sass-%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%BC%96%E5%86%99%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2%E6%A8%A1%E5%9D%97&quot; aria-label=&quot;如何在 sass 中使用编写媒体查询模块 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何在 sass 中使用编写媒体查询模块&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;可以参考这篇文章：&lt;a href=&quot;http://thesassway.com/intermediate/responsive-web-design-in-sass-using-media-queries-in-sass-32&quot; class=&quot;link-underline&quot;&gt;Responsive Web Design in Sass: Using media queries in Sass 3.2&lt;/a&gt;
首先，最简单的是使用 CSS 的语法：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;sass&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// set a variable for the font size
$h1-size: 36px

h1 {
  font-size: $h1-size;
}

// this will only affect wide screens
@media screen and (min-width: 1024px) {
  h1 {
    font-size: $h1-size * 1.5;
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// 编译后：
h1 {
  font-size: 36px;
}
@media screen and (min-width: 1024px) {
  h1 {
    font-size: 54px;
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;同时，sass 为 CSS 的书写提供了是一个相当杀手级功能：当你在其它选择器中嵌套 &lt;code&gt;@media&lt;/code&gt; 时，如果在嵌套的 @media 中添加的属性，sass 会向上一层层查找选择器，将@media中添加的属属性应用在查找到的选择器上，并将其插入到 @media 的代码块中：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;sass&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.profile-pic {
    float: left;
    width: 250px;
    a {
        color: black;
        @media screen and (max-width: 320px) {
            width: 100px;
            color: red;
        }
        @media screen and (min-width: 1200px) {
            float: none;
            color: blue;
        }
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// 编译后：
.profile-pic {
    float: left;
    width: 250px
}
.profile-pic a {
    color: black
}
@media screen and (max-width: 320px) {
    .profile-pic a {
        width: 100px;
        color: red
    }
}
@media screen and (min-width: 1200px) {
    .profile-pic a {
        float: none;
        color: blue
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;其实这个东西也是很好理解的，就不过多解释了，省得啰嗦。但是要记住：还有很多种变化的写法，比如在query中使用变量，在代码块中使用 &lt;code&gt;@extend&lt;/code&gt;.etc。多用用就好了&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;关于-min-widthmin-height-和-max-widthmax-height-的补充20141018&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%85%B3%E4%BA%8E-min-widthmin-height-%E5%92%8C-max-widthmax-height-%E7%9A%84%E8%A1%A5%E5%85%8520141018&quot; aria-label=&quot;关于 min widthmin height 和 max widthmax height 的补充20141018 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;关于 min-width/min-height 和 max-width/max-height 的补充：2014/10/18&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;min-width(height): 最小宽度(高度)；在媒体查询中作为检查条件时，指的是渲染界面的最小宽度（高度）。也就是说当宽度（高度）大于给定的数值时才使用这一块代码块（没有使用的 Media Queries 代码块也会加载）；相反地，max-width(height) 意思就是：当宽度（高度）小于给定的数值时才使用这一块代码块。指定的数值是一个临界值。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;有意思的东西来了！&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;看下面的代码：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.container{
    background:white;
}
@media screen and (min-width:320px) { 
    .container{
        background:red;
    }
}
@media screen and (min-width:481px) { 
    .container{
        background:blue;
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;根据CSS的解析规则，过程如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;container的背景色为white；&lt;/li&gt;
&lt;li&gt;当宽度大于320px时，container的背景色为red；&lt;/li&gt;
&lt;li&gt;当宽度大于481px时，container的背景色为blue；&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;这可能是你想要的顺序，但是如果 你这样：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.container{
    background:white;
}
@media screen and (max-width:320px) { 
    .container{
        background:red;
    }
}
@media screen and (max-width:481px) { 
    .container{
        background:blue;
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;根据CSS的解析规则，过程如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;container的背景色为white；&lt;/li&gt;
&lt;li&gt;当宽度小于320px时，container的背景色为red；&lt;/li&gt;
&lt;li&gt;当宽度小于481px时，container的背景色为blue；&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;好问题来了，小于320 不就是 小于 481 了嘛？后面样式直接覆盖了前面的啊！所以在小于481px的渲染宽度中，颜色都是blue。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;同样的问题：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.container{
    background:white;
}
@media screen and (min-width:481px) { 
    .container{
        background:blue;
    }
}


@media screen and (min-width:321px) { 
    .container{
        background:red;
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;根据CSS的解析规则，过程如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;container的背景色为white；&lt;/li&gt;
&lt;li&gt;当宽度大于481px时，container的背景色为blue；&lt;/li&gt;
&lt;li&gt;当宽度大于321px时，container的背景色为red；&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;其结果显而易见，后面的样式（当宽度大于321px时）直接覆盖了前面的（当宽度大于481px时），所以在大于321px的渲染宽度中，颜色都是red。这也是我们不想看到的结果。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了避免出现上面这混乱的结果，我个人认为可以酱紫：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;max大的。min小的。  

使用max时，值从大到小，依次是，`小于1024px`, `小于961px`, `小于641px`.etc。这是一种桌面端优先的方式，先考虑渲染宽度大的设备。

使用min时，值从小到大，依次是，`大于320px`, `大于481px`, `小于641px`.etc。这是一种移动端优先的方式，先考虑渲染宽度小的设备。

如果这样理解的话，我感觉自己不会混乱了~~&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;参考：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;css3-mediaqueries&lt;a href=&quot;http://www.w3.org/TR/css3-mediaqueries/&quot; class=&quot;link-underline&quot;&gt;http://www.w3.org/TR/css3-mediaqueries/&lt;/a&gt;&lt;br&gt;
前端观察&lt;a href=&quot;http://www.qianduan.net/media-type-and-media-query.html&quot; class=&quot;link-underline&quot;&gt;http://www.qianduan.net/media-type-and-media-query.html&lt;/a&gt;&lt;br&gt;
W3cPlus&lt;a href=&quot;http://www.w3cplus.com/content/css3-media-queries&quot; class=&quot;link-underline&quot;&gt;http://www.w3cplus.com/content/css3-media-queries&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[使用python抓取知乎日报的API数据]]></title><description><![CDATA[使用 urllib2 抓取数据时，最简单的方法是： 使用urllib2.urlopen打开参数中给出的url，返回一个 instance（匿名的object）。 因为这个链接本该返回的是json数据，所以可以用json库提供的json.load方法将对象实例解析成一个字典，直接…]]></description><link>https://zhanglun.github.io/blogs/使用python抓取知乎日报的api数据/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/使用python抓取知乎日报的api数据/</guid><pubDate>Wed, 08 Oct 2014 20:12:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;使用 &lt;code&gt;urllib2&lt;/code&gt; 抓取数据时，最简单的方法是：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;import urllib2, json
def getStartImage():
    stream = urllib2.urlopen(&amp;#39;http://news-at.zhihu.com/api/3/start-image/1080*1776&amp;#39;)
    start_image = json.load(stream)
    start_image = json.dumps(start_image, encoding=&amp;#39;utf-8&amp;#39;)
    return start_image&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;使用&lt;code&gt;urllib2.urlopen&lt;/code&gt;打开参数中给出的url，返回一个 &lt;code&gt;instance&lt;/code&gt;（匿名的object）。&lt;br&gt;
因为这个链接本该返回的是json数据，所以可以用json库提供的&lt;code&gt;json.load&lt;/code&gt;方法将对象实例解析成一个字典，直接return的话，返回的是一个字典转化成的字符串。使用&lt;code&gt;json.dumps()&lt;/code&gt;将dict转换成一个json对象，参数中&lt;code&gt;encoding=&apos;utf-8&apos;&lt;/code&gt;，指定编码格式。&lt;/p&gt;
&lt;!--![](http://ncuey-crispelite.stor.sinaapp.com/1413276441112.png) --&gt;
&lt;p class=&quot;para&quot;&gt;但是这种方法往往会遇到 &lt;code&gt;HTTP Error: 403 Forbidden&lt;/code&gt;，因为网站禁止爬虫抓去该网站的数据。可以在请求中添加 &lt;code&gt;http header&lt;/code&gt;，伪装成一个浏览器发出的请求。这里需要用到 urllib2 提供的一个类&lt;code&gt;Reuqest&lt;/code&gt;:&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;urllib2.Request(url[, data][, headers][, origin_req_host][, unverifiable])&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这个类是一个url请求的抽象化,其具体的使用细节可以参照&lt;a href=&quot;https://docs.python.org/2/library/urllib2.html&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;，在这里就不说了。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;import urllib2, json
# 设置header
headers = {&amp;#39;User-Agent&amp;#39;:&amp;#39;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.6)Gecko/20091201 Firefox/3.5.6&amp;#39;}

def getStartImage():
    req = urllib2.Request(url = &amp;#39;http://news-at.zhihu.com/api/3/start-image/1080*1776&amp;#39;, headers = headers)
    stream = urllib2.urlopen(req)
    start_image = json.load(stream)
    start_image = json.dumps(start_image, encoding=&amp;#39;utf-8&amp;#39;)
    return start_image&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[CSS的盒模型-过去和将来]]></title><description><![CDATA[CSS 诞生已经二十年了，我接触 CSS 才两年。不说多么的精通，但是自信对基本的常用的 CSS 很熟悉。然而，一直往前赶却忽略了事情的本质。昨天有人问我盒模型，我顿时傻了，但是强作镇定稍微解释了一下，然后甩了几个链接要他自己看。我那个心虚啊……实战起来没有问题，但是却没办法说…]]></description><link>https://zhanglun.github.io/blogs/css的盒模型回顾/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/css的盒模型回顾/</guid><pubDate>Sun, 05 Oct 2014 14:30:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;CSS 诞生已经二十年了，我接触 CSS 才两年。不说多么的精通，但是自信对基本的常用的 CSS 很熟悉。然而，一直往前赶却忽略了事情的本质。昨天有人问我盒模型，我顿时傻了，但是强作镇定稍微解释了一下，然后甩了几个链接要他自己看。我那个心虚啊……实战起来没有问题，但是却没办法说出个所以然，这其实就是知识的漏洞。这些漏洞往往致命啊，如果面试的时候答不出来，就over了。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;W3C规范&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#W3C%E8%A7%84%E8%8C%83&quot; aria-label=&quot;W3C规范 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;W3C规范&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;一般来说，页面中的每一个元素都会形成一个矩形盒子，渲染引擎根据给定的样式确定这个盒子的呈现。通俗的来说，页面的布局就是一个个盒子的排列和摆放。掌握了盒子呈现的本质，布局也就轻而易举。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在 W3C 规范中定义了标准的盒模型：&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;Each box has a content area (e.g., text, an image, etc.) and optional surrounding padding, border, and margin areas; the size of each area is specified by properties defined below. The following diagram shows how these areas relate and the terminology used to refer to pieces of margin, border, and padding&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;每一个盒子都有一个内容区域（比如：文本，图片.etc）和可选的环绕着内容的内边距（padding），边框（border），外边距（margin）。盒子的大小有这些属性定义。下面这张图很直观的说明了这一点&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;img src=&quot;http://www.w3.org/TR/CSS2/images/boxdim.png&quot; alt=&quot;W3CR&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;使用 firebug 或者 Chrome 的开发者工具，可以酱紫：&lt;/p&gt;
&lt;!--![firefox](http://ncuey-crispelite.stor.sinaapp.com/2014-10-12_0946.png) --&gt;
&lt;!--![Chrome](http://ncuey-crispelite.stor.sinaapp.com/2014-10-12_0948.png) --&gt;
&lt;p class=&quot;para&quot;&gt;在CSS中定义的宽和高，其实都是内容区域的宽和高，padding，border 和 margin 被排除在盒子尺寸之外。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;所以对于一个定义了宽度的盒子来说，其尺寸的计算方式：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;实际宽度 = margin(left+right) + border(left+right) + padding(left+right) + width(定义的值)

实际高度 = margin(top+bottom) + border(top+bottom) + padding(top+bottom) + height(定义的值)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;可以利用margin调整两个元素之间的距离，用padding调整内容与元素边框之间的距离（留白）。这是标准的盒模型&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;IE6-中的盒模型&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#IE6-%E4%B8%AD%E7%9A%84%E7%9B%92%E6%A8%A1%E5%9E%8B&quot; aria-label=&quot;IE6 中的盒模型 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;IE6 中的盒模型&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;那么问题来了，当元素定义了一个固定的宽度（高度）值后，如果修改padding，元素在页面上所占的宽度（高度）也会随着padding的值的变化而变化。同理，当你想调整内容与边框之间的距离而修改了padding后，为了保持元素在页面上所占的宽度（高度）固定，还需要修改定义的内容的宽度。如此的麻烦。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;再举个例子，日常生活中的盒子，当我们定义它的大小时，绝对不会使用盒子中存放的物品的尺寸来定义盒子的大小。对于这个盒子来说，外围的挡板可以看成border，防止物品破损的填充物可以看成padding，在现实中，当我们说一个盒子有多大时，指的就是它的实际大小，也就是 &lt;code&gt;“border+padding+contentWidth”&lt;/code&gt;。这种设定似乎是更贴合实际也更容易理解和接受。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在IE的quirks模式下，其盒模型的解释正是如此。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;box-sizing&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#box-sizing&quot; aria-label=&quot;box sizing permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;box-sizing&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;不过在新的 CSS3 中，推出了一个新的属性 &lt;code&gt;box-sizing&lt;/code&gt; 。有两个可选值，一个是默认的 content-box 一个是 border-box，选用后者，盒子模型将按 IE6 的方式进行处理&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##margin的重叠&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;就参照标准的文档，结合自己的理解稍微翻译了一下，有些名词还是用英文描述比较合适。文档地址：&lt;a href=&quot;http://www.w3.org/TR/CSS21/box.html#margin-properties&quot; class=&quot;link-underline&quot;&gt;点这里&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;在CSS中，两个或者更多的盒子的毗邻的外边距会重叠在一起，形成一个单一的外边距。外边距的这种组合方式我们称之为“坍塌”，最后形成的外边距我们称之为“坍塌的外边距（collapse margin）”。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;垂直方向上的外边距的坍塌，除了：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;根元素的盒子（the root elements’s box）的外边距永远不会坍塌。当你为 &lt;code&gt;html&lt;/code&gt; 标签加上 &lt;code&gt;margin&lt;/code&gt; 时，无论有无毗邻的外边距，这个margin的都不会坍塌，是多少就多少。&lt;/li&gt;
&lt;li&gt;如果一个拥有了“空隙”（&lt;a href=&quot;http://www.w3.org/TR/CSS21/visuren.html#clearance&quot; class=&quot;link-underline&quot;&gt;clearance&lt;/a&gt;）的元素上下外边距毗邻，它的外边距将会与后面的兄弟元素的相邻外边距发生坍塌，但是发生坍塌后形成的外边距不会与父盒子的底外边&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;水平方向的外边距永远不会坍塌。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;什么情况下两个外边距才算是毗邻（adjoining）呢？有且只有在下面的情况中：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;同一个块级格式化上下文（block formatting context）中未脱离正常流（in-flow）中的块级盒子的外边距；&lt;/li&gt;
&lt;li&gt;两个外边距之间不存在 line box（不包括高度确定无疑为零的 line box），没有 &lt;a href=&quot;http://www.w3.org/TR/CSS21/visuren.html#clearance&quot; class=&quot;link-underline&quot;&gt;clearance&lt;/a&gt;，外边距和边框；&lt;/li&gt;
&lt;li&gt;垂直相邻的的盒子之间的外边距，可以下面的任一种情况：
元素的 &lt;code&gt;margin-top&lt;/code&gt; 与其第一个正常流（in-flow）的子元素的 &lt;code&gt;margin-top&lt;/code&gt; ；
元素的 &lt;code&gt;margin-top&lt;/code&gt; 与其第一个正常流的子元素的 &lt;code&gt;margin-top&lt;/code&gt; ;
height为auto的元素的 &lt;code&gt;margin-bottom&lt;/code&gt; 与其最后一个正常流的子元素的 &lt;code&gt;margin-bottom&lt;/code&gt; ;
高度为0并且最小高度也为0，不包含正常流的子元素，并且自身没有建立新的BFC的元素的 &lt;code&gt;margin-top&lt;/code&gt; 和 &lt;code&gt;margin-bottom&lt;/code&gt; ;&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;形成坍塌的外边距的元素可以使非相邻元素或者祖先元素。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;上面说到的也就意味着：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;一个浮动的盒子与其他的盒子不会发生外边距坍塌，即使是浮动盒子和它内部的正常流中的孩子们；&lt;/li&gt;
&lt;li&gt;自身建立了新的BFC的元素的外边距不会与它的处于正常流的孩子们的外边距重叠；&lt;/li&gt;
&lt;li&gt;inline-block 盒子的外边距不会坍塌，即使是它内部的正常流中的孩子们；&lt;/li&gt;
&lt;li&gt;一个正常流元素的 &lt;code&gt;margin-bottom&lt;/code&gt; 与它下一个正常流的兄弟元素的 &lt;code&gt;margin-top&lt;/code&gt; 会产生折叠，除非它们之间存在间隙（clearance）。&lt;/li&gt;
&lt;li&gt;一个正常流元素的 &lt;code&gt;margin-top&lt;/code&gt; 与其第一个正常流的子元素的 &lt;code&gt;margin-top&lt;/code&gt; 产生折叠，条件为父元素不包含 &lt;code&gt;padding&lt;/code&gt; 和 &lt;code&gt;border&lt;/code&gt; ，子元素不包含 clearance。&lt;/li&gt;
&lt;li&gt;一个 ‘height’ 为 ‘auto’ 并且 ‘min-height’ 为 ‘0’的正常流元素的 &lt;code&gt;margin-bottom&lt;/code&gt; 会与其最后一个正常流子元素的 &lt;code&gt;margin-bottom&lt;/code&gt; 折叠，条件为父元素不包含 &lt;code&gt;padding&lt;/code&gt; 和 &lt;code&gt;border&lt;/code&gt; ，子元素的 &lt;code&gt;margin-bottom&lt;/code&gt; 不与包含 clearance 的 &lt;code&gt;margin-top&lt;/code&gt; 折叠。&lt;/li&gt;
&lt;li&gt;一个不包含 &lt;code&gt;border-top&lt;/code&gt;、&lt;code&gt;border-bottom&lt;/code&gt;、&lt;code&gt;padding-top&lt;/code&gt;、&lt;code&gt;padding-bottom&lt;/code&gt;的正常流元素，并且其 ‘height’ 为 0 或 ‘auto’， ‘min-height’ 为 ‘0’，其里面也不包含行盒(line box)，其自身的 &lt;code&gt;margin-top&lt;/code&gt; 和 &lt;code&gt;margin-bottom&lt;/code&gt; 会折叠。&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;在 W3CPlus 的&lt;a href=&quot;http://www.w3cplus.com/css/understanding-bfc-and-margin-collapse.html&quot; class=&quot;link-underline&quot;&gt;这篇文章&lt;/a&gt;中，有详细的分析，不懂的话可以看&lt;a href=&quot;http://www.w3cplus.com/css/understanding-bfc-and-margin-collapse.html&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;参考：&lt;br&gt;
&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/CSS/box_model&quot; class=&quot;link-underline&quot;&gt;box model (MDN)&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://css-tricks.com/the-css-box-model/&quot; class=&quot;link-underline&quot;&gt;The CSS Box Model&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://zh.wikipedia.org/wiki/IE%E7%9B%92%E6%A8%A1%E5%9E%8B%E7%BC%BA%E9%99%B7&quot; class=&quot;link-underline&quot;&gt;IE盒模型缺陷&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.w3.org/TR/CSS2/box.html#box-dimensions&quot; class=&quot;link-underline&quot;&gt;box model&lt;/a&gt;
&lt;a href=&quot;http://www.w3cplus.com/css/understanding-bfc-and-margin-collapse.html&quot; class=&quot;link-underline&quot;&gt;W3CPlus&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.w3.org/TR/CSS21/box.html#margin-properties&quot; class=&quot;link-underline&quot;&gt;margin-prototypies&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[规范之路-Normal Flow]]></title><description><![CDATA[##Normal Flow 在正常流中的盒子们都是一个格式化上下文（formatting context）中的成员，可以表现成一个block或者inline，但是不能既是block又是inline。block 元素进入块级格式化上下文（block formatting cont…]]></description><link>https://zhanglun.github.io/blogs/规范之路-normal flow/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/规范之路-normal flow/</guid><pubDate>Thu, 02 Oct 2014 20:39:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;##Normal Flow&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在正常流中的盒子们都是一个格式化上下文（formatting context）中的成员，可以表现成一个block或者inline，但是不能既是block又是inline。block 元素进入块级格式化上下文（block formatting context），inline 元素进入行级格式化上下文（inline formatting context）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###Block formatting contexts&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;浮动元素，绝对定位元素，非块级盒子的块级容器（inline-block元素，table-cell元素和table-caption元素）和 overflow 的值不为 visiable的盒子，都会为它们的内容创建一个新的块级格式化上下文（BFC）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在BFC中，盒子从顶端开始垂直地一个接一个地排列，两个盒子之间的垂直的间隙是由他们的margin 值所决定的。在一个BFC中，两个相邻的块级盒子的垂直外边距会产生折叠。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在BFC中，每一个盒子的左外边缘（margin-left）会触碰到容器的左边缘(padding-left 或者 border-left)（对于从右到左的格式来说，则触碰到右边缘）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###Inline formatting contexts&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在IFC中，盒子从顶端水平地一个接一个地排列。盒子之间的水平的外边距，边框和内边距会起作用。这些可以可以以不同的方式对齐：底部对齐，顶部对齐或者盒子内容中文本的基线对齐。每一行包含的盒子所形成的矩形区域我们称之为“line box”。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;通常情况下，一个line box的高度足够容纳它包含的盒子。但是，有可能会比最高的盒子还高。当一个盒子B的高度比包含着它的line box 的高度还要小的时候，盒子B在line box中的垂直对齐由属性 “vertival-align” 决定。当几个行级盒子不能在一个单一的line box中正常地水平排列时，它们会被分配到两个或者多个垂直堆叠（vertical-stacked）的line box中。因此一个段落是line box中一个垂直的堆（vertical stack）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;通常来说，一个line box的左边缘会接触到它的包含块的做边缘，右边缘接触到包含块的右边缘。但是，浮动的盒子可能会出现在line box 的边缘和它的包含块的边缘之间。因此，虽然在同一个IFC中的line box有同样的宽度（取决于包含块的宽度），但是当浮动导致水平方向上可用的空间减少时，它们宽度将不一样。同样的，同一个IFC中的它们的高度也有可能不同，比如有的包含一个图片，有的只包含一行文字。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当一个内联元素的超过了 line box 的宽度，它将分割成若干个盒子，并且这些盒子将会分布在多个line box 上。但是有时候超过宽度的盒子没办法被分割（e.g., 盒子中包含一个单字符；语言特定的断字规则不允许断开；内联盒子受 CSS属性 &lt;code&gt;white-space&lt;/code&gt; 的值 &lt;code&gt;nowrap&lt;/code&gt; 或者 &lt;code&gt;pre&lt;/code&gt; 标签的作用），它将溢出。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当一个内联盒子被截断时，margin，padding和border在截断处都不会有任何的视觉效果。&lt;/p&gt;
&lt;hr&gt;
&lt;!--![inline-box-split-margin](http://ncuey-crispelite.stor.sinaapp.com/inline-box-split-margin.png) --&gt;
&lt;hr&gt;
&lt;!--![inline-box-split-padding](http://ncuey-crispelite.stor.sinaapp.com/inline-box-split-padding.png) --&gt;
&lt;hr&gt;
&lt;!--![inline-box-split-border](http://ncuey-crispelite.stor.sinaapp.com/inline-box-split-border.png) --&gt;
&lt;hr&gt;
&lt;p class=&quot;para&quot;&gt;Line box 的诞生是为了容纳一个包含着一个行级格式化上下文的行级内容（inline-level content）。当一个 line box 中不包含文本，不存在保留的空白，没有非零外边距，内边距，或者边框的内联元素和其他未脱离文档流的内容，以及不已一个保留的新行作为结尾时，它的高度被看作是0（zero-height）&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;这是一个inline box 建立的过程。p元素的内容中包含一段匿名的文本，并穿插着em元素和strong元素：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;p&amp;gt;
    Several 
    &amp;lt;em&amp;gt;emphasized words&amp;lt;/em&amp;gt;
     appear
    &amp;lt;strong&amp;gt;in this&amp;lt;/strong&amp;gt;
     sentence, dear.
&amp;lt;/p&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;p元素形成了一个块级盒子，包含着五个行内盒子，其中三个是匿名盒子：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Anonymous: “Several”&lt;/li&gt;
&lt;li&gt;EM: “emphasized words”&lt;/li&gt;
&lt;li&gt;Anonymous: “appear”&lt;/li&gt;
&lt;li&gt;STRONG: “in this”&lt;/li&gt;
&lt;li&gt;Anonymous: “sentence, dear.”&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;为了格式化这个段落，用户代理将五个盒子绘入到 line box 中。在这个例子里面，p元素形成的盒子为inline box 建立了一个 containing block。如果包含块足够宽，所有行内盒子将放入一个单独的一行中：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Several emphasized words appear in this sentence, dear.&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果不是，则行内盒子将被分裂并分布在几个 line box中。前一段可能会被分拆如下：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Several emphasized words appear
in this sentence, dear.&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;或者这样：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Several emphasized  
words appear in this 
sentence, dear.&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;下次就是&lt;a href=&quot;http://www.w3.org/TR/CSS21/visuren.html#floats&quot; class=&quot;link-underline&quot;&gt;Floats&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Bye~&lt;/p&gt;</content:encoded></item><item><title><![CDATA[CSS元素居中对齐大法]]></title><description><![CDATA[原文标题：Centering in CSS: A Complete Guide 原文链接：http://css-tricks.com/centering-css-complete-guide/ 在CSS-tricks上看到一篇关于CSS居中的文章，综合和大部分的CSS居中的解决…]]></description><link>https://zhanglun.github.io/blogs/css元素居中对齐大法/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/css元素居中对齐大法/</guid><pubDate>Tue, 30 Sep 2014 20:34:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;原文标题：Centering in CSS: A Complete Guide&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;原文链接：&lt;a href=&quot;http://css-tricks.com/centering-css-complete-guide/&quot; class=&quot;link-underline&quot;&gt;http://css-tricks.com/centering-css-complete-guide/&lt;/a&gt;&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;在CSS-tricks上看到一篇关于CSS居中的文章，综合和大部分的CSS居中的解决方案，暂且称作“CSS元素居中大法”好了。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;大家一直在吐槽的很多，其中就有关于CSS元素居中的问题。为什么这个问题看起来这么难以处理。在我看来，并不是这个问题太难，而是有太多不同的解决方案，因此很难知道哪一个是合适自己的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;所以让我们来做一个决策树，希望能够让CSS的元素居中问题变得简单。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##水平方向居中&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###inline 和 inline-* 元素的水平方向居中&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你可以很轻松的将一个块级元素中的inline或者类inline元素居中：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.center-children{
	text-align:center;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;HTML:&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;header&amp;gt;
	This text is centered.
&amp;lt;/header&amp;gt;
&amp;lt;nav role=&amp;#39;navigation&amp;#39;&amp;gt;
	&amp;lt;a href=&amp;quot;#0&amp;quot;&amp;gt;One&amp;lt;/a&amp;gt;
    &amp;lt;a href=&amp;quot;#0&amp;quot;&amp;gt;Two&amp;lt;/a&amp;gt;
    &amp;lt;a href=&amp;quot;#0&amp;quot;&amp;gt;Three&amp;lt;/a&amp;gt;
    &amp;lt;a href=&amp;quot;#0&amp;quot;&amp;gt;Four&amp;lt;/a&amp;gt;
&amp;lt;/nav&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;CSS:&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;header, nav {
    text-align: center;
    background: white;
    margin: 20px 0;
	padding: 10px;
}
nav a {
    text-decoration: none;
    background: #333;
    border-radius: 5px;
    color: white;
    padding: 3px 8px;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;!--![single-line-inline](http://ncuey-crispelite.stor.sinaapp.com/single-line-inline.png) --&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;注意：&lt;/strong&gt; 这个方法对inline, inline-block, inline-table, inline-flex元素都有效&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###块级元素的水平方向居中&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;将一个定宽的块级元素的左外边距和右外边距设为&lt;code&gt;auto&lt;/code&gt;，就是这么的easy&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;HTML:&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;main&amp;gt;
    &amp;lt;div class=&amp;quot;center&amp;quot;&amp;gt;
    	I&amp;#39;m a block level element and am centered.
    &amp;lt;/div&amp;gt;
&amp;lt;/main&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;CSS:&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;body {
	background: #f06d06;
}
main {
	background: white;
    margin: 20px 0;
    padding: 10px;
}
.center {
    margin: 0 auto;
    width: 200px;
    background: black;
    padding: 20px;
    color: white;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;!--![single-block](http://ncuey-crispelite.stor.sinaapp.com/single-block-center.png) --&gt;
&lt;p class=&quot;para&quot;&gt;如果想让多个块级元素在同一行中水平居中时，最好的处理方式就是修改块级元素的 display 的属性值。一种方式是将display的值设置为&lt;code&gt;inline-block&lt;/code&gt;，另一种是&lt;code&gt;flexbox&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;HTML：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;main class=&amp;quot;inline-block-center&amp;quot;&amp;gt;
    &amp;lt;div&amp;gt;
   		I&amp;#39;m an element that is block-like with my siblings and we&amp;#39;re centered in a row.
    &amp;lt;/div&amp;gt;
    &amp;lt;div&amp;gt;
        I&amp;#39;m an element that is block-like with my siblings and we&amp;#39;re centered in a row. I have more content in me than my siblings do.
    &amp;lt;/div&amp;gt;
    &amp;lt;div&amp;gt;
    	I&amp;#39;m an element that is block-like with my siblings and we&amp;#39;re centered in a row.
    &amp;lt;/div&amp;gt;
&amp;lt;/main&amp;gt;

&amp;lt;!--flexbox--&amp;gt;
&amp;lt;main class=&amp;quot;flex-center&amp;quot;&amp;gt;
    &amp;lt;div&amp;gt;
        I&amp;#39;m an element that is block-like with my siblings and we&amp;#39;re centered in a row.
    &amp;lt;/div&amp;gt;
    &amp;lt;div&amp;gt;
        I&amp;#39;m an element that is block-like with my siblings and we&amp;#39;re centered in a row. I have more content in me than my siblings do.
    &amp;lt;/div&amp;gt;
    &amp;lt;div&amp;gt;
        I&amp;#39;m an element that is block-like with my siblings and we&amp;#39;re centered in a row.
    &amp;lt;/div&amp;gt;
&amp;lt;/main&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;CSS:&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;body {
    background: #f06d06;
    font-size: 80%;
}
main {
    background: white;
    margin: 20px 0;
    padding: 10px;
}
main div {
    background: black;
    color: white;
    padding: 15px;
    max-width: 125px;
    margin: 5px;
}
.inline-block-center {
    text-align: center;
}
.inline-block-center div {
    display: inline-block;
    text-align: left;
}
.flex-center {
    display: flex;
    justify-content: center;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;!--![multiple-block](http://ncuey-crispelite.stor.sinaapp.com/mulity-block-center.png) --&gt;
&lt;p class=&quot;para&quot;&gt;##垂直方向居中&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;关于垂直方向上的居中，需要用到一下小trickers&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###inline 和 inline-* 元素的垂直方向居中
####单行的内联元素垂直居中&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;最简单的一种，上内边距和下内边距相等：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;HTML:&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;main&amp;gt;
    &amp;lt;a href=&amp;quot;#0&amp;quot;&amp;gt;We&amp;#39;re&amp;lt;/a&amp;gt;
    &amp;lt;a href=&amp;quot;#0&amp;quot;&amp;gt;Centered&amp;lt;/a&amp;gt;
    &amp;lt;a href=&amp;quot;#0&amp;quot;&amp;gt;Bits of&amp;lt;/a&amp;gt;
    &amp;lt;a href=&amp;quot;#0&amp;quot;&amp;gt;Text&amp;lt;/a&amp;gt;
&amp;lt;/main&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;CSS:&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;main {
    background: white;
    margin: 20px 0;
    padding: 50px;
}
main a {
    background: black;
    color: white;
    padding: 40px 30px;
    text-decoration: none;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;!--![v-single-line](http://ncuey-crispelite.stor.sinaapp.com/v-single-line.png) --&gt;
&lt;p class=&quot;para&quot;&gt;因为某些原因不能使用这种简单粗暴的方法（这种方法也有其局限性），或者你想垂直居中没有元素包裹的文本的时候，利用&lt;code&gt;line-height&lt;/code&gt;属性。将容器的&lt;code&gt;line-height&lt;/code&gt;的值设置为与容器高度相同的值，就能很轻松的居中文本。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;HTML:&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;main&amp;gt;
    &amp;lt;div&amp;gt;
        I&amp;#39;m a centered line.
    &amp;lt;/div&amp;gt;
&amp;lt;/main&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;CSS:&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;main {
    background: white;
    margin: 20px 0;
    padding: 40px;
}
main div {
    background: black;
    color: white;
    height: 100px;
    line-height: 100px;
    padding: 20px;
    width: 50%;
    white-space: nowrap;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;!--![line-height](http://ncuey-crispelite.stor.sinaapp.com/v-single-lineheight.png) --&gt;
&lt;p class=&quot;para&quot;&gt;####多行的内联元素垂直居中&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;上下内边距相等的方法同样可以用在多行的处理上，但是就像前面所说的，这种方法有局限性。当元素是一个表格单元或者通过CSS的设置表现成一个单元格时，这种方法就不奏效了。在这种情况下，使用&lt;code&gt;vertical-align&lt;/code&gt;属性来解决这个问题&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;HTML:&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;table&amp;gt;
    &amp;lt;tr&amp;gt;
    	&amp;lt;td&amp;gt;
        	I&amp;#39;m vertically centered multiple lines of text in a real table cell.
        &amp;lt;/td&amp;gt;
    &amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;
&amp;lt;div class=&amp;quot;center-table&amp;quot;&amp;gt;
    &amp;lt;p&amp;gt;I&amp;#39;m vertically centered multiple lines of text in a CSS-created table layout.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;CSS:&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;body {
    background: #f06d06;
    font-size: 80%;
}
table {
    background: white;
    width: 240px;
    border-collapse: separate;
    margin: 20px;
    height: 250px;
}
table td {
    background: black;
    color: white;
    padding: 20px;
    border: 10px solid white;
    /* 单元格自带 vertical-align: middle; */
}
.center-table {
    display: table;
    height: 250px;
    background: white;
    width: 240px;
    margin: 20px;
}
.center-table p {
    display: table-cell; // 将p表现成一个单元格
    margin: 0;
    background: black;
    color: white;
    padding: 20px;
    border: 10px solid white;
    vertical-align: middle; // 添加单元格默认的属性
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;!--![nu-table-cell](http://ncuey-crispelite.stor.sinaapp.com/mu-table-cell.png) --&gt;
&lt;p class=&quot;para&quot;&gt;如果不能使用“表格大法”，可以试试flexbox。一个flex-child在flex-parent中垂直居中松松的。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.flex-center-vertically {
    display: flex;
    justify-content: center;
    flex-direction: column;
    height: 400px;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;完整的demo&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;HTML:&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;div class=&amp;quot;flex-center&amp;quot;&amp;gt;
	&amp;lt;p&amp;gt;I&amp;#39;m vertically centered multiple lines of text in a flexbox container.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;CSS:&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;body {
    background: #f06d06;
    font-size: 80%;
}
div {
    background: white;
    width: 240px;
    margin: 20px;
}
.flex-center {
    background: black;
    color: white;
    border: 10px solid white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    height: 200px;
}
.flex-center p {
    margin: 0;
    padding: 20px;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;!--![mu-flex-center](http://ncuey-crispelite.stor.sinaapp.com/mu-flex-center.png) --&gt;
&lt;p class=&quot;para&quot;&gt;flex-parent元素必须指定一个固定高度。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;还有一种称之为“幽灵元素”的技术，可以在上述方法不适用的情况下使用。其实现原理是：在container容器中放置一个&lt;code&gt;height:100%&lt;/code&gt;的伪元素，然后文本与这个伪元素垂直对齐。核心代码：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.ghost-center {
	position: relative;
}
.ghost-center::before {
    content: &amp;quot; &amp;quot;;
    display: inline-block;
    height: 100%;
    width: 1%;
    vertical-align: middle;
}
.ghost-center p {
    display: inline-block;
    vertical-align: middle;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;完整的demo：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;HTML:&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;div class=&amp;quot;ghost-center&amp;quot;&amp;gt;
    &amp;lt;p&amp;gt;I&amp;#39;m vertically centered multiple lines of text in a container. Centered with a ghost pseudo element&amp;lt;/p&amp;gt; 
    &amp;lt;p&amp;gt;I&amp;#39;m vertically centered multiple lines of text in a container. Centered with a ghost pseudo elementI&amp;#39;m vertically centered multiple lines of text in a container. Centered with a ghost pseudo elementI&amp;#39;m vertically centered multiple lines of text in a container. Centered with a ghost pseudo element&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;CSS:&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;body {
    background: #f06d06;
    font-size: 80%;
}
div {
    background: white;
    height: 360px;
    margin: 20px;
    color: white;
    resize: vertical;
    overflow: auto;
    padding: 20px;
}
.ghost-center::before {
    content: &amp;quot;&amp;quot;;
    display: inline-block;
    height: 100%;
    width: 10px; // 为了效果明显 设置了一个固定的宽度 增加了背景色
    background:red;
    vertical-align: middle;
}
.ghost-center p {
    display: inline-block;
    vertical-align: middle;
    width: 190px;
    margin: 0;
    padding: 20px;
    background: black;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;!--![presudo-element-center](http://ncuey-crispelite.stor.sinaapp.com/presudo-element-center.png) --&gt;
&lt;p class=&quot;para&quot;&gt;你可以试着修改伪元素的高度~~&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;####单个块级元素的垂直方向居中&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在页面的布局中，其高度未知是很正常的，有很多原因。当宽度改变的时候，内容中的文本回流改变高度；变化的文本样式也可能改变高度；变化的文本数量也会改变高度；一些按比例放置的元素，比如图片，当它调整大小的时候，高度也会变化；等等。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果知道元素的高度。可以使用定位来垂直居中：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.parent {
	position: relative;
}
.child {
    position: absolute;
    top: 50%;
    height: 100px;
    margin-top: -50px; 
    // 这里实际上元素高度的一半，如果没有使用box-sizing:border-box;则需要计算padding和border
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果不知道元素的高度，也有办法。先定位再平移&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.parent {
	position: relative;
}
.child {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当top:50%时，元素的顶部与其包裹的容器高度一半的位置处对齐。利用transform在Y轴上平移时，默认情况下参考点是元素的正中心，向上平移50%的距离其实就是元素的高度一半。&lt;/p&gt;
&lt;!--![](http://ncuey-crispelite.stor.sinaapp.com/2014-10-03_195015.png) --&gt;
&lt;p class=&quot;para&quot;&gt;当然如果使用flexbox也是很简单，不必大惊小怪&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.parent {
    display: flex;
    flex-direction: column;
	justify-content: center;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;##水平方向和垂直方向同时居中&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;前面分开介绍了水平方向和垂直方向上CSS元素居中的解决方案。我们可以组合上面的方法，提出两个方向上同时居中对齐的解决方案。但是我发现一般来说可以分成三类&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###固定大小的元素两个方向上的居中对齐&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在两个方向上定位之后，水平方向上添加值为宽度的一半的负margin，在垂直方向上添加值为高度一般的负margin。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这很好理解，无需做过多解释&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###大小未知的元素两个方向上的居中对齐&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这个可以说其实就是上面介绍的方法的拓展，只不过也是增加了一个水平方向的处理而已，自己想想~~&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###第三类：flexbox&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;第三类就是可以称之上万能的的CSS3中的flexbox&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##结论&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;酱紫，你就可以轻松解决CSS的元素居中问题了。拜拜了，CSS Center。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[CSS 中的权重问题]]></title><description><![CDATA[自己对以后的方向很明确，但是却一直做不到。接连的 rejected 多少对自己有影响。不是自己不去争取，而是真的已经疲了，或者说自己也怂了。面试的时候已经不知道该怎么办，即使自己的知道的问题也只会模棱两可地回答。滚回学校慢慢学吧 如果你现在问我CSS的权重，我也只能说个大概。于…]]></description><link>https://zhanglun.github.io/blogs/css中的权重问题/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/css中的权重问题/</guid><pubDate>Fri, 26 Sep 2014 12:23:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;自己对以后的方向很明确，但是却一直做不到。接连的 rejected 多少对自己有影响。不是自己不去争取，而是真的已经疲了，或者说自己也怂了。面试的时候已经不知道该怎么办，即使自己的知道的问题也只会模棱两可地回答。滚回学校慢慢学吧&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;如果你现在问我CSS的权重，我也只能说个大概。于是开始整理有关的资料。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;CSS-Specificity&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#CSS-Specificity&quot; aria-label=&quot;CSS Specificity permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CSS Specificity&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;有时候你会发现自己辛辛苦苦写的CSS样式不起作用，文件引入了，浏览器也加载了，但就是不按照你想要的方式显示，这个时候你就需要考虑 CSS权重的问题。如果你对权重的工作方式有所了解，将会大大减少调试bug的时间。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果想解释权重的工作方式，最好的办法就是针对问题来分析。下面就是一个 CSS 样式没有按照期待的方式显示的例子。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;一个简单的无序列表&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;ul id=&amp;quot;summer-drinks&amp;quot;&amp;gt;
   &amp;lt;li class=&amp;quot;favorite&amp;quot;&amp;gt;Whiskey and Ginger Ale&amp;lt;/li&amp;gt;
   &amp;lt;li&amp;gt;Wheat Beer&amp;lt;/li&amp;gt;
   &amp;lt;li&amp;gt;Mint Julip&amp;lt;/li&amp;gt;
&amp;lt;/ul&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;而在CSS中，是酱紫的：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;ul#summer-drinks li {
   font-weight: normal;
   font-size: 12px;
   color: black;
}
.favorite {
  color: red;
  font-weight: bold;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;但是你会发现，拥有class为favorite的li元素中的内容并没有像你期待的那样加粗变红。这就是权重引发的“血案“！别急别急，我们可以好好的捋一捋。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;什么是CSS的权重&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%80%E4%B9%88%E6%98%AFCSS%E7%9A%84%E6%9D%83%E9%87%8D&quot; aria-label=&quot;什么是CSS的权重 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;什么是CSS的权重&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;我的理解就是：CSS规则的优先顺序，权重高的优先。权利大的才有发言权。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;每个选择器都有自己的权重。你的每条css规则，都包含一个权重级别。权重决定了哪一条规则会被浏览器应用在元素上，如果两个选择器作用在同一元素上，则权重高者生效。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;那上面的例子来说，两个CSS选择器 &lt;code&gt;ul#summer-drinks&lt;/code&gt; 和 &lt;code&gt;.favorite&lt;/code&gt; 有自己的权重，而前者的权重高于后者。所以采用的样式由前者决定而非后者。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;如何计算权重&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E8%AE%A1%E7%AE%97%E6%9D%83%E9%87%8D&quot; aria-label=&quot;如何计算权重 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何计算权重&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;规范中给出的定义在&lt;a href=&quot;http://www.w3.org/TR/CSS2/cascade.html#specificity&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;，分成四种不同等级的基础权重值，选择器最终的权重（优先级）由四个值共同决定。这四个等级分别是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;行内样式，html文档中定义的style，不包含选择器，直接对元素起作用。&lt;/li&gt;
&lt;li&gt;ID选择器&lt;/li&gt;
&lt;li&gt;类（class），属性选择器（attribute selector）和伪类选择器（pseudo-class-selector）&lt;/li&gt;
&lt;li&gt;元素和伪元素（pseudo-elements）&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;搞明白了这几个等级，权重的计算也是很简单了，为了方便计算和描述，分别将这四个等级标记为a, b, c, d。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果样式声明来自行内样式（style），将不包含选择器，直接作用在元素上，权重的基础值记为&lt;code&gt;1&lt;/code&gt;, a = 1;&lt;/li&gt;
&lt;li&gt;计算选择器中ID选择器的个数x，b = x;&lt;/li&gt;
&lt;li&gt;计算选择器中class选择器，属性选择器和伪类选择器的个数y，c = y;&lt;/li&gt;
&lt;li&gt;计算元素选择器和伪元素的个数z，d = z;&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;就象这样：&lt;/p&gt;
&lt;!--![http://ncuey-crispelite.stor.sinaapp.com/specificity-calculationbase.png](http://ncuey-crispelite.stor.sinaapp.com/specificity-calculationbase.png)   --&gt;
&lt;p class=&quot;para&quot;&gt;最后的到的权重就是 &lt;code&gt;0(1), x, y, z&lt;/code&gt;，把它看作一个4位数的数字，数字越大权重越高。可以这么记：从0开始，一个行内样式+1000，一个id+100，一个属性选择器/class或者伪类+10，一个元素名，或者伪元素+1.比如：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt; *             {}  /* a=0 b=0 c=0 d=0 -&amp;gt; specificity = 0,0,0,0 */
 li            {}  /* a=0 b=0 c=0 d=1 -&amp;gt; specificity = 0,0,0,1 */
 li:first-line {}  /* a=0 b=0 c=0 d=2 -&amp;gt; specificity = 0,0,0,2 */
 ul li         {}  /* a=0 b=0 c=0 d=2 -&amp;gt; specificity = 0,0,0,2 */
 ul ol+li      {}  /* a=0 b=0 c=0 d=3 -&amp;gt; specificity = 0,0,0,3 */
 h1 + *[rel=up]{}  /* a=0 b=0 c=1 d=1 -&amp;gt; specificity = 0,0,1,1 */
 ul ol li.red  {}  /* a=0 b=0 c=1 d=3 -&amp;gt; specificity = 0,0,1,3 */
 li.red.level  {}  /* a=0 b=0 c=2 d=1 -&amp;gt; specificity = 0,0,2,1 */
 #x34y         {}  /* a=0 b=1 c=0 d=0 -&amp;gt; specificity = 0,1,0,0 */
 style=&amp;quot;&amp;quot;          /* a=1 b=0 c=0 d=0 -&amp;gt; specificity = 1,0,0,0 */
&amp;lt;head&amp;gt;
&amp;lt;style type=&amp;quot;text/css&amp;quot;&amp;gt;
  #x97z { color: red }
&amp;lt;/style&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
&amp;lt;P id=&amp;quot;x97z&amp;quot; style=&amp;quot;color: green&amp;quot;&amp;gt;
&amp;lt;/body&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;P标签的颜色将会是绿色，因为权重的关系，行内样式会覆盖其他定义的样式。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;借鉴一下老外的图：&lt;/p&gt;
&lt;!--![1](http://ncuey-crispelite.stor.sinaapp.com/cssspecificity-calc-1.png)   --&gt;
&lt;p class=&quot;para&quot;&gt;或者&lt;/p&gt;
&lt;!--![2](http://ncuey-crispelite.stor.sinaapp.com/cssspecificity-calc-2.png)   --&gt;
&lt;p class=&quot;para&quot;&gt;然后&lt;/p&gt;
&lt;!--![4](http://ncuey-crispelite.stor.sinaapp.com/cssspecificity-calc-4.png)  --&gt;
&lt;p class=&quot;para&quot;&gt;还有&lt;/p&gt;
&lt;!--![5](http://ncuey-crispelite.stor.sinaapp.com/cssspecificity-calc-5.png)   --&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;要注意的是&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通配符选择器 &lt;code&gt;*&lt;/code&gt; 不具有特殊性，其权重为(0, 0, 0, 0)&lt;/li&gt;
&lt;li&gt;伪元素(0, 0, 0, 1)和伪类选择器(0, 0, 1, 0)不是同一个东西，他们的权重值也不一样&lt;/li&gt;
&lt;li&gt;伪类选择器 :not()不具有特殊性，它的权重由括号内的内容决定&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;###特殊的 !important
!important 用于单独指定某条样式中的单个属性。对于被指定的属性，有 !important 指定的权重值大于所有未用 !important 指定的规则。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;例如：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;#header nav ul li.current {
	color: red; font-weight: bold;
}
// 权重值为 0, 1, 1, 3

li:hover {
	color: blue !important;
    font-weight: normal;
}

// 权重值仅为0, 0, 0, 2&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;所以应用于相同元素时，前者生效。但是对于color这个属性，由于在后者中用 !important 做了指定，因此color将应用后者的规则。而font-weight则按照规定用前者的规则。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果多条规则中都对同一个属性指定了 !important ，这时 !important 的作用相互抵销，依然按abcd四组计算比较。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;参考自：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;http://www.w3.org/TR/CSS2/cascade.html#specified-value&quot; class=&quot;link-underline&quot;&gt;WCR specified-value&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://css-tricks.com/specifics-on-css-specificity/&quot; class=&quot;link-underline&quot;&gt;specifics on css specificity&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.w3.org/TR/CSS2/cascade.html#specificity&quot; class=&quot;link-underline&quot;&gt;WCR specificity&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Git 使用笔记(三)-分支的使用]]></title><description><![CDATA[简单介绍 之前说过，每次修改之后，Git 并不是保存这些修改之后的差异变化，实际上就像一个照相机一样，将修改后的文件拍下作为文件快照，记录在一个微型的文件系统中。在 Git 中提交时，会保存一个提交对象，这个对象包含一个暂存内容快照的指针。而 Git 中的分支其本质上是一个指向…]]></description><link>https://zhanglun.github.io/blogs/git使用笔记(三)-分支的使用/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/git使用笔记(三)-分支的使用/</guid><pubDate>Sun, 14 Sep 2014 16:06:00 GMT</pubDate><content:encoded>&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;简单介绍&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D&quot; aria-label=&quot;简单介绍 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;简单介绍&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;之前说过，每次修改之后，Git 并不是保存这些修改之后的差异变化，实际上就像一个照相机一样，将修改后的文件拍下作为文件快照，记录在一个微型的文件系统中。在 Git 中提交时，会保存一个提交对象，这个对象包含一个暂存内容快照的指针。而 Git 中的分支其本质上是一个指向 commit 对象的可变的指针，使用 master 作为分支的默认名字，通常指向的是最新的一次提交。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;每次的提交，Git 把他们穿起来连成一条线，而主分支master就在这条线上随着提交测更新移动，而 HEAD 指向master，表示我们当前处在 master 分支上（不好意思，直接就用廖雪峰老师的图了，他的教程请戳&lt;a href=&quot;http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;）&lt;/p&gt;
&lt;!--![images](http://ncuey-crispelite.stor.sinaapp.com/18333fig0304-tn.png) --&gt;
&lt;p class=&quot;para&quot;&gt;创建一个叫做 dev 分支，这个分支默认会只想当前你所处在的提交对象上，切换到这个分支上后，HEAD 便指向了 dev。&lt;/p&gt;
&lt;!--![images](http://ncuey-crispelite.stor.sinaapp.com/new-branch-dev.png) --&gt;
&lt;p class=&quot;para&quot;&gt;从这个时候开始，对工作区的操作都只是在 dev 分支上发生了，在 dev 的上提交一次之后，master 指向原来的那个提交对象，而 dev 会指向最新的提交对象。我们称：master 落后了 dev 一个 commit。当我们试图将 master 指向 dev 当前的提交时，这个操作就是合并分支。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在上述的这几个过程中，工作区的内容没有变化，整个过程就是修改几个指针而已，几乎就是瞬间完成。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;创建与合并&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%90%88%E5%B9%B6&quot; aria-label=&quot;创建与合并 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建与合并&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;创建一个 crisp 分支，然后切换到这个分支：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;git checkout -b crisp
Switched to a new branch &amp;#39;crisp&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;git checkout -b&lt;/code&gt; 表示创建并切换分支，相当于将下面两步操作合并成一步来做&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;git branch crisp 		// 创建分支
git checkout crisp		// 切换到指定的分支&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;同时，可以用 &lt;code&gt;git branch&lt;/code&gt; 查看分支，这个命令会列出所有的分支，在当前的分支前面会表上一个 * 号。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;分支与分支之间相互独立，彼此绝缘，所以可以在 主分支master的基础上分出若干个分支，进行不同的操作，比如不同模块的开发，bug的修复等，工作完成之后合并到主分支就行了。怎么合并分支呢？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;假设我们正在 dev 分之上开发，当开发完成后，在这个分之上提交代码&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;git add .
git commit -m &amp;quot;dev 开发完成！&amp;quot;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;此时的提交是在 dev 分支上的提交，当你切回 master 上是，dev 上的修改你都看不到。此时的 master 如果没有人提交过的话，则停留在切换分支之前的那个提交点上，也就是落后与 dev 分支。这个时候我们就需要将分支合并了。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;git checkout master		// 先切回 master 分支 
git merge dev 			// 手动将dev 分支上的提交合并到 master 上&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当某一个分支不在需要的时候，可以将它删除&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;git branch -d branchname&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;小小的总结一下：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;查看分支：git branch

创建分支：git branch name

切换分支：git checkout name

创建+切换分支：git checkout -b name

合并某分支到当前分支：git merge name

删除分支：git branch -d name&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[规范之路-CSS中的定位简介]]></title><description><![CDATA[在 CSS2.1 中，一个盒子会根据下面三种定位方案进行排列： 标准流（Normal flow）：在 CSS2.1 中包括 块级盒子形成的块级格式化上下文（block formatting context），行级格式化上下文（inline formatting context）…]]></description><link>https://zhanglun.github.io/blogs/规范之路-css中的定位简介/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/规范之路-css中的定位简介/</guid><pubDate>Fri, 12 Sep 2014 20:30:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;在 CSS2.1 中，一个盒子会根据下面三种定位方案进行排列：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;标准流（Normal flow）：在 CSS2.1 中包括 块级盒子形成的块级格式化上下文（block formatting context），行级格式化上下文（inline formatting context）和采用了绝对定位（relative positioning）的盒子。&lt;/li&gt;
&lt;li&gt;浮动（Floats）：在浮动模型中，盒子先按照正常标准流（normal flow）排列，然后从 normal flow 中取出，将它尽可能的移动到左边或者右边&lt;/li&gt;
&lt;li&gt;绝对定位（Absoulte positioning）：整个盒子都将被从标准流中移出，相对于一个包含块（containing block）指定它自己的位置。将不会对它的兄弟元素有任何的影响。&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;如果一个元素被浮动或者进行了绝对定位，或者元素本身是文档的根元素（root element）我们就可以说这个元素脱离了文档流（out of flow）。与 &lt;code&gt;out-of-flow&lt;/code&gt; 相对的是 &lt;code&gt;in-flow&lt;/code&gt;。元素A的流（the flow of an element A）是一个集合，这个集合包含了A本身和那些以A作为最近的脱离文档流的祖先元素的所有 in-flow 元素。&lt;/p&gt;
&lt;!--![look at this](http://ncuey-crispelite.stor.sinaapp.com/QQ20140912-1.png) --&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;position&lt;/code&gt; 和 &lt;code&gt;float&lt;/code&gt; 采用不同的方式来计算盒子的位置，这篇先简单的讲一下 &lt;code&gt;position&lt;/code&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###position的值&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;position可以应用在任何元素上，它 的值有：static | relative | absolute | fixed | inherit|，默认值是 static。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;static&lt;/strong&gt;&lt;br&gt;
元素按标准流排列，‘top’, ‘right’, ‘bottom’, 和 ‘left’ 对元素没有影响。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;relative&lt;/strong&gt;&lt;br&gt;
元素的位置按照标准流（中的位置）计算（the position in normal flow），然后盒子相对它标准流中的位置偏移。比如B元素相对原来的位置发生偏移之后，它后面的元素的位置计算不会受到影响，就像B元素一直在原来的位置上呆着一样。对于 table-row-group, table-header-group, table-footer-group, table-row, table-column-group, table-column, table-cell, and table-caption 这些元素，没有定义 &lt;code&gt;position:relative&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;absolute&lt;/strong&gt;&lt;br&gt;
盒子的位置由’top’, ‘right’, ‘bottom’, 和 ‘left’ 指定。这四个值指定的偏移都是相对于盒子的包含块（containing block）。绝对定位的盒子从标准流中被移除，这一位置它们不会对接下来的相邻元素的布局产生影响。同时绝对定位的元素也有 magin ，不会与任何的 元素发生 margin坍塌现象。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;fixed&lt;/strong&gt;&lt;br&gt;
盒子的位置根据 ‘absolute’ model 来计算，除此之外，在不同的设备中，盒子固定的位置不太一样。在手持设备，投影设备，屏幕，电子打字机和电视上（handheld, projection, screen, tty, and tv media types），盒子的位置相对于视口（viewport）固定，当视口滚动的时候，盒子也不会移动；在打印机
上时，盒子在每个page（就是每张纸）上都会被渲染，位置相对page形成的盒子固定，即使页面是通过一个视口看到的（比如 打印预览）。对于其他的媒体类型来说，这种固定的盒子是未定义的。有时候可能想让一个盒子一直保持在屏幕的顶部，但是不想在打印的时候出现在每个页面上。使用媒体查询（@media rule）可以很轻松的做到这一定。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;@media screen { 
	h1#first { position: fixed } 
}
@media print { 
	h1#first { position: static }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;用户代理不能对固定的盒子中的内容做翻页处理，因为用户代理有可能以某种方式将不可见的内容输出（我没有实践过，see &lt;a href=&quot;http://www.w3.org/TR/CSS21/page.html#outside-page-box&quot; class=&quot;link-underline&quot;&gt;“Content outside the page box”&lt;/a&gt;）。暂时先搁着，先看完 chapter 9 (￣◇￣;)&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###盒子的偏移量（Box offsets）
一个元素的 position 属性的值不是 “static“ 的时候，我们可以说这个元素使用了定位（is positioned）。使用了定位后的元素形成一个 “定位盒子“（positioned boxes），这个定位盒子的位置根据’top’, ‘right’, ‘bottom’, 和 ‘left’四个属性来计算，这四个属性决定了盒子的offset。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Value&lt;/td&gt;
&lt;td&gt;&amp;#x3C;length&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Initial&lt;/td&gt;
&lt;td&gt;auto&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Applies to&lt;/td&gt;
&lt;td&gt;positioned elements&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Inherited&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Percentages&lt;/td&gt;
&lt;td&gt;refer to height of containing block&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Media&lt;/td&gt;
&lt;td&gt;visual&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Computed value&lt;/td&gt;
&lt;td&gt;if specified as a length, the corresponding absolute length; if specified as a percentage, the specified value; otherwise, ‘auto’.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p class=&quot;para&quot;&gt;‘top’/‘right’/‘bottom’/‘left’四个属性的作用也很好理解，分别定义绝对定位的盒子的上/右/下/左部的margin边缘到这个盒子的包含块的上/右/下/左部边缘的距离。对于相对定位的盒子，偏移量参照的是盒子自身的上/右/下/左部边缘（包含marign），即相对于盒子处于标准流中的位置。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当它们的值定义为百分比时，偏离量的计算方法是：包含块的宽度的百分比（定义 left 或者 right）或者高度的百分比（定义 top 或者 bottom）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;先记录到这里，回头在看一下 标准中的 &lt;a href=&quot;http://www.w3.org/TR/CSS21/visuren.html#normal-flow&quot; class=&quot;link-underline&quot;&gt;Normal flow&lt;/a&gt; 和 &lt;a href=&quot;http://www.w3.org/TR/CSS21/visuren.html#floats&quot; class=&quot;link-underline&quot;&gt;Floats&lt;/a&gt; 以及 &lt;a href=&quot;http://www.w3.org/TR/CSS21/visuren.html#absolute-positioning&quot; class=&quot;link-underline&quot;&gt;absolute-positioning&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;(￣◇￣;)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[如何将页面的footer保持在页面的底部一]]></title><description><![CDATA[我敢说这一定是很常见的问题，因为到处都是页面不够长而上吊的footer，而。比如这里： 或者这里(￣◇￣;)： 这是随手找到，没别的意思。只是想说明一下这个问题的普遍程度。以前自己也曾遇到过，查阅一番之后解决了，但是日子长了记忆早已模糊。最近在重构项目页面时，重新遇到了这个问题…]]></description><link>https://zhanglun.github.io/blogs/将footer始终保持在页面底部的方法一/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/将footer始终保持在页面底部的方法一/</guid><pubDate>Mon, 25 Aug 2014 22:25:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;我敢说这一定是很常见的问题，因为到处都是页面不够长而上吊的footer，而。比如这里：&lt;/p&gt;
&lt;!--![image](http://ncuey-crispelite.stor.sinaapp.com/QQ20140825-1.png) --&gt;
&lt;p class=&quot;para&quot;&gt;或者这里(￣◇￣;)：&lt;/p&gt;
&lt;!--![image](http://ncuey-crispelite.stor.sinaapp.com/QQ20140826-1.png) --&gt;
&lt;p class=&quot;para&quot;&gt;这是随手找到，没别的意思。只是想说明一下这个问题的普遍程度。以前自己也曾遇到过，查阅一番之后解决了，但是日子长了记忆早已模糊。最近在重构项目页面时，重新遇到了这个问题，遂决定好好理一理。在网上查阅一番之后发现，解决方案还是挺多的。一个个慢慢来。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;第一次方法来自[《How to keep footers at the bottom of the page》]&lt;a href=&quot;http://matthewjamestaylor.com/blog/keeping-footers-at-the-bottom-of-the-page)%EF%BC%8C%E4%BD%9C%E8%80%85%E6%98%AF&quot; class=&quot;link-underline&quot;&gt;http://matthewjamestaylor.com/blog/keeping-footers-at-the-bottom-of-the-page)，作者是&lt;/a&gt; &lt;a href=&quot;http://matthewjamestaylor.com/about&quot; class=&quot;link-underline&quot;&gt;Matthew James Taylor的&lt;/a&gt;。他的博客很有意思，几乎每一篇文章都有一个很有趣的banner，文章中还加着丰富的插图用以解释。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这个方法不算复杂，只需要 HTML 和 CSS 就能实现。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;HTML：

&amp;lt;div id=&amp;quot;wrapper&amp;quot;&amp;gt;
   &amp;lt;div id=&amp;quot;header&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;
   &amp;lt;div id=&amp;quot;container&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;
   &amp;lt;div id=&amp;quot;footer&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;

CSS:

html,body {
	margin:0;
	padding:0;
	height:100%;
}
#wrapper {
 	min-height:100%;
 	position:relative;
}
#header {
 	background:#ff0;
 	padding:10px;
}
#container {
 	padding:10px;
 	padding-bottom:60px;   /* Height of the footer */
}
#footer {
 	position:absolute;
 	bottom:0;
 	width:100%;
 	height:60px;   /* Height of the footer */
 	background:#6cf;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a class=&quot;jsbin-embed&quot; href=&quot;http://jsbin.com/ziqim/15/embed?html,css,output&quot;&gt;JS Bin&lt;/a&gt;&lt;script src=&quot;http://static.jsbin.com/js/embed.js&quot;&gt;&lt;/script&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在原文中，作者为了兼容 IE6 和 IE5.5（原文发布的时间是2007年），为 #wrapper 添加了 &lt;code&gt;height:100%&lt;/code&gt; ，在这里我就不加上去了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;上面的两串代码就能很好的将footer保持在页面的底部，页面的高度小于屏幕高度时，footer 会保持在屏幕的底部。原文demo请戳&lt;a href=&quot;http://matthewjamestaylor.com/blog/bottom-footer-demo.htm&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;
稍微分析一下：为 html 和 body 定义 height 为1 00%，目的是为了在页面内容高度不够的时候，将页面撑开。CSS中 height 使用百分比定义时，参考的是父元素的高度，如果父元素没有定义高度，哪怕你设置个1 000%，高度也依旧是由内容决定。为 html 标签定义百分比高度时，它的参考值是浏览器窗口的高度，所以设置成100%时，html元素会铺满整个屏幕，不过没关系。只有在为 body 的父元素设置了高度之后，才能够为 body 设置百分比的高度。好的，这一步结束之后，设置wrapper的min-height为100%，这样即使wrapper中的内容高度不及浏览器的窗口高度或者说body的高度，wrapper的高度也会是100%，同时wrapper的高度也能随着内容的高度而变化，从body中溢出。因此，才能够做footer始终居于底部。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这种方法简单明了，今天就先说这一种方法吧，好晚了该睡觉了⊙﹏⊙b汗。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[规范之路-visual formatting model 概述]]></title><description><![CDATA[视觉格式化模型 CSS 视觉格式化模型（visual formatting model）是一种用来处理文档，将其呈现在可视化媒体中的算法。这是 CSS 中的一个最基本的概念。可视化格式模型会转化文档中的每一个元素，并且形成零个，一个或者多个符合CSS盒模型规范的盒子（boxes…]]></description><link>https://zhanglun.github.io/blogs/规范之路-visual formatting model概述 /</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/规范之路-visual formatting model概述 /</guid><pubDate>Thu, 21 Aug 2014 20:39:00 GMT</pubDate><content:encoded>&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;视觉格式化模型&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%A7%86%E8%A7%89%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%A8%A1%E5%9E%8B&quot; aria-label=&quot;视觉格式化模型 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;http://www.w3.org/TR/CSS21/visuren.html&quot; class=&quot;link-underline&quot;&gt;视觉格式化模型&lt;/a&gt;&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;CSS 视觉格式化模型（visual formatting model）是一种用来处理文档，将其呈现在可视化媒体中的算法。这是 CSS 中的一个最基本的概念。可视化格式模型会转化文档中的每一个元素，并且形成零个，一个或者多个符合CSS盒模型规范的盒子（boxes）。每个盒子的布局由下面的内容来控制：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;盒子的尺寸：精确定义，或者被限制，或者都没有；&lt;/li&gt;
&lt;li&gt;盒子的类型：inline，inline-level，atomic inline-level，block box；&lt;/li&gt;
&lt;li&gt;定位方式：普通文档流，浮动或者绝对定位；&lt;/li&gt;
&lt;li&gt;DOM树中的其他元素：它的子元素和相邻元素；&lt;/li&gt;
&lt;li&gt;视口的大小和位置；&lt;/li&gt;
&lt;li&gt;包含的图像的固定尺寸（因为盒子包裹着图片，图片有大小，从而影响了盒子的大小）；&lt;/li&gt;
&lt;li&gt;其他的外部信息（？？？）&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;总的来说，VFM 决定了用户代理（浏览器）在视觉媒体（visual media）如何处理 DOM 树。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;containing-block&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#containing-block&quot; aria-label=&quot;containing block permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;containing block&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在 CSS2.1 中定义了 “containing block”。一些盒子的大小和位置是相对于一个矩形盒子计算的，这个矩形的盒子，就是 &lt;code&gt;containing block&lt;/code&gt; 。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;一个盒子相对于它的包含块(containing block) 的边界来渲染。一般来说，生成的盒子会表现得像一个 &lt;code&gt;containing block&lt;/code&gt; （就像它爹一样），它内部的盒子相对于它的边界来渲染。这就是所谓的：盒子为它的后代元素建立包含块。而我们说的”一个盒子的包含块“指的是这个盒子赖以生存的包含块，而不是盒子生成的包含块。注意盒子并不受它的包含块的限制，当它的布局跑到包含块的外面时称为溢出(overflow)。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;关于 containing block 具体的细节 &lt;a href=&quot;http://www.w3.org/TR/CSS21/visudet.html#containing-block-details&quot; class=&quot;link-underline&quot;&gt;link&lt;/a&gt;，暂时先放一边，稍后在整理。现在只是按照 W3C 的文档顺序集合其他资料做一个整理。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;盒子的生成Box-generation&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%9B%92%E5%AD%90%E7%9A%84%E7%94%9F%E6%88%90Box-generation&quot; aria-label=&quot;盒子的生成Box generation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;盒子的生成（Box generation）&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;CSS 视觉格式化模型的一部分工作就是从文档（document）生成盒子。一个盒子的类型在一定程度上会影响它在 VFM 中的表现。一般元素都有一个默认的盒子类型，可以通过 CSS 的 display 属性修改。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;块级元素和块级盒子block-level-element-and-block-boxes&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9D%97%E7%BA%A7%E5%85%83%E7%B4%A0%E5%92%8C%E5%9D%97%E7%BA%A7%E7%9B%92%E5%AD%90block-level-element-and-block-boxes&quot; aria-label=&quot;块级元素和块级盒子block level element and block boxes permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;块级元素和块级盒子（block-level element and block boxes）&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;块级元素（block-level element）就是那些在 document 中在视觉上被渲染成块的元素，比如&amp;#x3C;\p&gt;。当元素的 CSS 属性  display 为 block, list-item 或 table 时，它是块级元素(block-level)，被块级化。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;每一个块级元素（block-level element）生成一个主块级盒子（principal block-level box）。主块级盒子包含后代元素生成的盒子以及生成的内容，它可以采用任意一种&lt;a href=&quot;#positioning-schemes&quot; class=&quot;link-underline&quot;&gt;定位方案（positioning schemes）&lt;/a&gt;。有的块级元素会生成除了主块级盒子之外额外的盒子：比如 “list-item” 元素，会生成额外的盒子来放置项目符号&lt;/p&gt;
&lt;!-- ![li](http://ncuey-crispelite.stor.sinaapp.com/QQ20140816.png) --&gt;
&lt;p class=&quot;para&quot;&gt;不过多数元素只生成一个主要块级盒。 每个块级盒子都会涉及到一个 &lt;a href=&quot;#block-formatting-context&quot; class=&quot;link-underline&quot;&gt;块级格式化上下文（block formatting context）&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;除了表格盒子（table box，表格元素形成的盒子）和被替换的元素，一个块级盒子同时也是一个块容器盒子（block container box），一个块容器盒子只能包含块级盒子或者生成一个行内格式化上下文（inline formatting context），这个时候块容器盒子只能包含行级盒子（inline-level block）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;总是感觉上面的话很绕，说直白一点其实就是这么回事：&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;一个用来装酒的瓶子，我们自然只会用它来装酒，但是如果在这个瓶子里面装了水，你还会把酒装进去嘛？&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;并不是所有的块容器盒子都是块级盒子：非替换的行内块和非替换的表格单元是块容器（可以理解成它们可以作为一个容纳新的块级盒子的容器），但是它们本身不是块级盒子。而块盒子（block boxes ）则是是块级盒子（block-level boxes）和块容器(block container)的交集。&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;还有一个叫匿名块盒Anonymous-block-boxes的东西&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%BF%98%E6%9C%89%E4%B8%80%E4%B8%AA%E5%8F%AB%E5%8C%BF%E5%90%8D%E5%9D%97%E7%9B%92Anonymous-block-boxes%E7%9A%84%E4%B8%9C%E8%A5%BF&quot; aria-label=&quot;还有一个叫匿名块盒Anonymous block boxes的东西 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;还有一个叫”匿名块盒“(Anonymous block boxes)的东西&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;有一种盒子叫”匿名块盒子“，比如说下面的代码中：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;div&amp;gt;
    hello,
    &amp;lt;p&amp;gt;world!&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;div 中同时出现了行内内容和块级内容，为了更加方便的定义格式，我们假定在文本 “hello,”外部包裹着一个匿名的块级盒子（anonymous block）。 换句话说，如果一个块级容器盒子（就是一个用来容纳块级盒子的大盒子）中只要包含任何一个块级盒子，我们就认为它只包含块级盒子。
对于匿名盒子还要注意的是，和 &amp;#x3C;\p&gt; 元素不同, 开发者不能控制这个匿名盒子。对于可继承属性， 它们将取 &amp;#x3C;\div&gt; 的属性值, 比如 color。对于非继承属性，值为初始值 ，比如没有指定 background-color, 值为初始值即 transparent，于是 &amp;#x3C;\div&gt; 背景可见。而 &amp;#x3C;\p&gt; 可以指定 background-color 。类似的，这个匿名盒文本是一样的颜色。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;另外一种创建匿名块盒子的情况是：当一个行内盒包含了一个或几个块盒时，包含块盒的盒将拆分为两个行内盒放置于块盒前后，然后分别由两个匿名块盒包含。这样块盒就与两个包含行内元素的匿名块盒形成了兄弟关系。如果行内盒包含多个块盒，并且这些块盒之间没有夹杂内容，将在这些块盒前后创建匿名块盒。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.two p {
  display: inline；
}
.two span {
  display: block；
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;html&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;h2&amp;gt;块盒包含行内盒子&amp;lt;/h2&amp;gt;
&amp;lt;div class=&amp;quot;one&amp;quot;&amp;gt;
    &amp;lt;P&amp;gt;This is anonymous text before the SPAN.
        &amp;lt;span&amp;gt;This is the content of SPAN.&amp;lt;/span&amp;gt;This is anonymous text after the SPAN.
    &amp;lt;/P&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;h2&amp;gt;一个行内盒包含了一个或几个块盒&amp;lt;/h2&amp;gt;
&amp;lt;div class=&amp;quot;two&amp;quot;&amp;gt;
    &amp;lt;P&amp;gt;This is anonymous text before the SPAN.
    &amp;lt;span&amp;gt;This is the content of SPAN.&amp;lt;/span&amp;gt;This is anonymous text after the SPAN.
    &amp;lt;/P&amp;gt;
&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;!-- ![image](http://ncuey.sinaapp.com/blog_files/images/2014-08-21_230945.png) --&gt;
&lt;p class=&quot;para&quot;&gt;前面说到的，匿名盒子无法被选中，但是会继承离他最近的非匿名盒子的样式。在触发匿名盒子形成的元素上添加的属性也会应用在元素的盒子和内容中，比如上面的例子，p元素师导致匿名盒子形成的元素，如果给它加上border，border也会应用的它形成的匿名盒子上&lt;/p&gt;
&lt;!-- ![image](http://ncuey.sinaapp.com/blog_files/images/2014-08-21_232806.png) --&gt;
&lt;p class=&quot;para&quot;&gt;撸的好累，这一篇小小文章都搞了几天，现在已经快十二点了，要睡觉了。之后还需要把定位和浮动好好复习一下。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[踩坑日记-IE中的 hasLayout 属性]]></title><description><![CDATA[原文链接：http://www.sitepoint.com/web-foundations/internet-explorer-haslayout-property/ 在理想的世界中中，我们真的不需要了解任何关于 hasLayout 的事情，就像在理想社会中不用担心自己没钱一样…]]></description><link>https://zhanglun.github.io/blogs/踩坑日记-ie中的haslayout属性/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/踩坑日记-ie中的haslayout属性/</guid><pubDate>Tue, 12 Aug 2014 13:26:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;原文链接：&lt;a href=&quot;http://www.sitepoint.com/web-foundations/internet-explorer-haslayout-property/&quot; class=&quot;link-underline&quot;&gt;http://www.sitepoint.com/web-foundations/internet-explorer-haslayout-property/&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在理想的世界中中，我们真的不需要了解任何关于 &lt;code&gt;hasLayout&lt;/code&gt; 的事情，就像在理想社会中不用担心自己没钱一样。因为 &lt;code&gt;hasLayout&lt;/code&gt; 是IE 渲染引擎的提供的内部组建或者说是 IE 的一个私有的属性，看不见也摸不着。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##hasLayout 是何方神圣&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###为什么会出现一个叫 &lt;code&gt;hasLayout&lt;/code&gt; 的家伙？&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;来源：&lt;a href=&quot;http://haslayout.net/haslayout&quot; class=&quot;link-underline&quot;&gt;http://haslayout.net/haslayout&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;MSIE has quite dated rendering engine (not surprising, as IE is based on Mosaic). In old tabular times, almost any element (except inline content) was a box. There was no way for content to leak from containing table cell, or for table cell to leak out of table..&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;微软的老旧IE（应该指的是IE8以下的版本，在IE8的标准模式中已经将 hasLayout 移除了）使用的是过时的渲染引擎。在使用表格进行布局的旧社会，除了inline元素，几乎所有的元素都是像一个个盒子一样呈现。内容无法从表格的单元格中泄漏出去，单元格也不会溢出到表格外面。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;Many years have passed, and Microsoft began adapting archaic Trident engine to make use of CSS. However, CSS changes the fundamental assumption that old engine was based on - the one that “anything significant” is a rectangle that contains all its content. CSS allows content to overflow out of container. This may happen when content is floated, or if content is too tall/wide to fit inside constrained box.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;时光飞逝啊，很多年过去了。微软开始改造古老的 Trident 引擎让浏览器能够使用 CSS。但是，出大事了！CSS 修改了老旧引擎作为基础的基本假设-“一个矩形包含了它的所有内容”。而新的 CSS 允许内容溢出容器。当内容浮动之后，或者内容太高/宽以至于不能适应被约束（定高/宽）的盒子中时，内容边会从容器中溢出。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;所以啊，为了”追上潮流“，IE开发人员用了一种相当诡异的方式来修补他们古老的引擎，这就是 &lt;code&gt;hasLayout&lt;/code&gt; 诞生的原因！但是，&lt;code&gt;hasLayout&lt;/code&gt; 的作用远超过预期，对元素的呈现和其行为有重要的影响，它会影响到一个元素如何限定它的内容和于邻近的元素之间的相互作用。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在IE中，一个元素要么自己有能力计算调整和排列自身的内容，要么依赖父元素。为了兼顾这两种不同的概念，渲染引擎便使用这个叫做 &lt;code&gt;hasLayout&lt;/code&gt; 的属性，属性值可以为 true 或 false 。当一个元素的 hasLayout 属性值为 true 时，我们就说这个元素拥有了一个布局（having a Layout）。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;having-a-Layout-意味着什么&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#having-a-Layout-%E6%84%8F%E5%91%B3%E7%9D%80%E4%BB%80%E4%B9%88&quot; aria-label=&quot;having a Layout 意味着什么 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;“having a Layout” 意味着什么？&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;http://msdn.microsoft.com/en-us/library/bb250481%28VS.85%29.aspx&quot; class=&quot;link-underline&quot;&gt;微软MSDN 上的相关文档&lt;/a&gt;上说了：&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;In short, having a layout means that an element is responsible for sizing and positioning itself and possibly any child elements. (If a child element has its own layout, it sizes itself and its descendents, but the original layout positions the child.)&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;简而言之，元素拥有布局意味着它自己计算调整和组织自身的内容包括没有出发 Layout 的子元素，&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;Some elements have a “fixed” size or otherwise have special sizing constraints. They always have layout—for example, buttons, images, inputs, selects, and marquee elements have always a native size even if width and height are not specified.&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;有些元素有固定的大小或者有特殊的大小限制，它们总是默认 ”having a Layout“，比如：button，images，inputs等总是有一个与生俱来的大小，即使没有设置高和宽。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;Sometimes elements that do not normally require layout information, like a div or a span, may have properties specified that force a layout to be applied in order to support the property—for example, the element must have a layout in order to get scrollbars.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;有时候，元素无法正常的获得Layout，就像 div，span，它们应用一些特殊的属性可以触发元素的 hasLayout 借此来支持一些其他的属性。比如，元素必须触发 hasLayout 才能获得滚动条（scrollBars ）。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;Once a layout is applied the “hasLayout” flag is set. This property returns true if queried.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;hasLayout 一旦触发，它的值就是 ”true“。（而且是不可逆转的）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;当一个元素拥有布局（having a Layout）之后，它就可以自己计算调整和组织自身的内容，同时元素的内容也能够溢出到容器之外，比如浮动的元素或者一个“很长很长的单词”（注意是英文单词）。相反地，如果没有布局，那只能依靠父元素来调整内容（只要是祖先元素就行，不一定非得是直接父元素）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###为什么要关心这个东东&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;A: 有个 Layout 很叼吗？
B: 不，一点都不叼，而且土的掉渣。
A: 那为什么我还要了解？
B: 因为很多 IE 的 bug 都是因为它。你搞定了它，解决 bug 就更 easy！&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;大部分的 IE 显示错误，都可以通过出发元素的 haslayout 属性来修正。可以通过设置 css 尺寸属性(width/height)等来激发元素的 haslayout，使其“拥有布局”。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;display: inline-block&lt;/li&gt;
&lt;li&gt;height: (任何值除了auto)&lt;/li&gt;
&lt;li&gt;float: (left 或 right)&lt;/li&gt;
&lt;li&gt;position: absolute&lt;/li&gt;
&lt;li&gt;width: (任何值除了auto)&lt;/li&gt;
&lt;li&gt;writing-mode: tb-rl&lt;/li&gt;
&lt;li&gt;zoom: (除 normal 外任意值)&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;Internet Explorer 7 还有一些额外的属性(不完全列表):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;min-height: (任意值)&lt;/li&gt;
&lt;li&gt;max-height: (除 none 外任意值)&lt;/li&gt;
&lt;li&gt;min-width: (任意值)&lt;/li&gt;
&lt;li&gt;max-width: (除 none 外任意值)&lt;/li&gt;
&lt;li&gt;overflow: (除 visible 外任意值)&lt;/li&gt;
&lt;li&gt;overflow-x: (除 visible 外任意值)&lt;/li&gt;
&lt;li&gt;overflow-y: (除 visible 外任意值)&lt;/li&gt;
&lt;li&gt;position: fixed&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;声明上述任何CSS属性都会导致元素触发Layout，有些值对于一些元素来说是除了出发Layout不会有其他的作用，比如即使对一个inline元素设置了 &lt;code&gt;height:100px;&lt;/code&gt; ，它的高度不会因此变成100px，它原本有多高它就是多高，但是在IE下却让它拥有了布局（having a Layout）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;触发所有元素的 Layout，是一个不好的主意，因为有些时候，意外的拥有布局会导致意外的bug。比如正常情况下，绝对定位和浮动的元素，他的大小会根据自身的内容大小收缩，like this：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;但是如果在IE中，绝对定位和浮动的子元素触发了 Layout，将导致父元素大小不会收缩，就像这样：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;更多例子可以看&lt;a href=&quot;http://msdn.microsoft.com/en-us/library/bb250481.aspx&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;遇到-Layout-不用怕&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%81%87%E5%88%B0-Layout-%E4%B8%8D%E7%94%A8%E6%80%95&quot; aria-label=&quot;遇到 Layout 不用怕 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;遇到 Layout 不用怕！&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;当网页在 IE 中有异常表现时，可以尝试触发相应元素的 Layout 来看看是不是问题所在。常用的方法是给该元素的 CSS 设定 zoom:1 。使用 zoom:1 是因为大多数情况下，它能在不影响现有环境的条件下激发元素的 Layout。而如果 bug 消失，那基本上就可以判断是 hasLayout 的原因。然后就可以通过设定相应的 css 属性来对这个问题进行修正了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;一般来说，首先要考虑的是设定元素的 width/height 属性，其次再考虑其他属性。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;对 IE6 及更早版本来说，常用的方法被称为霍莉破解(Holly hack)，即设定这个元素的高度为 1% (height:1%;)。需要注意的是，当这个元素的 overflow 属性被设置为 visible 时，这个方法就失效了。或者使用 IE 的条件注释。一个元素拥有 Layout 之后，会确定一个新的 BFC（block formatting context），而 BFC 的形成条件是：&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;http://www.w3.org/TR/CSS2/visuren.html#block-formatting&quot; class=&quot;link-underline&quot;&gt;W3C:block-formatting&lt;/a&gt;
Floats, absolutely positioned elements, block containers (such as inline-blocks, table-cells, and table-captions) that are not block boxes, and block boxes with ‘overflow’ other than ‘visible’ (except when that value has been propagated to the viewport) establish new block formatting contexts for their contents.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;浮动元素和绝对定位元素，非块级盒子的块级容器（例如 inline-blocks, table-cells, 和 table-captions），以及overflow值不为“visiable”的块级盒子，都会为他们的内容创建新的BFC（块级格式上下文）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;所以当设定了 &lt;code&gt;overflow:visible;&lt;/code&gt; 时，将导致元素无法创建一个 BFC，个人认为这里此处可能有所联系。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;再来说一下IE7，对 IE7 来说，最好的方法时设置元素的最小高度为 0 (min-height:0;)。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;关于 BFC，我觉得有必要好好看看，踩踩坑。日后在做一个笔记&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;参考资料：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.sitepoint.com/web-foundations/internet-explorer-haslayout-property/&quot; class=&quot;link-underline&quot;&gt;The Internet Explorer hasLayout Property&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://msdn.microsoft.com/en-us/library/bb250481.aspx&quot; class=&quot;link-underline&quot;&gt;“HasLayout” Overview&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.qianduan.net/comprehensive-haslayout.html&quot; class=&quot;link-underline&quot;&gt;haslayout综合&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Grunt的简单配置和使用]]></title><description><![CDATA[Grunt 和 Grunt 的插件都是通过 Node.js 的包管理器 npm 来安装和管理的。为了方便使用 Grunt ，你应该在全局范围内安装 Grunt 的命令行接口(CLI)。要做到这一点，你可能需要使用 sudo (OS X，*nix，BSD 等平台中)权限或者作为超…]]></description><link>https://zhanglun.github.io/blogs/grunt的简单配置和使用/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/grunt的简单配置和使用/</guid><pubDate>Fri, 08 Aug 2014 21:09:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;Grunt 和 Grunt 的插件都是通过 Node.js 的包管理器 npm 来安装和管理的。为了方便使用 Grunt ，你应该在全局范围内安装 Grunt 的命令行接口(CLI)。要做到这一点，你可能需要使用 sudo (OS X，*nix，BSD 等平台中)权限或者作为超级管理员( Windows 平台)来运行 shell 命令。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;npm install -g grunt-cli&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;使用全局安装之后，可以在任何一个目录中运行 grunt 命令。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###如何工作&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;每次运行 grunt 时，它都会使用 node 的 require() 系统查找本地已安装好的 grunt。在本地装好 Grunt 之后，运行 gurnt 命令时，CLI 就会加载这个本地安装好的 Grunt 库，然后应用你项目中的 Gruntfile 中的配置(这个文件用于配置项目中使用的任务)，并执行你所指定的所有任务。而 Grunt 库的安装则依赖 package.json 文件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;假设已经安装好 Grunt CLI 并且项目也已经使用一个 package.json 和一个 Gruntfile 文件配置好了，那么接下来用 Grunt 进行工作就非常容易了：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;进入到项目的根目录(在命令行面板定位到项目根目录。在 windows 系统下，也可以进入项目根目录的文件夹后，按Shift+鼠标右键，打开右键菜单，选择“在此处打开命令窗口(W)”)。&lt;/li&gt;
&lt;li&gt;运行 npm install 安装项目相关依赖(插件，Grunt 内置任务等依赖)。&lt;/li&gt;
&lt;li&gt;使用 grunt (命令)运行 Grunt。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;###构建一个新的 Grunt 项目&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;最简单的配置需要两个文件：&lt;code&gt;package.json&lt;/code&gt; 和 &lt;code&gt;Gruntfile&lt;/code&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;package.json&lt;/strong&gt;：这个文件被用来存储已经作为 npm 模块发布的项目元数据(也就是依赖模块)。你将在这个文件中列出你的项目所依赖的Grunt(通常我们在这里配置Grunt版本)和Grunt插件(相应版本的插件)。使用命令 &lt;code&gt;npm install&lt;/code&gt; 安装依赖模块。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;Gruntfile&lt;/strong&gt;：通常这个文件被命名为Gruntfile.js或者Gruntfile.coffee，它用于配置或者定义Grunt任务和加载Grunt插件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;####package.json&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;package.json&lt;/code&gt; 与 &lt;code&gt;Gruntfile&lt;/code&gt; 相邻，都归属在项目的根目录中。在目录中运行 &lt;code&gt;npm install&lt;/code&gt; 安装需要的依赖模块。其创建方式有几种：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;grunt-init&lt;/code&gt; 命令创建 Grunt 模板时，会自动为项目创建一个 &lt;code&gt;package.json&lt;/code&gt; 文件。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;npm init&lt;/code&gt; 会自动创建一个基本的 &lt;code&gt;package.json&lt;/code&gt; 文件。&lt;/li&gt;
&lt;li&gt;新建一个文件，重命名为 &lt;code&gt;package.json&lt;/code&gt;。&lt;/li&gt;
&lt;/ol&gt;
&lt;p class=&quot;para&quot;&gt;一个 &lt;code&gt;package.json&lt;/code&gt; 文件示例：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;{
    &amp;quot;name&amp;quot;: &amp;quot;my-project-name&amp;quot;, // 项目名称
    &amp;quot;version&amp;quot;: &amp;quot;0.1.0&amp;quot;, // 项目版本
    &amp;quot;devDependencies&amp;quot;: { // 项目依赖
        &amp;quot;grunt&amp;quot;: &amp;quot;~0.4.1&amp;quot;, // Grunt库
        &amp;quot;grunt-contrib-jshint&amp;quot;: &amp;quot;~0.6.0&amp;quot;, //grunt中的工具
        &amp;quot;grunt-contrib-nodeunit&amp;quot;: &amp;quot;~0.2.0&amp;quot;, //grunt中的工具
        &amp;quot;grunt-contrib-uglify&amp;quot;: &amp;quot;~0.2.2&amp;quot; //grunt中的工具，可以按照这种方式在 dependencies 中添加自己想要的工具
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;####Gruntfile&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;Gruntfile.js&lt;/code&gt; 和 &lt;code&gt;Gruntfile.coffee&lt;/code&gt; 文件都是归属于项目根目录中的一个有效的 JavaScript 或者 CoffeeScript 文件。
一个 Gruntfile 由下面几部分组成：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;“wrapper” 函数，一个包装函数&lt;/li&gt;
&lt;li&gt;项目和任务配置&lt;/li&gt;
&lt;li&gt;加载的 Grunt 插件和任务&lt;/li&gt;
&lt;li&gt;自定义任务&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 class=&quot;heading&quot; id=&quot;wrapper-函数&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#wrapper-%E5%87%BD%E6%95%B0&quot; aria-label=&quot;wrapper 函数 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;wrapper 函数&lt;/h5&gt;
&lt;p class=&quot;para&quot;&gt;每个 Gruntfile 都使用这个基本格式，同时所有的 Grunt 戴玛都必须指点在这个函数里面：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports=function(){
    //在这里添加 Grunt 相关
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;#####项目和任务配置
通常 Grunt 任务所依赖的配置素据都被定义在一个对象中，而这个对象将会被传递给 &lt;code&gt;grunt.initConfig&lt;/code&gt; 方法。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// 项目配置
grunt.initConfig({
    pkg: grunt.file.readJSON(&amp;#39;package.json&amp;#39;),
    uglify: {
        options: {
            banner: &amp;#39;/*! &amp;lt;%= pkg.name %&amp;gt; &amp;lt;%= grunt.template.today(&amp;quot;yyyy-mm-dd&amp;quot;) %&amp;gt; */\n&amp;#39;
        },
        build: {
            src: &amp;#39;src/&amp;lt;%=pkg.name %&amp;gt;.js&amp;#39;,
            dest: &amp;#39;build/&amp;lt;%= pkg.name %&amp;gt;.min.js&amp;#39;
        }
    }
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在上面的代码中，&lt;code&gt;grunt.file.readJSON(&apos;package.json&apos;)&lt;/code&gt; 会把存储在 &lt;code&gt;package.json&lt;/code&gt; 中的 JSON 元数据导入到 Grunt 配置中。由于 &lt;code&gt;&amp;#x3C;% %&gt;&lt;/code&gt; 模板字符串可以引用任意的配置属性，因此可以通过这种方式来制定诸如&lt;strong&gt;文件路径&lt;/strong&gt;和&lt;strong&gt;文件列表类型的配置数据&lt;/strong&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;与大多数的任务一样， grunt-contrib-uglify 插件的 &lt;code&gt;uglify&lt;/code&gt; 任务要求他的配置被指定在一个同名属性中。在这个例子中，我们指定了一个 &lt;code&gt;banner&lt;/code&gt; 选项，用于在文件顶部生成一个注释。紧接着是一个名为 &lt;code&gt;build&lt;/code&gt; 的 uglify 目标，用于将一个js文件压缩为一个目标文件，比如：将 src 目录中的 &lt;code&gt;jQuery-1.9.0.js&lt;/code&gt; 压缩成 &lt;code&gt;jQuery-1.9.0.min.js&lt;/code&gt;，然后存储到 dest 目录中。
插件一般都托管在 github 上，其使用方法都会有说明。比如 &lt;a href=&quot;https://github.com/gruntjs/grunt-contrib-uglify&quot; class=&quot;link-underline&quot;&gt;grunt-contrib-uglify&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;#####加载 grunt 插件和任务&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;只要一个插件被作为一个依赖指定在项目的 &lt;code&gt;package.json&lt;/code&gt; 文件中，并且通过 &lt;code&gt;npm install&lt;/code&gt; 安装好，都可以在 &lt;code&gt;Gruntfile&lt;/code&gt; 文件中使用下面的简单命令启用.&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//加载提供 &amp;quot;uglify&amp;quot; 任务的插件
grunt.loadNpmTasks(&amp;quot;grunt-contrib-uglify&amp;quot;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;tips:&lt;/strong&gt; 使用 &lt;code&gt;grunt --help&lt;/code&gt; 命令可以列出所有可用的任务&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;同时，你可以通过定义一个 &lt;code&gt;default&lt;/code&gt; 任务来配置 Grunt，让他默认运行一个过着多个任务。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// 默认任务
grunt.registerTask(&amp;#39;default&amp;#39;, [&amp;#39;uglify&amp;#39;]);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;可以将你允许默认运行的任务名称以数组的形式作为参数传递。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果你想要的任务没有对应的 Grunt 插件提供相应的功能，你可以在 Gruntfile 内定义自定义的任务：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports=function(){
    //一个很基础的default任务
    grunt.registerTask(&amp;quot;default&amp;quot;,&amp;quot;load some stuff.&amp;quot;,function(){
        grunt.log.write(&amp;quot;Loggin some stuff……&amp;quot;).ok();
    });
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;自定义的项目特定的任务可以不定义在 Gruntfile 中；它们可以定义在一个外部 .js 文件中，然后通过 grunt.loadTasks 方法来加载。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;参考自：&lt;a href=&quot;http://www.gruntjs.org/docs/getting-started.html&quot; class=&quot;link-underline&quot;&gt;Grunt新手教程&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[git 使用笔记(二)-撤销操作]]></title><description><![CDATA[在最近使用 git 的过程中，有时候遇到这样的一个问题：习惯性的 “add -A”，这会将所有的修改都添加到暂存区，可是有两个文件的修改暂时不想添加的呀，这该怎么办？git 提供了一些撤销操作的方法。比如： 取消已经暂存的修改 就像前面说的，习惯性的 “add -A” 将暂时不…]]></description><link>https://zhanglun.github.io/blogs/git使用笔记(二)-撤销操作/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/git使用笔记(二)-撤销操作/</guid><pubDate>Tue, 22 Jul 2014 21:09:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;在最近使用 git 的过程中，有时候遇到这样的一个问题：习惯性的 “add -A”，这会将所有的修改都添加到暂存区，可是有两个文件的修改暂时不想添加的呀，这该怎么办？git 提供了一些撤销操作的方法。比如：&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;取消已经暂存的修改&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%96%E6%B6%88%E5%B7%B2%E7%BB%8F%E6%9A%82%E5%AD%98%E7%9A%84%E4%BF%AE%E6%94%B9&quot; aria-label=&quot;取消已经暂存的修改 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;取消已经暂存的修改&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;就像前面说的，习惯性的 “add -A” 将暂时不想添加的修改添加到了暂存区。而取消已经暂存的修改的方法，git 已经在你每次使用 &lt;code&gt;git status&lt;/code&gt; 查看文件状态的时候给出了解决方案，&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;➜  hexo-theme git:(master) ✗ git status
On branch master
Your branch is ahead of &amp;#39;origin/master&amp;#39; by 2 commits.
  (use &amp;quot;git push&amp;quot; to publish your local commits)

Changes to be committed:
  (use &amp;quot;git reset HEAD &amp;lt;file&amp;gt;...&amp;quot; to unstage)

    modified:   processing/README.md
    modified:   processing/layout/_partial/navigation.jade
    modified:   processing/layout/_widget/archive.jade
    modified:   processing/layout/_widget/categories.jade
    modified:   processing/source/css/_base/base.scss
    modified:   processing/source/css/_base/variables.scss
    modified:   processing/source/css/_partial/navigation.scss
    modified:   processing/source/css/style.scss&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;可以使用 git reset HEAD &lt;file&gt;… 的方式取消暂存。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;➜  hexo-theme git:(master) ✗ git reset HEAD *
Unstaged changes after reset:
M	processing/README.md
M	processing/layout/_partial/navigation.jade
M	processing/layout/_widget/archive.jade
M	processing/layout/_widget/categories.jade
M	processing/source/css/_base/base.scss
M	processing/source/css/_base/variables.scss
M	processing/source/css/_partial/navigation.scss
M	processing/source/css/style.scss&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这时再使用 &lt;code&gt;git status&lt;/code&gt; 查看文件状态可以看到&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;➜  hexo-theme git:(master) ✗ git status
On branch master
Your branch is ahead of &amp;#39;origin/master&amp;#39; by 2 commits.
  (use &amp;quot;git push&amp;quot; to publish your local commits)

Changes not staged for commit:
  (use &amp;quot;git add &amp;lt;file&amp;gt;...&amp;quot; to update what will be committed)
  (use &amp;quot;git checkout -- &amp;lt;file&amp;gt;...&amp;quot; to discard changes in working directory)

  modified:   processing/README.md
  modified:   processing/layout/_partial/navigation.jade
  modified:   processing/layout/_widget/archive.jade
  modified:   processing/layout/_widget/categories.jade
  modified:   processing/source/css/_base/base.scss
  modified:   processing/source/css/_base/variables.scss
  modified:   processing/source/css/_partial/navigation.scss
  modified:   processing/source/css/style.scss

no changes added to commit (use &amp;quot;git add&amp;quot; and/or &amp;quot;git commit -a&amp;quot;)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;可以看到，现在所有的修改都没有被暂存。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;取消对文件的修改&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%96%E6%B6%88%E5%AF%B9%E6%96%87%E4%BB%B6%E7%9A%84%E4%BF%AE%E6%94%B9&quot; aria-label=&quot;取消对文件的修改 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;取消对文件的修改&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;有一次，我正修复一个bug，修改本地仓库的一个文件，还没有完成时，同伴告诉我他已经修改好了，并且已经提交到远程了。我停下手头的工作，准备 pull ，这时候意识到，如果直接 pull，merge 的时候必然会冲突，因为我和同事同时修改了同一个文件的差不多相同的地方。但是我自己修改了文件很多地方，一味的 CTRL+Z 也难以解决问题，此时我需要将我修改的文件返回到修改之前的状态。很凑巧的是，在执行 &lt;code&gt;git status&lt;/code&gt; 时，同样也给出了具体的撤销方法。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;➜  hexo-theme git:(master) git status
On branch master
Your branch is up-to-date with &amp;#39;origin/master&amp;#39;.

Changes not staged for commit:
  (use &amp;quot;git add &amp;lt;file&amp;gt;...&amp;quot; to update what will be committed)
  (use &amp;quot;git checkout -- &amp;lt;file&amp;gt;...&amp;quot; to discard changes in working directory)

  modified:   processing/layout/_widget/archive.jade
  modified:   processing/layout/_widget/categories.jade
  modified:   processing/layout/_widget/tags.jade
  modified:   processing/layout/layout.jade
  modified:   processing/source/css/_base/base.scss

no changes added to commit (use &amp;quot;git add&amp;quot; and/or &amp;quot;git commit -a&amp;quot;)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;使用 &lt;code&gt;git checkout -- &amp;#x3C;filename&gt;&lt;/code&gt; 来取消工作目录中的修改。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;➜  hexo-theme git:(master) ✗ git checkout -- *
➜  hexo-theme git:(master) git status
On branch master
Your branch is up-to-date with &amp;#39;origin/master&amp;#39;.

nothing to commit, working directory clean&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;效果显而易见！！这条命令有些危险，所有对文件的修改都没有了。如果一个不小心将自己需要的修改 discard 了，那就只有哭了……&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;修改最后一次的提交&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BF%AE%E6%94%B9%E6%9C%80%E5%90%8E%E4%B8%80%E6%AC%A1%E7%9A%84%E6%8F%90%E4%BA%A4&quot; aria-label=&quot;修改最后一次的提交 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;修改最后一次的提交&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;有时候在提交时，发现自己漏掉或者多选了几个文件，亦或者提交信息写错了，想要撤销刚才的提交操作，可以使用 &lt;code&gt;--amend&lt;/code&gt; 这个选项，重新提交&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;➜  hexo-theme git:(master) ✗ git add -A
➜  hexo-theme git:(master) ✗ git commit -m &amp;quot;commit wrong&amp;quot;
[master ebcbab2] commit wrong
  4 files changed, 78 insertions(+), 106 deletions(-)
  rewrite processing/source/css/_base/base.scss (64%)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;发现自己提交了一个 “commit wrong” 的错误提交信息，也不用太紧张，输入指令&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;git commit --amend&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;之后，会跳转到命令行中的 vim 中，提示你修改提交信息。只要没有推送到远程端，一切都好说～&lt;/p&gt;</content:encoded></item><item><title><![CDATA[踩坑日记-IE下 A 标签的虚线框和必须要会用的 CSS 选择器]]></title><description><![CDATA[IE 下 a标签的虚线框 在 IE 中，点击 a 标签时， a 标签会被加上一个虚线框，很丑！！！！！ 不同版本的IE解决方案不同：IE8 下只需为 a 标签添加一条 CSS 属性就可以 outline:none，顺便一提 ，这条属性可以取消浏览器中输入框获得焦点是丑逼逼的外框…]]></description><link>https://zhanglun.github.io/blogs/踩坑日记-ie下a标签的虚线框/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/踩坑日记-ie下a标签的虚线框/</guid><pubDate>Fri, 18 Jul 2014 20:39:00 GMT</pubDate><content:encoded>&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;IE-下-a标签的虚线框&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#IE-%E4%B8%8B-a%E6%A0%87%E7%AD%BE%E7%9A%84%E8%99%9A%E7%BA%BF%E6%A1%86&quot; aria-label=&quot;IE 下 a标签的虚线框 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;IE 下 a标签的虚线框&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;在 IE 中，点击 a 标签时， a 标签会被加上一个虚线框，很丑！！！！！&lt;/p&gt;
&lt;!-- ![image](http://img3.picbed.org/uploads/2014/07/QQ20140718_1.png) --&gt;
&lt;p class=&quot;para&quot;&gt;不同版本的IE解决方案不同：IE8 下只需为 a 标签添加一条 CSS 属性就可以 &lt;code&gt;outline:none&lt;/code&gt;，顺便一提 ，这条属性可以取消浏览器中输入框获得焦点是丑逼逼的外框&lt;/p&gt;
&lt;!-- ![image](http://img3.picbed.org/uploads/2014/07/QQ20140718_2.png) --&gt;
&lt;p class=&quot;para&quot;&gt;但是在高贵的 IE7 中，即使是添加了 &lt;code&gt;outline: none&lt;/code&gt;，虚线框依旧存在，在 HTML 上加 &lt;code&gt;hidefocus=&quot;true&quot;&lt;/code&gt;　如&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;a href=&amp;quot;http://www.zhanglun.github.io/&amp;quot; class=&amp;quot;active&amp;quot; hidefocus=&amp;quot;true&amp;quot;&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;hr&gt;
&lt;p class=&quot;para&quot;&gt;###强大的CSS选择器&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;项目最低的兼容要求是 IE8 ，所有很多以前由于兼容性问题而不常用的CSS选择器和属性都可以使用。下面记录的都是以前基本上没有用到的但是却很有用的选择器，就拿属性选择器来说，简直遍地都是。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;#####直接相邻选择器 X+Y （兼容浏览器：IE7+、Firefox、Chrome、Safari、Opera）&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;ul + p {
    color: red;
} &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;匹配在ul后面的第一个p，将段落内的文字颜色设置为红色。(只匹配第一个元素)。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;#####子选择器 X&gt;Y （兼容浏览器：IE7+、Firefox、Chrome、Safari、Opera）&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;div#container &amp;gt; ul {
    border: 1px solid black;
} 

&amp;lt;div id=&amp;quot;container&amp;quot;&amp;gt;
    &amp;lt;ul class=&amp;quot;son&amp;quot;&amp;gt;
        &amp;lt;li&amp;gt; List Item
            &amp;lt;ul&amp;gt;
                &amp;lt;li&amp;gt; Child &amp;lt;/li&amp;gt;
            &amp;lt;/ul&amp;gt;
        &amp;lt;/li&amp;gt;
        &amp;lt;li&amp;gt; List Item &amp;lt;/li&amp;gt;
        &amp;lt;li&amp;gt; List Item &amp;lt;/li&amp;gt;
        &amp;lt;li&amp;gt; List Item &amp;lt;/li&amp;gt;
    &amp;lt;/ul&amp;gt; 
&amp;lt;/div&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;与后代选择器X Y不同的是，子选择器只对X下的&lt;strong&gt;直接子级Y&lt;/strong&gt;起作用。在上面的css和html例子中，div#container&gt;ul仅对container中&lt;strong&gt;最近一级的ul&lt;/strong&gt;起作用(即拥有类名 son 的 ul)。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;####间接相邻选择器 X ~ Y （兼容浏览器：IE7+、Firefox、Chrome、Safari、Opera  ）
ul ~ p {
color: red;
}
与前面提到的 X+Y 不同的是，X~Y 匹配与 X &lt;strong&gt;相同级别的所有Y元素&lt;/strong&gt;，而&lt;strong&gt;X+Y只匹配第一个&lt;/strong&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这些选择器，给人的感觉是根据 HTML 的结构来选择对应的元素，比如说：选择在页面中相邻的元素；根据父元素选择子元素，或者兄弟元素，都依赖着结构，利用A去寻找B。下面说的 &lt;strong&gt;属性选择器&lt;/strong&gt; 给人的感觉就不太一样&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;####属性选择器 （兼容浏览器：IE7+、Firefox、Chrome、Safari、Opera）&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;#####X[title]——匹配的是带有 &lt;strong&gt;title&lt;/strong&gt; 属性的链接元素&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;a[title] {
    color: green;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;#####X[title=“foo”]——匹配所有拥有href属性，且**href为&lt;a href=&quot;http://css9.net**%E7%9A%84%E6%89%80%E6%9C%89%E9%93%BE%E6%8E%A5&quot; class=&quot;link-underline&quot;&gt;http://css9.net**的所有链接&lt;/a&gt;&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;a[href=&amp;quot;http://css9.net&amp;quot;] {
    color: #1f6053; 
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;#####X[title*=“zhanglun”]——匹配的是href中**包含”zhanglun”*&lt;em&gt;的所有链接
a[href&lt;/em&gt;=“css9.net”] {
color: #1f6053;
}&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;#####X[href^=“http”]——匹配的是href中&lt;strong&gt;所有以http开头&lt;/strong&gt;的链接&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;a[href^=&amp;quot;http&amp;quot;] {
    background: url(path/to/external/icon.png) no-repeat;
    padding-left: 10px;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;#####X[href$=“.jpg”]——匹配的是&lt;strong&gt;所有链接到扩展名为.jpg图片的链接&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;a[href^=&amp;quot;http&amp;quot;] {
    background: url(path/to/external/icon.png) no-repeat;
    padding-left: 10px;
}   &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;#####X[data-&lt;em&gt;=“foo”]——匹配属性 data-&lt;/em&gt; 为 “foo” 的元素&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在上一个选择器中提到如何匹配所有图片链接。如果使用X[href$=“.jpg”]实现，需要这样做：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;a[href$=&amp;quot;.jpg&amp;quot;],
a[href$=&amp;quot;.jpeg&amp;quot;],
a[href$=&amp;quot;.png&amp;quot;],
a[href$=&amp;quot;.gif&amp;quot;] {
    color: red;
}
 &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;看上去比较麻烦。另一个解决办法是为所有的图片链接加一个特定的属性，例如‘data-file’&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;html代码
&amp;lt;a href=&amp;quot;path/to/image.jpg&amp;quot; data-filetype=&amp;quot;image&amp;quot;&amp;gt; 图片链接 &amp;lt;/a&amp;gt; 

css代码如下：
a[data-filetype=&amp;quot;image&amp;quot;] {
    color: red;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这样所有链接到图片的链接字体颜色为红色。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;#####X[foo~=“bar”]——匹配属性值中用空格分隔的多个值中的一个&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;html代码
&amp;lt;a href=&amp;quot;path/to/image.jpg&amp;quot; data-info=&amp;quot;external image&amp;quot;&amp;gt; Click Me, Fool &amp;lt;/a&amp;gt; 

css代码
a[data-info~=&amp;quot;external&amp;quot;] {
    color: red;
}
a[data-info~=&amp;quot;image&amp;quot;] {
    border: 1px solid black;
}
 &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在上面例子中，匹配data-info属性中包含“external”链接的字体颜色为红色。匹配data-info属性中包含“image”的链接设置黑色边框。&lt;br&gt;
兼容浏览器：IE7+、Firefox、Chrome、Safari、Opera&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Git 使用笔记(一)-入门级的操作]]></title><description><![CDATA[一般处理 初始化: 这样就会在当前目录创建版本库. 常用指令: 添加文件： 删除文件索引,并且删除文件： 重命名： 提交更新,全部： 查看日志. 查看指定版本日志. 切换分支. 创建新的分支. 就近创建一个分支,转移所有目前修改到此分支中， 其实就是创建分支和切换分支的合并操作…]]></description><link>https://zhanglun.github.io/blogs/git使用笔记(一)/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/git使用笔记(一)/</guid><pubDate>Wed, 16 Jul 2014 21:09:00 GMT</pubDate><content:encoded>&lt;h3 class=&quot;heading&quot; id=&quot;一般处理&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%80%E8%88%AC%E5%A4%84%E7%90%86&quot; aria-label=&quot;一般处理 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;一般处理&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;初始化:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git init &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这样就会在当前目录创建版本库.&lt;/p&gt;
&lt;h4 class=&quot;heading&quot; id=&quot;常用指令&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4&quot; aria-label=&quot;常用指令 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;常用指令:&lt;/h4&gt;
&lt;p class=&quot;para&quot;&gt;添加文件：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git add FILENAME&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;删除文件索引,&lt;strong&gt;并且删除文件&lt;/strong&gt;：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git rm FILENAME&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;重命名：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git mv OLDFILENAME NEWFILENAME&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;提交更新,全部：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git commit -a&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;查看日志.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git log&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;查看指定版本日志.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git show xxxxx&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;切换分支.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git checkout BRANCHNAME&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;创建新的分支.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git branch BRANCHNAME&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;就近创建一个分支,转移所有目前修改到此分支中， 其实就是&lt;strong&gt;创建分支和切换分支的合并操作&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git checkout -b BRANCHNAME&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;实验完毕,发现可行提交后,直接返回主分支中进行合并.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git commit -a 
$ git checkout master 
$ git merge BRANCHNAME&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;分支合并,切换到需要合并的分支中,然后执行merge就能够合并.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git merge TARGETBRANCH&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;更多时候我们需要远程操作.除了直接clone出来一个完整的仓库,需要追加更新.&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git fetch git://xxxx.xxxx master:LOCALBRANCH&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;将远程仓库中的分支fetch到本临时分支后(例子中为origin:master),如果指定了分支,则会保存到指定分支中去(例子中为LOCALBRANCH).然后进行代码审核,最后再merge到主分支中去.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当然,也有的时候我们对远程仓库中的代码有绝对信心,或者仅仅只是你一个人在维护,那么就可以直接获取并且合并.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git pull git://xxx.xxxx master&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;Git-记录的方式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Git-%E8%AE%B0%E5%BD%95%E7%9A%84%E6%96%B9%E5%BC%8F&quot; aria-label=&quot;Git 记录的方式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Git 记录的方式&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;Git 是一种分布式版本控制系统，客户端并不只提取最新版本的文件快照，而是把代码仓库完整&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;img src=&quot;http://git-scm.com/figures/18333fig0103-tn.png&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;图片来源：&lt;a href=&quot;http://git-scm.com/figures/18333fig0103-tn.png&quot; class=&quot;link-underline&quot;&gt;http://git-scm.com/figures/18333fig0103-tn.png&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;每次修改之后，Git 并不是保存这些修改之后的差异变化，实际上就像一个照相机一样，将修改后的文件拍下作为文件快照，记录在一个微型的文件系统中。每次提交更新时，检查一遍所有文件的信息&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;对于任何一个文件，在 Git 内都只有三种状态：已提交（committed），已修改（modified）和已暂存（staged）。已提交表示该文件已经被安全地保存在本地数据库中了；已修改表示修改了某个文件，但还没有提交保存；已暂存表示把已修改的文件放在下次提交时要保存的清单中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Git 管理项目时，文件流转的三个工作区域：Git 的&lt;strong&gt;工作目录&lt;/strong&gt;，&lt;strong&gt;暂存区域&lt;/strong&gt;，以及&lt;strong&gt;本地仓库&lt;/strong&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;img src=&quot;http://git-scm.com/figures/18333fig0106-tn.png&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;图片来源：&lt;a href=&quot;http://git-scm.com/figures/18333fig0106-tn.png&quot; class=&quot;link-underline&quot;&gt;http://git-scm.com/figures/18333fig0106-tn.png&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;工作区&lt;/strong&gt;：就是电脑中可以看到的目录。&lt;br&gt;
&lt;strong&gt;版本库&lt;/strong&gt;：工作区中有一个隐藏目录 “.git” ，这个不算做是工作区，而是 Git 的版本库。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;基本的 Git 工作流程如下：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;第一步是用 &lt;code&gt;git add&lt;/code&gt; 把文件添加进去，实际上就是把文件修改添加到暂存区（对修改后的文件进行快照，然后保存到暂存区域。）；&lt;br&gt;
第二步是用 &lt;code&gt;git commit&lt;/code&gt; 提交更改，实际上就是把暂存区的所有内容提交到当前分支；&lt;br&gt;
第三步是用 &lt;code&gt;git push&lt;/code&gt; 推送更改，将保存在暂存区域的文件快照永久转储到 Git 目录中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果是 Git 目录中保存着的特定版本文件，就属于&lt;strong&gt;已提交状态&lt;/strong&gt;；如果作了修改并已&lt;strong&gt;放入暂存区域&lt;/strong&gt;，就属于&lt;strong&gt;已暂存状态&lt;/strong&gt;；如果自上次取出后，作了修改但还没有放到暂存区域，&lt;strong&gt;就是已修改状态&lt;/strong&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;图片来源：&lt;img src=&quot;http://rogerdudler.github.io/git-guide/img/trees.png&quot; alt=&quot;image&quot;&gt;
&lt;a href=&quot;http://rogerdudler.github.io/git-guide/index.zh.html&quot; class=&quot;link-underline&quot;&gt;git简明教程&lt;/a&gt;&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;分支&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%86%E6%94%AF&quot; aria-label=&quot;分支 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;分支&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;分支是用来将特性开发绝缘开来的。在你创建仓库的时候，master 是“默认的”分支。在其他分支上进行开发，完成后再将它们合并到主分支上。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;从开发主线上分离开来，形成的分支可以在不影响主线的同时继续工作。git中的分支，不会创建源代码目录的完整备份，它的操作几乎在瞬间完成，在不同分支之间切换也很轻松 &lt;code&gt;git checkout brachname&lt;/code&gt; 。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;img src=&quot;http://rogerdudler.github.io/git-guide/img/branches.png&quot; alt=&quot;image&quot;&gt;
图片来源：&lt;a href=&quot;http://rogerdudler.github.io/git-guide/img/branches.png&quot; class=&quot;link-underline&quot;&gt;http://rogerdudler.github.io/git-guide/img/branches.png&lt;/a&gt; &lt;a href=&quot;http://rogerdudler.github.io/git-guide/index.zh.html&quot; class=&quot;link-underline&quot;&gt;git简明教程&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;创建一个叫做“feature_x”的分支，并切换过去：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git checkout -b feature_x&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;切换回主分支：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git checkout master&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;再把新建的分支删掉：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git branch -d feature_x&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;除非你将分支推送到远端仓库，不然该分支就是 不为他人所见的：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git push origin &amp;lt;branch&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;取消跟踪文件&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%96%E6%B6%88%E8%B7%9F%E8%B8%AA%E6%96%87%E4%BB%B6&quot; aria-label=&quot;取消跟踪文件 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;取消跟踪文件&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;在项目中有很多文件不需要提交，比如IDE生成的项目文件，自动化工具 grunt等。在使用 &lt;code&gt;git status&lt;/code&gt; 时，这些文件会列举在 Untracked files 中，有时候为了方便而使用 &lt;code&gt;git add -A&lt;/code&gt; 命令的时候，会将这些没有被跟踪的文件添加到索引。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果一个不小心将某个不需要提交的修改添加到了暂存区（git add *），即：staged。如果这时进行 commit 操作，这个不想提交的修改也会一同提交到本地仓库的 HEAD 中，当然只有 push 之后修改才会提交到远端的仓库。在 commit 之前，使用&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git rm --cached filename&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;便可以把它从暂存区中删除，保留源文件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这条命令只是在暂存区中将文件快照删除而已，并不会将源文件从项目中删除。如果想连同源文件一起删除可以使用这条命令&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git rm filename&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;比较提交---git-diff&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%AF%94%E8%BE%83%E6%8F%90%E4%BA%A4---git-diff&quot; aria-label=&quot;比较提交   git diff permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;比较提交 - git diff&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;使用 &lt;code&gt;git diff&lt;/code&gt; 查看文件被修改的具体内容：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git diff filename&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;也可以用来比较项目中任意两个版本的差异，比如比较两个分支之间的差异：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git diff brach1..brach2 &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;你可能还会看到下面这条看起来非常相似的命令：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git diff brach1...brach2 &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;不同之处在于：两个分支名之间的点的个数，后面这条也就是三个”.”的命令将显示出 brach1 和 brach2 共有父分支和 brach2 之间的差异。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你通常用git diff来找你当前工作目录和上次提交与本地索引间的差异。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git diff&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;上面的命令会显示在当前的工作目录里的，没有 modified (添加到索引中)，且在下次提交时 不会被提交的修改。如果你要看在下次提交时要提交的内容(staged,添加到索引中),你可以运行：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git diff --cached&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;上面的命令会显示你当前的索引和上次提交间的差异；这些内容在不带”-a”参数运行 “git commit”命令时就会被提交。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git diff HEAD&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;上面这条命令会显示你工作目录与上次提交时之间的所有差别，这条命令所显示的 内容都会在执行”git commit -a”命令时被提交。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[利用pip安装Django]]></title><description><![CDATA[###pip的安装 先下载一个 python 文件 : get-pip.py。
然后运行下面这条命令（可能需要管理员权限）： 如果 setuptools 还没有安装，pip会帮你安装。如果想更新已经存在的 setuptools，只要运行 为了确保能够在命令行中使用 pip 命…]]></description><link>https://zhanglun.github.io/blogs/利用pip安装django/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/利用pip安装django/</guid><pubDate>Sat, 12 Jul 2014 20:30:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;###pip的安装&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;先下载一个 python 文件 : &lt;a href=&quot;https://bootstrap.pypa.io/get-pip.py&quot; class=&quot;link-underline&quot;&gt;get-pip.py&lt;/a&gt;。
然后运行下面这条命令（可能需要管理员权限）：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;python get-pip.py&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果 &lt;a href=&quot;https://pypi.python.org/pypi/setuptools&quot; class=&quot;link-underline&quot;&gt;setuptools&lt;/a&gt; 还没有安装，pip会帮你安装。如果想更新已经存在的 setuptools，只要运行&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;pip install -U setuptools&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;为了确保能够在命令行中使用 &lt;code&gt;pip&lt;/code&gt; 命令，确保将 Python 安装目录中的 &lt;code&gt;Scripts&lt;/code&gt; 文件夹路径添加到系统的环境变量中。这个必须手动添加！&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###升级 pip&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在 Linux 或者 Mac 中：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;pip install -U pip&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在 Window 中：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;python -m pip install -U pip&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###安装 packages&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ pip install SomePackage            # latest version
$ pip install SomePackage==1.0.4     # specific version
$ pip install &amp;#39;SomePackage&amp;gt;=1.0.4&amp;#39;     # minimum version&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###卸载 packages&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;    $ pip install SomePackage&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;所以，在成功安装了 pip之后，可以使用 pip 安装 Django&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;pip install Django==1.6.5&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[(译)阻止事件传播的危害]]></title><description><![CDATA[原文标题：The Dangers of Stopping Event Propagation 原文链接：http://css-tricks.com/dangers-stopping-event-propagation/ 这是  Philip Walton 发布在 css-tri…]]></description><link>https://zhanglun.github.io/blogs/(译)取消事件冒泡的危害/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/(译)取消事件冒泡的危害/</guid><pubDate>Wed, 28 May 2014 21:23:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;原文标题：The Dangers of Stopping Event Propagation&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;原文链接：&lt;a href=&quot;http://css-tricks.com/dangers-stopping-event-propagation/&quot; class=&quot;link-underline&quot;&gt;http://css-tricks.com/dangers-stopping-event-propagation/&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;这是  &lt;a href=&quot;http://philipwalton.com/&quot; class=&quot;link-underline&quot;&gt;Philip Walton&lt;/a&gt; 发布在 &lt;a href=&quot;http://css-tricks.com/&quot; class=&quot;link-underline&quot;&gt;css-trick&lt;/a&gt; 上的一篇文章。他将会向我们解释为什么不能轻易地阻止事件的传播，而是尽可能的去避免。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果你是一个前端开发人员，在你的工作中，应该有过这样的经历：编写一个自定义的弹出窗口或者对话框，当用户点击页面中弹窗的之外的其他地方，弹窗隐藏。如果你试着在网上搜索试图找到最好的解决方案，没准你会遇到这个 Stack Overflow 上的一个问题：&lt;a href=&quot;http://stackoverflow.com/questions/152975/how-to-detect-a-click-outside-an-element&quot; class=&quot;link-underline&quot;&gt;How to detect a click outside an element?&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;下面的代码是投票最高的回答推荐的方案：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$(&amp;#39;html&amp;#39;).click(function() {
  // Hide the menus if visible.
});

$(&amp;#39;#menucontainer&amp;#39;).click(function(event){
  event.stopPropagation();
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这个例子可能说的不太明显。简单的解释一下：如果一个鼠标点击事件冒泡到 &amp;#x3C;\html&gt; 元素上时，隐藏菜单。如果点击事件是在元素 #menucontainer 内部触发的，则阻止在这个事件使得事件永远不会到达 &amp;#x3C;\html&gt;元素上。因此只有在元素 #menucontainer 外触发点击事件时菜单才会被隐藏。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;上面的方案一直以来都是如此的简单优雅。然后，不幸的是，这绝对是一个很可怕的建议！
这种办法就像是：通过关掉浴室的水来解决淋浴漏水问题。这有效果，但是却完完全全忽略了页面其他代码可能需要监听这个事件的可能性。好比你的蓬头漏水了但是你还得用洗手盆的水龙头。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##取消冒泡会导致什么问题（What Can Go Wrong?）？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你可能会说：谁还会自己去写这种代码？我使用经过良好测试的库，比如 Bootstrap，所以我不用担心这个问题，不是吗？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;可是，真的是这样的吗？在现在流行的一些库中，也有一些库在处理事件中阻止了事件的传播。为了证明这一点，让我来为你演示一下在 Ruby on Rail 中使用 Bootstrap 搞出一个bug是多么的容易。Rails 使用了一个叫做 &lt;a href=&quot;https://github.com/rails/jquery-ujs&quot; class=&quot;link-underline&quot;&gt;jquery-ujs&lt;/a&gt; 的JavaScript库，它可以让开发者通过 &lt;code&gt;data-remote&lt;/code&gt; 以声明的方式为链接添加远程的 Ajax 调用。在下面的例子中，如果你点开了 &lt;code&gt;Dropdown&lt;/code&gt; ，点击窗体的其他地方这个 dropdown 会自动隐藏。但是，如果点开 &lt;code&gt;Dropdown&lt;/code&gt; 之后再点击 &lt;code&gt;Remote Link&lt;/code&gt; ，dropdown将不会隐藏。&lt;/p&gt;
 &lt;iframe id=&quot;cp_embed_KzHjc&quot; src=&quot;http://codepen.io/anon/embed/KzHjc?height=268&amp;amp;theme-id=1&amp;amp;slug-hash=KzHjc&amp;amp;default-tab=result&quot; scrolling=&quot;no&quot; frameborder=&quot;0&quot; height=&quot;268&quot; allowtransparency=&quot;true&quot; class=&quot;cp_embed_iframe&quot; style=&quot;width: 100%; overflow: hidden;&quot;&gt;&lt;/iframe&gt;
&lt;p class=&quot;para&quot;&gt;之所以会产生这个bug，是因为在 Bootstrap 框架中，负责监听关闭 下拉菜单的事件绑定在 document 上。但是由于 jquery-ujs 中，它的属性 &lt;code&gt;data-remote&lt;/code&gt; 绑定了阻止事件传播的处理程序，这些鼠标点击事件永远都不会到达 document，因此在 Bootstrap 中的代码永远都不会实现。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;最糟糕的是这个bug在 Bootstrap（或者其他库和框架）中，是绝对没有办法解决的。如果你在处理 DOM ， 你只能任凭那些写的很烂的代码在页面上运行。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###Events 带来的问题（The Problem with Events）&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;像 JavaScript 中的很多对象一样，DOM 事件也是全局的。众所周知，没有处理好全局变量将会使得代码混乱不堪。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;修改一个简单的事件起初可能没有什么害处，但是这会带来风险。当你修改的事件执行过程是其他人需要的或者其他代码所依赖的，代码便会产生bug，只是时间问题而已。
而这种类型的bug是最难跟踪得bug之一。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##为什么要阻止事件的传播（Why Do People Stop Event Propagation?）？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;事实上，开发人员总是在不知不觉中阻止了事件的传播&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###Return false&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当你从一个事件处理程序返回 false 的时候，关于这个过程中发生的事情总是有很多混淆的地方。请思考下面三个例子：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;HTML&lt;/strong&gt; :&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;!-- 一个行间的事件处理程序. --&amp;gt;
&amp;lt;a href=&amp;quot;http://google.com&amp;quot; onclick=&amp;quot;return false&amp;quot;&amp;gt;Google&amp;lt;/a&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;Jquery&lt;/strong&gt; :&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// 一个 jQuery 事件处理程序.
$(&amp;#39;a&amp;#39;).on(&amp;#39;click&amp;#39;, function() {
  return false;
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;JavaScript&lt;/strong&gt; :&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//一个原生的事件处理程序
var link = document.querySelector(&amp;#39;a&amp;#39;);
link.addEventListener(&amp;#39;click&amp;#39;, function() {
  return false;
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这三个例子都只做一件相同的事情：返回 false，但是实际上返回的结果却是大相径庭，来看看上述的每个例子到底发生了什么。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;行间脚本：阻止链接跳转到指定的地址，但是不会阻止事件在 DOM 中的传播。&lt;/li&gt;
&lt;li&gt;jQuery：阻止链接跳转到指定的地址，同时阻止事件在 DOM 中的传播。&lt;/li&gt;
&lt;li&gt;原生js：不做任何事&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;当你期待一件事情发生的时候，它并没有发生，你通常可以很快的找到解决方案。而更严重的问题是，当你期待一件事情发生，它确实发生了，但是伴随着意料之外的，并不引人注意的副作用。这就是bug诞生的源头。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在 Jquery 的例子中，&lt;code&gt;return false&lt;/code&gt; 的行为相比其他两种处理程序有哪些不同并不是完全清楚，但是确实有所不同。实际上 在这个例子中，jQuery 调用了两条语句&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;event.preventDefault();
event.stopPropagation();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;由于 &lt;code&gt;return false&lt;/code&gt; 的混乱，同时 jQuery 中的处理程序阻止了事件的传播，我建议不要使用。更好的做法是明确你的目的，然后直接调用这些事件的方法。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###性能(Performance)&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在老式的浏览器中，一个复杂的 DOM 结构真的会减慢你的站点加载速度。同时由于事件的传播需要经过整个 DOM ，所以文档中的节点越多，事件到达目标元素的速度就越慢。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Peter Paul Koch 中的&lt;a href=&quot;http://www.quirksmode.org/js/events_order.html&quot; class=&quot;link-underline&quot;&gt;一篇文章&lt;/a&gt;中提到了一个具体的例子：&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;If your document structure is very complex (lots of nested tables and such) you may save system resources by turning off bubbling. The browser has to go through every single ancestor element of the event target to see if it has an event handler. Even if none are found, the search still takes time.&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果你的文档结构十分复杂（有很多嵌套的表格或者其他类似的结构），你可以通过取消事件冒泡来节约系统的资源。浏览器不得不检查事件的对象元素的每一个祖先元素是否绑定了事件处理程序。即使没有绑定，这个搜索也依旧会花费时间。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;然而对于现在浏览器，你通过阻止事件传播得到的性能提升很有可能会被你的用户忽视，也就是说大部分时候，用户察觉不到。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我觉得不用担心事件通过整个 DOM 传播。毕竟，这个是规范的一部分，而且浏览器也能够很好的处理。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##如何代替（What to Do Instead）&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;首先作为一般的规则，阻止事件的传递不应该是一个问题的解决方法。假设你的页面上有几个事件处理程序，它们之间有时候互相干扰，同时你发现阻止事件的传递可以让代码很好的工作，这是一个很糟糕的事情！这可能可以解决暂时的问题，但是很有可能产生其他的你不知道的问题。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;阻止事件的传播应该像取消一个事件一样仔细考虑，并且只有在你想取消一个事件的时候才去阻止事件的传播。可能你想阻止一个表单的提交或者不允许将页面的焦点聚集在某个区域上。在这些情况下，你会选择阻止事件的传递，是因为你不想触发默认的事件，而不是因为你不想有一个注册在 DOM 更深处的事件处理程序。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在之前提到的 Stack Overflow 上的那个问题中，总而言之，其调用 &lt;code&gt;stopPropagation&lt;/code&gt; 的目的不是为了摆脱点击事件，而是避免在页面上运行其他代码。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;之所以说它是个不好的方案，除了是因为它改变了全局对象的行为，还有它将菜单的隐藏逻辑代码放在了两个不同的而且没有联系的地方，这使得代码变得脆弱。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;有一个更好的解决办法就是创建单一的事件处理程序，它的逻辑完全的封闭，这个处理程序唯一的作用就是通过给定的事件决定这个菜单是否隐藏。事实证明这个更好的方案也减少了代码量：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$(document).on(&amp;#39;click&amp;#39;, function(event) {
  if (!$(event.target).closest(&amp;#39;#menucontainer&amp;#39;).length) {
    // Hide the menus.
  }
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;上面的事件处理程序只监听在 document 上触发的点击事件，然后检查事件对象是否为 &lt;code&gt;#menucontainer&lt;/code&gt; ，或者其子元素。如果不是，那么点击事件是在这个元素外触发的，因此菜单将被隐藏。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###取消默认事件（Default Prevented）？&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;About a year ago I start writing an event handling library to help deal with this problem. Instead of stopping event propagation, you would simply mark an event as “handled”. This would allow event listeners registered farther up the DOM to inspect an event and, based on whether or not it had been “handled”, determine if any further action was needed. The idea was that you could “stop event propagation” without actually stopping it.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;As it turned out, I never ended up needing this library. In 100% of the cases where I found myself wanting to check if an event hand been “handled”, I noticed that a previous listener had called preventDefault. And the DOM API already provides a way to inspect this: the defaultPrevented property.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;忽略了原文中的这些，直接跳到重点&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;DOM API 已经提供了一个属性 &lt;code&gt;&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/API/event.defaultPrevented&quot; class=&quot;link-underline&quot;&gt;defaultPrevented&lt;/a&gt;&lt;/code&gt;，用以检查当前事件的默认动作是否被取消,也就是是否执行了 &lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/API/event.defaultPrevented&quot; class=&quot;link-underline&quot;&gt;event.preventDefault()&lt;/a&gt; 方法。为了证明这个。让我举一个例子，想象一下你在文档上添加了一个事件监听器，当用户点击链接到外域的链接是使用谷歌分析跟踪用户。就想这样：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$(document).on(&amp;#39;click&amp;#39;, &amp;#39;a&amp;#39;, function(event) {
  if (this.hostname != &amp;#39;css-tricks.com&amp;#39;) {
    ga(&amp;#39;send&amp;#39;, &amp;#39;event&amp;#39;, &amp;#39;Outbound Link&amp;#39;, this.href);
  }
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这段代码的问题是：不是所有的链接都是将用户引向其他页面的，有时候 JavaScript 会调用 preventDefault 拦截事件，然后去做其他的事情。另一个例子是，Twitter 的分享按钮打开的是一个窗口而不是跳转到 twitter.com。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了避免跟踪到这些不一样的链接，阻止事件的传播变得很有诱惑力，但是使用 &lt;code&gt;defaultPrevented&lt;/code&gt; 来检查事件是一个更好的方法。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$(document).on(&amp;#39;click&amp;#39;, &amp;#39;a&amp;#39;, function(event) {
  // 如果事件的 preventDefault() 已经被调用，则忽略该事件.
  if (event.defaultPrevented) return;
  if (this.hostname != &amp;#39;css-tricks.com&amp;#39;) {
    ga(&amp;#39;send&amp;#39;, &amp;#39;event&amp;#39;, &amp;#39;Outbound Link&amp;#39;, this.href);
  }
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;因为在一个点击事件的处理程序上调用 preventDefault() 使得浏览器永远阻止导向链接所指向的地址，如果事件的 defaultPrevent 属性为 true 你可以 100% 地确定用户去不了别的地方。换句话说，这种技术不仅比 stopPropagation 可靠，还不会产生副作用。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###结论（Conclusion）&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;希望这篇文章可以帮你在一个新的视角思考 DOM 事件。它们不是一些随意修改不会导致可怕后果的彼此孤立的碎片。它们是全局的，相互关联的对象，对代码的影响远远超过了你所意识到的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了避免 bug，最好的办法就是不管事件，让它们随浏览器的意愿传播。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果你不确定要做什么，只要问问你自己下面的问题：是否有可能存在一些代码，无论是现在还是以后可能需要这个事件发生？这个问题的回答一般都是 yes，如果心存疑虑，那么不要阻止事件传播！&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Node学习笔记—Node.js核心API之Util]]></title><description><![CDATA[最近正在学习Node，在图书馆借了基本关于Node的书，同时在网上查阅资料，颇有收获，但是整体感觉对Node的理解还是停留在一个很模棱两可的状态。比如Node中的模块，平时练习就接触到那么几个，其他的一些模块暂时只会在学习的时候接触到，不常用便就荒废了。正所谓好记心不如烂笔头，…]]></description><link>https://zhanglun.github.io/blogs/Node学习笔记-Node.js核心API之Util/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/Node学习笔记-Node.js核心API之Util/</guid><pubDate>Thu, 15 May 2014 21:16:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;最近正在学习Node，在图书馆借了基本关于Node的书，同时在网上查阅资料，颇有收获，但是整体感觉对Node的理解还是停留在一个很模棱两可的状态。比如Node中的模块，平时练习就接触到那么几个，其他的一些模块暂时只会在学习的时候接触到，不常用便就荒废了。正所谓好记心不如烂笔头，多做笔记还是更有利于理解和记忆。自己做的总结也方便回头复习，所以决定踏上漫长的修炼之旅……&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;##util模块
util 是一个 Node.js 核心模块，提供了一些常用函数，用于弥补核心 JavaScript 的功能过于精简的不足。这些函数都包含在 &lt;code&gt;util&lt;/code&gt; 模块中，可以通过引用模块来使用它们。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###util.format(format, […])
返回一个格式化的字符串，其作用效果有点类似 &lt;code&gt;printf&lt;/code&gt;。第一个参数是一个包含若干个占位符的字符串。将每个参数转换后的值代替参数对应的占位符。支持占位符有：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;%s - String.&lt;/li&gt;
&lt;li&gt;%d - Number (both integer and float).&lt;/li&gt;
&lt;li&gt;%j - JSON.&lt;/li&gt;
&lt;li&gt;% - single percent sign (’%’). This does not consume an argument.&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;如果第一个参数中的占位符找不到与之对应的参数， 那么这个占位符将不会被替换&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;util.format(&amp;#39;%s:%s&amp;#39;, &amp;#39;foo&amp;#39;); // &amp;#39;foo:%s&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果占位符太少，多余的参数会调用 &lt;code&gt;util.inspect()&lt;/code&gt; 转换成字符串，然后用空格将多余的字符串拼接在一起。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;util.format(&amp;#39;%s:%s&amp;#39;, &amp;#39;foo&amp;#39;, &amp;#39;bar&amp;#39;, &amp;#39;baz&amp;#39;, &amp;#39;zhanglun&amp;#39;); // &amp;#39;foo:bar baz zhanglun&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果第一个参数不是一个需要格式化的字符串，那么这个方法会将所有的参数用空格拼接成一个新的字符串，然后返回这个字符串。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;util.format(1, 2, 3, &amp;quot;zhanglun&amp;quot;); // &amp;#39;1 2 3 \&amp;#39;zhanglun\&amp;#39;&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###util.debug(string)
这是一个同步输出的方法。当执行到这一句代码的时候会阻塞进程，并且以标准错误的形式将参数 string 输出。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;require(&amp;#39;util&amp;#39;).debug(&amp;#39;message on stderr&amp;#39;); //message on stderr&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###util.log(string)
以标准输出的形式输出。它将获取当前的时间戳，并和参数 string 一起输出，中间用 ” - ” 连接。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;require(&amp;#39;util&amp;#39;).log(&amp;#39;Timestmaped message.&amp;#39;); //15 May 21:41:33 - Timestmaped message&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###util.inspect(object,[options])
这个方法将任意对象转换为字符串，对调试来说很有用。至少接受一个参数 object，即需要处理的字符串。此外还可以传递一个可选的参数 options，用来控制字符串的输出格式。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;showHidden&lt;/code&gt;——如果&lt;code&gt;showHidden&lt;/code&gt;为 true，那么这个方法将会把参数 object 中不可枚举的属性输出。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;depth&lt;/code&gt;——表示最大的递归层数。如果指定了 depth，也就指定了格式化代码时递归的次数。如果不指定depth，默认会递归2次，指定为 null 时将不限定次数，完整地遍历对象。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;color&lt;/code&gt;——如果&lt;code&gt;color&lt;/code&gt;为 true，输出的格式将会以 ANSI 颜色编码，可以在终端显示更漂亮的效果。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;customInspect&lt;/code&gt;——如果为 false，那么将要被遍历检查的对象（参数object）中定义的&lt;code&gt;inspect（）&lt;/code&gt;函数将不会被调用。 默认值为 true。&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;下面先来看一个例子：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var util = require(&amp;quot;util&amp;quot;);
var obj1 = {
        &amp;quot;aa&amp;quot;: function() {
            console.log(&amp;quot;aa&amp;quot;);
        },
        &amp;quot;inspect&amp;quot;: function() {
            console.log(&amp;quot;obj1&amp;#39;s inspect()&amp;quot;);
        },
        &amp;quot;bb&amp;quot;: function() {
            console.log(&amp;quot;bb&amp;quot;);
        }
    },
    obj2 = {
        &amp;quot;cc&amp;quot;: function() {
            console.log(&amp;quot;cc&amp;quot;);
        },
        &amp;quot;inspect&amp;quot;: function() {
            console.log(&amp;quot;obj2&amp;#39;s inspect()&amp;quot;);
            return &amp;quot;Hello&amp;quot;;
        },
        &amp;quot;dd&amp;quot;: function() {
            console.log(&amp;quot;dd&amp;quot;);
        }
    };

var str1 = util.inspect(obj1, {
    showHidden: false,
    depth: null,
    customInspect: false
}),
    str2 = util.inspect(obj2, {
        showHidden: false,
        depth: null,
        customInspect: true
    });

console.log(&amp;quot;str1 : &amp;quot; + str1);
console.log(&amp;quot;str2 : &amp;quot; + str2);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;其输出结果：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;obj2&amp;#39;s inspect()
str1 : { aa: [Function], inspacet: [Function], bb: [Function] }
str2 : Hello&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;暂时先忽略颜色，待会接着说，先看&lt;code&gt;customInspect&lt;/code&gt;。上面的例子中，有两个对象：obj1 和 obj2，内部都定义了一个 inspect()函数，调用&lt;code&gt;util.inspect()&lt;/code&gt;方法时，只有&lt;code&gt;customInspect&lt;/code&gt;不同。当&lt;code&gt;customInspect&lt;/code&gt;为 true 时，比如 obj2，其内部的 &lt;code&gt;util.inspect()&lt;/code&gt;函数在执行&lt;code&gt;util.inspect()&lt;/code&gt;时就被调用了，同时只会返回这个内部的 &lt;code&gt;util.inspect()&lt;/code&gt;执行后的返回值，如果没有函数显示地调用 return 语句，则返回 undefined。可以试试修改上面的示例代码中 obj2 的&lt;code&gt;inspect()&lt;/code&gt;的返回值。而对于 obj1，其&lt;code&gt;customInspect&lt;/code&gt;，所以其内部的&lt;code&gt;inspect()&lt;/code&gt;并不会被调用。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;####定制颜色
可以通过两个对象：&lt;code&gt;util.inspect.styles&lt;/code&gt;和&lt;code&gt;util.inspect.colors&lt;/code&gt;全局定制输出的颜色。&lt;code&gt;util.inspect.styles&lt;/code&gt;是一个&lt;code&gt;util.inspect.colors&lt;/code&gt;中的颜色到样式的映射。后面的没搞懂怎么回事，以后再补上。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###util.isArray(object)
如果参数 object 是一个数组，返回 true，否则返回 false。
var util = require(‘util’);&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;util.isArray([])
  // true
util.isArray(new Array)
  // true
util.isArray({})
  // false
  &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###util.isRegExp(object)
如果参数 object 是一个 RegExp 对象，返回 true，否则返回 false。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var util = require(&amp;#39;util&amp;#39;);

util.isRegExp(/some regexp/)
  // true
util.isRegExp(new RegExp(&amp;#39;another regexp&amp;#39;))
  // true
util.isRegExp({})
  // false
  &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###util.isDate(object)&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果参数 object 是一个 Date 对象，返回 true，否则返回 false。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var util = require(&amp;#39;util&amp;#39;);

util.isDate(new Date())
  // true
util.isDate(Date())
  // false (without &amp;#39;new&amp;#39; returns a String)
util.isDate({})
  // false
  &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###util.isError(object)&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果参数 object 是一个 Error 对象，返回 true，否则返回 false。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var util = require(&amp;#39;util&amp;#39;);

util.isError(new Error())
  // true
util.isError(new TypeError())
  // true
util.isError({ name: &amp;#39;Error&amp;#39;, message: &amp;#39;an error occurred&amp;#39; })
  // false
  &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###util.inherits(constructor, superConstructor)
这是一个实现对象之间原型继承的函数。constructor 将会继承 superConstructor。另外，通过&lt;code&gt;constructor.super_&lt;/code&gt;可以访问到 superConstructor。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var util = require(&amp;quot;util&amp;quot;);
var events = require(&amp;quot;events&amp;quot;);

function MyStream() {
}
util.inherits(MyStream, events.EventEmitter);

MyStream.prototype.write = function(data) {
    this.emit(&amp;quot;data&amp;quot;, data);
}

var stream = new MyStream();


console.log(stream instanceof events.EventEmitter); // true
console.log(MyStream.super_); 
//{ [Function: EventEmitter] listenerCount: [Function] }
console.log(MyStream.super_ === events.EventEmitter); // true

stream.on(&amp;quot;data&amp;quot;, function(data) {
    console.log(&amp;#39;Received data: &amp;quot;&amp;#39; + data + &amp;#39;&amp;quot;&amp;#39;);
})
stream.write(&amp;quot;It works!&amp;quot;); // Received data: &amp;quot;It works!&amp;quot;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;util 模块还提供了其他的一些工具函数，更多详情请戳&lt;a href=&quot;http://nodejs.org/api/util.html#util_util&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Node学习笔记-Node.js中的核心API之HTTP]]></title><description><![CDATA[最近正在学习Node，在图书馆借了基本关于Node的书，同时在网上查阅资料，颇有收获，但是整体感觉对Node的理解还是停留在一个很模棱两可的状态。比如Node中的模块，平时练习就接触到那么几个，其他的一些模块暂时只会在学习的时候接触到，不常用便就荒废了。正所谓好记心不如烂笔头，…]]></description><link>https://zhanglun.github.io/blogs/Node学习笔记-Node.js核心API之HTTP/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/Node学习笔记-Node.js核心API之HTTP/</guid><pubDate>Tue, 13 May 2014 17:36:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;最近正在学习Node，在图书馆借了基本关于Node的书，同时在网上查阅资料，颇有收获，但是整体感觉对Node的理解还是停留在一个很模棱两可的状态。比如Node中的模块，平时练习就接触到那么几个，其他的一些模块暂时只会在学习的时候接触到，不常用便就荒废了。正所谓好记心不如烂笔头，多做笔记还是更有利于理解和记忆。自己做的总结也方便回头复习，所以决定踏上漫长的修炼之旅……&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;Node提供了许多API，其中一些比较重要。这些核心的API是所有Node应用的支柱，你会不停的用到他们。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##HTTP服务器
Node.js的核心功能之一就是作为web服务器，在Node的标准库中提供了http模块，其中封装了一个高效的HTTP服务器和一个简易的HTTP客户端。就像之前说过的：Node.js 可以作为服务器提供服务，他跳过了类似 Apache，IIS 等 HTTP 服务器，内建了 HTTP 服务器支持，无需额外搭建一个 HTTP 服务器，便可以轻而易举地实现网站和服务器的组合。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Node中的HTTP接口的被设计成可以支持许多HTTP协议中原本用起来很困难的特性，特别是对于很大的或者块编码的消息.这些接口不会完全缓存整个请求(request)或响应(response),这样用户可以在请求(request)或响应(response)中使用数据流。若想使用Node中的HTTP服务或客户端功能，需引用此模块&lt;code&gt;require(‘http’)&lt;/code&gt;。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;http://nodejs.org/api/http.html#http_http&quot; class=&quot;link-underline&quot;&gt;http://nodejs.org/api/http.html#http_http&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;In order to support the full spectrum of possible HTTP applications, Node’s HTTP API is very low-level. It deals with stream handling and message parsing only. It parses a message into headers and body but it does not parse the actual headers or the body.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;为了能全面地支持可能的HTTP应用程序，Node提供的HTTP API都很底层。它只处理流处理和消息解析。它把一份消息解析成报文头和报文体，但是它不解析实际的报文头和报文体。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;###http.Server&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;先用Node来创建一个简单的HTTP服务器：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var http=require(&amp;quot;http&amp;quot;);
http.createServer(function(request,response){
    response.writeHead(200,{
        &amp;quot;Content-Type&amp;quot;:&amp;quot;text/html&amp;quot;
	});
    response.write(&amp;quot;&amp;lt;h1&amp;gt;Hello, CrispElite&amp;lt;/h1&amp;gt;&amp;quot;);
    response.end(&amp;quot;&amp;lt;p&amp;gt;Bye bye!&amp;lt;/p&amp;gt;&amp;quot;);
}).listen(3000);

console.log(&amp;quot;你的服务器已经启动！&amp;quot;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;利用 http.createServer() 创建了一个 http.Server 的实例，将一个匿名函数用了处理请求。这个函数接收两个参数：请求对象和响应对象。createServer() 返回的还是 http.Server 的实例，方便链式调用。这个例子中，在 createServer() 之后直接调用了 http.Server 的 listen() 方法，监听3000端口。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;http.Server 是 http 模块中的 HTTP 服务器对象。它继承自 EventEmitter，有用一套属于它自己的事件。最常用的当属&lt;code&gt;request&lt;/code&gt;：当客户端请求到来的时候，request 事件被触发，提供两个参数 request 和 response 给回调函数，表示请求和响应的信息。createServer(callback) 方法是Node为 request 提供的一个快捷方法，其功能是创建一个 HTTP 服务器并将 callback 作为 reuqest 事件的监听函数，就想上面的例子一样。如果要显示的使用 request 事件来实现，其实就是这么回事：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var http=require(&amp;quot;http&amp;quot;),
    server=new http.Server();

server.on(&amp;quot;request&amp;quot;, function(request,response){
    response.writeHead(200,{
        &amp;quot;Content-Type&amp;quot;:&amp;quot;text/html&amp;quot;
	});
    response.write(&amp;quot;&amp;lt;h1&amp;gt;Hello, CrispElite&amp;lt;/h1&amp;gt;&amp;quot;);
    response.end(&amp;quot;&amp;lt;p&amp;gt;Bye bye!&amp;lt;/p&amp;gt;&amp;quot;);
});
server.listen(3000);

console.log(&amp;quot;你的服务器已经启动！&amp;quot;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###http.ServerResponse
http.ServerResponse 是服务器返回给客户端的信息。一个由HTTP服务器内部创建的对象（不是由用户创建）。它将作为第二个参数传递到前面所说的 ‘request’ 事件的监听器中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;http.ServerResponse 有很多方法，具体请戳&lt;a href=&quot;http://nodejs.org/api/http.html#http_response_writecontinue&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;，其中有几个比较重要的成员函数。
####response.writeHead(statusCode, [header])
向请求的客户端发送响应头。这个函数在一个请求中最多只能调用一次，如果不调用则会自动生成一个响应头。注意，必须在调用 end()之前调用。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;    var body = &amp;#39;hello world&amp;#39;;
    response.writeHead(200, {
        &amp;#39;Content-Length&amp;#39;: body.length,
        &amp;#39;Content-Type&amp;#39;: &amp;#39;text/plain&amp;#39;
    });&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;要注意的是，Content-Length 以字节为单位而不是字符。上面的例子能够工作，是因为字符串 ‘hello world’ 只包含单字节字符。如果报文主体内包含高位数的编码字符，然后就要使用Buffer.byteLength（）来确定在给定编码格式下的字节数。&lt;a href=&quot;http://nodejs.org/api/http.html#http_response_writecontinue&quot; class=&quot;link-underline&quot;&gt;原文&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;####response.write(data, [encoding])
向请求的客户端发送响应内容。data 可以是一个 Buffer 或者字符串，表示要发送的内容，如果是字符串则需指定 encoding，默认是 utf-8。在 response.end() 调用之前，可以多次调用 write()。第一次调用 write() 时，它将发送缓冲的报头信息和第一个报文主体到客户端。当 write() 第二次被调用时，Node会假设你将要使用流数据，然后自动将响应内容分开发送。也就是说，响应被缓存到报文主体的第一块中。&lt;a href=&quot;http://nodejs.org/api/http.html#http_response_write_chunk_encoding&quot; class=&quot;link-underline&quot;&gt;原文&lt;/a&gt;。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;Returns true if the entire data was flushed successfully to the kernel buffer. Returns false if all or part of the data was queued in user memory. ‘drain’ will be emitted when the buffer is again free.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;####response.end([data], [encoding])
用于结束响应，通知客户端所有的发送已经完成。接收两个可选参数，意义和 write() 方法相同。这个函数在一个请求中必须被调用一次，如果不调用客户端将永远处于等待状态。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;http.ServerResponse 也继承了 EventEmitter ，在官方的API文档中，目前（2015/05/13）只提供了两个事件：close和finish。
####Event:‘close’
表明在 ServerResponse 的 end 方法被调用或者刷新之前，相关的连接已经被终止。
####Event:‘finish’
当响应信息已经成功发送之后触发 finish 事件。更具体一点来说，当响应的报文头和报文体的最后一个分段被移交到操作系统用于网络传输时被触发。&lt;a href=&quot;http://nodejs.org/api/http.html#http_event_close_1&quot; class=&quot;link-underline&quot;&gt;原文&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##HTTP客户端&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;http模块提供了两个函数 &lt;code&gt;http.request&lt;/code&gt;，&lt;code&gt;http.get&lt;/code&gt;，其作用是作为客户端向HTTP服务器发起请求。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###http.request(options, callback)
发起HTTP请求，接受两个参数。options可以是一个对象或一个字符串。如果options是一个字符串, 它将自动使用url.parse()解析；callback是请求的回调函数。
options的常用参数如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;host：请求发送到的服务器的域名或IP地址。默认为’localhost’。&lt;/li&gt;
&lt;li&gt;hostname：用于支持url.parse()。hostname比host更好一些&lt;/li&gt;
&lt;li&gt;port：远程服务器的端口。默认值为80。&lt;/li&gt;
&lt;li&gt;method：指定HTTP请求方法的字符串。默认为’GET’。&lt;/li&gt;
&lt;li&gt;path：请求路径。默认为’/‘。如果有查询字符串，则需要包含。例如’/index.html?page=12’。&lt;/li&gt;
&lt;li&gt;headers：包含请求头的对象。&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- http.request() 返回一个 http.ClientRequest的实例，这个实例是一个可写的流。如果想使用 &quot;POST&quot; 请求上传一个文件 --&gt;
&lt;p class=&quot;para&quot;&gt;使用 http.request() 时，必须调用 response.end()，以此来向服务器表明请求结束，即使请求的主体中没有任何数据。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###http.get(options, callback)
因为大部分请求都是没有主体的GET请求，所以 Node 提供了这个方便的方法。它与 http.request() 唯一的区别就是自动将请求设为GET请求，同时自动调用 response.end()。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;http.get(&amp;quot;http://www.google.com/index.html&amp;quot;, function(res) {
    console.log(&amp;quot;Got response: &amp;quot; + res.statusCode);
}).on(&amp;#39;error&amp;#39;, function(e) {
    console.log(&amp;quot;Got error: &amp;quot; + e.message);
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###http.ClientRequest
http.ClientRequest 是 Node 内建的一个对象，调用 http.request() 和 http.get() 返回的就是这个对象。它表示一个已经产生并且正在进行的 HTTP 请求。它提供了一个 response 事件，当响应头被接收的时候，会在请求的对象上触发。http.request() 和 http.get() 第二个参数指定的回调函数的绑定对象就是它了。http.ClientRequest 和 http.ServerResponse 一样提供了 write() 和 end() 用于向服务器发送请求体。所有的写结束后必须调用 end() 通知服务器。更多详细信息请戳&lt;a href=&quot;http://nodejs.org/api/http.html#http_class_http_clientrequest&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;关于 Node 中的 HTTP 模块肯定不止上面说到的这些，上面所讲到的只是一些常用的内容，通常用来处理简单的内容。如果想构建复杂的，全面的 Web 服务器，远远不够。当需要的时候多翻翻&lt;a href=&quot;http://nodejs.org/api/http.html&quot; class=&quot;link-underline&quot;&gt;手册&lt;/a&gt;，熟能生巧~&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Node学习笔记-Nodejs中的核心API之Events]]></title><description><![CDATA[最近正在学习Node，在图书馆借了基本关于Node的书，同时在网上查阅资料，颇有收获，但是整体感觉对Node的理解还是停留在一个很模棱两可的状态。比如Node中的模块，平时练习就接触到那么几个，其他的一些模块暂时只会在学习的时候接触到，不常用便就荒废了。正所谓好记心不如烂笔头，…]]></description><link>https://zhanglun.github.io/blogs/Node学习笔记-Node.js核心API之Events/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/Node学习笔记-Node.js核心API之Events/</guid><pubDate>Mon, 12 May 2014 19:40:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;最近正在学习Node，在图书馆借了基本关于Node的书，同时在网上查阅资料，颇有收获，但是整体感觉对Node的理解还是停留在一个很模棱两可的状态。比如Node中的模块，平时练习就接触到那么几个，其他的一些模块暂时只会在学习的时候接触到，不常用便就荒废了。正所谓好记心不如烂笔头，多做笔记还是更有利于理解和记忆。自己做的总结也方便回头复习，所以决定踏上漫长的修炼之旅……&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;Node提供了许多API，其中一些比较重要。这些核心的API是所有Node应用的支柱，你会不停的用到他们。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##Events&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;几乎所有的模块都是建立在Event模块的基础上诞生的，而Event模块只提供了一个对象：events.EventEmitter，其核心功能就是事件发射和事件监听功能的封装。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###EventEmitter
Node创建了一个EventEmitter类提供基础的事件功能，所有的Node的事件功能都围绕着EventEmitter，因为它的设计包含了其他类拓展所需要的接口类。EventEmitter的每一个事件由一个事件名和若干个参数组成，事件名是一个字符串，通常表达一定的语义。每一个事件都支持若干个事件监听器。当事件发射时，注册的事件监听器一次被调用，同时参数作为回调函数的参数传递要注意，通常不会直接调用EventEmitter对象，我们可以通过 require(‘events’).EventEmitter 获取 EventEmitter 类。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;EventEmitter提供了一系列的方法，最主要的两个方法是&lt;code&gt;on&lt;/code&gt;和&lt;code&gt;emit&lt;/code&gt;，这些方法供其它类使用。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;####使用on方法监听事件
on方法接受两个参数：需要监听的事件的名称和事件触发时需要调用的函数。因为EventEmitter是接口，所以从EventEmitter继承的类需要用&lt;code&gt;new&lt;/code&gt;关键字来构造。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//创建一个新的类支持EventEmitter事件
var util = require(&amp;quot;util&amp;quot;),
    EventEmitter = require(&amp;quot;events&amp;quot;).EventEmitter;
    
var Server = function(){
    console.log(&amp;quot;init&amp;quot;);
};

util.inherits(Server, EventEmitter);

var s = new Server();

s.on(&amp;quot;eventName&amp;quot;, function(){
    console.log(&amp;quot;eventName : abc&amp;quot;);
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在这个例子中，我们先包含了util模块。以便调用它的inherits方法。inherits能够将EventEmitter类的方法添加到创建的Server类中（有关utils模块的介绍日后补上），也就是说这样一来所有的Server的新实例都能够使用EventEmitter的方法。然后我们包含了Events模块。但是我们只是想调用其中的EventEmitter类，然后将它的方法绑定到要用的Server类上。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Server的实例能够访问EventEmitter的方法，也就是说我们可以调用on方法为这个实例添加事件监听器。到目前为止，我们添加的事件监听器还不会被调用，因为并没有一个叫做“eventName”的事件被触发。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;####使用emit方法触发事件&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;s.emit(&amp;quot;eventName&amp;quot;,a,b,c);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;触发事件监听器很简单，只要调用emit方法就可以了。要注意的是，这些事件只是针对某一个实例的，并不存在全局的事件。但你调用on方法的时候，需要将其绑定在特定的基于EventEmitter的对象上（继承自EventEmitter的对象）。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;调用emit方法时，除了第一个参数是事件的名称外，你可以传入任意数目的参数。这些参数都将传递给该监听事件的函数。比如从HTTP服务器接收到request请求的时候，你会接受到两个参数：req和res。当request事件被触发时，这些参数会作为第二个和第三个参数传给emit函数。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##回调函数&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;前面说到的，当事件触发时，emit方法中的第二个参数之后的所有参数都会传递给on方法中的回调函数。那前面的例子来说，emit方法中的参数&lt;code&gt;a,b,c&lt;/code&gt;将会作为参数传递给on方法中的毁掉函数&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;em&gt;emitter&lt;/em&gt;  中的内容：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt; // write by 张小伦爱学习
 
var util = require(&amp;quot;util&amp;quot;),
    EventEmitter = require(&amp;quot;events&amp;quot;).EventEmitter;
    
var Server = function(){
    console.log(&amp;quot;init&amp;quot;);
};

util.inherits(Server, EventEmitter);

var s = new Server();

s.on(&amp;quot;eventName&amp;quot;, function(para1,para2,para3){
    console.log(&amp;quot;eventName : abc&amp;quot;);
    console.log(&amp;quot;para1 : &amp;quot;+para1);
    console.log(&amp;quot;para2 : &amp;quot;+para2);
    console.log(&amp;quot;para3 : &amp;quot;+para3);
});

s.emit(&amp;quot;eventName&amp;quot;,&amp;quot;a&amp;quot;,&amp;quot;b&amp;quot;,&amp;quot;c&amp;quot;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;em&gt;输出结果&lt;/em&gt; ：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;init                //创建一个Server实例
eventName : abc     //on方法中的回调函数
para1 : a
para2 : b
para3 : c&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###更多方法&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;emitter.once(event, listener)&lt;/strong&gt;&lt;br&gt;
添加一个 一次性监听器，这个监听器只会在下一次事件发生时被触发一次，触发完成后就被删除。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;emitter.addListener(event, listener)&lt;/strong&gt;
添加一个监听器至特定事件的监听器数组尾部，和on方法一样，但是on方法没有与之对应的removeListener方法。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;emitter.removeListener(event, listener)&lt;/strong&gt;
从一个事件的监听器数组中删除一个监听器注意：此操作会改变监听器 数组中当前监听器后的所有 监听器在的下标。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;关于addListener和removeListener，可以结合一下DOM中的addEventListener和removeEventListener方法来理解。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;更多详细的介绍请看&lt;a href=&quot;http://nodejs.org/api/events.html#events_events&quot; class=&quot;link-underline&quot;&gt;这里&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###结束语
最近在github上fork了若干个国外的开源项目，比较小巧的项目。但是遇到了障碍，语言不通啊！！！！！！英语太菜啊！！！！！！光看得懂文档有毛线用啊！！！！！要理解思维方式啊！！！&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;默默努力吧，加油！&lt;/p&gt;</content:encoded></item><item><title><![CDATA[学习sass时了解到的一些好玩特性]]></title><description><![CDATA[很久很久以前，我根据网上的博文总结写了一篇博客《sass基本语法》。在那之后平时虽然不太用到sass（因为没项目做，只能自己写着玩玩），但是也还一直在试着使用sass，提高熟练度。现在写写在学习过程中的总结。 众所周知，sass 是众多CSS预处理器中的一员，基于ruby语言开…]]></description><link>https://zhanglun.github.io/blogs/学习sass时了解到的一些好玩特性/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/学习sass时了解到的一些好玩特性/</guid><pubDate>Thu, 08 May 2014 21:34:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;很久很久以前，我根据网上的博文总结写了一篇博客&lt;a href=&quot;http://zhanglun.github.io/2014/03/10/sass%E8%AF%AD%E6%B3%95/&quot; class=&quot;link-underline&quot;&gt;《sass基本语法》&lt;/a&gt;。在那之后平时虽然不太用到sass（因为没项目做，只能自己写着玩玩），但是也还一直在试着使用sass，提高熟练度。现在写写在学习过程中的总结。&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;众所周知，&lt;strong&gt;&lt;a href=&quot;http://sass-lang.com/&quot; class=&quot;link-underline&quot;&gt;sass&lt;/a&gt;&lt;/strong&gt; 是众多CSS预处理器中的一员，基于ruby语言开发的。它可以使用变量，嵌套，混入，继承，运算，函数等编程语言具有的特性进行CSS的开发，使得CSS的开发变得简单粗暴清晰可维护。相比书写CSS文件，书写sass多了很多不曾有过的快感。前面的提到的那些CSS没有的特性，灵活运用之后，可能会让你大吃一惊。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###计算布局&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;sass允许我们在书写过程中使用“加减乘除”运算，我们可以这样写 &lt;code&gt;width:$page_width*0.1&lt;/code&gt;，width的值将不再是硬编码的一个固定的数值，而是变量$page_width中定义的值的0.1倍。当编译成CSS文件时，width会输出一个确定的值。比如说我们定义一个页面的内容区域宽度为&lt;code&gt;500px&lt;/code&gt;，然后我们可以以这个宽度为基础，用一定的比例来设置侧边栏的宽度:$page_width*0.2。当我们想修改页面内容区域的宽度的时候，侧边栏会按照设定的比例变化而不用手动修改。要注意的是，如果使用不同单位进行运算，sass会试着编译，如果没有编译成功便会输出error。比如：你不能用20px和2em相加，这没有意义。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//使用加减乘除标准运算，定义变量
$width: 10px;
$double_width: $width * 2;
$half_width: $width / 2;
$width_plus_2: $width + 2;
$width_minus_2: $width - 2;

//在行间使用计算式
$width: 500px;
$sidebar_percent: 0.2;
#page {
    width: $width;
    #sidebar {
        width: $width * $sidebar_percent;
    }
    #content {
        width: $width * (1 - $sidebar_percent);
    }
}
//编译输出
#page {
    width: 500px;
}
#page #sidebar {
    width: 100px;
}
#page #content {
    width: 400px;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###使用高级方法设置颜色&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果我们想修改颜色，比如提供亮度，增加饱和度，我们要打开调色盘，然后选中找到你想要的颜色，然后找到对应的颜色代码，复制，粘贴……而sass通过添加一些函数让整个过程变得简单轻松。下面是sass中常用的颜色函数&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;Lighten/Darken函数，修改亮度&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;#page{
    color:lighten(#336699,20%);
}
//编译后的CSS
#page{
    color:#6699cc;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;Saturate/Desaturate函数，修改饱和度&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$main_color:#336699;
#page{
    color:saturate($main_color,30%);
}
//编译后的CSS
#page{
    color:#1466b8;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;adjust-hue函数，修改色度&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$main_color:#336699;
#page{
    color:adjust-hue($main_color,180);
}
#page{
    color:adjust-hue(desaturate($main_color,10%),90);
}

//编译之后的CSS
#page {
    color: #996633;
}

#page {
    color: #8f3d8f; 
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;grayscale函数，100%\降低饱和度，这个方法与下面代码是一样的效果。&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;desaturate(#336699,100%);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;Mix函数，混合颜色&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;#page{
    color:mix(#336699,#993266);
}
//编译后的CSS
#page {
    color: #664c7f;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;有了这些，颜色方案再怎么改也不怕了！！&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###导入其他sass文件&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在开发的过程中，将一个大样式表拆分成若干个小的样式表对网页的性能的影响不言而喻。如果一个简单的页面去包含了五六个样式表，这会严重影响到页面的加载速度。 通过&amp;#x3C;@import “filename”&gt;可以将很多文件转换成一个文件。这样一来，开发过程中，将模块拆分开方便开发，而最终还是只有一个样式表被引用到页面中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;注意，使用&lt;code&gt;@import&lt;/code&gt;引入其他文件时，如果不希望引入的文件也生成CSS文件，只要将引入的文件名前面加上一个下划线。在main.scss中colors.scss引入之后会编译生成mian.css和colors.css两个文件。将colors.scss文件名改成“_color.scss”，main.scss中依旧是“@import “colors”;”（不用加上文件名前面的下划线），然后重新编译，便不会输出colors.css文件。切记切记。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###创建一个字体库&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在普通的CSS文件中，我们通常这样定义字体：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;font-family: &amp;quot;helvetica neue&amp;quot;, arial, helvetica, freesans,&amp;quot;liberation sans&amp;quot;, &amp;quot;numbus sans l&amp;quot;, sans-serif;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;我们必须按照我们顺序列出我们需要的字体。如果我们想在页面中切换使用的字体，我们要从这里复制，粘贴到那里……现在我们有简单的方法了。可以在页面的顶部定义变量，使用变量代替那些冗长的字体名。当你想使用这些字体时，只需使用事先定义好的变量。为了方便管理，可以将默认的字体的定义放在文件的头部，或者单独写在一个文件中，使用&lt;code&gt;@import&lt;/code&gt;引入。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###使用@extend保持语义化&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;保持语义化是一门哲学，使得事物合乎逻辑。我们根据功能取名字而不是样式，比如：不会使用&lt;code&gt;.bule_button&lt;/code&gt;，而是使用&lt;code&gt;.checkout_button&lt;/code&gt;，后者远比前者有用。如果你写了一些属性制作一个蓝色按钮，需要将他们应用到很多不同功能的按钮上，你会怎么做？难道一遍遍的复制，粘贴吗？sass中的&lt;code&gt;@extend&lt;/code&gt;可以从class或者ID中复制属性和属性值，然后将它们添加到另一个class或者ID的属性列中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;首先要去确保在别处已经定义了class：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.blue_button {
    background: #336699;
    font-weight: bold;
    color: white;
    padding: 5px; 
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;然后可以将其拓展到其他的class或者ID：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;.checkout_button {
    @extend .blue_button     
}
//编译后的CSS
.blue_button, .checkout_button {
    background: #336699;
    font-weight: bold;
    color: white;
    padding: 5px; 
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;你会注意到输出的CSS有两个选择器。&lt;code&gt;@extend&lt;/code&gt;所做的是合并所有的属性和属性值，同时也会合并拓展的对象和自身的class或者ID。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###使用@mixin保持代码的整洁&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;利用mixin可以将一部分CSS从代码中抽出，定义成一个模块重复使用。可以在公用的样式中定义一个mixin模块，需要的时候直接调用就好了。同时，mixin还可以传递参数。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;使用&lt;code&gt;@mixin&lt;/code&gt;定义一个mixin模块，后面紧接着mixin的名，可以传递参数，同时给参数设定一个默认值。 但是要注意，参数也是要用$开始，而且参数名和参数值是用&lt;strong&gt;冒号&lt;/strong&gt;分开。如果一个属性有多个值，比如box-shadow等，那参数就用变量名加上三个点表示” &lt;strong&gt;$variable…&lt;/strong&gt; ” 。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//声明一个mixin模块
//boxRect
@mixin boxRect($W:20px,$H:20px){
	width:$W;
	height:$H;
}
//box-shadow
@mixin shadow($shadow...){
	-webkit-box-shadow:$shadow;
	-moz-box-shadow:$shadow;
	-o-box-shadow:$shadow;
	box-shadow:$shadow;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;定义了mixin模块之后，使用&lt;code&gt;@include&lt;/code&gt;。mixins也能够帮助保持代码的语义化；。可以定义一个&lt;code&gt;blue_text&lt;/code&gt;模块，然后把它应用到更加语义化的class或者ID中，比如&lt;code&gt;product_title&lt;/code&gt;。通过&lt;code&gt;@import&lt;/code&gt;将mixin模块引入主文件中，很好地分割样式表，保持主样式表的整洁。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//定义一个模块
@mixin blue_text {
    color: #336699;
    font-family: helvetica, arial, sans-serif;
    font-size: 20px;
    font-variant: small-caps; 
}
//使用模块
.product_title {
    @include blue_text;     
}
//编译后的CSS
.product_title {
    color: #336699;
    font-family: helvetica, arial, sans-serif;
    font-size: 20px;
    font-variant: small-caps; 
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###利用mixin创建动态的属性名和选择器&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;用&lt;code&gt;#{}&lt;/code&gt;包裹住变量名就可以了！！！！！！&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;@mixin car_make($car_make, $car_color) {
// 用$car_make动态生成以&amp;quot;_make&amp;quot;结尾的class
    .car.#{$car_make}_make {
        color: $car_color;
        width: 100px;
        .image {
            background:url(&amp;quot;images/#{$car_make}/#{$car_color}.png&amp;quot;);
        }
    }
}
@include car_make(&amp;quot;volvo&amp;quot;, &amp;quot;green&amp;quot;);
@include car_make(&amp;quot;corvette&amp;quot;, &amp;quot;red&amp;quot; );
@include car_make(&amp;quot;bmw&amp;quot;, &amp;quot;black&amp;quot;);
//编译后的CSS
.car.volvo_make {
    color: &amp;quot;green&amp;quot;;
    width: 100px; 
}
.car.volvo_make .image {
    background: url(&amp;quot;images/volvo/green.png&amp;quot;); }
.car.corvette_make {
    color: &amp;quot;red&amp;quot;;
    width: 100px; 
}
.car.corvette_make .image {
    background: url(&amp;quot;images/corvette/red.png&amp;quot;);              
}
.car.bmw_make {
    color: &amp;quot;black&amp;quot;;
    width: 100px; 
}
.car.bmw_make .image {
    background: url(&amp;quot;images/bmw/black.png&amp;quot;); 
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###使用@each为不同变量复制相同的样式&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;假设有很多url相似的图片，我们需要用图片的名字作为class的一部分引用图片。通常我们要分开书写每一个选择器，复制，粘贴……使用@each可以解决这个问题。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在&lt;code&gt;@each&lt;/code&gt;后面接着形参，然后是我们想使用的变量，即实参。参数要用&lt;code&gt;#{}&lt;/code&gt;包裹。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;@each $member in thom, jonny, colin, phil {
    .#{$member}_picture {
        background-image: url(&amp;quot;/image/#{$member}.jpg&amp;quot;); 
    }
}
//编译后的CSS
.thom_picture {
    background-image: url(&amp;quot;/image/thom.jpg&amp;quot;); 
}
.jonny_picture {
    background-image: url(&amp;quot;/image/jonny.jpg&amp;quot;);     
}
.colin_picture {
    background-image: url(&amp;quot;/image/colin.jpg&amp;quot;); 
}
.phil_picture {
    background-image: url(&amp;quot;/image/phil.jpg&amp;quot;); 
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###使用@if让mixin模块更灵活&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;通常书写一个模块的目的是想跨项目使用，希望可以对传入的参数作出反应。比如有一个mixin模块&lt;code&gt;width&lt;/code&gt;，当一个参数是一个比0小的数字是，希望他不做任何事情。在很多时候，我们都希望自己的模块可以根据参数做出灵活的处理。而&lt;code&gt;@if&lt;/code&gt;可以帮我们做到。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//使用@if创建一个mixin模块
@mixin country_color($country) {
    @if $country == france {
        color: blue; 
    }
    @else if $country == spain {
        color: yellow; 
    }
    @else if $country == italy {
        color: green; 
    }
    @else {
        color: red; 
    }
}
.england {
    @include country_color(england); 
}
.france {
    @include country_color(france); 
}
//编译后的CSS
.england {
    color: red; 
}
.france {
    color: blue;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;未完待续……&lt;/p&gt;
&lt;/blockquote&gt;</content:encoded></item><item><title><![CDATA[【译】Node.js的 EventEmitter 教程]]></title><description><![CDATA[原文标题：Node.js EventEmitter Tutorial 原文链接：http://www.hacksparrow.com/node-js-eventemitter-tutorial.html 听说过 Node.js 中的 EventEmitter 吗？也许你知道大部…]]></description><link>https://zhanglun.github.io/blogs/(译)node.js 的 eventemitter 教程/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/(译)node.js 的 eventemitter 教程/</guid><pubDate>Mon, 05 May 2014 21:23:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;原文标题：Node.js EventEmitter Tutorial&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;原文链接：&lt;a href=&quot;http://www.hacksparrow.com/node-js-eventemitter-tutorial.html&quot; class=&quot;link-underline&quot;&gt;http://www.hacksparrow.com/node-js-eventemitter-tutorial.html&lt;/a&gt;&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;听说过 Node.js 中的 &lt;code&gt;EventEmitter&lt;/code&gt; 吗？也许你知道大部分内置的 Node.js 库 都使用它，也许你总是对 &lt;code&gt;EventEmitter&lt;/code&gt; 充满好奇，但是没有谁向你解释？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在这个教程中，我会给你一些关于 &lt;code&gt;EventEmitter&lt;/code&gt; 类的例子。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你必须熟悉各种 Node.js 中的事件比如： &lt;code&gt;on data&lt;/code&gt; ， &lt;code&gt;on end&lt;/code&gt; ， &lt;code&gt;on error&lt;/code&gt; 等等之类的。事件机制的工作做得天衣无缝，十分完美，难道不是吗？所有的基于事件的 Node.js 库都依赖于 &lt;code&gt;EventEmitter&lt;/code&gt; 类，你可能会说那些库都继承了 &lt;code&gt;EventEmitter&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;EventEmitter&lt;/code&gt; 的强大之处不仅限于内置的 Node.js 库，你也可以拥有它！&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;展示 &lt;code&gt;EventEmitter&lt;/code&gt; 能力的最好方法就是通过一个例子，看看这个：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var EventEmitter = require(&amp;#39;events&amp;#39;).EventEmitter;
var radium = new EventEmitter();

//绑定 radiation 事件
radium.on(&amp;#39;radiation&amp;#39;, function(ray) {
    console.log(ray);
});

setInterval(function() {
    //触发 radiation 事件
    radium.emit(&amp;#39;radiation&amp;#39;, &amp;#39;GAMMA&amp;#39;);
}, 1000);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;注意到了吧，创建一个事件，添加一个事件监听器，触发事件，通过事件传递数据是多么的简单。所有的这些因为 &lt;code&gt;EventEmitter&lt;/code&gt; 的魔力而实现。 &lt;code&gt;EventEmitter&lt;/code&gt; 让编写令人惊讶的 Node.js 库变得可能。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;上面的例子基于一个 &lt;code&gt;EventEmitter&lt;/code&gt; 的实例，我们怎么做才能创建一个继承自 &lt;code&gt;EventEmitter&lt;/code&gt; 的类呢？Node.js 有一个，叫做 &lt;code&gt;util&lt;/code&gt; 的库，它有一个方法： &lt;code&gt;inherits&lt;/code&gt;，实现对象之间原型继承的函数。我们可以很轻松的通过它让一个类继承另一个类（准确的说不能叫类）：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var util = require(&amp;#39;util&amp;#39;);
util.inherits(MyClass, SuperClass);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;使用 &lt;code&gt;util.inherits()&lt;/code&gt; ，我们创建了一个继承自 &lt;code&gt;EventEmitter&lt;/code&gt; 的模块，注意下面的代码：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;em&gt;radio.js&lt;/em&gt; 中的内容：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var util = require(&amp;#39;util&amp;#39;);
var EventEmitter = require(&amp;#39;events&amp;#39;).EventEmitter;

//一个包含 &amp;quot;freq&amp;quot; 和 &amp;quot;name&amp;quot; 属性的对象
var Radio = function(station) {
    //保存 指向Radio的this，在setTimeout()中使用
    var self = this;
    
    setTimeout(function() {
        self.emit(&amp;#39;open&amp;#39;, station);
    }, 0);
    
    setTimeout(function() {
        self.emit(&amp;#39;close&amp;#39;, station);
    }, 5000);
    
    this.on(&amp;#39;newListener&amp;#39;, function(listener) {
        console.log(&amp;#39;Event Listener: &amp;#39; + listener);
    });
    
};

//Radio 继承 EventEmitter
util.inherits(Radio, EventEmitter);
module.exports = Radio;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;我们创建了一个继承自 &lt;code&gt;EventEmitter&lt;/code&gt; 的模块。接下来让我们看看如何在一个例子中使用创建的模块。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;em&gt;example.js&lt;/em&gt; 中的内容：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var Radio = require(&amp;#39;./radio.js&amp;#39;);

var station = {
    freq: &amp;#39;80.16&amp;#39;,
    name: &amp;#39;Rock N Roll Radio&amp;#39;,
};
// 创建一个Radio实例
var radio = new Radio(station);

//添加一个“open”事件监听器
radio.on(&amp;#39;open&amp;#39;, function(station) {
    console.log(&amp;#39;&amp;quot;%s&amp;quot; FM %s OPENED&amp;#39;, station.name, station.freq);
    console.log(&amp;#39;? ??&amp;#39;);
});

//添加一个“close”事件监听器
radio.on(&amp;#39;close&amp;#39;, function(station) {
    console.log(&amp;#39;&amp;quot;%s&amp;quot; FM %s CLOSED&amp;#39;, station.name, station.freq);
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;运行 example.js 准备好见证 &lt;code&gt;EventEmitter&lt;/code&gt; 的魔力。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果因为某些原因你不想使用 &lt;code&gt;util&lt;/code&gt; 模块，你可以用这种方法来拓展一个类。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Apple.prototype = Object.create(require(&amp;#39;events&amp;#39;).EventEmitter.prototype);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;code&gt;EventEmitter&lt;/code&gt; 可以帮你编写令人印象深刻的基于事件的 Node.js 模块。同时，作为作为一个 Node.js 的开发人员，你掌握的关于&lt;code&gt;EventEmitter&lt;/code&gt;的知识会大大影响你的工作效率。所以，确保你阅读了&lt;a href=&quot;http://nodejs.org/api/events.html#events_class_events_eventemitter&quot; class=&quot;link-underline&quot;&gt;关于 &lt;code&gt;EventEmitter&lt;/code&gt; 的更详细的资料&lt;/a&gt;，并且掌握里里外外它是如何工作的。如果你不了解&lt;code&gt;EventEmitter&lt;/code&gt;，那你也不了解 Nodejs.js&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;(完)&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;翻译水平有待提高，所翻译的博文并不是按照原文一句一句翻译，而是添加了自己对文章的理解。如有不正之处，欢迎指正！&lt;/strong&gt;
&lt;strong&gt;个人笔记，仅供参考。&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;参考:&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;http://www.hacksparrow.com/node-js-eventemitter-tutorial.html&quot; class=&quot;link-underline&quot;&gt;http://www.hacksparrow.com/node-js-eventemitter-tutorial.html
&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[【译】Node.js的全局变量]]></title><description><![CDATA[原文标题：Global Variables in Node.js 原文链接：http://www.hacksparrow.com/global-variables-in-node-js.html
 你可能正在使用一些 Node.js 的模块，或者一个框架比如 Express.…]]></description><link>https://zhanglun.github.io/blogs/(译)node.js的全局变量/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/(译)node.js的全局变量/</guid><pubDate>Mon, 28 Apr 2014 19:36:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;原文标题：Global Variables in Node.js&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;原文链接：&lt;a href=&quot;http://www.hacksparrow.com/global-variables-in-node-js.html&quot; class=&quot;link-underline&quot;&gt;http://www.hacksparrow.com/global-variables-in-node-js.html
&lt;/a&gt;&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;你可能正在使用一些 Node.js 的模块，或者一个框架比如 &lt;code&gt;Express.js&lt;/code&gt; ，并且突然感觉你需要创建一些全局变量。在 Node.js 中你会如何创建全局变量？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在这个问题上，大多数的建议是“不使用 &lt;code&gt;var&lt;/code&gt; 声明变量”，或者是“把变量添加到 &lt;code&gt;global&lt;/code&gt; 对象上”，亦或者是“将变量添加到 &lt;code&gt;GLOBAL&lt;/code&gt; 对象上”。你选择哪一个？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;首先，让我们来分析一下这个&lt;code&gt;global&lt;/code&gt; 对象。打开一个终端，切换到 &lt;code&gt;Node REPL (prompt)&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ node
&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;输入”global”，看看这个对象到底有些什么。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;gt; global&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;我的天啊（原文：Holy mother of Flying Spaghetti Monster!!!）！这是一个庞大的对象！实际上，你看到了 Node.js 的灵魂。在一个 Node.js 的进程中，所有的其他对象都是依附在 &lt;code&gt;global&lt;/code&gt; 对象上。如果你熟悉浏览器中的 JavaScript 环境，&lt;code&gt;global&lt;/code&gt; 对象和 &lt;code&gt;Window&lt;/code&gt; 对象相似。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;现在我们知道了 &lt;code&gt;global&lt;/code&gt; 对象是什么，现在让我们来玩弄它：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;gt; global.name
undefined
&amp;gt; global.name = &amp;#39;El Capitan&amp;#39;
&amp;gt; global.name
&amp;#39;El Capitan&amp;#39;
&amp;gt; GLOBAL.name
&amp;#39;El Capitan&amp;#39;
&amp;gt; delete global.name
true
&amp;gt; GLOBAL.name
undefined
&amp;gt; name = &amp;#39;El Capitan&amp;#39;
&amp;#39;El Capitan&amp;#39;
&amp;gt; global.name
&amp;#39;El Capitan&amp;#39;
&amp;gt; GLOBAL.name
&amp;#39;El Capitan&amp;#39;
&amp;gt; var name = &amp;#39;Sparrow&amp;#39;
undefined
&amp;gt; global.name&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;有趣的观察！（Interesting observations!）&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;看起来似乎 &lt;code&gt;global&lt;/code&gt; 和 &lt;code&gt;GLOBAL&lt;/code&gt; 是同一个东西。实际上，&lt;code&gt;GLOBAL&lt;/code&gt; 是 &lt;code&gt;global&lt;/code&gt; 的一个别名。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;更让人惊讶的是：无论是使用 &lt;code&gt;var&lt;/code&gt; 声明的变量还是未使用 &lt;code&gt;var&lt;/code&gt; 声明的变量都添加到了 &amp;#x3C;code&lt;code&gt;global&lt;/code&gt; 对象&gt;global&lt;/code&gt; 对象上。在 Node.js 中，不使用 &lt;code&gt;var&lt;/code&gt; 关键字声明变量是一种创建全局变量的基本的方法。这种方法在模块中的实现稍微有些不同，接下来我会解释。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当你创建了一个 Node.js 进程，在这个进程中的所有模块都分享同一个  &lt;code&gt;global&lt;/code&gt; 对象。结合上面的观察，你对 &lt;code&gt;global&lt;/code&gt; 对象的工作方式有一定的理解。然而，有一点不同之处在于，在你创建的模块中，使用 &lt;code&gt;var&lt;/code&gt; 关键字声明的变量只属于这个模块，属于局部变量。那些未使用 &lt;code&gt;var&lt;/code&gt; 关键字声明的变量则附加到 &lt;code&gt;global&lt;/code&gt; 对象上。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;所以现在你知道了：“不使用 &lt;code&gt;var&lt;/code&gt; 声明变量”，“把变量添加到 &lt;code&gt;global&lt;/code&gt; 对象上”和“将变量添加到 &lt;code&gt;GLOBAL&lt;/code&gt; 对象上”是相同的事情。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在模块中全局声明的变量可以通过它的变量名直接被任何其他的模块引用，而不用通过 &lt;code&gt;global&lt;/code&gt; 对象的引用，意味着：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;name == global.name == GLOBAL.name&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;但是这并不意味着你应该这么做。为什么？看看这个：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var company = &amp;#39;Yahoo&amp;#39;;
console.log(global.company); // &amp;#39;Google&amp;#39;
console.log(company); // &amp;#39;Yahoo&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当时使用  &lt;code&gt;gloabal.campany&lt;/code&gt; ，你知道你在处理全局变量，此外，在模块中作为局部变量使用时节约了变量名 &lt;code&gt;campany&lt;/code&gt; 。如果你打算在你的 Node.js 程序中使用全局变量，关于 &lt;code&gt;global&lt;/code&gt; 对象的方法的讨论效果很好。但是，别过度使用全局变量。说了这么多，难道还有不使用全局变量的替代解决方法？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;是的，有这么一个，并且它涉及到  &lt;code&gt;module.exports&lt;/code&gt; 的使用。让我用一个例子来证明：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;em&gt;main.js&lt;/em&gt; 中的内容：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;exports.company = &amp;#39;Google&amp;#39;;
var m = require(&amp;#39;./mod&amp;#39;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;em&gt;mod.js&lt;/em&gt; 中的内容：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var company = require(&amp;#39;./main&amp;#39;).company;
console.log(company);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;现在来看看它怎么运作的：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$ node main.js
Google&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;你拥有了一个变量，这个变量来自另一个没有使用全局对象的可使用的模块。你可以在其他的模块中引用 &lt;em&gt;main.js&lt;/em&gt; 以此来使用 变量名  &lt;code&gt;campany&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;注意：引用一个已经引用了另外一个模块的模块，只会创建一个包含前一个模块的引用，这并不意味着会严重增加内存的使用。同时，因为不存在真正的重复包含，模块中所有的初始化函数都不会重复执行一次。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;所以，结论是：在 Node.js 中有两种创建全局变量的方法，一种是使用 &lt;code&gt;global&lt;/code&gt; 对象，另一种是使用 &lt;code&gt;module.export&lt;/code&gt; 。我的建议是什么？小应用使用 &lt;code&gt;global&lt;/code&gt; 对象，大型应用使用 &lt;code&gt;module.export&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;(完)&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;翻译水平有待提高，所翻译的博文并不是按照原文一句一句翻译，而是添加了自己对文章的理解。如有不正之处，欢迎指正！&lt;/strong&gt;
&lt;strong&gt;个人笔记，仅供参考。&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;参考:&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;http://www.hacksparrow.com/global-variables-in-node-js.html&quot; class=&quot;link-underline&quot;&gt;http://www.hacksparrow.com/global-variables-in-node-js.html
&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[【译】Node.js的模块-exports和module.exports]]></title><description><![CDATA[原文标题：Node.js Module – exports vs module.exports 原文链接：http://www.hacksparrow.com/node-js-exports-vs-module-exports.html
 ##exports 和 module…]]></description><link>https://zhanglun.github.io/blogs/(译)node.js的模块- exports 和 module.exports/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/(译)node.js的模块- exports 和 module.exports/</guid><pubDate>Sat, 26 Apr 2014 19:45:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;原文标题：Node.js Module – exports vs module.exports&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;原文链接：&lt;a href=&quot;http://www.hacksparrow.com/node-js-exports-vs-module-exports.html&quot; class=&quot;link-underline&quot;&gt;http://www.hacksparrow.com/node-js-exports-vs-module-exports.html
&lt;/a&gt;&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;##exports 和 module.exports 有什么区别？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;你一定很熟悉 Node.js 模块中的用来在你的模块中创建函数的 exports 对象，就像下面这样。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;创建一个叫做 &lt;code&gt;rocker.js&lt;/code&gt; 的文件：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;exports.name = function() {
    console.log(&amp;#39;My name is Lemmy Kilmister&amp;#39;);
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;然后可以在另外一个文件中调用 &lt;code&gt;rocker.js&lt;/code&gt; :&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var rocker = require(&amp;#39;./rocker.js&amp;#39;);
rocker.name(); // &amp;#39;My name is Lemmy Kilmister&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;但是，&lt;code&gt;module.exports&lt;/code&gt; 到底什么？它是合法的吗？&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;令人吃惊的是：&lt;code&gt;module.exports&lt;/code&gt; 是真实存在的。&lt;code&gt;exports&lt;/code&gt;  只不过是 &lt;code&gt;module.exports&lt;/code&gt; 的帮手而已。你的模块直接返回返回 &lt;code&gt;module.exports&lt;/code&gt; 给调用者，而不是 &lt;code&gt;exports&lt;/code&gt; 。所有的 &lt;code&gt;exports&lt;/code&gt; 做的工作实际上是收集属性，如果 &lt;code&gt;module.exports&lt;/code&gt; 当前没有任何属性，&lt;code&gt;exports&lt;/code&gt;便将收集到的属性添加到 &lt;code&gt;module.exports&lt;/code&gt; 上。如果 &lt;code&gt;module.exports&lt;/code&gt;
已经存在若干属性，所以 &lt;code&gt; exports&lt;/code&gt; 上的属性都会被忽略。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;修改 &lt;code&gt;rocker.js&lt;/code&gt; 文件：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports = &amp;#39;ROCK IT!&amp;#39;;
exports.name = function() {
    console.log(&amp;#39;My name is Lemmy Kilmister&amp;#39;);
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在另一个文件中调用 &lt;code&gt;rocker.js&lt;/code&gt;:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var rocker = require(&amp;#39;./rocker.js&amp;#39;);
rocker.name(); // TypeError: Object ROCK IT! has no method &amp;#39;name&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;上述例子中的 &lt;code&gt;rocker&lt;/code&gt; 模块完全将 &lt;code&gt;exports.name&lt;/code&gt; 忽略了，只返回了一个 String 字符串：&lt;code&gt;‘ROCK IT!’&lt;/code&gt; 。 从这个例子你大概明白了：你的模块并不一定总是一个模块的实例(module instance)，它可以是任何合法的 JavaScript 对象——boolean, number, date, JSON, string, function, array 和其他的。你的模块可以是任何你设置的  &lt;code&gt;module.exports&lt;/code&gt; 的值。如果你没有明确地为  &lt;code&gt;module.exports&lt;/code&gt; 设置任何值，那么 &lt;code&gt;exports&lt;/code&gt; 中的属性会自动添加到 &lt;code&gt;module.exports&lt;code&gt; 中，然后并返回它。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在这种情况下，你的模块是一个类：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports = function(name, age) {
    this.name = name;
    this.age = age;
    this.about = function() {
        console.log(this.name +&amp;#39; is &amp;#39;+ this.age +&amp;#39; years old&amp;#39;);
    };
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;而你可以像这样使用：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var Rocker = require(&amp;#39;./rocker.js&amp;#39;);
var r = new Rocker(&amp;#39;Ozzy&amp;#39;, 62);
r.about(); // Ozzy is 62 years old&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在这时候你的模块是一个数组：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports = [
    &amp;#39;Lemmy Kilmister&amp;#39;, 
    &amp;#39;Ozzy Osbourne&amp;#39;, 
    &amp;#39;Ronnie James Dio&amp;#39;, 
    &amp;#39;Steven Tyler&amp;#39;, 
    &amp;#39;Mick Jagger&amp;#39;
];&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;而你可以这样使用：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var rocker = require(&amp;#39;./rocker.js&amp;#39;);
console.log(&amp;#39;Rockin in heaven: &amp;#39; + rocker[2]); //Rockin in heaven: Ronnie James Dio&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;现在你应该明白了点什么：&lt;br&gt;
如果你想让你的模块返回一个特殊的对象类型，比如构造函数，那么你得使用 module.exports ；如果你只想模块作为一个典型的模块实例（module instance），那么就用&lt;code&gt;exports&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;把属性添加到 &lt;code&gt;module.exports&lt;/code&gt; 中和添加到 &lt;code&gt;exports&lt;/code&gt; 中的结果是一样的。比如像这样：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports.name = function() {
    console.log(&amp;#39;My name is Lemmy Kilmister&amp;#39;);
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;其实和下面的是一样的：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;exports.name = function() {
    console.log(&amp;#39;My name is Lemmy Kilmister&amp;#39;);
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;但是要注意，他们不是同一个东西。就像之前说的一样，&lt;code&gt;exports&lt;/code&gt;  只不过是 &lt;code&gt;module.exports&lt;/code&gt; 的帮手而已。话虽如此，&lt;code&gt;exports&lt;/code&gt;还是推荐的对象，除非你想把你模块的对象类型从传统的模块实例（module instance）修改为其他的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;只要你没有使用赋值运算重写&lt;code&gt;module.exports&lt;/code&gt;对象，任何添加到 &lt;code&gt;module.exports&lt;/code&gt;和&lt;code&gt;exports&lt;/code&gt;的属性都能够在 &lt;code&gt;require&lt;/code&gt;模块中。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;比如这是你的模块中的内容：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports.age = 68;
exports.name = &amp;#39;Lemmy Kilmister&amp;#39;;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;下面的代码可以很好的工作：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var rocker = require(&amp;#39;./rocker.js&amp;#39;);
console.log(&amp;#39;%s is %s&amp;#39;, rocker.name, rocker.age); // Lemmy Kilmister is 68&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;但是，如果你在你的模块中重写了&lt;code&gt;module.exports&lt;/code&gt;中的任何地方，代码便会出错：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports = &amp;#39;LOL&amp;#39;;
module.exports.age = 68;
exports.name = &amp;#39;Lemmy Kilmister&amp;#39;;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;或者这样：&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;js&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports.age = 68;
exports.name = &amp;#39;Lemmy Kilmister&amp;#39;;
module.exports = &amp;#39;WTF&amp;#39;;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;顺序没有关系，&lt;code&gt;rocker.age&lt;/code&gt; 和 &lt;code&gt;rocker.name&lt;/code&gt; 将显示为 &lt;code&gt;undefined&lt;/code&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;并且注意：只是因为 &lt;code&gt;module.exports&lt;/code&gt; 和  &lt;code&gt;exports&lt;/code&gt; 都能输出模块，并不意味这你可以组合使用。我的建议是，坚持使用 &lt;code&gt;exports.*&lt;/code&gt;，明白&lt;code&gt;module.exports&lt;/code&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;我希望这篇文章能帮助你理解exports和module.exports之间的不同，并且能进一步的理解模块在Node.js中是怎么工作的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;(完)&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;翻译水平有待提高，所翻译的博文并不是按照原文一句一句翻译，而是添加了自己对文章的理解。如有不正之处，欢迎指正！&lt;/strong&gt;
&lt;strong&gt;个人笔记，仅供参考。&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;参考:&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;http://www.hacksparrow.com/node-js-exports-vs-module-exports.html&quot; class=&quot;link-underline&quot;&gt;http://www.hacksparrow.com/node-js-exports-vs-module-exports.html
&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Node学习笔记-Node.js中的模块]]></title><description><![CDATA[之前简单的了解了 Node.js 。对 Node.js  有一个简单的认识。接下来查看了 API 文档中模块有关的知识点，参照《Node.js 开发指南》，并做笔记。 模块和包是 Node.js 中最重要的支柱。经常将模块和包相提并论，因为二者之间其实没有本质上的区别，经常混用…]]></description><link>https://zhanglun.github.io/blogs/Node学习笔记-Node.js中的模块和包/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/Node学习笔记-Node.js中的模块和包/</guid><pubDate>Fri, 25 Apr 2014 19:40:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;之前简单的了解了 Node.js 。对 Node.js  有一个简单的认识。接下来查看了 API 文档中模块有关的知识点，参照《Node.js 开发指南》，并做笔记。&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;模块和包是 Node.js 中最重要的支柱。经常将模块和包相提并论，因为二者之间其实没有本质上的区别，经常混用。如果硬要作出区分的话，那么可以把包理解成：实现某个功能的众多模块的集合。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##什么是模块
模块是 Node.js 应用程序的基本组成部分。Node 有一套简单的模块加载机制。在 Node.js 中，文件和模块是一一对应的。也就是说，一个 Node.js 文件就可以看成是一个模块，所以在 Node 中创建一个模块非常简单。Node 提供了 exports 和 require 两个对象。exports 是模块公开的接口，意思就是创建模块得靠 exports；require 用于从外部获取一个模块的接口，也就是说使用模块要用 require 。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;举个例子方便了解模块： &lt;em&gt;foo.js&lt;/em&gt; 加载同目录中的模块 &lt;em&gt;circle.js&lt;/em&gt; 。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;em&gt;foo.js&lt;/em&gt; 中的内容：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var circle = require(&amp;#39;./circle.js&amp;#39;);
console.log( &amp;#39;The area of a circle of radius 4 is &amp;#39; + circle.area(4));&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;em&gt;circle.js&lt;/em&gt; 中的内容：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var PI = Math.PI;

exports.area = function (r) {
  return PI * r * r;
};

exports.circumference = function (r) {
  return 2 * PI * r;
};&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;em&gt;circle.js&lt;/em&gt; 模块通过 exports 对象输出了两个方法：area() 和 circumference()，在 &lt;em&gt;foo.js&lt;/em&gt; 中使用 require() 加载这个模块，然后便可以直接访问 exports 对象的成员函数了。反言之，如果想为自定义的模块添加属性或者方法，将它们添加到 exports 这个特殊的对象上就可以达到目的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;如果希望模块提供的接口是一个构造函数，或者输出的是一个完整的对象而不是一个属性，那么可以使用 &lt;strong&gt;module.exports&lt;/strong&gt; 代替 exports。
但是注意，exports 是 module.exports 的一个引用，只是为了用起来方便。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;下面的 &lt;em&gt;bar.js&lt;/em&gt; 使用了 square 模块，而 square 模块提供了一个构造函数的接口：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;em&gt;bar.js&lt;/em&gt; 中的内容：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var square = require(&amp;#39;./square.js&amp;#39;);
var mySquare = square(2);
console.log(&amp;#39;The area of my square is &amp;#39; + mySquare.area());&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;em&gt;square.js&lt;/em&gt; 中的内容：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;// 使用 exports 将无法创建 module,必须使用 module.exports

module.exports = function(width) {
    return {
        area: function() {
            return width * width;
        }
    };
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;使用 module.exports 可以很快得到想要的：&lt;/p&gt;
&lt;!-- ![使用 module.exports](http://cl.ly/image/1b32450A2744/download/2014-04-25_205447.png) --&gt;
&lt;p class=&quot;para&quot;&gt;而使用 exports 时：&lt;/p&gt;
&lt;!-- ![使用 exports](http://cl.ly/image/040A3H2K2g0n/download/2014-04-25_210131.png) --&gt;
&lt;p class=&quot;para&quot;&gt;(module.exports 和 exports 二者之间更具体的关系将之后补上)。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##模块的循环调用&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当存在循环的模块引用时，有的模块可能在返回时不会执行。看看这个例子：&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;em&gt;a.js&lt;/em&gt; 中的内容：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;console.log(&amp;#39;模块 a 开始了！&amp;#39;);
exports.done = false;
var b = require(&amp;#39;./b.js&amp;#39;);
console.log(&amp;#39;在 a 中, b.done = %j&amp;#39;, b.done);
exports.done = true;
console.log(&amp;#39;模块 a 结束了！&amp;#39;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;em&gt;b.js&lt;/em&gt; 中的内容：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;console.log(&amp;#39;模块 b 开始了！&amp;#39;);
exports.done = false;
var a = require(&amp;#39;./a.js&amp;#39;);
console.log(&amp;#39;在 b 中, a.done = %j&amp;#39;, a.done);
exports.done = true;
console.log(&amp;#39;模块 b 结束了！&amp;#39;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;em&gt;main.js&lt;/em&gt; 中的内容：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;console.log(&amp;#39;main 开始了！&amp;#39;);
var a = require(&amp;#39;./a.js&amp;#39;);
var b = require(&amp;#39;./b.js&amp;#39;);
console.log(&amp;#39;在 main 中, a.done=%j, b.done=%j&amp;#39;, a.done, b.done);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;当 main.js 加载 a.js 时，a.js 又加载 b.js。这个时候，b.js 又会尝试去加载 a.js 。为了防止出现无限循环的加载，a.js 中的 exports 对象会返回一个 &lt;strong&gt;unfinished copy&lt;/strong&gt; 给 b.js 模块。然后模块b完成加载，同时将提供模块a的接口。当 main.js 加载完a，b两个模块之后，输出如下：&lt;/p&gt;
&lt;!-- ![cycles](http://cl.ly/image/263z0W3W0m0G/download/2014-04-25_212142.png)   --&gt;
&lt;p class=&quot;para&quot;&gt;##模块的分类和载入
Node.js 的模块可以分成两类，一类是原生模块（核心模块），另一类是文件模块。核心模块由二进制编译而成，定义在源代码的 &lt;strong&gt;lib/&lt;/strong&gt; 目录下,加载的速度最快，比如：HTTP 模块。而文件模块我的理解就是那些可以 require 的文件，后缀可以是 .js、.json、.node。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;require() 总是会优先加载核心模块。例如，require(‘http’) 总是返回编译好的HTTP 模块，而不管是否有这个名字的文件。模块在第一次加载后会被缓存。这意味着（类似其他缓存）每次调用require(‘foo’)的时候都会返回同一个对象，当然，必须是每次都解析到同一个文件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;前面的例子中 &lt;code&gt;require(“./a.js”)&lt;/code&gt; 等，就是在加载文件模块。如果按文件名没有查找到对应的模块，那么 Node.js 会添加 .js和 .json后缀名，再尝试加载，如果还是没有找到，最后会加上 .node 的后缀名再次尝试加载。如果指定的路径不存在，require() 会抛出一个 code 属性为 &lt;strong&gt;‘MODULE_NOT_FOUND’&lt;/strong&gt; 的错误。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在 require() 没有以’/‘或者’./‘来指向一个文件时，这个模块要么是”核心模块”，要么就是从 node_modules 文件夹加载的。如果 require() 中的模块名不是一个&lt;strong&gt;本地模块(不在项目目录中)&lt;/strong&gt;，也没有以&lt;code&gt;’/’&lt;/code&gt;, &lt;code&gt;’../’&lt;/code&gt;, 或是 &lt;code&gt;’./’&lt;/code&gt; 开头，那么 Node.js 会从当前模块的父目录开始，尝试在它的 &lt;code&gt;‘/node_modules’&lt;/code&gt; 文件夹里加载相应模块。如果没有找到，那么就再向上移动到父目录，直到到达顶层目录位置。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;举个例子，如果 &lt;em&gt;foo.js&lt;/em&gt; 文件的路径是&lt;code&gt;‘E:/Code/nodejs/demo/foo.js’&lt;/code&gt;,加载 &lt;em&gt;bar.js&lt;/em&gt; 模块，那么 Node.js 将会按照下面的顺序检查文件目录：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;E:/Code/nodejs/demo/node_modules/bar.js&lt;/li&gt;
&lt;li&gt;E:/Code/nodejs/node_modules/bar.js&lt;/li&gt;
&lt;li&gt;E:/Code/node_modules/bar.js&lt;/li&gt;
&lt;li&gt;E:/node_modules/bar.js&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;所以尽可能地把依赖放在就近的位置，以防崩溃。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;个人笔记，仅供参考&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;参考:&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;http://book.douban.com/subject/10789820/&quot; class=&quot;link-underline&quot;&gt;《Node.js 开发指南》&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;http://nodejs.org/docs/latest/api/modules.html#modules_core_modules&quot; class=&quot;link-underline&quot;&gt;Node.js API&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;http://www.infoq.com/cn/articles/nodejs-module-mechanism&quot; class=&quot;link-underline&quot;&gt;深入浅出 Node.js 三&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Node.js入门-Node.js 介绍]]></title><description><![CDATA[Node.js学习入门 ##Node.js 是什么
Node.js 不是一种独立的语言，与 PHP，Python 等”既是语言优势平台“不同，它也不是一个 JavaScrip 框架，不同于 CakePHP，Django，更不是一个 JavaScript 库，不能和 jQuer…]]></description><link>https://zhanglun.github.io/blogs/Node学习笔记-Node.js介绍/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/Node学习笔记-Node.js介绍/</guid><pubDate>Sat, 19 Apr 2014 21:55:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;Node.js学习入门&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;##Node.js 是什么
Node.js 不是一种独立的语言，与 PHP，Python 等”既是语言优势平台“不同，它也不是一个 JavaScrip 框架，不同于 CakePHP，Django，更不是一个 JavaScript 库，不能和 jQuery 相提并论。总的来说，Node.js 是一个让 JavaScript 运行在服务端的开发平台。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Node.js 是一个让 JavaScript  运行在浏览器之外的平台。它实现了注入文件系统、模块、包、操作系统级别的API、网络通信等JavaScript不能做到或者做得不好的功能
##Node.js 能做什么&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;使用 Node.js 可以轻松的开发：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;具有复杂逻辑的网站&lt;/li&gt;
&lt;li&gt;大规模的 Web 应用&lt;/li&gt;
&lt;li&gt;Web Socket 服务器 &lt;a href=&quot;http://zh.wikipedia.org/wiki/WebSocket&quot; class=&quot;link-underline&quot;&gt;wiki&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;TCP/UDP 套接字应用程序&lt;/li&gt;
&lt;li&gt;命令行工具&lt;/li&gt;
&lt;li&gt;交互式终端程序&lt;/li&gt;
&lt;li&gt;本地应用程序&lt;/li&gt;
&lt;li&gt;单元测试工具&lt;/li&gt;
&lt;li&gt;客户端JavaScript编译器&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;Node.js 可以作为服务器提供服务，他跳过了类似 Apache，IIS 等 HTTP 服务器，内建了 HTTP 服务器支持，无需额外搭建一个 HTTP 服务器，便可以轻而易举地实现网站和服务器的组合。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var http=require(&amp;quot;http&amp;quot;);
http.createServer(function(req,res){
	res.writeHead(200,{&amp;quot;Content-Type&amp;quot;:&amp;quot;text/plain&amp;quot;});
	res.end(&amp;quot;Hello,CrispElite!\n&amp;quot;);
}).listen(3000,&amp;quot;127.0.0.1&amp;quot;);//
console.log(&amp;quot;服务器已启动：http://127.0.0.14:3000/&amp;quot;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;将代码保存为 server.js ，从终端或者CMD中运行这个程序：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;node server.js // 必须先安装好Node.js环境&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果成功启动服务器，那么在终端或者CMD中可以看到类似这样的显示：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;你的服务器已启动：http://127.0.0.14:3000/&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;用浏览器访问”&lt;a href=&quot;http://127.0.0.14:3000/&quot; class=&quot;link-underline&quot;&gt;http://127.0.0.14:3000/&lt;/a&gt;” (代码中 listen() 指定的地址)&lt;/p&gt;
&lt;!-- ![Node server](http://cl.ly/image/1u2K2Y351b3O/nodeserver.png) --&gt;
&lt;p class=&quot;para&quot;&gt;Node.js 还可以部署到非网络应用的环境下，比如命令行。甚至可以调用 C/C++ 的代码，充分利用已经拥有的诸多函数库。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##异步式 I/O 与事件驱动&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Node.js 最大的特点就是采用异步式 I/O 与事件驱动的架构设计。对于高并发的解决方案，传统的架构师多线程模型，也就是为每一个业务逻辑提供一个系统线程，通过切换线程弥补同步式 I/O 的事件开销。Node.js 和 JavaScript 一样使用的是单线程模型，对于所有的 I/O 请求都采用异步的方式，在执行过程中维护一个且只有一个事件队列，程序在执行时进入时间循环等待下一个事件到来，每一个异步 I/O 请求完成之后都被添加到事件队列，等待处理。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;什么是阻塞( block )？线程在执行中如果遇到磁盘读写或者网络通信( 统称为 I/O 操作 )，通常要耗费较长时间，这是才做系统会剥夺这个线程的 CPU 控制权，使其暂停执行，并将资源让给其他的工作线程，这种线程调度方法称为阻塞。当 I/O 操作完毕时，系统将这个线程的阻塞状态解除，恢复其对 CPU 的控制权，令其继续执行。这种 I/O 模式就是通常的&lt;strong&gt;同步式 I/O ( Synchronous I/O )&lt;strong&gt;或者&lt;/strong&gt;阻塞式 I/O ( Blocking I/O )&lt;/strong&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;比如：你去超市买东西，结账的柜台只有一个，但是排队结账的人很多。而你只能排队结账。，可是每天排队的人很多，慢慢的大家开始抱怨每天买点东西搞得像过年过节一样。超市老板为了满足顾客，斥资招人，多开几个结账柜台。这样一来，虽然还要排队，但是队伍多了，每个队伍的等待时间少了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;异步式 I/O ( Asynchronous I/O ) 或者非阻塞式 I/O ( Non-blocking I/O ) 则针对所有 I/O 操作不采用阻塞的策略。当线程遇到 I/O 操作时，只将 I/O 请求发送给操作系统，继续执行下一条语句。当操作系统完成 I/O 操作时，以事件的形式通知执行 I/O 操作的线程，线程会在特定时候处理这个事件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;比如：你还是去超市买东西，但是你要的东西超市采购的货还在路上，于是到柜台咨询。客服要求你留下联系方式，货到之后联系你。过了几天，超市工作人员打电话给你，告诉你你要的货到了。然后你屁颠屁颠跑去超市拿货。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;阻塞模式下，一个线程只能处理一项任务，想提高吞吐量必须通过多线程。而非阻塞模式下，一个线程永远在执行计算操作， I/O 以事件的方式通知。多线程带来的好处仅仅是在多核 CPU 的情况下利用更多核，而 Node.js 的单线程也能带来同样的好处。这就是为什么 Node.js 使用了单线程，非阻塞的事件编程模式。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;单线程事件驱动的异步I/O 比传统的多线程阻塞式 I/O 的好处在于：异步式 I/O  少了了多线程的开销。具体细节请看&lt;a href=&quot;%22http://baike.baidu.com/view/65706.htm#4%22&quot; class=&quot;link-underline&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;比如：简单的数据库查询操作，按照传统的方式实现的代码如下：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;res=db.query(&amp;quot;SELECT * from someTable&amp;quot;);
res.output();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;执行到第一行的时候，线程会阻塞，直到数据库返回查询结果。然后再继续处理。当涉及到磁盘读写，网络通信时，时延可能非常大，线程会阻塞等待结果返回。对于高并发的访问，一方面线程长期阻塞等待，另一方面为了应付新的请求而不断增加线程，因此浪费大量系统资源。而对于 Node.js 来说，是这样的&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;db.query(&amp;quot;SELECT * from someTable&amp;quot;,function(res){
	res.output();
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;进程在执行到 db.query 时，不会等待结果返回，而是直接继续执行后面的语句，直到进入事件循环。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##Node.js 的模块( Module )和包( Package )
模块( Module )和包( Package )是 Node.js 最重要的支柱。通过 npm 安装需要的模块，使用 require 函数来调用其他模块。&lt;br&gt;
npm 是 Node.js 的包管理器。允许我们下载、安装、升级、删除包。npm 之于 Node.js ，就像 pip 之于 Python，gem 之于 Ruby。
安装好 npm 之后，可以从终端或者CMD开始安装模块。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;npm install [module_name]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;模块安装成功后，会被放置在当前目录的 node_modules 文件夹中。在使用 npm 安装包的时候，有两种模式：&lt;strong&gt;本地模式&lt;/strong&gt;和&lt;strong&gt;全局模式&lt;/strong&gt;。默认情况下使用 npm install 命令就是本地模式，将包安装到当前目录的 node_modules 子文件夹中。另外一种被称为全局模式：npm install -g [modules_name] 。本地模式仅仅将包安装到 node_modules 文件夹中，并不会注册 PATH 环境变量，即无法在命令行中直接使用，在 window 上 会提示“不是内部命令”之类的。而使用全局模式的时候，包会安装在系统目录中，在 window 中会安装到 “C:\Users\yourUserName” 中，同时可以在命令行中直接使用命令。但是使用全局模式安装的包并不能直接在 JavaScript 文件中使用 require 获得。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;总而言之，当需要将某个包作为工程运作时的一部分时，通过本地模式获取，如果要在命令行中使用，则使用全局安装。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##关于调试&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###我爱F5
在开发 Node.js 实现的 HTTP 应用时，无论修改了代码的哪一部分，都必须重新运行才能奏效。因为 Node.js 只有在第一次引用到某部分时才会解析脚本文件，之后都会直接访问内存，避免重复载入，以提高速度。 supervisor 可以监视代码的修改，并自动重启Node.js。使用 npm 以全局模式安装 supervisor 之后，可以直接在命令行中使用下面的命令启动 server.js。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;supervisor server.js &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###调试方法
调试的方法有：命令行调试，使用 Eclipse 调试等。个人倾向使用 node-inspector 进行调试。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;####使用 node-inspector&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;npm install -g node-inspector //命令安装 node-inspector &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;然后在终端或者CMD中敲入&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;node --debug-brk=5858 filename.js  //连接你要测试的脚本的调试服务器
node-inspector                  //另开一个窗口，启动 node-inspector 。&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;在浏览器中打开 “&lt;a href=&quot;http://127.0.0.1:3000/debug?port=5858%E2%80%9D&quot; class=&quot;link-underline&quot;&gt;http://127.0.0.1:3000/debug?port=5858”&lt;/a&gt; ，便可以看到调试工具。
具体可以&lt;a href=&quot;http://www.cnblogs.com/dolphinX/p/3485345.html&quot; class=&quot;link-underline&quot;&gt;点这里&lt;/a&gt; 。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;个人笔记，仅供参考&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;参考:&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://book.douban.com/subject/10789820/&quot; class=&quot;link-underline&quot;&gt;《Node.js 开发指南》&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[高性能网站优化-确保异步加载脚本时保持执行顺序]]></title><description><![CDATA[《高性能网站建设进阶指南》 脚本如果按照常规方式加载，不仅会阻塞页面中其他内容的下载，还会阻塞脚本后面所有元素的渲染。异步加载脚本可以避免这种阻塞现象，从而提高页面加载速度。但是性能的提升是要付出代价的。代码的异步执行可能会出现竞争状态。简单地说就是页面内部的脚本需要的标示符如…]]></description><link>https://zhanglun.github.io/blogs/高性能网站优化-整合异步脚本/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/高性能网站优化-整合异步脚本/</guid><pubDate>Thu, 10 Apr 2014 19:40:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;《高性能网站建设进阶指南》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;脚本如果按照常规方式加载，不仅会阻塞页面中其他内容的下载，还会阻塞脚本后面所有元素的渲染。异步加载脚本可以避免这种阻塞现象，从而提高页面加载速度。但是性能的提升是要付出代价的。代码的异步执行可能会出现竞争状态。简单地说就是页面内部的脚本需要的标示符如果是在外部文件中定义的，而当外部文件异步加载的时候，如果没有保证外部文件和内部脚本执行顺序，很有可能会出现未定义标示符的错误&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;当异步加载的外部脚本与行内脚本之间存在代码依赖时，就需要通过一种保证执行顺序的方法来整合这两个脚本。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;如何保证执行顺序&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F&quot; aria-label=&quot;如何保证执行顺序 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何保证执行顺序&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;当外部脚本按常规方式加载时，他会阻塞行内代码的执行，不会出现因为竞争状态而导致的未定义标示符错误。有几个技术可以帮助我们保证执行顺序。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;硬编码回调 (Hardcoded Callback)&lt;/li&gt;
&lt;li&gt;Window Onlad&lt;/li&gt;
&lt;li&gt;定时器 (Timer)&lt;/li&gt;
&lt;li&gt;Degrading Script Tags&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;方法1硬编码回调-Hardcoded-Callback&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%96%B9%E6%B3%951%E7%A1%AC%E7%BC%96%E7%A0%81%E5%9B%9E%E8%B0%83-Hardcoded-Callback&quot; aria-label=&quot;方法1硬编码回调 Hardcoded Callback permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;方法1：硬编码回调 (Hardcoded Callback)&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;让外部的脚本调用内部脚本的函数，以确保代码的顺序执行。例如&lt;a href=&quot;http://stevesouders.com/efws/hardcoded-callback.php?t=1398050691&quot; class=&quot;link-underline&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//行内代码
function init() {
  createMenu(&amp;#39;examples&amp;#39;);
}
var domscript = document.createElement(&amp;#39;script&amp;#39;);
domscript.src = &amp;quot;menu-with-init.js&amp;quot;;
document.getElementsByTagName(&amp;#39;head&amp;#39;)[0].appendChild(domscript);

//外部文件
function createMenu(id) {
  [...]
}
// callback to the main page
init();
`&amp;lt;/pre&amp;gt;

如果开发人员可以同时控制主页面和外部脚本，这种技术是可行的的。但是我们常常会调用第三方的 JavaScript ，比如： jQuery ，我们不可能降回调添加在 jQuery 的文件中。而且这种方法也不太灵活，一旦改变了回调函数需要同时修改外部脚本。  

### 方法2： Window Onload

通过监听 Window 的 onload 事件来触发行内代码的执行。这使得只要确保外部脚本在 window.onload 之前下载执行就能保证执行顺序。有些异步加载技术确保在 window.onload  触发之前加载外部脚步：&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;http://zhanglun.github.io/2014/03/30/%E9%AB%98%E6%80%A7%E8%83%BD%E7%BD%91%E7%AB%99%E4%BC%98%E5%8C%96-%E6%97%A0%E9%98%BB%E5%A1%9E%E5%8A%A0%E8%BD%BD%E8%84%9A%E6%9C%AC/#Script_in_Iframe&quot; class=&quot;link-underline&quot;&gt;Script in Iframe&lt;/a&gt; 在IE、Firefox、Safari、Chrome 和 Opera 中保持顺序执行&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;&lt;a href=&quot;http://zhanglun.github.io/2014/03/30/%E9%AB%98%E6%80%A7%E8%83%BD%E7%BD%91%E7%AB%99%E4%BC%98%E5%8C%96-%E6%97%A0%E9%98%BB%E5%A1%9E%E5%8A%A0%E8%BD%BD%E8%84%9A%E6%9C%AC/#Script_DOM_Element&quot; class=&quot;link-underline&quot;&gt;Script DOM&lt;/a&gt; 在Firefox、Safari 和 Chrome 中保持顺序执行&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;使用其中一种技术，再通过 window.onload 触发行内脚本就可以实现并行下载的同时保证执行顺序。&lt;a href=&quot;%22http://stevesouders.com/efws/window-onload.php?t=1398076365%22&quot; class=&quot;link-underline&quot;&gt;查看官网demo&lt;/a&gt;。这个例子使用了 Script in Iframe 方法加载外部脚本，几乎在所有的浏览器中它都会阻塞onload事件。外部脚本被嵌入在 menu.php 中，然后用 iframe 加载它而不是直接加载 menu.js 。依据浏览器的差异选用 addEventListener 或者 attachEvent 比简单的地使用 window.onload() 好一些。&lt;a href=&quot;%22http://blog.moocss.com/tutorials/javascript-tutorials/526.html%22&quot; class=&quot;link-underline&quot;&gt;关于window.onload加载的多种解决方案 »&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;Window Onload 整合技术有两个缺点：首先，必须确定异步脚本是通过阻塞 onload 事件的方式加载的。其次，可能会造成行内代码的延迟执行。如果页面还有很多其他的资源，比如图片等，那么外部脚本加载执行结束之后， window.onload内部的代码必须等到页面完全加载之后才能够执行。通常行内脚本最好在外部脚本下载和执行之后立即调用。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;方法3定时器Timer&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%96%B9%E6%B3%953%E5%AE%9A%E6%97%B6%E5%99%A8Timer&quot; aria-label=&quot;方法3定时器Timer permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;方法3：定时器(Timer)&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;定时器技术指的是使用轮询方法来保证在行内代码执行之，前所依赖的外部脚本已经加载。《高性能网站建设进阶优化》一书给出的demo中可以看到&lt;a href=&quot;%22http://stevesouders.com/efws/timer.php?t=1398076380%22&quot; class=&quot;link-underline&quot;&gt;link&lt;/a&gt;。修改行内代码，添加一个新函数 initTimer ，负责检查依赖的命名空间和标示符是否存在。如果存在，则调用需要调用的函数；如果不存在，就在指定的时间段之后再次调用 initTimer 函数检查命名空间和标示符。&lt;/p&gt;
&lt;pre&gt;`function initTimer() {
    if ( &quot;undefined&quot; === typeof(EFWS) ) {
        setTimeout(initTimer, 300);
    }
    else {
        init();
    }
}
`&lt;/pre&gt;
&lt;p class=&quot;para&quot;&gt;这个技术也有它的缺点。如果setTimeout方法中设置的事件间隔太小，可能会增加页面的开销。相反，如果设置太大，又可能造成外部脚本加载完成和行内代码开始执行之间的延迟。就上面的例子来说，如果外部脚本加载失败，即行内脚本永远无法检测到指定的命名空间，轮询将会无限进行下去。同时稍微增加了维护的成本，如果外部文件的命名空间和标示符变了，行内代码也要更新。&lt;/p&gt;
&lt;h3 class=&quot;heading&quot; id=&quot;方法4Script-Onload&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%96%B9%E6%B3%954Script-Onload&quot; aria-label=&quot;方法4Script Onload permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;方法4：Script Onload&lt;/h3&gt;
&lt;p class=&quot;para&quot;&gt;前面的那些整合技术会增加页面的脆弱性，开销，导致页面的延迟。Script Onload 方法通过监听脚本的 onload 事件解决了所有的这些问题。&lt;a href=&quot;%22http://stevesouders.com/efws/script-onload.php?t=1398081543%22&quot; class=&quot;link-underline&quot;&gt;link&lt;/a&gt;。考虑到浏览器之间的差异，添加了 script 元素的 onload 和 onreadystatechange 事件处理程序。onload 在其他浏览器中有效，Opera 两者都有效。&lt;/p&gt;
&lt;pre&gt;`var DOMScript=document.createElement(&quot;script&quot;);
DOMScript.src=&quot;someting.js&quot;;
DOMScript.onloadDone=false;
DOMScript.onload=function(){
    DOMScript.onloadDone=true;
    init();
}
DOMScript.onreadystatechange=function(){
    if((&quot;loaded&quot; === DOMScript.readyState || &quot;complete&quot; === DOMScript.readyState) &amp;&amp; ! DOMScript.onloadDone){
        DOMScript.onloadDone=true;
        init();
    }
}


&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;Script Onload 是整合异步加载外部脚本和行内脚本的首选&lt;/strong&gt;。不引用任何外部的标示符，所以维护简单。行内脚本可以在外部脚本加载之后立即执行。同时事件处理也很简单&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;……未完待续……&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Hello hexo]]></title><description><![CDATA[敬以此文纪念成功折腾出自己的github page 之前用 jeykll 折腾自己的 github 博客，看中的是 jeykll 提供的华丽主题。但是 window 用户拙计，用不了 RVM，反正我是折腾了很久没找到办法解决。意外发现还有个叫做pelican的静态博客模板引擎，…]]></description><link>https://zhanglun.github.io/blogs/hello-hexo/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/hello-hexo/</guid><pubDate>Thu, 10 Apr 2014 14:32:44 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;敬以此文纪念成功折腾出自己的github page&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;之前用 jeykll 折腾自己的 github 博客，看中的是 jeykll 提供的华丽主题。但是 window 用户拙计，用不了 RVM，反正我是折腾了很久没找到办法解决。意外发现还有个叫做pelican的静态博客模板引擎，用的是Python，我大喜，自己接触过 Python，这搞起来还不是得心应手？ 各种google之后搭好了（我是没记住具体步骤，就了解个大概流程），接着又是一阵折腾修改配置。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;蛋疼的事情来了：选哪个主题？jeykll 的主题都那么 nice，pelican 的显然逊色很多啊。用了一个 bootstrap 的主题，加上自己的修改，还是不满意。最关键的是，我找了很久都没有找到本地预览的解决方法，每次写完只能上传到 github 上，好麻烦。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;在 &lt;a href=&quot;%22http://www.swornfriends.com/user.aspx?uid=7%22&quot; class=&quot;link-underline&quot;&gt;Crisson&lt;/a&gt; 的一个群里，有人推荐了 &lt;a href=&quot;%22http://hexo.io/%22&quot; class=&quot;link-underline&quot;&gt;hexo&lt;/a&gt; ，这是一个基于 Node.js 的静态博客程序。Node.js 我也接触过啊（虽然就是按照教程敲了一个 server ），那就开始折腾吧！&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;按照官网的教程开始了。整个过程真的狠轻松（具体不详细说，我也只是依样画葫芦）。默认的主题就很不错，但是也得折腾啊。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;不过，&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;今天收到阿里校招的通知，笔试通过了，面试时间地点待定。好开心。等这个通知等得我整个人都不好了，不过还好通知来了。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;明天南下和小伙伴们去广州参加今年腾讯校招的笔试。火车上要十几个小时啊……还是第一次做这么久的火车呢(⊙o⊙)。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;暂时没心思折腾这玩意儿，暂时先让它这样，等回学校了再折腾~&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;给自己加油↖(^ω^)↗&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###勿忘初心，方的始终&lt;/p&gt;</content:encoded></item><item><title><![CDATA[JavaScript中的事件处理程序]]></title><description><![CDATA[JavaScript和HTML之间的交互是通过事件实现的。事件，就是文档或者浏览器窗口中发生的一些特定的交互瞬间。可以使用事件处理程序来预订事件，以便在事件发生的时候执行响应的代码。这种观察者模式的模型，使得JavaScript代码与HTML和CSS代码之间形成了松散耦合。 #…]]></description><link>https://zhanglun.github.io/blogs/JavaScript中的事件处理程序/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/JavaScript中的事件处理程序/</guid><pubDate>Sun, 06 Apr 2014 19:40:00 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;JavaScript和HTML之间的交互是通过事件实现的。事件，就是文档或者浏览器窗口中发生的一些特定的交互瞬间。可以使用事件处理程序来预订事件，以便在事件发生的时候执行响应的代码。这种观察者模式的模型，使得JavaScript代码与HTML和CSS代码之间形成了松散耦合。&lt;/p&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;##事件流
事件流描述的是从页面中接受事件的顺序。但是值得注意的是，在当年的浏览器大战中的主角们采用的是几乎完全相反的事件流概念。IE的事件流是&lt;strong&gt;事件冒泡流&lt;/strong&gt;，而Netscape Communicator的事件流是&lt;strong&gt;事件捕获流&lt;/strong&gt;。
###事件冒泡
IE的事件流叫做&lt;strong&gt;事件冒泡&lt;/strong&gt;（event bubbing），即事件右最具体的元素接受，然后逐级向上传播到不具体的元素，以下面的代码为例：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
	&amp;lt;title&amp;gt;Document&amp;lt;/title&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
	&amp;lt;div id=&amp;quot;btn&amp;quot;&amp;gt;点我&amp;lt;/div&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;如果你单击了#btn，那么在IE的页面中，这个事件会如下传播：&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;div-&gt;body-&gt;html-&gt;document&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;可以看到，事件首先在div上发生，div就是我们单击的元素。然后事件沿着DOM树向上传播，一直到document对象。
所有的现代浏览器都支持事件冒泡。IE9，Firefox，Chrome和Safari则将事件一直冒泡到window对象。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###事件捕获&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;事件捕获的思想是不太具体的节点应该更早接收到事件，而最具体的节点应该是最后接收到事件。事件捕获的顾名思义就是在事件到达预定的目标之间捕获它。以上面的代码作为例子，那么单击div的时候会按照与冒泡相反的顺序触发事件。&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;div-&gt;body-&gt;html-&gt;document&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;在这个过程中，document对象先接收到click事件，然后事件沿着DOM树依次向下，一直传递到目标元素。
IE9，Firefox，Chrome和Safari都支持事件捕获。“DOM2级事件”规范要求事件应该从document对象开始传播，但实际上这些浏览器都是从window对象开始捕获事件。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###DOM事件流&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;DOM事件流比事件毛婆和事件捕获稍微复杂一点点。它规定的事件流包括三个阶段：事件捕获阶段，处于目标阶段和事件冒泡阶段。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;以前面的代码为例。单击div&lt;/p&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;document-&gt;html-&gt;body-&gt;div-&gt;body-&gt;html-&gt;document&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;para&quot;&gt;在DOM事件流中，实际的目标在捕获阶段不会接收到事件。也就是说在捕获阶段中，事件从document到&amp;#x3C;html&gt;再到&amp;#x3C;body&gt;后就停止了。下一个阶段是“处于目标”阶段，于是事件在目标元素上面发生，并且在事件处理中被看成了冒泡阶段的一部分。紧接着冒泡阶段发生，事件传回文档
##事件处理程序
###HTML事件处理程序&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;input type=&amp;quot;button&amp;quot; value=&amp;quot;Click&amp;quot; id=&amp;quot;go&amp;quot; onclick=&amp;quot;showMessage()&amp;quot; /&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这玩意儿就是传说中的HTML事件处理程序。最明显的缺点就是：HTML与JavaScript代码紧密耦合。如果要更换事件处理程序，就要同时修改HTML和JavaScript代码。
###DOM0级事件处理程序
通过JavaScript制定事件处理程序的传统方法，就是讲一个函数赋值给一个叫做“事件处理程序”的属性。每个元素都有自己的事件处理程序属性，这些属性通常全部都是小写，例如onclick。将事件处理程序设置为一个函数，就可以指定事件处理程序。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var btn=document.getElementById(&amp;quot;myBtn&amp;quot;);	
btn.onclick=function(){
	alert(&amp;quot;Clicked!&amp;quot;);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;要使用JavaScript指定事件处理程序，必须先获得对象元素的引用，然后为其指定事件处理程序的函数。
事件处理程序是在元素的作用域中运行的，也就是说程序中的this指向的是当前元素。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var btn=document.getElementById(&amp;quot;myBtn&amp;quot;);	
btn.onclick=function(){
	alert(this.id);//&amp;quot;myBtn&amp;quot;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;以这种当时添加的事件处理程序会在事件流的冒泡阶段被处理。
通过将事件处理程序属性的值设置成null就可以删除事件处理程序。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;btn.onclick=null;	&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###DOM2级事件处理程序
“DOM2级事件”规定了两个方法用于操作事件处理程序：addEventListener()和removeEventListener()。所有的节点都包含这两个方法，接收三个参数：要处理的事件名，作为事件处理程序的函数和一个布尔值。最后的参数如果是true，表示在事件捕获阶段调用事件处理程序，如果是false，表示在事件冒泡阶段调用事件处理程序。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var btn=document.getElementById(&amp;quot;myBtn&amp;quot;);	
btn.addEventListener(&amp;quot;click&amp;quot;,function(){
	alert(this.id);
},false);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;DOM0级事件处理程序只能为一个元素添加唯一的某一个事件的处理程序。如果为一个元素添加了两个click的处理程序，后定义的程序会覆盖掉之前定义的程序，其实也就是给变量a多次赋值一样。使用DOM2级事件处理程序的好处之一就是：可以添加多个添加多个事件处理程序。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var btn=document.getElementById(&amp;quot;myBtn&amp;quot;);
btn.addEventListener(&amp;quot;click&amp;quot;,function(){
	alert(this.id);
},false);
btn.addEventListener(&amp;quot;click&amp;quot;,function(){
	alert(&amp;quot;hello,world&amp;quot;);
},false);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这两个事件处理程序会按照添加的顺序触发。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;通过addEventListener()添加的事件处理程序只能使用removeEventListener()来移除。通过addEventListener()添加的匿名函数无法移除，因为移除是传入的参数一添加处理程序时使用的参数&lt;strong&gt;必须相同&lt;/strong&gt;。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;为了最大限度地兼容浏览器，建议在大多数情况下豆浆事件处理程序添加到事件流的冒泡阶段。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###IE中的事件处理程序&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;IE中有类似于DOM的两个方法：attachEvent()和detachEvent()。这两个方法接受两个参数：事件处理程序名称和事件处理程序函数。attachEvent()添加的事件处理程序都会添加到冒泡阶段&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var btn=document.getElementById(&amp;quot;myBtn&amp;quot;);
btn.attachEvent(&amp;quot;onclick&amp;quot;,function(){
	alert(&amp;quot;alert&amp;quot;);
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;要注意哟，第一个参数是“onclick”而不是“click”。前面说到，在DOM0级事件中，事件处理程序的作用域是元素的作用域，而在使用attachEvent()时，作用域变成了全局作用域，此时this等于window&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var btn=document.getElementById(&amp;quot;myBtn&amp;quot;);
btn.attachEvent(&amp;quot;onclick&amp;quot;,function(){
	alert(this==widnow);//&amp;quot;true&amp;quot;
});&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;与addEventListener()一样，attachEvent()也可以用来为一个元素天剑多个事件处理程序，不过与DOM方法不同的是，事件处理程序不是按照添加的顺序执行，而是以相反的顺序执行。
可以使用detachEvent()移除使用attachEvent()添加的事件处理程序。与DOM方法一样必须提供相同的参数，添加的匿名函数不能被移除。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;因此跨浏览器的事件处理程序可以这么写： （来自《JavaScript高级程序设计》）&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var EventUtil = {
    addHandler: function (element, type, handler) {
        if (element.addEventListener) {
            element.addEventListener(type, handler, false);
        } else if (element.attachEvent) {
            element.attachEvent(&amp;quot;on&amp;quot; + type, handler);
        } else {
            element[&amp;quot;on&amp;quot; + type] = handler;
        }
    },
    removeHandler: function (element, type, handler) {
        if (element.removeEventListener) {
            element.removeEventListener(type, handler, false);
        } else if (element.detachEvent) {
            element.detachEvent(&amp;quot;on&amp;quot; + type, handler);
        } else {
            element[&amp;quot;on&amp;quot; + type] = null;
        }
    }
};
var btn = document.getElementById(&amp;quot;myBtn&amp;quot;);
var handler = function () {
        alert(&amp;quot;Clicked&amp;quot;);
    };
EventUtil.addHandler(btn, &amp;quot;click&amp;quot;, handler);
EventUtil.removeHandler(btn, &amp;quot;click&amp;quot;, handler);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;参考资料&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99&quot; aria-label=&quot;参考资料 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;参考资料&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;《JavaScript高级程序设计》&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[高性能网站优化-无阻塞加载脚本]]></title><description><![CDATA[《高性能网站建设进阶指南》 按理来说，JavaScript在浏览器中的性能问题是开发人员面对的最重要的可用性问题。但由于JavaScript天生的阻塞性质，问题变得复杂。大多数浏览器在下载或者执行脚本的同时不会下载其他内容，使用单线程处理JavaScript的解析和UI的更新。…]]></description><link>https://zhanglun.github.io/blogs/高性能网站优化-无阻塞加载脚本/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/高性能网站优化-无阻塞加载脚本/</guid><pubDate>Sun, 30 Mar 2014 19:40:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;《高性能网站建设进阶指南》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;按理来说，JavaScript在浏览器中的性能问题是开发人员面对的最重要的可用性问题。但由于JavaScript天生的阻塞性质，问题变得复杂。大多数浏览器在下载或者执行脚本的同时不会下载其他内容，使用单线程处理JavaScript的解析和UI的更新。当遇到这种情况时，希望以不阻塞其他内容下载的方式来加载JavaScript。有些技术可以做到这点，使页面加载更快。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##头疼的脚本阻塞并行下载
在介绍JavaScript加载优化技术之前，先看看浏览器默认的方式。&amp;#x3C;script&gt; 标签可以放在 &amp;#x3C;head&gt; 或者 &amp;#x3C;body&gt; 里面的任意位置。一般来说都将 &amp;#x3C;script&gt; 和 &amp;#x3C;link&gt; 标签一起放在 &amp;#x3C;head&gt; 中，这样一来页面加载的时候会先加载它们，页面的样式和行为看起来正常。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;	&amp;lt;html&amp;gt;	
		&amp;lt;head&amp;gt;
	    &amp;lt;meta charset=&amp;quot;UTF-8&amp;quot;&amp;gt;
	    &amp;lt;title&amp;gt;Demo&amp;lt;/title&amp;gt;
	    &amp;lt;link rel=&amp;quot;stylesheet&amp;quot; href=&amp;quot;css/base.css&amp;quot;&amp;gt;
	    &amp;lt;link rel=&amp;quot;stylesheet&amp;quot; href=&amp;quot;css/base2.css&amp;quot;&amp;gt;
	    &amp;lt;script src=&amp;quot;scripts/file1.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
	    &amp;lt;script src=&amp;quot;scripts/file2.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
	    &amp;lt;script src=&amp;quot;scripts/file3.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
	&amp;lt;/head&amp;gt;
	&amp;lt;body&amp;gt;
	    &amp;lt;p&amp;gt;Hello,CrispElte&amp;lt;/p&amp;gt;
	&amp;lt;/body&amp;gt;
	&amp;lt;/html&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;尽管这端代码开始来无伤大雅，但实际上存在几个性能问题：有三个脚本文件，每个文件在下载和执行时候都会阻塞页面的加载。只有脚本执行完成之后，才会继续加载其他资源，比如，图片，CSS文件，iframe等。
我们可以将 &amp;#x3C;script&gt; 标签放在页面的底部，即 &amp;#x3C;/body&gt;标签之前。尽管脚本文件的加载会阻塞页面，但是页面在脚本呢加载之前已经加载完成，所以不用担心阻塞。
脚本应该顺序执行，但是没有必要顺序下载。IE8第一次实现了脚本的并行下载，但是在脚本下载并执行完毕之前依旧阻塞了后面的资源。&lt;br&gt;
最终的目的时让脚本与其他资源并行下载，并且希望兼容所有的浏览器。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##让脚本运行得更美好
有几种动态加载外部脚本的技术可以使页面不会被脚本的阻塞行为所影响。
###XHR Eval
通过XMLHttpRequest从服务端获取脚本，然后通过eval命令执行内容&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var xhrObj=new XMLHttpRequest();
xhrObj.onreadystatechange=function(){
	if(xhrObj.readyState == 4 &amp;amp;&amp;amp; xhrObj.status == 200){
		eval(xhrObj.responseText);
	}
}
xhrObj.open(&amp;quot;GET&amp;quot;,&amp;quot;file1.js&amp;quot;,true);
xhrObj.send(null);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;这个方法的主要缺陷是，动态加载的脚本必须是同域的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###XHR注入
与XHR Eval类似，同样是通过 XMLHttpRequest 对象来获取脚本，不同之处在于，这个方法时不是用 eval 而是创建一个 script 的 DOM 元素，然后将 XMLHttpRequest 的响应写入script标签中来执行JavaScript。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var xhrObj=new XMLHttpRequest();
xhrObj.onreadystatechange=function(){
	if(xhrObj.readyState == 4 &amp;amp;&amp;amp; xhrObj.status == 200){
		var script=document.createElement(&amp;quot;script&amp;quot;);
		document.getElementsByTagName(&amp;quot;head&amp;quot;)[0].appendChild(script);
		script.text=xhrObj.responseText;
	}
}
xhrObj.open(&amp;quot;GET&amp;quot;,&amp;quot;file1.js&amp;quot;,true);
xhrObj.send(null);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;和 XHR Eval 方法一样，加载的脚本必须是同域的。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###Script in Iframe
在页面中 iframe 与其他资源是并行下载的，可以利用iframe无阻塞加载JavaScript。
由于 iframe 认为返回的是 HTML 文档，所以将src设置成一个 HTML 文件而不是 js 文件。
而我们要做的就是在 HTML 文档中将外部脚本转换成行内脚本。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;与 XHR Eval 和 XHR 注入这两种方法类似，这个方法要求 iframe URL 和主页同域。满足同域要求之后，我们需要修改 JavaScript 来创建他们之间的关联，其本质就是获得引用 iframe 的 JavaScript 标示符。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//使用 &amp;quot;iframes&amp;quot; 中访问主页上的 iframe
window.frames[0].somefunction();
//使用 &amp;quot;getElementById&amp;quot; 访问主页上的iframe
document.getElementById(&amp;quot;myIframe&amp;quot;).contentWindow.someFunction();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;&lt;strong&gt;可以在iframe中使用parent变量引用父页面&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;function changeBg(){
	var body=parent.document.body;
	body.className=&amp;quot;red&amp;quot;;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;概括一下：主页面中添加一个 iframe 标签，其 src 指向一个 HTML 文档，在这个 HTML 文档中编写行内 JavaScript 代码，也可以引用外部的 JavaScript 文件&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###Script DOM Element
创建一个script标签并设置其src，代码很简单。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;var script=document.createElement(&amp;quot;script&amp;quot;);
script.src=&amp;quot;demo2.js&amp;quot;;
document.getElementsByTagName(&amp;quot;head&amp;quot;)[0].appendCHild(script);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;下载过程中用这种方式创建脚本不会阻塞其他的资源，同时这种方法允许跨域。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###defer还是async
在最新的标准中，script标签定义了defer属性和async属性，都是让脚本并行下载，但是defer下脚本按照顺序执行，而async不按顺序执行脚本。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;###document.write Script Tag
最后一种技术是使用 document.write 把 HTML 标签 script 写入页面中。这种技术只在IE中是并行加载脚本的。虽然多个脚本可以并行下载，但在下载脚本时，浏览器仍然阻塞其他类型的资源。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[高性能网站优化-创建快速响应的Web]]></title><description><![CDATA[《高性能网站建设进阶指南》 ##优化原则
优化的目的是希望降低程序的整体开销。
###减少开销
通常认为开销就是程序的执行时间。而在进行优化工作时，应该把重点放在对程序开销影响最大的那部分。
假设我们有四个模块：A，B，C，D，其中模块A运行所需开销54%，模块B运行所…]]></description><link>https://zhanglun.github.io/blogs/高性能网站优化-创建快速响应的web/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/高性能网站优化-创建快速响应的web/</guid><pubDate>Sat, 15 Mar 2014 21:55:00 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;《高性能网站建设进阶指南》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--more--&gt;
&lt;p class=&quot;para&quot;&gt;##优化原则
优化的目的是希望降低程序的整体开销。
###减少开销
通常认为开销就是程序的执行时间。而在进行优化工作时，应该把重点放在对程序开销影响最大的那部分。
假设我们有四个模块：A，B，C，D，其中模块A运行所需开销54%，模块B运行所需开销4%，模块C运行开销30%，模块D运行开销12%。&lt;br&gt;
即使可以通过某种方法将模块B性能开销减少到2%，其实也只是降低了整体开销的2%。如果A的开销减少10%，却可以获得更好的效果，而显然模块A更值得去优化。优化那些开销不大的模块回报太低。
###优化循环
程序大部分的时间都消耗在循环上，优化那些只执行一次的代码得到的回报微不足道。但优化循环得到的好处却总是让人欣慰。
###合理利用Ajax
利用Ajax技术，客户端将较小的数据包发送到服务端，然后服务端响应请求返回另一个较小的数据包，客户端的JavaScript程序处理服务端返回的数据包，更新浏览器中的页面。这样数据的传输量和反馈时间间隔都大大减少，同时客户端和服务端工作量也减少。万万不可将所有的应用数据都发送给浏览器，这样反而会增加服务端的响应时间，而返回给客户端的数据也增加程序运行的压力，从而降低性能。&lt;br&gt;
###注意DOM
浏览器不是为应用平台而设计的，所以在处理Ajax应用程序的时候具有挑战。但是浏览器的发展速度很快，远远超出想象，已经有足够的能力去处理和执行复杂的应用。通过Ajax库可以碾碎很多障碍。&lt;br&gt;
但是浏览器对DOM的解析依然低效。浏览器运行时，最大的开销往往是解析DOM而不是JavaScript 。注意优化DOM结构，避免多余的开销大的DOM操作。&lt;/p&gt;
&lt;hr&gt;
&lt;p class=&quot;para&quot;&gt;##伪多线程
就像所有的GUI应用程序一样，浏览器按队列顺序完成其队列中单独事件的处理。它按照先进先出的顺序从队列中取出，然后决定如何处理。但是，在浏览器中这个过程是单线程的，浏览器每次只能处理这些任务中的一个，并且其他任意一个任务都可以阻止其他任务的执行。由于JavaScript现在不支持多线程，所以无法创建一个后台程序执行开销很大的代码。而实际上，我们有一些方法可以在JavaScript中实现多线程的工作，但是却没有线程之间相互入侵的危险。
###定时器
待完善
###Web Workers
使用 setTimeout()、setInterval()、XMLHttpRequest 和事件处理程序等技术模拟“并行”，确实都是异步运行的。但没有阻碍未必就意味着并行。系统会在生成当前执行脚本后处理异步事件。可以通过Web Worker执行一些操作，同时却不会阻碍UI和其他脚本。
###内存管理
JavaScript中**绝大部分的运行环境（？为什么是绝大部分？）**都实现了垃圾回收。但是自动管理内存是有开销的。在执行回收时，它们会冻结整个运行环境，包括正在调用的主线程，直到遍历完整整个创建对象的“堆”。在这个过程中查找不再使用或者能够回收内存的对象。&lt;br&gt;
对于大部分应用程序而言，GC是完全透明的。冻结运行环境的时间短到完全可以忽略。但是随着内存占用的增加，遍历整个内存中保存着对象的“堆”查找不再使用的对象的时间将增长，最终引起注意。
当这种情况发生是，应用程序开始定期出现间歇迟钝，更严重一点整个浏览器可能出现反映迟钝。&lt;br&gt;
在编写代码时要注意：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;使用delete关键词从内存中移除不再需要的对象；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p class=&quot;para&quot;&gt;从网页DOM树中移除不再需要的节点&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p class=&quot;para&quot;&gt;###通过拆分节省下载&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;将JavaScript分成两部分：一部分是渲染初始页面必须的，剩下的作为另一部分。在初始化时只加载必要的  JavaScript，其余的JavaScript稍后再加载。
拆分JavaScript代码的一个难点就是要避免出现未定义标识符错误。如果在执行的时候引用到了一个被延时加载的标识符时，就会出现这种问题。不过也有解决方法：
在延迟加载的代码和UI界面相关联的情况下，可以通过提示来巧妙的避开与用户的冲突。比如菜单中可以添加一个“加载中”的图标，告诉用户正在加载。或者干脆在延迟加载的代码里绑定事件处理程序，这样一来代码还未加载执行时，点击不会执行任何JavaScript代码。将两者结合更佳。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;延时加载的代码不与页面元素相关联的情况下，可以使用模拟函数（stub function）来解决这个问题。模拟函数是一个与原函数名称相同但是函数体为空，或者包含一些临时代码的函数。当调用它们时，动态加载其他的JavaScript代码。当增的JavaScript代码下载完成之后，模拟函数便被新的函数覆盖。JavaScript函数没有重载。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Sass基本语法]]></title><description><![CDATA[sass是一种基于ruby语言开发的CSS预处理器。它可以使用变量，嵌套，混入，继承，运算，函数等编程语言具有的特性进行CSS的开发，使得CSS的开发变得简单粗暴清晰可维护。 sass有两种后缀文件格式：一种是sass后缀形式；一种是scss后缀形式。我选择的后缀是scss 注…]]></description><link>https://zhanglun.github.io/blogs/2014-03-10-Sass语法/</link><guid isPermaLink="false">https://zhanglun.github.io/blogs/2014-03-10-Sass语法/</guid><pubDate>Mon, 10 Mar 2014 20:20:34 GMT</pubDate><content:encoded>&lt;p class=&quot;para&quot;&gt;sass是一种基于ruby语言开发的CSS预处理器。它可以使用变量，嵌套，混入，继承，运算，函数等编程语言具有的特性进行CSS的开发，使得CSS的开发变得简单粗暴清晰可维护。&lt;br&gt;
sass有两种后缀文件格式：一种是sass后缀形式；一种是scss后缀形式。我选择的后缀是scss&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;注释&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%B3%A8%E9%87%8A&quot; aria-label=&quot;注释 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;注释&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;sass有两种注释方式：一种是”/* */“，标准的CSS注释；还有一种是双斜杠形式”//“。&lt;br&gt;
前者在编译之后会作为注释在CSS文件中出现，但是后者不会。&lt;/p&gt;
&lt;h2 class=&quot;heading subtitle heading&quot; id=&quot;变量variable&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%98%E9%87%8Fvariable&quot; aria-label=&quot;变量variable permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;变量(variable)&lt;/h2&gt;
&lt;p class=&quot;para&quot;&gt;sass可以像编程一样编写CSS。在sass中可以声明变量，并在整个样式表中调用，是不是很酷？你可以在文件的任意位置声明变量，但是必须先声明才能使用。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;变量的声明必须是**$开头**，后面接着变量名，（就像php一样），而变量名和变量值之间则用：连接（就像写CSS一样）。在值的后面加上**!default**表示默认值。如果变量需要镶嵌在字符串之中，就必须需要写在#{}之中。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;sass&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;	//单行注释，不会被编译在CSS文件上
	/*基本样式定义*/

	//这里是声明变量
	$globalFontSize:1em;
	$headerH1:1.5em;
	$bodyBgRed:red;
	$textColor:#343 !default;//默认值
	$SIZE:size;

	//这里调用变量，先声明才能调用
	body{
		font-#{$SIZE}:$globalFontSize;
		background:$bodyBgRed;
		color:$textColor;
	}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//编译后得到的CSS
/*基本样式定义*/
body {
	font-size: 1em;
	background: red;
	color: #334433; 
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;也可以在写CSS部分的时候重新定义属性值，这样我们就不用修改引用的文件，只要重新定义需要修改的变量就可以了。&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;css&quot; theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//这里重新定义属性值
body{
	font-size:$globalFontSize;
	background:$bodyBgRed;
	color:#999;//重新定义了color的值
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;------------

//编译后得到的CSS
body {
  font-size: 1em;
  background: red;
  color: #999; 
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;一个变量也可以设置多个值，通过**nth($variables,index)**来调用其中的值,&lt;strong&gt;其中index从1开始，不是0。&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//声明变量
$textColor:#343434 #f00 #fff #456 !default;
//调用
body{
	color:nth($textColor,1);//选择了$textColor的第一个值#343434
}
a{
	color:nth($textColor,2);//选择了$textColor的第二个值#f00
}
p{
	color:$textColor;
}

----------

//编译后得到的CSS
body {
    color: #343434;
}
a {
    color: red;
}
p {
    color: #343434 red white #445566;
}

//**p部分编译之后color的属性值包括了$textColor所有的值；**
//color:#343434 #f00 #fff #456;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;##嵌套(nesting)
sass分两种嵌套：一种是&lt;strong&gt;选择器嵌套&lt;/strong&gt;；一种是&lt;strong&gt;属性嵌套&lt;/strong&gt;。&lt;br&gt;
###选择器嵌套
通过在一个选择器中嵌套另一个选择器实现继承。在嵌套过程中。可以用&amp;#x26;表示父元素选择器。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//sass
$float:left right;
$navBg:#345;
.nav{
	padding:10px;
	width:960px;
	background:$navBg;
	li{
		float:nth($float,1);
	}
	a{
		display:block;
		padding:5px 10px;
		color:#fff;
		&amp;amp;{
			/*写在a的内部第一层*/			
			font-size:30px;
		}
	}
	&amp;amp;{
		/*写在a的外部，.nav的内部第一层*/
		font-size:30px;
	}
}

--------
//编译后的CSS	
 .nav {
    padding: 10px;
    width: 960px;
    background: #334455;
}
.nav li {
    float: left;
}
.nav a {
    display: block;
    padding: 5px 10px;
    color: #fff;
}
.nav a {
    /*写在a的内部第一层*/
    font-size: 30px;
}
.nav {
    /*写在a的外部，.nav的内部第一层*/
    font-size: 30px;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;###属性嵌套
有些CSS属性有相同的单词开头，如background，可以利用属性嵌套来编写。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//sass
body{
	background:{
		color:#343;
		image:url(../images/bg.png);
		repeat:repeat;
		position:left top;
		attachment:scroll;
		clip:content-box;
		size:50%;
	}
}

-------

//编译后的CSS

body {
  background-color: #343;
  background-image: url(../images/bg.png);
  background-repeat: repeat;
  background-position: left top;
  background-attachment: scroll;
  background-clip: content-box;
  background-size: 50%;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;##混合(mixin)
估计mixin可以算是sass中最强大的特性，利用mixin可以将一部分CSS从代码中抽出，定义成一个模块重复使用。可以在公用的样式中定义一个mixin模块，需要的时候直接调用就好了。同时，mixin还可以传递参数，尼玛越来越向编程了……
####声明一个mixin模块
使用**@mixin&lt;strong&gt;声明一个mixin，后面紧接着mixin的名，可以传递参数，同时给参数设定一个默认值。 但是要注意，参数也是要用$开始，而且参数名和参数值是用&lt;/strong&gt;冒号**分开。如果一个属性有多个值，比如box-shadow等，那参数就用变量名加上三个点表示” &lt;strong&gt;$variable…&lt;/strong&gt; ” 。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//声明一个mixin模块
//boxRect
@mixin boxRect($W:20px,$H:20px){
	width:$W;
	height:$H;
}
//box-shadow
@mixin shadow($shadow...){
	-webkit-box-shadow:$shadow;
	-moz-box-shadow:$shadow;
	-o-box-shadow:$shadow;
	box-shadow:$shadow;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;上述代码简单的声明了两个mixin模块。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;####调用声明的mixin模块&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;用**@include**调用已经声明的模块。&lt;br&gt;
在@include之后紧接着mixin模块名，就像调用函数一样（尼玛简直就是在编程啊），如果模块有默认参数。模块后面的括号可以省略。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//sass
.boxRect400{
	@include boxRect();//不加参数，使用默认参数，可以省略括号,也可以留着
}
.boxRect200{
	/*调用了boxRect模块*/
	@include boxRect(20px,10px);
}
.shadow{
	/*调用了shadow模块*/
	@include shadow(0 1px 1px rgba(0,0,0,0.5));
}	
.nav{
	@include boxRect(10px,10px);
	@include shadow(0 1px 1px rgba(0,0,0,0.5));
	&amp;amp;:hover{
		@include shadow(0 2px 3px rgba(0,0,0,0.7));
	}
} 

-------

//编译后的CSS
 .boxRect400 {
    width: 20px;
    height: 20px;
}
.boxRect200 {
    /*调用了boxRect模块*/
    width: 20px;
    height: 10px;
}
.shadow {
    /*调用了shadow模块*/
    -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
    -moz-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
    -o-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
    box-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
}
.nav {
    width: 10px;
    height: 10px;
    -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
    -moz-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
    -o-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
    box-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
}
.nav:hover {
    -webkit-box-shadow: 0 2px 3px rgba(0, 0, 0, 0.7);
    -moz-box-shadow: 0 2px 3px rgba(0, 0, 0, 0.7);
    -o-box-shadow: 0 2px 3px rgba(0, 0, 0, 0.7);
    box-shadow: 0 2px 3px rgba(0, 0, 0, 0.7);
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;####@content的诞生
为了解决CSS3中@media带来的麻烦，sass引入了**@content**使得mixin可以接受一整块的样式。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//声明模块
//这个模块包含了要定义的属性，和前面的讲到的使用是一样的
@mixin mediaContent(){
	width:200px;
	height:100px;
	color:#345;
	font-size:20px;
}
//使用@content来引入一整块样式
@mixin max-screen($max){
	@media screen and (max-width:$max){
		@content;//接受的样式块从这里开始
	}
}
//调用模块
@include max-screen(720px){
	body{
		@include mediaContent();
	}
}

-------

//编译后的CSS
@media screen and (max-width: 720px) {
  body {
    width: 200px;
    height: 100px;
    color: #345;
    font-size: 20px;
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;##继承(extend)&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;@extend可以复制一个class或者ID中的属性，然后将它们添加到另一个class或者ID的属性列中。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//sass
//sass
.blue_button{
	background:#336699;
	font-weight:bold;
	color:white;
	padding:5px;
}
.org_button{
	border-color:orange;
}
//对比一下@include
@mixin red_button(){
	background:#f00;
	font-weight:bold;
	color:white;
	padding:5px;
}
@mixin org_button(){
	border-color:orange;
}
.checkout_button{
	//继承了两个class
	@extend .blue_button;
	@extend .org_button;
	//引用了两个模块
	@include red_button();
	@include org_button();
}


-------

//编译之后的CSS
.blue_button, .checkout_button {
    background: #336699;
    font-weight: bold;
    color: white;
    padding: 5px;
}
.checkout_button {
    background: #f00;
    font-weight: bold;
    color: white;
    padding: 5px;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;可以看到，使用@include即引用模块时，其实是以复制的形式添加目标的属性，而使用@extend即
继承时，则是将被继承的对象和自身联合，在文件中一起声明一次，大家都叫“联合声明”。
####占位选择器
从3.2。0之后可以定义占位选择器%。&lt;br&gt;
假设在基础文件中定义了很多基础的样式，然后实际上不管是否使用@extend继承相应的样式，所有的代码都会编译解析成CSS，这样一来就会有很多多余的CSS。占位选择器的诞生很好的解决了这个问题。添加了占位选择器之后，只有被继承了的部分才会被解析出来。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//sass
%bgRed{
	background:red;
}
bgBlue{
	background:blue;
}
%bgYellow{
	background:yellow;
}
body{
	@extend %bgRed;
}

-------

//编译之后的CSS
body {
    background: red;
}
.bgBlue {
    background: blue;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;定义了两个占位选择器%bgRed和%bgYellow，但是%bgYellow没有调用，所以在解析的时候便不会包含bgYellow部分。
占位选择器可以使CSS文件更加精炼简洁。一般用在定义基础的样式定义上。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##运算
sass可以对数值进行加减乘除四则运算。注意运算符前面要加上一个空格。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$baseFontSize:14px;
$baseWidth:200;

//
$baseHeight:($baseFontSize *$baseWidth)/2+30;
body{
	height:$baseHeight;
}

-------

//编译之后的CSS
body {
  height: 1430px;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;值得注意的是：在运算表达式中，如果有多个变量，最好保证只有一个带单位的变量，不然很有可能报错。上述的代码中，如果将$baaeWidth中的”200”改成”200px”,就有多个单位，将会报错，无法通过编译。&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;##函数
sass定义了一些很多函数可以使用，同时也可以自己定义函数，@function。
使用函数的方法也很简单，使用函数名加上括号就可以了，有参数的话就带上参数。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//sass
@function pxToRem($px){
	@return $px / $baseFontSize *1rem;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;#####sass几个常见用的颜色函数
Lighten/Darken函数，修改亮度&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;#page{
	color:lighten(#336699,20%);
}
//编译后的CSS
#page{
	color:#6699cc;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;Saturate/Desaturate函数，修改饱和度&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$main_color:#336699;
#page{
	color:saturate($main_color,30%);
}
//编译后的CSS
#page{
	color:#1466b8;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;adjust-hue函数，修改色度&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;$main_color:#336699;
#page{
	color:adjust-hue($main_color,180);
}
#page{
	color:adjust-hue(desaturate($main_color,10%),90);
}

//编译之后的CSS
#page {
  color: #996633; }

#page {
  color: #8f3d8f; 
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;grayscale函数，100%\降低饱和度，这个方法与下面代码是一样的效果。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;desaturate(#336699,100%);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;Mix函数，混合颜色&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;#page{
	color:mix(#336699,#993266);
}
//编译后的CSS
#page {
    color: #664c7f;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;##选择和循环
条件判断
sass真的就是将CSS当成编程语言来折腾了。提供&lt;strong&gt;判断&lt;/strong&gt;和&lt;strong&gt;循环&lt;/strong&gt;来编写CSS。
####选择
&lt;strong&gt;@if&lt;/strong&gt;可可以和**@else**结合多条件使用，就像写程序一样。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//sass
$type: monster;
p {
  @if $type == ocean {
    color: blue;
  } @else if $type == matador {
    color: red;
  } @else if $type == monster {
    color: green;
  } @else {
    color: black;
  }
}

-------
//编译之后的CSS
p {
  color: green; 
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;####for循环&lt;/p&gt;
&lt;p class=&quot;para&quot;&gt;for循环有两种形式，分别为：&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;@for $var from &amp;lt;start&amp;gt; through &amp;lt;end&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;和&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;@for $var from &amp;lt;start&amp;gt; to &amp;lt;end&amp;gt;。&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;$i表示变量，start表示起始值，end表示结束值，这&lt;strong&gt;两个的区别&lt;/strong&gt;是关键字&lt;strong&gt;through&lt;/strong&gt;表示&lt;strong&gt;包括end&lt;/strong&gt;这个数，而&lt;strong&gt;to&lt;/strong&gt;则&lt;strong&gt;不包括end&lt;/strong&gt;这个数。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;//sass
@for $i from 1 through 3 {
	.item-#{$i} { width: 2em * $i; }
}

-------
//编译之后的CSS
.item-1 {
  width: 2em; 
}
.item-2 {
  width: 4em; 
}
.item-3 {
  width: 6em; 
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p class=&quot;para&quot;&gt;####sass中的三目运算
if($condition, $if_true, $if_false) 。&lt;br&gt;
三个参数分别表示条件，条件为真的值，条件为假的值。&lt;/p&gt;
&lt;deckgo-highlight-code  theme=&quot;one-dark&quot; line-numbers=&quot;true&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;if(true, 1px, 2px) =&amp;gt; 1px
if(false, 1px, 2px) =&amp;gt; 2px&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;hr&gt;
&lt;blockquote class=&quot;quote&quot;&gt;
&lt;p class=&quot;para&quot;&gt;基本语法结束，在学习过程中感觉到了sass的魅力。编写CSS变得有趣，而且简单粗暴！！！！！&lt;/p&gt;
&lt;/blockquote&gt;</content:encoded></item></channel></rss>
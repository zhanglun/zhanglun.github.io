{
    "componentChunkName": "component---src-templates-blog-post-tsx",
    "path": "/blogs/2020-05-05-在滴滴的这几年：组件库的设计和开发/",
    "result": {"data":{"site":{"siteMetadata":{"title":"张小伦的网络日志","description":"欢迎来到张小伦的网络日志 \n\t\t一个记录生活，分享心得的博客","menu":[{"id":"home","name":"首页","url":"/"},{"id":"blog","name":"博文","url":"/blogs"},{"id":"category","name":"分类","url":"/categories"},{"id":"archive","name":"归档","url":"/archives"},{"id":"lab","name":"实验室","url":"/labs"},{"id":"about","name":"关于我","url":"/about"}]}},"markdownRemark":{"id":"ac6266b3-a63f-5908-b80e-a8d665821b8d","html":"<p class=\"para\">入职的时候团队加上老板就三个人，需要对接5+个公共服务团队，为公共服务开发控制台，每个团队两个控制台系统。在之前，有一些团队有一些正在运行的系统，技术栈有React, Angular和Vue，UI库有内部的 CubeUI 和外部的 AntD，场面一度十分混乱。</p>\n<p class=\"para\">好在当时组织架构处于建设阶段，现有的系统功能都还没有太多。乘着这个机会，团队统一了技术栈用vue。</p>\n<p class=\"para\">为什么？人少，没有React专家，Angular不好招人，Vue简单，上手快，Vue招人容易。前端的技术选型确定了，后端采用自研的Nodejs的Web框架。</p>\n<p class=\"para\">前端UI也需要一个框架？为什么不用外部的，主要考虑到以下几个问题：</p>\n<ol>\n<li>开源项目有风险，出问题不能立马响应，可能会不在维护。比如公司内部的 CubeUI 和外面的 ElementUI</li>\n<li>开源的UI库往往提供的都是通用性和功能性比较强的组件，风格上比较统一。再者，设计师可能有自己的想法</li>\n<li>开源的定制性差点，可能会出现无法满足产品需求的情况，需要在这个基础上改造，有一定成本</li>\n<li>锻炼团队能力</li>\n</ol>\n<p class=\"para\">刚开始我也没搞过组件库，之前只看过 BootStrap的一点代码，他们是基于 jQuery 的。我来的时候Vue也不太熟练。所以当时只能一边做一个新的系统，一边开发组件库，一边写一边用。\n两个星期做出了第一版的Codis控制台系统，和第一版本的ui框架 Core 我具体是怎么做的呢？</p>\n<p class=\"para\">首先先捋了一波需求，我们要做的这个组件库到底要有什么样的能力。</p>\n<ol>\n<li>提供基础组件库，不对标 AntD或者 ElementUI，提供基础能力，能够当前系统的开发</li>\n<li>和社区的组件库一样，支持 <code>import</code>、<code>require</code> 和 <code>script</code> 标签的引用</li>\n<li>支持主题色</li>\n<li>后续拓展业务组件</li>\n</ol>\n<p class=\"para\">下面说一下几个比较关键的点</p>\n<h3 class=\"heading\" id=\"Webpack的构建打包\" style=\"position:relative;\"><a href=\"#Webpack%E7%9A%84%E6%9E%84%E5%BB%BA%E6%89%93%E5%8C%85\" aria-label=\"Webpack的构建打包 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Webpack的构建打包</h3>\n<p class=\"para\">简单来说构建这块使用webpack来构建打包输出，约定好开发规范，包括代码风格，目录结构每个组件通过文件夹来划分，提供一个总入口文件，最后作为index.js 将组件对象引入，最后一起输出。在此基础上，利用Webpack的entry支持数组的能力，构建阶段扫描每一个组件目录，拿到index.js 单独在构建一份。这样使用的时候既可以一次性引入完整的包，也可以单个引入。</p>\n<p class=\"para\">里面有几个关键点需要注意，除了组件库最后需要暴露入使用的入口之外，我们还需要将依赖外部化。假设组件库名字叫做 <code>my-component</code>，需要至少能提供如下使用的使用能力：</p>\n<deckgo-highlight-code language=\"js\" theme=\"one-dark\" line-numbers=\"true\"  >\n          <code slot=\"code\">import MyComponent from &#39;my-component&#39;;\nVue.use(MyComponent)</code>\n        </deckgo-highlight-code>\n<p class=\"para\">同时在<code>my-component</code>中不包含Vue的依赖。Webpack提供了这样的能力，总结如下：</p>\n<ul>\n<li>使用 <code>externals</code> 选项，避免将依赖打包到应用程序，而使用者会去加载它。</li>\n<li>将 <code>library</code> 的名称设置为 <code>MyComponent</code> 组件名</li>\n<li>将 <code>library</code> 暴露为一个名为 <code>MyComponent</code> 的变量。</li>\n<li>能够访问其他 Node.js 中的 library。</li>\n</ul>\n<p class=\"para\">除此之外，组件的使用还要能支持<code>CommonJS</code>，<code>ES6模块</code>，甚至通过<code>script</code>标签引入。具体细节可以参考：<a href=\"https://webpack.js.org/guides/author-libraries/\" class=\"link-underline\">Authoring Libraries</a></p>\n<h3 class=\"heading\" id=\"文档自动化\" style=\"position:relative;\"><a href=\"#%E6%96%87%E6%A1%A3%E8%87%AA%E5%8A%A8%E5%8C%96\" aria-label=\"文档自动化 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>文档自动化</h3>\n<p class=\"para\">第一步算是完成了。接下来是组件文档的问题。组件的文档需要包括组件的一些基本信息，接口说明，和一些demo。第一版本中，我参考了AntD的设计，在每个组件的目录下面有一个README.md文件，文件头部使用YAML语法设置基本信息，来标记组件的一些信息，比如分类、标题和名称之类的，文件内容作为文档的内容。最后通过自己开发的一个 <code>vue-md-loader</code>，在文档构建过程中，将md文件转换成vue组件，最后输出一个可访问的单页面应用。构建过程接入了Gitlab CI，利用持续集成的思路将文档的更新发布自动化。</p>\n<p class=\"para\">但是这个方案有一个小问题：在markdown文件中编写代码内容确实不方便，缩进不只能，IDE无法帮助识别基本的错误。随后作了一个改进：依然使用<code>README.md</code>作为组件文档的入口，但是只保留顶部基本信息和API参数信息，正文部分增加一个插槽<code>&#x3C;!-- demo --></code>。所有的使用DEMO都放置在新增的<code>demo</code>文件夹，在<code>demo</code>文件夹按照demo0, demo1的顺序放置demo组件。同时对<code>vue-md-loader</code>进行一些改造。编译文档时，将demo文件夹中的demo按照文件名顺序，插入插槽，再将md内容转换成一个vue组件。最后在页面中显示出来。</p>\n<p class=\"para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/985e863d47185ffb77dc6ad9539f2a5e/e7370/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.340425531914896%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACNUlEQVQoz2WSS2sUQRSFKxrRhSD+Bjdi8A+IiiJuNK5ciAQFF+Im/yAiCBoQIgFXblxm58KVMCYkTuaRNjAQYSCJmUkG0zPT04/0TE8/qm511ZFqTTYeOItDVX33cm8xx3EYgMKlUonV63W2sWGxtbU1VqvVWGV9nS0tLTHbthnn/B2RQJIkCRGR1vo/M9d1bwK4A+Di6urqlGVZsz82N69Xq7VnlmU9rNdrNyqVyovl5W+3BMlFQRKjlORRqmCU5wpKKWiNwszzPLiuC875k1KpNNVoNOar1eq15ZWVR+X1yvROqz3bbDY/lcvfH5CU7zNOkFKSeQ9ACyF1lnKd56rILAxDsm0bcZw8tbvd+47jvAJw+eB373bXH9099EeHzmDgATgrpZyXkpBlGWVZZsAgkpD/rLUuOqQoikBEj3d3f810Op3FYRS/3tnbzfc7+2Gr1Xb2Wu3DVte/JIRYJCIIIYhzXgC5MJlAgqCUhukQvV4P8Xj8fBgM2MD13rq+/zmM4ulef/DRD8I5ABfM0qSUCwailCalddGRmZ+Rxt/MgiCo2LbdSNP0XrfnsX4Q1/32wfaw+fMKtrZZZ2tzElsfmD4G5jlULglmGRpIMwGeiWI5BdBUDgL/5Ou4R/GXo773FaPwqgo9pjOa0MAZc0ZSLuRSYDDOaT8ZQwwPkCcJZK6hlT4BToRhODH38g2z7f5pgM4DOCWVOmcgoygydyaPgZIIw1SSyzPkqQ8Rp8hSXszR6A9b2GI9O6YRJwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"component.png\"\n        title=\"component.png\"\n        src=\"/static/985e863d47185ffb77dc6ad9539f2a5e/1d69c/1.png\"\n        srcset=\"/static/985e863d47185ffb77dc6ad9539f2a5e/4dcb9/1.png 188w,\n/static/985e863d47185ffb77dc6ad9539f2a5e/5ff7e/1.png 375w,\n/static/985e863d47185ffb77dc6ad9539f2a5e/1d69c/1.png 750w,\n/static/985e863d47185ffb77dc6ad9539f2a5e/78797/1.png 1125w,\n/static/985e863d47185ffb77dc6ad9539f2a5e/aa440/1.png 1500w,\n/static/985e863d47185ffb77dc6ad9539f2a5e/e7370/1.png 3310w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 class=\"heading\" id=\"主题色\" style=\"position:relative;\"><a href=\"#%E4%B8%BB%E9%A2%98%E8%89%B2\" aria-label=\"主题色 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>主题色</h3>\n<p class=\"para\">我们当时做这个组件库是为了支持团队工作的，每个 PaaS 服务会有两个系统，一个面向用户，一个面向服务方。两种系统采用了两种颜色风格，用户侧黑色，服务方侧绿色。这里我采用的比较简单直接的方案，定了一两个变量，通过不同命令打包构建。就两个颜色，这样挺快</p>\n<h3 class=\"heading\" id=\"自动化\" style=\"position:relative;\"><a href=\"#%E8%87%AA%E5%8A%A8%E5%8C%96\" aria-label=\"自动化 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>自动化</h3>\n<p class=\"para\">提供了几个命令来简化开发流程和提高协作效率。</p>\n<p class=\"para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ea2266727153ca43a249eb41b62e2cb1/37f12/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.1063829787234%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAACQklEQVQozwE3Asj9APDv7wDu6egG8fT1KObs8Vns7fdT86FqG++gcBjo8/oc6ejnNufn5x/m5uYA5+fkAvj58QDX29Qb4OTcMzlASZY6QEnFNz1HuywzPXsvLzsAAGNjYwXU09My6Onpqdzc35Pi5/SV7IpMa+mHS1zk7fOL5+blyObm5ivq6ekA5+noBAU5RgG7xb4Y2NrUJv///wA6PkhSPUFLpDQ4QpQsLzuBAOfn53Hj5ORf6+joX51bRhjY4PFH56R6YOzGrpLs9Pli7ezra83OzgDx8fEAusfIANvh4ACtt60M1dbRLP///xZER1CCNDZB/y0uOfIsLjn/ANra2gnOzc8U3+HeKejo+Cbt9v8g69nOhe3i28Hw9fg07u3tK+rq6i7m5uYex9HRPMXQ0Gy/ycZC2d3XRNTa1Dy/xMRXys7Qkc/T1IeJkZUvAOfn5wD///8F5OTjO+Pd5SLo/P8W6oFAMN6GUCTg6/FO5OLhS9fX10fh4eFAxtHRLcfR0V2IoKIVxs/KAODi3wDt7Ox78/P0//////////8vAObm5mbe3t5R6enpS9LRzRv///8AmGZICel/PUTjvaUk6OvtWu3s7DTl5eUAr8DBAODl4wC7xL4e1tvXUs/X0TfZ29t44+Xn6fT29tXc4eEvAOzs7Dbp6ekt7e3tMOLh4RL///8A1odVB/OJSCHs1MQR7/HyOPDw7yX///8A6OrlBP//9gDQ1c5X29/Z0Nvf2cLU2dFKED0+C0VnZhEWQUAKc5lokf/mgzUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2.png\"\n        title=\"2.png\"\n        src=\"/static/ea2266727153ca43a249eb41b62e2cb1/1d69c/2.png\"\n        srcset=\"/static/ea2266727153ca43a249eb41b62e2cb1/4dcb9/2.png 188w,\n/static/ea2266727153ca43a249eb41b62e2cb1/5ff7e/2.png 375w,\n/static/ea2266727153ca43a249eb41b62e2cb1/1d69c/2.png 750w,\n/static/ea2266727153ca43a249eb41b62e2cb1/78797/2.png 1125w,\n/static/ea2266727153ca43a249eb41b62e2cb1/aa440/2.png 1500w,\n/static/ea2266727153ca43a249eb41b62e2cb1/37f12/2.png 3750w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1b1d412ed962a881c9538c118584d027/37a83/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.765957446808514%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB0UlEQVQoz22Sz0tUURTHDwy0dhcSBILie6NSjcyMNCUqhEJE/0WUI0G5E6JFi2oVJEMugpwWERW6lWjRooJ+WClKBEFgvpl5w7OZ61zffTPvnnvkvPdEFx743ns258P3e+6FCxenwsLoVJjNT4TnhkdDeyAfWHaW7HTuHgAAEcHO/8a1RlNQoymECgJpjJGIeFQtRGwj4l8oXLpK2YkrdDY3TumhEbIG82Slc2TZ2UcAqQjYbIribktSGGpENGQMkTEmUdJTdNfhzNjk/FBhvGQPny/1Z/LzVmbkcf9g7mlvX+YywIkI6Cs1rYKAB8J4Lq6DnoiQT0RT44FZMmaWiG6iDu8Q0QwR3RZCzDmVyl3P8+5LKR/6viKMy7BLRCStNXFprTFxXIO1jc3u1Z9r3d++/zj5/sPH05++fD318tWbntKThd7F8vO+10vLXXu+P8cOtUbNjhjGYkjSY9LXwNvxoF53wXVdqDhOFPHP71/w7u0K3CpeByEESLlXZCAiRpF5WuuIbWKWOYwcgapV2HYccGvVCLi++hlelJ/Bv62t1G5LMnA6iawPHoDjsjs6XCov0uWfAQ8WysdKKZUKgoDvG+1OhyEKETvHqB3vFLf3AXkU7bZ2MV1bAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3.png\"\n        title=\"3.png\"\n        src=\"/static/1b1d412ed962a881c9538c118584d027/1d69c/3.png\"\n        srcset=\"/static/1b1d412ed962a881c9538c118584d027/4dcb9/3.png 188w,\n/static/1b1d412ed962a881c9538c118584d027/5ff7e/3.png 375w,\n/static/1b1d412ed962a881c9538c118584d027/1d69c/3.png 750w,\n/static/1b1d412ed962a881c9538c118584d027/78797/3.png 1125w,\n/static/1b1d412ed962a881c9538c118584d027/aa440/3.png 1500w,\n/static/1b1d412ed962a881c9538c118584d027/37a83/3.png 3466w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","tableOfContents":"<ul>\n<li><a href=\"#webpack%E7%9A%84%E6%9E%84%E5%BB%BA%E6%89%93%E5%8C%85\">Webpack的构建打包</a></li>\n<li><a href=\"#%E6%96%87%E6%A1%A3%E8%87%AA%E5%8A%A8%E5%8C%96\">文档自动化</a></li>\n<li><a href=\"#%E4%B8%BB%E9%A2%98%E8%89%B2\">主题色</a></li>\n<li><a href=\"#%E8%87%AA%E5%8A%A8%E5%8C%96\">自动化</a></li>\n</ul>","headings":[{"id":"Webpack的构建打包","depth":3,"value":"Webpack的构建打包"},{"id":"文档自动化","depth":3,"value":"文档自动化"},{"id":"主题色","depth":3,"value":"主题色"},{"id":"自动化","depth":3,"value":"自动化"}],"frontmatter":{"title":"在滴滴的这几年：组件库的设计和开发","date":"2020-05-05","cover":null,"description":null,"categories":["解决方案"],"tags":[]}},"previous":{"fields":{"slug":"/blogs/2020-06-14-在滴滴的这几年：基于 Node.js 的私有云 Web 管控系统/"},"frontmatter":{"title":"在滴滴的这几年：基于 Node.js 的私有云 Web 管控系统"}},"next":{"fields":{"slug":"/blogs/2020-03-21-使用 CSS Variable 实现主题色切换/"},"frontmatter":{"title":"使用 CSS variables 实现主题色切换","tags":["CSS"],"categories":["技术研究"],"status":null}}},"pageContext":{"id":"ac6266b3-a63f-5908-b80e-a8d665821b8d","previousPostId":"2991f25e-9b6e-5e57-b532-547f4e64cd88","nextPostId":"130f2871-cd90-59b6-9b30-fb7d03267f70"}},
    "staticQueryHashes": ["2841359383"]}